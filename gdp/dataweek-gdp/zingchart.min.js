










window.ZC = {

	_indexof_ : function(a, e) {
		if (a.indexOf) {
			return a.indexOf(e);
		} else {
			for (var i=0,iLen=a.length;i<iLen;i++) {
				if (a[i] === e) {
					return i;
				}
			}
			return -1;
		}
	},
	
	VERSION : '2.1.4',
	CHARTS : [
		'null','null3d','line','line3d','vline','area','area3d','varea','bar','bar3d','vbar','vbar3d','hbar','hbar3d',
		'scatter','hscatter','bubble','hbubble','pie','pie3d','ring','ring3d','nestedpie','mixed','mixed3d','hmixed','radar',
		'bullet','vbullet','hbullet','funnel','vfunnel','hfunnel','piano','stock','range','gauge','venn'
	],
	EQUIV : {
		floatbar : ['vfloatbar', 'hfloatbar'],
		boxplot : ['vboxplot', 'hboxplot'],
		waterfall : ['vwaterfall', 'hwaterfall'],
		populationpyramid : ['population-pyramid', 'pop-pyramid']
	},
	cache : {
		data : {},
		size : 0,
		add : function(k, v) {
			ZC.cache.data[k] = v;
			ZC.cache.size++;
			if (ZC.cache.size > 2*1024) {
				for (var p in ZC.cache.data) {
					if (ZC.cache.data.hasOwnProperty(p)) {
						if (p.indexOf('text-width-') === 0 || p.indexOf('path-points-') === 0) {
							ZC.cache.data[p] = null;
							delete ZC.cache.data[p];
						}
					}
				}
				ZC.cache.size = 0;
			}
		}
	},
	DEBUG : 0,
	TS : {},
	MAX : Number.MAX_VALUE,
	IMG404 : [],
	
	TTLOCK : false,
	COLORS : [],
	SEQ : 0,
	BLANK : 'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',
	LOGO_ABOUT : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJEAAAA1CAYAAABBVQnbAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABu1JREFUeNrsXLFy4zYQBW9UR7wfSHh1iqMn6S3NxLXlLp3lL5D1ARlLkw+Q/QWiu3TW1Sqk65M5ukh9vPzAUV+gLMilDUMgAYigZUm7MzAliiDBxcPu2+XS3nq9ZiQkdaTF/3iet/UJ/vjr5wKFyz9//7dLKj0u4UboHamBpK54HEm2lgisTwgbH78ucBtDG+LnFKxSTOo9DkvU2rLvBFpH2hcKgFpCI9d2JELujMQNsd5CRFdVWKRU2G/syv7+hQWw6ePX6Nd/WELTcgScyGV0BiDqCG6wCyBa0rRQdEZC7sxaxri1ckNggRYKcr6A/ZlVA4tExPxYQAQubERqJBDtSu6hfYb2k0isoX2ztWoke06s6woRayLWJCQ5kkhIyBKR7FQIRCQEIpJjCPFn/xWR15D1fqTyEALRVtLBrU/qJhDZWB8OmFDaG8J+vk3JIhGITEQsUCtkgtslo4K1wwMRxPoBbAIXJ/Q8b3mQmpqvevD3VGFhuVV95PaXnbXTkr6h5M7j0mP3UDxMNo6g3TgCkSe5tiKb2QU3ttxD8PRRN7pFxkFxB+AYKc4hVyx04biDWGx1aqwPX+Yrbjmm0HqGPfwMbPPVOYIkPRA9yAZmYwG8Boi6gtnfJ1koXBeXhD1XGagDCN53vuoeksvabYi/ny5sogAHv4/xhhvK+c5UOj7E1Ts8BhC5zljv/8qbrzh3uZb2RgAeNY85a8dobWVLe40u8TgsEXDhEZJrHYnq46rTuS4XhK0nrW7uQmYw1lTTL5R4jFE/QQYK91VtUbjbmq8u4NNX2Q6zvNCuind1hPtMMot31k4MwB5iv0CylvaRXz6O3tO5VMGBLjozKUrDyVmw8szzFZwnEo5X1VA/RW9rdQ3KGBUxLYmGuHKG4nWk8aleqiz6XSFA5N/HuIgKZX6X7wuUGhlOxoME4FvoO1RGZ88uT6XPKAOuCgxm0aK6/8txLDPrukmci/EtDO54vP7th1HL0CpYAaiGnGtSDVnEBONJ4Xozi/Hx/Q9MX3bb2wCfKYByGWZhvt69T0pIeyF9/P1EAsGUPZcSM03/Hhx/UmnVcu533TixhgnyNRM0dgQgplGsPAkzYXwPzOzZnC7X81FBps0ln7DE4j7FFz7lhGSYWZ0CxLkF6pdEiin27WykHHILXKaLTuPRmQGAoidX8LoScOsD145xJQUVRD+2UJYM4scG7+Gly8ldqZxWOBc41UBB9q8UPEmcr54GRIXwBXn/ZDnzAMIzyhNVVTYKAAorAHTVgHL5pHOS+gEVkGqUcFnmWmB876F18Vzb5KmaijbjDAAiZ8k/jxVuWAXwZANAz5HirKR/mfBxXECbZeDYIpPe0riMsGKim8qBXMDEFy4hQv6tighD+C0usUJLOMetQOYTOFYVPe0KRHcl7nAGK98k8k0dUIKCXNemIq0SK1RF4LK8iEXIbCMzAUCi37flOJ8UUWGCoLNRctAQiBLrHioLkbvAIswP0CoHtcFcF0Sg6FEFgNIGAeSSg8RbWhZ5ctuW+ZZAmsQUXYwbyUHTR67kghQvnYMIk4k3OwKQS/Edgdh2omT9RRXE1hZAfaQYvmbx+MbWyNGzvXcSgKYaAL21h6hpRb5JFSiEliszxIjHVE6l798cAShQAChBIt7N8klnbQ/aCdvBK+hFUVqR7S1l8G8QQJznxCUvX/Zg/5005onWQnHXM18l0kq+wWjRZKI7TbgLtHD+i5CcR1RvRAp3VpUL4qt9AJMyMDznvcPkoxEZZ5uZ5iw9AWPm41ihhTB1TWPJIvdeJP3KZbrBr9wVnn20IMTBrkDka/iFDTf4/Mr3cMfUhWN83PYpfQ6W+epSuudpRmrP2rclZFf1zG7cIMfzS6zh9SuAyLfJE+2F8JpusDi3zMEzINF9Q/siKWwCkzRAy/coWIi+QrFO8i/SwpRBHeB1YixfuVRG1TmnSxwWyN0IJS7c9S8PojwWgDREblQFpIiZPi/iz8B4ZeKmmw8MwBobcSg7iaSoz3/isOXJyUK+sHpv2CQbwcaz686qLg7mNWoOJJY/9b5FpaWogBlGlnahdp7f+WBJjiPWRH11/mDXZPwp3r/La0dM88io1YD/LpR+r+FHY4MQWwxllcdiZClai09I7uPapDMHQ1dwFx3FORIcy11FYlHWRWKol0Tiavz8A+SAvgCcGK8xwwI50SqLlQK6OSmTLrrKU+m6yyJ/stcWCMb/sFaLLx3XKTmuZ31RzkdyTnL0khU17vrf7Tm4iT5TJ0kTXHlc2iUEmBe3vSco1APRIVgiH9rX9XbSJxgQiIob4WUh3y0BNCEIEIhUFmlqACbOoTo0/cSJtJZJwX8O959NvAUQkZDUkf8FGADBt38P1SQKxwAAAABJRU5ErkJggg==',
	IMAGES : {
		'zc.logo' : 'data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAI0AAAA8CAYAAABbyDl1AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAACGZJREFUeNrsXF9oFEccno2XRE1SI9ZQLcY0oIW21miQKoi5UPtiK7m+1GKhuWDrg7Z4+lILihGF6oueUH2w2pwFxT71gtonWy9SUJDEmKK0CvGikGtjg4mJ5p9xOt8mt5ndm93bTfaS3DkfLGxu525nZ779/b7vN6MKpZRISDhBlhwCCafwTLcO/XchRDsvhtTzeR/5yasb/YqcJkkaSwzGoqS3sUE9Lyj3yhmS6Uki4yNN7PFftH+oRz1/o2iVTBMSKhQr9/Tj7zU0+uiGel5TWZcS4vAaRk1P7VGWotrU85wFi0nOwhLtmtQ4UtMkaJjEa20agaTGkZpGIlPS0/2OGzTacUP7++b9MOl61q6el5VUkbl5r2vXKt/Z5lqa6GmMaJ3ovBAinRfPjKajajJvo5+PNDI1Tbf0BMJcuX1C2LA5Wq/7m5HGtU7wZOAJBD0jiSLTk0SmRZqSolWkkmyzlZ4kpKaZMsttpXFkapKWe1waR0JqGolMT09yGUHCMWkkJGR6kpCkkZCkkZCkkZCkkZCQpJGQpJGQpJF4yUnj/aOD4pDDnRmYlAXLhs4BOdIy0ki8zEjZ2hPSkVmEqZiXSyJri+QCaCakp9pTZyfMoNovPssYMjT3DNPI4+ck/Oh5wrVCj0J88z3EvzDH9HlrWwe08awtzc2YcdEiTaSphVZu/3bCP3jl+HfEu/Jd3QAp9Q/Vm9CqRWkzcP7bffRMbChpuznstfMvyCHBN2fqno2RjVY2Phsbl/LZxDvXM+2fH/3WsoVJfz1EIiG6+G49I2399oJuNwtCxx4OksJshWZCNDEQnYqIMymkgYZJFxgJs5gFkEBxDikrmKF91jVE1ZTFR6L9rQOkZKZCrdKVtNxOQl6aiF5GGMoTpnpBNgm9PUvYd19RNtMz2WpU6h6VPIG7/dA4L48Qhg5heiRpTG6+20p2HvtBeK16w/sJeiZdgFxezwleaBUzwvA5n6UkuvPugJaqoIWSfS+jIo2dCfd9c1BIrIoVy0ho7y7t+6FLlyk7dG3KlpaSYGCr2sa7bTe1e02977rVJPCpz7R/4YZrNHz1GonGOsYcTkEe8W9YT3wVaxSr+wHBB4N651NqL6UGinMV9l0tQsFtOXVkcGK4H0uBwucLPhigzT0vSLT/hdDFeefOUPthvBZqH6TR0X6hDUge7hiiIZZWu5jebXg8rAr0aB9+O3FaQ+1D7HmGKf99x+mp7POvaHfv04TPly95g0ROHNJ1Ohr7lzTc/NP0t0TXQLRA8CQR3QPta0+fo5HjhzDhip7IB2j91evC++DzfVs2U6u+qO24SRzRMfZFbXj5bHUSrAAdVHa9l97qfWF6/5vv5VEjcQJ/91MI7WR9j/ZRanRwIAeIoYKRkpGDIoV2G3ita8dB5x7Z9xlp1NMsJ4S5de++kDDNP30/4XAMkpkRRnMq7BojiP4tPB82JYwmUk+fs20zVRLOz3bUd0w03sL4IbTwd/qIGWF4EW6s8yQjTBxox9eFBBGO1NxJJEzKhLAZYebk57lCGKDtnw7b7ZCKkHLUgU1CCHt6ZtigVWa4rgMwWSJhzUcfpDikDyayldG0pLWrmu9BRFOs6klob5ZW45EUUZQX6yB5pHyMBsrlJzRZbSkpafwHjpgSBqnCTeA3Q3t2qlpEDfssghz7uT7xrbnXCp2CyJSQLhe/VkTCh/dqKYwJd+o/eISInsEMhdnu61hMlkggN6/OV/iJamYE8hWNRD8+KogIo6YW9puMNDROzGSFyOjaAiWlkQaEOfPrb6aEMWqLiSKwqYrEI8ioMAdpTENupKklsc8frtf1C+dM8LpS7Z4I7AprPgKguBYXu2aA2LX7m8GlM1Nbp8FbLCKMyvrDe1wnjDqwgnUruDIzESuKHqLfGHWFU7qfp2SW8w0FVssOiETQKUzH2IviWO5wqfAoJA1cjCgtAHUsfaRrLcZ0QvWmQ9U4cadgB7DRvHtyc40JGgf2PG63RS7HplhPTZ0mTpiag0dNCcPCf8YVrowDijfYCZgY1Tkjuv4VdyIvc0P7TSIJNBKIDTKNl0jjRZaxQGZGmH1bNk87wkD0iop8dj4zWuY5HnHNxg54wlS45LyQfnjCwD3BzTBCKjggaCGCnURE10kz4jLEhMHywHTcJ4OqbsLbefqsrc8SNFyxXqh6G5/a0kBGIVqW7w5p+Ap13G5Pl60VY2tP23ebFtYgiNlhaxARkSaLYL51a4ixsAdxXPjBJ7RsSalmz60Khpy7UVCuj9tWhHxUY41VVkEK0U92kvZ2oddI5kTsGqJTF2nsDOx0A9KlKEXhWeC4cDh5LqMtRpUVxDFLH4WRJ7pV8R2LUrPCjXUn00gXG0zZ+JoRMu03lkd/qVNQN7LC0R1f2qsTFecq+wTEATmQruIHqrjYrMQX05bnZ7kWZUYd2Fikjw2p6RJOCmTFgUow+mUs6KHNRO7LazssfcSfmU/DGfGvEVBorFq3Wnhtx6Yqy9VxUZqqe0tfBMPEIF3FD+MaEpYHUNl1tWbF+sFPIO77cUufurMOB4iEfoGsPNDGag0qacrn1t345+ZXwTNiuycKjVg6UAnU1DK2x3Wc9SQUwZijotArVk4Kk4qU5mRF3NHLUJ5HzPoAy417o6+IBG7ZbjiyQo9iuVCa1v99GggSadJXi70rlyWQBc5wRfXX4xbsoje3ZGThb9LcDL8Sj2UF4xYKOxvCXXdPaalnYh0J2x5Cl4qgc/RaJXhS6LycpIqpftZkRJhMO572/1Ej7LVT54f1LOOmMYlxWO50RTCw1Zk7YE7L6XckMizSxLVN7alzJNmWTuwyDO3ZlZIVekmadI4858O0S5CuoGEkWSRpJKSmkUgX/C/AAC1LYqunMJ6bAAAAAElFTkSuQmCC',
		
		
		
		'zc.wm1' : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI4AAAAeCAYAAAD6myZLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADfVJREFUeNrsWglYFEcWnp6DAeQSvFCEGCMi3sYLNcZEg5pEsopoogKKJwYlqBHFmEQwRlGiHNH4uRiPrK63xsS4up6JF1Fj8EI8Ip6oyD0Mw0x3572eardS2wNks9k1X6a+r76e7qp+VfXe//73umo4URRV9mIvv7ao7SqwFztw7MUOHHuxA8de7MCxF3uxA8de7MCxFztw7OUPUbTVtHEUuDjqKheBVJGqT0PhqKv8m54fx/QXmWtNsjlKH6xOWF2IREeq36AjdjyVgmyVwlp/7XgcoztWN2JtgSODRkuqhlKUDBoLqTSInhYmpRVNA5yjnovU3H+NgjWUTjSMQVEWT6pAXcXfABjaBrJRWbkc+c1T9T/Rm4bRm+L8tbVQkA6qI7nSwJFBU0WBR7Th5UpFtIF2Je9nPUCJNUTGqFoyX3xuJnOknUHNOABfA/PQoJP14kCqjjFcFbmaFRyLU2AFjqkiM1d5LHpNMjjoeclrrSJXXkG+ks7k93Wkyrioouov7FkTcLDdsd7omamPywwj6EYHrfb2wE6Bk3bGTzxNJskCR1AIA5yN0ECHQpGhYbUCoGhFsGyCC9fjtc6IuI16nTavcO3iqZRs7TOT5o5/WFIWUrFx2ZvEsGZmDez82Plo1ENjboqi6MEqrY7e4dLaqZGRQxev+h50lG3alNqPMqASM9CA1ygAR1qPf8y8mKv3H86Qx2no4bopP3NhAv6OTF/Xft3hU9ud9Q4XDRuWhsCjSqhGYnCaBFimFSlm1soEAXr70mS2NLVsSW8N9wYlBqsN42i1GrXG3dnpZPH6JRPJc77xuIT39/+Ykwy/XyOLExg2YD2M9iY2N1LXABzORn9WCRoKOA5atVqDlXir3Efn5KDTaTUafO5CgYb2UDZHoFlJMrqwNaM54gSqG8pxHzV9bamxsqV/44YHQ7t3qBS3fdqKyHRmgCCvRQasSDkpG/Yk4PiMnzP/bmHx0Da+jVPPL52TGRibNObynfw4GNO35IuUCWAbNDigWVqrO1m/lgBIpACopXTGUzpTU5FFS+RgcSJzNDGArhE4EhLVnBoKx9Ee0aNls/3bTp4LI8IFr8iZqYXlhgH4opuT44nPY8JjZ32xa9iNBwUTALldd2Vle/xl0cqTzRp4Zd5Ykbi4Z0JK/5O5PyXyWzM6ghyvqIz1aaD4IHzft57nqryVSYtwnEZjZy0oKjf2qLJYmr77Rr8+yRGD7/hNnBt/q6BwvDzW6pjwqWCsYvC8tpuOnUkDb/Fx1OnuSgzgqL/DULwWUQPyfF1HTttZXmlqhez5UpsW7+2dG/OtR/iMDPDcW/f+umCB5NlRs2YVlVf0rNqc9iLRi4UBsKZrfHIkggbmcuXsklnrwaG8ghPTDyP7lG9YOvztVZtaL9979O8ujvrLFl5wqzSbm2Db394ZE/VG13bFiVv2+Cbv2L/MYKoKxHmD5UpxXtMG9Q3XgPIRNJ4udbIANKtx/Eupc5frh8cORX0NS8nsATo1SUmPILgDW3xdYaryJo4egfPs/d7S17Ou3ZyOeiEAK508oPektLFh50EHm41V5ib+jRvsAjCG13dzOVNmrAyQABD6du5nE99qPTG4l4FND9S1SdAAM4Aa7hdJ5cncm8G4eDQEeMAkg8nU5svZk4J2z47ugQuIXb0lfkDHwLPw223muh3dMg8c74svQsjrhfYuKCvvVM/NJQttG/f51tkaWA146fMpo4cMelBSOrDLzEXh6K1atWTkph+NCBkAoHmEz7H9k9GhIdgfmQPfRzkIGjD6XXjeuctzfuvQQDh3htGk9aASn21Ybz/07dC8Ub2t/8y+kr779PmG3nXdciCMjSBs4gwGfLFRXbc9NsKIZunug34//HR7FD4ABS+gKR3dDWUAYCRGgPn4HEqMnYzGQZAs++rgYHjssWTXgTS8H/NyUOyyqKHvYD/s7+qkdz6WcwP1pWrg7pJDQIsgMUII7AFzf27z9LEn5PHMFt71SFLc1AburmdLKozde81JGY1iTuTeSESbnFr47uBerZpnok0OXcjFSOGG7IL3CBqUsTshOglAlwvgLQP5bWFNJUr5aq33cYBNugICT0M9AzU7v7g0eGTvrh8i2wCrhIERtgzq3Lbs9c5tynoGNF9zv6j0FUD0dfTCvEeFz8L7zXQaTTl6JjCNd35Rafem9epeRXq8XVA0ZHy/niuQLsHLHgQ0abjj9uOinngPTKdGT00I7Z+P99cfFAwI9PHeGTfo5UcYggZ3a7/hflHJK/Hrd3ZAMIx5KSgDF3l0ftx2fM/WehD0P36SkInzBw/Gq2r9kax2qWPDdqEiAYzPA3M0Au9t3a3FM8eVQINOM3/r3veARVxbeDdYA8A+g0YFoJuJ10k5F+RZGAZUMJ/87v7NTLDu65Khed4racs3HdHD0Vir3x51Dgz1sG4d51ySR+oARO5SzHBwKKUSbjq0CiL5U5WLkz6/c3Nfg4+XxzWrfMETXzVvTn8dxt0MzDcSANLHKluDc3JCRsD7fu0ClgBQ+sBaH4v/+pMWz6QVtf4ctwZ4EFTXxfkUJJnjSMJVSQRKcRMNFujT6DJRpgr6lqLyUXd+DTzPXL3/KKDIUNG407NN9526enPIR9v29kUA9e/QKhko3BffSd65fw3UJ2MiNcvAhtBSKjOg0WT2AQ/vBuCNoecITCYlqsBYOTKtguLLbG5gaSSZT/YtMDzgj+D2rcpcnRxzvr18vcfRS9dEMPqdLTPGXaCUpyG5gEuH6Qti0KHQOXIzPlhGGIEjLPdkKMwRaWflSDt4uzr33sOmrD0AJAYrY3EcMCi9BvmL8Rf5n8D8G0+Wr9Oosa9T3YgZK4oNxhYEvA+ofEgnvzM3bOB+wmaCWIu9rZqAY00ERUHgAQlEsJyxCyTp1GPMLCgzuMg0fT3/kTcqHEH/TH2vi2CASPDcxr0Dn8vIvf/wWtbVvF5IhRB+zoNXY/KoOvDh1L4vt21ZznxtCAIOLkiKwbHVEPNLBnZqnb5nzuRDdDI+Y+12f7xCiPRPjQrDEKoGz3cFz/q3jUpUtIXn3ajnPOYe7s6OhWj8Ft71D9x8+LgrrKGsiafHPmZOUiIJOVv9i7fvYyhQhQZ1XE714VBhlA4tEEKkrQBYhbQOGJsnOYngUcephLCPK5kPByzjIr3IC3w7vyY5312+rgLW7gqPVhHQaiDHOYghfOGoN14lclWCddwn8vE5sExHBA048zVw/On9PkwLPXD+SgToQEr45XchzzGSLyjRWp4k0Ip7UOoaQCNY5y8KZCAjVWUAVcKkvv7+Wt5YyBFcsV66kz/Ur77nJmyHJOwoxFt/UIzLpOAXjgGNZkEO0cnLtc4paK94pX3AA0xwI9LWRaP+pmZu8Xd8M3Z3q6mJEZISELLWsRE4piZeHt8cvXg1AgDnhBWSu889I99NXRI55ByCdeO3pyNx7kGzlwzGBFNUiSK7IcfzooA5BeRLodi35ZR5YwH8JauiR55FRoVQewwYrAvMswsY7jh5V96PkcLU2OVfzMMQBfnRlxBiTtBKxjkTpsb7SjBKFXVfYbYIEpCqLLw5fdyw4/CVdw8TWjByZwiXPpCM+1vbLeZPxw//DtkXma1t3EdR6Oygm2gEDTzfGz84OA+AZlaSb4L3IQQ+pkBlBLC3JfkQ9jGSd1Sgqyd2lZ8p7APVGjhSTK0yWyyIfoJIo2xEuc4b/loSsGpxyMefncCKv6+kf5CG/SFBvov7C8hKQS2b3Wro7vYDCver77ULLkjD5Z9OGB4NhgqA8HM2fc/hDdD//OW099Ot+QJvIR6E41aA3FRoz8avFqy4yOj+L2BybAgL6jSlpKKyFcg5dz7v7hD8WiLeb6bAYwGl89iWnXcvCvpeuPmwcBjuSckbZ5CbZePXDXrdjvgJR9hP9dSvD7nCfPtb2bUgBGRkQb0E9brTm+/sgNBtoQxZDkCosBpPYu0yMLQEJAAL6s8w5dU+CRjuIGwvjl65MRlYspxuf7w2OQK+elIu3LoXi/llzt0H0wCwi+H5ZNQLMEqlLfkLRoacgZxqOzovvLvP0UGXh23ZeXff+se5y2ryjqqwzPCEFCC5/gpTDVzPwh373Jj9OSvNV/NndXqrW0t9ilqoT1K5TU/ClobqR1O70na5hUG03EektrpFGxtwWuYrh2eSVrlN3sU1UXsm1c2XI2246ZlRR6+/lbcyKRGNT5xGoPY7nIgMeQfarHAEwCncs/tkDpQ8rFqP8Bkr0ND4JQkfBVfI/Ok9F8HGBqKakU+3KW2y8tTczQqyaP1Z6KMZbS0YhzYMeyZFb9NbFM44xGoO6NjdVE01Z0iiQl9NNbugamZe7JECPV96w1EC5LQ127yRUUb27vICCck0KHg5iSRtahubmqoajknkTTdeGzblDHp4n9YtFs0fEXLEYDJJOSIBTQWzkccxRhdtHELbOphVKehNoI5k6LM+kTlOqnVyLFRzwst+svHMmZJg47xJZQMMahsnvEoGsDAeLdo4kxEZBdHgNyswANcwatZkyG3mAl0vhyT7CsVWArNeSy1Ox5WOVlTMOsQ2vt7x8OUZc/ji1fhec1LicfMOQufHBDQVxOsFhcPU2pz3cdW02zr9VtKtqrah6s9U2EM+OoSZbXndf+EEXw5VelLpECvnkFVsmHja/4/zZysik5fR7PJ7/GVEpJhPHkvNhA4LE9LtwHkKQUMDhVP9/n9QY3OMKoVQ/7T9Sc4OHBuGFP9PYwp/NGXZ/3NsL3bg2Mv/rvwswABesoq0nEnfbwAAAABJRU5ErkJggg==',
		'zc.wm2' : 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI4AAAAeCAYAAAD6myZLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADCFJREFUeNrsWglsVccV/f/9/70vrA4Fm82GOIAhUWqCG1QaEFEhrWhZwr41lNAiQgtqACVpgCy0LC0NYTUgKCnFIBZBEFAoooBJI/YlMUvY94AdbLPZ+P/Xc9wZ62b6vu3QpqXKG+nqvdnu3Ln3zJ07857Xtm2Pm9z0VZPXBY6bXOC4yQWOm1zguMkFjpvc5ALHTS5w3OQCx03/38CxLKu8XpClnky2opB4f6TmZTztMPV2mPqqeEt9eEWd7fC0/00deR1I8wqFmdPDjmfOR/LzhEKhagFHM/EJsgQzcgkqChmT+F+DRhvWEgrWCjAN8FXAb+rEUk+p7FAYehhjesUYPjGW7aBzr2GX0EMsCMtBbxXyVxc4WuAAKALkd2BYBnqgBHVSTGWC25UgvSoPEW5V6Mn7hWG1nFqRllEXEsquTGbbMGRAkARPUOlEj1smDOokswlmc956LL8iEzi2sRDKhF1CYfjbxpw8Qm+abMGn3MYSOFYVKKTQEQUFBbPQ6QbouqIbJSUlB7du3foM6qNAkYKiFEVUQoEw5ZFGm0AVfSMdyjh2NCjmzp07H966dWuOAD4pcPny5Zfv3r27Ee+xqq2WXYLBb5BPbE9WMBi8CD0UKH1cAV0mge+2IUOGNMD7F9DRbqEfLVe0KDPnLttoiiGdO3fuV2qsa3zeuHHjD7p+7dq17VB28969ezuQj1d9ohx4S4o0xoxVfePJp6ys7Kwqj3DwqpUCp2J1QUlWcXHxHjihZqDmoLTCwsLc9u3bzxADm085cf2M1YowFBhVCUUbk9XPaIc2X1I25X7w4IFesdpT+O/fv++Hoi1DTielSkB9yeP6fL5G0EM9UCooAyD9lBUw8F+WLFlyF2VNIiMjf6D46bnHCYoNo59Ys+3169d/37Bhw/GnTp2aThucOXNmau3atfsVFRXlkD9sQRk9MLbPgX+UkCFOgSPOGCdePskHO5FX9fM74oRblRN5vV4/KA6U9Pnnn/8Zwu3B++OgdFCzzZs3D7LJ3ettDGqI+g9tlQCy3YMHD259/vz5KTDeLdQ3GjhwYBvWXbp0aR7zBw4c+Jmqqz906NAM9tH9r169OgflyaAGN2/e/FNpael5ls+bNy+L5ayXY7E/y1evXv2CbgtwXCRRds4BlACKB9U+ceLEeHiDCzD2MbZln127dvWlLLdv316PPu/j/TESvO17qD+kdBGl9BKh+NWjLo4ePTpTyfIp8i179OiRyTxW7lHkU5ctW/Yj5jkeZdJ11Al1MX369O8yz3IpV3Z2ds/58+f34rvSf5rSd4qe56ZNmwbPnTv3RcXzEonvAFUu7UK97Nu37+fkq3UGYBQuXbr0x5SNYzF/+vTpRazDfP9uizR27NjmaBcNsiQ+qgIOFf2YAE66ojSWacV89tlnUylY//79n+zbt+9TLL927doKCsfBOfnt27ePEcptgZWZnZ+fv4n9AYQczX/SpEmdyAvGeI11HIf9pk6d2gH5pixn/ZtvvtmZ7dmP/fHenOVKYel79+6dyH4KODRwDWXsOnl5eRNYBwBNp+GhtN8SxJRdvysDNYKhj2Aub6m+EjiJBDbloOL1PDm2Bg5A+AmBpA3Ldp06deqIeX/MPGVEfSu2Y37lypXDX3311a6a34wZMwZggc3iO7zMQs6fY6qFkKQWV5rmD+9a1KFDh+c1f/T9NRc7+emx9+/f/z7r4L0Wo6417SGBwjbQYR7bU/+gugo4XokPq7ohd0JCQhbce56iU3CVXdatW/canVZKSkqfixcvrli+fHnRihUriiBwdp06dbpgrz8JpeShvmliYmJTCFMcFxf3RMeOHeuh/7NwwXncQ+vVq/ci+s6kW5w4ceJVgGpl/fr12zPP7QZxwyfjxo27wq0GLvsFKHHV5MmTr7J+y5YtS+rWrfv9OXPmPBkREZGyatWq31Hetm3b5rBfmMCfHulYenr6fMqflpbGp2fQoEGtMc4q1CcuXLjw6e7duydhu8k4ePDgbmOPrzjpjBkzZhK2rYQLFy5kjxgxYj/KSgKBQFC09cM70N17IM8VLKC7mPeJ8gDS56s9bdq0p2JjY1tQT717996L/DUshuOsZ7+oqKhEvmNRFKrAWwesOuAPcT6a/86dO28D6Cc1f261kOe5Q4cOfTBz5syfpKamdmYdQEaZotSW5NmzZ8874PM05CsgRkSg73ga9FcXOIxxYPxBSuhSJXR54EiDwesc03shAtIiKpPKhjf4uEmTJi0AvGSs9A0ZGRn9Xn/99ecJoG3btr01fvz4RuwDpeeAKsYD6j/S/AC4Ih13wZApMDhBPEbKByDW4HPYsGF5uq3o9y+Jq1PGc7ottrtixitZWVnPkmC8i127dj0iFGipgDH6+PHjr3BBsX3jxo2nKUV7IZtXhQHlpyIVZ+m8pY3FWAKGbCTbsj/GLNZlAEOxcVjxidOV00msInHRETgA4h/j4+PTFbiuinjIr2V5++23N+uTmABO2FSVx7EVojUzAqYEdF8R30uhqMKaNWsm6BUAr9CACqd8WInHkpOTM5OSkjLhHo8DECdat279HCZVNHr06MMnT57M50DdunXLwjitQC1Aj9eoUWMwJwIAlo+vVxkmegvxyC9VW1IG6Qsk8lm8eHG6lsPv9ycoueWdhs0VilWYIMAQZFvIVsB3yLwFHi8LXrMltrpNxtG3/Ng6YMCAOjD6T8kQ8d5MebSnzOVo/OfYQSysMuXpWF6qnvQIIYx5i++QJ17Lg/bx5ava7w8CnOVek/II0EbCA+2F3i/B4A21xzH5MyG+yiRoqHeUdzh8+PAGPTb1qUECr0d73qNdDY/jeB9kVQUaduYgaqASQRpEpRBqQ5s2bYb36dMnsV+/fgnNmjXrfeXKleUUYsGCBTvoXaCEeAS3u+CmP6pVq1ZbxiasX7NmzQ246Vy0+wUnghNJOraRbdiOXtJKUIrheKVwwxszMzNfwjYSQ0LfFeA1H97qIMEKAA6j8NheesXExLQUwKkglmELaHXkyJHenCfGGgEgF0L+AwQoYo9d8K7tIGc7eMnd4qKz4i5n1qxZ79KrIthf3atXr1x5EYq5SuCUwkuWiXyJBhKf2M53Y76XIU8DGPmZkSNHpsCLPcF69kMAvYvel54NMdnLxBO8+ygArSHKN8J7n0PfsPzh/QsEqEqaN2/+lAYl8xpkAJd2CCyzhd48jl6tkuDYUsFgPIyzBJPbIQJEn6pnkBg3YcKENLjAnTrA4rsKSEn1GWCqgLNZbm7uK2yDPXeEqk8aNWoUwXJE9ycQUf4tBuZ0swi2/8bTEANbddL5QLdlv9mzZ3+HQeP69eu76NMGA3S+wxEtU4FxjAryGI+MZZ1uyye2zc4q4GTw2ZSBtgoQk1X/CBUYR7/xxhupdpiEfoeHDx/eUsvGADsnJ+eH4pTVlCdL5nmoYPDK4FYHqdAd74Iui2CbJ6lGZ8+e/Y0cB3N4l7olcd6V8E/j4UH3Q90q/d6zZ89v69OcOj0xEE5Cm3d0mylTpvCQEGmeqqpzc6zJI1aeXn0+4xbVbOcxrujltbzkI29zzVtRjxGgWcZlnLkyZF1IxGRlon+EkNcW3sKryiMBuHlQ6nlsERMZGqjVqOM6fdEYMG5sQ8btttchb96T+Y07Iz8WzlJ6aQTK30OwfkrJbxufHILGzbAVZgcxv6t5Hb416oDbNnQYFDfHZdga7eoEx7YwbMj41GAb5bZQvCfMdbjlsA3ahsG9Yept43rc/G5mfnIwr+CDxhw0uM0Pg+V8Fy1aVB9bVVdso+0E6EJCLq3kUgfwVveblAZNBDzbMZ7ksEVOhjf7a3R0dHmMqEBzTwDHquKTg7caH0mdPnnITy6eMONUe6si6WQp0skjSNf7DbIM8hlk1pv9ndpIXk5tdXlAkayTc3Fqx60oJj8/f6K6CHsP+ZpqiwvoewxjvgHVT5PkJ2XzOcgcUFtnImKXYXKr5qUmtx9jfCmzk358YcY1xww4yBmOl9Sdp7pb1TftFxPL+C7lEfcmZV/D13+vOFrrb0p6pQeNLTb4KPx9UN2v499E4FjGf0chh3jrP/37h3k3I2PAskfplxUXOFX/xOQNE5h/XYAN95PWI/WTXLWA4yY3VbrKXOC4yQWOm/5r6R8CDACY8b9YDye80gAAAABJRU5ErkJggg=='
	},
	hosted : false,
	adapter : '',
	flash : null,
	canvas : null,
	svg : null,
	vml : null,
	move : false,
	objmove : false,
	compat : function() {
		ZC.flash = ZC.canvas = ZC.svg = ZC.vml = false;
		var bCanvasSupport = !!document.createElement('canvas').getContext, bCanvasTextSupport = false;
		if (bCanvasSupport) {
			var oContext = document.createElement('canvas').getContext('2d');
			bCanvasTextSupport = (typeof oContext.fillText === 'function');
		}
		ZC.canvas = bCanvasSupport && bCanvasTextSupport;
		ZC.svg = document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1');

		var oElement = document.body.appendChild(document.createElement('div'));

		var oChild = document.createElement('zcv:shape');
		oChild.className = 'zcvml';
		oChild.setAttribute('id', 'vml_flag1');
		oChild.setAttribute('adj', new Object());
		oElement.appendChild(oChild);
		

		oChild.style.behavior = 'url(#default#VML)';
		ZC.vml = oChild?(typeof(oChild.adj)==='object'):true;
		oElement.parentNode.removeChild(oElement);

		var bFlash = false;
		if (navigator.mimeTypes && navigator.mimeTypes['application/x-shockwave-flash']) {
			bFlash = navigator.mimeTypes['application/x-shockwave-flash'].enabledPlugin;
		} else if (document.all && (navigator.appVersion.indexOf('Mac') === -1)) {
 			bFlash = (new Function('try { var xObj = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if (xObj) { xObj = null; return true; } } catch (e) { return false; }'))();
		}
		ZC.flash = bFlash?1:0;
	},
	quirks : (function() {
		return !(document.compatMode && document.compatMode==='CSS1Compat');
	})(),
	ie67 : (function() {
		if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
 			return (parseFloat(RegExp.$1) < 8);
		} else {
			return false;
		}
	})(),
	ie678 : (function() {
		if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) {
 			return (parseFloat(RegExp.$1) < 9);
		} else {
			return false;
		}
	})(),
	mobile : (function() {
		return /Mobile|BlackBerry|Opera Mini|PPC|Windows CE|Android/.test(navigator.userAgent);
	})(),
	ipad : (function() {
		return /iPad/.test(navigator.userAgent);
	})(),
	iphone : (function() {
		return /iPhone/.test(navigator.userAgent);
	})(),
	websockets : (function() {
		return ('WebSocket' in window);
	})(),
	webstorage : (function() {
		return ('sessionStorage' in window);
	})(),
	aModules : [],
	aLoadedModules : [],
	
	aPageXY : [0,0],
	sLastGuideId : null,
	
	_cp_ : function(o1, o2, bOverwrite, bRecursive, bConcatenate, skip) {
		if (ZC._n_(bOverwrite) === null) { bOverwrite = true; }
		if (ZC._n_(bRecursive) === null) { bRecursive = true; }
		if (ZC._n_(bConcatenate) === null) { bConcatenate = false; }
		skip = skip || [];
		var skiplen = skip.length;
		for (var k in o1) {
			if (skiplen === 0 || (skiplen > 0 && ZC._indexof_(skip, k) === -1)) {
				if (o1[k] instanceof Array) {
					if (bRecursive) {
						if (ZC._n_(o2[k]) === null || (k !== 'override' && !bConcatenate)) {
							o2[k] = [];
						}
						for (var i=0,iLen=o1[k].length;i<iLen;i++) {
							o2[k].push(o1[k][i]);
						}
					}
				} else if ((o1[k] instanceof Object) && !(o1[k] instanceof Function)) {
					if (bRecursive) {
						if (ZC._n_(o2[k]) === null) {
							o2[k] = {};
						}
						ZC._cp_(o1[k], o2[k], bOverwrite);
					}
				} else {
					if (ZC._n_(o2[k]) === null || bOverwrite) {
						o2[k] = o1[k];
					}
				}
			}
		}
	},
	_cpa_ : function(s, d) {
		if (!d) {
			d = [];
		}
		
		for (var i=0,iLen=s.length;i<iLen;i++) {
			d.push(s[i]);
		}
	},
	_todash_ : function(o, r, skip) {
		if (typeof(r) === 'undefined') {
			r = true;
		}
		skip = skip || [];
		var skiplen = skip.length, i, iLen;
		for (var k in o) {
			if (o.hasOwnProperty(k) && (skiplen === 0 || (skiplen > 0 && ZC._indexof_(skip, k) === -1))) {
				
				var kf = k.substring(0, 1);
				if (kf !== '.' && kf !== '#') {
					if (o[k] instanceof Array) {
						if (ZC._dash_(k) !== k) {
							o[ZC._dash_(k)] = [];
							for (i=0,iLen=o[k].length;i<iLen;i++) {
								ZC._todash_(o[k][i]);
								o[ZC._dash_(k)].push(o[k][i]);
							}
							delete(o[k]);
						} else {
							for (i=0,iLen=o[k].length;i<iLen;i++) {
								ZC._todash_(o[k][i]);
							}
						}
					} else if ((o[k] instanceof Object) && !(o[k] instanceof Function)) {
						if (ZC._dash_(k) !== k) {
							o[ZC._dash_(k)] = {};
							ZC._cp_(o[k], o[ZC._dash_(k)]);
							delete(o[k]);
						}
						if (r) {
							ZC._todash_(o[ZC._dash_(k)], r, skip);
						}
					} else {
						if (ZC._dash_(k) !== k) {
							o[ZC._dash_(k)] = o[k];
							delete(o[k]);
						}
					}
				}
			}
		}
	},
	_from_output_ : function(o, out) {
		for (var k in o) {
			if (o.hasOwnProperty(k)) {
				var k_;
				if ((k_=k.replace(out+'-', '')) !== k) {
					o[k_] = o[k];
					if (o[k] instanceof Array) {
						for (var i=0,iLen=o[k].length;i<iLen;i++) {
							ZC._from_output_(o[k][i], out);
						}
					} else if ((o[k] instanceof Object) && !(o[k] instanceof Function)) {
						ZC._from_output_(o[k], out);
					}
				}
			}
		}
	},
	_obfuscate_ : function(sOriginal) {
		var sCopy = '';
		for (var i=0,iLen=sOriginal.length;i<iLen;i++) {
			var iPos_ = (i%2===0)?i:(sOriginal.length-i);
			var sChar = sOriginal.substring(iPos_, iPos_+1);
			sCopy += sChar;
		}
		sCopy = sCopy.replace(/\./g, 'd');
		return sCopy;
	},
	_get_key_ : function(sOriginal) {
		var sCopy = sOriginal;
		sCopy = sCopy.replace('*', '&');
		sCopy = sCopy.replace('9', '3');
		sCopy = sCopy.replace('l', '1');
		return sCopy;
	},
	_rot13_ : function(sOriginal) {
		var sRot13 = sOriginal.replace(/[a-zA-Z]/g,
			function(c) {
				return String.fromCharCode((c<='Z'?90:122)>=(c=c.charCodeAt(0)+13)?c:c-26);
			}
		);
		return sRot13;
	},
	_tea_decrypt_ : function(sVal, sKey) {
		var v = ZC._chars_to_longs_(ZC._hex_to_chars_(sVal));
		var k = ZC._chars_to_longs_(ZC._str_to_chars_(sKey));
		var n = v.length;
		if (n === 0) { return ''; }
		var z = v[n-1], y = v[0], mValue = 0x9E3779B9;
		var mx, e, q = Math.floor(6 + 52/n), mValue_ = q*mValue;
		while (mValue_ !== 0) {
			e = mValue_>>>2 & 3;
			for(var p = n-1; p > 0; p--){
				z = v[p-1];
				mx = (z>>>5^y<<2)+(y>>>3^z<<4)^(mValue_^y)+(k[p&3^e]^z);
				y = v[p] -= mx;
			}
			z = v[n-1];
			mx = (z>>>5^y<<2)+(y>>>3^z<<4)^(mValue_^y)+(k[p&3^e]^z);
			y = v[0] -= mx;
			mValue_ -= mValue;
		}
		
		return decodeURIComponent(ZC._chars_to_str_(ZC._longs_to_chars_(v)));
	},
	_tea_encrypt_ : function(sVal, sKey) {
		
		sVal = encodeURIComponent(sVal);
		var v = ZC._chars_to_longs_(ZC._str_to_chars_(sVal));
		var k = ZC._chars_to_longs_(ZC._str_to_chars_(sKey));
		var n = v.length;
		if (n === 0) { return ''; }
		if (n === 1) { v[n++] = 0; }
		var z = v[n-1], y = v[0], mValue = 0x9E3779B9;
		var mx, e, q = Math.floor(6+52/n), sum = 0;
		while (q-- > 0) {
			sum += mValue;
			e = sum>>>2 & 3;
			for (var p = 0; p<n-1; p++) {
				y = v[p+1];
				mx = (z>>>5^y<<2)+(y>>>3^z<<4)^(sum^y)+(k[p&3^e]^z);
				z = v[p] += mx;
			}
			y = v[0];
			mx = (z>>>5^y<<2)+(y>>>3^z<<4)^(sum^y)+(k[p&3^e]^z);
			z = v[n-1] += mx;
		}
		return ZC._chars_to_hex_(ZC._longs_to_chars_(v));
	},
	_chars_to_longs_ : function(aChars) {
		var aValue = new Array(Math.ceil(aChars.length/4));
		for (var i = 0; i<aValue.length; i++) {
			aValue[i] = aChars[i*4] + (aChars[i*4+1]<<8) + (aChars[i*4+2]<<16) + (aChars[i*4+3]<<24);
		}
		return aValue;
	},
	_longs_to_chars_ : function(aChars) {
		var aValue = [];
		for (var i=0;i<aChars.length;i++) {
			aValue.push(aChars[i] & 0xFF, aChars[i]>>>8 & 0xFF, aChars[i]>>>16 & 0xFF, aChars[i]>>>24 & 0xFF);
		}
		return aValue;
	},
	_chars_to_hex_ : function(aChars) {
		var sVal = '';
		var aHex = ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];
		for (var i=0;i<aChars.length;i++) {
			sVal += aHex[aChars[i] >> 4] + aHex[aChars[i] & 0xf];
		}
		return sVal;
	},
	_hex_to_chars_ : function(aChars) {
		var aValue = [];
		for (var i = (aChars.substr(0, 2) === '0x') ? 2 : 0; i<aChars.length; i+=2) {
			aValue.push(parseInt(aChars.substr(i, 2), 16));
		}
		return aValue;
	},
	_chars_to_str_ : function(aChars) {
		var sValue = '';
		for (var i=0;i<aChars.length;i++) {
			if (aChars[i] !== 0){
				sValue += String.fromCharCode(aChars[i]);
			}
		}
		return sValue;
	},
	_str_to_chars_ : function(aChars) {
		var aValue = [];
		for (var i=0;i<aChars.length;i++) {
			aValue.push(aChars.charCodeAt(i));
		}
		return aValue;
	},
	_i_ : function(mValue) {
		if (String(mValue).indexOf('e-') !== -1) {
			return 0;
		}
		mValue = String(mValue).replace(/[^0-9\.\-]/gi, '');
		if (mValue === '') {
			return 0;
		}
		return Math.round(mValue);
	},
	_f_ : function(mValue) {
		mValue = parseFloat(mValue);
		return isNaN(mValue)?0:mValue;
	},
	_x_ : function(mValue, iDecimals) {
		if (typeof(iDecimals) === 'undefined') {
			iDecimals = 2;
		}
		return parseFloat(Number(mValue).toFixed(iDecimals));
	},
	_a_ : function(mValue) {
		return Math.abs(mValue);
	},
	_b_ : function(mValue) {
		if (mValue === 'false' || mValue === '0') { return false; }
		if (mValue === 'true' || mValue === '1') { return true; }
		return mValue && true;
	},
	_p_ : function(mValue) {
		mValue = String(mValue).replace(/[^0-9\.\%]/gi, '');
		var p = mValue.indexOf('%');
		if (p !== -1) {
			mValue = mValue.substring(0, p);
			mValue = ZC._f_(mValue)/100;
		}
		return mValue;
	},
	_h_ : function(sHtml) {
		return window.toStaticHTML?window.toStaticHTML(sHtml):sHtml;
	},
	_n_ : function(v) {
		return (v===null || typeof(v)==='undefined')?null:v;
	},
	_dimension_ : function(mValue, bAllowNegative) {
		if ((ZC._f_(mValue) + '') === (mValue + '')) {
			return bAllowNegative?ZC._f_(mValue):ZC._a_(mValue);
		} else {
			mValue = mValue + '';
			if (mValue.indexOf('%') !== -1) {
				return ZC._f_(mValue.replace('%', ''))/100;
			} else if (mValue.indexOf('px') !== -1) {
				return ZC._f_(mValue.replace('px', ''));
			} else {
				return ZC._f_(mValue);
			}
		}
	},
	_hex2int_ : function(mValue) {
		return parseInt(mValue, 16);
	},
	_int2hex_ : function(mValue) {
		return (ZC._i_(mValue)).toString(16);
	},
	_r_ : function(m, M) {
		return parseInt(m + (M-m)*Math.random(), 10);
	},
	_l_ : function(v, m, M) {
		v = v<m?m:v;
		v = v>M?M:v;
		return v;
	},
	_btw_ : function(v, m, M) {
		return (m<=v && v<=M) || (M<=v && v<=m);
	},
	_max_ : function(mValue1, mValue2) {
		return Math.max(mValue1, mValue2);
	},
	_min_ : function(mValue1, mValue2) {
		return Math.min(mValue1, mValue2);
	},
	
	_max_a_ : function(aValues) {
		for (var i=0,iLen=aValues.length,fMax=-Number.MAX_VALUE;i<iLen;i++) {
			fMax = Math.max(fMax, aValues[i]);
		}
		return fMax;
	},
	_min_a_ : function(aValues) {
		for (var i=0,iLen=aValues.length,fMin=Number.MAX_VALUE;i<iLen;i++) {
			fMin = Math.min(fMin, aValues[i]);
		}
		return fMin;
	},
	_rcolor_ : function() {
		var h = (Math.random()*0xFFFFFF+1<<0).toString(16);
		while (h.length < 6) { h = '0' + h; }
		return '#' + h;
	},
	_closest_a_ : function(aValues, mValue) {
		var fValue = ZC._f_(mValue);
		var fMinDiff = Number.MAX_VALUE, iIndex = 0, fDiff;
		for (var i=0,iLen=aValues.length;i<iLen;i++) {
			fDiff = Math.abs(ZC._f_(aValues[i]) - fValue);
			if (fDiff < fMinDiff) {
				iIndex = i;
				fMinDiff = fDiff;
			}
		}
		return iIndex;
	},
	_ext_ : function(sFile) {
		var aTokens = sFile.split('.');
		return aTokens[aTokens.length-1] || '';
	},
	_trim_ : function(sValue) {
		return sValue.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
	},
	_log_ : function(fValue, fBase) {
		fBase = fBase || Math.E;
		if (isFinite(Math.log(fValue)/Math.log(fBase))) {
			return Math.log(fValue)/Math.log(fBase);
		} else {
			return 0;
		}
	},
	_deg_ : function(fAngle) {
		return (fAngle*360)/(2*Math.PI);
	},
	_rad_ : function(iAngle) {
		return (iAngle*2*Math.PI)/360;
	},
	_cos_ : function(iAngle) {
		return Math.cos(ZC._rad_(iAngle));
	},
	_sin_ : function(iAngle) {
		return Math.sin(ZC._rad_(iAngle));
	},
	_isnumber_ : function(mValue) {
		return !isNaN(parseFloat(mValue)) && isFinite(mValue);
	},
	_camelcase_ : function(sAttribute) {
		if (sAttribute.indexOf('-') !== -1) {
			return sAttribute.replace(/(\-[a-z0-9])/g, function($1) { return $1.toUpperCase().replace('-', ''); });
		}
		return sAttribute;
	},
	_dash_ : function(sAttribute) {
		
		if (sAttribute.toUpperCase() !== sAttribute) {
			if (sAttribute.indexOf('-') === -1) {
				
				if (sAttribute.substring(0, 1).toLowerCase() === sAttribute.substring(0, 1)) {
					return sAttribute.replace(/([A-Z0-9])/g, function($1) {return '-' + $1.toLowerCase(); }).replace('-3d', '3d');
				}
			}
		}
		return sAttribute;
	},
	_md5_ : function(sValue) {
		return ZC.ZCMD5.md5(sValue);
	},
	_id_ : function(sId) {
		return document.getElementById(sId);
	},
	_token_sort_ : function(a, b) {
		if (a[0].length < b[0].length) {
			return 1;
		} else if (a[0].length > b[0].length) {
			return -1;
		} else {
			return 0;
		}
	},
	_delay_ : function(oFunction) {
		
		window.setTimeout(oFunction, zingchart.TIMEOUT);
	},
	_fixed_ : function(n, d) {
		return (d>=0 && d<=20)?n.toFixed(d):(''+n);
	}
};

ZC.MAPTX = 0;

window.JSON = window.JSON || {};


JSON.stringify = JSON.stringify || function(mObject) {
	var sType = typeof(mObject);
	if (sType !== 'object' || mObject === null) {
		if (sType === 'string') {
			mObject = '"' + mObject.replace('\\', '\\\\').replace('"', '\"') + '"';
		}
		return String(mObject);
	} else {
		var n, v, aJson=[], bArray=(mObject && mObject.constructor === Array);
		for (n in mObject) {
			if (typeof(mObject[n]) !== 'function') {
				v = mObject[n];
				sType = typeof(v);
				if (sType === 'string') {
					v = '"' + v.replace('\\', '\\\\').replace('"', '\\"') + '"';
				} else if (sType === 'object' && v !== null) {
					v = JSON.stringify(v);
				}
				aJson.push((bArray?'':'"' + n + '":') + String(v));
			}
		}
		return (bArray?'[':'{') + String(aJson) + (bArray?']':'}');
	}
};
JSON.parse = JSON.parse || function(sJson) {
	if (sJson === '') {
		sJson = '""';
	}
	return eval('('+sJson+')');
};












(function(){
var bInit = false;
var oTest = /xyz/.test(function(){xyz;}) ? /\b_super\b/ : /.*/;

ZC.Class = function(){};
ZC.Class.extend = function(oProperties) {
	var _super = this.prototype;
	bInit = true;
	var oPrototype = new this();
	bInit = false;
	for (var sName in oProperties) {
		oPrototype[sName] = typeof oPrototype[sName] === 'function' &&
		typeof _super[sName] === 'function'
		&& oTest.test(oProperties[sName])
		?
		(function(sName, oFunction){
			return function() {
				var oTmp = this._super;
				this._super = _super[sName];
				var oReturn = oFunction.apply(this, arguments);
				this._super = oTmp;
				return oReturn;
			};
		})(sName, oProperties[sName]) :
		oProperties[sName];
	}
	function Class() {
		if (!bInit && this.init) {
			this.init.apply(this, arguments);
		}
	}
	Class.prototype = oPrototype;
	Class.constructor = Class;
	Class.extend = arguments.callee;
	return Class;
};
})();









ZC.ZCDefaults = function() {
	this.findPalette = function(iIndex, sChartType) {
		var self = this, sRGB1;
		var oSet = self.oDefaults['palette'];
		if (ZC._n_(sChartType) !== null && ZC._n_(oSet[sChartType]) !== null) {
			oSet = oSet[sChartType];
		}
		if (ZC._n_(oSet[iIndex]) !== null) {
			var oPalette = oSet[iIndex];
			if (ZC._n_(oPalette[2]) === null) {
				oPalette[2] = ZC.ZCUtils._lighten_(oPalette[1], 10);
			}
			if (ZC._n_(oPalette[3]) === null) {
				oPalette[3] = ZC.ZCUtils._lighten_(oPalette[1], 10);
			}
			return oPalette;
		} else {
			var aColors = ['#B4A500', '#421E52', '#4C5A7F', '#741740', '#B89F33', '#E56000', '#95001F', '#43A200', '#CA0000', '#4A6744', '#9A78C5', '#A9DB00', '#FFCE0A', '#B4C0CB'];
			if (ZC._n_(aColors[iIndex-self.oDefaults['palette'].length]) !== null) {
				sRGB1 = aColors[iIndex-self.oDefaults['palette'].length];
			} else {
				sRGB1 = '#' + ZC.ZCMD5.md5(iIndex).substr(iIndex%20, 6);
			}
			var sRGB2 = ZC.ZCUtils._lighten_(sRGB1, 10);
			var sRGB3 = ZC.ZCUtils._lighten_(sRGB1, 20);
			var sRGB0 = '#FFF';
			if (self.oDefaults['palette'] && self.oDefaults['palette'][0] && self.oDefaults['palette'][0][0]) {
				sRGB0 = self.oDefaults['palette'][0][0];
			}
			return [sRGB0, sRGB1, sRGB2, sRGB3];
		}
	};
	this.loadDefaults = function(oDefaults) {
		ZC._cp_(oDefaults, this.oDefaults, true);
	};
	this.loadTheme = function(sTheme) {
		var self = this;
		if (ZC._n_(self.oThemes[sTheme]) !== null) {
			ZC._todash_(self.oThemes[sTheme]);
			ZC._cp_(self.oThemes[sTheme], self.oDefaults);
		}
	};
	this.oThemes = {};
	ZC._cp_(zingchart.THEMES, this.oThemes);
	this.oThemes.zingchart = {
		palette : [
			
			['#fff', '#6a921f', '#a7da47', '#89b92e'],
			['#fff', '#007fa3', '#00b0e1', '#0392bb'],
			['#fff', '#a62b02', '#ef4810', '#cc3300'],
			['#fff', '#b79007', '#f9c332', '#da9b04'],
			['#fff', '#563d02', '#84680a', '#6e4503'],
			['#fff', '#0b32a0', '#4d62b1', '#1540a0']
		],
		graph : {
			refresh : {
				curtain : {
					alpha : 0.5,
					backgroundColor : '#999',
					color : '#000',
					fontSize : 15,
					bold : 1,
					text : 'Loading...'
				}
			},
			backgroundColor : '#e1eaec #edf3f5',
			title : {
				fontSize : 14,
				bold : 1,
				color : '#fff',
				backgroundColor : '#00bbf1 #05a0cd',
				padding : 6
			},
			subtitle : {
				fontSize : 11,
				bold : 1,
				color : '#333',
				marginTop : 30,
				padding : 6
			},
			source : {
				fontSize : 10,
				color : '#333',
				width : '100%',
				bold : 1,
				textAlign : 'right',
				height : 20,
				margin : 'auto 0 0 auto',
				padding : 5
			},
			nodata : {
				fontSize : 12,
				color : '#333',
				textAlign : 'center',
				verticalAlign : 'middle',
				text : ''
			},
			SCALE : {
				fontSize : 11,
				lineWidth : 2,
				lineColor : '#3e6c7b',
				item : {
					flat : true
				},
				refLine : {
					lineWidth : 1,
					lineColor : '#3e6c7b'
				},
				guide : {
					visible : 1,
					lineWidth : 1,
					lineStyle : 'dashed',
					lineColor : '#2c4a59',
					alpha : 0.2
				},
				minorGuide : {
					visible : 1,
					lineWidth : 1,
					lineStyle : 'dotted',
					lineColor : '#aaa',
					alpha : 0.1
				},
				tick : {
					visible : 1,
					size : 6,
					placement : 'outer',
					lineWidth : 2,
					lineColor : '#3e6c7b'
				},
				minorTick : {
					visible : 1,
					size : 4,
					lineWidth : 1,
					lineColor : '#3e6c7b'
				},
				label : {
					color : '#2c4a59'
				}
			},
			legend : {
				backgroundColor : '#fff',
				borderWidth : 1,
				alpha : 0.75,
				borderAlpha : 0.75,
				borderColor : '#666',
				shadowDistance : 3,
				header : {
					padding : '4 6',
					color : '#fff',
					borderWidth : 1,
					borderColor : '#3e6c7b',
					backgroundColor : '#3e6c7b'
				},
				footer : {
					padding : '2 6',
					backgroundColor : '#ccc',
					borderWidth : 1,
					borderColor : '#666'
				},
				marker : {
					borderColor : '#333',
					borderWidth : 1
				}
			},
			plot : {
				valueBox : {
					flat : true
				},
				marker : {
					shadow : 1,
					lineWidth : 1,
					borderWidth : 1
				},
				hoverMarker : {
					lineWidth : 1,
					borderWidth : 1
				}
			},
			guide : {
				lineWidth : 1,
				lineColor : '#999',
				alpha : 1,
				scaleLabel : {
					text : '%l',
					padding : '3 6'
				},
				plotLabel : {
					padding : '3 6'
				}
			}
		},
		line : {
			plot : {
				shadowAlpha : 0.5,
				marker : {
					size : 4
				},
				hoverMarker : {
					size : 5
				}
			}
		},
		area : {
			plot : {
				shadowAlpha : 0.5,
				marker : {
					size : 4
				},
				hoverMarker : {
					size : 5
				}
			}
		},
		vbar : {
			plot : {
				fillAngle : 90,
				shadow : 0
			}
		},
		hbar : {
			plot : {
				fillAngle : 180,
				shadow : 0
			}
		},
		piano : {
			plot : {
				shadow : 0
			}
		},
		stock : {
			plot : {
				shadow : 0
			}
		},
		vbullet : {
			plot : {
				shadow : 0
			}
		},
		hbullet : {
			plot : {
				fillAngle : 0,
				shadow : 0
			}
		},
		scatter : {
			plot : {
				marker : {
					size : 4
				},
				hoverMarker : {
					size : 5
				}
			}
		},
		hscatter : {
			plot : {
				marker : {
					size : 4
				},
				hoverMarker : {
					size : 5
				}
			}
		},
		bubble : {
			plot : {
				marker : {
					borderWidth : 0
				},
				hoverMarker : {
					borderWidth : 0
				}
			}
		},
		hbubble : {
			plot : {
				marker : {
					borderWidth : 0
				},
				hoverMarker : {
					borderWidth : 0
				}
			}
		},
		pie : {
			plot : {
				borderWidth : 1
			}
		},
		nestedpie : {
			plot : {
				borderWidth : 1
			}
		},
		radar : {
			plot : {
				marker : {
					size : 3
				},
				hoverMarker : {
					size : 4
				}
			},
			scaleK : {
				guide : {
					alpha : 0.5,
					backgroundColor:'#eee #ddd'
				}
			}
		},
		gauge : {
			scaleR : {
				backgroundColor : '-1',
				guide : {
					alpha : 0.5,
					backgroundColor:'#eee #ddd'
				},
				ring : {
					size : 1,
					items : [
						{
							backgroundColor : '#999',
							alpha : 0.8
						},
						{
							backgroundColor : '#666',
							alpha : 0.8
						}
					]
				}
			}
		},
		vfunnel : {
			plotarea : {
				margin : '50 100'
			},
			SCALE : {
				lineWidth : 0,
				tick : {
					lineWidth : 0
				},
				minorTick : {
					lineWidth : 0
				},
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				}
			},
			scaleY : {
				guide : {
					alpha : 0.25,
					backgroundColor : '-1 #b6c8cf'
				}
			},
			scaleYN : {
				guide : {
					alpha : 0.25,
					backgroundColor : '-1 #b6c8cf'
				}
			},
			plot : {
				borderWidth : 1
			}
		},
		hfunnel : {
			plotarea : {
				margin : '50 100'
			},
			scaleX : {
				label : {
					fontAngle : 270
				}
			},
			scaleXN : {
				label : {
					fontAngle : 90
				}
			},
			SCALE : {
				lineWidth : 0,
				tick : {
					lineWidth : 0
				},
				minorTick : {
					lineWidth : 0
				},
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				}
			},
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				},
				guide : {
					alpha : 0.25,
					backgroundColor : '#b6c8cf -1'
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				},
				guide : {
					alpha : 0.25,
					backgroundColor : '#b6c8cf -1'
				}
			},
			plot : {
				borderWidth : 1
			}
		},
		range : {
			plot : {
				marker : {
					type : 'circle',
					size : 4
				},
				hoverMarker : {
					size : 5
				}
			}
		},
		line3d : {
			SCALE : {
				lineColor : '#ddd'
			},
			plot : {
				lineWidth : 1
			}
		},
		area3d : {
			SCALE : {
				lineColor : '#ddd'
			},
			plot : {
				lineWidth : 1
			}
		},
		mixed3d : {
			SCALE : {
				lineColor : '#ddd'
			},
			plot : {
				borderWidth : 1
			}
		},
		vbar3d : {
			SCALE : {
				lineColor : '#ddd'
			},
			plot : {
				borderWidth : 1
			}
		},
		hbar3d : {
			SCALE : {
				lineColor : '#ddd'
			},
			plot : {
				borderWidth : 1
			}
		},
		pie3d : {
			plot : {
				borderWidth : 1
			}
		},
		'-' : ''
	};
	this.oThemes.zingchart.graph.crosshairX = this.oThemes.zingchart.graph.crosshairY = this.oThemes.zingchart.graph.guide;
	ZC._todash_(this.oThemes.zingchart);
	this.oThemes.mini = {
		graph : {
			title : {
				width : '100%',
				padding : '1 2 2',
				fontSize : 10
			},
			subtitle : {
				width : '100%',
				padding : '1 2 2',
				marginTop : 14,
				fontSize : 9
			},
			plotarea : {
				width : '100%',
				height : '100%',
				margin : '12 5 5 5'
			},
			SCALE : {
				visible : 0
			},
			tooltip : {
				visible : 0
			},
			legend : {
				visible : 0
			},
			plot : {
				shadow : 0,
				valueBox : {
					visible : 0
				}
			}
		},
		line : {
			plot : {
				lineWidth : 1
			}
		},
		area : {
			plot : {
				lineWidth : 1
			}
		},
		scatter : {
			SCALE : {
				offsetStart : 5,
				offsetEnd : 5
			}
		},
		hscatter : {
			SCALE : {
				offsetStart : 5,
				offsetEnd : 5
			}
		},
		bubble : {
			SCALE : {
				offsetStart : 5,
				offsetEnd : 5
			}
		},
		hbubble : {
			SCALE : {
				offsetStart : 5,
				offsetEnd : 5
			}
		},
		pie : {
			plotarea : {
				margin : '5 5 5 5'
			},
			plot : {
				valueBox : {
					visible : 0
				}
			},
			scale : {
				sizeFactor : 0.9
			}
		},
		pie3d : {
			plotarea : {
				margin : '15 5 5 5'
			},
			plot : {
				valueBox : {
					visible : 0
				}
			},
			scale : {
				sizeFactor : 0.9
			}
		},
		nestedpie : {
			plotarea : {
				margin : '15 5 5 5'
			},
			plot : {
				valueBox : {
					visible : 0
				}
			},
			scale : {
				sizeFactor : 0.9
			}
		},
		venn : {
			plotarea : {
				margin : '15 5 5 5'
			},
			scale : {
				sizeFactor : 0.9
			}
		},
		range : {
			plot : {
				lineWidth : 1
			}
		},
		'-' : ''
	};
	ZC._todash_(this.oThemes.mini);
	this.oThemes.negative = {
		palette : [
			['#000', '#909090', '#969696', '#9c9c9c'],
			['#000', '#a0a0a0', '#a6a6a6', '#acacac'],
			['#000', '#b0b0b0', '#b6b6b6', '#bcbcbc'],
			['#000', '#c0c0c0', '#c6c6c6', '#cccccc'],
			['#000', '#d0d0d0', '#d6d6d6', '#dcdcdc'],
			['#000', '#e0e0e0', '#e6e6e6', '#ececec'],
			['#000', '#f0f0f0', '#f6f6f6', '#fcfcfc']
		],
		graph : {
			backgroundColor : '#111',
			title : {
				color : '#fff'
			},
			subtitle : {
				color : '#333'
			},
			SCALE : {
				fontSize : 11,
				lineWidth : 2,
				lineColor : '#ccc',
				guide : {
					visible : 1,
					lineWidth : 1,
					lineStyle : 'dashed',
					lineColor : '#ccc',
					alpha : 0.2
				},
				minorGuide : {
					visible : 1,
					lineWidth : 1,
					lineStyle : 'dotted',
					lineColor : '#ccc',
					alpha : 0.2
				},
				tick : {
					visible : 1,
					size : 6,
					placement : 'outer',
					lineWidth : 2,
					lineColor : '#ccc'
				},
				minorTick : {
					visible : 1,
					size : 4,
					lineWidth : 1,
					lineColor : '#ccc'
				},
				label : {
					color : '#fff'
				},
				item : {
					color : '#fff'
				}
			}
		},
		radar : {
			scaleK : {
				guide : {
					alpha : 0.5,
					backgroundColor : '#222 #333'
				}
			}
		},
		'-' : ''
	};
	ZC._todash_(this.oThemes.negative);
	this.oThemes.spark = this.oThemes.mini;
	this.oDefaults = {
		root : {
			gui : {
				behaviors : [
					{
						id : 'ViewSource',
						enabled : 'all'
					},
					{
						id : 'BugReport',
						enabled : 'none'
					},
					{
						id : 'LogScale',
						enabled : 'all'
					},
					{
						id : 'LinScale',
						enabled : 'all'
					},
					{
						id : '3D',
						enabled : 'none'
					},
					{
						id : 'ExportData',
						enabled : 'none'
					},
					{
						id : 'SaveAsImageJPG',
						enabled : 'none'
					}
				],
				watermark : {
					type : 1,
					position : 'rb'
				},
				history : {
					margin : '10 auto auto 10',
					width : 30,
					height : 22,
					padding : 4,
					item : {
						backgroundColor : '#369',
						borderWidth : 1,
						borderColor : '#69c'
					},
					itemOff : {
						backgroundColor : '#eee',
						borderColor : '#ddd'
					}
				},
				progress : {
					backgroundColor : '#fff',
					color : '#000'
				},
				contextMenu : {
					padding : 0,
					borderWidth : 1,
					borderColor : '#000',
					button : {
						margin : '5 auto auto 5',
						alpha : 0.8,
						backgroundColor : '#333 #999',
						borderRadius : 8,
						width : 40,
						height : 40
					},
					gear : {
						backgroundColor : '#fff #f6f6f6',
						type : 'gear6',
						alpha : 0.8
					},
					item : {
						backgroundColor : '#36393D',
						textAlign : 'left',
						padding : '4 20 4 8',
						borderWidth : 1,
						borderColor : '#000',
						color : '#fff',
						hoverState : {
							backgroundColor : '#0084AA'
						}
					}
				},
				'contextMenu[mobile]' : {
					item : {
						padding : '6 10 6 6'
					}
				}
			}
		},
		palette : [
		],
		graph : {
			title : {
				width : '100%',
				bold : 1,
				fontSize : 13
			},
			subtitle : {
				width : '100%',
				bold : 1,
				fontSize : 11
			},
			scroll : {
				bar : {
					backgroundColor : '#e1eaec',
					borderColor : '#ddd'
				},
				handle : {
					backgroundColor : '#ddd',
					borderColor : '#ccc',
					borderWidth : 2,
					borderTop : '2px solid #eee',
					borderLeft : '2px solid #eee',
					borderRight : '2px solid #999',
					borderBottom : '2px solid #999'
				}
			},
			scrollX : {
				bar : {
					height : 16
				}
			},
			scrollY : {
				bar : {
					width : 16
				}
			},
			scrollXi : {
				bar : {
					width : 16
				}
			},
			scrollYi : {
				bar : {
					height : 16
				}
			},
			preview : {
				width : '100%',
				height : 50,
				margin : 'auto 50 15 50',
				borderWidth : 1,
				shadow : 0,
				backgroundColor : '#f0f0f0',
				borderColor : '#999',
				mask : {
					alpha : 0.5,
					backgroundColor : '#333'
				},
				active : {
					alpha : 0.1,
					backgroundColor : '#999'
				},
				handle : {
					width : 9,
					height : 16,
					borderWidth : 1,
					lineWidth : 1,
					lineColor : '#111',
					borderColor : '#444',
					borderRadius : 2,
					backgroundColor : '#e6e6e6'
				},
				handleTop : {
					width : 16,
					height : 9
				},
				handleBottom : {
					width : 16,
					height : 9
				}
			},
			plotarea : {
				width : '100%',
				height : '100%',
				margin : '60 50 65 50'
			},
			'plotarea[preview]' : {
				margin : '60 50 105 50'
			},
			SCALE : {
				lineWidth : 1,
				guide : {
					lineWidth : 1,
					lineColor : '#ddd'
				},
				tick : {
					size : 6,
					lineWidth : 2
				},
				minorGuide : {
					lineWidth : 1,
					lineColor : '#ddd'
				},
				minorTick : {
					size : 4,
					lineWidth : 1
				},
				label : {
					bold : 1,
					padding : 6
				},
				item : {
					padding : 2,
					autoAlign : true,
					flat : true
				},
				marker : {
					lineWidth : 1,
					lineColor : '#000',
					backgroundColor : '#ccc'
				},
				'transform[date]' : {
					item : {
						fontSize : 10,
						padding : 2,
						color : '#000',
						backgroundColor : '#fff'
					}
				}
			},
			'SCALE[3d]' : {
				backgroundColor : '#ccc'
			},
			'scaleY[default]' : {
				label : {
					fontAngle : 270
				},
				item : {
					textAlign : 'right'
				}
			},
			'scaleY[opposite]' : {
				label : {
					fontAngle : 90
				},
				item : {
					textAlign : 'left'
				}
			},

			plot : {
				error : {
					lineWidth : 1,
					lineColor : '#333',
					size : 0.5
				},
				valueBox : {
					flat : true,
					text : '%v',
					bold : 1,
					placement : 'auto',
					shadow : 1
				},
				tooltipText : '%v',
				shadow : 1,
				lineWidth : 1,
				marker : {
					type : 'square',
					shadow : 1
				},
				highlightState : {
					shadow : true,
					shadowBlur : 2,
					shadowDistance : 1,
					shadowAlpha : 0.91
				}
			},
			tooltip : {
				shadow : 1,
				padding : '4 8',
				shadowDistance : 3,
				offsetY : (ZC.mobile?-40:-20)
			},
			guide : {
				marker : {
					type : 'circle'
				},
				'plotLabel[single]' : {
					padding : 10,
					backgroundColor : '#fff #eee',
					borderWidth : 1,
					borderColor : '#999',
					color : '#000',
					align : 'left'
				}
			},
			zoom : {
				borderWidth : 0,
				backgroundColor : '#369',
				alpha : 0.25,
				label : {
					visible : false,
					backgroundColor : '#fff',
					fontSize : 10,
					padding : 2,
					borderWidth : 1,
					borderColor : '#999'
				}
			},
			arrow : {
				borderWidth : 1,
				borderColor : '#000',
				backgroundColor : '#666',
				size : 4
			},
			'legend[position]' : {
				margin : 10
			},
			legend : {
				backgroundColor : '#eee',
				alpha : 1,
				shadow : 1,
				margin : '10 10 auto auto',
				padding : '4 2 4 2',
				item : {
					textAlign : 'left',
					margin : '2 6 2 4',
					padding : '2 4'
				},
				itemOff : {
					alpha : 0.25
				},
				marker : {
					shadow : 0,
					size : 6,
					borderColor : '#999',
					borderWidth : 1
				},
				header : {
					textAlign : 'left',
					bold : 1
				},
				footer : {
					textAlign : 'left'
				},
				scroll : {
					bar : {
						backgroundColor : '#e1eaec',
						borderColor : '#ddd'
					},
					handle : {
						backgroundColor : '#ddd',
						borderColor : '#ccc',
						borderWidth : 2,
						borderTop : '2px solid #eee',
						borderLeft : '2px solid #eee',
						borderRight : '2px solid #999',
						borderBottom : '2px solid #999'
					}
				}
			}
		},
		vbar : {
			plot : {
				valueBox : {
					placement : 'top-out'
				}
			}
		},
		vbar3d : {
			plot : {
				valueBox : {
					placement : 'top-out'
				}
			},
			'3dAspect' : {
				depth : 40,
				angle : 45,
				xAngle : -20,
				yAngle : 0,
				zAngle : 0
			}
		},
		mixed3d : {
			'3dAspect' : {
				depth : 40,
				angle : 45,
				xAngle : -20,
				yAngle : 0,
				zAngle : 0
			}
		},
		hbar : {
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			'scaleX[default]' : {
				label : {
					fontAngle : 270
				}
			},
			'scaleX[opposite]' : {
				label : {
					fontAngle : 90
				}
			},
			plot : {
				valueBox : {
					placement : 'top-out'
				}
			}
		},
		vline : {
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			'scaleX[default]' : {
				label : {
					fontAngle : 270
				}
			},
			'scaleX[opposite]' : {
				label : {
					fontAngle : 90
				}
			}
		},
		varea : {
			plot : {
				fillAngle : 0
			},
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			'scaleX[default]' : {
				label : {
					fontAngle : 270
				}
			},
			'scaleX[opposite]' : {
				label : {
					fontAngle : 90
				}
			}
		},
		hbar3d : {
			scaleY : {
				label : {
					fontAngle : 0
				}
			},
			scaleX : {
				label : {
					fontAngle : 270
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				}
			},
			scaleXN : {
				label : {
					fontAngle : 90
				}
			},
			'3dAspect' : {
				depth : 40,
				angle : 45,
				xAngle : 0,
				yAngle : -20,
				zAngle : 0
			},
			plot : {
				valueBox : {
					placement : 'top-out'
				}
			}
		},
		hbullet : {
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleX : {
				label : {
					fontAngle : 270
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleXN : {
				label : {
					fontAngle : 90
				}
			}
		},
		line : {
			plot : {
				lineWidth : 4,
				marker : {
					type : 'circle',
					size : 4
				}
			}
		},
		area : {
			plot : {
				lineWidth : 4,
				marker : {
					type : 'circle',
					size : 4
				},
				valueBox : {
					placement : 'top'
				}
			}
		},
		line3d : {
			'3dAspect' : {
				depth : 40,
				angle : 45,
				xAngle : -20,
				yAngle : 0,
				zAngle : 0
			},
			plot : {
				lineWidth : 1,
				marker : {
					type : 'circle',
					size : 4,
					alpha : 0
				}
			}
		},
		area3d : {
			'3dAspect' : {
				depth : 40,
				angle : 45,
				xAngle : -20,
				yAngle : 0,
				zAngle : 0
			},
			plot : {
				lineWidth : 1,
				marker : {
					type : 'circle',
					size : 4,
					alpha : 0
				},
				valueBox : {
					placement : 'top'
				}
			}
		},
		scatter : {
			SCALE : {
				offsetStart : 10,
				offsetEnd : 10
			},
			plot : {
				marker : {
					type : 'circle',
					size : 4
				},
				valueBox : {
					placement : 'top'
				}
			}
		},
		poly : {
			SCALE : {
				offsetStart : 10,
				offsetEnd : 10
			},
			plot : {
				'alpha-area' : 0.4,
				marker : {
					type : 'none'
				},
				valueBox : {
					placement : 'top'
				}
			}
		},
		hscatter : {
			SCALE : {
				offsetStart : 10,
				offsetEnd : 10
			},
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleX : {
				label : {
					fontAngle : 270
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleXN : {
				label : {
					fontAngle : 90
				}
			},			
			plot : {
				marker : {
					type : 'circle',
					size : 4
				},
				valueBox : {
					placement : 'top'
				}
			}
		},
		bubble : {
			SCALE : {
				offsetStart : 40,
				offsetEnd : 40
			},
			plot : {
				marker : {
					type : 'circle',
					fillType : 'radial',
					fillOffsetX : -0.2,
					fillOffsetY : -0.2
				},
				hoverMarker : {
					fillType : 'radial',
					fillOffsetX : -0.2,
					fillOffsetY : -0.2
				},
				valueBox : {
					placement : 'middle'
				},
				tooltipText : '%node-size-value'
			}
		},
		hbubble : {
			SCALE : {
				offsetStart : 40,
				offsetEnd : 40
			},
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleX : {
				label : {
					fontAngle : 270
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleXN : {
				label : {
					fontAngle : 90
				}
			},			
			plot : {
				marker : {
					type : 'circle',
					fillType : 'radial',
					fillOffsetX : -0.2,
					fillOffsetY : -0.2
				},
				hoverMarker : {
					fillType : 'radial',
					fillOffsetX : -0.2,
					fillOffsetY : -0.2
				},
				valueBox : {
					placement : 'middle'
				},
				tooltipText : '%node-size-value'
			}
		},
		hmixed : {
			scaleY : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleX : {
				label : {
					fontAngle : 270
				}
			},
			scaleYN : {
				label : {
					fontAngle : 0
				},
				item : {
					textAlign : 'center'
				}
			},
			scaleXN : {
				label : {
					fontAngle : 90
				}
			}
		},
		pie : {
			plotarea : {
				margin : '35 5 5 5'
			},
			scale : {
				sizeFactor : 'auto',
				lineWidth : 0,
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				}
			},
			plot : {
				fillType : 'radial',
				valueBox : {
					connector : {
						lineWidth : 1
					},
					placement : 'out',
					text : '%t',
					visible : 1
				}
			}
		},
		pie3d : {
			'3dAspect' : {
				xAngle : 38,
				yAngle : 0,
				zAngle : 0
			},
			plotarea : {
				margin : '25 5 5 5'
			},
			scale : {
				sizeFactor : 'auto',
				lineWidth : 0,
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				}
			},
			plot : {
				fillType : 'linear',
				valueBox : {
					connector : {
						lineWidth : 1
					},
					placement : 'out',
					text : '%t',
					visible : 1
				}
			}
		},
		nestedpie : {
			plotarea : {
				margin : '40 5 15 5'
			},
			scale : {
				sizeFactor : 0.8,
				lineWidth : 0,
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				}
			},
			plot : {
				fillType : 'radial',
				valueBox : {
					connector : {
						lineWidth : 1
					},
					text : '%t',
					visible : 1
				}
			}
		},
		venn : {
			plotarea : {
				margin : '30 10 10 10'
			},
			plot : {
				alpha : 0.5,
				borderWidth : 4
			},
			scale : {
				sizeFactor : 0.65,
				lineWidth : 0,
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				}
			}
		},
		radar : {
			SCALE : {
				guide : {
					lineWidth : 1,
					lineColor : '#999',
					
					backgroundColor : '-1'
				},
				tick : {
					lineWidth : 1
				}
			},
			scale : {
				visible : 0,
				sizeFactor : 0.7
			},
			scaleK : {
				refAngle : 270
			},
			plotarea : {
				margin : '40 5 5 5'
			},
			plot : {
				lineWidth : 4,
				aspect : 'line',
				marker : {
					type : 'circle'
				}
 			}
		},
		gauge : {
			SCALE : {
				guide : {
					borderWidth : 1,
					borderColor : '#999',
					backgroundColor : '-1'
				}
			},
			scale : {
				lineWidth : 0,
				guide : {
					lineWidth : 0
				},
				minorGuide : {
					lineWidth : 0
				},
				sizeFactor : 0.7
			},
			scaleR : {
				refAngle : 270,
				backgroundColor : '#fff',
				guide : {
					lineWidth : 0
				},
				tick : {
					placement : 'inner'
				}
			},
			plotarea : {
				margin : '40 5 5 5'
			}
		},
		stock : {
			plot : {
				lineWidth : 1,
				borderWidth : 1
			}
		},
		range : {
			plot : {
				lineWidth : 4,
				valueBox : {
					text : '%node-min-value - %node-max-value'
				},
				tooltipText : '%node-min-value - %node-max-value'
			}
		},
		'-' : ''
	};
	ZC._todash_(this.oDefaults);

	this.featureEnabled = function(sFeature, sGraphType) {
		var self = this, mValue;
		var bFeature = false;
		if (ZC._n_(mValue=self.oDefaults['graph'][sFeature]) !== null) {
			if (ZC._n_(mValue['enabled']) !== null) {
				bFeature = bFeature || ZC._b_(mValue['enabled']);
			}
		}
		if (ZC._n_(self.oDefaults[sGraphType]) !== null && ZC._n_(mValue=self.oDefaults[sGraphType][sFeature]) !== null) {
			if (ZC._n_(mValue['enabled']) !== null) {
				bFeature = bFeature || ZC._b_(mValue['enabled']);
			}
		}
		return bFeature;
	};
	this.load = function(oData, mSection, bOverwrite, bRecursive) {
		var self = this, mValue, i, iLen;
		bOverwrite = (ZC._n_(bOverwrite)===null)?true:ZC._b_(bOverwrite);
		bRecursive = (ZC._n_(bRecursive)===null)?false:ZC._b_(bRecursive);
		if (!(mSection instanceof Array)) {
			mSection = new Array(mSection);
		}
		var mSection_ = [], sToken = '';
		for (i=0,iLen=mSection.length;i<iLen;i++) {
			if (/(\(\w+\))(.*)/.test(mSection[i])) {
				var sGraphType = RegExp.$1;
				sToken = mSection[i].replace(sGraphType, 'graph');
				if (ZC._indexof_(mSection_, sToken) === -1) {
					mSection_.push(sToken);
				}
				sToken = mSection[i].replace(sGraphType, sGraphType.substring(1, sGraphType.length-1));
				if (ZC._indexof_(mSection_, sToken) === -1) {
					mSection_.push(sToken);
				}
			} else {
				if (ZC._indexof_(mSection_, mSection[i]) === -1) {
					mSection_.push(mSection[i]);
				}
				
				if (/root(.*)/.test(mSection[i])) {
					if (ZC._indexof_(mSection_, mSection[i].replace('root', 'loader')) === -1) {
						mSection_.push(mSection[i].replace('root', 'loader'));
					}
				}
				if (/loader(.*)/.test(mSection[i])) {
					if (ZC._indexof_(mSection_, mSection[i].replace('loader', 'root')) === -1) {
						mSection_.push(mSection[i].replace('loader', 'root'));
					}
				}
			}
		}
		var oData_ = {};
		for (i=0,iLen=mSection_.length;i<iLen;i++) {
			var aPath = mSection_[i].split('.');
			var oDefaults_ = self.oDefaults;
			for (var p=0,pLen=aPath.length;p<pLen;p++) {
				if (ZC._n_(mValue=oDefaults_[aPath[p]]) !== null) {
					oDefaults_ = mValue;
				} else if (ZC._n_(mValue=oDefaults_[ZC._dash_(aPath[p])]) !== null) {
					oDefaults_ = mValue;
				} else if (ZC._n_(mValue=oDefaults_[ZC._camelcase_(aPath[p])]) !== null) {
					oDefaults_ = mValue;
				} else {
					oDefaults_ = null;
					break;
				}
			}
			if (oDefaults_) {
				for (var sKey in oDefaults_) {
					if (ZC._n_(oDefaults_[sKey]) !== null) {
						if (bRecursive || (typeof(oDefaults_[sKey]) !== 'object' || oDefaults_[sKey].length)) {
							if (bOverwrite || ZC._n_(oData[sKey]) === null) {
								oData_[sKey] = oDefaults_[sKey];
							} else {
								if (bOverwrite && typeof(oDefaults_[sKey]) === 'object') {
									oData_[sKey] = oDefaults_[sKey];
								}
							}
						}
					}
				}
			}
		}
		ZC._cp_(oData_, oData);
	};
};











ZC.ZCUtils = {
	
	_load_script_ : function(oLoader, sSrc, oCallback) {
		var oHead = document.getElementsByTagName('head')[0];
		var oScript = document.createElement('script');
		oScript.type = 'text/javascript';
		oScript.src = sSrc + '?v' + ZC.VERSION;
		var bReady = false;
		oScript.onload = oScript.onreadystatechange = function() {
			if (!bReady && (!this.readyState || this.readyState === 'loaded' || this.readyState === 'complete')) {
				bReady = true;
				oScript.onload = oScript.onreadystatechange = null;
				if (oHead && oScript.parentNode) {
					oHead.removeChild(oScript);
				}
				var aMatches = (new RegExp('zingchart\-(.+?)\.min.js', 'g')).exec(sSrc);
				if (aMatches) {
					ZC.aLoadedModules.push(aMatches[1]);
				}
				if (oCallback) {
					oCallback(sSrc);
				}
			}
		};
		oScript.onerror = function() {
			if (!oLoader && zingchart.aLoaders[0]) {
				oLoader = zingchart.aLoaders[0];
			}
			if (oLoader) {
				oLoader._api_error_({name : 'Network error', message : 'Resource not found (' + oScript.src + ')'}, 'Module loader');
			} else {
				alert('Resource not found (' + oScript.src + ')');
			}
		};
		oHead.insertBefore(oScript, oHead.firstChild);
	},
	
	
	_rcolor_ : function() {
		return '#' + ZC.ZCMD5.md5(ZC._r_(0,99999)).substr(ZC._r_(0, 20), 6);
	},
	_format_json_ : function() {
	},
	_check_event_ : function(sName, oLoader) {
		return zingchart[sName] || (oLoader && oLoader.oEvents && oLoader.oEvents[sName]) || zingchart.hasEvent(null, sName) || (oLoader && zingchart.hasEvent(oLoader.sId, sName));
	},
	_trigger_event_ : function(sName, oLoader, aArgs, oValue, oCallback) {
		if (!(aArgs instanceof Array)) {
			aArgs = [aArgs];
		}
		var iOffset = 1;
		if (oValue) {
			aArgs.push(oValue);
		}
		if (oCallback) {
			iOffset = 2;
			aArgs.push(oCallback);
		}
		if (sName === 'touchstart') { sName = 'mousedown'; }
		if (sName === 'touchend') { sName = 'mouseup'; }
		if (sName === 'touchmove') { sName = 'mousemove'; }
		if (zingchart[sName]) {
			if (oValue) {
				aArgs[aArgs.length-iOffset] = zingchart[sName].apply(zingchart, aArgs);
			} else {
				zingchart[sName].apply(zingchart, aArgs);
			}
		}
		if (oLoader && oLoader.oEvents[sName]) {
			if (oValue) {
				aArgs[aArgs.length-iOffset] = oLoader.oEvents[sName].apply(zingchart, aArgs);
			} else {
				oLoader.oEvents[sName].apply(zingchart, aArgs);
			}
		}
		if (zingchart.hasEvent(null, sName)) {
			if (oValue) {
				aArgs[aArgs.length-iOffset] = zingchart.callEvent(null, sName, aArgs, oValue);
			} else {
				zingchart.callEvent(null, sName, aArgs);
			}
		}
		if (oLoader && zingchart.hasEvent(oLoader.sId, sName)) {
			if (oValue) {
				aArgs[aArgs.length-iOffset] = zingchart.callEvent(oLoader.sId, sName, aArgs, oValue);
			} else {
				zingchart.callEvent(oLoader.sId, sName, aArgs);
			}
		}
		return aArgs[aArgs.length-iOffset];
	},
	_box_area_ : function(sGraphId, oLabel) {
		if (oLabel.iAngle%360 !== 0) {
			var aPoints = [
				[-oLabel.iWidth/2, -oLabel.iHeight/2],
				[oLabel.iWidth/2, -oLabel.iHeight/2],
				[oLabel.iWidth/2, oLabel.iHeight/2],
				[-oLabel.iWidth/2, oLabel.iHeight/2]
			];
			var sPoly = '';
			for (var j=0;j<4;j++) {
				aPoints[j] = [
					oLabel.iX + oLabel.iWidth/2 + oLabel.iOffsetX + ZC.MAPTX + aPoints[j][0]*ZC._cos_(oLabel.iAngle) - aPoints[j][1]*ZC._sin_(oLabel.iAngle),
					oLabel.iY + oLabel.iHeight/2 + oLabel.iOffsetY + ZC.MAPTX + aPoints[j][0]*ZC._sin_(oLabel.iAngle) + aPoints[j][1]*ZC._cos_(oLabel.iAngle)
				];
				sPoly += ZC._i_(aPoints[j][0]) + ',' + ZC._i_(aPoints[j][1]) + ',';
			}
			oLabel.aPoints = aPoints;
			return ZC.ZCHtmlUtils._area_start_('poly', oLabel.sUrl, oLabel.sCursor) + 'class="' + sGraphId + '-label-area zc-label-area' + '" id="' + oLabel.sId + '-area' + '" coords="' + sPoly.substring(0, sPoly.length-1) + '" />';
			
		} else {
			return ZC.ZCHtmlUtils._area_start_('rect', oLabel.sUrl, oLabel.sCursor) + 'class="' + sGraphId + '-label-area zc-label-area' + '" id="' + oLabel.sId + '-area' + '" coords="' + ZC._i_(oLabel.iX+oLabel.iOffsetX+ZC.MAPTX) + ',' + ZC._i_(oLabel.iY+oLabel.iOffsetY+ZC.MAPTX) + ',' + ZC._i_(oLabel.iX+oLabel.iOffsetX+oLabel.iWidth+ZC.MAPTX) + ',' + ZC._i_(oLabel.iY+oLabel.iOffsetY+oLabel.iHeight+ZC.MAPTX) + '" />';
			
		}
	},
	_area_score_ : function(sArea) {
		var sId = '', aCoords;
		var iPos1 = sArea.indexOf('id="');
		if (iPos1 !== -1) {
			var iPos2 = sArea.indexOf('"', iPos1+4);
			if (iPos2 !== -1) {
				sId = sArea.substring(iPos1+4, iPos2);
			}
		}

		if (ZC.cache.data['area-score-' + sId]) {
			return ZC.cache.data['area-score-' + sId];
		}

		var iScore = 0;
		if (sArea.indexOf('shape="rect"') !== -1) {
			iScore += 10000;
			aCoords = /coords=\"(\-*\d+),(\-*\d+),(\-*\d+),(\-*\d+)\"/.exec(sArea);
			if (aCoords.length === 5) {
				iScore += (ZC._i_(aCoords[3])-ZC._i_(aCoords[1]))*(ZC._i_(aCoords[4])-ZC._i_(aCoords[2]));
			}
		} else if (sArea.indexOf('shape="circle"') !== -1) {
			iScore += 100;
			aCoords = /coords=\"(\-*\d+),(\-*\d+),(\-*\d+)\"/.exec(sArea);
			if (ZC._n_(aCoords[3]) !== null) {
				iScore += aCoords[3]/10;
			}
		} else if (sArea.indexOf('shape="poly"') !== -1) {
			if (sArea.indexOf('data-map') !== -1) {
				iScore += 1000000;
			} else {
				iScore += 1000;
			}
		} else {
			iScore += 1;
		}
		if (sArea.indexOf('data-z-sort') !== -1) {
			var aZSort = /data-z-sort=\"(\-*\d+)\"/.exec(sArea);
			if (aZSort && aZSort.length === 2) {
				iScore *= ZC._i_(Math.pow(10, ZC._i_(aZSort[1])));
			}
		}
		
		if (sId !== '') {
			ZC.cache.add('area-score-' + sId, iScore);
		}
		return iScore;
	},
	_translate_ : function(aP, iX, iY) {
		var aPC = [];
		for (var i=0,iLen=aP.length;i<iLen;i++) {
			if (ZC._n_(aP[i]) !== null) {
				var a = aP[i].slice(0);
				if (ZC._n_(a[0]) !== null && typeof(a[0]) !== 'string') { a[0] += iX; }
				if (ZC._n_(a[1]) !== null && typeof(a[1]) !== 'string') { a[1] += iY; }
				if (ZC._n_(a[2]) !== null && typeof(a[2]) !== 'string' && a.length <= 4) { a[2] += iX; }
				if (ZC._n_(a[3]) !== null && typeof(a[3]) !== 'string' && a.length <= 4) { a[3] += iY; }
				aPC.push(a);
			} else {
				aPC.push(null);
			}
		}
		return aPC;
	},
	_setup_format_ : function(oData, oPlotData) {
		var mValue;
		oPlotData = oPlotData || {};
		oData = oData || {};
		var oFormat = {};
		if (ZC._n_(mValue=oData['negation']) !== null) {
			oFormat['negation'] = mValue;
		}
		if (ZC._n_(mValue=oData['short']) !== null) {
			oFormat['short'] = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=oData['short-unit']) !== null) {
			oFormat['short-unit'] = mValue;
		}
		if (ZC._n_(mValue=oData['exponent']) !== null) {
			oFormat['exponent'] = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=oData['exponent-decimals']) !== null) {
			oFormat['exponent-decimals'] = ZC._i_(mValue);
		}
		if (ZC._n_(mValue=oData['decimals-separator']) !== null) {
			oFormat['decimals-separator'] = mValue;
		} else {
			if (ZC._n_(oPlotData['decimals-separator']) === null) {
				if (ZC._n_(mValue=ZC.ZCLabels['decimals-separator']) !== null) {
					oFormat['decimals-separator'] = mValue;
				}
			}
		}
		if (ZC._n_(mValue=oData['thousands-separator']) !== null) {
			oFormat['thousands-separator'] = mValue;
		} else {
			if (ZC._n_(oPlotData['thousands-separator']) === null) {
				if (ZC._n_(mValue=ZC.ZCLabels['thousands-separator']) !== null) {
					oFormat['thousands-separator'] = mValue;
				}
			}
		}
		if (ZC._n_(mValue=oData['decimals']) !== null) {
			oFormat['decimals'] = ZC._i_(mValue);
		}
		if (ZC._n_(mValue=oData['decimals-dyn']) !== null) {
			oFormat['decimals-dyn'] = mValue;
		}
		if (ZC._n_(mValue=oData['transform']) !== null) {
			if (ZC._n_(mValue['type']) !== null) {
				switch (mValue['type']) {
					case 'date':
						oFormat['transform-date'] = true;
						if (ZC._n_(mValue['text']) !== null) {
							mValue['all'] = mValue['text'];
						}
						if (ZC._n_(mValue['all']) !== null) {
							oFormat['transform-date-format'] = mValue['all'];
						}
						break;
				}
			}
		}
		return oFormat;
	},
	_format_ : function(mValue, oFormat, oGraphElement, bApplyTransform) {
		var sValue = mValue+'';
		var bTransform = false, sPower;
		if (bApplyTransform) {
			if (ZC._n_(oFormat['transform-date']) !== null && oFormat['transform-date']) {
				if ((''+Number(sValue)) === sValue) {
					sValue = ZC.ZCUtils._date_(Number(sValue), oFormat['transform-date-format'], oFormat['utc'], oFormat['timezone']);
					bTransform = true;
				}
			}
		}
		
		if (ZC._n_(oFormat['decimals-separator']) === null && ZC._n_(mValue=ZC.ZCLabels['decimals-separator']) !== null) {
			oFormat['decimals-separator'] = mValue;
		}
		if (ZC._n_(oFormat['thousands-separator']) === null && ZC._n_(mValue=ZC.ZCLabels['thousands-separator']) !== null) {
			oFormat['thousands-separator'] = mValue;
		}

		if (ZC._n_(oFormat['decimals']) !== null && oFormat['decimals'] !== -1 && typeof(oFormat['max-decimals']) !== 'undefined' && oFormat['max-decimals'] !== -1) {
			oFormat['decimals'] = ZC._max_(oFormat['max-decimals'], oFormat['decimals']);
		}

		if (!bTransform) {
			if (ZC._n_(oFormat['exponent']) !== null && oFormat['exponent']) {
				sValue = Number(sValue).toExponential(oFormat['exponent-decimals']);
				if (ZC._n_(oFormat['decimals-separator']) !== null) {
					sValue = sValue.replace(/\./g, oFormat['decimals-separator']);
				}
			} else {
				if (ZC._n_(oFormat['short']) !== null && oFormat['short']) {
					sPower = '';
					var sShortUnit = oFormat['short-unit'] || '';
					var iPowerStep = ZC._log_(ZC._a_(Number(sValue)))/Math.LN10;
					
					
					switch (ZC._a_(Number(sValue))) {
						case 1000: iPowerStep = 3; break;
						case 1000000: iPowerStep = 6; break;
						case 1000000000: iPowerStep = 9; break;
					}
					if ((iPowerStep >= 3 && iPowerStep < 6 && sShortUnit === '') || sShortUnit.toUpperCase() === 'K') {
						sValue = '' + Number(sValue)/1000;
						sPower = 'K';
					} else if ((iPowerStep >= 6 && iPowerStep < 9 && sShortUnit === '') || sShortUnit.toUpperCase() === 'M') {
						sValue = '' + Number(sValue)/1000000;
						sPower = 'M';
					} else if ((iPowerStep >= 9 && sShortUnit === '') || sShortUnit.toUpperCase() === 'B') {
						sValue = '' + Number(sValue)/1000000000;
						sPower = 'B';
					}
					if (ZC._isnumber_(sValue)) {
						if (ZC._n_(oFormat['decimals']) !== null && oFormat['decimals'] !== -1) {
							
							sValue = ZC._fixed_(Number(sValue), ZC._max_(0, ZC._i_(oFormat['decimals'])));
						} else {
							var aTmp = sValue.split('.'), sDecimals = aTmp[1] || '';
							if (oFormat['max-decimals'] !== -1 && oFormat['max-decimals'] < sDecimals.length) {
								
								sValue = ZC._fixed_(Number(sValue), ZC._max_(0, ZC._i_(oFormat['max-decimals'])));
							}
						}
					}
					if (ZC._n_(oFormat['decimals-separator']) !== null) {
						sValue = sValue.replace(/\./g, oFormat['decimals-separator']);
					}
				}

				if (!isNaN(sValue)) {
					if (ZC._n_(oFormat['decimals']) !== null && oFormat['decimals'] !== -1) {
						if (ZC._isnumber_(sValue)) {
							if (ZC._n_(oFormat['short']) === null || !oFormat['short']) {
								
								sValue = ZC._fixed_(Number(sValue), ZC._max_(0, ZC._i_(oFormat['decimals'])));
							}
						}
					}
					if (ZC._n_(oFormat['thousands-separator']) !== null || ZC._n_(oFormat['decimals-separator']) !== null) {
						var aValue = sValue.split('.');
						var sValue_ = '';
						for (var c=0,cLen=aValue[0].length;c<cLen;c++) {
							var sChar = aValue[0].substring(c, c+1);
							sValue_ += sChar;
							if (ZC._indexof_(['-', '+'], sChar) === -1) {
								if ((aValue[0].length-c-1)%3 === 0 && (aValue[0].length-c-1 !== 0)) {
									sValue_ += oFormat['thousands-separator'];
								}
							}
						}
						sValue = sValue_ + ((ZC._n_(aValue[1])!==null)?(oFormat['decimals-separator']+aValue[1]):'');
					}
					if (ZC._n_(oFormat['short']) !== null && oFormat['short']) {
						sValue += sPower;
					}
				}
			}
		}
		return sValue;
	},
	_function_ : function(sCall) {
		var iPos = sCall.indexOf('(');
		var sFunction = '';
		var sArguments = '';
		if (iPos !== -1) {
			sFunction = ZC._trim_(sCall.substring(0, iPos));
			sArguments = ZC._trim_(sCall.substring(iPos+1, sCall.length-1));
		} else {
			sFunction = ZC._trim_(sCall);
		}
		var aArguments = [], sToken;
		if (sArguments !== '') {
			var bOpenQuote = false;
			var bOpenDblQuote = false;
			var bEscaped = false;
			sToken = '';
			for (var i=0,iLen=sArguments.length;i<iLen;i++) {
				var sChar = sArguments.substring(i, i+1);
				switch (sChar) {
					case "\\":
						if (bEscaped) {
							sToken += "\\";
							bEscaped = false;
						} else {
							bEscaped = true;
						}
						break;
					case '"':
						if (bEscaped) {
							sToken += '\"';
							bEscaped = false;
						} else {
							if (bOpenDblQuote) {
								aArguments.push(sToken);
								sToken = '';
								bOpenDblQuote = false;
							} else {
								if (bOpenQuote) {
									sToken += sChar;
								} else {
									bOpenDblQuote = true;
								}
							}
						}
						break;
					case "'":
						if (bEscaped) {
							sToken += "\'";
							bEscaped = false;
						} else {
							if (bOpenQuote) {
								aArguments.push(sToken);
								sToken = '';
								bOpenQuote = false;
							} else {
								if (bOpenDblQuote) {
									sToken += sChar;
								} else {
									bOpenQuote = true;
								}
							}
						}
						break;
					case ' ':
						if (bOpenQuote || bOpenDblQuote) {
							sToken += sChar;
						}
						break;
					case ',':
						if (bOpenQuote || bOpenDblQuote) {
							sToken += sChar;
						} else {
							if (sToken !== '') {
								aArguments.push(sToken);
							}
							sToken = '';
						}
						break;
					default:
						sToken += sChar;
						break;
				}
			}
		}
		if (sToken !== '') {
			aArguments.push(sToken);
		}
		return [sFunction, aArguments];
	},
	_pad_ : function(fValue) {
		return fValue.toString().replace(/^([0-9])$/, '0$1');
	},
	_date_ : function(iTs, sFormat, bUTC, iTimeZone) {
		sFormat = sFormat || ZC.ZCLabels['date-formats']['minute'];
		if (typeof(bUTC) === 'undefined') {
			bUTC = false;
		}
		if (typeof(iTimeZone) === 'undefined') {
			iTimeZone = 0;
		}
		if (bUTC) {
			iTs += 1000*60*60*iTimeZone;
		}
		var oDate = new Date(), iHour, iMinutes, iSeconds, iMSeconds, iDayOfWeek, iDayOfMonth, iMonth, iFullYear;
		oDate.setTime(iTs);
		if (bUTC) {
			iHour = oDate.getUTCHours();
			iMinutes = oDate.getUTCMinutes();
			iSeconds = oDate.getUTCSeconds();
			iMSeconds = oDate.getUTCMilliseconds();
			iDayOfWeek = oDate.getUTCDay();
			iDayOfMonth = oDate.getUTCDate();
			iMonth = oDate.getUTCMonth();
			iFullYear = oDate.getUTCFullYear();
		} else {
			iHour = oDate.getHours();
			iMinutes = oDate.getMinutes();
			iSeconds = oDate.getSeconds();
			iMSeconds = oDate.getMilliseconds();
			iDayOfWeek = oDate.getDay();
			iDayOfMonth = oDate.getDate();
			iMonth = oDate.getMonth();
			iFullYear = oDate.getFullYear();
		}
		var aTokens = {
			'Y' : iFullYear,
			'y' : iFullYear.toString().substr(2, 2),

			'F' : ZC.ZCLabels['months-long'][iMonth],
			'm' : ZC.ZCUtils._pad_(iMonth+1),
			'M' : ZC.ZCLabels['months-short'][iMonth],
			'n' : iMonth,

			'd' : ZC.ZCUtils._pad_(iDayOfMonth),
			'D' : ZC.ZCLabels['days-short'][iDayOfWeek],
			'j' : iDayOfMonth,
			'l' : ZC.ZCLabels['days-long'][iDayOfWeek],
			'N' : (iDayOfWeek+1),
			'w' : iDayOfWeek,
			'S' : function() { if (iDayOfMonth%10===1) { return 'st'; } else if (iDayOfMonth%10===2) { return 'nd'; } else if (iDayOfMonth%10===2) { return 'rd'; } else { return 'th'; } },

			'a' : iHour<12?'am':'pm',
			'A' : iHour<12?'AM':'PM',

			'g' : iHour%12||12,
			'G' : iHour,
			'h' : ZC.ZCUtils._pad_(iHour%12||12),
			'H' : ZC.ZCUtils._pad_(iHour),

			'i' : ZC.ZCUtils._pad_(iMinutes),
			's' : ZC.ZCUtils._pad_(iSeconds),

			'q' : iMSeconds
		};
		for (var sToken in aTokens) {
			sFormat = sFormat.replace('%' + sToken, aTokens[sToken]);
		}
		return sFormat;
	},
	_color_cache_ : {},
	_color_tokens_ : function(mValue) {
		if (typeof(mValue) === 'string' && mValue.indexOf('%color-') !== -1 && ZC.COLORS.length > 0) {
			for (var c=0;c<ZC.COLORS.length;c++) {
				if (mValue.indexOf('(+') !== -1 || mValue.indexOf('(-') !== -1) {
					mValue = mValue.replace(/%color-(\d+?)\((\+|\-)(\d+?)\)/gi, function() {
						var sColor = ZC.ZCUtils._color_(ZC.COLORS[ZC._i_(arguments[1])]);
						if (arguments[2] === '+') {
							sColor = ZC.ZCUtils._lighten_(sColor, ZC._i_(arguments[3]));
						} else if (arguments[2] === '-') {
							sColor = ZC.ZCUtils._darken_(sColor, ZC._i_(arguments[3]));
						}
						return sColor;
					});
				}
				mValue = mValue.replace('%color-'+c, ZC.COLORS[c]);
			}
		}
		return mValue;
	},
	_color_ : function(mColor, oStyle) {
		var aMatches, oRE, r, g, b;
		if (ZC._n_(ZC.ZCUtils._color_cache_[mColor]) !== null) {
			return ZC.ZCUtils._color_cache_[mColor];
		} else {
			var sColor = String(mColor), fAlpha = 1;
			if (sColor.length === 0) {
				return '';
			}
			sColor = sColor.replace('0x', '#');
			if (sColor.substring(0, 5) === 'rgba(') {
				oRE = new RegExp('rgba\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3}),\\s*([0-9\.]+)\\)', 'gi');
				if ((aMatches = oRE.exec(sColor))) {
					r = ZC._int2hex_(aMatches[1]);
					if (r.length === 1) { r = '0' + r; }
					g = ZC._int2hex_(aMatches[2]);
					if (g.length === 1) { g = '0' + g; }
					b = ZC._int2hex_(aMatches[3]);
					if (b.length === 1) { b = '0' + b; }
					sColor = '#' + r + g + b;
					fAlpha = ZC._max_(0, ZC._min_(1, parseFloat(aMatches[4])));
				}
			} else if (sColor.substring(0, 4) === 'rgb(') {
				oRE = new RegExp('rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)', 'gi');
				if ((aMatches = oRE.exec(sColor))) {
					r = ZC._int2hex_(aMatches[1]);
					if (r.length === 1) { r = '0' + r; }
					g = ZC._int2hex_(aMatches[2]);
					if (g.length === 1) { g = '0' + g; }
					b = ZC._int2hex_(aMatches[3]);
					if (b.length === 1) { b = '0' + b; }
					sColor = '#' + r + g + b;
				}
			} else if (sColor.substring(0, 1) === '#') {
				if (sColor.length === 4) {
					sColor = '#' + sColor.substring(1, 2) + sColor.substring(1, 2) + sColor.substring(2, 3) + sColor.substring(2, 3) + sColor.substring(3, 4) + sColor.substring(3, 4);
				} else if (sColor.length !== 7) {
					sColor = '';
				}
			} else if (ZC._n_(ZC.ZCHtmlUtils._colors_[sColor.toUpperCase()]) !== null) {
				sColor = '#' + ZC.ZCHtmlUtils._colors_[sColor.toUpperCase()];
			}
			
			if (sColor === 'none' || sColor === 'transparent') {
				sColor = '-1';
			}
			if (!oStyle) {
				ZC.ZCUtils._color_cache_[mColor] = sColor;
			}
			return oStyle?[sColor, fAlpha]:sColor;
		}
	},
	_rgba_cache_ : {},
	_rgba_ : function(sColor, fAlpha) {
		if (sColor === -1) {
			sColor = '#ffffff';
			fAlpha = 0;
		}
		if (ZC._n_(ZC.ZCUtils._rgba_cache_[sColor + ',' + fAlpha]) !== null) {
			return ZC.ZCUtils._rgba_cache_[sColor + ',' + fAlpha];
		} else {
			if (sColor.length === 4) {
				sColor = sColor.substring(0, 1) + sColor.substring(1, 2) + sColor.substring(1, 2) + sColor.substring(2, 3) + sColor.substring(2, 3) + sColor.substring(3, 4) + sColor.substring(3, 4);
			}
			var sRGBA = 'rgba(' + [ZC._hex2int_(sColor.substring(1, 3)), ZC._hex2int_(sColor.substring(3, 5)), ZC._hex2int_(sColor.substring(5, 7)), fAlpha].join(',') + ')';
			ZC.ZCUtils._rgba_cache_[sColor + ',' + fAlpha] = sRGBA;
			return sRGBA;
		}
	},
	
	_rgb2hsv_ : function(iR, iG, iB) {
		iR /= 255;
		iG /= 255;
		iB /= 255;
		var iMax = Math.max(iR, iG, iB);
		var iMin = Math.min(iR, iG, iB);
		var iH, iS, iV;
		iV = iMax;
		var iD = iMax - iMin;
		iS = (iMax===0)?0:iD/iMax;
		if (iMax === iMin){
			iH = 0;
		} else {
			switch (iMax) {
				case iR: iH = (iG-iB)/iD + (iG<iB?6:0); break;
				case iG: iH = (iB-iR)/iD + 2; break;
				case iB: iH = (iR-iG)/iD + 4; break;
			}
			iH /= 6;
		}
		return [iH, iS, iV];
	},
	_hsv2rgb_ : function(iH, iS, iV) {
		var iR, iG, iB;
		var i = Math.floor(iH*6);
		var f = iH*6 - i;
		var p = iV*(1-iS);
		var q = iV* (1-f*iS);
		var t = iV*(1-(1-f)*iS);
		switch(i%6) {
			case 0: iR = iV; iG = t; iB = p; break;
			case 1: iR = q; iG = iV; iB = p; break;
			case 2: iR = p; iG = iV; iB = t; break;
			case 3: iR = p; iG = q; iB = iV; break;
			case 4: iR = t; iG = p; iB = iV; break;
			case 5: iR = iV; iG = p; iB = q; break;
		}
		return [iR * 255, iG * 255, iB * 255];
	},
	_darken_ : function(sHexColor, iPercent) {
		if (sHexColor === -1) { return -1; }
		sHexColor = ZC.ZCUtils._color_(sHexColor);
		if (typeof(iPercent) === 'undefined') { iPercent = 10; }
		var sR = ZC._hex2int_(sHexColor.substring(1, 3));
		var sG = ZC._hex2int_(sHexColor.substring(3, 5));
		var sB = ZC._hex2int_(sHexColor.substring(5, 7));
		var aHSV = ZC.ZCUtils._rgb2hsv_(sR, sG, sB);
		if (iPercent > 0) {
			aHSV[2] = Math.max(0, aHSV[2]-aHSV[2]*iPercent/100);
		} else {
			aHSV[2] = Math.min(1, aHSV[2]-aHSV[2]*iPercent/100);
		}
		var aRGB = ZC.ZCUtils._hsv2rgb_(aHSV[0], aHSV[1], aHSV[2]);
		aRGB[0] = (ZC._i_(aRGB[0])<16)?'0'+ZC._int2hex_(aRGB[0]):ZC._int2hex_(aRGB[0]);
		aRGB[1] = (ZC._i_(aRGB[1])<16)?'0'+ZC._int2hex_(aRGB[1]):ZC._int2hex_(aRGB[1]);
		aRGB[2] = (ZC._i_(aRGB[2])<16)?'0'+ZC._int2hex_(aRGB[2]):ZC._int2hex_(aRGB[2]);
		sHexColor = '#' + aRGB[0] + aRGB[1] + aRGB[2];
		return sHexColor;
	},
	_lighten_ : function(sHexColor, iPercent) {
		if (sHexColor === -1) { return -1; }
		sHexColor = ZC.ZCUtils._color_(sHexColor);
		if (typeof(iPercent) === 'undefined') { iPercent = 10; }
		var sR = parseInt(sHexColor.substr(1, 2), 16);
		var sG = parseInt(sHexColor.substr(3, 2), 16);
		var sB = parseInt(sHexColor.substr(5, 2), 16);
		return '#' + ((0|(1<<8) + sR + (256 - sR) * iPercent / 100).toString(16)).substr(1) + ((0|(1<<8) + sG + (256 - sG) * iPercent / 100).toString(16)).substr(1) + ((0|(1<<8) + sB + (256 - sB) * iPercent / 100).toString(16)).substr(1);
	},
	_luminance_ : function(sHexColor, sLight, sDark){
		var r = parseInt(sHexColor.substr(1,2),16);
		var g = parseInt(sHexColor.substr(3,2),16);
		var b = parseInt(sHexColor.substr(5,2),16);
		var yiq = ((r*299)+(g*587)+(b*114))/1000;
		return (yiq >= 128) ? sDark : sLight;
	},
	_create_image_data_ : function() {
	},
	_save_as_image_ : function() {
	}
};












ZC.ZCHtmlUtils = {
	_colors_ : {
		BLACK:'000000',BLUE:'0000FF',BROWN:'A52A2A',CYAN:'00FFFF',FUCHSIA:'FF00FF',GOLD:'FFD700',GRAY:'808080',GREEN:'008000',INDIGO:'4B0082',LIME:'00FF00',MAGENTA:'FF00FF',MAROON:'800000',NAVY:'000080',ORANGE:'FFA500',PINK:'FFC0CB',PURPLE:'800080',RED:'FF0000',SILVER:'C0C0C0',TURQUOISE:'40E0D0',VIOLET:'EE82EE',WHITE:'FFFFFF',YELLOW:'FFFF00'
	},
	_area_start_ : function(sShape, mUrl, sCursor) {
		
		return '<area' + ((sCursor && !mUrl && sCursor !== 'hand') ? ' style="cursor:' + sCursor + '"':'') + (((mUrl && sCursor !== 'arrow') || sCursor === 'hand')?' href="javascript:;"':'') + ' shape="' + sShape + '" ';
	},
	_iframe_ : function(oParent) {
		var oIframe;
		if (ZC.ZCQuery.browser.msie) {
			try {
	  			oIframe = document.createElement('<iframe />');
			} catch(e) {
				oIframe = document.createElement('iframe');
			}
		} else {
	  		oIframe = document.createElement('iframe');
		}
		oIframe.id = oParent.id + '-iframe';
	  	oIframe.style.visibility = 'hidden';
	  	oParent.appendChild(oIframe);
		var oDoc = null;
		var oWindow = oIframe.contentWindow || oIframe.contentDocument;
		if (oWindow.document) {
			oDoc = oWindow.document;
		} else {
			oDoc = oWindow;
		}
		if (!oDoc.body) {
			var oHtml = oDoc.createElement('HTML');
			oDoc.appendChild(oHtml);
			var oHead = oDoc.createElement('HEAD');
			oHtml.appendChild(oHead);
			var oBody = oDoc.createElement('BODY');
			oHtml.appendChild(oBody);
		}
		return oDoc;
	},
	_event_ : function(sEvent) {
		var bTouchEvents;
		if (typeof(ZC.TOUCHEVENTS) === 'undefined') {
			bTouchEvents = true;
			try {
				document.createEvent('TouchEvent');
			} catch (e) {
				bTouchEvents = false;
			}
			
			
			if (bTouchEvents) {
				bTouchEvents = ('ontouchstart' in document.documentElement);
			}
			ZC.TOUCHEVENTS = bTouchEvents;
		} else {
			bTouchEvents = ZC.TOUCHEVENTS;
		}
		if (bTouchEvents) {
			switch (sEvent) {
				case 'mouseover':
				case 'mousedown':
					sEvent = 'touchstart';
					break;
				case 'mousemove':
					sEvent = 'touchmove';
					break;
				case 'mouseout':
				case 'mouseup':
					sEvent = 'touchend';
					break;
				case 'click':
					sEvent = 'touchstart';
					break;
			}
		}
		return sEvent;
	},
	_sh_ : function(aPoints, oStyle) {
		var aPointsSh = [], i, iLen, j;
		var iSD = oStyle.iShadowDistance, iSA = oStyle.iShadowAngle, iSB = oStyle.iShadowBlur, fSDB = iSD-iSB/2;
		if (aPoints.length > 0) {
			var iShadowX = ZC._i_(fSDB*ZC._cos_(iSA) + iSB), iShadowY = ZC._i_(fSDB*ZC._sin_(iSA) + iSB);
			for (i=0,iLen=aPoints.length;i<iLen;i++) {
				if (ZC._n_(aPoints[i]) !== null) {
					var a = [];
					for (j=0;j<aPoints[i].length;j++) {
						a[j] = aPoints[i][j];
					}
					var l = a.length;
					if (l === 2 || l === 4) {
						for (j=0;j<l;j++) {
							a[j] = aPoints[i][j] + (j%2?(iShadowY + oStyle.iOffsetY):(iShadowX + oStyle.iOffsetX));
						}
					}
					aPointsSh.push(a);
				} else {
					aPointsSh.push(null);
				}
			}
		}
		return aPointsSh;
	},
	_txp_ : function(aPoint, sOutput, oStyle, bFilledPath, bTween) {
		if (typeof(bTween) === 'undefined') {
			bTween = false;
		}
		var p = [aPoint[0], aPoint[1]], f, off;
		if (aPoint.length >= 4) {
			p[2] = aPoint[2];
			p[3] = aPoint[3];
		}
		if (aPoint.length >= 6) {
			p[4] = aPoint[4];
			p[5] = aPoint[5];
		}
		
		switch (sOutput) {
			case 'canvas':
			case 'svg':
				if (oStyle.bPixelCorrection) {
					var offx, offy;
					offx = offy = (oStyle.iLineWidth%2 === 1)?0.5:0;
					
					if (ZC.ZCQuery.browser.msie && ZC.quirks && sOutput === 'svg') {
						offx = (oStyle.iLineWidth%2 === 1)?0.5:0;
						offy = (oStyle.iLineWidth%2 === 1)?0:0.5;
					}
					p[0] = Math.round(p[0]) - offx;
					p[1] = Math.round(p[1]) - offy;
					if (p.length === 4) {
						p[2] = Math.round(p[2]) - offx;
						p[3] = Math.round(p[3]) - offy;
					}
				}
				if (sOutput === 'svg') {
					p[0] = parseFloat(p[0].toFixed(4));
					p[1] = parseFloat(p[1].toFixed(4));
					if (p.length === 4) {
						p[2] = parseFloat(p[2].toFixed(4));
						p[3] = parseFloat(p[3].toFixed(4));
					}
				}
				if (sOutput === 'canvas' && !bFilledPath) {
					if (typeof(oStyle.iOffsetX) !== 'undefined' && typeof(oStyle.iOffsetY) !== 'undefined') {
						p[0] += oStyle.iOffsetX;
						p[1] += oStyle.iOffsetY;
						if (p.length === 4) {
							p[2] += oStyle.iOffsetX;
							p[3] += oStyle.iOffsetY;
						}
					}
				}
				break;
			case 'vml':
				if (oStyle.iAngle%360 === 0) {
					f = 10;
					off = (oStyle.iLineWidth%2 === 1)?0:f/2;
				} else {
					f = 1;
					off = 0;
				}
				if (oStyle.bPixelCorrection) {
					p[0] = f*(ZC._i_(ZC._i_(f*p[0])/f)) - off;
					p[1] = f*(ZC._i_(ZC._i_(f*p[1])/f)) - off;
					if (p.length === 4) {
						p[2] = f*(ZC._i_(ZC._i_(f*p[2])/f)) - off;
						p[3] = f*(ZC._i_(ZC._i_(f*p[3])/f)) - off;
					}
				} else {
					p[0] = ZC._i_(f*p[0]);
					p[1] = ZC._i_(f*p[1]);
					if (p.length === 4) {
						p[2] = ZC._i_(f*p[2]);
						p[3] = ZC._i_(f*p[3]);
					}
				}
				break;
		}
		return p;
	},
	_vector_path_ : function(aPoints, sOutput, oStyle, bFilledPath, bTween) {
		var i, iLen, cp, sp, ep, sArcDef, sSignature;
		if (oStyle.bFastVectorPath) {
			oStyle.oAttributes['fast-vector-path'] = true;
		}

		if (!oStyle.oAttributes['fast-vector-path']) {
			for (i=0,iLen=aPoints.length;i<iLen;i++) {
				if (aPoints[i]) {
					aPoints[i][0] = parseFloat(Number(aPoints[i][0]).toFixed(2));
					aPoints[i][1] = parseFloat(Number(aPoints[i][1]).toFixed(2));
				}
			}
			
			if (oStyle.bCache) {
				sSignature = oStyle.sId + ':' + oStyle.iAngle + ':' + aPoints.join('#');
				if (ZC.cache.data['path-points-' + sSignature]) {
					return ZC.cache.data['path-points-' + sSignature].split('#');
				}
			}
		}
		var aBounds = [ZC.MAX, ZC.MAX, -ZC.MAX, -ZC.MAX];
		var aPath = [];
		var bSkip = false;
		for (i=0,iLen=aPoints.length;i<iLen;i++) {
			if (ZC._n_(aPoints[i]) === null) {
				bSkip = true;
				continue;
			}
			if (!oStyle.oAttributes['fast-vector-path']) {
				cp = ZC.ZCHtmlUtils._txp_(aPoints[i], sOutput, oStyle, bFilledPath, bTween);
			} else {
				cp = aPoints[i];
				if (sOutput === 'vml') {
					var f = (oStyle.iAngle%360 === 0)?10:1;
					cp[0] = ZC._i_(f*cp[0]);
					cp[1] = ZC._i_(f*cp[1]);
					if (cp.length === 4) {
						cp[2] = ZC._i_(f*cp[2]);
						cp[3] = ZC._i_(f*cp[3]);
					}
				}
			}
			if (ZC._n_(cp) === null || isNaN(cp[0]) || isNaN(cp[1]) || !isFinite(cp[0]) || !isFinite(cp[1])) {
				continue;
			}

			
			if (iLen <= 20 && bFilledPath) {
				aBounds[0] = ZC._min_(aBounds[0], cp[0]/(sOutput=='vml'?10:1));
				aBounds[1] = ZC._min_(aBounds[1], cp[1]/(sOutput=='vml'?10:1));
				aBounds[2] = ZC._max_(aBounds[2], cp[0]/(sOutput=='vml'?10:1));
				aBounds[3] = ZC._max_(aBounds[3], cp[1]/(sOutput=='vml'?10:1));
			}

			if (i === 0) {
				aPath.push((sOutput==='svg'?'M ':'m ') + cp[0] + ' ' + cp[1]);
			} else {
				if (bSkip) {
					aPath.push((sOutput==='svg'?'M ':'m ') + cp[0] + ' ' + cp[1]);
					bSkip = false;
				}
				if (cp.length === 2) {
					aPath.push((sOutput==='svg'?'L ':'l ') + cp[0] + ' ' + cp[1]);
				} else if (cp.length === 4) {
					aPath.push((sOutput==='svg'?'Q ':'qb ') + cp[0] + ' ' + cp[1] + ' ' + cp[2] + ' ' + cp[3]);
				} else if (cp.length === 6) {
					if (sOutput === 'svg') {
						sp = ZC.ZCMath._cpoint_(cp[0], cp[1], cp[2], cp[3]);
						ep = ZC.ZCMath._cpoint_(cp[0], cp[1], cp[2], cp[4]);
						sArcDef = '0,0';
						if (cp[5] === 0) {
							if (cp[4]-cp[3] <= 180) {
								sArcDef = '0,1';
							} else {
								sArcDef = '1,1';
							}
						} else {
							if (cp[3]-cp[4] <= 180) {
								sArcDef = '0,0';
							} else {
								sArcDef = '1,0';
							}
						}
						aPath.push('a ' + cp[2] + ',' + cp[2] + ' 0 ' + sArcDef + ' ' + (ep[0]-sp[0]) + ',' + (ep[1]-sp[1]));
						
					} else if (sOutput === 'vml') {
						cp[2] *= 10;
						sp = ZC.ZCMath._cpoint_(cp[0], cp[1], cp[2], cp[3]);
						ep = ZC.ZCMath._cpoint_(cp[0], cp[1], cp[2], cp[4]);
						sArcDef = (cp[5]===1)?'at':'wa';
						aPath.push(sArcDef + ' ' + ZC._i_(cp[0]-cp[2]) + ',' + ZC._i_(cp[1]-cp[2]) + ',' + ZC._i_(cp[0]+cp[2]) + ',' + ZC._i_(cp[1]+cp[2]) + ' ' + ZC._i_(sp[0]) + ',' + ZC._i_(sp[1]) + ' ' + ZC._i_(ep[0]) + ',' + ZC._i_(ep[1]));
					}
				}
			}
		}

		if (!oStyle.oAttributes['fast-vector-path']) {
			if (oStyle.bCache) {
				ZC.cache.add('path-points-' + sSignature, aPath.join('#'));
			}
		}

		if (oStyle.oLoader && iLen <= 20 && bFilledPath) {
			oStyle.oLoader.oAttributes[oStyle.sId + '-bounds'] = aBounds;
		}

		return aPath;
	},
	_pagexy_ : function(ev, idx) {
		var iPageX, iPageY;
		var origEvt = ev.originalEvent || ev.originalEventZC;
		idx = ZC._i_(idx || '0');

		if (origEvt && origEvt.touches) {
			if (origEvt.touches.length > 0) {
				iPageX = origEvt.touches[idx].pageX;
				iPageY = origEvt.touches[idx].pageY;
			} else if (origEvt.changedTouches.length > 0) {
				iPageX = origEvt.changedTouches[idx].pageX;
				iPageY = origEvt.changedTouches[idx].pageY;
			}
		} else {
			iPageX = ev.pageX;
			iPageY = ev.pageY;
		}
		return [ZC._i_(iPageX || '0'), ZC._i_(iPageY || '0')];
	},
	_element_ : function(sTag, sNs, oDoc) {
		oDoc = oDoc || document;
		var oElement;
		if (ZC._n_(sNs) !== null) {
			if (oDoc.createElementNS) {
				oElement = oDoc.createElementNS(sNs, sTag);
			} else {
				oElement = oDoc.createElement(sTag);
				oElement.setAttribute('xmlns', sNs);
			}
		} else {
			oElement = oDoc.createElement(sTag);
		}
		if (sTag.substring(0, 4) === 'zcv:') {
			oElement.className = 'zcvml';
		}
		return oElement;
	},
	
	_remove_ : function(mIds) {
		var mValue;
		if (!(mIds instanceof Array)) {
			mIds = [mIds];
		}
		for (var i=0,iLen=mIds.length;i<iLen;i++) {
			mValue = mIds[i];
			if (typeof(mValue) !== 'object') {
				mValue = ZC._id_(mIds[i]);
			}
			if (mValue) {
				if (typeof(mValue.parentElement) !== 'undefined') {
					mValue.parentElement.removeChild(mValue);
				} else if (typeof(mValue.parentNode) !== 'undefined') {
					mValue.parentNode.removeChild(mValue);
				}
			}

		}
	},
	_attr_ : function(oElement, oAttributes) {
		for (var sAttr in oAttributes) {
			if (typeof(sAttr) === 'string' && (typeof(oAttributes[sAttr]) !== 'object' && typeof(oAttributes[sAttr]) !== 'function')) {
				try {
					oElement.setAttribute(sAttr, oAttributes[sAttr]);
				} catch(err) {}
			}
		}
	},
	_style_ : function(oElement, oAttributes) {
		for (var sAttr in oAttributes) {
			if (typeof(sAttr) === 'string' && (typeof(oAttributes[sAttr]) !== 'object' && typeof(oAttributes[sAttr]) !== 'function')) {
				oElement.style[sAttr] = oAttributes[sAttr];
			}
		}
	},
	_visible_ : function(oElement) {
		var oStyle;
		if (oElement === document) { return true; }
		if (!oElement) { return false; }
		if (!oElement.parentNode) { return false; }
		if (oElement.style) {
			if (oElement.style.display === 'none') { return false; }
			if (oElement.style.visibility === 'hidden') { return false; }
		}
		if (window.getComputedStyle) {
			oStyle = window.getComputedStyle(oElement, '');
			if (oStyle.display === 'none') { return false; }
			if (oStyle.visibility === 'hidden') { return false; }
		}
		oStyle = oElement.currentStyle;
		if (oStyle) {
			if (oStyle['display'] === 'none') { return false; }
			if (oStyle['visibility'] === 'hidden') { return false; }
		}
		return ZC.ZCHtmlUtils._visible_(oElement.parentNode);
	},
	_class_ : function(oElement) {
		var sClass = oElement.className || ZC.ZCQuery(oElement).attr('class');
		if (ZC._n_(sClass) !== null && typeof(sClass) === 'object') {
			if (typeof(sClass.baseVal) !== 'undefined') {
				sClass = sClass.baseVal;
			} else {
				sClass = '';
			}
		}
		return sClass || '';
	},
	_clear_ : function(oLayer, sOutput, x, y, w, h, sGraphId) {
		if (!oLayer) { return; }
		sGraphId = sGraphId || '';
		switch (sOutput) {
			case 'canvas':
				if (zingchart.CANVASTEXT) {
					oLayer.getContext('2d').clearRect(x, y, w, h);
				} else {
					oLayer.width = oLayer.width;
				}
				break;
			case 'vml':
			case 'svg':
				var iLen = oLayer.childNodes.length;
				if (iLen > 0) {
					for (var n=iLen-1;n>=0;n--) {
						if (sGraphId === '') {
							oLayer.removeChild(oLayer.childNodes[n]);
						} else {
							if (oLayer.childNodes[n].id.indexOf(sGraphId+'-') === 0) {
								oLayer.removeChild(oLayer.childNodes[n]);
							}
						}
					}
				}
				break;
		}
	},
	_context_ : function(mLayer, sOutput) {
		if (typeof(mLayer) === 'string') {
			mLayer = ZC._id_(mLayer);
		}
		switch (sOutput) {
			case 'canvas':
				return mLayer.getContext('2d');
			case 'svg':
			case 'vml':
				return mLayer;
		}
	},
	_group_ : function(aParams, sOutput) {
		switch (sOutput) {
			case 'svg':
				return ZC.ZCHtmlUtils._svg_g_(aParams);
			case 'vml':
			case 'canvas':
				return ZC.ZCHtmlUtils._div_(aParams);
		}
	},
	_layer_ : function(aParams, sOutput) {
		switch (sOutput) {
			case 'svg':
				return ZC.ZCHtmlUtils._svg_g_(aParams);
			case 'vml':
				return ZC.ZCHtmlUtils._div_(aParams);
			case 'canvas':
				return ZC.ZCHtmlUtils._canvas_(aParams);
		}
	},
	_svg_g_ : function(aParams) {
		var mValue;
		if (!ZC._id_(aParams['id'])) {
			var oSvgG = ZC.ZCHtmlUtils._element_('g', 'http://www.w3.org/2000/svg');
			if (ZC._n_(mValue=aParams['id']) !== null) { oSvgG.setAttribute('id', mValue); }
			if (ZC._n_(mValue=aParams['cls']) !== null) { oSvgG.setAttribute('class', mValue); }
			if (ZC._n_(mValue=aParams['zidx']) !== null) { oSvgG.setAttribute('z-index', mValue); }
			if (ZC._n_(mValue=aParams['clip-path']) !== null) { oSvgG.setAttribute('clip-path', mValue); }
			aParams['p'].appendChild(oSvgG);
			return oSvgG;
		} else {
			return ZC._id_(aParams['id']);
		}
	},
	_svg_clip_ : function(aParams) {
		var oMask;
		ZC.ZCHtmlUtils._remove_(aParams['id']);
		var oClipPath = ZC.ZCHtmlUtils._element_('clipPath', 'http://www.w3.org/2000/svg');
		oClipPath.id = aParams['id'];
		if (ZC._n_(aParams['cx']) !== null) {
			oMask = ZC.ZCHtmlUtils._element_('circle', 'http://www.w3.org/2000/svg');
			oMask.id = aParams['id'] + '-shape';
			ZC.ZCHtmlUtils._attr_(oMask, {
				cx : aParams['cx'],
				cy : aParams['cy'],
				r : aParams['r']
			});
		} else {
			oMask = ZC.ZCHtmlUtils._element_('polygon', 'http://www.w3.org/2000/svg');
			oMask.id = aParams['id'] + '-shape';
			ZC.ZCHtmlUtils._attr_(oMask, {
				points : aParams['path']
			});
		}
		oClipPath.appendChild(oMask);
		return oClipPath;
	},
	_canvas_ : function(aParams) {
		var mValue;
		if (!ZC._id_(aParams['id'])) {
			var oCanvas = document.createElement('canvas'), oCanvasStyle = oCanvas.style;
			if (ZC._n_(mValue=aParams['id']) !== null) { oCanvas.id = mValue; }
			if (ZC._n_(mValue=aParams['cls']) !== null) { oCanvas.className = mValue; }
			if (ZC._n_(mValue=aParams['wh']) !== null) { var aWH = (''+mValue).split('/');aParams['width'] = aWH[0];aParams['height'] = aWH[1]; }
			if (ZC._n_(mValue=aParams['tl']) !== null) { var aTL = (''+mValue).split('/');aParams['top'] = aTL[0];aParams['left'] = aTL[1]; }
			oCanvas.width = aParams['width'];
			oCanvas.height = aParams['height'];
			if (ZC._n_(mValue=aParams['left']) !== null) {
				oCanvasStyle.left = mValue + 'px';
			}
			if (ZC._n_(mValue=aParams['top']) !== null) {
				oCanvasStyle.top = mValue + 'px';
			}
			if (ZC._n_(mValue=aParams['display']) !== null) { oCanvasStyle.display = mValue; }
			if (ZC._n_(mValue=aParams['position']) !== null) { oCanvasStyle.position = mValue; }
			if (ZC._n_(mValue=aParams['zidx']) !== null) { oCanvasStyle.zIndex = mValue; }
			aParams['p'].appendChild(oCanvas);
			return oCanvas;
		} else {
			return ZC._id_(aParams['id']);
		}
	},
	_div_ : function(aParams) {
		var mValue, mValue_;
		if (!ZC._id_(aParams['id'])) {
			var oDiv = document.createElement('div'), oDivStyle = oDiv.style;

			oDivStyle.whiteSpace = 'nowrap';
			if (ZC._n_(mValue=aParams['wh']) !== null) { var aWH = (''+mValue).split('/');aParams['width'] = aWH[0];aParams['height'] = aWH[1]; }
			if (ZC._n_(mValue=aParams['tl']) !== null) { var aTL = (''+mValue).split('/');aParams['top'] = aTL[0];aParams['left'] = aTL[1]; }
			if (ZC._n_(mValue=aParams['id']) !== null) { oDiv.id = mValue; }
			if (ZC._n_(mValue=aParams['cls']) !== null) { if (mValue !== '') { oDiv.className = mValue; } }
			
			var aMapping = [
				['top', '', 'px'],
				['left', '', 'px'],
				['width', '', 'px'],
				['height', '', 'px'],
				'position',
				'overflow',
				['float', 'cssFloat|styleFloat'],
				['zidx', 'zIndex'],
				'clip',
				'display',
				['fontSize', '', 'px'],
				'fontFamily',
				'fontWeight',
				'fontStyle',
				'textDecoration',
				'textAlign',
				'verticalAlign',
				'color',
				'border',
				'borderTop',
				'borderRight',
				'borderBottom',
				'borderLeft',
				'background',
				['margin', 'marginTop|marginRight|marginBottom|marginLeft', 'px'],
				['marginTop', '', 'px'],
				['marginRight', '', 'px'],
				['marginBottom', '', 'px'],
				['marginLeft', '', 'px'],
				['padding', 'paddingTop|paddingRight|paddingBottom|paddingLeft', 'px'],
				['paddingTop', '', 'px'],
				['paddingRight', '', 'px'],
				['paddingBottom', '', 'px'],
				['paddingLeft', '', 'px'],
				'lineHeight',
				'filter'
			];			

			var sFontFamily = null, iFontSize = null, bBold = null;
			for (var i=0,iLen=aMapping.length;i<iLen;i++) {
				if (typeof(aMapping[i]) === 'string') { aMapping[i] = [aMapping[i]]; }
				mValue = null;
				
				if (ZC._n_(mValue_=aParams[aMapping[i][0]]) !== null) { mValue = mValue_; }

				if (ZC._n_(mValue) !== null) {
					if (ZC._n_(aMapping[i][1]) === null || aMapping[i][1] === '') {
						aMapping[i][1] = aMapping[i][0];
					}

					var aAttrs = aMapping[i][1].split('|');
					for (var a=0,aLen=aAttrs.length;a<aLen;a++) {
						var mStyleValue = mValue + ((ZC._n_(aMapping[i][2])===null)?'':aMapping[i][2]);
						oDivStyle[aAttrs[a]] = mStyleValue;
						if (aAttrs[a] === 'fontFamily') { sFontFamily = mStyleValue; }
						if (aAttrs[a] === 'fontSize') { iFontSize = ZC._i_(mStyleValue); }
						if (aAttrs[a] === 'fontWeight' && mStyleValue === 'bold') { bBold = true; }
					}
				}
			}
			if (ZC._n_(mValue=aParams['opacity']) !== null) {
				oDivStyle.opacity = mValue;
				if (ZC._f_(mValue) !== 1) {
					oDivStyle.filter = 'alpha(opacity = ' + ZC._i_(ZC._f_(mValue)*100) + ')';
				}
			}
			if (ZC._n_(mValue=aParams['p']) !== null) {
				mValue.appendChild(oDiv);
			}
			if (ZC._n_(mValue=aParams['html']) !== null) {
				oDiv.innerHTML = ZC._h_(mValue);
				if (mValue.indexOf('<') !== -1 && mValue.indexOf('>') !== -1) {
					ZC.ZCQuery(oDiv).children().each(function() {
						if (ZC._n_(sFontFamily) !== null) {
							if (ZC._n_(this.style.fontFamily) === null || this.style.fontFamily === '') {
								this.style.fontFamily = sFontFamily;
							}
						}
						if (ZC._n_(iFontSize) !== null) {
							if (ZC._n_(this.style.fontSize) === null || this.style.fontSize === '') {
								this.style.fontSize = iFontSize + 'px';
							}
						}
						if (ZC._n_(bBold) !== null) {
							if (ZC._n_(this.style.fontWeight) === null || this.style.fontWeight === '') {
								this.style.fontWeight = 'bold';
							}
						}
					});
				}
			}
			if (aParams['rtl']) {
				oDiv.style.unicodeBidi = 'bidi-override';
				oDiv.style.direction = 'rtl';
			}
			return oDiv;
		} else {
			return ZC._id_(aParams['id']);
		}
	},
	_text_width_cache_ : null,
	_text_width_ : function(sLoaderId, sText, sFontFamily, iFontSize, bBold) {
		var mValue, iWidth, oCanvas, oCtx, sRulerId;
		
		sRulerId = sLoaderId + '-text-ruler';
		if (sLoaderId.indexOf('-fullscreen') !== -1) {
			
			sRulerId = 'zc-text-ruler';
		}

		var sSignature = '{{' + sText + '}}' + sFontFamily.replace(/[^a-z]/gi, '').toLowerCase() + iFontSize + ((bBold)?'b':'n');
		if (ZC.cache.data['text-width-' + sSignature]) {
			return ZC.cache.data['text-width-' + sSignature];
		}

		var oDiv;
		if ((oDiv=ZC._id_(sRulerId))) {
			if (!ZC.ZCHtmlUtils._text_width_cache_ || (ZC.ZCHtmlUtils._text_width_cache_ !== (sLoaderId + sFontFamily + iFontSize + ((bBold)?1:0)))) {
				oDiv.style.fontFamily = sFontFamily;
				oDiv.style.fontSize = iFontSize + 'px';
				oDiv.style.fontWeight = bBold?'bold':'normal';
				ZC.ZCHtmlUtils._text_width_cache_ = sLoaderId + sFontFamily + iFontSize + ((bBold)?1:0);
			}
			oDiv.innerHTML = sText;
		} else {
			oDiv = ZC.ZCHtmlUtils._div_({
				id : sRulerId,
				p : document.body,
				tl : '-9999/-9999',
				html : sText,
				position : 'absolute',
				fontFamily : sFontFamily,
				fontSize : iFontSize,
				fontWeight : (bBold?'bold':'normal')
			});
		}
		if (sText.indexOf('<') !== -1 && sText.indexOf('>') !== -1) {
			ZC.ZCQuery(oDiv).children().each(function() {
				if (ZC._n_(this.style.fontFamily) === null || this.style.fontFamily === '') {
					this.style.fontFamily = sFontFamily;
				}
				if (ZC._n_(this.style.fontSize) === null || this.style.fontSize === '') {
					this.style.fontSize = iFontSize + 'px';
				}
				if (ZC._n_(this.style.fontWeight) === null || this.style.fontWeight === '') {
					this.style.fontWeight = 'bold';
				}
			});
		}

		
		if ((mValue=oDiv.getBoundingClientRect()) && (mValue.width > 0)) {
			iWidth = mValue.width;
		} else {
			iWidth = (ZC.mobile && ZC.ZCQuery.browser.webkit)?oDiv.offsetWidth:ZC.ZCQuery(oDiv).width();
		}

		ZC.cache.add('text-width-' + sSignature, iWidth);
		return iWidth;

		

		

		

		
	}
};












if (!document.getElementsByClassName && document.querySelectorAll) {
	document.getElementsByClassName = function(sClassName) {
		return document.querySelectorAll('.' + sClassName);
	};
}

ZC.ZCQuery = function(mSelector, oRoot, bInit) {
	var self = this, aTokens, aElements_, i, iLen;
	if (typeof(bInit) === 'undefined') { bInit = true; }
	if (bInit) {
		return new ZC.ZCQuery(mSelector, oRoot, false);
	} else {
		self.aContext = [];
		self.mSelector = mSelector;
		self.oRoot = oRoot;
		self.length = 0;

		self.oRoot = self.oRoot || document.getElementsByTagName('body')[0];

		if (typeof(self.mSelector) === 'object') {
			self.aContext = [self.mSelector];
		} else if (typeof(self.mSelector) === 'string') {

			var aSelectors = self.mSelector.split(',');
			for (var sel=0;sel<aSelectors.length;sel++) {
				var sSelector = ZC._trim_(aSelectors[sel]);

				var bExpression = false;

				aTokens = sSelector.split('>');
				if (aTokens.length === 2) {
					bExpression = true;
					ZC.ZCQuery(aTokens[0]).each(function() {
						var thisparent = this;
						ZC.ZCQuery(aTokens[1], this).each(function() {
							if (this.parentNode === thisparent) {
								self.aContext.push(this);
							}
						});
					});
				}
				aTokens = sSelector.split(' ');
				if (aTokens.length === 2) {
					bExpression = true;
					ZC.ZCQuery(aTokens[0]).each(function() {
						
						ZC.ZCQuery(aTokens[1], this).each(function() {
							self.aContext.push(this);
						});
					});
				}

				if (!bExpression) {
					if (sSelector.substring(0, 1) === '#') {
						if (ZC._id_(sSelector.substring(1))) {
							self.aContext = [ZC._id_(sSelector.substring(1))];
						}
					} else if (sSelector.substring(0, 1) === '.') {
						if (document.getElementsByClassName) {
							
							if (self.oRoot.getElementsByClassName) {
								aElements_ = self.oRoot.getElementsByClassName(sSelector.substring(1));
							} else {
								aElements_ = document.getElementsByClassName(sSelector.substring(1));
								if (self.oRoot !== document) {
									var mValue = [];
									for (i=0,iLen=aElements_.length;i<iLen;i++) {
										if (ZC.ZCQuery.childof(aElements_[i], self.oRoot)) {
											mValue.push(aElements_[i]);
										}
									}
									aElements_ = mValue;
								}
							}
							for (i=0,iLen=aElements_.length;i<iLen;i++) {
								self.aContext.push(aElements_[i]);
							}
						} else {
							var oRE = new RegExp("(^|\\s)" + sSelector.substring(1) + "(\\s|$)", 'i');
							var aDOMElements = self.oRoot.getElementsByTagName('*');
							var mClass = '';
							for (i=0,iLen=aDOMElements.length;i<iLen;i++) {
								mClass = aDOMElements[i].className;
								if (typeof(mClass) === 'object') {
									if (typeof(mClass.baseVal) !== 'undefined') {
										mClass = mClass.baseVal;
									} else {
										mClass = '';
									}
								}
								if (mClass !== '' && oRE.test(mClass)) {
									self.aContext.push(aDOMElements[i]);
								}
							}
						}
					} else {
						aElements_ = self.oRoot.getElementsByTagName(sSelector);
						for (i=0,iLen=aElements_.length;i<iLen;i++) {
							self.aContext.push(aElements_[i]);
						}
					}
				}
			}
		}
	}
	self.length = self.aContext.length;
	return this;
};
ZC.ZCQuery.prototype = {
	eachfn : function() {
		var aReturn = [], al;
		for (var i=0,l=this.aContext.length;i<l;i++) {
			var aArguments = [this.aContext[i]];
			if ((al=arguments.length) > 1) {
				for (var j=1;j<al;j++) {
					aArguments.push(arguments[j]);
				}
			}
			aReturn.push(arguments[0].apply(this, aArguments));
		}
		return aReturn;
	},
	each : function() {
		var al;
		for (var i=0,l=this.aContext.length;i<l;i++) {
			var aArguments = [this.aContext[i]];
			if ((al=arguments.length) > 1) {
				for (var j=1;j<al;j++) {
					aArguments.push(arguments[j]);
				}
			}
			arguments[0].apply(this.aContext[i], aArguments);
		}
		return this;
	},
	children : function() {
		var aElements_ = [];
		this.each(function() {
			for (var i=0,l=this.childNodes.length;i<l;i++) {
				if (this.childNodes[i].nodeType === 1) {
					aElements_.push(this.childNodes[i]);
				}
			}
		});
		this.aContext = aElements_;
		return this;
	},
	remove : function() {
		this.eachfn.call(this, function(oElement) {
			if (oElement && oElement.parentNode) {
				oElement.parentNode.removeChild(oElement);
			}
		});
	},
	empty : function() {
		this.eachfn.call(this, function(oElement) {
			if (oElement) {
				while (oElement.childNodes.length) {
					oElement.removeChild(oElement.childNodes[oElement.childNodes.length-1]);
				}
			}
		});
	},
	getdimensions : function(bIgnoreDisplay) {
		if (typeof(bIgnoreDisplay) === 'undefined') {
			bIgnoreDisplay = true;
		}
		var w, h;
		var aReturn = this.eachfn.call(this, function(oElement) {
			if (!oElement) {
				return null;
			}
			if (oElement === window) {
				var b = document.body;
				if (oElement.innerWidth) {
					w = oElement.innerWidth;
					h = oElement.innerHeight;
				} else if (b && b.parentElement && b.parentElement.clientWidth) {
					w = b.parentElement.clientWidth;
					h = b.parentElement.clientHeight;
				} else if (b && b.clientWidth) {
					w = b.clientWidth;
					h = b.clientHeight;
				}
				return {width:w, height:h};
			} else {
				var sDisplay = bIgnoreDisplay?'block':ZC.ZCQuery(oElement).getstyle('display');
				if (sDisplay === 'none' || sDisplay === '' || typeof(sDisplay) === 'undefined') {
					var s = oElement.style;
					var v = s.visibility;
					var p = s.position;
					var d = s.display;
					s.visibility = 'hidden';
					s.position = 'absolute';
					s.display = 'block';
					w = oElement.offsetWidth;
					h = oElement.offsetHeight;
					s.display = d;
					s.position = p;
					s.visibility = v;
				} else {
					w = oElement.offsetWidth || 0;
					h = oElement.offsetHeight || 0;
				}
			}
			return {width:w, height:h};
		});
		return aReturn.length===1?aReturn[0]:aReturn;
	},
	getstyle : function(sCssProp) {
		var aReturn = this.eachfn.call(this, function(oElement, sCssProp) {
			
			if (sCssProp === 'display') {
				return oElement.style.display;
			}
			var mValue, d = document;
			sCssProp = ZC._camelcase_(sCssProp);
			if (!oElement || oElement === d) {
				return undefined;
			}
			if (sCssProp === 'opacity' && typeof(oElement.filters) !== 'undefined') {
				var opacity = (ZC.ZCQuery(oElement).getstyle('filter') || '').match(/alpha\(opacity=(.*)\)/);
				if (opacity && opacity[1]) {
					return parseFloat(opacity[1]) / 100;
				}
				return 1.0;
			}
			if (ZC._indexof_(['float','cssFloat','styleFloat'], sCssProp) !== -1) {
				if ((mValue=oElement.style['float'])) {
					return mValue;
				} else if ((mValue=oElement.style.cssFloat)) {
					return mValue;
				} else if ((mValue=oElement.style.styleFloat)) {
					return mValue;
				} else {
					return 'none';
				}
			}
			var sValue = oElement.style?oElement.style[sCssProp]:null;
			if (!sValue) {
				if (d.defaultView && d.defaultView.getComputedStyle) {
					var oCss = d.defaultView.getComputedStyle(oElement, null);
					sCssProp = sCssProp.replace(/([A-Z])/g, '-$1').toLowerCase();
					sValue = oCss?oCss.getPropertyValue(sCssProp):null;
				} else if (oElement.currentStyle) {
					sValue = oElement.currentStyle[sCssProp];
					if (/^\d/.test(sValue) && !/px$/.test(sValue) && sCssProp !== 'fontWeight') {
						var sLeft = oElement.style.left;
						var sRsLeft = oElement.runtimeStyle.left;
						oElement.runtimeStyle.left = oElement.currentStyle.left;
						oElement.style.left = sValue || 0;
						sValue = oElement.style.pixelLeft + "px";
						oElement.style.left = sLeft;
						oElement.runtimeStyle.left = sRsLeft;
					}
				}
			}
			if (sCssProp === 'opacity') {
				sValue = parseFloat(sValue);
			}
			if (/Opera/.test(navigator.userAgent) && ZC._indexof_(['left', 'top', 'right', 'bottom'], sCssProp) !== -1) {
				if (ZC.ZCQuery(oElement).getstyle('position') === 'static') {
					sValue = 'auto';
				}
			}
			return sValue==='auto'?null:sValue;
		}, sCssProp);
		return aReturn.length===1?aReturn[0]:aReturn;
	},
	width : function(iWidth) {
		var mValue;
		if (typeof(iWidth) === 'undefined') {
			var aReturn = this.eachfn.call(this, function(oElement) {
				if (ZC._n_(mValue=ZC.ZCQuery(oElement).getdimensions()) !== null) {
					return ZC._i_(mValue['width']);
				} else {
					return 0;
				}
			});
			return aReturn.length===1?aReturn[0]:aReturn;
		} else {
			this.eachfn.call(this, function(oElement, iWidth) {
				oElement.style.width = iWidth + 'px';
			}, iWidth);
			return this;
		}
	},
	height : function(iHeight) {
		var mValue;
		if (typeof(iHeight) === 'undefined') {
			var aReturn = this.eachfn.call(this, function(oElement) {
				if (ZC._n_(mValue=ZC.ZCQuery(oElement).getdimensions()) !== null) {
					return ZC._i_(mValue['height']);
				} else {
					return 0;
				}
			});
			return aReturn.length===1?aReturn[0]:aReturn;
		} else {
			this.eachfn.call(this, function(oElement, iHeight) {
				oElement.style.height = iHeight + 'px';
			}, iHeight);
			return this;
		}
	},
	
	scrollLeft : function() {
		var oScroll = ZC.ZCQuery.scroll();
		return oScroll.left;
	},
	scrollTop : function() {
		var oScroll = ZC.ZCQuery.scroll();
		return oScroll.top;
	},
	css : function(sCssProp, sValue) {
		if (typeof(sValue) === 'undefined') {
			var aReturn = this.eachfn.call(this, function(oElement) {
				var sValue = ZC.ZCQuery(oElement).getstyle(sCssProp);
				if ((''+sValue).indexOf('px') !== -1) {
					return ZC._i_(sValue);
				} else {
					return sValue;
				}
			});
			return aReturn.length===1?aReturn[0]:aReturn;
		} else {
			this.eachfn.call(this, function(oElement, sCssProp, sValue) {
				oElement.style[sCssProp] = sValue;
			}, sCssProp, sValue);
			return this;
		}
	},
	attr : function(sAttr, sValue) {
		if (typeof(sValue) === 'undefined') {
			var aReturn = this.eachfn.call(this, function(oElement) {
				return oElement.getAttribute(sAttr);
			});
			return aReturn.length===1?aReturn[0]:aReturn;
		} else {
			this.eachfn.call(this, function(oElement, sAttr, sValue) {
				oElement.setAttribute(sAttr, sValue);
			}, sAttr, sValue);
			return this;
		}
	},
	val : function(sValue) {
		if (typeof(sValue) === 'undefined') {
			var aReturn = this.eachfn.call(this, function(oElement) {
				return oElement.value;
			});
			return aReturn.length===1?aReturn[0]:aReturn;
		} else {
			this.eachfn.call(this, function(oElement, sValue) {
				oElement.value = sValue;
			}, sValue);
			return this;
		}
	},
	show : function() {
		this.eachfn.call(this, function(oElement) {
			oElement.style.display = 'block';
		});
		return this;
	},
	hide : function() {
		this.eachfn.call(this, function(oElement) {
			oElement.style.display = 'none';
		});
		return this;
	},
	offset : function(oElement) {
		var aReturn = this.eachfn.call(this, function(oElement) {
			if (!oElement || (!(oElement.x && oElement.y) && (!oElement.parentNode === null || ZC.ZCQuery(oElement).getstyle('display') === 'none'))) {
				return undefined;
			}
			var oOffset = {top:0, left:0};
			var oBox = null;
			var oParent = null;
			var d = document, de = d.documentElement, b = d.body;
			if (!oElement.parentNode && oElement.x && oElement.y) {
				oOffset.left += oElement.x || 0;
				oOffset.top += oElement.y || 0;
			} else if (oElement.getBoundingClientRect) {
				oBox = oElement.getBoundingClientRect();
				oOffset.left += oBox.left + (de.scrollLeft || b.scrollLeft) - (de.clientLeft || 0);
				oOffset.top += oBox.top + (de.scrollTop || b.scrollTop) - (de.clientTop || 0);
			} else if (oElement.offsetParent) {
				oOffset.left += oElement.offsetLeft;
				oOffset.top += oElement.offsetTop;
				oParent = oElement.offsetParent;
				if (oParent !== oElement) {
					while (oParent) {
						oOffset.left += ZC._i_(oParent.style.borderLeftWidth);
						oOffset.top += ZC._i_(oParent.style.borderTopWidth);
						oOffset.left += ZC._i_(oParent.offsetLeft);
						oOffset.top += ZC._i_(oParent.offsetTop);
						oParent = oParent.offsetParent;
					}
				}
				var ua = navigator.userAgent.toLowerCase();
				if ((typeof(opera) !== 'undefined' && parseFloat(opera.version()) < 9) || (ua.indexOf('AppleWebKit') !== -1 && ZC.ZCQuery(oElement).getstyle('position') === 'absolute')) {
					oOffset.left -= ZC._i_(b.offsetLeft);
					oOffset.top -= ZC._i_(b.offsetTop);
				}
				if (oElement.parentNode) {
					oParent = oElement.parentNode;
				} else {
					oParent = null;
				}
				while (oParent) {
					var sTagName = oParent.tagName.toUpperCase();
					if (sTagName === 'BODY' || sTagName === 'HTML') {
						break;
					}
					var sDisplay = ZC.ZCQuery(oParent).getstyle('display');
					if (sDisplay.search(/^inline|table-row.*$/i)) {
						oOffset.left -= ZC._i_(oParent.scrollLeft);
						oOffset.top -= ZC._i_(oParent.scrollTop);
					}
					if (oParent.parentNode) {
						oParent = oParent.parentNode;
					} else {
						oParent = null;
					}
				}
			}
			return oOffset;
		});
		return aReturn.length===1?aReturn[0]:aReturn;
	},
	bind : function(sEvent, oFunction) {
		sEvent = ZC.ZCQuery.cleanTouchEvents(sEvent);
		if (sEvent === '') { return; }
		if (sEvent.indexOf(' ') !== -1) {
			var aEvents = sEvent.split(/\s+/);
			for (var i=0;i<aEvents.length;i++) {
				this.bind(aEvents[i], oFunction);
			}
			return this;
		}
		this.eachfn.call(this, function(oElement, sEvent, oFunction) {
			if (!ZC.ZCQuery.EVENTSMAP) {
				ZC.ZCQuery.EVENTSMAP = [];
			}
			function _f_(ev) {
				ev = ev || window.event;
				var oTarget = ev.target || ev.srcElement;
				var _ev_ = ZC.ZCQuery._event_(ev);
				if (_ev_ !== null) {
					oFunction.call(oTarget, _ev_);
				}
			}
			ZC.ZCQuery.EVENTSMAP.push([oElement, sEvent, oFunction, _f_]);
			if (oElement.addEventListener) {
				oElement.addEventListener(sEvent, _f_, true);
			} else {
				oElement.attachEvent('on'+sEvent, _f_);
			}
		}, sEvent, oFunction);
		return this;
	},
	unbind : function(sEvent, oFunction) {
		sEvent = ZC.ZCQuery.cleanTouchEvents(sEvent);
		if (sEvent === '') { return; }
		if (sEvent.indexOf(' ') !== -1) {
			var aEvents = sEvent.split(/\s+/);
			for (var i=0;i<aEvents.length;i++) {
				this.unbind(aEvents[i], oFunction);
			}
			return this;
		}
		this.eachfn.call(this, function(oElement, sEvent, oFunction) {
			if (typeof(ZC.ZCQuery.EVENTSMAP) !== 'undefined') {
				for (var i=0,l=ZC.ZCQuery.EVENTSMAP.length;i<l;i++) {
					if (ZC.ZCQuery.EVENTSMAP[i][0] === oElement && ZC.ZCQuery.EVENTSMAP[i][1] === sEvent && ZC.ZCQuery.EVENTSMAP[i][2] === oFunction) {
						if (oElement.removeEventListener) {
							oElement.removeEventListener(sEvent, ZC.ZCQuery.EVENTSMAP[i][3], true);
						} else {
							oElement.detachEvent('on'+sEvent, ZC.ZCQuery.EVENTSMAP[i][3]);
						}
						ZC.ZCQuery.EVENTSMAP.splice(i, 1);
						break;
					}
				}
			}
		}, sEvent, oFunction);
		return this;
	},
	live : function(sEvent, oFunction) {
		sEvent = ZC.ZCQuery.cleanTouchEvents(sEvent);
		if (sEvent === '') { return; }
		if (sEvent.indexOf(' ') !== -1) {
			var aEvents = sEvent.split(/\s+/);
			for (var i=0;i<aEvents.length;i++) {
				this.live(aEvents[i], oFunction);
			}
			return this;
		}
		var mSelector = this.mSelector;
		if (!ZC.ZCQuery.EVENTS) {
			ZC.ZCQuery.EVENTS = {};
		}

		function _live_(ev) {
			ev = ev || window.event;
			var oTarget = ev.target || ev.srcElement;
			var sClassName = oTarget.className || '';
			if (typeof(sClassName) === 'object') {
				if (typeof(sClassName.baseVal) !== 'undefined' && ZC._n_(sClassName.baseVal) !== null) {
					sClassName = sClassName.baseVal;
				} else {
					sClassName = '';
				}
			}
			var aEvents = ZC.ZCQuery.EVENTS[sEvent];
			var oHandler = null, _ev_ = null;
			for (var i=0,iLen=aEvents.length;i<iLen;i++) {
				if (
				(typeof(aEvents[i][0]) === 'object' && oTarget === aEvents[i][0])
				||
				(
				typeof(aEvents[i][0]) === 'string' &&
				(
				(aEvents[i][0].substring(0, 1) === '.' && ZC._indexof_(sClassName.split(' '), aEvents[i][0].replace('.', '')) !== -1)
				||
				(aEvents[i][0].substring(0, 1) === '#' && oTarget.id === aEvents[i][0].substring(1))
				)
				)
				) {
					oHandler = aEvents[i][1];
					_ev_ = ZC.ZCQuery._event_(ev);
				}
			}
			if (ZC._n_(oHandler) !== null && ZC._n_(_ev_) !== null) {
				oHandler.call(oTarget, _ev_);
			}
		}

		if (!ZC.ZCQuery.EVENTS[sEvent]) {
			ZC.ZCQuery.EVENTS[sEvent] = [];

			if (document.addEventListener) {
				document.addEventListener(sEvent, _live_, true);
			} else {
				document.attachEvent('on'+sEvent, _live_);
			}
		}
		ZC.ZCQuery.EVENTS[sEvent].push([mSelector, oFunction]);
		return this;
	},
	die : function(sEvent, oFunction) {
		sEvent = ZC.ZCQuery.cleanTouchEvents(sEvent);
		if (sEvent === '') { return; }
		var aEvents, i, iLen;
		if (sEvent.indexOf(' ') !== -1) {
			aEvents = sEvent.split(/\s+/);
			for (i=0,iLen=aEvents.length;i<iLen;i++) {
				this.die(aEvents[i], oFunction);
			}
			return this;
		}
		var mSelector = this.mSelector;
		if (!ZC.ZCQuery.EVENTS) {
			ZC.ZCQuery.EVENTS = {};
		}
		if ((aEvents=ZC.ZCQuery.EVENTS[sEvent])) {
			for (i=0,iLen=aEvents.length;i<iLen;i++) {
				if (aEvents[i][0] === mSelector && (!oFunction || aEvents[i][1] === oFunction)) {
					aEvents.splice(i, 1);
					break;
				}
			}
		}
		return this;
	}
};
ZC.ZCQuery.cleanTouchEvents = function(sEvent) {
	if (ZC.ie678) {
		sEvent = ZC._trim_(sEvent.replace(/touchstart|touchend|touchmove/, ''));
	}
	return sEvent;
};
ZC.ZCQuery.cache = {};
ZC.ZCQuery.browser = {};
(function() {
	var oReWebkit = /(webkit)[ \/]([\w.]+)/, oReOpera = /(opera)(?:.*version)?[ \/]([\w.]+)/, oReMsie = /(msie) ([\w.]+)/, oReMozilla = /(mozilla)(?:.*? rv:([\w.]+))?/, oReMsie1x = /(trident)(?:.*? rv:([\w.]+))?/;
	var aInfo = (function(ua) {
		ua = ua.toLowerCase();
		var aMatch = oReWebkit.exec(ua) || oReOpera.exec(ua) || oReMsie.exec(ua) || oReMsie1x.exec(ua) || ua.indexOf('compatible') < 0 && oReMozilla.exec(ua) || [];
		return [aMatch[1] || '', aMatch[2] || '0'];
	})(navigator.userAgent);
	if (aInfo[0]) {
		if (aInfo[0] === 'trident') {
			aInfo[0] = 'msie';
		}
		ZC.ZCQuery.browser[aInfo[0]] = true;
		ZC.ZCQuery.browser.version = aInfo[1];
	}
})();
ZC.ZCQuery.scroll = function() {
	var scroll = {top : 0, left : 0};
	var d = document;
	var de = d.documentElement;
	var db = d.body;
	if (de && (de.scrollTop || de.scrollLeft)) {
		scroll.left = de.scrollLeft;
		scroll.top = de.scrollTop;
	} else if (db) {
		scroll.left = db.scrollLeft;
		scroll.top = db.scrollTop;
	}
	return scroll;
};
ZC.ZCQuery._event_ = function(ev) {
	
	ev.originalEventZC = ev;
	if (!ev.target) {
		ev.target = ev.srcElement || document;
	}
	if (ev.target.nodeType === 3 || ev.target.nodeType === 8) {
		ev.target = ev.target.parentNode;
	}
	if (ZC._n_(ev.pageX) === null && ZC._n_(ev.clientX) !== null) {
		var eventDocument = ev.target.ownerDocument || document, doc = eventDocument.documentElement, body = eventDocument.body;
		ev.pageX = ev.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);
		ev.pageY = ev.clientY + (doc && doc.scrollTop  || body && body.scrollTop  || 0) - (doc && doc.clientTop  || body && body.clientTop  || 0);
	}
	if (!ev.which && ev.button !== undefined) {
		ev.which = (ev.button & 1 ? 1 : ( ev.button & 2 ? 3 : ( ev.button & 4 ? 2 : 0 ) ));
	}
	if (!ev.preventDefault) {
		ev.preventDefault = function() {
			this.returnValue = false;
		};
	}
	if (!ev.stopPropagation) {
		ev.stopPropagation = function() {
			this.cancelBubble = true;
		};
	}
	return ev;
};
ZC.ZCQuery.childof = function(oElement, oParent) {
	if (oElement === oParent) {
		return true;
	}
	while (oElement !== oParent && oElement.parentNode) {
		oElement = oElement.parentNode;
		if (oElement === oParent) {
			return true;
		}
	}
	return false;
};
ZC.ZCQuery.ajax = function(oParams) {
	var sUrl = oParams['url'] || '';
	var sType = oParams['type'] || 'GET';
	var sData = oParams['data'] || '';
	var bAsync = true;
	if (typeof(oParams['async']) !== 'undefined') {
		bAsync = ZC._b_(oParams['async']);
	} 
	
	if (sData.replace(/\&/g, '') === '') {
		sData = '';
	}
	
	var oBeforeSend = oParams['beforeSend'] || null;
	var oErrorCallback = oParams['error'] || null;
	var oSuccessCallback = oParams['success'] || null;
	var oXhr = null;
	try {
		if (window.ActiveXObject) {
			oXhr = new ActiveXObject('Microsoft.XMLHTTP');
		} else if (window.XMLHttpRequest) {
			oXhr = new XMLHttpRequest();
		}
	} catch(oError) {}
	var bLocal = (window.location.protocol==='file:');

	function rsc() {
		if (oXhr.readyState === 4) {
			if (bLocal || (oXhr.status >= 200 && oXhr.status < 300)) {
				if (oSuccessCallback) {
					oSuccessCallback(oXhr.responseText, oXhr.status, oXhr, sUrl);
				}
			}
			if (oXhr.status >= 400) {
				if (oErrorCallback) {
					oErrorCallback(oXhr, oXhr.status, oXhr.statusText, sUrl);
				}
			}
			oXhr.onreadystatechange = new window.Function();
			oXhr = null;
		}
	}

	if (oXhr) {
		if (bAsync) {
			oXhr.onreadystatechange = rsc;
		}
		if (!window.ActiveXObject) {
			oXhr.onerror = function() {
				if (oErrorCallback) {
					oErrorCallback(oXhr, 0, '', sUrl);
				}
			};
		}
		if (sType.toUpperCase() === 'POST') {
			oXhr.open('POST', sUrl, bAsync);
			oXhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
			oXhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
		} else {
			if (sData !== '') {
				if (sUrl.indexOf('?') === -1) {
					sUrl += '?';
				}
				sUrl += '&' + sData;
			}
			oXhr.open('GET', sUrl, bAsync);
		}
		if (oBeforeSend) {
			oBeforeSend(oXhr);
		}
		try {
			oXhr.send(sData);
			if (!bAsync) {
				if (bLocal || (oXhr.status >= 200 && oXhr.status < 300)) {
					if (oSuccessCallback) {
						oSuccessCallback(oXhr.responseText, oXhr.status, oXhr, sUrl);
					}
				}
				if (oXhr.status >= 400) {
					if (oErrorCallback) {
						oErrorCallback(oXhr, oXhr.status, oXhr.statusText, sUrl);
					}
				}
				oXhr = null;
			}
		} catch (e) {
			if (bLocal) {
				if (oErrorCallback) {
					oErrorCallback(oXhr, oXhr.status, oXhr.statusText, sUrl);
					oXhr.onreadystatechange = new window.Function();
					oXhr = null;
				}
			}
		}
	}
};











ZC.ZCMath = {

	_distribute_ : function(aAngles, iRefAngle) {
		
		var iThreshold = zingchart.DEV.SPREADFACTOR;
		var aClusters = [];
		var iCluster = 0, i, j;

		function upush(a, el) {
			if (ZC._indexof_(a, el) === -1) {
				a.push(el);
			}
		}

		for (i=0;i<aAngles.length;i++) {
			aAngles[i] += iRefAngle;
		}

		var iFirstAngle = -1, iLastAngle = -1;
		for (i=1;i<aAngles.length;i++) {
			if (ZC._a_(aAngles[i] - aAngles[i-1]) < iThreshold) {
				aClusters[iCluster] = aClusters[iCluster] || {min:-1, max:-1, items:[]};
				if (aClusters[iCluster].min === -1) {
					aClusters[iCluster].min = (i>1)?aAngles[i-2]:iRefAngle;
					if (iFirstAngle === -1) {
						iFirstAngle = aClusters[iCluster].min;
					}
					iLastAngle = aClusters[iCluster].min;
				}
				upush(aClusters[iCluster].items, i-1);
				upush(aClusters[iCluster].items, i);
			} else {
				if (aClusters[iCluster]) {
					aClusters[iCluster].max = aAngles[i];
					iLastAngle = aClusters[iCluster].max;
					iCluster++;
				}
			}
		}
		if (aClusters[iCluster] && aClusters[iCluster].max === -1) {
			aClusters[iCluster].max = 360 + iRefAngle;
		}

		
		var iClusters = aClusters.length;
		if (iClusters > 1) {
			if (aClusters[iClusters-1].max - aClusters[0].min === 360) {
				for (j=0;j<aClusters[0].items.length;j++) {
					aAngles[aClusters[0].items[j]] += 360;
				}
				aClusters[iClusters-1].items = aClusters[iClusters-1].items.concat(aClusters[0].items);
				aClusters[iClusters-1].max += aClusters[0].min;
				aClusters = aClusters.splice(1);
			}
		}

		if (aClusters.length > 1) {
			aClusters[aClusters.length-1].max = aClusters[0].min + 360;
		}

		for (i=0;i<aClusters.length;i++) {
			var oCluster = aClusters[i];
			var iItems = oCluster.items.length, iRange = oCluster.max - oCluster.min;
			var iMaxAngle = iRange/(iItems+4);
			iMaxAngle = ZC._min_(iMaxAngle, iThreshold);
			
			var iMidAngle = 0;
			for (j=0;j<oCluster.items.length;j++) {
				iMidAngle += aAngles[oCluster.items[j]];
			}
			iMidAngle = iMidAngle/oCluster.items.length;
			var bExpand = true;
			while (bExpand) {
				bExpand = false;
				for (j=1;j<oCluster.items.length;j++) {
					if (aAngles[oCluster.items[j]] - aAngles[oCluster.items[j-1]] < iMaxAngle) {
						if (aAngles[oCluster.items[j-1]] < iMidAngle) {
							aAngles[oCluster.items[j-1]] -= 0.45;
							aAngles[oCluster.items[j]] += 0.05;
						} else {
							aAngles[oCluster.items[j]] += 0.25;
						}
						bExpand = true;
						break;
					}
				}
			}
		
			
		}

		

		return aAngles;
	},
	_boxoverlap_ : function(oC1, oC2) {
		if (oC1.x > (oC2.x + oC2.width + 2)) { return false; }
		if (oC2.x > (oC1.x + oC1.width + 2)) { return false; }
		if (oC1.y > (oC2.y + oC2.height + 2)) { return false; }
		if (oC2.y > (oC1.y + oC1.height + 2)) { return false; }
		return true;
	},
	_boxinbox_ : function(oB1, oB2) {
		if (
			oB1.iX >= oB2.iX && oB1.iX <= oB2.iX+oB2.iWidth
			&&
			oB1.iY >= oB2.iY && oB1.iY <= oB2.iY+oB2.iHeight
			&&
			oB1.iX+oB1.iWidth >= oB2.iX && oB1.iX+oB1.iWidth <= oB2.iX+oB2.iWidth
			&&
			oB1.iY+oB1.iHeight >= oB2.iY && oB1.iY+oB1.iHeight <= oB2.iY+oB2.iHeight
		) {
			return true;
		}
		return false;
	},
	_distance_ : function(iA1, iA2, iA) {
		var iR1 = Math.sqrt(iA1/Math.PI);
		var iR2 = Math.sqrt(iA2/Math.PI);
		var r = Math.min(iR1, iR2);
		var R = Math.max(iR1, iR2);
		var iMinDiff = ZC.MAX;
		var iMinDistance = 0;
		for (var d=r+R;d>R-r;d-=r/50) {
			var iArea1 = r*r*Math.acos((d*d+r*r-R*R)/(2*d*r));
			var iArea2 = R*R*Math.acos((d*d+R*R-r*r)/(2*d*R));
			var iArea3 = (1/2)*Math.sqrt((-d+r+R)*(d+r-R)*(d-r+R)*(d+r+R));
			var iArea0 = iArea1 + iArea2 - iArea3;
			if (Math.abs(iArea0-iA) < iMinDiff) {
				iMinDiff = Math.abs(iArea0-iA);
				iMinDistance = d;
			}
		}
		return iMinDistance;
	},
	_cpoint_ : function(iX, iY, iR, iAngle) {
		
		
		return [iX + iR*Math.cos(iAngle*2*Math.PI/360), iY + iR*Math.sin(iAngle*2*Math.PI/360)];
	},
	_lpoint_ : function(iX1, iY1, iX2, iY2, d) {
		var iAngle = ZC._deg_(Math.atan((iY2-iY1)/(iX2-iX1)));
		var iDx = ZC._i_(ZC._cos_(iAngle)*d);
		var iDy = ZC._i_(ZC._sin_(iAngle)*d);
		return [iX1+iDx,iY1+iDy];
	},
	_mpoint_ : function(iX1, iY1, iX2, iY2, fAlpha, bApply) {
		fAlpha = (ZC._n_(fAlpha)===null)?0:fAlpha;
		bApply = (ZC._n_(bApply)===null)?true:bApply;
		if (iX2 - iX1 !== 0) {
			
			var fOffsetX = 0, fOffsetY = 0;
			var fAngle = Math.atan((iY2-iY1)/(iX2-iX1));
			if (fAlpha < 1 || bApply) {
				fOffsetX = (fAlpha/2.5)*Math.cos(fAngle);
				fOffsetY = (fAlpha/2.5)*Math.sin(fAngle);
			}
			var bLTR = (iX1 < iX2);
			return [(iX1+iX2)/2 + (bLTR?fOffsetX:-fOffsetX), (iY1+iY2)/2 + fOffsetY];
		} else {
			return [iX1, (iY1+iY2)/2];
		}
	},
	_linedef_ : function(aPoint1, aPoint2) {
		var a = (aPoint1[1]-aPoint2[1])/(aPoint1[0]-aPoint2[0]);
		var b = aPoint1[1]-a*aPoint1[0];
		return [a, b];
	},
	_ipoint_ : function(aPoint1, aPoint2, aPoint3, aPoint4) {
		if (aPoint2[0]===aPoint4[0] && aPoint2[1]===aPoint4[1]) {
			return aPoint2;
		}
		if (aPoint1[0]===aPoint3[0] && aPoint1[1]===aPoint3[1]) {
			return aPoint1;
		}
		var a1b1 = ZC.ZCMath._linedef_(aPoint1, aPoint2);
		var a1 = a1b1[0], b1 = a1b1[1];
		var a2b2 = ZC.ZCMath._linedef_(aPoint3, aPoint4);
		var a2 = a2b2[0], b2 = a2b2[1];
		var x = (b2-b1)/(a1-a2);
		var y = a1*x+b1;
		return [x,y];
	},
	_htmlarea_ : function(aPoints, iTolerance) {
		if (ZC._n_(iTolerance) === null) { iTolerance = 5; }
		var sCoords = '';
		var iIndex_, iX_, iY_, iDist_, iOffset_ = ZC.ie67?ZC.MAPTX:0;
		for (var i=0,iLen=aPoints.length;i<iLen;i++) {
			if (aPoints[i]) {
				if (i === 0) {
					iX_ = aPoints[i][0]+iOffset_;
					iY_ = aPoints[i][1]+iOffset_;
					iIndex_ = i;
					
					sCoords += parseInt(iX_, 10) + ',' + parseInt(iY_, 10) + ',';
				} else {
					iDist_ = Math.sqrt((aPoints[i][0]+iOffset_-iX_)*(aPoints[i][0]+iOffset_-iX_)+(aPoints[i][1]+iOffset_-iY_)*(aPoints[i][1]+iOffset_-iY_));
					if (iDist_ > iTolerance) {
						if (aPoints[i-1]) {
							iDist_ = Math.sqrt((aPoints[i][0]-aPoints[i-1][0])*(aPoints[i][0]-aPoints[i-1][0])+(aPoints[i][1]-aPoints[i-1][1])*(aPoints[i][1]-aPoints[i-1][1]));
							if (iDist_ > iTolerance && i-iIndex_ > 1) {
								
								sCoords += parseInt(aPoints[i-1][0]+iOffset_, 10) + ',' + parseInt(aPoints[i-1][1]+iOffset_, 10) + ',';
							}
							iX_ = aPoints[i][0]+iOffset_;
							iY_ = aPoints[i][1]+iOffset_;
							iIndex_ = i;
							
							sCoords += parseInt(iX_, 10) + ',' + parseInt(iY_, 10) + ',';
						}
					}
				}
			}
		}
		sCoords = sCoords.substring(0, sCoords.length-1);
		return sCoords;
	},
	_contour_ : function(aPoints, iRadius) {
		if (ZC._n_(aPoints) === null || aPoints.length < 2) { return ''; }
		iRadius = iRadius || 8;
		iRadius = ZC._max_(iRadius, 8);
		if (ZC.mobile) {
			iRadius += 10;
		}

		var aPoints_ = [], i, iLen, fAngle, iA, iAm;
		for (i=0,iLen=aPoints.length;i<iLen;i++) {
			if (
				i === 0
				||
				(i > 0 && ZC._n_(aPoints[i]) !== null && ZC._n_(aPoints[i-1]) !== null && aPoints[i].join('/') !== aPoints[i-1].join('/'))
				||
				ZC._n_(aPoints[i]) === null
			) {
				aPoints_.push(aPoints[i]);
			}
		}

		var aPointsC = [];
		var aPointsC_ = [];
		var bReverse = false;
		for (i=0,iLen=aPoints_.length;i<iLen;i++) {
			if (!aPoints_[i]) {
				continue;
			}
			var iPx = aPoints_[i][0], iPy = aPoints_[i][1], iPxNext, iPyNext, iPxPrev, iPyPrev;
			if (aPoints_[i-1]) {
				iPxPrev = aPoints_[i-1][0];
				iPyPrev = aPoints_[i-1][1];
				if (iPxPrev === iPx) {
					iPxPrev -= 0.1;
				}
			}
			if (aPoints_[i+1]) {
				iPxNext = aPoints_[i+1][0];
				iPyNext = aPoints_[i+1][1];
				if (iPxNext === iPx) {
					iPxNext += 0.1;
				}
			}
			if (i === 0) {
				fAngle = Math.atan((iPyNext-iPy)/(iPxNext-iPx));
				iA = ZC._deg_(fAngle);
				iAm = iA;
				if (iPxNext >= iPx) {
					iAm += 180;
				}
				aPointsC.push(
					ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iA+90),
					ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm),
					ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iA+270)
				);
			} else if (i === aPoints_.length-1) {
				fAngle = Math.atan((iPyPrev-iPy)/(iPxPrev-iPx));
				iA = ZC._deg_(fAngle);
				iAm = iA;
				if (iPxPrev >= iPx) {
					iAm += 180;
				}
				if (bReverse) {
					aPointsC_.push(
						ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iA+270),
						ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm),
						ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iA+90)
					);
					bReverse = false;
				} else {
					aPointsC.push(
						ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iA+270),
						ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm),
						ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iA+90)
					);
				}
			} else {
				var fAngle1 = Math.atan((iPyNext-iPy)/(iPxNext-iPx)), fAngle2 = Math.atan((iPy-iPyPrev)/(iPx-iPxPrev));
				iAm = ZC._deg_((fAngle1+fAngle2)/2);
				
				aPointsC.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm+270));
				
				if (iPxNext >= iPx && iPxPrev >= iPx) {
					aPointsC.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm+180));
					aPointsC.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm+90));
					aPointsC_.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm));
					bReverse = true;
				} else if (iPxNext <= iPx && iPxPrev <= iPx) {
					aPointsC.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm));
					aPointsC.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm+90));
					aPointsC_.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm+180));
					bReverse = true;
				} else {
					aPointsC_.push(ZC.ZCMath._cpoint_(iPx, iPy, iRadius, iAm+90));
				}
			}

		}
		for (i=aPointsC_.length-1;i>=0;i--) {
			aPointsC.push(aPointsC_[i]);
		}
		return aPointsC;
	},
	_layout_ : function(sLayout, iItems) {
		var iRows = 0;
		var iCols = 0;
		var aTemp = [];
		sLayout += '';
		switch (sLayout) {
			case 'horizontal':
			case 'h':
				iRows = 1;
				iCols = iItems;
				break;
			case 'vertical':
			case 'v':
				iRows = iItems;
				iCols = 1;
				break;
			default:
				aTemp = sLayout.split('x');
				if (ZC._n_(aTemp[0]) !== null && (ZC._i_(aTemp[0])+'') === aTemp[0]) {
					iRows = ZC._i_(aTemp[0]);
				}
				if (ZC._n_(aTemp[1]) !== null && (ZC._i_(aTemp[1])+'') === aTemp[1]) {
					iCols = ZC._i_(aTemp[1]);
				}
				if (iCols === 0 && iRows === 0) {
					iRows = Math.ceil(Math.sqrt(iItems));
					iCols = Math.ceil(iItems/iRows);
				} else {
					if (iCols === 0) {
						iCols = Math.ceil(iItems/iRows);
					}
					if (iRows === 0) {
						iRows = Math.ceil(iItems/iCols);
					}
				}
				break;
		}
		return [iRows, iCols];
	},
	_interpolation_nm_ : function(t, p) {
		return 0.5 *((2 * p[1]) + (-p[0] + p[2]) * t + (2*p[0] - 5*p[1] + 4*p[2] - p[3]) * t * t + (-p[0] + 3*p[1]- 3*p[2] + p[3]) * t * t * t);
	},
	_interpolation_m_ : function(xs, ys) {
		var i, length = xs.length, dx, dy, m, common;
		var dys = [], dxs = [], ms = [];
		for (i=0;i<length-1;i++) {
			dx = xs[i+1] - xs[i];
			dy = ys[i+1] - ys[i];
			dxs.push(dx);
			dys.push(dy);
			ms.push(dy/dx);
		}
		var c1s = [ms[0]];
		for (i=0;i<dxs.length-1;i++) {
			m = ms[i];
			var mNext = ms[i+1];
			if (m*mNext <= 0) {
				c1s.push(0);
			} else {
				dx = dxs[i];
				var dxNext = dxs[i+1];
				common = dx + dxNext;
				c1s.push(3*common/((common + dxNext)/m + (common + dx)/mNext));
			}
		}
		c1s.push(ms[ms.length - 1]);

		var c2s = [], c3s = [];
		for (i=0;i<c1s.length-1;i++) {
			m = ms[i];
			var c1 = c1s[i], invDx = 1/dxs[i];
			common = c1 + c1s[i+1] - m - m;
			c2s.push((m - c1 - common)*invDx);
			c3s.push(common*invDx*invDx);
		}

		return function(x) {
			var i = xs.length - 1;
			if (x === xs[i]) { 
				return ys[i]; 
			}
			var low = 0, mid, high = c3s.length - 1;
			while (low <= high) {
				mid = Math.floor(0.5*(low + high));
				var xHere = xs[mid];
				if (xHere < x) { 
					low = mid + 1;
				} else if (xHere > x) { 
					high = mid - 1; 
				} else { 
					return ys[mid]; 
				}
			}
			i = Math.max(0, high);
	 
			var diff = x - xs[i], diffSq = diff*diff;
			return ys[i] + c1s[i]*diff + c2s[i]*diffSq + c3s[i]*diff*diffSq;
		};
	},
	_spline_ : function(bMonotone, aPoints, iWidth, fStep) {
		if (ZC._n_(fStep) === null) {
			fStep = 1/(4*(iWidth/aPoints.length));
		}
		var aSplinePoints = [], aPoints_, tx;
		if (!bMonotone) {
			for (var i=1;i<aPoints.length-2;i++) {
				if (fStep !== 1) {
					aPoints_ = [aPoints[i-1], aPoints[i], aPoints[i+1], aPoints[i+2]];
					if (!aPoints_[1] || !aPoints_[2]) {
						aSplinePoints.push([]);
					} else {
						aPoints_[0] = aPoints_[0] || aPoints_[1] || aPoints_[2] || aPoints_[3];
						aPoints_[1] = aPoints_[1] || aPoints_[2] || aPoints_[0] || aPoints_[3];
						aPoints_[2] = aPoints_[2] || aPoints_[3] || aPoints_[1] || aPoints_[0];
						aPoints_[3] = aPoints_[3] || aPoints_[2] || aPoints_[1] || aPoints_[0];
						for (tx=0;tx<=1;tx+=fStep) {
							var iX = i + tx;
							var iY = ZC.ZCMath._interpolation_nm_(tx, aPoints_);
							aSplinePoints.push([iX-1, iY]);
						}
					}
				} else {
					aSplinePoints.push([i-1, aPoints[i]]);
				}
			}
		} else {		
			aPoints_ = [].concat(aPoints);
			if (!aPoints_[1] || !aPoints_[2]) {
				aSplinePoints.push([]);
			} else {
				aPoints_[0] = aPoints_[0] || aPoints_[1] || aPoints_[2] || aPoints_[3];
				aPoints_[1] = aPoints_[1] || aPoints_[2] || aPoints_[0] || aPoints_[3];
				aPoints_[2] = aPoints_[2] || aPoints_[3] || aPoints_[1] || aPoints_[0];
				aPoints_[3] = aPoints_[3] || aPoints_[2] || aPoints_[1] || aPoints_[0];
				var fn = ZC.ZCMath._interpolation_m_([0, 1, 2, 3], aPoints_);
				for (tx=1;tx<=2;tx+=fStep) {
					aSplinePoints.push([tx-1, fn(tx)]);
				}
			}
		}
		return aSplinePoints;
	},
	_round_step_ : function(fStep) {
		var iPower = Math.round(ZC._log_(ZC._a_(fStep))/Math.LN10);
		
		var aMultipliers = [1, 2, 4, 5, 6, 8, 10];
		var fMinDiff = ZC.MAX, fMultiplier = 1;
		for (var i=0;i<aMultipliers.length;i++) {
			var fDiff = aMultipliers[i]*Math.pow(10, iPower) - fStep;
			if (ZC._a_(fDiff) < fMinDiff) {
				fMultiplier = aMultipliers[i];
				fMinDiff = ZC._a_(fDiff);
			}
		}
		return fMultiplier*Math.pow(10, iPower);
	},
	_range_lin_ : function(fMinValue, fMaxValue, fStep, fScaleFactor, bForcedAttrs) {
		var mValue;
		if (ZC._n_(fScaleFactor) === null || fScaleFactor === 0) {
			fScaleFactor = 1;
		}

		var fMinValue_;
		var fMaxValue_;
		var iMaxPower = Math.floor(ZC._log_(ZC._a_(fMaxValue))/Math.LN10);
		var iMinPower = Math.floor(ZC._log_(ZC._a_(fMinValue))/Math.LN10);
		if (fMinValue === fMaxValue) {
			fMaxValue += Math.pow(10, iMaxPower);
		}
		var iPower = Math.max(iMaxPower, iMinPower);
		if (ZC._n_(fStep) === null) {
			fStep = Math.pow(10, iPower);
			if (fStep > fMaxValue-fMinValue) {
				fStep = Math.pow(10, iPower-1);
			}
			if (ZC._a_(fMaxValue)/fStep < 2 && ZC._a_(fMinValue)/fStep < 2) {
				iPower--;
				fStep = Math.pow(10, iPower);
			}
			var iPowerRange = Math.floor(ZC._log_(fMaxValue - fMinValue)/Math.LN10);
			var fStepRange = Math.pow(10, iPowerRange);
			if (((fMaxValue - fMinValue) > 0) && ((fStep/fStepRange) >= 10)) {
				fStep = fStepRange;
				iPower = iPowerRange;
			}
		}

		fStep *= fScaleFactor;

		var fStep_ = fStep;

		if (bForcedAttrs === null) {
			var aMultipliers = [1, 2, 5], iMultiplier = 0;
			iPower = 0;
			while ((fMaxValue-fMinValue)/fStep > 20) {
				fStep = fStep_ * aMultipliers[iMultiplier] * Math.pow(10, iPower);
				iMultiplier++;
				if (iMultiplier === aMultipliers.length) {
					iPower++;
					iMultiplier = 0;
				}
			}
		}
		
		fMaxValue_ = fMaxValue;
		fMaxValue_ = (Math.ceil(fMaxValue/fStep))*fStep;

		if (fMinValue < 0)  {
			fMinValue_ = -((Math.floor(ZC._a_(fMinValue/fStep)))*fStep);
			if (fMinValue_ > fMinValue) {
				fMinValue_ = -((Math.floor(ZC._a_(fMinValue/fStep)) + 1)*fStep);
			}
		} else {
			fMinValue_ = Math.floor(ZC._a_(fMinValue/fStep))*fStep;
			if (fMinValue_ > fMinValue) {
				fMinValue_ = Math.floor(ZC._a_(fMinValue/fStep) - 1)*fStep;
			}
			fMinValue_ = (fMinValue_ < 0)?0:fMinValue_;
		}
		if (iPower < 0) {
			
			fMinValue_ = ZC._f_(ZC._fixed_(fMinValue_, -iPower+1));
			fMaxValue_ = ZC._f_(ZC._fixed_(fMaxValue_, -iPower+1));
			if ((mValue=ZC._f_(ZC._fixed_(fStep, -iPower+1))) > 0) {
				fStep = mValue;
			}
		}
		return [fMinValue_, fMaxValue_, fStep_, iPower, fStep];
	}

};










ZC.ZCMD5 = {
	md5 : function(mValue) {
		return ZC.ZCMD5.string2hex(ZC.ZCMD5.string2md5(ZC.ZCMD5.string2utf8(mValue)));
	},
	string2md5 : function(mValue) {
		return ZC.ZCMD5.binary2string(ZC.ZCMD5.binary2md5(ZC.ZCMD5.string2binary(mValue), mValue.length*8));
	},
	string2hex : function(sInput) {
		var sChars = '0123456789abcdef';
		var sOutput = '';
		var iCode;
		for (var i=0,iLen=sInput.length;i<iLen;i++) {
			iCode = sInput.charCodeAt(i);
			sOutput += sChars.charAt((iCode >>> 4) & 0x0F) + sChars.charAt(iCode & 0x0F);
		}
		return sOutput;
	},
	string2utf8 : function(sInput) {
		var sOutput = '';
		var i = -1, iLen = sInput.length;
		var iCodeX, iCodeY;
		while (++i < iLen) {
			iCodeX = sInput.charCodeAt(i);
			iCodeY = i+1<iLen?sInput.charCodeAt(i+1):0;
			if (0xD800 <= iCodeX && iCodeX <= 0xDBFF && 0xDC00 <= iCodeY && iCodeY <= 0xDFFF) {
				iCodeX = 0x10000 + ((iCodeX & 0x03FF) << 10) + (iCodeY & 0x03FF);
				i++;
			}
			if (iCodeX <= 0x7F) {
				sOutput += String.fromCharCode(iCodeX);
			} else if (iCodeX <= 0x7FF) {
				sOutput += String.fromCharCode(0xC0 | ((iCodeX >>> 6) & 0x1F), 0x80 | (iCodeX & 0x3F));
			} else if (iCodeX <= 0xFFFF) {
				sOutput += String.fromCharCode(0xE0 | ((iCodeX >>> 12) & 0x0F), 0x80 | ((iCodeX >>> 6) & 0x3F), 0x80 | (iCodeX & 0x3F));
			} else if (iCodeX <= 0x1FFFFF) {
				sOutput += String.fromCharCode(0xF0 | ((iCodeX >>> 18) & 0x07), 0x80 | ((iCodeX >>> 12) & 0x3F), 0x80 | ((iCodeX >>> 6) & 0x3F), 0x80 | (iCodeX & 0x3F));
			}
		}
		return sOutput;
	},
	string2binary : function(sInput) {
		var i, aOutput = Array(sInput.length >> 2);
		for (i=0;i<aOutput.length;i++) {
			aOutput[i] = 0;
		}
		for (i=0;i<sInput.length*8;i+=8) {
			aOutput[i>>5] |= (sInput.charCodeAt(i/8) & 0xFF) << (i%32);
		}
		return aOutput;
	},
	binary2string : function(sInput) {
		var sOutput = '';
		for(var i=0;i<sInput.length*32;i+=8) {
			sOutput += String.fromCharCode((sInput[i>>5] >>> (i%32)) & 0xFF);
		}
		return sOutput;
	},
	binary2md5 : function(mValue, iLen) {
		
		function cmn(q, a, b, x, m, t) {
			return sa(br(sa(sa(a, q), sa(x, t)), m), b);
		}
		function ff(a, b, c, d, x, m, t) {
			return cmn((b & c) | ((~b) & d), a, b, x, m, t);
		}
		function gg(a, b, c, d, x, m, t) {
			return cmn((b & d) | (c & (~d)), a, b, x, m, t);
		}
		function hh(a, b, c, d, x, m, t) {
			return cmn(b ^ c ^ d, a, b, x, m, t);
		}
		function ii(a, b, c, d, x, m, t) {
			return cmn(c ^ (b | (~d)), a, b, x, m, t);
		}
		function sa(iA, iB) {
			var iLsw = (iA & 0xFFFF) + (iB & 0xFFFF);
			var iMsw = (iA >> 16) + (iB >> 16) + (iLsw >> 16);
			return (iMsw << 16) | (iLsw & 0xFFFF);
		}
		function br(iNumber, iCnt) {
			return (iNumber << iCnt) | (iNumber >>> (32 - iCnt));
		}

		mValue[iLen >> 5] |= 0x80 << ((iLen) % 32);
		mValue[(((iLen + 64) >>> 9) << 4) + 14] = iLen;
		var a =  1732584193;
		var b = -271733879;
		var c = -1732584194;
		var d =  271733878;

		for (var i=0,mLen=mValue.length;i<mLen;i+=16) {
			var a_ = a;
			var b_ = b;
			var c_ = c;
			var d_ = d;

			a = ff(a, b, c, d, mValue[i], 7 , -680876936);
			d = ff(d, a, b, c, mValue[i+ 1], 12, -389564586);
			c = ff(c, d, a, b, mValue[i+ 2], 17,  606105819);
			b = ff(b, c, d, a, mValue[i+ 3], 22, -1044525330);
			a = ff(a, b, c, d, mValue[i+ 4], 7 , -176418897);
			d = ff(d, a, b, c, mValue[i+ 5], 12,  1200080426);
			c = ff(c, d, a, b, mValue[i+ 6], 17, -1473231341);
			b = ff(b, c, d, a, mValue[i+ 7], 22, -45705983);
			a = ff(a, b, c, d, mValue[i+ 8], 7 ,  1770035416);
			d = ff(d, a, b, c, mValue[i+ 9], 12, -1958414417);
			c = ff(c, d, a, b, mValue[i+10], 17, -42063);
			b = ff(b, c, d, a, mValue[i+11], 22, -1990404162);
			a = ff(a, b, c, d, mValue[i+12], 7 ,  1804603682);
			d = ff(d, a, b, c, mValue[i+13], 12, -40341101);
			c = ff(c, d, a, b, mValue[i+14], 17, -1502002290);
			b = ff(b, c, d, a, mValue[i+15], 22,  1236535329);

			a = gg(a, b, c, d, mValue[i+ 1], 5 , -165796510);
			d = gg(d, a, b, c, mValue[i+ 6], 9 , -1069501632);
			c = gg(c, d, a, b, mValue[i+11], 14,  643717713);
			b = gg(b, c, d, a, mValue[i], 20, -373897302);
			a = gg(a, b, c, d, mValue[i+ 5], 5 , -701558691);
			d = gg(d, a, b, c, mValue[i+10], 9 ,  38016083);
			c = gg(c, d, a, b, mValue[i+15], 14, -660478335);
			b = gg(b, c, d, a, mValue[i+ 4], 20, -405537848);
			a = gg(a, b, c, d, mValue[i+ 9], 5 ,  568446438);
			d = gg(d, a, b, c, mValue[i+14], 9 , -1019803690);
			c = gg(c, d, a, b, mValue[i+ 3], 14, -187363961);
			b = gg(b, c, d, a, mValue[i+ 8], 20,  1163531501);
			a = gg(a, b, c, d, mValue[i+13], 5 , -1444681467);
			d = gg(d, a, b, c, mValue[i+ 2], 9 , -51403784);
			c = gg(c, d, a, b, mValue[i+ 7], 14,  1735328473);
			b = gg(b, c, d, a, mValue[i+12], 20, -1926607734);

			a = hh(a, b, c, d, mValue[i+ 5], 4 , -378558);
			d = hh(d, a, b, c, mValue[i+ 8], 11, -2022574463);
			c = hh(c, d, a, b, mValue[i+11], 16,  1839030562);
			b = hh(b, c, d, a, mValue[i+14], 23, -35309556);
			a = hh(a, b, c, d, mValue[i+ 1], 4 , -1530992060);
			d = hh(d, a, b, c, mValue[i+ 4], 11,  1272893353);
			c = hh(c, d, a, b, mValue[i+ 7], 16, -155497632);
			b = hh(b, c, d, a, mValue[i+10], 23, -1094730640);
			a = hh(a, b, c, d, mValue[i+13], 4 ,  681279174);
			d = hh(d, a, b, c, mValue[i], 11, -358537222);
			c = hh(c, d, a, b, mValue[i+ 3], 16, -722521979);
			b = hh(b, c, d, a, mValue[i+ 6], 23,  76029189);
			a = hh(a, b, c, d, mValue[i+ 9], 4 , -640364487);
			d = hh(d, a, b, c, mValue[i+12], 11, -421815835);
			c = hh(c, d, a, b, mValue[i+15], 16,  530742520);
			b = hh(b, c, d, a, mValue[i+ 2], 23, -995338651);

			a = ii(a, b, c, d, mValue[i], 6 , -198630844);
			d = ii(d, a, b, c, mValue[i+ 7], 10,  1126891415);
			c = ii(c, d, a, b, mValue[i+14], 15, -1416354905);
			b = ii(b, c, d, a, mValue[i+ 5], 21, -57434055);
			a = ii(a, b, c, d, mValue[i+12], 6 ,  1700485571);
			d = ii(d, a, b, c, mValue[i+ 3], 10, -1894986606);
			c = ii(c, d, a, b, mValue[i+10], 15, -1051523);
			b = ii(b, c, d, a, mValue[i+ 1], 21, -2054922799);
			a = ii(a, b, c, d, mValue[i+ 8], 6 ,  1873313359);
			d = ii(d, a, b, c, mValue[i+15], 10, -30611744);
			c = ii(c, d, a, b, mValue[i+ 6], 15, -1560198380);
			b = ii(b, c, d, a, mValue[i+13], 21,  1309151649);
			a = ii(a, b, c, d, mValue[i+ 4], 6 , -145523070);
			d = ii(d, a, b, c, mValue[i+11], 10, -1120210379);
			c = ii(c, d, a, b, mValue[i+ 2], 15,  718787259);
			b = ii(b, c, d, a, mValue[i+ 9], 21, -343485551);

			a = sa(a, a_);
			b = sa(b, b_);
			c = sa(c, c_);
			d = sa(d, d_);
		}
		return Array(a, b, c, d);
	}
};






















if (typeof(zingchart) === 'undefined') {
	zingchart = {
		bNoFlash : true
	};
}
zingchart.clipart = {};
zingchart.widgets = {};
zingchart.plugins = {};

zingchart.pool = {};
zingchart.pool.getInstance = function(sType, oParent, sId, bReuse) {
	var oInstance;
	if (ZC._n_(zingchart.pool[sId]) !== null) {
		oInstance = zingchart.pool[sId];
		oInstance._POOL_ = true;
		ZC.SKIPOBJCOUNT = true;
		if (!bReuse) {
			oInstance.init(oParent);
			oInstance.sId = sId;
		}
		ZC.SKIPOBJCOUNT = false;
	} else {
		switch (sType) {
			case 'ZCTextBox':
				oInstance = new ZC.ZCTextBox(oParent);
				break;
			case 'ZCBox':
				oInstance = new ZC.ZCBox(oParent);
				break;
			case 'ZCShape':
				oInstance = new ZC.ZCShape(oParent);
				break;
			case 'ZCGraphShape':
				oInstance = new ZC.ZCGraphShape(oParent);
				break;
			case 'ZCStyle':
				oInstance = new ZC.ZCStyle(oParent);
				break;
			
		}
		oInstance.sId = sId;
		zingchart.pool[sId] = oInstance;
	}
	return oInstance;
};


zingchart.i18n = {};
zingchart.THEMES = {};
zingchart.V3D = 2;
zingchart.QUOTEDVALUES = false;
zingchart.EDITSOURCE = 1;
zingchart.MODULESDEP = {
	line : 'xy',
	line3d : '3d,line',
	area : 'xy',
	area3d : '3d,area',
	vline : 'yx',
	varea : 'yx',
	vbar : 'xy',
	vbar3d : '3d,vbar',
	hbar : 'yx',
	hbar3d : '3d,hbar',
	scatter : 'xy',
	bubble : 'xy',
	hscatter : 'yx',
	hbubble : 'yx',
	pie : 'r',
	pie3d : '3d,pie',
	nestedpie : 'r',
	gauge : 'r',
	vbullet : 'vbar',
	hbullet : 'hbar',
	vfunnel : 'xy',
	hfunnel : 'yx',
	piano : 'xy',
	radar : 'r',
	range : 'xy',
	stock : 'xy,vbar',
	venn : 'r'
};
zingchart.SKIP = {
	EVENT : false,
	ANIMATION : false,
	LEGEND : false,
	CSV : false,
	PARSE3D : false
};

zingchart.MODULESDIR = (function(nodes){
	    for(var i = 0 ; i < nodes.length; i++){
	        if(nodes[i].src){
	            var index = nodes[i].src.indexOf('zingchart.min.js');
	            if(index > -1){
	                return (nodes[i].src.split('zingchart.min.js'))[0] + "modules/";
	            }
	        }
	    }
	    return './modules/';
	})(document.getElementsByTagName('head')[0].childNodes);
zingchart.DEV = {
	DOMFRAGMENTS : 1,
	SORTTOKENS : 1,
	PLOTSTATS : 1,
	TRUELOG : 0,
	RESOURCES : 1,
	KEEPSOURCE : 1,
	SPREADTYPE : 0,
	SPREADFACTOR : 10,
	IGNORESUBUNIT : 0,
	DELAYEDTRACKERS : 0,
	STACKINGLOGIC : 0,
	SMARTDATELABELS : 0,
	GC : 1,
	CACHECANVASTEXT : 0
};

zingchart.CANVASTEXT = 0;
zingchart.ZINDEX = 1;
zingchart.CMZINDEX = 9999;
zingchart.FSZINDEX = 9998;
zingchart.FSID = null;
zingchart.ZCOUTPUT = 0;
zingchart.ASYNC = 0;
zingchart.SORTTRACKERS = 0;
zingchart.TIMEOUT = 10;
zingchart.USERCSS = {};
zingchart.OBJECTMODE = 'normal';
zingchart.SYNTAX = 'mixed';
zingchart.EXPORTURL = ((document.location.protocol==='file:')?'http:':document.location.protocol) + '//export.zingchart.com/';
zingchart.AJAXEXPORT = false;




zingchart.TOUCHZOOM = 'normal'; 


zingchart.FASTWIDTH = 0;
zingchart.FONTSIZE = 11;
zingchart.FONTFAMILY = 'Lucida Sans Unicode,Lucida Grande,Verdana,Arial,sans-serif';


if (ZC.mobile) {
	zingchart.FONTFAMILY = 'Helvetica,Verdana,Arial,sans-serif';
}

zingchart.loadModules = function(sModules, oCallback) {
	var aModules = (''+sModules).split(',');
	for (var i=0,iLen=aModules.length;i<iLen;i++) {
		var sModule = ZC._trim_(aModules[i]);
		if (ZC._indexof_(['bar','bar3d','funnel','bullet'], sModule) !== -1) {
			sModule = 'v' + sModule;
		}
		
		var mValue = zingchart.MODULESDEP[sModule];
		if (ZC._n_(mValue) !== null) {
			zingchart.loadModules(mValue);
		}
		if (ZC._indexof_(ZC.aModules, sModule) === -1) {
			ZC.aModules.push(sModule);
		}
	}
	if (oCallback) {
		
		zingchart.loadScripts(null, ZC.aModules, oCallback);
	}
};
zingchart.loadScripts = function(oLoader, aScripts, oCallback) {
	var i;
	function _script_() {
		var sSrc, bLoad = true;
		if (zingchart.pendingLoad(aScripts[iSLoaded])) {
			sSrc = zingchart.MODULESDIR + 'zingchart-' + aScripts[iSLoaded] + '.min.js';
		} else {
			bLoad = false;
		}
		function _script_loaded_() {
			iSLoaded++;
			if (iSLoaded === aScripts.length) {
				oCallback();
			} else {
				_script_();
			}
		}
		if (bLoad) {
			ZC.ZCUtils._load_script_(oLoader, sSrc, _script_loaded_);
		} else {
			_script_loaded_();
		}
	}

	if (aScripts.length === 0) {
		oCallback();
	} else {
		var oHead = document.getElementsByTagName('head')[0];
		if (!oHead) {
			oCallback();
			return;
		}
		var iSLoaded = 0;

		_script_();
		
		
		
	}
};
zingchart.pendingLoad = function(sModule) {
	return (ZC._indexof_(ZC.aModules, sModule) !== -1 && ZC._indexof_(ZC.aLoadedModules, sModule) === -1);
};

zingchart.aImages = [];
if (!ZC.ie67) {
	(function() {
		for (var sKey in ZC.IMAGES) {
			if (ZC.IMAGES.hasOwnProperty(sKey)) {
				zingchart.aImages[sKey] = new Image();
				zingchart.aImages[sKey].src = ZC.IMAGES[sKey];
			}
		}
	})();
}

if (typeof(Ext) !== 'undefined') {
	zingchart.aImages['zc.blank'] = new Image();
	zingchart.aImages['zc.blank'].src = ZC.BLANK;
}

zingchart.exec = function(sId, sCall, oParams) {
	if (zingchart.exec_flash) {
		return zingchart.exec_flash(sId, sCall, oParams);
	}
	return null;
};

zingchart.render_gw = function(oParams) {
	var sDataUrl = oParams['dataurl'] || '';
	var sData = '', mValue;
	var oDataObj = null;
	if (ZC._n_(mValue=oParams['data']) !== null) {
		if (typeof(mValue) === 'string') {
			sData = mValue;
		} else {
			oDataObj = JSON.parse(JSON.stringify(mValue));
		}
	}
	var oResponse = null;
	if (sDataUrl !== '') {
		ZC.ZCQuery.ajax({
			type : 'GET',
			url : sDataUrl,
			
			async : false,
			data : (zingchart.ZCOUTPUT?'zcoutput=userdef':''),
			error : function() {
				return false;
			},
			success : function(sResponse) {
				function _f_(oResponse) {
					ZC.cache.data['data-' + sDataUrl] = sResponse;
					oParams['output'] = 'auto';
					ZC._cp_(oResponse['render'], oParams);
				}
				try {
					oResponse = JSON.parse(sResponse);
					_f_(oResponse);
				} catch (oError) {
					try {
						oResponse = eval('(' + sResponse + ')');
						_f_(oResponse);
					} catch (oError) {
						return false;
					}
				}
			}
		});
	} else {
		if (sData !== '') {
			try {
				oResponse = JSON.parse(sData);
			} catch (oError) {
				return false;
			}
		} else if (oDataObj !== null) {
			oResponse = oDataObj;
		}
		if (ZC._n_(oParams['output']) === null) {
			oParams['output'] = 'auto';
		}
		ZC._cp_(oResponse['render'], oParams);
	}
	return zingchart.render(oParams);
};
zingchart.bVmlReady = null;
zingchart.params = {};
zingchart.render = function(oParams, bUserDefinedOutput) {
	if (ZC._n_(bUserDefinedOutput) === null) {
		bUserDefinedOutput = false;
	}
	if (bUserDefinedOutput) {
		return zingchart.render_gw(oParams);
	}
	if (ZC._n_(ZC.canvas) === null) {
		ZC.compat();
	}

	var sOutput = oParams['output'] || 'auto';
	if (sOutput === 'html5') { sOutput = 'auto'; }
	if (ZC.mobile && sOutput === 'auto') { sOutput = 'svg'; }
	var bForce = false;
	if (sOutput.substring(0, 1) === '!') {
		bForce = true;
		sOutput = sOutput.substring(1);
	}
	if (!bForce) {
		if (
			(sOutput === 'auto')
			||
			(sOutput === 'canvas' && !ZC.canvas)
			||
			(sOutput === 'svg' && !ZC.svg)
			||
			(sOutput === 'vml' && !ZC.vml)
			||
			(sOutput === 'flash' && !ZC.flash)
		) {
			if (ZC.svg) {
				sOutput = 'svg';
			} else if (ZC.canvas) {
				sOutput = 'canvas';
			} else if (ZC.vml) {
				sOutput = 'vml';
			} else if (ZC.flash) {
				sOutput = 'flash';
			}
		}
	}
	if (sOutput === 'vml' && ZC._n_(zingchart.bVmlReady) === null) {
		zingchart.bVmlReady = false;
	}
	if (sOutput === 'flash') {
		zingchart.render_flash(oParams);
	} else {
		return zingchart.render_html5(oParams, sOutput);
	}
	
};
if (document.attachEvent) {
	if (document.readyState === 'complete') {
		zingchart.bVmlReady = true;
	} else {
		document.attachEvent('onreadystatechange', function() { if (document.readyState === 'complete') { zingchart.bVmlReady = true; } });
	}
}
zingchart.setlabel = function(sLabel, sText) {
	ZC.ZCLabels[sLabel] = sText;
};
zingchart.aLoaders = [];
zingchart.iIMG = 0;
zingchart.iIMGLoaded = 0;
zingchart.bIMGInit = false;
zingchart.bVMLInit = false;
zingchart.bCSSInit = false;
zingchart.bEventsInit = false;
zingchart.css = null;

zingchart.zc_get_loader_by_event = function(ev) {
	if (!ev.target.id) { return; }
	var oLoader = null;
	for (var l=0,lLen=zingchart.aLoaders.length;l<lLen;l++) {
		if (ev.target.id.substr(0, zingchart.aLoaders[l].sId.length+1) === (zingchart.aLoaders[l].sId + '-')) {
			oLoader = zingchart.aLoaders[l];
		}
	}
	return oLoader;
};


if (typeof(zingchart.zc_mouseevent) === 'undefined') {
	zingchart.zc_mouseevent = function(ev) {
		if (window.ZC) {
			window.ZC.aPageXY = [ev.pageX, ev.pageY];
			var oLoader = zingchart.zc_get_loader_by_event(ev);
			if (oLoader) {
				if (!zingchart.SKIP.EVENT) {
					if (ev.type === 'touchstart' && oLoader.aGraphs) {
						
						for (var g=0;g<oLoader.aGraphs.length;g++) {
							oLoader.aGraphs[g].hideLayer();
						}
					}
					ZC.ZCUtils._trigger_event_(ev.type, oLoader, zingchart.getMouseInfo(ev, oLoader));
				}
				zingchart.SKIP.EVENT = false;
			}
		}
	};
	ZC.ZCQuery(document)
		.bind(ZC.ZCHtmlUtils._event_('mousemove'), zingchart.zc_mouseevent)
		.bind(ZC.ZCHtmlUtils._event_('mousedown'), zingchart.zc_mouseevent)
		.bind(ZC.ZCHtmlUtils._event_('mouseup'), zingchart.zc_mouseevent);
}

zingchart.getMouseInfo = function(ev, oLoader) {
	var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
	var oGraph = oLoader.detectGraph(aPageXY[0], aPageXY[1]);
	var oContainer = ZC.ZCQuery('#' + oLoader.sId + '-top');
	var iX_ = aPageXY[0] - oContainer.offset().left;
	var iY_ = aPageXY[1] - oContainer.offset().top;
	var sTarget = 'none';
	if (/(.*)\-plotset\-plot\-(\d+)\-node\-(\d+)(.*)/.test(ev.target.id)) {
		sTarget = 'node';
	}
	if (/(.*)\-legend\-item\_(\d+)\-area/.test(ev.target.id)) {
		sTarget = 'legend-item';
	}
	if (/(.*)\-legend\-marker\_(\d+)\-area/.test(ev.target.id)) {
		sTarget = 'legend-marker';
	}
	if (/(.*)\-menu\-item\-(.*)/.test(ev.target.id)) {
		sTarget = 'menu-item';
	}
	if (/(.*)\-preview\-handler\-x(.*)/.test(ev.target.id)) {
		sTarget = 'preview';
	}
	if (/(.*)\-shape\-(.*?)\-area/.test(ev.target.id)) {
		sTarget = 'shape';
	}
	if (/(.*)\-label\-(.*?)\-area/.test(ev.target.id)) {
		sTarget = 'label';
	}
	return {
		id : oLoader.sId,
		ev : ZC.ZCQuery._event_(ev),
		targetid : ev.target.id,
		graphid : oGraph?oGraph.sId:null,
		target : sTarget,
		x : iX_,
		y : iY_,
		plotarea : oGraph?(iX_ >= oGraph.oPlotArea.iX && iX_ <= oGraph.oPlotArea.iX+oGraph.oPlotArea.iWidth && iY_ >= oGraph.oPlotArea.iY && iY_ <= oGraph.oPlotArea.iY+oGraph.oPlotArea.iHeight):false,
		touch : ZC.mobile
	};
};

if (typeof(zingchart.zc_click) === 'undefined') {
	zingchart.zc_click = function(ev) {
		for (var l=0,lLen=zingchart.aLoaders.length;l<lLen;l++) {
			zingchart.aLoaders[l].hideCM();
		}
		if (ZC.mobile && ZC.move) {
			ZC.move = false;
			return;
		}
		if (!ZC.mobile && ev.which > 1) {
			return;
		}
		var oLoader = zingchart.zc_get_loader_by_event(ev);
		if (oLoader) {
			if (!zingchart.SKIP.EVENT) {
				ZC.ZCUtils._trigger_event_((ev.type==='dblclick')?'dblclick':'click', oLoader, zingchart.getMouseInfo(ev, oLoader));
			}
			zingchart.SKIP.EVENT = false;
			if (ev.target.id !== (oLoader.sId + '-menu-area')) {
				oLoader.hideCM();
			} else {
				zingchart.zc_contextmenu(ev);
			}
		}
	};

	if (ZC.mobile) {
		ZC.ZCQuery(document).bind('touchmove', function() {
			ZC.move = true;
		});
		ZC.ZCQuery(document).bind('touchend', function() {
			ZC.move = false;
		});
	} else {
		ZC.ZCQuery(document).bind('click', zingchart.zc_click);
		ZC.ZCQuery(document).bind('dblclick', zingchart.zc_click);
	}

}

if (typeof(zingchart.zc_check_touch) === 'undefined') {
	zingchart.zc_check_touch = function(ev) {
		if (ev.touches.length > 0) {
			ZC.TOUCHEVENTS = true;
		}
	};
	ZC.ZCQuery(document).bind('touchstart', zingchart.zc_check_touch);
}

if (typeof(zingchart.zc_contextmenu) === 'undefined') {
	zingchart.zc_contextmenu = function(ev, sLoaderId) {
		if (
			ev 
			&& 
			ev.target.tagName.toUpperCase() !== 'IMG' 
			&& 
			ev.target.tagName.toUpperCase() !== 'AREA' 
			&& 
			ev.target.className.indexOf('zc-scroll') === -1
			&& 
			ev.target.id.indexOf('-legend-item_') === -1
			&& 
			ev.target.id.indexOf('-legend-marker_') === -1
		) {
			return;
		}
		var oGraph, aPageXY, iX_, iY_, iPageX, iPageY;
		var oLoader = (ZC._n_(sLoaderId)===null)?zingchart.zc_get_loader_by_event(ev):zingchart.getLoader(sLoaderId);
		if (oLoader) {
			if (ZC._indexof_(oLoader.aFlags, 'skip_context_menu') !== -1) {
				return false;
			}
			if (ZC._n_(sLoaderId) === null) {
				aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				oGraph = oLoader.detectGraph(aPageXY[0], aPageXY[1]);
			} else {
				oGraph = oLoader.aGraphs[0];
			}

			if (!oGraph) {
				return false;
			}

			var oContainer = ZC.ZCQuery('#' + oLoader.sId + '-top');
			if (ZC._n_(sLoaderId) === null) {
				iX_ = aPageXY[0] - oContainer.offset().left;
				iY_ = aPageXY[1] - oContainer.offset().top;
			} else {
				iX_ = oLoader.iWidth/2;
				iY_ = oLoader.iHeight/2;
			}

			var oInfo = {};
			if (ev) {
				oInfo = zingchart.getMouseInfo(ev, oLoader);
			}

			ZC.ZCUtils._trigger_event_('contextmenu', oLoader, oInfo);

			oLoader.buildContextMenu(oGraph?oGraph.iIndex:-1, ev);

			var iZIndex = -1;
			if (zingchart.CMZINDEX !== 0) {
				iZIndex = zingchart.CMZINDEX;
			} else {
				var oLayer = ZC._id_(oLoader.sId);
				while (iZIndex === -1 && oLayer.parentNode !== null) {
					iZIndex = ZC._i_(ZC.ZCQuery(oLayer).css('zIndex'));
					if (iZIndex === 'auto' || iZIndex === '' || ZC._n_(iZIndex) === null) {
						iZIndex = -1;
					}
					oLayer = oLayer.parentNode;
				}
			}
			if (!iZIndex || iZIndex === -1 || ZC._n_(iZIndex) === null) {
				iZIndex = 1;
			}
			var oMenu = ZC.ZCQuery('#' + oLoader.sId + '-menu');
			oMenu.css('zIndex', zingchart.ZINDEX + iZIndex + 1);
			if (ZC._n_(sLoaderId) === null) {
				if (ev.target.id === (oLoader.sId + '-print-png') || ev.target.id === (oLoader.sId + '-print-jpeg')) {
					return true;
				} else {
					ev.preventDefault();
				}
			}
			if (!ZC._id_(oLoader.sId + '-menu')) {
				return false;
			}

			iX_ = oContainer.offset().left;
			iY_ = oContainer.offset().top;
			var iWidth_ = oContainer.width();
			var iHeight_ = oContainer.height();
			if (ZC._n_(sLoaderId) === null) {
				aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				iPageX = aPageXY[0] || ZC.aPageXY[0];
				iPageY = aPageXY[1] || ZC.aPageXY[1];
			} else {
				iPageX = iX_ + oLoader.iWidth/2;
				iPageY = iY_ + 5;
			}
			
			var bHistoryGroup = false;
			oLoader.toggleMenuItem('goback', false);
			if (oLoader.iHistory > 0) {
				oLoader.toggleMenuItem('goback', true);
				bHistoryGroup = true;
			}
			oLoader.toggleMenuItem('goforward', false);
			if (oLoader.iHistory < oLoader.aHistory.length-1) {
				oLoader.toggleMenuItem('goforward', true);
				bHistoryGroup = true;
			}
			oLoader.toggleMenuItem('history', bHistoryGroup, true);
			
			if (iPageX >= iX_ && iPageX <= iX_ + iWidth_ && iPageY >= iY_ && iPageY <= iY_ + iHeight_) {
				ZC.ZCQuery('.zc-menu').each(function() {
					if (this.id !== (oLoader.sId + '-menu')) {
						oLoader.hideCM();
					}
				});
				oLoader.aRClickXY = [iPageX, iPageY, (ZC._n_(sLoaderId) === null)?ev.target.id:sLoaderId];

				oMenu.css('opacity', 0).show();
				var iMenuWidth = ZC._i_(oMenu.css('width')), iMenuHeight = ZC._i_(oMenu.css('height'));
				oMenu.css('opacity', 1).hide();

				var iLeft, iTop;
				if (ZC._n_(sLoaderId) === null && ev.target.id === oLoader.sId + '-menu-area') {
					ZC._id_(oLoader.sId + '-menu').style.paddingTop = 0;
					var oMenuArea = ZC.ZCQuery('#' + oLoader.sId + '-menu-area');
					var aMenuAreaCoords = oMenuArea.attr('coords').split(',');
					var iAreaHeight = ZC._i_(aMenuAreaCoords[3]) - ZC._i_(aMenuAreaCoords[1]);
					ZC._id_(oLoader.sId + '-menu').style.backgroundPosition = ((ZC._i_(aMenuAreaCoords[0]) > oLoader.iWidth/2)?'100% 0% !important':'0% 0% !important');
					iLeft = iX_ + ((ZC._i_(aMenuAreaCoords[0]) > oLoader.iWidth/2)?(ZC._i_(aMenuAreaCoords[2]) - iMenuWidth):ZC._i_(aMenuAreaCoords[0]));
					iTop = iY_ + ((ZC._i_(aMenuAreaCoords[1]) > oLoader.iHeight/1.25)?(ZC._i_(aMenuAreaCoords[3]) - iMenuHeight - iAreaHeight):(ZC._i_(aMenuAreaCoords[3])));
				} else {
					ZC._id_(oLoader.sId + '-menu').style.backgroundPosition = '50% 0% !important';
					iLeft = oLoader.aRClickXY[0] - iMenuWidth/2;
					iTop = oLoader.aRClickXY[1];
					if (iMenuHeight > oLoader.iHeight) {
						iTop = iY_;
					} else {
						if (iTop - iY_ + iMenuHeight > oLoader.iHeight) {
							iTop = ZC._max_(iTop - iMenuHeight, oLoader.iHeight - iMenuHeight);
						}
					}
					if (iLeft < iX_) {
						iLeft = ZC._max_(iLeft, iX_);
					}
					if (iLeft + iMenuWidth > iX_ + oLoader.iWidth) {
						iLeft = ZC._min_(iX_ + oLoader.iWidth - iMenuWidth/2, iLeft - iMenuWidth/2);
					}
				}
				oMenu.css('left', ZC._max_(1, iLeft) + 'px').css('top', ZC._max_(1, iTop) + 'px').show();
				oLoader.bCM = true;
				return false;
			}
		}
	};
	ZC.ZCQuery(document).bind('contextmenu', zingchart.zc_contextmenu);
}

zingchart.addCssRule = function(sSelector, sRule) {
	if (zingchart.css) {
		if (zingchart.css.addRule) {
			return zingchart.css.addRule(sSelector, sRule);
		} else {
			return zingchart.css.insertRule(sSelector + '{' + sRule + '}', 0);
		}
	}
};

zingchart.wh = function(oContainer, sWidth, sHeight) {
	if (sWidth === 'auto') {
		sWidth = '100%';
	}
	if (sHeight === 'auto') {
		sHeight = '100%';
	}
	var iWidth, iHeight;
	if ((''+sWidth).indexOf('%') !== -1) {
		iWidth = oContainer.width()*parseInt(sWidth, 10)/100;
	} else {
		iWidth = parseInt(sWidth, 10);
	}
	if ((''+sHeight).indexOf('%') !== -1) {
		iHeight = oContainer.height()*parseInt(sHeight, 10)/100;
	} else {
		iHeight = parseInt(sHeight, 10);
	}
	return [iWidth, iHeight];
};


zingchart.EVENTSMAP = {};
zingchart.bind = function(sId, sEvent, oFn) {
	sId = sId || 'zingchart-global';
	if (!zingchart.EVENTSMAP[sId]) {
		zingchart.EVENTSMAP[sId] = {};
	}
	if (!zingchart.EVENTSMAP[sId][sEvent]) {
		zingchart.EVENTSMAP[sId][sEvent] = [{fn : oFn}];
	} else {
		zingchart.EVENTSMAP[sId][sEvent].push({fn : oFn});
	}
};
zingchart.unbind = function(sId, sEvent, oFn) {
	sId = sId || 'zingchart-global';
	if (zingchart.EVENTSMAP[sId] && zingchart.EVENTSMAP[sId][sEvent]) {
		if (!oFn) {
			zingchart.EVENTSMAP[sId][sEvent] = null;
		} else {
			for (var i=0,iLen=zingchart.EVENTSMAP[sId][sEvent].length;i<iLen;i++) {
				if (zingchart.EVENTSMAP[sId][sEvent][i].fn === oFn) {
					zingchart.EVENTSMAP[sId][sEvent].splice(i, 1);
					break;
				}
			}
		}
	}
};
zingchart.callEvent = function(sId, sEvent, aArgs, oValue) {
	sId = sId || 'zingchart-global';
	if (zingchart.EVENTSMAP[sId] && zingchart.EVENTSMAP[sId][sEvent]) {
		for (var i=0,iLen=zingchart.EVENTSMAP[sId][sEvent].length;i<iLen;i++) {
			if (oValue) {
				aArgs[aArgs.length-1] = zingchart.EVENTSMAP[sId][sEvent][i].fn.apply(zingchart, aArgs);
			} else {
				zingchart.EVENTSMAP[sId][sEvent][i].fn.apply(zingchart, aArgs);
			}
		}
		if (oValue) {
			return aArgs[aArgs.length-1];
		}
	}
};
zingchart.hasEvent = function(sId, sEvent) {
	sId = sId || 'zingchart-global';
	return zingchart.EVENTSMAP[sId] && zingchart.EVENTSMAP[sId][sEvent];
};


zingchart.render_html5 = function(oParams, sOutput) {

	

	ZC._todash_(oParams, false);

	
	var aFlags = [], mValue, mValue_, i, iLen, sWidth, sHeight, iWidth, iHeight;
	if (ZC._n_(mValue=oParams['flags']) !== null) {
		aFlags = mValue.split(',');
	}
	if (ZC._n_(mValue=oParams['mode']) !== null) {
		switch (mValue) {
			case 'static':
				aFlags = ['skip_context_menu','skip_segment_tracking','skip_marker_tracking','skip_interactivity','use_single_canvas'];
				break;
		}
	}

	var sId = '';
	if (ZC._n_(mValue=oParams['container']) !== null) {
		sId = mValue;
	}
	if (ZC._n_(mValue=oParams['id']) !== null) {
		sId = mValue;
	}

	if (!ZC._id_(sId)) {
		return;
	}

	zingchart.params[sId] = {};
	ZC._cp_(oParams, zingchart.params[sId]);

	var sStage = null;
	for (i=0;i<zingchart.aLoaders.length;i++) {
		if (zingchart.aLoaders[i].sId === sId) {
			sStage = zingchart.aLoaders[i].sStage;
		}
	}

	
	
	if (ZC._n_(sStage) !== null) {
		if (sStage === '') {
			
			zingchart.exec(sId, 'destroy');
		} else {
			return;
		}
	}

	var bFound = false;
	var oLoader = null;
	for (i=0;i<zingchart.aLoaders.length;i++) {
		if (zingchart.aLoaders[i].sId === sId) {
			zingchart.aLoaders[i] = new ZC.ZCLoader();
			oLoader = zingchart.aLoaders[i];
			bFound = true;
		}
	}

	if (!bFound) {
		oLoader = new ZC.ZCLoader();
		oLoader.sStage = 'init';
		zingchart.aLoaders.push(oLoader);
	}
	

	

	oLoader.sId = sId;

	if (sOutput === 'vml' && !zingchart.bVmlReady) {
		
		
		zingchart.render_html5(oParams, sOutput);
	}

	if (!zingchart.bCSSInit) {
		zingchart.bCSSInit = true;
		var oCssRules = {
			'.zc-style' : 'font-family:'+zingchart.FONTFAMILY+';font-size:'+zingchart.FONTSIZE+'px;font-weight:normal;font-style:normal;text-decoration:none;text-shadow:none;',
			'.zc-style *' : 'font-family:'+zingchart.FONTFAMILY+';font-size:'+zingchart.FONTSIZE+'px;font-weight:normal;font-style:normal;text-decoration:none;text-shadow:none;',
			'.zc-top *' : 'text-align:left;margin:auto;text-shadow:none;',
			'.zc-menu *' : 'text-align:left;margin:auto;',
      		'.zc-main text' : '-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;',
			'.zc-img' : '-webkit-user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;',
			'.zc-map' : '-webkit-user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;',
			'.zc-pixmap' : '-webkit-user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;',
			'.zc-preview-mask' : 'cursor:default;-webkit-user-select:none;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;',
			
			'.zc-about' : 'position:absolute;overflow:hidden;border:5px solid #fff;background:#003C4F url(' + (ZC.ie67?'//':ZC.LOGO_ABOUT) + ') no-repeat center 10px',
			'.zc-about-1' : 'padding:80px 5px 5px 5px;text-align:center !important;',
			'.zc-about-1 a' : 'color:#1AB6E3;font-size:17px;line-height:125%;',
			'.zc-about-2' : 'padding:5px;color:#fff;text-align:center !important;',
			'.zc-about-3' : 'padding:5px;text-align:center;line-height:125%;',
			'.zc-about-3 div' : 'background-color:#1AB6E3;line-height:125%;color:#fff;border:1px solid #fff;padding:5px 10px;font-weight:bold;width:60px;margin:0 auto;cursor:pointer;text-align:center',
			'.zc-about-4' : 'color:#fff;line-height:125%;',
			'.zc-about-4 div' : 'float:right;color:#fff;line-height:125%;',
			'.zc-viewsource' : 'border:5px solid #fff;background:#999',
			'.zc-error' : 'border:5px solid #fff;background:#900',
			'.zc-bugreport' : 'border:5px solid #fff;background:#999',
			'.zc-form-row-label' : 'padding:4px 10px 2px;text-align:left;color:#fff',
			'.zc-form-row-element' : 'padding:2px 8px',
			'.zc-form-row-last' : 'padding:8px 8px 2px !important',
			'.zc-form-row-element textarea' : 'text-align:left;background:#fff;color:#000;border:1px solid #333;',
			'.zc-form-row-label input' : 'color:#000;padding:2px;margin:0 5px 0 0;background-color:#999;',
			'.zc-form-row-element input' : 'color:#000;padding:2px;margin:0;background-color:#fff',
			'.zc-form-row-last input' : 'padding:4px 10px !important;margin:0 20px 0 0 !important;background-color:#eee !important;border:2px outset #ccc !important',
			'.zc-form-s0' : 'font-size:27px !important;letter-spacing:-1px;line-height:125%',
			'.zc-form-s1' : 'font-size:17px !important;line-height:125%',
			'.zc-form-s1 a' : 'color:#fff;padding:3px 10px;position:relative;top:4px;border:1px solid #333;border-bottom:0px solid #333',
			'.zc-tab-active' : 'background-color:#fff;color:#333 !important',
			'.zc-tab-inactive' : 'background-color:#999;color:#ddd !important',
			'.zc-bugreport label' : 'display:inline-block;position:relative;top:-2px',
			'.zc-viewimage div' : 'position:absolute;text-align:center;padding:5px;background:#999;color:#fff',
			'.zc-license-ie67' : 'padding:0;position:absolute;font-size:12px;font-weight:bold;font-family:Arial;color:#369;text-align:left',
			'.zc-license' : 'padding:0;position:absolute;',
			'#zc-fullscreen' : 'display:block;position:absolute;top:0;left:0;width:100%;height:100%;margin:0;padding:0;background:#fff;',
			'.zc-menu' : 'position:absolute;display:none;background-repeat:no-repeat !important;background-position:50% 0% !important;',
			'.zc-menu-sep' : 'font-size:1px;padding:0;line-height:1px;border-bottom:1px solid #000',
			'.zc-menu-item' : 'cursor:pointer;white-space:nowrap',
			'.zc-blocker' : 'background:#eee',
			'.zc-blocker div.zc-blocker-msg' : 'position:absolute;border:2px solid #ccc;padding:10px 30px;background-color:#333;color:#fff',
			'.zc-modal' : 'background-color:#fff;color:#000;border:2px solid #999',
			'.zc-rel' : 'top:0;left:0;position:relative',
			'.zc-abs' : 'top:0;left:0;position:absolute'
		};
		var oHead = document.getElementsByTagName('head')[0];
		var oStyle = document.createElement('style');
		oStyle.type = 'text/css';
		
		oHead.appendChild(oStyle);
		
		if (!zingchart.css) {
			zingchart.css = document.styleSheets[document.styleSheets.length-1];
		}
		for (var sSelector in oCssRules) {
			if (ZC._n_(zingchart.USERCSS[sSelector]) !== null) {
				zingchart.addCssRule(sSelector, zingchart.USERCSS[sSelector]);
			} else {
				zingchart.addCssRule(sSelector, oCssRules[sSelector]);
			}
		}
	}
	if (sOutput === 'vml' && !zingchart.bVMLInit) {
		document.namespaces.add('zcv', 'urn:schemas-microsoft-com:vml');
		var oStyleSheet = document.createStyleSheet();
		oStyleSheet.cssText = ".zcvml { behavior:url(#default#VML); }";
		zingchart.bVMLInit = true;
	}

	var sTheme = '';
	if (ZC._n_(mValue=oParams['theme']) !== null) {
		sTheme = mValue;
	}
	var bValidApiKey = false;
	if (ZC._n_(mValue=oParams['apikey']) !== null) {
		if (ZC._i_(mValue) === 1) {
			bValidApiKey = true;
		}
	}

	var oXhrCache = {
		data : false,
		defaults : false,
		css : false,
		csv : false
	};
	if (ZC._n_(mValue=oParams['cache']) !== null) {
		for (var sType in oXhrCache) {
			if (ZC._n_(mValue_=mValue[sType]) !== null) {
				oXhrCache[sType] = ZC._b_(mValue_);
			}
		}
	}
	var bFullScreen = false;
	if (ZC._n_(mValue=oParams['fullscreen']) !== null) {
		bFullScreen = ZC._b_(mValue);
	}
	var bAutoResize = true;
	if (ZC._n_(mValue=oParams['auto-resize']) !== null) {
		bAutoResize = ZC._b_(mValue);
	}
	var oContainer = ZC.ZCQuery('#' + sId);
	sWidth = (oParams['width'] || '100%') + '';
	sHeight = (oParams['height'] || '100%') + '';
	if (sWidth === 'auto') {
		sWidth = '100%';
	}
	if (sHeight === 'auto') {
		sHeight = '100%';
	}
	var aWH = zingchart.wh(oContainer, sWidth, sHeight);
	iWidth = aWH[0];
	iHeight = aWH[1];
	if (bFullScreen) {
		iWidth = ZC.ZCQuery(window).width();
		iHeight = ZC.ZCQuery(window).height();
		document.body.style.overflow = 'hidden';
	}
	if (iWidth < 10 || iHeight < 10) {
		iWidth = 640;
		iHeight = 480;
	}
	
	
	iWidth = (iWidth===0)?640:iWidth;
	iHeight = (iHeight===0)?480:iHeight;
	var sDataUrl = oParams['dataurl'] || '';
	var sDefaultsUrl = oParams['defaultsurl'] || '';
	var oDefaultsObj = null;
	var sData = '';
	var oDataObj = null;
	if (ZC._n_(mValue=oParams['data']) !== null) {
		if (typeof(mValue) === 'string') {
			sData = mValue;
		} else {
			oDataObj = JSON.parse(JSON.stringify(mValue));
		}
	}
	if (ZC._n_(mValue=oParams['defaults']) !== null) {
		if (typeof(mValue) === 'string') {
			mValue = JSON.parse(mValue);
		}
		oDefaultsObj = mValue;
	}

	

	if (ZC._n_(mValue=oParams['imggen']) !== null) {
		oLoader.bImgGen = ZC._b_(mValue);
	}
	if (oLoader.bImgGen) {
		oLoader.oDOMFragments = null;
	}
	oLoader.sWH = sWidth + '/' + sHeight;
	oLoader.sOutput = sOutput;
	oLoader.oParent = oLoader;
	oLoader.iX = 0;
	oLoader.iY = 0;
	oLoader.iWidth = iWidth;
	oLoader.iHeight = iHeight;
	oLoader.sDataUrl = sDataUrl;
	oLoader.sData = sData;
	oLoader.oDataObj = oDataObj;
	oLoader.sDefaultsUrl = sDefaultsUrl;
	oLoader.oDefaultsObj = oDefaultsObj;
	oLoader.bValidApiKey = bValidApiKey;
	if (ZC._n_(oParams['fullscreenmode']) !== null && ZC._b_(oParams['fullscreenmode'])) {
		oLoader.bFullScreenMode = true;
	}
	oLoader.bFullScreen = bFullScreen;
	oLoader.oXhrCache = oXhrCache;
	oLoader.aFlags = aFlags;
	oLoader.sTheme = sTheme;
	
	oLoader.oLoader = oLoader;
	oLoader.oAttributes['hideprogresslogo'] = false;
	if (ZC._n_(mValue=oParams['hideprogresslogo']) !== null) {
		oLoader.oAttributes['hideprogresslogo'] = ZC._b_(mValue);
	}
	if (ZC._n_(mValue=oParams['customprogresslogo']) !== null) {
		oLoader.oAttributes['customprogresslogo'] = mValue;
	}
	if (ZC._n_(mValue=oParams['exportdataurl']) !== null) {
		oLoader.oAttributes['exportdataurl'] = mValue;
	}
	if (ZC._n_(mValue=oParams['exportimageurl']) !== null) {
		oLoader.oAttributes['exportimageurl'] = mValue;
	}
	var oProgress = {};
	if (ZC._n_(mValue=oParams['bgcolor']) !== null) {
		oProgress['background-color'] = mValue;
	}
	if (ZC._n_(mValue=oParams['background-color']) !== null) {
		oProgress['background-color'] = mValue;
	}
	if (ZC._n_(mValue=oParams['border-color']) !== null) {
		oProgress['border-color'] = mValue;
	}
	if (ZC._n_(mValue=oParams['border-width']) !== null) {
		oProgress['border-width'] = mValue;
	}
	if (ZC._n_(mValue=oParams['color']) !== null) {
		oProgress['color'] = mValue;
	}
	oLoader.oAttributes['progress'] = oProgress;
	if (ZC._n_(mValue=oParams['auto-load-modules']) !== null) {
		oLoader.bAutoLoadModules = ZC._b_(mValue);
	}
	if (ZC._n_(mValue=oParams['events']) !== null) {
		oLoader.oEvents = mValue;
	}
	if (ZC._n_(mValue=oParams['modules']) !== null) {
		oLoader.sModules = mValue;
	}
	if (ZC._n_(mValue=oParams['format']) !== null) {
		oLoader.sFormat = mValue;
	}
	if (ZC._n_(mValue=oParams['csvdata']) !== null) {
		oLoader.sCsvData = mValue;
	}
	if (ZC._n_(mValue=oParams['locale']) !== null) {
		if (ZC._n_(zingchart.i18n[mValue]) !== null) {
			oLoader.sLocale = mValue;
			ZC.ZCLabels = zingchart.i18n[mValue];
		}
	}
	if (ZC._n_(mValue=oParams['cache-control']) !== null) {
		oLoader.sCacheControl = mValue;
	}

	
		oLoader.render();
	
	

	oContainer.css('overflow', 'hidden');
	if (oLoader.bFullScreen) {
		oContainer.css('position', 'absolute').css('top', 0).css('left', 0);
	}
	oLoader.sWidth = sWidth;
	oLoader.sHeight = sHeight;
	if (((oLoader.sWidth.indexOf('%') !== -1 || oLoader.sHeight.indexOf('%') !== -1) || oLoader.bFullScreen || oLoader.bFullScreenMode) && bAutoResize) {
		var oContainerDim = (oLoader.bFullScreenMode || oLoader.bFullScreen)?ZC.ZCQuery(window):oContainer;
		var iWidth_ = oContainerDim.width();
		var iHeight_ = oContainerDim.height();
		var iCnt_ = 0;
		oLoader.iAutoResizeTick = window.setInterval(function() {
			var aWH;
			if (ZC._id_(sId) && !oLoader.bLockResize) {
				if (iCnt_ === 0 && (oContainerDim.width() !== iWidth_ || oContainerDim.height() !== iHeight_)) {
					iWidth_ = oContainerDim.width();
					iHeight_ = oContainerDim.height();
					if (iWidth_ > 10 && iHeight_ > 10) {
						oLoader.iWidth = iWidth_;
						oLoader.iHeight = iHeight_;						
						
						for (i=0,iLen=oLoader.aGraphs.length;i<iLen;i++) {
							oLoader.aGraphs[i].aFeedStatus[0] = 0;
						}
						
						oLoader.resize();
					}
				} else {
					if ((oContainerDim.width() + oContainerDim.height() > 0) && (oContainerDim.width() !== iWidth_ || oContainerDim.height() !== iHeight_)) {
						if (oLoader.bFullScreen || oLoader.bFullScreenMode) {
							aWH = zingchart.wh(oContainerDim, (''+oContainerDim.width()), (''+oContainerDim.height()));
						} else {
							aWH = zingchart.wh(oContainerDim, oLoader.sWidth, oLoader.sHeight);
						}
						if (aWH[0] > 10 && aWH[1] > 10) {
							oLoader.iWidth = aWH[0];
							oLoader.iHeight = aWH[1];
							iWidth_ = oContainerDim.width();
							iHeight_ = oContainerDim.height();
							
							for (i=0,iLen=oLoader.aGraphs.length;i<iLen;i++) {
								oLoader.aGraphs[i].aFeedStatus[0] = 0;
							}
							
							oLoader.resize();
						}
					}
				}
				iCnt_++;
			} else {
				window.clearInterval(oLoader.iAutoResizeTick);
			}
		}, 250);
	}
	return oLoader;
};
window.zingchart = zingchart;
if (ZC.ZCQuery.browser.msie && parseFloat(ZC.ZCQuery.browser.version) < 9) {
	var _window_onunload_ = window.onunload;
	window.onunload = function() {
		while (zingchart.aLoaders.length) {
			zingchart.exec(zingchart.aLoaders[0].sId, 'destroy');
			
		}

		ZC.ZCQuery(document)
			.unbind(ZC.ZCHtmlUtils._event_('mousemove'), zingchart.zc_mouseevent)
			.unbind(ZC.ZCHtmlUtils._event_('mousedown'), zingchart.zc_mouseevent)
			.unbind(ZC.ZCHtmlUtils._event_('mouseup'), zingchart.zc_mouseevent)
			.unbind('click', zingchart.zc_click)
			.unbind('contextmenu', zingchart.zc_contextmenu);

		zingchart.aLoaders = [];

		if (_window_onunload_) {
			_window_onunload_();
		}
	};
}



zingchart.i18n.en_us = {
	'rtl' : false,
	'decimals-separator' : '.',
	'thousands-separator' : '',
	
	'menu-reload' : 'Reload',
	'menu-print' : 'Print Chart',
	'menu-viewaspng' : 'View As PNG',
	'menu-viewasjpg' : 'View As JPG',
	'menu-downloadpdf' : 'Download PDF',
	'menu-downloadsvg' : 'Download SVG',
	'menu-exportdata' : 'Export Data',
	'menu-zoomin' : 'Zoom In',
	'menu-zoomout' : 'Zoom Out',
	'menu-viewall' : 'View All',
	'menu-viewsource' : 'View Source',
	'menu-bugreport' : 'Submit Bug',
	'menu-switchto2d' : 'Switch To 2D',
	'menu-switchto3d' : 'Switch To 3D',
	'menu-showguide' : 'Show Guide',
	'menu-hideguide' : 'Hide Guide',
	'menu-switchtolin' : 'Show Linear Scale',
	'menu-switchtolog' : 'Show Log Scale',
	'menu-fullscreen' : 'Full Screen',
	'menu-exitfullscreen' : 'Exit Full Screen',
	'menu-goback' : 'Go Back',
	'menu-goforward' : 'Go Forward',
	'date-formats' : {
		'msecond' : '%d %M %Y<br>%g:%i:%s %A<br>%q ms',
		'second' : '%d %M %Y<br>%g:%i:%s %A',
		'minute' : '%d %M %Y<br>%g:%i %A',
		'hour' : '%d %M %Y<br>%g %A',
		'day' : '%d %M %Y',
		'month' : '%M %Y',
		'year' : '%Y'
	},
	'days-short' : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
	'days-long' : ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
	'months-short' : ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
	'months-long' : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
	'sync-wait' : 'Wait...',
	'export-wait' : 'Exporting...',
	'progress-wait-long' : 'Wait. Loading...',
	'progress-wait-short' : 'Wait...',
	'progress-wait-mini' : '...',
	'error-header' : 'An Error Has Occured',
	'error-message' : 'Error Message:',
	'error-close' : 'Close',
	'bugreport-header' : 'Submit Bug Report',
	'bugreport-senddata' : 'Send JSON Data',
	'bugreport-sendcapture' : 'Send Graph Capture',
	'bugreport-yourcomment' : 'Your Comment:',
	'bugreport-jsondata' : 'JSON Data:',
	'bugreport-youremail' : 'Your Email Address',
	'bugreport-infoemail' : 'if you want to receive via email our reply to your problem',
	'bugreport-emailmandatory' : 'Email address is mandatory...',
	'bugreport-submit' : 'Submit',
	'bugreport-cancel' : 'Cancel',
	'bugreport-confirm' : 'Your bug report was sent.\n\nThank you!',
	'about-close' : 'Close',
	'viewsource-jsonsource' : 'Parsed JSON',
	'viewsource-originalsource' : 'Original JSON',
	'viewsource-close' : 'Close',
	'viewsource-apply' : 'Apply',
	'viewimage-close' : 'Close',
	'legend-pagination' : 'Page %page% of %pages%'
};
ZC.ZCLabels = zingchart.i18n.en_us;











zingchart.getLoader = function(sId) {
	for (var i=0;i<zingchart.aLoaders.length;i++) {
		if (zingchart.aLoaders[i].sId === sId) {
			return zingchart.aLoaders[i];
		}
	}
	return null;
};

zingchart.getGraph = function(oLoader, sId) {
	return oLoader.findGraph(sId);
};

zingchart.clearLayer = function(oLoader) {
	if (oLoader.oTooltip) {
		oLoader.oTooltip.onmouseout();
	}
	for (var i=0;i<oLoader.aGraphs.length;i++) {
		oLoader.aGraphs[i].hideLayer();
	}
};

zingchart.getGraphInfo = function(oLoader, oData, i) {
	return oLoader.getEarlyGraphInfo(oData, i);
};

zingchart.initThemes = function(oLoader) {
	if (oLoader) {
		oLoader.setupThemes(true);
	}
};

zingchart.setModule = function(sName) {
	ZC.aLoadedModules.push(sName);
};

zingchart.getModules = function(oLoader) {
	return oLoader.sModules.split(',');
};

zingchart.defineModule = function(sName, sType, fnCallback) {
	zingchart.setModule(sName);
	switch(sType){
		case 'chart':
			(function(){
				zingchart.bind(null, 'dataparse', function (oInfo, oData) {
					var nLen = oData['graphset'].length;
					for (var n = 0;n < nLen;n++) {
						if(oData['graphset'][n]['type'] == sName){
							var oGraphData = oData['graphset'][n];
							(oGraphData['id']) 
								?	oGraphData['id'] = oGraphData['id'] 
								:	oGraphData['id'] = sName.replace(/-/g, "") + n;
							oData['graphset'][n] = fnCallback(oGraphData);
						}
					}
				return oData;
				});
			}());
		break;
		case 'plugin':
			(function(){
				zingchart.bind(null, 'dataparse', function (oInfo, oData) {
					var oLoader = zingchart.getLoader(oInfo.id),
					aModules = zingchart.getModules(oLoader);
					if (aModules.indexOf(sName) != -1) {
						var nLen = oData['graphset'].length, oGraphData = null;
						for (var n = 0;n < nLen;n++) {
							oGraphData = oData['graphset'][n]; 
							if(oGraphData.hasOwnProperty(sName)){
								oData['graphset'][n] = fnCallback(oGraphData);
							}
						}
					}
				return oData;
				});
			}());
		break;
	}
};

zingchart.getPalette = function(oLoader, i, sType) {
	sType = sType || 'bar';
	return oLoader.oDefaults.findPalette(i, sType);
};

zingchart.getObject = function(oGraph, mObjectId, sType) {
	sType = sType || 'label';
	var i, iLen;
	switch (sType) {
		case 'shape':
			for (i=0,iLen=oGraph.aShapes.length;i<iLen;i++) {
				if (oGraph.aShapes[i].sObjectId === mObjectId || i === mObjectId) {
					return oGraph.aShapes[i].oShape;
				}
			}
			break;
		case 'label':
			for (i=0,iLen=oGraph.aLabels.length;i<iLen;i++) {
				if (oGraph.aLabels[i].sObjectId === mObjectId || i === mObjectId) {
					return oGraph.aLabels[i];
				}
			}
			break;
	}
	return null;
};



zingchart.getInstance = function(l, t) {
	switch (t) {
		case 'style':
			return new ZC.ZCStyle(l);
		case 'shape':
			return new ZC.ZCShape(l);
		case 'box':
			return new ZC.ZCBox(l);
		case 'textbox':
			return new ZC.ZCTextBox(l);
	}
	return null;
};

zingchart.normalize = function(o) {
	ZC._todash_(o);
};

zingchart.copy = function(s, d) {
	ZC._cp_(s, d);
};

zingchart.formatDate = function(iTs, sFormat, bUTC, iTimeZone) {
	return ZC.ZCUtils._date_(iTs, sFormat, bUTC, iTimeZone);
};

zingchart.fireEvent = function(sName, oLoader, oInfo) {
	ZC.ZCUtils._trigger_event_(sName, oLoader, oInfo);
};

zingchart.aAPIs = [];
zingchart.extendAPI = function(sCall, oAPI) {
	zingchart.aAPIs.push({call : sCall, api: oAPI});
};

zingchart.exec = function(sId, sCall, oParams) {
	
	var oLoader = zingchart.getLoader(sId);
	if (oLoader) {
		return zingchart.exec_html5(sId, sCall, oParams);
	} else {
		if (zingchart.exec_flash) {
			return zingchart.exec_flash(sId, sCall, oParams);
		}
	}
};

zingchart.exec_html5 = function(sId, sCall, oParams) {
	var mValue, i, iLen;
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var oLoader = zingchart.getLoader(sId), oGraph, oPlot, iPlotIndex, iNodeIndex;
	if (ZC._n_(oParams['preservezoom']) !== null) {
		oLoader.oAttributes['preservezoom'] = ZC._b_(oParams['preservezoom']);
	}
	if (oLoader) {
		switch (sCall) {
			case 'goback':
				if (oLoader.oHistory && (oLoader.iHistory > 0)) {
					ZC.ZCUtils._trigger_event_('history_back', oLoader, oLoader._api_loader_info_());
					oLoader.iHistory--;
					zingchart.exec(oLoader.sId, 'setdata', {data : oLoader.aHistory[oLoader.iHistory]});
				}
				break;
			case 'goforward':
				if (oLoader.oHistory && (oLoader.iHistory < oLoader.aHistory.length-1)) {
					ZC.ZCUtils._trigger_event_('history_forward', oLoader, oLoader._api_loader_info_());
					oLoader.iHistory++;
					zingchart.exec(oLoader.sId, 'setdata', {data : oLoader.aHistory[oLoader.iHistory]});
				}
				break;
			case 'setmode':
				
				if (typeof(oLoader.oAttributes['mode-flags']) === 'undefined') {
					oLoader.oAttributes['mode-flags'] = oLoader.aFlags.join(',');
				}
				
				if (oParams['mode'] === '' && typeof(oLoader.oAttributes['mode-flags']) !== 'undefined') {
					oLoader.aFlags = oLoader.oAttributes['mode-flags'].split(',');
				} else {
					oLoader.aFlags = [];
					var aModes = (''+oParams['mode']).split(',');
					if (ZC._indexof_(aModes, 'static') !== -1) {
						oLoader.aFlags.push('skip_context_menu','skip_objects_tracking','skip_segment_tracking','skip_marker_tracking','skip_interactivity');
					}
				}
				break;
			case 'showmenu':
				zingchart.zc_contextmenu(null, oLoader.sId);
				break;
			case 'hidemenu':
				oLoader.hideCM();
				break;
			case 'destroy':
			case 'zcdestroy':
				
				
				for (i=0,iLen=oLoader.aGraphs.length;i<iLen;i++) {
					oLoader.aGraphs[i].aFeedStatus[0] = 0;
				}
				
				if (zingchart.DEV.GC) {
					oLoader.gc();
				}

				oLoader.hideProgress();
				oLoader._api_clear_(oParams, true);
				if (oLoader.iAutoResizeTick) {
					window.clearInterval(oLoader.iAutoResizeTick);
				}
				
				if (zingchart.EVENTSMAP[sId]) {
					delete zingchart.EVENTSMAP[sId];
				}
				ZC.ZCHtmlUtils._remove_(
					[
						sId + '-top',
						sId + '-text-ruler',
						sId + '-dummy',
						sId + '-progress'
					]
				);
				var iIndex = ZC._indexof_(zingchart.aLoaders, oLoader);
				if (iIndex !== -1) {
					zingchart.aLoaders.splice(iIndex, 1);
				}
				oLoader = null;
				ZC.ZCUtils._trigger_event_('destroy', null, {id : sId});				
				break;
			case 'getrender':
				return oLoader.sOutput;
			case 'clear':
				oLoader._api_clear_(oParams);
				break;
			case 'reload':
				oLoader._api_reload_(oParams);
				break;
			case 'load':
				oLoader._api_load_(oParams);
				break;
			case 'enable':
				oLoader._api_enable_();
				break;
			case 'disable':
				oLoader._api_disable_(oParams['text']);
				break;
			case 'closemodal':
				ZC.ZCHtmlUtils._remove_([oLoader.sId + '-modal', oLoader.sId + '-blocker']);
				break;
			case 'openmodal':
				if (!ZC._id_(oLoader.sId + '-modal')) {
					ZC.ZCHtmlUtils._div_({
						cls : 'zc-abs zc-style zc-blocker',
						id : oLoader.sId + '-blocker',
						p : ZC._id_(oLoader.sId + '-top'),
						wh : oLoader.iWidth + '/' + oLoader.iHeight,
						opacity : 0.75
					});
					ZC.ZCHtmlUtils._div_({
						cls : 'zc-abs zc-style zc-modal',
						id : oLoader.sId + '-modal',
						p : ZC._id_(oLoader.sId + '-top'),
						tl : (oLoader.iHeight-oParams['height'])/2 + '/' + (oLoader.iWidth-oParams['width'])/2,
						wh : oParams['width'] + '/' + oParams['height'],
						opacity : 1
					});
					return ZC._id_(oLoader.sId + '-modal');
				}
				break;
			case 'mapdata':
				oLoader._api_data_map_(oParams);
				break;
			case 'print':
				oLoader._api_print_();
				break;
			case 'fullscreen':
				oLoader._api_fullscreen_();
				break;
			case 'exitfullscreen':
				zingchart.exec('zc-fullscreen', 'destroy');
				ZC.ZCHtmlUtils._remove_('zc-fullscreen');
				break;
			case 'resize':
				oLoader.bLockResize = true;
				var iWidth_ = oLoader.iWidth, iHeight_ = oLoader.iHeight;
				var aWH_ = oLoader.sWH.split('/');
				var bScale = false;
				var sWidth = aWH_[0], sHeight = aWH_[1];
				if (ZC._n_(mValue=oParams['width']) !== null) {
					sWidth = mValue;
				}
				if (ZC._n_(mValue=oParams['height']) !== null) {
					sHeight = mValue;
				}
				if (ZC._n_(mValue=oParams['scale']) !== null) {
					bScale = ZC._b_(mValue);
				}
				var aWH = zingchart.wh(ZC.ZCQuery('#'+oLoader.sId), sWidth, sHeight);
				if ((iWidth_ !== aWH[0] || iHeight_ !== aWH[1]) && (aWH[0] > 10 && aWH[1] > 10)) {
					oLoader.iWidth = aWH[0];
					oLoader.iHeight = aWH[1];
					if (ZC._n_(mValue=oParams['layout']) !== null) {
						oLoader.oData['layout'] = mValue;
					}
					if (oLoader.sStage === '') {
						oLoader.oAttributes['preservezoom'] = true;
						oLoader.resize(bScale);
						oLoader.sWidth = sWidth;
						oLoader.sHeight = sHeight;
						oLoader.bLockResize = false;
					}
				}
				break;
			case 'plothide':
			case 'hideplot':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oGraph._api_plot_showhide_(oParams, 'hide');
				}
				break;
			case 'showguide':
			case 'hideguide':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oLoader._api_guide_toggle_(oGraph.sId, (sCall==='showguide'));
				}
				break;
			case 'showtooltip':
			case 'hidetooltip':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (sCall === 'showtooltip') {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
						iPlotIndex = ZC._i_(oPlot?oPlot.iIndex:0);
						iNodeIndex = ZC._i_(oParams['nodeindex'] || '0');
						var ev = oParams['ev'] || {};
						ev.targetid = oGraph.sId + '-plotset-plot-' + iPlotIndex + '-node-' + iNodeIndex;
					}
					if (oGraph.oParent.oTooltip) {
						if (sCall === 'showtooltip') {
							oGraph.oParent.oTooltip.onmouseover(ev);
						} else {
							oGraph.oParent.oTooltip.hide();
						}
					}
				}
				break;
			case 'locktooltip':
				ZC.TTLOCK = true;
				break;
			case 'unlocktooltip':
				ZC.TTLOCK = false;
				break;
			case 'showhoverstate':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					iPlotIndex = ZC._i_(oPlot?oPlot.iIndex:0);
					iNodeIndex = ZC._i_(oParams['nodeindex'] || '0');
					var oNode = oGraph.oPlotSet.aPlots[iPlotIndex].getNode(iNodeIndex);
					oGraph.hideLayer();
					oNode.showLayer();
				}
				break;
			case 'plotshow':
			case 'showplot':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oGraph._api_plot_showhide_(oParams, 'show');
				}
				break;
			case 'togglesource':
				if (ZC._id_(oLoader.sId + '-viewsource')) {
					ZC.ZCHtmlUtils._remove_(oLoader.sId + '-viewsource');
				} else {
					oLoader._api_viewsource_();
				}
				break;
			case 'togglebugreport':
				if (ZC._id_(oLoader.sId + '-bugreport')) {
					ZC.ZCHtmlUtils._remove_(oLoader.sId + '-bugreport');
				} else {
					oLoader._api_bugreport_();
				}
				break;
			case 'toggleabout':
				if (ZC._id_(oLoader.sId + '-about')) {
					ZC.ZCHtmlUtils._remove_([oLoader.sId + '-about', oLoader.sId + '-about-mask']);
				} else {
					oLoader._api_about_();
				}
				break;
			case 'toggleplot':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oGraph._api_plot_toggle_(oParams);
				}
				break;
			case 'getcharttype':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					return oGraph.sType;
				}
				return null;
			case 'showversion':
			case 'getversion':
				return ZC.VERSION;
			case 'get3dview':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					return oGraph.o3DAspect;
				}
				return null;
			case 'set3dview':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (ZC._n_(oLoader.oData['graphset'][oGraph.iIndex]['3d-aspect']) === null) {
						oLoader.oData['graphset'][oGraph.iIndex]['3d-aspect'] = {};
					}
					ZC._cp_(oParams, oLoader.oData['graphset'][oGraph.iIndex]['3d-aspect']);
					if (ZC._n_(oGraph.oData['3d-aspect']) === null) {
						oGraph.oData['3d-aspect'] = {};
					}
					ZC._cp_(oParams, oGraph.oData['3d-aspect']);
					zingchart.SKIP.PARSE3D = true;
					oGraph.repaint(true, true);
					zingchart.SKIP.PARSE3D = false;
				}
				break;
			case 'getpage':
				return oLoader.iPage;
			case 'setpage':
				var iPage = 0;
				if (ZC._n_(mValue=oParams['page']) !== null) {
					iPage = ZC._i_(mValue);
				}
				oLoader.iPage = iPage;
				ZC._delay_(function() {
					oLoader.clear();
					oLoader.parse();
					oLoader.paint();
				}, true);
				break;
		}
	}
	var mValue_;
	if (zingchart.exec_html5_data) {
		mValue_ = zingchart.exec_html5_data(sId, sCall, oParams);
		if (mValue_ !== null) {
			mValue = mValue_;
		}
	}
	if (zingchart.exec_html5_objects) {
		mValue_ = zingchart.exec_html5_objects(sId, sCall, oParams);
		if (mValue_ !== null) {
			mValue = mValue_;
		}
	}
	if (zingchart.exec_html5_export) {
		mValue_ = zingchart.exec_html5_export(sId, sCall, oParams);
		if (mValue_ !== null) {
			mValue = mValue_;
		}
	}
	if (zingchart.exec_html5_zoom) {
		mValue_ = zingchart.exec_html5_zoom(sId, sCall, oParams);
		if (mValue_ !== null) {
			mValue = mValue_;
		}
	}
	if (zingchart.exec_html5_selection) {
		mValue_ = zingchart.exec_html5_selection(sId, sCall, oParams);
		if (mValue_ !== null) {
			mValue = mValue_;
		}
	}
	if (zingchart.exec_html5_feed) {
		mValue_ = zingchart.exec_html5_feed(sId, sCall, oParams);
		if (mValue_ !== null) {
			mValue = mValue_;
		}
	}

	for (i=0,iLen=zingchart.aAPIs.length;i<iLen;i++) {
		if (sCall === zingchart.aAPIs[i]['call']) {
			mValue_ = zingchart.aAPIs[i]['api'].call(zingchart, sId, oParams);
			if (mValue_ !== null) {
				mValue = mValue_;
			}
		}
	}

	return mValue;
};

zingchart.extendAPI('addmenuitem', function(sId, oParams) {
	var oLoader = zingchart.getLoader(sId);
	oLoader.oGui['context-menu'] = oLoader.oGui['context-menu'] || {};
	oLoader.oGui['context-menu']['custom-items'] = oLoader.oGui['context-menu']['custom-items'] || [];
	var sMenuId = oParams['id'] || '';
	var aCI = oLoader.oGui['context-menu']['custom-items'];
	var bFound = false;
	for (var i=0;i<aCI.length;i++) {
		if (aCI[i]['id'] === sMenuId) {
			bFound = true;
			break;
		}
	}
	if (!bFound) {
		oLoader.oGui['context-menu']['custom-items'].push(oParams);
	}
});














zingchart.exec_html5_data = function(sId, sCall, oParams) {
	var mValue;
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var oLoader = zingchart.getLoader(sId);
	var bUpdate = !(ZC._n_(oParams['update']) !== null && !ZC._b_(oParams['update']));
	var bHistory = (ZC._n_(oParams['history']) !== null && ZC._b_(oParams['history']));
	var bSmart = (typeof(oParams['smart']) !== 'undefined' && ZC._b_(oParams['smart']));
	var oGraph, oInfo, oPlot, oNode, i, iLen, v, vLen, k, iPlotIndex, oData, sKey, sScale, j, jLen, aPlotValues, aScaleValues, iNodeIndex, aValues;
	if (oLoader) {
		
		var aIgnore = ['addplot', 'removeplot', 'modify', 'modifyplot', 'setnodevalue', 'addnode', 'removenode', 'setdata'];
		if (ZC._indexof_(aIgnore, sCall) === -1) {
			oInfo = oLoader._api_loader_info_();
			oInfo['params'] = oParams;
			ZC.ZCUtils._trigger_event_(sCall, oLoader, oInfo);
		}

		switch (sCall) {
			
			
			case 'clearscroll':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (!oGraph) {
					return null;
				}
				if (oGraph.oScrollX && oGraph.oScrollX.zc_scroll_mouseup) {
					oGraph.oScrollX.zc_scroll_mouseup();
					oGraph.oScrollX.unbind();
				}
				if (oGraph.oScrollY && oGraph.oScrollY.zc_scroll_mouseup) {
					oGraph.oScrollY.zc_scroll_mouseup();
					oGraph.oScrollY.unbind();
				}
				break;
			
			case 'getbubblesize':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						return oPlot.getSize(oParams['value'] || 1);
					}
				}
				return null;
			case 'getobjectinfo':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (!oGraph) {
					return null;
				}
				var oAttrs = {
					id : 'sId',
					x : 'iX',
					y : 'iY',
					width : 'iWidth',
					height : 'iHeight',
					color : 'sColor',
					lineColor : 'sLineColor',
					lineWidth : 'iLineWidth',
					borderColor : 'sBorderColor',
					borderWidth : 'iBorderWidth',
					backgroundColor1 : 'sBackgroundColor1',
					backgroundColor2 : 'sBackgroundColor2'
				};
				switch (oParams['object']) {
					case 'graph':
						oInfo = {};
						for (k in oAttrs) {
							oInfo[k] = oGraph[oAttrs[k]];
						}
						ZC._cp_({
							type : oGraph.sType
						}, oInfo);
						return oInfo;
					case 'plotarea':
						oInfo = {};
						for (k in oAttrs) {
							oInfo[k] = oGraph.oPlotArea[oAttrs[k]];
						}
						return oInfo;
					case 'scale':
						var oScale = oGraph.getScaleByName(oParams['name'] || '');
						if (!oScale) {
							return null;
						}
						oInfo = {};
						for (k in oAttrs) {
							oInfo[k] = oScale[oAttrs[k]];
						}
						ZC._cp_({
							type : oScale.sType,
							text : (oScale.oLabel?(oScale.oLabel.sText || ''):''),
							datetime : (oScale.oTransform !== null && oScale.oTransform.oData['type'] === 'date'),
							step : oScale.fStep,
							step_ : oScale.fStep_,
							stepSize : oScale.iStepSize,
							values : oScale.aValues,
							placement : oScale.sPlacement
						}, oInfo);
						if (oScale.sType === 'v') {
							ZC._cp_({
								progression : oScale.sProgression,
								minValue : oScale.fMin,
								maxValue : oScale.fMax,
								minValue_ : oScale.fMin_,
								maxValue_ : oScale.fMax_
							}, oInfo);
						} else {
							ZC._cp_({
								minValue : oScale.aValues[oScale.iMinIndex],
								maxValue : oScale.aValues[oScale.iMaxIndex],
								minValue_ : oScale.aValues[oScale.iMinIndex_],
								maxValue_ : oScale.aValues[oScale.iMaxIndex_],
								minIndex : oScale.iMinIndex,
								maxIndex : oScale.iMaxIndex,
								minIndex_ : oScale.iMinIndex_,
								maxIndex_ : oScale.iMaxIndex_
							}, oInfo);
						}
						return oInfo;
					case 'plot':
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
						if (!oPlot) {
							return null;
						}
						oInfo = {};
						for (k in oAttrs) {
							oInfo[k] = oPlot[oAttrs[k]];
						}
						var bVisible = oPlot.bVisible && oGraph.oAttributes['plot' + oPlot.iIndex + '.visible'];
						ZC._cp_({
							visible : bVisible,
							id : oPlot.sObjectId,
							index : oPlot.iIndex,
							type : oPlot.sType,
							text : oPlot.sText,
							values : oPlot.aValues,
							scales : oPlot.aScales,
							stacked : oPlot.bStacked,
							stackType : oPlot.sStackType,
							stack : oPlot.iStack,
							xdata : oPlot.oXData
						}, oInfo);
						if (oPlot.oMarkerRef) {
							ZC._cp_({
								marker : {
									visible : oPlot.oMarkerRef.bVisible,
									size : oPlot.oMarkerRef.iSize,
									type : oPlot.oMarkerRef.sShape,
									backgroundColor1 : oPlot.oMarkerRef.sBackgroundColor1,
									backgroundColor2 : oPlot.oMarkerRef.sBackgroundColor2,
									borderColor : oPlot.oMarkerRef.sBorderColor,
									borderWidth : oPlot.oMarkerRef.iBorderWidth
								}
							}, oInfo);
						}
						return oInfo;
					case 'node':
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
						if (oPlot) {
							iNodeIndex = (ZC._n_(oParams['nodeindex'])!==null)?ZC._i_(oParams['nodeindex']):0;
							if (!oPlot.aPlotNodes[iNodeIndex]) {
								return null;
							}
							oNode = oPlot.getNode(iNodeIndex);
							oInfo = {};
							oInfo['bounds'] = oNode.oLoader.oAttributes[oNode.sId + '-bounds'];
							for (k in oAttrs) {
								if (ZC._indexof_(['x', 'y', 'width', 'height'], k) !== -1) {
									oInfo[k] = oNode[oAttrs[k]];
								} else {
									oInfo[k] = oNode.oStyle[oAttrs[k]];
								}
							}
							ZC._cp_({
								plotindex : oPlot.iIndex,
								index : oNode.iIndex,
								size : oNode.iSize,
								value : oNode.fValue,
								keyvalue : oNode.fKeyValue
							}, oInfo);
							if (oPlot.sType.indexOf('pie') !== -1) {
								ZC._cp_({
									angleStart : oNode.iPieAngleStart,
									angleEnd : oNode.iPieAngleEnd
								}, oInfo);								
							}
							
							if (oPlot.oXData) {
								var oXData = {};
								for (k in oPlot.oXData) {
									oXData[k] = oPlot.oXData[k][iNodeIndex];
								}
								oInfo.xdata = oXData;
							}
							return oInfo;
						}
						return null;
				}
				break;
			case 'getxyinfo':
				var aInfo = [];
				var iX = oParams['x'], iY = oParams['y'];
				for (var g=0;g<oLoader.aGraphs.length;g++) {
					oGraph = oLoader.aGraphs[g];
					for (var p=0;p<oGraph.oPlotSet.aPlots.length;p++) {
						oPlot = oGraph.oPlotSet.aPlots[p];
						var oScaleKey = oGraph.getScaleByName(oPlot.getScales('k')[0]);
						var oScaleVal = oGraph.getScaleByName(oPlot.getScales('v')[0]);
						if (oScaleKey && oScaleVal) {
							var iScaleIndex = oScaleKey.getIndexByCoord(oScaleKey.bInversed?iY:iX);
							var fScalePos = oScaleKey.getIndexByCoord(oScaleKey.bInversed?iY:iX, null, true);
							aInfo.push({
								infotype : 'key-scale',
								xydistance : ZC._a_(iX-oScaleKey.getCoordByIndex(iScaleIndex)),
								graphid : oGraph.sId,
								plotidx : oPlot.iIndex,
								scalename : oScaleKey.sName,
								scaleidx : iScaleIndex,
								scalepos : fScalePos,
								scaletext : (oScaleKey.aLabels[iScaleIndex] || ''),
								scalevalue : oScaleKey.aValues[iScaleIndex],
								scalenumvalue : oScaleKey.getValueByCoord(oScaleKey.bInversed?iY:iX)
							});

							var fScaleVal = oScaleVal.getValueByCoord(oScaleVal.bInversed?iX:iY, true);
							aInfo.push({
								infotype : 'value-scale',
								xydistance : ZC._a_(oScaleVal.bInversed?iX:iY-oScaleVal.getCoordByValue(fScaleVal)),
								graphid : oGraph.sId,
								plotidx : oPlot.iIndex,
								scalename : oScaleVal.sName,
								scalevalue : fScaleVal
							});

							var iDiff = ZC.MAX;
							var oNode_ = null;
							for (var n=0,nLen=oPlot.aPlotNodes.length;n<nLen;n++) {
								
								if ((oNode=oPlot.getNode(n)) !== null) {
									switch (oGraph.oSettings['layout']) {
										case 'xy':
											if (ZC._indexof_(['scatter','bubble'], oGraph.sType) !== -1) {
												if ((mValue=Math.sqrt((oNode.iX-iX)*(oNode.iX-iX)+(oNode.iY-iY)*(oNode.iY-iY))) < iDiff) {
													oNode_ = {
														infotype : 'node',
														xydistance : mValue,
														graphid : oGraph.sId,
														plotidx : oPlot.iIndex,
														plotid : oPlot.sObjectId,
														nodeidx : oNode.iIndex,
														nodevalue : oNode.fValue,
														nodekeyvalue : (oNode.fKeyValue===null)?oScaleKey.aValues[oNode.iIndex]:oNode.fKeyValue
													};
													iDiff = mValue;
												}
											} else {
												
												if ((mValue=Math.sqrt((oNode.iX-iX)*(oNode.iX-iX)+(oNode.iY-iY)*(oNode.iY-iY))) < iDiff) {
													oNode_ = {
														infotype : 'node',
														xydistance : mValue,
														graphid : oGraph.sId,
														plotidx : oPlot.iIndex,
														plotid : oPlot.sObjectId,
														nodeidx : oNode.iIndex,
														nodevalue : oNode.fValue,
														nodekeyvalue : (oNode.fKeyValue===null)?oScaleKey.aValues[oNode.iIndex]:oNode.fKeyValue
													};
													iDiff = mValue;
												}
											}
											break;
										case 'yx':
											
											if ((mValue=Math.sqrt((oNode.iX-iX)*(oNode.iX-iX)+(oNode.iY-iY)*(oNode.iY-iY))) < iDiff) {
												oNode_ = {
													infotype : 'node',
													xydistance : iDiff,
													graphid : oGraph.sId,
													plotidx : oPlot.iIndex,
													plotid : oPlot.sObjectId,
													nodeidx : oNode.iIndex,
													nodevalue : oNode.fValue,
													nodekeyvalue : (oNode.fKeyValue===null)?oScaleKey.aValues[oNode.iIndex]:oNode.fKeyValue
												};
												iDiff = mValue;
											}
											break;
										case '':
											var aCXY = oNode.getCXY();
											if ((mValue=Math.sqrt((aCXY[0]-iX)*(aCXY[0]-iX)+(aCXY[1]-iY)*(aCXY[1]-iY))) < iDiff) {
												oNode_ = {
													infotype : 'node',
													xydistance : iDiff,
													graphid : oGraph.sId,
													plotidx : oPlot.iIndex,
													plotid : oPlot.sObjectId,
													nodeidx : oNode.iIndex,
													nodevalue : oNode.fValue,
													nodekeyvalue : (oNode.fKeyValue===null)?oScaleKey.aValues[oNode.iIndex]:oNode.fKeyValue
												};
												iDiff = mValue;
											}
											break;
									}
								}
							}
							if (oNode_) {
								aInfo.push(oNode_);
							}
						}
					}
				}
				return aInfo;
			case 'update':
				if (ZC._n_(oParams['graphid']) !== null) {
					oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
					if (oGraph) {
						oLoader.loadResources(function() {
							oGraph.repaint(bSmart, bSmart);
						});
					} else {
						oLoader.repaint();
					}
				} else {
					oLoader.repaint();
				}
				break;
			case 'setcharttype':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oLoader.oData['graphset'][oGraph.iIndex]['type'] = oGraph.oData['type'] = oGraph.sType = oParams['type'];
					if (bUpdate) {
						oLoader.repaint();
					}
				}
				break;
			case 'addgraph':
				oLoader.oData['graphset'].push(oParams['data'] || {});
				if (bUpdate) {
					oLoader.repaint();
				}			
				break;
			case 'addplot':
				zingchart.SKIP.CSV = true;
				oData = {};
				
				sKey = oParams['plotdata']?'plotdata':'data';
				if (ZC._n_(oParams[sKey]) !== null) {
					if (typeof(oParams[sKey]) === 'object') {
						ZC._cp_(oParams[sKey], oData);
					} else {
						oData = JSON.parse(oParams[sKey]);
					}
				}
				ZC._todash_(oData);
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					iPlotIndex = oPlot?oPlot.iIndex:0;
					var oData_ = [];
					if (ZC._n_(oGraph.oData['series']) === null) {
						oGraph.oData['series'] = [];
					}
					if (oGraph.oData['series'].length > 0) {
						for (i=0;i<oGraph.oData['series'].length;i++) {
							oData_.push(oGraph.oData['series'][i]);
							if (i === iPlotIndex) {
								oData_.push(oData);
							}
						}
					} else {
						oData_.push(oData);
					}
					ZC.ZCUtils._trigger_event_('plot_add', oLoader, {
						id : oLoader.sId,
						graphid : oGraph.sId,
						plotindex : iPlotIndex,
						data : oData
					});
					oLoader.oData['graphset'][oGraph.iIndex]['series'] = oGraph.oData['series'] = oData_;
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					oGraph._set_animation_('on-change');
					if (bUpdate) {
						oLoader.loadResources(function() {
							oGraph.repaint(bSmart, bSmart);
						});
					}
				}
				break;
			case 'removeplot':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						oGraph.oData['series'].splice(oPlot.iIndex, 1);
						oLoader.oData['graphset'][oGraph.iIndex]['series'] = oGraph.oData['series'];
						oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));

						ZC.ZCUtils._trigger_event_('plot_remove', oLoader, {
							id : oLoader.sId,
							graphid : oGraph.sId,
							plotindex : oPlot.iIndex
						});
						oGraph._set_animation_('on-change');
						if (bUpdate) {
							oLoader.loadResources(function() {
								oGraph.repaint(bSmart, bSmart);
							});
						}
					}
				}
				break;
			case 'modify':
				zingchart.SKIP.CSV = true;
				oData = {};
				if (ZC._n_(oParams['data']) !== null) {
					if (typeof(oParams['data']) === 'object') {
						ZC._cp_(oParams['data'], oData);
					} else {
						oData = JSON.parse(oParams['data']);
					}
				}
				ZC._todash_(oData);
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (ZC._n_(oParams['object']) !== null && ZC._n_(oGraph.oData[oParams['object']]) !== null) {
						switch (oParams['object']) {
							case 'title':
								ZC._cp_(oData, oGraph.oData['title']);
								break;
							case 'plotset':
							case 'series':
								ZC._cp_(oData, oGraph.oData['series']);
								break;
							case 'plotarea':
								ZC._cp_(oData, oGraph.oData['plotarea']);
								break;
							case 'legend':
								ZC._cp_(oData, oGraph.oData['legend']);
								break;
							case 'plot':
								ZC._cp_(oData, oGraph.oData['plot']);
								break;
						}
					} else {
						ZC._cp_(oData, oGraph.oData);
					}
					oLoader.oData['graphset'][oGraph.iIndex] = oGraph.oData;
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					
					ZC.ZCUtils._trigger_event_('modify', oLoader, {
						id : oLoader.sId, 
						graphid : oGraph.sId, 
						data : oData, 
						object : oParams['object']
					});
					oGraph._set_animation_('on-change');
					if (bUpdate) {
						oLoader.loadResources(function() {
							oGraph.repaint(bSmart, bSmart);
						});
					}
				}
				break;
			case 'modifyplot':
				zingchart.SKIP.CSV = true;
				oData = {};
				
				sKey = oParams['plotdata']?'plotdata':'data';
				if (ZC._n_(oParams[sKey]) !== null) {
					if (typeof(oParams[sKey]) === 'object') {
						ZC._cp_(oParams[sKey], oData);
					} else {
						oData = JSON.parse(oParams[sKey]);
					}
				}
				ZC._todash_(oData);
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						
						if (ZC._n_(oLoader.oData['graphset'][oGraph.iIndex]['series']) === null) {
							oLoader.oData['graphset'][oGraph.iIndex]['series'] = [];
						}
						ZC._cp_(oData, oGraph.oData['series'][oPlot.iIndex]);
						oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex] = oGraph.oData['series'][oPlot.iIndex];
						oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));

						ZC.ZCUtils._trigger_event_('plot_modify', oLoader, {
							id : oLoader.sId,
							graphid : oGraph.sId,
							plotindex : oPlot.iIndex,
							data : oData
						});
						oGraph._set_animation_('on-change');
						if (bUpdate) {
							oLoader.loadResources(function() {
								oGraph.repaint(bSmart, bSmart);
							});
						}
					}
				}
				break;
			case 'setnodevalue':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						iNodeIndex = 0;
						if (ZC._n_(oParams['nodeindex']) !== null) {
							iNodeIndex = ZC._i_(oParams['nodeindex']);
						}
						mValue = 0;
						if (ZC._n_(oParams['value']) !== null) {
							mValue = oParams['value'];
						}
						ZC.ZCUtils._trigger_event_('node_set', oLoader, {
							id : oLoader.sId,
							graphid : oGraph.sId,
							plotindex : oPlot.iIndex,
							nodeindex : iNodeIndex,
							key : iNodeIndex,
							value : mValue,
							text : mValue
						});
						oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex]['values'][iNodeIndex] = oGraph.oData['series'][oPlot.iIndex]['values'][iNodeIndex] = mValue;
						oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
						oGraph._set_animation_('on-change');
						if (bUpdate) {
							oGraph.repaint(bSmart, bSmart);
						}
					}
				}
				break;
			case 'setscalevalues':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					sScale = oParams['scale'] || 'scale-x';
					for (j=0,jLen=oGraph.aScales.length;j<jLen;j++) {
						if (sScale === oGraph.aScales[j].sName) {
							if (ZC._n_(oGraph.oData[sScale]) !== null) {
								oGraph.oData[sScale]['values'] = oParams['values'];
								oLoader.oData['graphset'][oGraph.iIndex][sScale] =  oLoader.oData['graphset'][oGraph.iIndex][sScale] || {};
								oLoader.oData['graphset'][oGraph.iIndex][sScale]['values'] = oParams['values'];
							}
						}
					}
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					oGraph._set_animation_('on-change');
					if (bUpdate) {
						oGraph.repaint(bSmart, bSmart);
					}
				}
				break;
			case 'addscalevalue':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					sScale = oParams['scale'] || 'scale-x';
					for (j=0,jLen=oGraph.aScales.length;j<jLen;j++) {
						if (sScale === oGraph.aScales[j].sName) {
							if (ZC._n_(oGraph.oData[sScale]) !== null && ZC._n_(oGraph.oData[sScale]['values']) !== null) {
								iNodeIndex = (ZC._n_(oParams['nodeindex'])===null)?oGraph.oData[sScale]['values'].length:ZC._i_(oParams['nodeindex']);
								aScaleValues = oGraph.oData[sScale]['values'];
								aScaleValues.push(null);
								for (i=aScaleValues.length-1;i>iNodeIndex;i--) {
									aScaleValues[i] = aScaleValues[i-1];
								}
								aScaleValues[iNodeIndex] = oParams['value'] || '';
								oLoader.oData['graphset'][oGraph.iIndex][sScale]['values'] = aScaleValues;
							}
						}
					}
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					oGraph._set_animation_('on-change');
					if (bUpdate) {
						oGraph.repaint(bSmart, bSmart);
					}
				}
				break;
			case 'removescalevalue':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					sScale = oParams['scale'] || 'scale-x';
					for (j=0,jLen=oGraph.aScales.length;j<jLen;j++) {
						if (sScale === oGraph.aScales[j].sName) {
							if (ZC._n_(oGraph.oData[sScale]) !== null && ZC._n_(oGraph.oData[sScale]['values']) !== null) {
								iNodeIndex = (ZC._n_(oParams['nodeindex'])===null)?oGraph.oData[sScale]['values'].length-1:ZC._i_(oParams['nodeindex']);
								aScaleValues = oGraph.oData[sScale]['values'];
								aScaleValues.splice(iNodeIndex, 1);
								oLoader.oData['graphset'][oGraph.iIndex][sScale]['values'] = aScaleValues;
							}
						}
					}
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					oGraph._set_animation_('on-change');
					if (bUpdate) {
						oGraph.repaint(bSmart, bSmart);
					}
				}
				break;
			case 'addnode':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				var bKeyValue = (oParams['value'] instanceof Array);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						aPlotValues = oGraph.oData['series'][oPlot.iIndex]['values'];
						iNodeIndex = (ZC._n_(oParams['nodeindex'])===null)?aPlotValues.length:oParams['nodeindex'];

						if (bKeyValue && ZC._n_(oParams['nodeindex']) !== null) {
							aPlotValues.push([oParams['nodeindex'], oParams['value'][1] || 0]);
						} else {
							aPlotValues.push(null);

							var iNodes = aPlotValues.length;
							iNodeIndex = ZC._max_(0, ZC._min_(iNodeIndex, iNodes));
							for (i=iNodes-1;i>iNodeIndex;i--) {
								aPlotValues[i] = aPlotValues[i-1];
							}
							aPlotValues[iNodeIndex] = oParams['value'];
						}

						if (!bKeyValue) {
							
							for (j=0,jLen=oGraph.aScales.length;j<jLen;j++) {
								sScale = oGraph.aScales[j].sName;
								if (oGraph.aScales[j].sType === 'k' && ZC._n_(oParams[sScale+'-value']) !== null) {
									if (ZC._n_(oGraph.oData[sScale]) !== null && ZC._n_(oGraph.oData[sScale]['values']) !== null) {
										aScaleValues = oGraph.oData[sScale]['values'];
										aScaleValues.push(null);
										for (i=aScaleValues.length-1;i>iNodeIndex;i--) {
											aScaleValues[i] = aScaleValues[i-1];
										}
										aScaleValues[iNodeIndex] = oParams[sScale+'-value'];
										oLoader.oData['graphset'][oGraph.iIndex][sScale]['values'] = aScaleValues;
									}
								}
							}
						}
						ZC.ZCUtils._trigger_event_('node_add', oLoader, {
							id : oLoader.sId,
							graphid : oGraph.sId,
							plotindex : oPlot.iIndex,
							nodeindex : iNodeIndex,
							key : iNodeIndex,
							value : oParams['value'],
							text : oParams['value']
						});
						oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex]['values'] = oGraph.oData['series'][oPlot.iIndex]['values'];
						oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
						oGraph._set_animation_('on-change');
						if (bUpdate) {
							oGraph.repaint(bSmart, bSmart);
						}
					}
				}
				break;
			case 'removenode':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						aPlotValues = oGraph.oData['series'][oPlot.iIndex]['values'];
						iNodeIndex = (ZC._n_(oParams['nodeindex'])===null)?(oPlot.aPlotNodes.length-1):ZC._i_(oParams['nodeindex']);
						if (ZC._btw_(iNodeIndex, 0, oPlot.aPlotNodes.length-1)) {
							aPlotValues.splice(iNodeIndex, 1);

							
							for (j=0,jLen=oGraph.aScales.length;j<jLen;j++) {
								sScale = oGraph.aScales[j].sName;
								if (oGraph.aScales[j].sType === 'k' && ZC._n_(oParams[sScale]) !== null && ZC._b_(oParams[sScale])) {
									if (ZC._n_(oGraph.oData[sScale]) !== null && ZC._n_(oGraph.oData[sScale]['values']) !== null) {
										aScaleValues = oGraph.oData[sScale]['values'];
										aScaleValues.splice(iNodeIndex, 1);
										oLoader.oData['graphset'][oGraph.iIndex][sScale]['values'] = aScaleValues;
									}
								}
							}

							ZC.ZCUtils._trigger_event_('node_remove', oLoader, {
								id : oLoader.sId,
								graphid : oGraph.sId,
								plotindex : oPlot.iIndex,
								nodeindex : iNodeIndex,
								key : iNodeIndex,
								value : oPlot.aPlotNodes[iNodeIndex].fValue,
								text : oPlot.aPlotNodes[iNodeIndex].fValue
							});

							oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex]['values'] = oGraph.oData['series'][oPlot.iIndex]['values'];
							oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
							oGraph._set_animation_('on-change');
							if (bUpdate) {
								oGraph.repaint(bSmart, bSmart);
							}
						}
					}
				}
				break;
			case 'setdata':
				oData = {};
				if (ZC._n_(oParams['data']) !== null) {
					if (typeof(oParams['data']) === 'object') {
						ZC._cp_(oParams['data'], oData);
					} else {
						try {
							oData = JSON.parse(oParams['data']);
						} catch (oError) {
							oLoader._api_error_(oError, 'JSON parser');
							return false;
						}
					}
				}
				ZC._todash_(oData);
				if (ZC._n_(oParams['preservezoom']) === null) {
					oLoader.oAttributes['preservezoom'] = false;
				}
				oGraph = null;
				if (ZC._n_(oParams['graphid']) !== null) {
					oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				}
				ZC.ZCUtils._trigger_event_('setdata', oLoader, {
					id : oLoader.sId, 
					graphid : (!oGraph?null:oGraph.sId), 
					data : oData
				});
				if (oGraph) {
					oLoader.oData['graphset'][oGraph.iIndex] = oGraph.oData = oData;					
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					if (bUpdate) {
						if (bHistory) {
							oLoader.iHistory++;
						}
						oLoader.loadResources(function() {
							oLoader.parse(oGraph.sId);
							oLoader.aGraphs[oGraph.iIndex].paint();
						});
					}
				} else {
					oLoader.oData = oData;
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					oLoader.lookupShapes(oLoader.oData);
					if (bUpdate) {
						if (bHistory) {
							oLoader.iHistory++;
						}
						oLoader.repaint();
					}
				}
				break;
			case 'getseriesdata':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (ZC._n_(oParams['plotindex']) !== null || ZC._n_(oParams['plotid']) !== null) {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid'], 0);
						return oPlot?oGraph.oData['series'][oPlot.iIndex]:null;
					} else {
						return oGraph.oData['series'];
					}
				}
				return null;
			case 'setseriesdata':
			case 'appendseriesdata':
				zingchart.SKIP.CSV = true;
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (ZC._n_(oParams['plotindex']) !== null || ZC._n_(oParams['plotid']) !== null) {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid'], 0);
						if (sCall === 'setseriesdata') {
							oData = {};
						} else {
							if (oGraph.oData['series'] && oGraph.oData['series'][oPlot.iIndex]) {
								oData = oGraph.oData['series'][oPlot.iIndex];
							} else {
								oData = {};
							}
						}
					} else {
						if (sCall === 'setseriesdata') {
							oData = [];
						} else {
							oData = oGraph.oData['series'] || [];
						}
					}
					if (ZC._n_(oParams['data']) !== null) {
						if (typeof(oParams['data']) === 'object') {
							ZC._cp_(oParams['data'], oData);
						} else {
							ZC._cp_(JSON.parse(oParams['data']), oData);
						}
					}
					ZC._todash_(oData);
					if (ZC._n_(oParams['plotindex']) !== null || ZC._n_(oParams['plotid']) !== null) {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid'], 0);
						oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex] = oGraph.oData['series'][oPlot.iIndex] = oData;
					} else {
						oLoader.oData['graphset'][oGraph.iIndex]['series'] = oGraph.oData['series'] = oData;
					}
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					oGraph._set_animation_('on-change');
					if (bUpdate) {
						oLoader.loadResources(function() {
							oGraph.repaint(bSmart, bSmart);
						});
					}
				}
				break;
			case 'getseriesvalues':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (ZC._n_(oParams['plotindex']) !== null || ZC._n_(oParams['plotid']) !== null) {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid'], 0);
						return oPlot?(oGraph.oData['series'][oPlot.iIndex]['values'] || []):[];
					} else {
						aValues = [];
						for (i=0,iLen=oGraph.oPlotSet.aPlots.length;i<iLen;i++) {
							aValues.push(oGraph.oData['series'][i]['values'] || []);
						}
						return aValues;
					}
				}
				return null;
			case 'setseriesvalues':
			case 'appendseriesvalues':
				zingchart.SKIP.CSV = true;
				aValues = [];
				if (ZC._n_(oParams['values']) !== null) {
					if (typeof(oParams['values']) === 'object') {
						aValues = oParams['values'];
					} else {
						aValues = JSON.parse(oParams['values']);
					}
				}
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				var bSingle = false;
				if (oGraph) {
					if (ZC._n_(oParams['plotindex']) !== null || ZC._n_(oParams['plotid']) !== null) {
						aValues = [aValues];
						bSingle = true;
					}
					if (!bSingle && sCall === 'setseriesvalues') {
						var j;
						
						for (j=0;j<aValues.length;j++) {
							oLoader.oData['graphset'][oGraph.iIndex]['series'][j] = oLoader.oData['graphset'][oGraph.iIndex]['series'][j] || {};
							oGraph.oData['series'][j] = oGraph.oData['series'][j] || {};
							oLoader.oData['graphset'][oGraph.iIndex]['series'][j]['values'] = oGraph.oData['series'][j]['values'] = aValues[j];
						}
						if (oGraph.oData['series'].length > aValues.length) {
							for (j=aValues.length;j<oGraph.oData['series'].length;j++) {
								delete oLoader.oData['graphset'][oGraph.iIndex]['series'][j];
								delete oGraph.oData['series'][j];
							}
						}
					} else {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid'], 0);
						for (i=0,iLen=aValues.length;i<iLen;i++) {
							if (oGraph.oPlotSet.aPlots[oPlot.iIndex+i]) {
								if (sCall === 'setseriesvalues') {
									if (bSingle) {
										oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex+i]['values'] = oGraph.oData['series'][oPlot.iIndex+i]['values'] = aValues[i];
									}
								} else {
									var aValues_ = oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex+i]['values'];
									var bKeys = (aValues[i].length > 0) && (aValues[i][0].length > 1);
									var bIgnoreDuplicates = true;
									if (ZC._n_(mValue=oParams['ignoreduplicates']) !== null) {
										bIgnoreDuplicates = ZC._b_(mValue);
									}
									if (bKeys) {
										var iLen_ = aValues_.length;
										for (v=0,vLen=aValues[i].length;v<vLen;v++) {
											var bDuplicate = false;
											for (var v_=iLen_-1;v_>=0;v_--) {
												if (aValues[i][v][0] > aValues_[v_][0]) {
													aValues_.push(aValues[i][v]);
													bDuplicate = true;
													break;
												} else if (aValues[i][v][0] === aValues_[v_][0]) {
													bDuplicate = true;
													break;
												}
											}
											if (!bDuplicate || !bIgnoreDuplicates) {
												aValues_.push(aValues[i][v]);
											}
										}
									} else {
										for (v=0,vLen=aValues[i].length;v<vLen;v++) {
											aValues_.push(aValues[i][v]);
										}
									}
									oLoader.oData['graphset'][oGraph.iIndex]['series'][oPlot.iIndex+i]['values'] = oGraph.oData['series'][oPlot.iIndex+i]['values'] = aValues_;
								}
							}
						}
					}
					oGraph._set_animation_('on-change');
					oLoader.oAttributes['json'] = ZC._trim_(JSON.stringify(oLoader.oData));
					if (bUpdate) {
						oGraph.repaint(bSmart, bSmart);
					}
				}
				break;
			case 'togglelegend':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (oGraph.oLegend) {
						var bVisibility = true;
						if (typeof(oGraph.oLegend.oData['visible']) !== 'undefined' && !oGraph.oLegend.oData['visible']) {
							bVisibility = false;
						}
						oGraph.oLegend.oData['visible'] = !bVisibility;
						oGraph.oLegend.clear(false);
						oGraph.oLegend.parse();
						oGraph.oLegend.paint();
					}
				}
				break;
			case 'legendminimize':
			case 'legendmaximize':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (oGraph.oLegend) {
						if (sCall === 'legendminimize') {
							ZC.ZCUtils._trigger_event_('legend_minimize', oLoader, oGraph._api_graph_info_());
							ZC.ZCUtils._trigger_event_('legend_hide', oLoader, oGraph._api_graph_info_());
						} else {
							ZC.ZCUtils._trigger_event_('legend_maximize', oLoader, oGraph._api_graph_info_());
							ZC.ZCUtils._trigger_event_('legend_show', oLoader, oGraph._api_graph_info_());							
						}
						oGraph.oLegend.bCollapsed = (sCall==='legendminimize');
						oGraph.oLegend.saveInfo();
						oGraph.oLegend.clear(false);
						oGraph.oLegend.parse();
						oGraph.oLegend.paint();
					}
				}
				break;
			case 'legendscroll':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					if (oGraph.oLegend) {
						oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
						if (oPlot) {
							self.scrollTo(ZC._i_(oPlot.iIndex));
							self.saveInfo();
							self.clear(true);
							self.bApplyOffset = true;
							self.parse();
							self.paint();
						}
					}
				}
				break;
			case 'toggledimension':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oLoader._api_2d3d_toggle_(oGraph.sId);
				}
				break;
			case 'getdata':
				oData = JSON.parse(oLoader.oAttributes['json']);
				ZC._todash_(oData, true);
				return oData;
			case 'getoriginaljson':
				oData = JSON.parse(oLoader.oAttributes['source']);
				ZC._todash_(oData, true);
				return oData;
			case 'getgraphlength':
				return oLoader.aGraphs.length;
			case 'getplotlength':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					return oGraph.oPlotSet.aPlots.length;
				}
				return 0;
			case 'getscales':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					var aScales = [];
					for (i=0;i<oGraph.aScales.length;i++) {
						aScales.push(oGraph.aScales[i].sName);
					}
					return aScales;
				}
				return [];
			case 'getnodelength':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						return oPlot.aPlotNodes.length;
					}
				}
				return null;
			case 'getnodevalue':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						if (ZC._n_(oParams['nodeindex']) !== null) {
							if ((oNode=oPlot.aPlotNodes[ZC._i_(oParams['nodeindex'])])) {
								return oNode.fValue;
							} else {
								return null;
							}
						}
					}
				}
				return null;
			case 'getplotvalues':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oPlot = oGraph._api_getplot_(oParams['plotindex'], oParams['plotid']);
					if (oPlot) {
						aValues = [];
						for (i=0,iLen=oPlot.aPlotNodes.length;i<iLen;i++) {
							aValues.push(oPlot.aPlotNodes[i].fValue);
						}
						return aValues;
					}
				}
				return null;
		}
	}
	return null;
};










ZC.ZCBase = ZC.Class.extend({
	init : function() {
		var self = this;
		
		self.sTag = null;
		self.oData = {};
		self.oAttributes = {};
		self.aRules = [];
		self.oJsRule = null;
	},
	applyJsRule : function(oSrc, oTarget, sLayer, oInfo) {
		var self = this;
		if (oSrc.oJsRule) {
			var oResponse = oSrc.oJsRule.call(self, oInfo);
			if (sLayer && oResponse) {
				if (oResponse[sLayer+'-state']) {
					oResponse = oResponse[sLayer+'-state'];
				} else if (oResponse[sLayer+'State']) {
					oResponse = oResponse[sLayer+'State'];
				}
			}
			var oPM = self.getPMap();
			var oRule = {}, oData = {}, sAttrCC, sAttrD;
			for (var sAttr in oResponse) {
				sAttrCC = ZC._camelcase_(sAttr);
				sAttrD = ZC._dash_(sAttr);
				if (sAttrCC === 'backgroundColor') {
					oRule.sBackgroundColor1 = oRule.sBackgroundColor2 = ZC.ZCUtils._color_(oResponse[sAttr]);
				} else if (sAttrCC === 'borderRadius') {
					oRule.iBorderRadiusTopLeft = oRule.iBorderRadiusTopRight = oRule.iBorderRadiusBottomLeft = oRule.iBorderRadiusBottomRight = oResponse[sAttr];
				} else if (sAttr === 'padding') {
					oRule.iPaddingTop = oRule.iPaddingRight = oRule.iPaddingBottom = oRule.iPaddingLeft = oResponse[sAttr];
				} else {
					if (oPM[sAttrCC]) {
						oRule[oPM[sAttrCC]] = oResponse[sAttr];
					} else {
						oRule[sAttrCC] = oResponse[sAttr];
					}
				}
				oData[sAttrD] = oResponse[sAttr];
			}
			if (!oTarget.oData) {
				ZC._cp_(oResponse, oRule);
			}
			ZC._cp_(oRule, oTarget);
			if (oTarget.oData) {
				ZC._cp_(oData, oTarget.oData);
				oTarget.setLineStyle();
			}
		}
	},
	parse : function() {
		var self = this, mValue;
		if (zingchart.SYNTAX !== 'dashed') {
			ZC._todash_(self.oData);
		}
		var sOutput = '';
		if (typeof(self.oLoader) !== 'undefined') {
			sOutput = self.oLoader.sOutput;
		}
		ZC._from_output_(self.oData, 'html5');
		if (sOutput !== '') {
			ZC._from_output_(self.oData, sOutput);
		}
		if (self.oData['rules']) {
			self.aRules = self.oData['rules'];
		}
		
		for (var i=0;i<self.aRules.length;i++) {
			if (self.aRules[i]['rule'] === '*' && self.aRules[i]['js']) {
				self.oData['js-rule'] = self.aRules[i]['js'];
				self.aRules.splice(i, 1);
				break;
			}
		}
		if ((mValue=self.oData['js-rule'])) {
			if (mValue.substring(mValue.length-2) === '()' || mValue.substring(0, 11) === 'javascript:') {
				try {
					var sCall = mValue.replace('javascript:', '').replace('()', '');
					if (eval(sCall)) {
						self.oJsRule = eval(sCall);
					}
				} catch(e) {}
			}
		}

		
		if (typeof(self.oLoader) !== 'undefined' && self.oLoader.oGlobals !== null) {
			for (var g in self.oLoader.oGlobals) {
				if (self.oLoader.oGlobals.hasOwnProperty(g)) {
					self.oData[g] = self.oLoader.oGlobals[g];
				}
			}
		}
	},
	getPMap : function() {
		return {};
	},
	addPMap : function(oMap, sProperties, sAttributes) {
		var aProperties = sProperties.split(',');
		var aAttributes = sAttributes.split(',');
		for (var i=0,iLen=aAttributes.length;i<iLen;i++) {
			oMap[aProperties[i]] = aAttributes[i];
		}
	},
	getData : function() {
		return this.oData;
	},
	setData : function(d) {
		this.oData = d;
	},
	getAttribute : function(a) {
		return this.oAttributes[a];
	},
	setAttribute : function(a, v) {
		this.oAttributes[a] = v;
	},
	get : function(p) {
		var m = this.getPMap();
		if (m[p]) {
			return this[m[p]];
		} else {
			return null;
		}
	},
	set : function(p, v) {
		var m = this.getPMap();
		if (m[p]) {
			this[m[p]] = v;
		}
	},
	append : function(oData, bLoadStyle, bRecursive) {
		if (bLoadStyle === null) { bLoadStyle = true; }
		var self = this;
		if (oData) {
			ZC._cp_(oData, self.oData, true, bRecursive);
		}
		if (typeof(self.loadStyle) !== 'undefined') {
			if (self.loadStyle()) {
				if (oData) {
					ZC._cp_(oData, self.oData);
				}
			}
		}
	},
	loadStyle : function() {
	},
	assign_a : function(aParams) {
		for (var i=0,iLen=aParams.length;i<iLen;i++) {
			if (this.oData.hasOwnProperty(aParams[i][0])) {
				this.assign(aParams[i][0], aParams[i][1], aParams[i][2], aParams[i][3], aParams[i][4]);
			}
		}
	},
	assign : function(sJsonAttr, sObjAttr, sTransform, fMin, fMax) {
		var mTarget;
		if ((mTarget=this.oData[sJsonAttr]) !== null && typeof(mTarget) !== 'undefined') {
			if (sTransform) {
				if (sTransform.indexOf('p') !== -1) {
					mTarget = ZC._p_(mTarget);
					sTransform = sTransform.replace('p', '');
				}
				if (sTransform.indexOf('a') !== -1) {
					mTarget = ZC._a_(mTarget);
					sTransform = sTransform.replace('a', '');
				}
				switch (sTransform) {
					case 'i':
						mTarget = ZC._i_(mTarget);
						break;
					case 'f':
						mTarget = ZC._f_(mTarget);
						break;
					case 'b':
						mTarget = ZC._b_(mTarget);
						break;
					case 'c':
						mTarget = ZC.ZCUtils._color_tokens_(mTarget);
						mTarget = ZC.ZCUtils._color_(mTarget, this);
						if (mTarget instanceof Array) {
							if (sJsonAttr === 'color' || sJsonAttr === 'font-color') {
								this.fTextAlpha = mTarget[1];
							} else {
								if (ZC._n_(this.oData['alpha']) === null) {
									this.fAlpha = mTarget[1];
								}
							}
							mTarget = mTarget[0];
						}
						break;
				}
			}
			if (ZC._n_(fMin) !== null && ZC._n_(fMax) !== null) {
				mTarget = ZC._l_(mTarget, fMin, fMax);
			}
			this[sObjAttr] = mTarget;
		}
	},
	applyRules : function() {
		var self = this;
		var bValidRule = false;
		for (var r=0,rLen=self.aRules.length;r<rLen;r++) {
			var bResult = false;
			try {
				bResult = (new Function('return (' + self.parseRule(self.aRules[r]['rule']) + ')'))();
			} catch(e) {
				bResult = false;
			}
			if (bResult) {
				bValidRule = true;
				self.append(self.aRules[r]);
			}
		}
		return bValidRule;
	},
	getRulesHash : function(aRules) {
		var self = this;
		var sSignature = '';
		for (var r=0,rLen=aRules.length;r<rLen;r++) {
			var bResult = false;
			try {
				bResult = (new Function('return (' + self.parseRule(aRules[r]['rule']) + ')'))();
			} catch(e) {
				bResult = false;
			}
			if (bResult) {
				sSignature += '<' + aRules[r]['rule'] + '>';
			}
		}
		if (sSignature !== '') {
			return [sSignature, ZC.ZCMD5.md5(sSignature)];
		} else {
			return null;
		}
	},
	parseRule : function() {
		return true;
	},
	copy : function(oObject) {
		var self = this;
		ZC._cp_(oObject.oData, self.oData);
		ZC._cp_(oObject.oAttributes, self.oAttributes);
		ZC._cp_(oObject.aRules, self.aRules);
	}
});









ZC.ZCStyle = ZC.ZCBase.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		if (oParent && oParent.oLoader) {
			self.oLoader = oParent.oLoader;
		}
		self.sId = '';
		self.sClass = null;
		self.bVisible = true;
		self.sBackgroundColor1 = '-1';
		self.sBackgroundColor2 = '-1';
		self.sGradientColors = '';
		self.sGradientStops = '';
		self.bBackgroundClip = true;
		self.sBackgroundImage = '';
		self.sBackgroundRepeat = 'repeat';
		self.sBackgroundPosition = '50% 50%';
		self.sBackgroundFit = '';
		self.fBackgroundScale = 1;
		self.sFillType = 'linear';
		self.iFillAngle = 90;
		self.iFillOffsetX = 0;
		self.iFillOffsetY = 0;
		self.iLineWidth = 0;
		self.sLineColor = '#000';
		self.sLineStyle = '';
		self.iLineSegmentSize = 0;
		self.iLineGapSize = 0;
		self.iBorderWidth = 0;
		self.sBorderColor = '#000';
		self.fAlpha = 1;
		self.fBorderAlpha = 1;
		self.sLineCap = 'butt';
		self.sLineJoin = 'round';
		self.bShadow = false;
		self.iShadowAngle = 45;
		self.iShadowDistance = 2;
		self.fShadowAlpha = 0.75;
		self.sShadowColor = '#999';
		self.iShadowBlur = 0;
		self.bPixelCorrection = true;
		self.bBoxCorrection = false;
		self.bAreaCorrection = false;
		self.bIgnoreOverride = false;
		self.oSelectionData = null;
	},
	getPMap : function() {
		var oMap = this._super();
		this.addPMap(oMap, 'visible,backgroundColor1,backgroundColor2,gradientColors,gradientStops,backgroundImage,backgroundRepeat,backgroundPosition,backgroundFit,backgroundScale,fillType,fillAngle,fillOffsetX,fillOffsetY,lineWidth,lineColor,lineStyle,lineSegmentSize,lineGapSize,borderWidth,borderColor,borderAlpha,alpha,lineCap,shadow,shadowAngle,shadowDistance,shadowAlpha,shadowColor,shadowBlur,class', 'bVisible,sBackgroundColor1,sBackgroundColor2,sGradientColors,sGradientStops,sBackgroundImage,sBackgroundRepeat,sBackgroundPosition,sBackgroundFit,fBackgroundScale,sFillType,iFillAngle,iFillOffsetX,iFillOffsetY,iLineWidth,sLineColor,sLineStyle,iLineSegmentSize,iLineGapSize,iBorderWidth,sBorderColor,fBorderAlpha,fAlpha,sLineCap,bShadow,iShadowAngle,iShadowDistance,fShadowAlpha,sShadowColor,iShadowBlur,sClass');
		return oMap;
	},
	copy : function(oObject) {
		var self = this;
		self._super(oObject);
		var aAttributes = 'bVisible,sBackgroundColor1,sBackgroundColor2,sGradientColors,sGradientStops,sBackgroundImage,bBackgroundClip,sBackgroundRepeat,sBackgroundPosition,sBackgroundFit,fBackgroundScale,sFillType,iFillAngle,iFillOffsetX,iFillOffsetY,iLineWidth,sLineColor,sLineStyle,iLineSegmentSize,iLineGapSize,iBorderWidth,sBorderColor,fBorderAlpha,fAlpha,sLineCap,bShadow,iShadowAngle,iShadowDistance,fShadowAlpha,sShadowColor,iShadowBlur,bPixelCorrection,bAreaCorrection,sClass,oLoader'.split(',');
		for (var i=0,iLen=aAttributes.length;i<iLen;i++) {
			if (typeof(oObject[aAttributes[i]]) !== 'undefined') {
				self[aAttributes[i]] = oObject[aAttributes[i]];
			}
		}
	},
	loadStyle : function() {
		var self = this, mValue, mValue_;
		var bHasStyle = false;
		if (self.oData['class'] || self.oData['cls'] || self.oData['id']) {
			if (self.oLoader !== null && self.oLoader.oStyle !== null) {
				if ((mValue=(self.oData['class'] || self.oData['cls']))) {
					var aClassNames = mValue.split(/(\s+)/);
					for (var i=0,iLen=aClassNames.length;i<iLen;i++) {
						if ((mValue_=self.oLoader.oStyle['.'+aClassNames[i]])) {
							bHasStyle = true;
							ZC._cp_(mValue_, self.oData);
						}
					}
				}
				if ((mValue=self.oData['id'])) {
					if ((mValue_=self.oLoader.oStyle['#'+mValue])) {
						bHasStyle = true;
						ZC._cp_(mValue_, self.oData);
					}
				}
			}
		}
		if (self.sTag !== null && (mValue_=self.oLoader.oStyle[self.sTag])) {
			bHasStyle = true;
			ZC._cp_(mValue_, self.oData);
		}
		return bHasStyle;
	},
	setLineStyle : function() {
		var self = this, mValue;
		switch (self.sLineStyle) {
			case 'dotted':
				self.iLineSegmentSize = ZC._max_(1, self.iLineWidth*0.75);
				self.iLineGapSize = self.iLineWidth*1.75;
				break;
			case 'dashed':
				self.iLineSegmentSize = 4*self.iLineWidth;
				self.iLineGapSize = 3*self.iLineWidth;
				break;
			default:
				self.iLineSegmentSize = 0;
				self.iLineGapSize = 0;
		}
		if ((mValue=ZC._n_(self.oData['line-segment-size'])) !== null) {
			self.iLineSegmentSize = parseInt(mValue, 10);
		}
		if ((mValue=ZC._n_(self.oData['line-gap-size'])) !== null) {
			self.iLineGapSize = parseInt(mValue, 10);
		}
	},
	parse : function() {
		var self = this, mValue, mValue_, aTemp, t, oRE, aMatches;
		
		self._super();

		if ((mValue=ZC._n_(self.oData['override'])) !== null && !self.bIgnoreOverride) {
			var iPlotIndex = -1, iNodeIndex = -1;
			if (typeof(self.oAttributes['plotidx']) !== 'undefined') {
				iPlotIndex = ZC._i_(self.oAttributes['plotidx']);
			}
			if (typeof(self.oAttributes['nodeidx']) !== 'undefined') {
				iNodeIndex = ZC._i_(self.oAttributes['nodeidx']);
			}
			var iPlotMatch, iNodeMatch, aList;
			for (var i=0,iLen=mValue.length;i<iLen;i++) {
				iPlotMatch = -1;
				iNodeMatch = -1;
				if (mValue[i]['hook']) {
					if ((mValue_=ZC._n_(mValue[i]['hook']['node-index'])) !== null) {
						iNodeMatch = 0;
						aList = [];
						if (typeof(mValue_) === 'object') {
							aList = mValue_;
						} else if (typeof(mValue_) === 'string') {
							if (mValue_.indexOf(',') !== -1) {
								aList = mValue_.split(',');
							} else if (mValue_.indexOf('-') !== -1) {
								aTemp = mValue_.split('-');
								for (t=ZC._i_(aTemp[0]);t<=ZC._i_(aTemp[1]);t++) {
									aList.push(t);
								}
							}
						} else {
							aList = [mValue_];
						}
						if (ZC._indexof_(aList, iNodeIndex) !== -1) {
							iNodeMatch = 1;
						}
					}
					if ((mValue_=mValue[i]['hook']['plot-index']) !== null && typeof(mValue_) !== 'undefined') {
						iPlotMatch = 0;
						aList = [];
						if (typeof(mValue_) === 'object') {
							aList = mValue_;
						} else if (typeof(mValue_) === 'string') {
							if (mValue_.indexOf(',') !== -1) {
								aList = mValue_.split(',');
							} else if (mValue_.indexOf('-') !== -1) {
								aTemp = mValue_.split('-');
								for (t=ZC._i_(aTemp[0]);t<ZC._i_(aTemp[1]);t++) {
									aList.push(t);
								}
							}
						} else {
							aList = [mValue_];
						}
						if (ZC._indexof_(aList, iPlotIndex) !== -1) {
							iPlotMatch = 1;
						}
					}
				}
				if (iPlotMatch !== 0 && iNodeMatch !== 0) {
					self.append(mValue[i]);
				}
			}
		}

		if ((mValue=self.oSelectionData) !== null) {
			self.append(mValue);
		}

		if ((mValue=self.oData['background-color'])) {
			mValue = ZC.ZCUtils._color_tokens_(mValue);
			if (String(mValue).substring(0, 4) === 'rgb(') {
				oRE = new RegExp('rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)');
				while ((aMatches = oRE.exec(mValue))) {
					mValue = mValue.replace(aMatches[0], ZC.ZCUtils._color_(aMatches[0]));
				}
			}
			if (String(mValue).substring(0, 5) === 'rgba(') {
				oRE = new RegExp('rgba\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\,\\s*([0-9\.]+)\\)');
				while ((aMatches = oRE.exec(mValue))) {
					var aCA = ZC.ZCUtils._color_(aMatches[0], self);
					mValue = mValue.replace(aMatches[0], aCA[0]);
					self.oData['alpha'] = aCA[1];
				}
			}
			var aBgColors = String(mValue).split(/\s+|;|,/);
			self.sBackgroundColor1 = ZC.ZCUtils._color_(aBgColors[0]);
			self.sBackgroundColor2 = (aBgColors.length===1)?self.sBackgroundColor1:ZC.ZCUtils._color_(aBgColors[1]);
		}

		self.assign_a([
			['visible', 'bVisible', 'b'],
			['background-color-1', 'sBackgroundColor1', 'c'],
			['background-color-2', 'sBackgroundColor2', 'c'],
			['gradient-colors', 'sGradientColors'],
			['gradient-stops', 'sGradientStops'],
			['background-clip', 'bBackgroundClip', 'b'],
			['background-image', 'sBackgroundImage'],
			['background-repeat', 'sBackgroundRepeat'],
			['background-position', 'sBackgroundPosition'],
			['background-fit', 'sBackgroundFit'],
			['background-scale', 'fBackgroundScale', 'f'],
			['fill-type', 'sFillType'],
			['fill-angle', 'iFillAngle', 'i'],
			['fill-offset-x', 'iFillOffsetX', 'f'],
			['fill-offset-y', 'iFillOffsetY', 'f'],
			['line-width', 'iLineWidth', 'i'],
			['line-color', 'sLineColor', 'c'],
			['line-style', 'sLineStyle', ''],
			['class', 'sClass'],
			['cls', 'sClass']
		]);
		
		self.sGradientColors = ZC.ZCUtils._color_tokens_(self.sGradientColors);
		self.setLineStyle();
		self.assign_a([
			['line-segment-size', 'iLineSegmentSize', 'i'],
			['line-gap-size', 'iLineGapSize', 'i'],
			['border-width', 'iBorderWidth', 'i'],
			['border-color', 'sBorderColor', 'c'],
			['alpha', 'fAlpha', 'f', 0, 1],
			['shadow', 'bShadow', 'b'],
			['shadow-angle', 'iShadowAngle', 'i', 0, 360],
			['shadow-distance', 'iShadowDistance', 'i'],
			['shadow-alpha', 'fShadowAlpha', 'f', 0, 1],
			['shadow-color', 'sShadowColor', 'c'],
			['shadow-blur', 'iShadowBlur', 'i']
		]);
		self.fBorderAlpha = self.fAlpha;
		self.assign_a([
			['border-alpha', 'fBorderAlpha', 'f', 0, 1]
		]);

		

	}
});











ZC.ZCLine = {
	contour : function(oCtx, oStyle, aPoints) {
		var i, iLen, p;
		if (!oCtx || !aPoints || aPoints.length === 0) {
			return;
		}

		if (!oStyle.oAttributes['fast-vector-path']) {
			for (i=0,iLen=aPoints.length;i<iLen;i++) {
				if (aPoints[i]) {
					aPoints[i][0] = parseFloat(Number(aPoints[i][0]).toFixed(2));
					aPoints[i][1] = parseFloat(Number(aPoints[i][1]).toFixed(2));
				}
			}
		}

		var bSkip = false;
		var iPoints = aPoints.length;
		for (i=0;i<iPoints;i++) {
			if (ZC._n_(aPoints[i]) !== null) {
				p = [aPoints[i][0], aPoints[i][1]];
				if (ZC._n_(aPoints[i][2]) !== null) {
					p.push(aPoints[i][2], aPoints[i][3]);
				}
				if (ZC._n_(aPoints[i][4]) !== null) {
					p.push(aPoints[i][4], aPoints[i][5]);
				}
				if (oStyle.bBoxCorrection) {
					p[0] = Math.round(p[0]);
					p[1] = Math.round(p[1]);
					if (p.length === 4) {
						p[2] = Math.round(p[2]);
						p[3] = Math.round(p[3]);
					}
				}
				if (oStyle.bPixelCorrection && oStyle.iLineWidth%2 === 1) {
					p[0] -= 0.5;
					p[1] -= 0.5;
					if (p.length === 4) {
						p[2] -= 0.5;
						p[3] -= 0.5;
					}
				}
			}
			if (i === 0) {
				oCtx.moveTo(p[0], p[1]);
			} else {
				if (aPoints[i]) {
					if (bSkip) {
						oCtx.moveTo(p[0], p[1]);
						bSkip = false;
					}
					if (p.length === 2) {
						oCtx.lineTo(p[0], p[1]);
					} else if (p.length === 4) {
						oCtx.quadraticCurveTo(p[0], p[1], p[2], p[3]);
					} else if (p.length === 6) {
						oCtx.arc(p[0], p[1], p[2], ZC._rad_(p[3]), ZC._rad_(p[4]), p[5]);
					}
				} else {
					bSkip = true;
				}
			}
		}
	},
	setup : function(oCtx, oStyle) {
		var sOutput = oStyle.oLoader.sOutput;

		if (oStyle.fAlpha !== 1) {
			if (oStyle.bAreaCorrection) {
				if (ZC._n_(oStyle.oData['border-color']) === null) {
					oStyle.sBorderColor = oStyle.sBackgroundColor1;
				}
				if (ZC._n_(oStyle.oData['border-width']) === null) {
					switch (sOutput) {
						case 'canvas':
							oStyle.iBorderWidth = 0.2;
							
							break;
						case 'svg':
							oStyle.iBorderWidth = 0.1;
							break;
						case 'vml':
							oStyle.iBorderWidth = 0.2;
							oStyle.oAttributes['fAlphaVML'] = oStyle.fAlpha/10;
							break;
					}
				}
			}
		}
	},
	paint : function(oCtx, oStyle, aPoints, bFilledPath, iIdxCache, bRectShortcut) {
		if (ZC._n_(iIdxCache) === null) {
			iIdxCache = 2;
		}
		if (ZC._n_(bFilledPath) === null) {
			bFilledPath = false;
		}
		if (ZC._n_(bRectShortcut) === null) {
			bRectShortcut = false;
		}

		if (!oCtx || !aPoints || aPoints.length === 0 || !oStyle) {
			return;
		}

		if (!bRectShortcut) {
			if (aPoints[0] !== null && aPoints[aPoints.length-1] !== null && aPoints[0].join(',') === aPoints[aPoints.length-1].join(',')) {
				oStyle.sLineCap = 'round';
			}
		}

		var oCtxSh, aPath, cp, p, sUID, i;

		var sOutput = oStyle.oLoader.sOutput;

		if (sOutput === 'canvas' && oStyle.iLineWidth === 0) {
			return;
		}

		if (oStyle.bShadow && ZC._n_(oStyle.oCanvasSh) !== null && !bFilledPath) {
			oStyle.oCanvasSh = oStyle.oCanvasSh || oStyle.oCanvas;
			var aPointsSh = ZC.ZCHtmlUtils._sh_(aPoints, oStyle);
			var oShadow;
			if (typeof(oStyle._oLineShadow) !== 'undefined') {
				oShadow = oStyle._oLineShadow;
			} else  {
				oShadow = new ZC.ZCShape(oStyle);
				oShadow.copy(oStyle);
				oShadow.sId = oStyle.sId + '-sh';
				oShadow.bShadow = false;
				oShadow.iLineWidth += oShadow.iShadowBlur;
				oShadow.sLineColor = oShadow.sShadowColor;
			}
			oShadow.fAlpha = oStyle.fAlpha*oShadow.fShadowAlpha;
			if (typeof(oStyle._oShadow) === 'undefined') {
				oStyle._oLineShadow = oShadow;
			}
			oShadow.bPixelCorrection = false;
			oCtxSh = ZC.ZCHtmlUtils._context_(oStyle.oCanvasSh, sOutput);
			
			ZC.ZCLine.setup(oCtxSh, oShadow);
			ZC.ZCLine.paint(oCtxSh, oShadow, aPointsSh, false, 1, bRectShortcut);
		}

		var iLength = oStyle.iLineSegmentSize || 0;
		var iGap = oStyle.iLineGapSize || 0;
		var iPoints = aPoints.length;
		if (typeof(oStyle.iAngle) === 'undefined') {
			oStyle.iAngle = 0;
		}

		if (sOutput === 'canvas') {
			oCtx.lineJoin = oStyle.sLineJoin;
			oCtx.lineCap = oStyle.sLineCap;
			oCtx.strokeStyle = ZC.ZCUtils._rgba_(ZC.ZCUtils._color_(oStyle.sLineColor), bFilledPath?oStyle.fBorderAlpha:oStyle.fAlpha);
			oCtx.lineWidth = oStyle.iLineWidth;
			oCtx.beginPath();
		}

		var bSkip = false;
		if (ZC._indexof_(['svg', 'vml'], sOutput) !== -1) {
			if (bRectShortcut) {
				aPath = [];
			} else {
				aPath = ZC.ZCHtmlUtils._vector_path_(aPoints, sOutput, oStyle, bFilledPath);
			}
		} else {
			var bDashAPI = false;

			bDashAPI = oCtx.setLineDash;
			if (bDashAPI) {
				oCtx.setLineDash((iLength === 0 || iGap === 0)?[]:[iLength, iGap]);
			}

			var fDelta_ = 0;
			var aBounds = [ZC.MAX, ZC.MAX, -ZC.MAX, -ZC.MAX];
			for (i=0;i<iPoints;i++) {
				if (aPoints[i] === null) {
					bSkip = true;
					continue;
				}
				if (ZC.objmove) {
					cp = aPoints[i];	
				} else {
					cp = ZC.ZCHtmlUtils._txp_(aPoints[i], sOutput, oStyle, bFilledPath);
				}
				if (cp === null || isNaN(cp[0]) || isNaN(cp[1]) || !isFinite(cp[0]) || !isFinite(cp[1])) {
					continue;
				}

				
				if (iPoints <= 6 && bFilledPath) {
					aBounds[0] = ZC._min_(aBounds[0], cp[0]);
					aBounds[1] = ZC._min_(aBounds[1], cp[1]);
					aBounds[2] = ZC._max_(aBounds[2], cp[0]);
					aBounds[3] = ZC._max_(aBounds[3], cp[1]);
				}

				if (i === 0) {
					if (cp.length === 2) {
						oCtx.moveTo(cp[0], cp[1]);
					} else if (cp.length === 6) {
						oCtx.arc(cp[0], cp[1], cp[2], ZC._rad_(cp[3]), ZC._rad_(cp[4]), cp[5]);
					}
				} else {
					if (bSkip) {
						oCtx.moveTo(cp[0], cp[1]);
						bSkip = false;
					}
					if (bDashAPI || iLength === 0 || iGap === 0 || cp.length === 4 || cp.length === 6) {
						if (cp.length === 2) {
							oCtx.lineTo(cp[0], cp[1]);
						} else if (cp.length === 4) {
							oCtx.quadraticCurveTo(cp[0], cp[1], cp[2], cp[3]);
						} else if (cp.length === 6) {
							oCtx.arc(cp[0], cp[1], cp[2], ZC._rad_(cp[3]), ZC._rad_(cp[4]), cp[5]);
						}
					} else {
						if (aPoints[i-1] !== null) {
							var pp = ZC.ZCHtmlUtils._txp_(aPoints[i-1], sOutput, oStyle, bFilledPath);
							var iXStart = pp[(pp.length === 4)?2:0];
							var iYStart = pp[(pp.length === 4)?3:1];
							var iXEnd = cp[0];
							var iYEnd = cp[1];
							var iPieceLength = iLength + iGap;
							var iDx = iXEnd - iXStart;
							var iDy = iYEnd - iYStart;
							var fDelta = Math.sqrt((iDx*iDx) + (iDy*iDy)) + fDelta_;
							if (fDelta > iLength) {
								fDelta_ = 0;
								var iPieces = Math.floor(ZC._a_(fDelta/iPieceLength));
								var fAngle = Math.atan2(iDy, iDx);
								var fCos = Math.cos(fAngle);
								var fSin = Math.sin(fAngle);
								var cx = iXStart;
								var cy = iYStart;
								iDx = fCos*iPieceLength;
								iDy = fSin*iPieceLength;
								for (p=0;p<iPieces;p++) {
									oCtx.moveTo(cx, cy);
									oCtx.lineTo(cx + fCos*iLength, cy + fSin*iLength);
									cx += iDx;
									cy += iDy;
								}
								oCtx.moveTo(cx, cy);
								fDelta = Math.sqrt((iXEnd - cx)*(iXEnd - cx) + (iYEnd - cy)*(iYEnd - cy));
								if (fDelta > iLength) {
									oCtx.lineTo(cx + fCos*iLength, cy + fSin*iLength);
								} else if (fDelta > 0) {
									oCtx.lineTo(cx + fCos*fDelta, cy + fSin*fDelta);
								}
								oCtx.moveTo(iXEnd, iYEnd);
							} else {
								fDelta_ = fDelta;
							}
						}
					}
				}
			}

			if (oStyle.oLoader && iPoints <= 6 && bFilledPath) {
				oStyle.oLoader.oAttributes[oStyle.sId + '-bounds'] = aBounds;
			}
		}

		switch (sOutput) {
			case 'canvas':
				oCtx.globalCompositeOperation = oStyle.sComposite;
				oCtx.stroke();
				break;
			case 'svg':
			case 'vml':
				if (ZC._n_(oStyle.oData['top-state']) === null && oStyle.oLoader.bCache && (!bFilledPath || oStyle.oAttributes['areanode'])) {
					if (oStyle.oAttributes['areanode']) {
						sUID = oStyle.sBackgroundColor1 + '-' + oStyle.sBackgroundColor2 + '-' + oStyle.sBackgroundImage + '-' + oStyle.iLineWidth + '-' + oStyle.sLineStyle + '-' + oStyle.fAlpha + '-' + oStyle.iOffsetX + '-' + oStyle.iOffsetY;
					} else {
						sUID = oStyle.sLineColor + '-' + oStyle.iLineWidth + '-' + oStyle.sLineStyle + '-' + oStyle.fAlpha + '-' + oStyle.iOffsetX + '-' + oStyle.iOffsetY;
					}
					if (ZC._n_(oStyle.oLoader.aCache[iIdxCache]) === null) {
						oStyle.oLoader.aCache[iIdxCache] = {
							uid : sUID,
							ctx : oCtx,
							path : aPath,
							style : oStyle,
							filled : bFilledPath
						};
						break;
					} else {
						if (oStyle.oLoader.aCache[iIdxCache].uid === sUID && oStyle.oLoader.aCache[iIdxCache].path.length < 2000) {
							
							p = oStyle.oLoader.aCache[iIdxCache].path;
							if (p.length > 0 && p[p.length-1].replace(/[A-Z]+/, '') === aPath[0].replace(/[A-Z]+/, '')) {
								aPath[0] = '';
							}
							oStyle.oLoader.aCache[iIdxCache].path = oStyle.oLoader.aCache[iIdxCache].path.concat(aPath);
							break;
						} else {
							if (sOutput === 'svg') {
								ZC.ZCLine.paintSVG(oStyle.oLoader.aCache[iIdxCache].ctx, oStyle.oLoader.aCache[iIdxCache].style, oStyle.oLoader.aCache[iIdxCache].path.join(' '), oStyle.oLoader.aCache[iIdxCache].filled);
							} else {
								ZC.ZCLine.paintVML(oStyle.oLoader.aCache[iIdxCache].ctx, oStyle.oLoader.aCache[iIdxCache].style, oStyle.oLoader.aCache[iIdxCache].path.join(' '), oStyle.oLoader.aCache[iIdxCache].filled);
							}
							oStyle.oLoader.aCache[iIdxCache] = {
								uid : sUID,
								ctx : oCtx,
								path : aPath,
								style : oStyle,
								filled : bFilledPath
							};
							break;
						}
					}
				} else {
					if (sOutput === 'svg') {
						ZC.ZCLine.paintSVG(oCtx, oStyle, aPath.join(' '), bFilledPath, bRectShortcut);
					} else {
						ZC.ZCLine.paintVML(oCtx, oStyle, aPath.join(' '), bFilledPath);
					}
				}
				break;
		}
		if (ZC._n_(oStyle.oData['top-state']) !== null && !oStyle.bIsShadow && !oStyle.oAttributes['skip-top']) {
			if (!oStyle.bIsTop) {
				var oTop = new ZC.ZCBox(oStyle.oParent);
				oTop.copy(oStyle);
				oTop.bIsTop = true;
				oTop.bShadow = false;
				oTop.oCanvas = oStyle.oCanvas;
				oTop.append(oStyle.oData['top-state']);
				oTop.sId = oStyle.sId + '-top';
				oTop.parse();
				if (sOutput === 'svg') {
					ZC.ZCLine.paintSVG(oCtx, oTop, aPath.join(' '), bFilledPath, bRectShortcut);
				} else if (sOutput === 'vml') {
					ZC.ZCLine.paintVML(oCtx, oTop, aPath.join(' '), bFilledPath);
				} else {
					ZC.ZCLine.paint(oCtx, oTop, aPoints, bFilledPath, iIdxCache, bRectShortcut);					
				}
			}
		}
	},

	_append_ : function(oCtx, oStyle, oNode) {
		if (oStyle.oLoader && oStyle.oLoader.oDOMFragments) {
			if (ZC._n_(oStyle.oLoader.oDOMFragments[oCtx.id]) === null) {
				oStyle.oLoader.oDOMFragments[oCtx.id] = document.createDocumentFragment();
			}
			oStyle.oLoader.oDOMFragments[oCtx.id].appendChild(oNode);
		} else {
			oCtx.appendChild(oNode);
		}
	},

	paintSVG : function(oCtx, oStyle, sSVGPath, bFilledPath, bRectShortcut) {
		if (sSVGPath === '' && !bRectShortcut) {
			return;
		}

		var oLine, iRectX, iRectY, iRectWidth, iRectHeight, iRectRX, iRectRY;

		if (!ZC.cache.data['svg-rect']) {
			ZC.cache.data['svg-rect'] = ZC.ZCHtmlUtils._element_('rect', 'http://www.w3.org/2000/svg');
		}

		if (bRectShortcut) {
			oLine = ZC.cache.data['svg-rect'].cloneNode(true);
		} else {
			oLine = ZC.ZCHtmlUtils._element_('path', 'http://www.w3.org/2000/svg');
		}

		var oAttrs = {};

		if (!bRectShortcut) {
			oAttrs['d'] = sSVGPath;
		}

		if (bRectShortcut) {
			if (oStyle.iWidth < 0) {
				oStyle.iX -= oStyle.iWidth;
				oStyle.iWidth = -oStyle.iWidth;
			}
			if (oStyle.iHeight < 0) {
				oStyle.iY += oStyle.iHeight;
				oStyle.iHeight = -oStyle.iHeight;
			}
			var offx = 0, offy = 0, dec = 1;
			if (oStyle.bPixelCorrection) {
				dec = 0;
				offx = offy = oStyle.iLineWidth/2;
				
				if (oStyle.iX === 0) {
					offx = 0;
				}
				if (oStyle.iY === 0) {
					offy = 0;
				}
			}
			if (dec === 0 || oStyle.iWidth <= 3 || oStyle.iHeight <= 3) {
				iRectX = Math.floor(oStyle.iX) + offx;
				iRectY = Math.floor(oStyle.iY) + offy;
				iRectWidth = Math.ceil(oStyle.iWidth) - 2*offx;
				iRectHeight = Math.ceil(oStyle.iHeight) - 2*offx;
				iRectRX = oStyle.iBorderRadiusTopLeft;
				iRectRY = oStyle.iBorderRadiusTopLeft;
			} else {
				iRectX = parseFloat(oStyle.iX.toFixed(dec)) + offx;
				iRectY = parseFloat(oStyle.iY.toFixed(dec)) + offy;
				iRectWidth = parseFloat(oStyle.iWidth.toFixed(dec)) - 2*offx;
				iRectHeight = parseFloat(oStyle.iHeight.toFixed(dec)) - 2*offy;
				iRectRX = oStyle.iBorderRadiusTopLeft;
				iRectRY = oStyle.iBorderRadiusTopLeft;
			}
			oAttrs['x'] = iRectX;
			oAttrs['y'] = iRectY;
			oAttrs['width'] = ZC._max_(0, iRectWidth);
			oAttrs['height'] = ZC._max_(0, iRectHeight);
			oAttrs['rx'] = iRectRX;
			oAttrs['ry'] = iRectRY;

			if (oStyle.oLoader) {
				oStyle.oLoader.oAttributes[oStyle.sId + '-bounds'] = [oAttrs['x'], oAttrs['y'], oAttrs['x'] + oAttrs['width'], oAttrs['y'] + oAttrs['height']];
			}
		}

		var sId = '';
		if (typeof(oStyle.sId) === 'undefined' || oStyle.sId === '') {
			if (typeof(oStyle.oLoader) !== 'undefined') {
				sId = oStyle.oLoader.GRAPHID + '-path-' + ZC.SEQ;
				ZC.SEQ++;
			}
		} else {
			sId = oStyle.sId + '-path';
		}

		var sTransform = '';
		if (typeof(oStyle.iOffsetX) !== 'undefined' && typeof(oStyle.iOffsetY) !== 'undefined') {
			if (oStyle.iOffsetX !== 0 || oStyle.iOffsetY !== 0) {
				sTransform += 'translate(' + oStyle.iOffsetX + ' ' + oStyle.iOffsetY + ')';
			}
		}
		if (typeof(oStyle.iAngle) !== 'undefined') {
			if (oStyle.iAngle !== 0) {
				var sRotate = oStyle.iAngle;
				if (typeof(oStyle.oAttributes['cx']) !== 'undefined') {
					sRotate += ',' + (ZC._i_(oStyle.oAttributes['cx'])+0.5);
				}
				if (typeof(oStyle.oAttributes['cy']) !== 'undefined') {
					sRotate += ',' + (ZC._i_(oStyle.oAttributes['cy'])+0.5);
				}
				sTransform += ' rotate(' + sRotate + ')';
			}
		}
		if (bFilledPath && oStyle.oAttributes['fill'] !== -1) {
			oAttrs['fill'] = oStyle.oAttributes['fill'];
			oAttrs['fill-opacity'] = oStyle.fAlpha;
		} else {
			oAttrs['fill'] = 'none';
		}

		if (oStyle.iLineWidth > 0) {
			oAttrs['stroke'] = oStyle.sLineColor;
			oAttrs['stroke-width'] = oStyle.iLineWidth;
			
			oAttrs['stroke-opacity'] = bFilledPath?oStyle.fBorderAlpha:oStyle.fAlpha;
			oAttrs['stroke-linecap'] = oStyle.sLineCap;
			oAttrs['stroke-linejoin'] = oStyle.sLineJoin;

			if (oStyle.iLineSegmentSize !== 0 || oStyle.iLineGapSize !== 0) {
				oAttrs['stroke-dasharray'] = oStyle.iLineSegmentSize + ',' + oStyle.iLineGapSize;
			}
		}
		oLine.id = sId;

		if (sTransform !== '') {
			oAttrs['transform'] = sTransform;
		}

		ZC.ZCHtmlUtils._attr_(oLine, oAttrs);

		ZC.ZCLine._append_(oCtx, oStyle, oLine);

		var oLineBg;
		if (!oStyle.oAttributes['border'] || oStyle.oAttributes['border'] === 'all') {
			if (typeof(oStyle.oAttributes['imgfill']) !== 'undefined') {
				if (typeof(oStyle.oAttributes['imgfill']) === 'string') {
					if (!ZC._id_(sId + '-imgfill')) {
						if (bRectShortcut) {
							oLineBg = ZC.ZCHtmlUtils._element_('rect', 'http://www.w3.org/2000/svg');
						} else {
							oLineBg = ZC.ZCHtmlUtils._element_('path', 'http://www.w3.org/2000/svg');
						}
						ZC.ZCHtmlUtils._attr_(oLineBg, {
							id : sId + '-imgfill',
							transform : sTransform,
							fill : oStyle.oAttributes['imgfill'],
							'fill-opacity' : oStyle.fAlpha
						});
						if (bRectShortcut) {
							ZC.ZCHtmlUtils._attr_(oLineBg, {
								x : iRectX,
								y : iRectY,
								width : ZC._max_(0, iRectWidth),
								height : ZC._max_(0, iRectHeight),
								rx : iRectRX,
								ry : iRectRY
							});
						} else {
							ZC.ZCHtmlUtils._attr_(oLineBg, {
								d : sSVGPath
							});
						}
						ZC.ZCLine._append_(oCtx, oStyle, oLineBg);
					}
				} else {
					
					if (!ZC._id_(sId + '-imgfill')) {
						var aFillInfo = oStyle.oAttributes['imgfill'];
						var oSvgImage = ZC.ZCHtmlUtils._element_('image', 'http://www.w3.org/2000/svg');
						if (oSvgImage.setAttributeNS) {
							if (oStyle.sBackgroundImage.substring(0, 3) === 'zc.') {
								oSvgImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', ZC.IMAGES[oStyle.sBackgroundImage]);
							} else {
								oSvgImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', oStyle.sBackgroundImage);
							}
						} else {
							if (oStyle.sBackgroundImage.substring(0, 3) === 'zc.') {
								oSvgImage.setAttribute('src', ZC.IMAGES[oStyle.sBackgroundImage]);
							} else {
								oSvgImage.setAttribute('src', oStyle.sBackgroundImage);
							}
						}

						
						if (ZC._n_(oStyle.oAttributes['clip-path']) !== null) {
							ZC.ZCHtmlUtils._attr_(oSvgImage, {
								'clip-path' : 'url(#' + oStyle.oAttributes['clip-path'] + ')'
							});
						}

						ZC.ZCHtmlUtils._attr_(oSvgImage, {
							id : sId + '-imgfill',
							x : aFillInfo[1],
							y : aFillInfo[2],
							'fill-opacity' : oStyle.fAlpha,
							width : oStyle.oAttributes['bg-image-width'],
							height : oStyle.oAttributes['bg-image-height'],
							preserveAspectRatio : 'none'
						});
						ZC.ZCLine._append_(oCtx, oStyle, oSvgImage);
					}
				}
			}
		}

		
	},

	paintVML : function(oCtx, oStyle, sVMLPath, bFilledPath) {
		var mValue;
		if (bFilledPath) {
			sVMLPath += ' x e';
		}

		var iLineWidth, sLineColor, fAlpha, sLineStyle, oVmlImage;

		var sId = '';
		if (typeof(oStyle.sId) === 'undefined' || oStyle.sId === '') {
			if (typeof(oStyle.oLoader) !== 'undefined') {
				sId = oStyle.oLoader.GRAPHID + '-path-' + ZC.SEQ;
				ZC.SEQ++;
			}
		} else {
			sId = oStyle.sId + '-path';
		}

		var oShape = ZC.ZCHtmlUtils._element_('zcv:shape');
		oShape.style.position = 'absolute';
		oShape.style.rotation = oStyle.iAngle;
		oShape.id = sId;

		var oPath = ZC.ZCHtmlUtils._element_('zcv:path');
		oPath.v = sVMLPath;
		oPath.setAttribute('VMLv', sVMLPath);
		oShape.appendChild(oPath);

		if (oStyle.iLineWidth === 0) {
			oShape.stroked = false;
		} else {

			var oStroke = ZC.ZCHtmlUtils._element_('zcv:stroke');

			fAlpha = oStyle.fAlpha;
			if (typeof(oStyle.oAttributes['fAlphaVML']) !== 'undefined') {
				fAlpha = oStyle.oAttributes['fAlphaVML'];
			}

			if (typeof(oStyle.oAttributes['stroke']) !== 'undefined') {
				iLineWidth = oStyle.oAttributes['stroke'].weight;
				sLineColor = oStyle.oAttributes['stroke'].color;
				fAlpha = oStyle.oAttributes['stroke'].opacity;
				sLineStyle = oStyle.oAttributes['stroke'].dashstyle;
			} else {
				sLineStyle = 'solid';
				switch (oStyle.sLineStyle) {
					case 'solid':
						sLineStyle = 'solid';
						break;
					case 'dotted':
						sLineStyle = 'dot';
						break;
					case 'dashed':
						sLineStyle = 'dash';
						break;
				}
				if ((mValue=(ZC._min_(6, oStyle.iLineSegmentSize*oStyle.iLineWidth) + ' ' + ZC._min_(8, oStyle.iLineGapSize*oStyle.iLineWidth))) !== '0 0') {
					sLineStyle = mValue;
				}

				iLineWidth = oStyle.iLineWidth;
				sLineColor = oStyle.sLineColor;
			}

			ZC.ZCHtmlUtils._attr_(oStroke, {
				weight : (iLineWidth + 'px'),
				color : sLineColor,
				opacity : fAlpha,
				miterlimit : 10,
				endcap : 'flat',
				joinstyle : 'round',
				dashstyle : sLineStyle
			});

			oShape.appendChild(oStroke);
		}

		if (bFilledPath && typeof(oStyle.oAttributes['fill']) !== 'undefined') {
			if (oStyle.oAttributes['fill'] !== -1) {
				oShape.filled = true;
				oShape.appendChild(oStyle.oAttributes['fill']);
			} else {
				oShape.filled = false;
			}
		} else {
			oShape.filled = false;
		}

		ZC.ZCHtmlUtils._attr_(oShape, {
			coordorigin : '0 0',
			coordsize : (oStyle.iAngle%360 === 0)?'100 100':(oStyle.oLoader.iWidth + ' ' + oStyle.oLoader.iHeight)
		});

		var iDx = 0, iDy = 0;
		var iDx_ = 0, iDy_ = 0;
		if (oStyle.iAngle%360 !== 0 && typeof(oStyle.oAttributes['cx']) !== 'undefined' && typeof(oStyle.oAttributes['cy']) !== 'undefined') {
			var w = oStyle.oLoader.iWidth/2-oStyle.oAttributes['cx'];
			var h = oStyle.oLoader.iHeight/2-oStyle.oAttributes['cy'];
			var a = (h === 0)?0:ZC._deg_(Math.atan(w/h));

			if (oStyle.oAttributes['cy'] > oStyle.oLoader.iHeight/2) {
				a += 180;
			}
			var fRadius = Math.sqrt(w*w+h*h);
			var w_ = fRadius*ZC._sin_(a-oStyle.iAngle);
			var h_ = fRadius*ZC._cos_(a-oStyle.iAngle);
			iDx_ = w - w_;
			iDy_ = h - h_;
		}

		var iLeft = iDx-iDx_;
		if (ZC._n_(oStyle.iOffsetX) !== null) {
			iLeft += oStyle.iOffsetX;
		}
		var iTop = iDy-iDy_;
		if (ZC._n_(oStyle.iOffsetY) !== null) {
			iTop += oStyle.iOffsetY;
		}

		oShape.style.left = iLeft + 'px';
		oShape.style.top = iTop + 'px';

		oCtx.appendChild(oShape);

		if (oStyle.iAngle%360 === 0) {
			oShape.style.width = '10px';
			oShape.style.height = '10px';
		} else {
			oShape.style.width = oStyle.oLoader.iWidth + 'px';
			oShape.style.height = oStyle.oLoader.iHeight + 'px';
		}

		if (oStyle.oAttributes['border'] === 'all' || typeof(oStyle.oAttributes['imgfill']) !== 'undefined') {

			if (typeof(oStyle.oAttributes['imgfill']) !== 'undefined') {
				var aFillInfo = oStyle.oAttributes['imgfill'];	

				if (aFillInfo.length === 1) {
					oShape = ZC.ZCHtmlUtils._element_('zcv:shape');
					oShape.style.position = 'absolute';
					oShape.style.rotation = oStyle.iAngle;
					oPath = ZC.ZCHtmlUtils._element_('zcv:path');
					oPath.v = sVMLPath;
					oShape.appendChild(oPath);
					oShape.appendChild(aFillInfo[0]);
					oShape.stroked = false;

					ZC.ZCHtmlUtils._attr_(oShape, {
						id : sId + '-imgfill',
						filled : true,
						coordorigin : '0 0',
						coordsize : (oStyle.iAngle%360 === 0)?'100 100':(oStyle.oLoader.iWidth + ' ' + oStyle.oLoader.iHeight)
					});

					oShape.style.left = iLeft + 'px';
					oShape.style.top = iTop + 'px';
					oCtx.appendChild(oShape);
					if (oStyle.iAngle%360 === 0) {
						oShape.style.width = '10px';
						oShape.style.height = '10px';
					} else {
						oShape.style.width = oStyle.oLoader.iWidth + 'px';
						oShape.style.height = oStyle.oLoader.iHeight + 'px';
					}
				} else if (aFillInfo.length === 3) {
					oVmlImage = ZC.ZCHtmlUtils._element_('img');
					oVmlImage.id = sId + '-img';
					if (oStyle.sBackgroundImage.substring(0, 3) === 'zc.') {
						oVmlImage.src = ZC.IMAGES[oStyle.sBackgroundImage];
					} else {
						oVmlImage.src = oStyle.sBackgroundImage;
					}
					oVmlImage.style.position = 'absolute';
					oVmlImage.style.left = aFillInfo[1] + 'px';
					oVmlImage.style.top = aFillInfo[2] + 'px';
					oVmlImage.style.width = oStyle.oAttributes['bg-image-width'] + 'px';
					oVmlImage.style.height = oStyle.oAttributes['bg-image-height'] + 'px';
					oCtx.appendChild(oVmlImage);
				}
			}

		}
	}

};










ZC.ZCShape = ZC.ZCStyle.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oParent = oParent;
		self.oCanvas = null;
		self.oCanvasSh = null;
		self.sObjectId = '';
		self.iX = -1;
		self.iY = -1;
		self.sShape = 'poly';
		self.aPoints = [];
		self.aBounds = [0, 0, 0, 0];
		self.iAngle = 0;
		self.iSize = 0;
		self.iSize2 = 0;
		self.iOffsetX = 0;
		self.iOffsetY = 0;
		self.iOffsetZ = 0;
		self.iOffsetR = 0;
		self.iPieAngleStart = 0;
		self.iPieAngleEnd = 360;
		self.iPieSlice = 0;
		self.bTweening = false;
		self.bAbsolute = false;
		self.sMapId = 0;
		self.sItemId = '';
		self.bCache = false;
		self.iZSort = 1;
		self.iZIndex = 1;
		self.sUrl = null;
		self.sTarget = null;
		self.sCursor = 'auto';
		self.bFlat = false;
		self.sComposite = 'source-over';
		self.bFastVectorPath = false;
		
	},
	getPMap : function() {
		var oMap = this._super();
		this.addPMap(oMap, 'objectId,x,y,points,bounds,pieAngleStart,pieAngleEnd,pieSlice,url,target,offsetX,offsetY,offsetR,size,size2,angle,shape,flat','sObjectId,iX,iY,aPoints,aBounds,iPieAngleStart,iPieAngleEnd,iPieSlice,sUrl,sTarget,iOffsetX,iOffsetY,iOffsetR,iSize,iSize2,iAngle,sShape,bFlat');
		return oMap;
	},
	build : function() {
	},
	copy : function(oObject) {
		var self = this, i, iLen;
		self._super(oObject);
		var aAttributes = 'iOffsetX,iOffsetY,iOffsetR,iSize,iSize2,iAngle,sShape,bFlat'.split(',');
		for (i=0,iLen=aAttributes.length;i<iLen;i++) {
			if (typeof(oObject[aAttributes[i]]) !== 'undefined') {
				self[aAttributes[i]] = oObject[aAttributes[i]];
			}
		}
		if (oObject.aPoints && oObject.aPoints.length > 0) {
			self.aPoints = [];
			for (i=0,iLen=oObject.aPoints.length;i<iLen;i++) {
				self.aPoints.push(oObject.aPoints[i]);
			}
		}
	},
	ll_ : function(xy, mWhat) {
		var self = this;
		if ((''+xy).indexOf('lat') !== -1) {
			mWhat = 'y';
		}
		if ((''+xy).indexOf('lon') !== -1) {
			mWhat = 'x';
		}
		xy = ZC._f_((''+xy).replace('lat', '').replace('lon', ''));
		var oMap = zingchart.maps.maps[self.sMapId];
		if (oMap) {
			xy = zingchart.maps.lonlat2xy(oMap._INFO_.x, oMap._INFO_.y, oMap._INFO_.width, oMap._INFO_.height, (mWhat==='x')?[xy, 0]:[0, xy], oMap._INFO_.bbox, {map : self.sMapId, item : self.sItemId, zoom : oMap._INFO_.zoom, offsetX : oMap._INFO_.offsetX, offsetY : oMap._INFO_.offsetY }, true);
		}
		xy = ZC._i_((mWhat==='x')?xy[0]:xy[1]);
		return xy;
	},
	kv_ : function(xy, mWhat) {
		var self = this, mValue;
		if ((''+xy).indexOf('val') !== -1) {
			mWhat = 'y';
		}
		if ((''+xy).indexOf('key') !== -1) {
			mWhat = 'x';
		}
		xy = ZC._f_((''+xy).replace('key', '').replace('val', ''));
		 
		var oLoader = self.oLoader || zingchart.aLoaders[0];
		if (oLoader) {
			var oGraph = self.oParent || oLoader.aGraphs[0];
			if (oGraph) {
				if (mWhat === 'x') {
					if ((mValue=oGraph.getScales('k')[0]) !== null) {
						xy = ZC._i_(mValue.getCoordByValue(xy));
					}
				} else {
					if ((mValue=oGraph.getScales('v')[0]) !== null) {
						xy = ZC._i_(mValue.getCoordByValue(xy));
					}
				}
			}
		}
		return ZC._i_(xy);
	},
	xy_ : function(xy, mWhat, bPC) {
		var self = this;
		mWhat = mWhat || 'x';
		var sxy = '' + xy;
		if (sxy.indexOf('lat') !== -1 || sxy.indexOf('lon') !== -1) {
			return self.ll_(xy, mWhat);
		} else if (sxy.indexOf('val') !== -1 || sxy.indexOf('key') !== -1) {
			return self.kv_(xy, mWhat);
		} else {
			if (('' + ZC._f_(xy)) === sxy) {
				var iPX = (typeof(self.oAttributes['p-x'])!=='undefined')?self.oAttributes['p-x']:self.oParent.iX;
				var iPY = (typeof(self.oAttributes['p-y'])!=='undefined')?self.oAttributes['p-y']:self.oParent.iY;
				var iPWidth = (typeof(self.oAttributes['p-width'])!=='undefined')?self.oAttributes['p-width']:self.oParent.iWidth;
				var iPHeight = (typeof(self.oAttributes['p-height'])!=='undefined')?self.oAttributes['p-height']:self.oParent.iHeight;
				if ((xy >= 1 || xy < 0 || zingchart.DEV.IGNORESUBUNIT) && !bPC) {
					if (mWhat === 'x') {
						return iPX + Math.round(xy);
					} else {
						return iPY + Math.round(xy);
					}
				} else if ((xy >= 0 && xy < 1) || bPC) {
					if (mWhat === 'x') {
						return Math.round(iPX + iPWidth*xy);
					} else {
						return Math.round(iPY + iPHeight*xy);
					}
				}
			} else {
				xy = xy + '';
				if (xy.indexOf('%') !== -1) {
					return self.xy_(parseFloat(xy.replace('%', ''))/100, mWhat, true);
				} else if (xy.indexOf('px') !== -1) {
					return self.xy_(parseFloat(xy.replace('px', '')), mWhat);
				} else {
					return self.xy_(parseFloat(xy), mWhat);
				}
			}
		}
	},
	locate : function(iStep) {
		var self = this, mValue;
		
		if (self.bTweening) {
			if ((''+self.oData['x']).indexOf('lon') !== -1) {
				self.iX = self.ll_(self.oData['x'], 'x');
			} else {
				self.assign('x', 'iX');
			}
			if ((''+self.oData['y']).indexOf('lat') !== -1) {
				self.iY = self.ll_(self.oData['y'], 'y');
			} else {
				self.assign('y', 'iY');
			}
			self.getBounds();
			return;
		}
		if (iStep === 1) {
			if ((mValue=ZC._n_(self.oData['x'])) !== null) {
				self.iX = self.xy_(mValue, 'x');
			}
			if ((mValue=ZC._n_(self.oData['y'])) !== null) {
				self.iY = self.xy_(mValue, 'y');
			}
			if (self.iX === -1) {
				self.iX = self.oParent.iX;
			}
			if (self.iY === -1) {
				self.iY = self.oParent.iY;
			}
		} else if (iStep === 2) {
			self.getBounds();
			self.iWidth = self.aBounds[2] - self.aBounds[0];
			self.iHeight = self.aBounds[3] - self.aBounds[1];
		}
	},
	getBounds : function() {
		var self = this, mValue;
		var iXMin = ZC.MAX;
		var iYMin = ZC.MAX;
		var iXMax = -ZC.MAX;
		var iYMax = -ZC.MAX;
		switch (self.sShape) {
			case 'custom':
				iXMin = 0;
				iYMin = 0;
				iXMax = 0;
				iYMax = 0;
				break;
			case 'circle':
			case 'arc':
			case 'pie':
				iXMin = self.iX - self.iSize;
				iYMin = self.iY - self.iSize;
				iXMax = self.iX + self.iSize;
				iYMax = self.iY + self.iSize;
				break;
			default:
				for (var i=0,iLen=self.aPoints.length;i<iLen;i++) {
					if ((mValue=self.aPoints[i]) !== null) {
						iXMin = Math.min(iXMin, mValue[0]);
						iYMin = Math.min(iYMin, mValue[1]);
						iXMax = Math.max(iXMax, mValue[0]);
						iYMax = Math.max(iYMax, mValue[1]);
					}
				}
				break;
		}
		self.aBounds = [iXMin, iYMin, iXMax, iYMax];
	},
	getAreaCoords : function() {
		var self = this, iAngle;
		if (self.sShape === 'pie') {
			var iStep = 1;
			var aPiePoints = [];
			if (self.iSize > 50) { iStep = 2; }
			if (self.iSize > 100) { iStep = 4; }
			if (self.iPieSlice === 0) {
				if (self.iPieAngleStart%360 !== self.iPieAngleEnd%360) {
					aPiePoints.push([self.iX, self.iY]);
				}
			} else {
				aPiePoints.push(
					ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice, self.iPieAngleStart),
					ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize, self.iPieAngleStart)
				);
			}
			for (iAngle=self.iPieAngleStart;iAngle<=self.iPieAngleEnd;iAngle+=iStep) {
				aPiePoints.push(ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize, iAngle));
			}
			aPiePoints.push(ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize, self.iPieAngleEnd));
			if (self.iPieSlice === 0) {
				if (self.iPieAngleStart%360 !== self.iPieAngleEnd%360) {
					aPiePoints.push([self.iX, self.iY]);
				}
			} else {
				aPiePoints.push(ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice, self.iPieAngleEnd));
				for (iAngle=self.iPieAngleEnd;iAngle>=self.iPieAngleStart;iAngle-=iStep) {
					aPiePoints.push(ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice, iAngle));
				}
				aPiePoints.push(ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice, self.iPieAngleStart));
			}
			aPiePoints.push([aPiePoints[0][0], aPiePoints[0][1]]);
			return ZC.ZCMath._htmlarea_(aPiePoints, Math.min(5, self.iSize/5));
		}
		return ZC.ZCMath._htmlarea_(self.aPoints, Math.min(5, self.iSize/5));
	},
	getAreaInfo : function() {
		var self = this, i, iLen, aPoints, cx, cy, x, y, tx, ty;
		var iOffset = ZC.ie67?ZC.MAPTX:0;
		switch (self.sShape) {
			case 'line':
				aPoints = [].concat(self.aPoints);
				if (self.iAngle !== 0) {
					cx = (self.aBounds[0]+self.aBounds[2])/2;
					cy = (self.aBounds[1]+self.aBounds[3])/2;
					for (i=0,iLen=aPoints.length;i<iLen;i++) {
						if (aPoints[i] !== null) {
							x = aPoints[i][0] - cx;
							y = aPoints[i][1] - cy;
							tx = x*ZC._cos_(self.iAngle) - y*ZC._sin_(self.iAngle);
							ty = x*ZC._sin_(self.iAngle) + y*ZC._cos_(self.iAngle);
							aPoints[i] = [tx + cx, ty + cy];
						}
					}
				}
				var aSegments = ['poly'];
				for (i=0,iLen=aPoints.length;i<iLen-1;i++) {
					if (aPoints[i] !== null && aPoints[i+1] !== null) {
						aSegments.push(ZC.ZCMath._htmlarea_(ZC.ZCMath._contour_([aPoints[i], aPoints[i+1]]), 4));
					}
				}
				return aSegments;
			case 'cross':
			case 'plus':
				return ['circle', (self.iX + iOffset) + ',' + (self.iY + iOffset) + ',' + ZC._i_(self.iSize)];
			case 'circle':
			case 'arc':
				return ['circle', (self.iX + iOffset) + ',' + (self.iY + iOffset) + ',' + ZC._i_(self.iSize)];
			case 'pie':
				return ['poly', self.getAreaCoords()];
			default:
				
				var aPath = ['poly'];
				aPoints = [];
				for (i=0,iLen=self.aPoints.length;i<iLen;i++) {
					if (self.aPoints[i] !== null) {
						if (self.aPoints[i].length === 6) {
							for (var a=self.aPoints[i][3];a<self.aPoints[i][4];a+=1) {
								aPoints.push(ZC.ZCMath._cpoint_(self.aPoints[i][0], self.aPoints[i][1], self.aPoints[i][2], a));
							}
						} else if (self.aPoints[i].length === 4 && aPoints[i-1]) {
							var p0 = {x : aPoints[aPoints.length-1][0], y : aPoints[aPoints.length-1][1]};
							var p2 = {x : self.aPoints[i][2], y : self.aPoints[i][3]};
							var p1 = {x : self.aPoints[i][0], y : self.aPoints[i][1]};
							for (var t=0;t<=1;t+=0.1) {
								aPoints.push([
									(1-t)*(1-t)*p0.x + 2*t*(1-t)*p1.x + t*t*p2.x,
									(1-t)*(1-t)*p0.y + 2*t*(1-t)*p1.y + t*t*p2.y
								]);
							}
						} else {
							aPoints.push(self.aPoints[i]);
						}
					} else {
						if (aPoints.length > -1) {
							aPath.push(ZC.ZCMath._htmlarea_(aPoints, Math.min(5, self.iSize/5)));
						}
						aPoints = [];
					}
				}

				if (self.iAngle !== 0) {
					cx = ZC._i_((self.aBounds[0]+self.aBounds[2])/2);
					cy = ZC._i_((self.aBounds[1]+self.aBounds[3])/2);
					for (i=0,iLen=aPoints.length;i<iLen;i++) {
						if (aPoints[i] !== null) {
							x = aPoints[i][0] - cx;
							y = aPoints[i][1] - cy;
							tx = x*ZC._cos_(self.iAngle) - y*ZC._sin_(self.iAngle);
							ty = x*ZC._sin_(self.iAngle) + y*ZC._cos_(self.iAngle);
							aPoints[i] = [tx + cx, ty + cy];
						}
					}
				}

				if (aPoints.length > -1) {
					aPath.push(ZC.ZCMath._htmlarea_(aPoints, Math.min(5, self.iSize/5)));
				}
				return aPath;
		}
	},
	parse : function() {
		var self = this, mValue, i, iLen, iParts, iAngleStep, iAngleOffset, iInnerSize;

		if (!self.oData['tween']) {

			self._super();

			self.assign_a([
				['map', 'sMapId'],
				['item', 'sItemId']
			]);

			
			var aOffsets = ['offset-x', 'offset-y'];
			for (i=0;i<2;i++) {
				var sOffset = aOffsets[i];
				var sCoord = (sOffset==='offset-x')?'lon':'lat';
				if ((mValue=self.oData[sOffset]) !== null && typeof(mValue) !== 'undefined') {
					mValue = '' + mValue;
					if (mValue.indexOf(sCoord) !== -1) {
						mValue = ZC._f_(mValue.replace(sCoord, ''));
						var oMap = zingchart.maps.maps[self.sMapId];
						if (oMap) {
							mValue = zingchart.maps.translate(sOffset.replace('offset-'), mValue, self.oParent.iWidth, self.oParent.iHeight, oMap._INFO_.bbox);
							self.oData[sOffset] = mValue;
						}
					}
				}
			}

			self.assign_a([
				['url', 'sUrl'],
				['target', 'sTarget'],
				['cursor', 'sCursor'],
				['id', 'sObjectId'],
				['angle', 'iAngle', 'i'],
				['static', 'bFlat', 'b'],
				['flat', 'bFlat', 'b'], 
				['angle-start', 'iPieAngleStart', 'f'],
				['angle-end', 'iPieAngleEnd', 'f'],
				['slice', 'iPieSlice', 'i'],
				['size', 'iSize', 'f'],
				['size-2', 'iSize2', 'f'],
				['fast-vector-path', 'bFastVectorPath', 'b'],
				['type', 'sShape'],
				['points', 'aPoints'],
				['offset-x', 'iOffsetX'],
				['offset-y', 'iOffsetY'],
				['offset-z', 'iOffsetZ', 'i'],
				['offset-r', 'iOffsetR', 'i'],
				['z-sort', 'iZSort', 'i'],
				['z-index', 'iZIndex', 'i'],
				['composite', 'sComposite']
			]);

			self.iOffsetX = ZC._dimension_(self.iOffsetX, true);
			self.iOffsetY = ZC._dimension_(self.iOffsetY, true);
			if (self.iOffsetX > -1 && self.iOffsetX < 1 && typeof(self.oAttributes['p-width']) !== 'undefined') {
				self.iOffsetX *= self.oAttributes['p-width'];
			}
			if (self.iOffsetY > -1 && self.iOffsetY < 1 && typeof(self.oAttributes['p-height']) !== 'undefined') {
				self.iOffsetY *= self.oAttributes['p-height'];
			}

			self.iSize = ZC._max_(1, self.iSize);
			self.iSize2 = ZC._max_(1, self.iSize2);

			if (self.oData['z-sort'] === null || typeof(self.oData['z-sort']) === 'undefined') {
				self.iZSort = self.iZIndex;
			}

			if (self.sShape === 'rectangle' || self.sShape === 'rect') {
				self.assign_a([
					
					['width', 'iSize', 'f'],
					['height', 'iSize2', 'f']
				]);
			}

			
			for (i=0,iLen=self.aPoints.length;i<iLen;i++) {
				if (self.aPoints[i] !== null) {
					for (var j=0;j<self.aPoints[i].length;j++) {
						if ((''+self.aPoints[i][j]).indexOf('lat') !== -1 || (''+self.aPoints[i][j]).indexOf('lon') !== -1) {
							self.aPoints[i][j] = self.ll_(self.aPoints[i][j], (j%2===0)?'x':'y');
						}
						if ((''+self.aPoints[i][j]).indexOf('key') !== -1 || (''+self.aPoints[i][j]).indexOf('val') !== -1) {
							self.aPoints[i][j] = self.kv_(self.aPoints[i][j], (j%2===0)?'x':'y');
						}
					}
				}
			}
		}
		self.oData['tween'] = null;

		self.iAngle = self.iAngle%360;
		self.locate(1);

		if (self.sShape !== 'bar') {
			var iSize_ = self.iSize;
			switch (self.sShape) {
				case 'custom':
					break;
				case 'triangle':
					iSize_ = self.iSize;
					var iY_ = 0.1*self.iSize;
					self.aPoints = [
						[self.iX-iSize_, self.iY+iSize_-iY_],
						[self.iX, self.iY-iSize_-iY_],
						[self.iX+iSize_, self.iY+iSize_-iY_],
						[self.iX-iSize_, self.iY+iSize_-iY_]
					];
					break;
				case 'square':
					iSize_ = ZC._i_(self.iSize*0.9);
					self.aPoints = [
						[self.iX-iSize_, self.iY-iSize_],
						[self.iX-iSize_, self.iY+iSize_],
						[self.iX+iSize_, self.iY+iSize_],
						[self.iX+iSize_, self.iY-iSize_],
						[self.iX-iSize_, self.iY-iSize_]
					];
					break;
				case 'diamond':
					iSize_ = ZC._i_(self.iSize*1.2);
					self.aPoints = [
						[self.iX-iSize_, self.iY],
						[self.iX, self.iY+iSize_],
						[self.iX+iSize_, self.iY],
						[self.iX, self.iY-iSize_],
						[self.iX-iSize_, self.iY]
					];
					break;
				case 'trapezoid':
					self.aPoints = [
						[self.iX-iSize_/2, self.iY+self.iSize2],
						[self.iX+iSize_/2, self.iY+self.iSize2],
						[self.iX+iSize_, self.iY-self.iSize2],
						[self.iX-iSize_, self.iY-self.iSize2],
						[self.iX-iSize_/2, self.iY+self.iSize2]
					];
					break;
				case 'rectangle':
				case 'rect':
					self.aPoints = [
						[self.iX-iSize_/2, self.iY-self.iSize2/2],
						[self.iX+iSize_/2, self.iY-self.iSize2/2],
						[self.iX+iSize_/2, self.iY+self.iSize2/2],
						[self.iX-iSize_/2, self.iY+self.iSize2/2],
						[self.iX-iSize_/2, self.iY-self.iSize2/2]
					];
					break;
				case 'parallelogram':
					self.aPoints = [
						[self.iX-iSize_/2, self.iY-self.iSize2/2],
						[self.iX+3*iSize_/2, self.iY-self.iSize2/2],
						[self.iX+iSize_, self.iY+self.iSize2/2],
						[self.iX-iSize_, self.iY+self.iSize2/2],
						[self.iX-iSize_/2, self.iY-self.iSize2/2]
					];
					break;
				case 'plus':
					iSize_ = self.iSize;
					self.aPoints = [
						[self.iX, self.iY-iSize_],
						[self.iX, self.iY+iSize_],
						null,
						[self.iX-iSize_, self.iY],
						[self.iX+iSize_, self.iY]
					];
					break;
				case 'cross':
					iSize_ = self.iSize;
					self.aPoints = [
						[self.iX-iSize_, self.iY-iSize_],
						[self.iX+iSize_, self.iY+iSize_],
						null,
						[self.iX-iSize_, self.iY+iSize_],
						[self.iX+iSize_, self.iY-iSize_]
					];
					break;
				case 'arrow':
					iSize_ = 2*self.iSize;
					var iAngle = self.iAngle;
					self.iAngle = 0;
					var aP1 = ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_, iAngle-35);
					var aP2 = ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_, iAngle+35);
					self.aPoints = [
						[self.iX, self.iY],
						aP1,
						null,
						[self.iX, self.iY],
						aP2
					];
					break;
				case 'star3':
				case 'star4':
				case 'star5':
				case 'star6':
				case 'star7':
				case 'star8':
				case 'star9':
					self.aPoints = [];
					iSize_ = 2*self.iSize;
					iParts = ZC._i_(self.sShape.replace('star', ''));
					iAngleStep = 360/iParts;
					iAngleOffset = (iParts%2===0)?0:-90;
					iInnerSize = iSize_/((iParts>4)?2:(7-iParts));
					for (i=0+iAngleOffset;i<360+iAngleOffset;i+=iAngleStep) {
						self.aPoints.push(
							ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_*0.75, i),
							ZC.ZCMath._cpoint_(self.iX, self.iY, iInnerSize*0.75, i+iAngleStep/2)
						);
					}
					self.aPoints.push([self.aPoints[0][0], self.aPoints[0][1]]);
					break;
				case 'rpoly3':
				case 'rpoly4':
				case 'rpoly5':
				case 'rpoly6':
				case 'rpoly7':
				case 'rpoly8':
				case 'rpoly9':
					self.aPoints = [];
					iSize_ = self.iSize;
					iParts = ZC._i_(self.sShape.replace('rpoly', ''));
					iAngleStep = 360/iParts;
					iAngleOffset = (iParts%2===0)?0:-90;
					for (i=0+iAngleOffset;i<360+iAngleOffset;i+=iAngleStep) {
						self.aPoints.push(
							ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_, i)
						);
					}
					self.aPoints.push([self.aPoints[0][0], self.aPoints[0][1]]);
					break;
				case 'gear3':
				case 'gear4':
				case 'gear5':
				case 'gear6':
				case 'gear7':
				case 'gear8':
				case 'gear9':
					self.aPoints = [];
					iSize_ = 2*self.iSize;
					iParts = ZC._i_(self.sShape.replace('gear', ''));
					iAngleStep = 360/(2*iParts);
					iAngleOffset = (iParts%2===0)?0:-90;
					iInnerSize = iSize_*0.75;
					for (i=0+iAngleOffset;i<360+iAngleOffset;i+=2*iAngleStep) {
						var ii = i + iAngleStep/2;
						self.aPoints.push(
							ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_*0.75, ii),
							ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_*0.75, ii+iAngleStep),
							ZC.ZCMath._cpoint_(self.iX, self.iY, iInnerSize*0.75, ii+iAngleStep+iAngleStep*0),
							ZC.ZCMath._cpoint_(self.iX, self.iY, iInnerSize*0.75, ii+iAngleStep*2-iAngleStep*0)
						);
					}
					self.aPoints.push([self.aPoints[0][0], self.aPoints[0][1]]);
					break;
				case 'ellipse':
					self.bPixelCorrection = false;
					self.aPoints = [];
					for (i=0;i<=360;i+=5) {
						self.aPoints.push([self.iX + self.iSize*ZC._cos_(i), self.iY + self.iSize2*ZC._sin_(i)]);
					}
					self.aPoints.push([self.aPoints[0][0], self.aPoints[0][1]]);
					break;
				case 'arc':
					self.bPixelCorrection = false;
					self.aPoints = [
						ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize, self.iPieAngleStart),
						[self.iX, self.iY, self.iSize, self.iPieAngleStart, self.iPieAngleEnd, 0]
					];
					break;
				case 'pie':
					self.bPixelCorrection = false;
					var bSameAngle = false;
					if (ZC._indexof_(['svg', 'vml'], self.oLoader.sOutput) !== -1 && self.iPieAngleStart%360 === self.iPieAngleEnd%360) {
						self.iPieAngleEnd -= 0.05;
						bSameAngle = true;
					}
					self.aPoints = [];
					if (self.iPieSlice === 0) {
						if (self.iPieAngleStart%360 !== self.iPieAngleEnd%360 && !bSameAngle) {
							self.aPoints.push([self.iX, self.iY]);
						}
					} else {
						self.aPoints.push(ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice, self.iPieAngleStart));
					}
					self.aPoints.push(
						ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_, self.iPieAngleStart),
						[self.iX, self.iY, iSize_, ZC._x_(self.iPieAngleStart, 2), ZC._x_(self.iPieAngleEnd, 2), 0]
					);
					if (self.iPieSlice === 0) {
						if (self.iPieAngleStart%360 !== self.iPieAngleEnd%360 && !bSameAngle) {
							self.aPoints.push([self.iX, self.iY]);
						}
					} else {
						self.aPoints.push(
							ZC.ZCMath._cpoint_(self.iX, self.iY, iSize_, self.iPieAngleEnd),
							ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice, self.iPieAngleEnd),
							[self.iX, self.iY, self.iPieSlice, ZC._x_(self.iPieAngleEnd, 2), ZC._x_(self.iPieAngleStart, 2), 1]
						);
					}
					self.aPoints.push([self.aPoints[0][0], self.aPoints[0][1]]);
					break;
			}
		}
		self.locate(2);
	},
	paint : function() {
		var self = this;

		if (self.sShape === 'none') { return; }
		if (self.sShape !== 'custom' && self.sShape !== 'circle' && self.sShape !== 'arc' && self.aPoints.length === 0) {
			return;
		}

		var sOutput = self.oLoader.sOutput;
		if (self.bShadow && self.oCanvasSh) {
			self.paintShadow();
		}
		switch (sOutput) {
			case 'canvas':
				self.paintCANVAS();
				break;
			case 'svg':
				self.paintSVG();
				break;
			case 'vml':
				self.paintVML();
				break;
		}
		if (self.oData['top-state'] && !self.bIsShadow) {
			if (!self.bIsTop) {
				var oTop = new ZC.ZCShape(self.oParent);
				oTop.copy(self);
				oTop.bIsTop = true;
				oTop.bShadow = false;
				oTop.oCanvas = self.oCanvas;
				oTop.append(self.oData['top-state']);
				oTop.sId = self.sId + '-top';
				oTop.parse();
				oTop.iX = self.iX;
				oTop.iY = self.iY;
				oTop.paint();
			}
		}
	},
	paintShadow : function() {
		var self = this, aPointsSh;

		var oShadow = zingchart.pool.getInstance('ZCShape', self.oParent, self.sId + '-sh');
		oShadow.copy(self);
		oShadow.bCache = self.bCache;
		oShadow.oCanvas = self.oCanvasSh;
		oShadow.bShadow = false;
		oShadow.bIsShadow = true;
		oShadow.sBackgroundColor1 = oShadow.sBackgroundColor2 = oShadow.sShadowColor;
		oShadow.sBackgroundImage = '';
		oShadow.sLineStyle = 'solid';
		oShadow.sBorderColor = oShadow.sShadowColor;
		oShadow.iLineWidth = 0;
		oShadow.fAlpha = oShadow.fShadowAlpha*self.fAlpha;
		oShadow.sId = self.sId + '-sh';

		var iShadowX = (self.iShadowDistance-self.iShadowBlur)*ZC._cos_(self.iShadowAngle) + self.iShadowBlur;
		var iShadowY = (self.iShadowDistance-self.iShadowBlur)*ZC._sin_(self.iShadowAngle) + self.iShadowBlur;

		oShadow.iX = self.iX + parseInt(iShadowX, 10);
		oShadow.iY = self.iY + parseInt(iShadowY, 10);
		oShadow.iSize = self.iSize + self.iShadowBlur;
		if (self.aPoints.length > 0) {
			aPointsSh = [];
			for (var i=0,iLen=self.aPoints.length;i<iLen;i++) {
				if (self.aPoints[i] !== null) {
					var a = [];
					for (var j=0;j<self.aPoints[i].length;j++) {
						a[j] = self.aPoints[i][j];
					}
					a[0] = self.aPoints[i][0] + parseInt(iShadowX, 10);
					a[1] = self.aPoints[i][1] + parseInt(iShadowY, 10);
					aPointsSh.push(a);
				} else {
					aPointsSh.push(null);
				}
			}
		}
		oShadow.aBounds = [
			self.aBounds[0]+iShadowX,
			self.aBounds[1]+iShadowY,
			self.aBounds[2]+iShadowX,
			self.aBounds[3]+iShadowY
		];
		oShadow.aPoints = aPointsSh;
		oShadow.paint();
	},

	sharedCANVASSetupColors : function() {
		var self = this;
		var sLineColor = (self.sLineColor==='-1')?'rgba(255,255,255,0)':((self.fAlpha === 1)?self.sLineColor:ZC.ZCUtils._rgba_(ZC.ZCUtils._color_(self.sLineColor), self.fAlpha));
		var sBorderColor = (self.sBorderColor==='-1')?'rgba(255,255,255,0)':((self.fAlpha === 1)?self.sBorderColor:ZC.ZCUtils._rgba_(ZC.ZCUtils._color_(self.sBorderColor), self.fAlpha));
		var sBackgroundColor1 = (self.sBackgroundColor1==='-1')?'rgba(255,255,255,0)':((self.fAlpha === 1)?self.sBackgroundColor1:ZC.ZCUtils._rgba_(ZC.ZCUtils._color_(self.sBackgroundColor1), self.fAlpha));
		var sBackgroundColor2 = (self.sBackgroundColor2==='-1')?'rgba(255,255,255,0)':((self.fAlpha === 1)?self.sBackgroundColor2:ZC.ZCUtils._rgba_(ZC.ZCUtils._color_(self.sBackgroundColor2), self.fAlpha));
		return {lc : sLineColor, bc : sBorderColor, bgc1 : sBackgroundColor1, bgc2 : sBackgroundColor2};
	},

	sharedSetupGradients : function(sType) {
		var self = this, iCx, iCy, iRmed;
		switch (self.sShape) {
			case 'circle':
			case 'arc':
			case 'pie':
				iCx = self.iX;
				iCy = self.iY;
				iRmed = self.iSize;
				break;
			default:
				iCx = self.aBounds[0] + (self.aBounds[2]-self.aBounds[0])/2;
				iCy = self.aBounds[1] + (self.aBounds[3]-self.aBounds[1])/2;
				iRmed = ZC._a_(ZC._cos_(self.iFillAngle)*(self.aBounds[2]-self.aBounds[0])/2 + ZC._sin_(self.iFillAngle)*(self.aBounds[3]-self.aBounds[1])/2);
				break;
		}
		if (!ZC._isnumber_(iCx)) { iCx = 0; }
		if (!ZC._isnumber_(iCy)) { iCy = 0; }
		if (!ZC._isnumber_(iRmed)) { iRmed = 0; }
		var iFOX = self.iFillOffsetX, iFOY = self.iFillOffsetY;
		if (ZC._a_(iFOX) <= 1) {
			iFOX = iFOX*(self.aBounds[2]-self.aBounds[0])/2;
		}
		if (ZC._a_(iFOY) <= 1) {
			iFOY = iFOY*(self.aBounds[3]-self.aBounds[1])/2;
		}
		iCx += iFOX;
		iCy += iFOY;

		if (sType === 'radial') {
   			return { cx : iCx, cy : iCy, r : ZC._a_(iRmed) };
		} else if (sType === 'linear') {
			var fC_ = iRmed*ZC._cos_(self.iFillAngle), fS_ = iRmed*ZC._sin_(self.iFillAngle);
			var iX1 = iCx - fC_;
			var iY1 = iCy - fS_;
			var iX2 = iCx + fC_;
			var iY2 = iCy + fS_;
			if (ZC._i_(iY1) === ZC._i_(iY2)) {
				iY2 += 1;
			}
			if (ZC._i_(iX1) === ZC._i_(iX2)) {
				iX2 += 1;
			}
   			return { x1 : iX1, y1 : iY1, x2 : iX2, y2 : iY2 };
		}
	},

	sharedSetupBgImage : function() {
		var self = this, oImage;

		if (ZC.cache.data[self.sBackgroundImage] && self.fBackgroundScale === 1) {
			oImage = ZC.cache.data[self.sBackgroundImage];
		} else {
			
			oImage = new Image();
			oImage.src = self.sBackgroundImage;
			ZC.cache.data[self.sBackgroundImage] = oImage;
		}

		var iBgImageW = oImage.width * self.fBackgroundScale;
		var iBgImageH = oImage.height * self.fBackgroundScale;

		switch (self.sBackgroundFit) {
			case 'x':
				iBgImageW = self.iWidth;
				break;
			case 'y':
				iBgImageH = self.iHeight;
				break;
			case 'xy':
			case 'both':
				iBgImageW = self.iWidth;
				iBgImageH = self.iHeight;
				break;
		}

		var iX_, iY_, iCx_, iCy_;
		var aPosition = self.sBackgroundPosition.split(' ');
		var sHPos = aPosition[0] || '';
		switch (sHPos) {
			case '':
			case 'left':
				iX_ = 0;
				break;
			case 'center':
				iX_ = (self.iWidth - iBgImageW)/2;
				break;
			case 'right':
				iX_ = self.iWidth - iBgImageW;
				break;
			default:
				if (sHPos.indexOf('%') !== -1) {
					iX_ = (self.iWidth - iBgImageW)*ZC._i_(sHPos.replace(/[^0-9\-]/g, ''))/100;
				} else {
					iX_ = ZC._i_(sHPos.replace(/[^0-9\-]/g, ''));
				}
				break;
		}
		iCx_ = iX_/self.iWidth;
		if (typeof(self.bCallout) !== 'undefined') {
			iX_ += self.iX + self.iOffsetX;
		} else {
			iX_ += self.aBounds[0] + self.iOffsetX;
		}

		var sVPos = aPosition[1] || '';
		switch (sVPos) {
			case '':
			case 'top':
				iY_ = 0;
				break;
			case 'middle':
				iY_ = (self.iHeight - iBgImageH)/2;
				break;
			case 'bottom':
				iY_ = self.iHeight - iBgImageH;
				break;
			default:
				if (sVPos.indexOf('%') !== -1) {
					iY_ = (self.iHeight - iBgImageH)*ZC._i_(sVPos.replace(/[^0-9\-]/g, ''))/100;
				} else {
					iY_ = ZC._i_(sVPos.replace(/[^0-9\-]/g, ''));
				}
				break;
		}
		iCy_ = iY_/self.iHeight;
		if (typeof(self.bCallout) !== 'undefined') {
			iY_ += self.iY + self.iOffsetY;
		} else {
			iY_ += self.aBounds[1] + self.iOffsetY;
		}

		self.oAttributes['bg-image-width'] = iBgImageW;
		self.oAttributes['bg-image-height'] = iBgImageH;

		return {image:oImage, x:ZC._i_(iX_)+0.5, y:ZC._i_(iY_)+0.5, cx:ZC._f_(iCx_), cy:ZC._f_(iCy_)};
	},

	sharedCANVASSetupMGradients : function(oGradient) {
		var self = this;
		var aGColors = self.sGradientColors.split(/\s+|;|,/);
		var aGStops = self.sGradientStops.split(/\s+|;|,/);
		for (var i=0,iLen=aGColors.length;i<iLen;i++) {
			aGColors[i] = ZC.ZCUtils._color_(aGColors[i]);
			var sColor = (aGColors[i]==='-1')?'rgba(255,255,255,0)':((self.fAlpha === 1)?aGColors[i]:ZC.ZCUtils._rgba_(aGColors[i], self.fAlpha));
			var fStop = ZC._f_(aGStops[i]) || 1;
			if (!ZC._btw_(fStop, 0, 1)) {
				fStop = 1;
			}
			oGradient.addColorStop(fStop, sColor);
		}
	},

	paintCANVAS : function() {

		var self = this, mValue, iCx, iCy, oGradient, oImage, iDx, iDy, oPattern;

		var oCtx = self.oCanvas.getContext('2d');
		oCtx.save();

		if (self.sShape === 'poly' || self.sShape === 'line') {
			iCx = self.aBounds[0] + (self.aBounds[2]-self.aBounds[0])/2;
			iCy = self.aBounds[1] + (self.aBounds[3]-self.aBounds[1])/2;
		} else {
			iCx = self.iX;
			iCy = self.iY;
		}

		var oInfoColors = self.sharedCANVASSetupColors();
		var sLineColor = oInfoColors.lc;
		var sBorderColor = oInfoColors.bc;
		var sBackgroundColor1 = oInfoColors.bgc1;
		var sBackgroundColor2 = oInfoColors.bgc2;

		if (sBackgroundColor1 !== sBackgroundColor2 || (self.sGradientColors !== '' && self.sGradientStops !== '')) {
			var oInfoGradient = self.sharedSetupGradients(self.sFillType);
			if (self.sFillType === 'radial') {
	   			oGradient = oCtx.createRadialGradient(oInfoGradient.cx, oInfoGradient.cy, 1, oInfoGradient.cx, oInfoGradient.cy, oInfoGradient.r);
			} else if (self.sFillType === 'linear') {
				oGradient = oCtx.createLinearGradient(oInfoGradient.x1, oInfoGradient.y1, oInfoGradient.x2, oInfoGradient.y2);
			}
			if (self.sGradientColors !== '' && self.sGradientStops !== '') {
				self.sharedCANVASSetupMGradients(oGradient);
			} else {
				oGradient.addColorStop(0, sBackgroundColor1);
				oGradient.addColorStop(1, sBackgroundColor2);
			}
			oCtx.fillStyle = oGradient;
		} else {
			
			if (self.sBackgroundImage !== '' && ZC._indexof_(['repeat', 'true', true], self.sBackgroundRepeat) !== -1) {
				if (self.sBackgroundColor1 === '-1' && self.sBackgroundColor2 === '-1') {
					sBackgroundColor1 = 'rgba(255,255,255,0)';
				}
			}
   			oCtx.fillStyle = sBackgroundColor1;
		}

		switch (self.sShape) {
			case 'custom':
				if ((mValue=self.oData['url'])) {
					if (ZC.cache.data[mValue]) {
						oImage = ZC.cache.data[mValue];
					} else {
						
						oImage = new Image();
						oImage.src = mValue;
						ZC.cache.data[mValue] = oImage;
					}
					
					oImage.width = self.oData['width'] ? self.oData['width'] : oImage.width;
					oImage.height = self.oData['height'] ? self.oData['height'] : oImage.height;
					
					oCtx.drawImage(oImage, self.iX-oImage.width/2+self.iOffsetX, self.iY-oImage.height/2+self.iOffsetY, oImage.width, oImage.height);
					
					if (sBackgroundColor1.indexOf('#') === 0 && sBackgroundColor1.length === 7){
						var r = parseInt(sBackgroundColor1.substring(1,3),16);
						var g = parseInt(sBackgroundColor1.substring(3,5),16);
						var b = parseInt(sBackgroundColor1.substring(5,7),16);
						var imgData=oCtx.getImageData(self.iX-oImage.width/2+self.iOffsetX, self.iY-oImage.height/2+self.iOffsetY, oImage.width, oImage.height);
						for (var i=0;i<imgData.data.length;i+=4)
						{
							imgData.data[i]= r | imgData.data[i];
							imgData.data[i+1]= g | imgData.data[i+1];
							imgData.data[i+2]= b | imgData.data[i+2];
						}
						
						oCtx.putImageData(imgData,self.iX-oImage.width/2+self.iOffsetX, self.iY-oImage.height/2+self.iOffsetY);
				    }
				}
				break;
			case 'plus':
			case 'cross':
			case 'line':
			case 'arc':
				oCtx.strokeStyle = sLineColor;
				oCtx.lineWidth = self.iLineWidth;
				break;
			default:
				oCtx.strokeStyle = sBorderColor;
				oCtx.lineWidth = self.iBorderWidth;
				break;
		}

		if (self.iAngle !== 0) {
			oCtx.translate(iCx, iCy);
			if (!isNaN(self.iAngle)) {
				oCtx.rotate(ZC._rad_(self.iAngle));
			}
			oCtx.translate(-iCx, -iCy);
		}
		
		if (!isNaN(self.iOffsetX) && !isNaN(self.iOffsetY)) {
			if (self.iOffsetX !== 0 || self.iOffsetY !== 0) {
				oCtx.translate(self.iOffsetX, self.iOffsetY);
			}
		}

		oCtx.beginPath();
		var sLineStyle_ = self.sLineStyle;
		self.sLineStyle = '';
		self.setLineStyle();
		var bFilledPath = (ZC._indexof_(['cross', 'plus', 'arc', 'line'], self.sShape) === -1);
		switch (self.sShape) {
			case 'circle':
			case 'arc':
				
				oCtx.arc(self.iX, self.iY, self.iSize, ZC._rad_(self.iPieAngleStart), ZC._rad_(self.iPieAngleEnd), false);
				break;
			case 'line':
				break;
			default:
				if (ZC._indexof_(['square', 'plus'], self.sShape) !== -1) {
					self.bBoxCorrection = true;
				}
				ZC.ZCLine.contour(oCtx, self, self.aPoints);
				if (ZC._indexof_(['square', 'plus'], self.sShape) !== -1) {
					self.bBoxCorrection = false;
				}
				break;
		}
		self.sLineStyle = sLineStyle_;
		self.setLineStyle();

		oCtx.globalCompositeOperation = self.sComposite;

		if (bFilledPath) {
			if (self.sBackgroundImage !== '' && ZC._indexof_(ZC.IMG404, self.sBackgroundImage) === -1) {
				oCtx.fill();
				oCtx.save();
				oCtx.clip();

				var fGlobalAlpha_ = oCtx.globalAlpha;
				oCtx.globalAlpha = self.fAlpha;

				var oInfoBgImage = self.sharedSetupBgImage();
				oImage = oInfoBgImage.image;

				switch (self.sBackgroundRepeat) {
					case 'repeat':
					case true:
					case 'true':
						iDx = self.aBounds[0] - (oImage.width - (self.aBounds[2] - self.aBounds[0]))/2;
						iDy = self.aBounds[1] - (oImage.height - (self.aBounds[3] - self.aBounds[1]))/2;
						oCtx.translate(iDx, iDy);
						oPattern = oCtx.createPattern(oImage, 'repeat');
						oCtx.fillStyle = oPattern;
						oCtx.fill();
						oCtx.translate(-iDx, -iDy);
						
						
						break;
					case 'no-repeat':
					case false:
					case 'false':
						oCtx.drawImage(oImage, oInfoBgImage.x - self.iOffsetX, oInfoBgImage.y - self.iOffsetY, self.oAttributes['bg-image-width'], self.oAttributes['bg-image-height']);
						break;
				}
				oCtx.globalAlpha = fGlobalAlpha_;
				oCtx.restore();
			} else {
				oCtx.fill();
			}
		}
		oCtx.closePath();

		oCtx.beginPath();
		switch (self.sShape) {
			case 'circle':
			case 'arc':
				oCtx.arc(self.iX, self.iY, self.iSize, ZC._rad_(self.iPieAngleStart), ZC._rad_(self.iPieAngleEnd), false);
				if (
					(self.sShape === 'circle' && self.iBorderWidth > 0)
					||
					(self.sShape === 'arc' && self.iLineWidth > 0)
				) {
					oCtx.stroke();
				}
				oCtx.closePath();
				break;
			case 'plus':
			case 'cross':
			case 'line':
				if (self.iLineWidth > 0) {
					ZC.ZCLine.setup(oCtx, self);
					ZC.ZCLine.paint(oCtx, self, self.aPoints);
				}
				break;
			default:
				if (self.iBorderWidth > 0) {
					var sLineColor_ = self.sLineColor;
					var iLineWidth_ = self.iLineWidth;
					self.sLineColor = self.sBorderColor;
					self.iLineWidth = self.iBorderWidth;
					self.setLineStyle();
					ZC.ZCLine.setup(oCtx, self);
					ZC.ZCLine.paint(oCtx, self, self.aPoints, true);
					self.sLineColor = sLineColor_;
					self.iLineWidth = iLineWidth_;
					self.setLineStyle();
				}
				oCtx.closePath();
				break;
		}
		oCtx.restore();
	},

	sharedSVGSetupPattern : function(oParams) {
		var self = this;
		var oInfoBgImage = oParams.info;
		var oImage = oInfoBgImage.image;
		var bRepeat = true;
		switch (self.sBackgroundRepeat) {
			default:
				bRepeat = true;
				break;
			case 'no-repeat':
			case 'false':
			case false:
				bRepeat = false;
				break;
		}

		oImage.width *= self.fBackgroundScale;
		oImage.height *= self.fBackgroundScale;

		var sPatternId = (self.sId==='')?('pattern-'+(ZC.SEQ++)):(self.sId+'-pattern');
		ZC.ZCHtmlUtils._remove_(sPatternId);

		var oSvgImage = ZC.ZCHtmlUtils._element_('image', 'http://www.w3.org/2000/svg');
		if (oSvgImage.setAttributeNS) {
			oSvgImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', self.sBackgroundImage);
		} else {
			oSvgImage.setAttribute('src', self.sBackgroundImage);
		}
		ZC.ZCHtmlUtils._attr_(oSvgImage, {
			width : oImage.width,
			height : oImage.height
		});
		if (!bRepeat) {
			var _iWidth_, _iHeight_;
			
			if (self.iWidth > 0 && self.iHeight > 0) {
				_iWidth_ = self.iWidth;
				_iHeight_ = self.iHeight;				
			} else {
				_iWidth_ = self.aBounds[2]-self.aBounds[0];
				_iHeight_ = self.aBounds[3]-self.aBounds[1];				
			}
			var iTx = ZC._i_(_iWidth_ * oInfoBgImage.cx);
			var iTy = ZC._i_(_iHeight_ * oInfoBgImage.cy);
			ZC.ZCHtmlUtils._attr_(oSvgImage, {
				transform : 'translate(' + iTx + ',' + iTy + ')'
			});
		}

		var oPattern = ZC.ZCHtmlUtils._element_('pattern', 'http://www.w3.org/2000/svg');
		ZC.ZCHtmlUtils._attr_(oPattern, {
			x : bRepeat?oParams.x:0,
			y : bRepeat?oParams.y:0,
			width : bRepeat?oImage.width:1,
			height : bRepeat?oImage.height:1,
			id : sPatternId,
			patternUnits : bRepeat?'userSpaceOnUse':'objectBoundingBox'
		});
		self.oLoader.oSvg.childNodes[0].appendChild(oPattern);

		oPattern.appendChild(oSvgImage);

		self.oAttributes['imgfill'] = 'url(#' + sPatternId + ')';
	},

	sharedSVGSetupGradient : function(bUpdate) {
		if (bUpdate === null || typeof(bUpdate) === 'undefined') { bUpdate = false; }
		var self = this, oGradient, sColor;
		if (self.sBackgroundColor1 !== self.sBackgroundColor2 || (self.sGradientColors !== '' && self.sGradientStops !== '')) {
			var sGradientId = (self.sId==='')?('gradient-'+(ZC.SEQ++)):(self.sId+'-gradient');

			if (bUpdate && !ZC._id_(sGradientId)) {
				bUpdate = false;
			}

			
			if (ZC.ZCQuery.browser.msie && ZC._i_(ZC.ZCQuery.browser.version) === 9) {
				bUpdate = false;
			}

			if (ZC._id_(sGradientId) && !bUpdate) {
				ZC.ZCHtmlUtils._remove_(sGradientId);
			}

			var oInfoGradient = self.sharedSetupGradients(self.sFillType);

			if (self.sFillType === 'radial') {
				oGradient = bUpdate?ZC._id_(sGradientId):ZC.ZCHtmlUtils._element_('radialGradient', 'http://www.w3.org/2000/svg');
				ZC.ZCHtmlUtils._attr_(oGradient, {
					cx : ZC._i_(oInfoGradient.cx),
					cy : ZC._i_(oInfoGradient.cy),
					r : ZC._i_(oInfoGradient.r),
					fx : ZC._i_(oInfoGradient.cx),
					fy : ZC._i_(oInfoGradient.cy)
				});
			} else if (self.sFillType === 'linear') {
				oGradient = bUpdate?ZC._id_(sGradientId):ZC.ZCHtmlUtils._element_('linearGradient', 'http://www.w3.org/2000/svg');
				ZC.ZCHtmlUtils._attr_(oGradient, {
					x1 : ZC._i_(oInfoGradient.x1),
					x2 : ZC._i_(oInfoGradient.x2),
					y1 : ZC._i_(oInfoGradient.y1),
					y2 : ZC._i_(oInfoGradient.y2)
				});
			}
			if (!bUpdate) {
				ZC.ZCHtmlUtils._attr_(oGradient, {
					id : sGradientId,
					gradientUnits : 'userSpaceOnUse'
				});
				self.oLoader.oSvg.childNodes[0].appendChild(oGradient);

				if (self.sGradientColors !== '' && self.sGradientStops !== '') {

					var aGColors = self.sGradientColors.split(/\s+|;|,/);
					var aGStops = self.sGradientStops.split(/\s+|;|,/);
					for (var i=0,iLen=aGColors.length;i<iLen;i++) {
						aGColors[i] = ZC.ZCUtils._color_(aGColors[i]);
						sColor = (aGColors[i]==='-1')?'rgba(255,255,255,0)':((self.fAlpha === 1)?aGColors[i]:ZC.ZCUtils._rgba_(aGColors[i], self.fAlpha));
						var fStop = aGStops[i] || 1;
						if (!ZC._btw_(fStop, 0, 1)) {
							fStop = 1;
						}
						var iOpacity = 1;
						sColor = aGColors[i];
						if (aGColors[i] === '-1') {
							iOpacity = 0;
							sColor = 'rgb(255,255,255)';
						}
						var oStop = ZC.ZCHtmlUtils._element_('stop', 'http://www.w3.org/2000/svg');
						ZC.ZCHtmlUtils._attr_(oStop, {
							offset : fStop,
							'stop-color' : sColor,
							'stop-opacity' : iOpacity
						});

						oGradient.appendChild(oStop);
					}

				} else {

					var iOpacity1 = 1;
					var sBackgroundColor1 = self.sBackgroundColor1;
					if (self.sBackgroundColor1 === '-1') {
						iOpacity1 = 0;
						sBackgroundColor1 = 'rgb(255,255,255)';
					}
					var oStop1 = ZC.ZCHtmlUtils._element_('stop', 'http://www.w3.org/2000/svg');
					ZC.ZCHtmlUtils._attr_(oStop1, {
						offset : 0,
						'stop-color' : sBackgroundColor1,
						'stop-opacity' : iOpacity1
					});

					var iOpacity2 = 1;
					var sBackgroundColor2 = self.sBackgroundColor2;
					if (self.sBackgroundColor2 === '-1') {
						iOpacity2 = 0;
						sBackgroundColor2 = 'rgb(255,255,255)';
					}
					var oStop2 = ZC.ZCHtmlUtils._element_('stop', 'http://www.w3.org/2000/svg');
					ZC.ZCHtmlUtils._attr_(oStop2, {
						offset : 1,
						'stop-color' : sBackgroundColor2,
						'stop-opacity' : iOpacity2
					});

					oGradient.appendChild(oStop1);
					oGradient.appendChild(oStop2);
				}
				self.oAttributes['fill'] = 'url(#' + sGradientId + ')';
			}
		} else {
			if (self.sBackgroundColor1 !== '-1') {
				self.oAttributes['fill'] = self.sBackgroundColor1;
			}
		}
	},

	sharedSetupClipPath : function() {
		var self = this;
		if (typeof(self.oAttributes['imgfill']) === 'object' && typeof(self.oLoader) !== 'undefined' && self.oLoader) {
			var aAreaInfo = self.getAreaInfo();
			var aPoints = aAreaInfo[1].split(',');
			if (self.sShape === 'circle') {
				self.oLoader.oSvg.appendChild(
					ZC.ZCHtmlUtils._svg_clip_({
						id : self.sId + '_image-clip',
						cx : aPoints[0],
						cy : aPoints[1], 
						r : aPoints[2]
					})
				);
				self.oAttributes['clip-path'] = self.sId + '_image-clip';
			} else if (aPoints.length > 6) {
				var sPath = '';
				for (var i=0,iLen=aPoints.length;i<iLen;i+=2) {
					sPath += (ZC._i_(aPoints[i]) + ZC._i_(self.iOffsetX)) + ',' + (ZC._i_(aPoints[i+1]) + ZC._i_(self.iOffsetY)) + ' ';
				}
				self.oLoader.oSvg.appendChild(
					ZC.ZCHtmlUtils._svg_clip_({
						id : self.sId + '_image-clip',
						path : sPath
					})
				);
				self.oAttributes['clip-path'] = self.sId + '_image-clip';
			}
		}
	},

	paintSVG : function() {
		var self = this, mValue, iCx, iCy, oImage, oCircle, oSvgImage;
		var oCtx = self.oCanvas;

		if (self.sShape === 'poly' || self.sShape === 'line') {
			iCx = self.aBounds[0] + (self.aBounds[2]-self.aBounds[0])/2;
			iCy = self.aBounds[1] + (self.aBounds[3]-self.aBounds[1])/2;
		} else {
			iCx = self.iX;
			iCy = self.iY;
		}

		self.oAttributes['cx'] = iCx;
		self.oAttributes['cy'] = iCy;

		self.oAttributes['fill'] = -1;

		if (self.sBackgroundImage !== '') {

			var oInfoBgImage = self.sharedSetupBgImage();

			self.sharedSVGSetupPattern({
				info : oInfoBgImage,
				x : iCx - oInfoBgImage.image.width/2,
				y : iCy - oInfoBgImage.image.height/2
			});

		}

		if (self.bBackgroundClip) {
			self.sharedSetupClipPath();
		}

		self.sharedSVGSetupGradient();

		switch (self.sShape) {
			case 'custom':
				if ((mValue=self.oData['url'])) {
					var bSvgUse = false;
					
					if (ZC.cache.data[mValue]) {
						oImage = ZC.cache.data[mValue];
					} else {
						oImage = new Image();
						oImage.src = mValue;
						ZC.cache.data[mValue] = oImage;
					}

					bSvgUse = (mValue.indexOf('.svg') > 0 && mValue.indexOf('#') >= 0);
					
					if (bSvgUse){
						oSvgImageTop = ZC.ZCHtmlUtils._element_('svg', 'http://www.w3.org/2000/svg');
						ZC.ZCHtmlUtils._attr_(oSvgImageTop, {
								viewBox: '0 0 8 8',
								fill: self.oAttributes['fill']
						});
						oSvgImage = ZC.ZCHtmlUtils._element_('use', 'http://www.w3.org/2000/svg');
					}
					else{
						oSvgImage = ZC.ZCHtmlUtils._element_('image', 'http://www.w3.org/2000/svg');
					}
					
					if (oSvgImage.setAttributeNS) {
						oSvgImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', mValue);
					} else {
						oSvgImage.setAttribute('src', mValue);
					}
					
					var iWidth = self.oData['width'] ? self.oData['width'] : oImage.width;
					var iHeight = self.oData['height'] ? self.oData['height'] : oImage.height;
					
					oImage.width = iWidth;
					oImage.height = iHeight;
					
					if (!bSvgUse){
						ZC.ZCHtmlUtils._attr_(oSvgImage, {
							id : self.sId + '-image',
							x : self.iX-oImage.width/2+self.iOffsetX,
							y : self.iY-oImage.height/2+self.iOffsetY,
							width : oImage.width,
							height : oImage.height
						});
					}
					else{
						ZC.ZCHtmlUtils._attr_(oSvgImageTop, {
							id : self.sId + '-image',
							x : self.iX-oImage.width/2+self.iOffsetX,
							y : self.iY-oImage.height/2+self.iOffsetY,
							width : oImage.width,
							height : oImage.height
						});
					}
					
					if (bSvgUse){
						oSvgImageTop.appendChild(oSvgImage);
						oCtx.appendChild(oSvgImageTop);
					}
					else{
						oCtx.appendChild(oSvgImage);
				    }
				}
				break;
			case 'circle':
				if (!ZC._id_(self.sId + '-circle')) {
					oCircle = ZC.ZCHtmlUtils._element_('circle', 'http://www.w3.org/2000/svg');
					if (self.oAttributes['fill'] !== -1) {
						ZC.ZCHtmlUtils._attr_(oCircle, {
							fill : self.oAttributes['fill'],
							'fill-opacity' : self.fAlpha
						});
					} else {
						ZC.ZCHtmlUtils._attr_(oCircle, {
							fill : 'none'
						});
					}
					ZC.ZCHtmlUtils._attr_(oCircle, {
						id : self.sId + '-circle',
						cx : self.iX + self.iOffsetX,
						cy : self.iY + self.iOffsetY,
						r : self.iSize
					});
					if (self.iBorderWidth > 0) {
						ZC.ZCHtmlUtils._attr_(oCircle, {
							stroke : self.sBorderColor,
							'stroke-width' : self.iBorderWidth,
							'stroke-opacity' : self.fAlpha
						});
					}

					if (self.oLoader && self.oLoader.oDOMFragments) {
						if (!self.oLoader.oDOMFragments[oCtx.id]) {
							self.oLoader.oDOMFragments[oCtx.id] = document.createDocumentFragment();
						}
						self.oLoader.oDOMFragments[oCtx.id].appendChild(oCircle);
					} else {
						oCtx.appendChild(oCircle);
					}

					if (typeof(self.oAttributes['imgfill']) !== 'undefined') {
						if (typeof(self.oAttributes['imgfill']) === 'string') {
							oCircle = ZC.ZCHtmlUtils._element_('circle', 'http://www.w3.org/2000/svg');
							ZC.ZCHtmlUtils._attr_(oCircle, {
								id : self.sId + '-imgfill',
								fill : self.oAttributes['imgfill'],
								'fill-opacity' : self.fAlpha,
								cx : self.iX + self.iOffsetX,
								cy : self.iY + self.iOffsetY,
								r : self.iSize,
								'stroke-width' : 0
							});
							if (self.oLoader && self.oLoader.oDOMFragments) {
								self.oLoader.oDOMFragments[oCtx.id].appendChild(oCircle);
							} else {
								oCtx.appendChild(oCircle);
							}
						} else {
							var aFillInfo = self.oAttributes['imgfill'];
							oSvgImage = ZC.ZCHtmlUtils._element_('image', 'http://www.w3.org/2000/svg');
							if (oSvgImage.setAttributeNS) {
								oSvgImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', self.sBackgroundImage);
							}
							
							if (self.oAttributes['clip-path']) {
								ZC.ZCHtmlUtils._attr_(oSvgImage, {
									'clip-path' : 'url(#' + self.oAttributes['clip-path'] + (ZC.ZCQuery.browser.webkit?'-shape':'') + ')'
								});
							}
							ZC.ZCHtmlUtils._attr_(oSvgImage, {
								id : self.sId + '-imgfill',
								x : aFillInfo[1],
								y : aFillInfo[2],
								width : aFillInfo[0].width,
								height : aFillInfo[0].height
							});
							oCtx.appendChild(oSvgImage);
						}
					}
				}
				break;
			case 'plus':
			case 'cross':
			case 'line':
			case 'arc':
				if (self.iLineWidth > 0) {
					ZC.ZCLine.setup(oCtx, self);
					ZC.ZCLine.paint(oCtx, self, self.aPoints);
				}
				break;
			default:
				var sLineColor_ = self.sLineColor;
				var iLineWidth_ = self.iLineWidth;
				self.sLineColor = self.sBorderColor;
				self.iLineWidth = self.iBorderWidth;
				self.setLineStyle();
				ZC.ZCLine.setup(oCtx, self);
				ZC.ZCLine.paint(oCtx, self, self.aPoints, true, 0);
				self.sLineColor = sLineColor_;
				self.iLineWidth = iLineWidth_;
				self.setLineStyle();
				break;
		}
	},

	sharedVMLSetupGradient : function(sFocus, bUpdate) {
		if (bUpdate === null || typeof(bUpdate) === 'undefined') { bUpdate = false; }
		var self = this, oFill;

		if (self.sBackgroundColor1 !== self.sBackgroundColor2 || (self.sGradientColors !== '' && self.sGradientStops !== '')) {
			var sGradientId = (self.sId==='')?('gradient-'+(ZC.SEQ++)):(self.sId+'-gradient');

			if (bUpdate && !ZC._id_(sGradientId)) {
				bUpdate = false;
			}
			if (ZC._id_(sGradientId) && !bUpdate) {
				ZC.ZCQuery(sGradientId).remove();
			}

			oFill = bUpdate?ZC._id_(sGradientId):ZC.ZCHtmlUtils._element_('zcv:fill');
			if (bUpdate) {
				sFocus = ZC.ZCQuery('#' + sGradientId).attr('focusposition');
			}

			if (self.sGradientColors !== '' && self.sGradientStops !== '') {
				var aGColors = self.sGradientColors.split(/\s+|;|,/);
				var aGStops = self.sGradientStops.split(/\s+|;|,/);
				var sColor1 = '', sColor2 = '', sColors = '';
				for (var i=0,iLen=aGColors.length;i<iLen;i++) {
					aGColors[i] = ZC.ZCUtils._color_(aGColors[i]);
					var sColor = (aGColors[i]==='-1')?'rgb(255,255,255)':aGColors[i];
					var fStop = aGStops[i] || 1;
					if (!ZC._btw_(fStop, 0, 1)) {
						fStop = 1;
					}
					var iStop = ZC._i_(fStop*100);
					if (i === 0) {
						sColor1 = sColor;
					} else if (i === iLen-1) {
						sColor2 = sColor;
					} else {
						sColors += iStop + '% ' + ZC.ZCUtils._color_(sColor) + ',';
					}
				}
				if (sColors !== '') {
					sColors = sColors.substring(0, sColors.length-1);
				}
				if (self.sFillType === 'radial') {
					ZC.ZCHtmlUtils._attr_(oFill, {
						id : sGradientId,
						type : 'gradientradial',
						focusposition : sFocus,
						color : sColor1,
						color2 : sColor2,
						colors : sColors
					});
				} else if (self.sFillType === 'linear') {
					ZC.ZCHtmlUtils._attr_(oFill, {
						id : sGradientId,
						type : 'gradient',
						method : 'sigma',
						angle : 270-self.iFillAngle-self.iAngle,
						color : sColor1,
						color2 : sColor2,
						colors : sColors
					});
				}
			} else {
				var sBackgroundColor1 = self.sBackgroundColor1;
				if (self.sBackgroundColor1 === '-1') {
					sBackgroundColor1 = 'rgb(255,255,255)';
				}
				var sBackgroundColor2 = self.sBackgroundColor2;
				if (self.sBackgroundColor2 === '-1') {
					sBackgroundColor2 = 'rgb(255,255,255)';
				}

				if (self.sFillType === 'radial') {
					ZC.ZCHtmlUtils._attr_(oFill, {
						id : sGradientId,
						type : 'gradientradial',
						focusposition : sFocus,
						color : sBackgroundColor2,
						color2 : sBackgroundColor1
					});
				} else if (self.sFillType === 'linear') {
					ZC.ZCHtmlUtils._attr_(oFill, {
						id : sGradientId,
						type : 'gradient',
						method : 'sigma',
						angle : 270-self.iFillAngle-self.iAngle,
						color : sBackgroundColor1,
						color2 : sBackgroundColor2
					});
				}
			}
			var fOpacity2 = (typeof(self.oAttributes['opacity2']) !== 'undefined')?self.oAttributes['opacity2']:self.fAlpha;
			ZC.ZCHtmlUtils._attr_(oFill, {
				opacity : self.fAlpha,
				'o:opacity2' : fOpacity2
			});
			self.oAttributes['fill'] = oFill;
		} else {
			oFill = ZC.ZCHtmlUtils._element_('zcv:fill');
			if (self.sBackgroundColor1 !== '-1') {
				ZC.ZCHtmlUtils._attr_(oFill, {
					type : 'solid',
					color : self.sBackgroundColor1,
					opacity : self.fAlpha
				});
				self.oAttributes['fill'] = oFill;
			}
		}
	},

	paintVML : function() {
		var self = this, mValue, iCx, iCy, oImage, oCircle, oVmlImage;
		var oCtx = self.oCanvas;

		if (self.sShape === 'poly' || self.sShape === 'line') {
			iCx = self.aBounds[0] + (self.aBounds[2]-self.aBounds[0])/2;
			iCy = self.aBounds[1] + (self.aBounds[3]-self.aBounds[1])/2;
		} else {
			iCx = self.iX;
			iCy = self.iY;
		}
		
		self.oAttributes['cx'] = iCx;
		self.oAttributes['cy'] = iCy;

		self.oAttributes['fill'] = -1;

		var bFilledPath = (ZC._indexof_(['cross', 'plus', 'arc', 'line'], self.sShape) === -1);

		var oImgFill = ZC.ZCHtmlUtils._element_('zcv:fill');
		if (self.sBackgroundImage !== '') {
			var oInfoBgImage = self.sharedSetupBgImage();
			oImage = oInfoBgImage.image;

			switch (self.sBackgroundRepeat) {
				default:
					oImgFill.type = 'tile';
					oImgFill.src = self.sBackgroundImage;
					ZC.ZCHtmlUtils._attr_(oImgFill, {
						position : (oInfoBgImage.cx + ',' + oInfoBgImage.cy),
						opacity : self.fAlpha,
						'o:opacity2' : self.fAlpha
					});
					self.oAttributes['imgfill'] = [oImgFill];
					break;
				case 'no-repeat':
				case 'false':
				case false:
					self.oAttributes['imgfill'] = [oImage, oInfoBgImage.x, oInfoBgImage.y];
					break;
			}
		}

		self.sharedVMLSetupGradient('0,0');

		var oStroke = ZC.ZCHtmlUtils._element_('zcv:stroke');
		switch (self.sShape) {
			case 'custom':
				if ((mValue=self.oData['url'])) {
					if (ZC.cache.data[mValue]) {
						oImage = ZC.cache.data[mValue];
					} else {
						oImage = new Image();
						oImage.src = mValue;
						ZC.cache.data[mValue] = oImage;
					}
					oVmlImage = ZC.ZCHtmlUtils._element_('img');
					oVmlImage.id = self.sId + '-img';
					oVmlImage.src = mValue;
					oVmlImage.style.position = 'absolute';
					if (self.fBackgroundScale !== 1) {
						oVmlImage.width *= self.fBackgroundScale;
						oVmlImage.height *= self.fBackgroundScale;
						oVmlImage.style.width = oVmlImage.width + 'px';
						oVmlImage.style.height = oVmlImage.height + 'px';
					}
					oVmlImage.style.left = (self.iX-oImage.width/2+self.iOffsetX) + 'px';
					oVmlImage.style.top = (self.iY-oImage.height/2+self.iOffsetY) + 'px';
					oCtx.appendChild(oVmlImage);
				}
				break;
			case 'plus':
			case 'cross':
			case 'line':
			case 'arc':
				oStroke.weight = self.iLineWidth + 'px';
				oStroke.color = self.sLineColor;
				break;
			default:
				oStroke.weight = self.iBorderWidth + 'px';
				oStroke.color = self.sBorderColor;
			break;
		}
		oStroke.opacity = self.fAlpha;

		switch (self.sLineStyle) {
			case 'solid':
				oStroke.dashstyle = 'solid';
				break;
			case 'dotted':
				oStroke.dashstyle = 'dot';
				break;
			case 'dashed':
				oStroke.dashstyle = 'dash';
				break;
		}
		if (ZC._indexof_(['plus','cross','line'], self.sShape) === -1) {
			self.oAttributes['stroke'] = oStroke;
		}

		switch (self.sShape) {
			case 'circle':
			case 'arc':
				if (!ZC._id_(self.sId + '-circle')) {
					oCircle = ZC.ZCHtmlUtils._element_((self.sShape==='circle')?'zcv:oval':'zcv:arc');
					oCircle.id = self.sId + '-circle';
					oCircle.style.position = 'absolute';
					if (self.oAttributes['fill'] !== -1 && bFilledPath) {
						oCircle.appendChild(self.oAttributes['fill']);
					} else {
						oCircle.filled = false;
					}
					if (self.iBorderWidth > 0) {
						oCircle.appendChild(oStroke);
					} else {
						oCircle.stroked = false;
					}
					oCircle.style.left = (self.iX + self.iOffsetX - self.iSize) + 'px';
					oCircle.style.top = (self.iY + self.iOffsetY - self.iSize) + 'px';
					oCircle.style.width = 2*self.iSize + 'px';
					oCircle.style.height = 2*self.iSize + 'px';
					if (self.sShape === 'arc') {
						ZC.ZCHtmlUtils._attr_(oCircle, {
							startangle : self.iPieAngleEnd+90,
							endangle : self.iPieAngleStart+90
						});
					}
					oCtx.appendChild(oCircle);

					if (bFilledPath) {
						if (typeof(self.oAttributes['imgfill']) !== 'undefined') {
							var aFillInfo = self.oAttributes['imgfill'];

							if (aFillInfo.length === 1) {
								oCircle = ZC.ZCHtmlUtils._element_('zcv:oval');
								oCircle.id = self.sId + '-imgfill';
								oCircle.style.position = 'absolute';
								oCtx.appendChild(oCircle);
								oCircle.appendChild(aFillInfo[0]);
								oCircle.style.left = (self.iX + self.iOffsetX - self.iSize) + 'px';
								oCircle.style.top = (self.iY + self.iOffsetY - self.iSize) + 'px';
								oCircle.style.width = 2*self.iSize + 'px';
								oCircle.style.height = 2*self.iSize + 'px';
								oCircle.stroked = false;
								
								if (self.sShape === 'arc') {
									ZC.ZCHtmlUtils._attr_(oCircle, {
										startangle : self.iPieAngleEnd+90,
										endangle : self.iPieAngleStart+90
									});
								}
							} else if (aFillInfo.length === 3) {
								oVmlImage = ZC.ZCHtmlUtils._element_('img');
								oVmlImage.id = self.sId + '-img';
								oVmlImage.src = self.sBackgroundImage;
								oVmlImage.style.position = 'absolute';
								oVmlImage.style.left = aFillInfo[1] + 'px';
								oVmlImage.style.top = aFillInfo[2] + 'px';
								if (self.fBackgroundScale !== 1) {
									oVmlImage.width *= self.fBackgroundScale;
									oVmlImage.height *= self.fBackgroundScale;
									oVmlImage.style.width = oVmlImage.width + 'px';
									oVmlImage.style.height = oVmlImage.height + 'px';
								}
								oCtx.appendChild(oVmlImage);
							}
						}
					}
				}
				break;
			case 'plus':
			case 'cross':
			case 'line':
				if (self.iLineWidth > 0) {
					ZC.ZCLine.setup(oCtx, self);
					ZC.ZCLine.paint(oCtx, self, self.aPoints);
				}
				break;
			default:
				var sLineColor_ = self.sLineColor;
				var iLineWidth_ = self.iLineWidth;
				self.sLineColor = self.sBorderColor;
				self.iLineWidth = self.iBorderWidth;
				self.setLineStyle();
				ZC.ZCLine.setup(oCtx, self);
				ZC.ZCLine.paint(oCtx, self, self.aPoints, true, 0);
				self.sLineColor = sLineColor_;
				self.iLineWidth = iLineWidth_;
				self.setLineStyle();
				break;
		}
	}
});










ZC.ZCBox = ZC.ZCShape.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sShape = 'box';
		self.iWidth = 0;
		self.iHeight = 0;
		self.sPosition = '';
		self.iMarginTop = -1;
		self.iMarginRight = -1;
		self.iMarginBottom = -1;
		self.iMarginLeft = -1;
		self.iBorderRadiusTopLeft = 0;
		self.iBorderRadiusTopRight = 0;
		self.iBorderRadiusBottomRight = 0;
		self.iBorderRadiusBottomLeft = 0;
		self.bCenterRef = false;
		self.bCallout = false;
		self.sCalloutPosition = 'bottom';
		self.iCalloutOffset = 0;
		self.iCalloutExtension = 0;
		self.iCalloutWidth = 8;
		self.iCalloutHeight = 8;
		self.aCalloutRatio = [1, 1];
		self.aCalloutHook = null;
		self.oCalloutTip = null;
		self.bIgnoreLocate = false;
		self.bBoxCorrection = true;
		self.sBorderTop = '';
		self.sBorderRight = '';
		self.sBorderBottom = '';
		self.sBorderLeft = '';
		self.sAnchor = 'tl';
		self.bRectShortcut = true;
	},
	getPMap : function() {
		var oMap = this._super();
		this.addPMap(oMap, 'width,height,borderRadiusTopLeft,borderRadiusTopRight,borderRadiusBottomRight,borderRadiusBottomLeft,callout,calloutType,calloutPosition,calloutHook,calloutWidth,calloutHeight,calloutOffset,calloutExtension,position,borderTop,borderRight,borderBottom,borderLeft,rectShortcut', 'iWidth,iHeight,iBorderRadiusTopLeft,iBorderRadiusTopRight,iBorderRadiusBottomRight,iBorderRadiusBottomLeft,bCallout,sCalloutPosition,aCalloutHook,iCalloutWidth,iCalloutHeight,iCalloutOffset,iCalloutExtension,sPosition,sBorderTop,sBorderRight,sBorderBottom,sBorderLeft,bRectShortcut');
		return oMap;
	},
	build : function() {
	},
	wh_ : function(wh, mWhat, bPC) {
		var self = this;
		mWhat = mWhat || 'w';
		if ((ZC._f_(wh) + '') === (wh + '')) {
			var iPWidth = (typeof(self.oAttributes['p-width'])!=='undefined')?self.oAttributes['p-width']:self.oParent.iWidth;
			var iPHeight = (typeof(self.oAttributes['p-height'])!=='undefined')?self.oAttributes['p-height']:self.oParent.iHeight;
			wh = ZC._a_(wh);
			if (wh > 1 && !bPC) {
				return ZC._i_(wh);
			} else if (wh <= 1 || bPC) {
				if (mWhat === 'w') {
					return ZC._i_((iPWidth)*wh);
				} else {
					return ZC._i_((iPHeight)*wh);
				}
			}
		} else {
			wh = wh + '';
			if (wh.indexOf('%') !== -1) {
				return self.wh_(ZC._f_(wh.replace('%', ''))/100, mWhat, true);
			} else if (wh.indexOf('px') !== -1) {
				return self.wh_(ZC._f_(wh.replace('px', '')), mWhat);
			} else {
				return self.wh_(ZC._f_(wh), mWhat);
			}
		}
	},
	m_ : function(m, mWhat, pw, ph, dyn) {
		var self = this, iPWidth, iPHeight;
		pw = pw || 0;
		ph = ph || 0;
		mWhat = mWhat || 'all';
		dyn = dyn || 'n';
		if (mWhat === 'all') {
			var aSides = String(m).split(/\s+|;|,/);
			if (aSides.length === 1) {
				return [self.m_(aSides[0], 'tb', pw, ph, dyn), self.m_(aSides[0], 'lr', pw, ph, dyn), self.m_(aSides[0], 'tb', pw, ph, dyn), self.m_(aSides[0], 'lr', pw, ph, dyn)];
			} else if (aSides.length === 2) {
				return [self.m_(aSides[0], 'tb', pw, ph, dyn), self.m_(aSides[1], 'lr', pw, ph, dyn), self.m_(aSides[0], 'tb', pw, ph, dyn), self.m_(aSides[1], 'lr', pw, ph, dyn)];
			} else if (aSides.length === 3) {
				return [self.m_(aSides[0], 'tb', pw, ph, dyn), self.m_(aSides[1], 'lr', pw, ph, dyn), self.m_(aSides[2], 'tb', pw, ph, dyn), self.m_(aSides[1], 'lr', pw, ph, dyn)];
			} else {
				return [self.m_(aSides[0], 'tb', pw, ph, dyn), self.m_(aSides[1], 'lr', pw, ph, dyn), self.m_(aSides[2], 'tb', pw, ph, dyn), self.m_(aSides[3], 'lr', pw, ph, dyn)];
			}
		} else {
			if ((m + '') === 'auto') {
				return -2;
			}
			if ((m + '') === 'dynamic' && dyn === 'y') {
				return 'dynamic';
			}
			if ((ZC._f_(m) + '') === (m + '')) {
				if (self.oParent || typeof(self.oAttributes['p-width']) !== 'undefined') {
					iPWidth = (typeof(self.oAttributes['p-width'])!=='undefined')?self.oAttributes['p-width']:self.oParent.iWidth;
					iPHeight = (typeof(self.oAttributes['p-height'])!=='undefined')?self.oAttributes['p-height']:self.oParent.iHeight;
				}
				m = ZC._a_(m);
				if (m >= 1) {
					return ZC._i_(m);
				} else if (m < 1) {
					if (mWhat === 'lr') {
						return ZC._i_((self.oParent?iPWidth:pw)*m);
					} else {
						return ZC._i_((self.oParent?iPHeight:ph)*m);
					}
				}
			} else {
				m = m + '';
				if (m.indexOf('%') !== -1) {
					return self.m_(ZC._f_(m.replace('%', ''))/100, mWhat);
				} else if (m.indexOf('px') !== -1) {
					return self.m_(ZC._f_(m.replace('px', '')), mWhat);
				} else {
					return self.m_(ZC._f_(m), mWhat);
				}
			}
		}
	},
	copy : function(oObject) {
		var self = this;
		self._super(oObject);
		var aAttributes = 'iWidth,iHeight,iMarginTop,iMarginBottom,iMarginLeft,iMarginRight,iBorderRadiusTopLeft,iBorderRadiusTopRight,iBorderRadiusBottomRight,iBorderRadiusBottomLeft,bCallout,sCalloutPosition,aCalloutHook,aCalloutRatio,iCalloutWidth,iCalloutHeight,iCalloutOffset,iCalloutExtension,sPosition,sBorderTop,sBorderRight,sBorderBottom,sBorderLeft,bRectShortcut'.split(',');
		for (var i=0,iLen=aAttributes.length;i<iLen;i++) {
			if (typeof(oObject[aAttributes[i]]) !== 'undefined') {
				self[aAttributes[i]] = oObject[aAttributes[i]];
			}
		}
	},
	locate : function(iStep) {
		var self = this, mValue, m, h, v, p;
		iStep = iStep || 1;
		if (iStep === 2) {
			return;
		}
		
		if (self.bTweening) {
			self.assign_a([
				['x', 'iX'],
				['y', 'iY'],
				['width', 'iWidth'],
				['height', 'iHeight']
			]);
			return;
		}
		var iPX = (typeof(self.oAttributes['p-x'])!=='undefined')?self.oAttributes['p-x']:self.oParent.iX;
		var iPY = (typeof(self.oAttributes['p-y'])!=='undefined')?self.oAttributes['p-y']:self.oParent.iY;
		var iPWidth = (typeof(self.oAttributes['p-width'])!=='undefined')?self.oAttributes['p-width']:self.oParent.iWidth;
		var iPHeight = (typeof(self.oAttributes['p-height'])!=='undefined')?self.oAttributes['p-height']:self.oParent.iHeight;		
		if (!self.bIgnoreLocate) {
			var iMarginTop_=0, iMarginRight_=0, iMarginBottom_=0, iMarginLeft_=0;

			
			if (ZC._n_(self.oData['margin']) !== null) {
				var sMargin = ''+self.oData['margin'];
				if (sMargin.indexOf('dynamic') !== -1) {
					var dm = self.m_(sMargin, 'all', 0, 0, 'y');
					if (dm[0] === 'dynamic') {
						self.oAttributes['d-margin-top'] = self.oAttributes['d-margin'] = true;
					}
					if (dm[1] === 'dynamic') {
						self.oAttributes['d-margin-right'] = self.oAttributes['d-margin'] = true;
					}
					if (dm[2] === 'dynamic') {
						self.oAttributes['d-margin-bottom'] = self.oAttributes['d-margin'] = true;
					}
					if (dm[3] === 'dynamic') {
						self.oAttributes['d-margin-left'] = self.oAttributes['d-margin'] = true;
					}
					self.oData['margin'] = sMargin.replace(/dynamic/g, '20');
				}
			}
			if (self.oData['margin'] === 'dynamic') {
				self.oAttributes['d-margin'] = self.oAttributes['d-margin-top'] = self.oAttributes['d-margin-right'] = self.oAttributes['d-margin-bottom'] = self.oAttributes['d-margin-left'] = true;
				self.oData['margin'] = null;
			}

			
			if (typeof(self.oAttributes['force-margins']) !== 'undefined' && (ZC._n_(self.oData['adjust-layout']) === null || !ZC._b_(self.oData['adjust-layout']))) {
				if (ZC._n_(self.oData['margin-top']) !== null && ZC._n_(self.oData['margin-bottom']) === null) {
					self.oData['margin-bottom'] = 'auto';
				}
				if (ZC._n_(self.oData['margin-bottom']) !== null && ZC._n_(self.oData['margin-top']) === null) {
					self.oData['margin-top'] = 'auto';
				}
				if (ZC._n_(self.oData['margin-left']) !== null && ZC._n_(self.oData['margin-right']) === null) {
					self.oData['margin-right'] = 'auto';
				}
				if (ZC._n_(self.oData['margin-right']) !== null && ZC._n_(self.oData['margin-left']) === null) {
					self.oData['margin-left'] = 'auto';
				}
			}

			var aM = ['margin-top', 'margin-right', 'margin-bottom', 'margin-left'];
			for (var i=0,iLen=aM.length;i<iLen;i++) {
				if (self.oData[aM[i]] === 'dynamic') {
					self.oAttributes['d-'+aM[i]] = self.oAttributes['d-margin'] = true;
					self.oData[aM[i]] = null;
				}
			}


			if ((mValue=ZC._n_(self.oData['margin'])) !== null) {
				m = self.m_(mValue, 'all');
				if (ZC._n_(self.oData['margin-top']) === null) {
					iMarginTop_ = m[0];
				}
				if (ZC._n_(self.oData['margin-right']) === null) {
					iMarginRight_ = m[1];
				}
				if (ZC._n_(self.oData['margin-bottom']) === null) {
					iMarginBottom_ = m[2];
				}
				if (ZC._n_(self.oData['margin-left']) === null) {
					iMarginLeft_ = m[3];
				}
			}
			if ((mValue=ZC._n_(self.oData['margin-top'])) !== null) {
				m = self.m_(mValue, 'tb');
				iMarginTop_ = m;
			}
			if ((mValue=ZC._n_(self.oData['margin-right'])) !== null) {
				m = self.m_(mValue, 'lr');
				iMarginRight_ = m;
			}
			if ((mValue=ZC._n_(self.oData['margin-bottom'])) !== null) {
				m = self.m_(mValue, 'tb');
				iMarginBottom_ = m;
			}
			if ((mValue=ZC._n_(self.oData['margin-left'])) !== null) {
				m = self.m_(mValue, 'lr');
				iMarginLeft_ = m;
			}
			var aMargins_ = [iMarginTop_, iMarginRight_, iMarginBottom_, iMarginLeft_];

			if (ZC._n_(self.oData['x']) !== null) {
				self.iX = self.xy_(self.oData['x'], 'x');
			}
			if (ZC._n_(self.oData['y']) !== null) {
				self.iY = self.xy_(self.oData['y'], 'y');
			}

			if ((mValue=ZC._n_(self.oData['width'])) !== null) {
				var iWidth_ = ZC._p_(mValue), bPC = ((''+mValue).indexOf('%') !== -1);
				if (iWidth_ > 1 && !bPC) {
					self.iWidth = ZC._i_(iWidth_);
				} else {
					if (iMarginLeft_ === -2 && iMarginRight_ === -2) {
						self.iWidth = ZC._i_(iPWidth*iWidth_);
					} else if (iMarginLeft_ === -2 && iMarginRight_ !== -2) {
						self.iWidth = ZC._i_((iPWidth-iMarginRight_)*iWidth_);
					} else if (iMarginLeft_ !== -2 && iMarginRight_ === -2) {
						self.iWidth = ZC._i_((iPWidth-iMarginLeft_)*iWidth_);
					} else {
						self.iWidth = ZC._i_((iPWidth-iMarginLeft_-iMarginRight_)*iWidth_);
					}
				}
				if (self.iX !== -1) {
					self.iMarginLeft = self.iX - iPX;
					self.iMarginRight = iPX + iPWidth - self.iMarginLeft - self.iWidth;
				} else {
					if (iMarginLeft_ === -2 && iMarginRight_ === -2) {
						
						self.iMarginLeft = self.iMarginRight = (iPWidth-self.iWidth)/2;
						self.iX = iPX + self.iMarginLeft;
					} else if (iMarginLeft_ === -2 && iMarginRight_ !== -2) {
						
						self.iMarginRight = iMarginRight_;
						self.iMarginLeft = iPWidth - self.iMarginRight - self.iWidth;
						self.iX = iPX + self.iMarginLeft;
					} else {
						
						self.iMarginLeft = iMarginLeft_;
						self.iX = iPX + self.iMarginLeft;
						if (self instanceof ZC.ZCTextBox) {
							self.iMarginRight = iMarginRight_;
						} else {
							self.iMarginRight = iPWidth - self.iMarginLeft - self.iWidth;
						}
					}
				}
			} else {
				if (self.iX !== -1) {
					self.iMarginLeft = self.iX - iPX;
					if (iMarginRight_ === -2) {
						self.iMarginRight = 0;
					} else {
						self.iMarginRight = iMarginRight_;
					}
					self.iWidth = iPWidth - self.iMarginLeft - self.iMarginRight;
				} else {
					if (iMarginLeft_ === -2 && iMarginRight_ === -2) {
						
						self.iMarginLeft = self.iMarginRight = 0;
						self.iX = iPX + self.iMarginLeft;
						self.iWidth = iPWidth - self.iMarginLeft - self.iMarginRight;
					} else if (iMarginLeft_ === -2 && iMarginRight_ !== -2) {
						
						self.iMarginRight = iMarginRight_;
						self.iMarginLeft = 0;
						self.iX = iPX + self.iMarginLeft;
						self.iWidth = iPWidth - self.iMarginLeft - self.iMarginRight;
					} else if (iMarginLeft_ !== -2 && iMarginRight_ === -2) {
						
						self.iMarginLeft = iMarginLeft_;
						if (self instanceof ZC.ZCTextBox) {
							self.iMarginRight = iMarginRight_;
						} else {
							self.iMarginRight = 0;
						}
						self.iX = iPX + self.iMarginLeft;
						self.iWidth = iPWidth - self.iMarginLeft - self.iMarginRight;
					} else {
						self.iMarginLeft = iMarginLeft_;
						self.iMarginRight = iMarginRight_;
						self.iX = iPX + self.iMarginLeft;
						self.iWidth = iPWidth - self.iMarginLeft - self.iMarginRight;
					}
				}
			}
			if ((mValue=ZC._n_(self.oData['height'])) !== null) {
				var iHeight_ = ZC._p_(mValue), bPC = ((''+mValue).indexOf('%') !== -1);
				if (iHeight_ > 1 && !bPC) {
					self.iHeight = ZC._i_(iHeight_);
				} else {
					if (iMarginTop_ === -2 && iMarginBottom_ === -2) {
						self.iHeight = ZC._i_(iPHeight*iHeight_);
					} else if (iMarginTop_ === -2 && iMarginBottom_ !== -2) {
						self.iHeight = ZC._i_((iPHeight-iMarginBottom_)*iHeight_);
					} else if (iMarginTop_ !== -2 && iMarginBottom_ === -2) {
						self.iHeight = ZC._i_((iPHeight-iMarginTop_)*iHeight_);
					} else {
						self.iHeight = ZC._i_((iPHeight-iMarginTop_-iMarginBottom_)*iHeight_);
					}
				}
				if (self.iY !== -1) {
					self.iMarginTop = self.iY - iPY;
					self.iMarginBottom = iPY + iPHeight - self.iMarginTop - self.iHeight;
				} else {
					if (iMarginTop_ === -2 && iMarginBottom_ === -2) {
						
						self.iMarginTop = self.iMarginBottom = (iPHeight-self.iHeight)/2;
						self.iY = iPY + self.iMarginTop;
					} else if (iMarginTop_ === -2 && iMarginBottom_ !== -2) {
						
						self.iMarginBottom = iMarginBottom_;
						self.iMarginTop = iPHeight - self.iMarginBottom - self.iHeight;
						self.iY = iPY + self.iMarginTop;
					} else {
						
						self.iMarginTop = iMarginTop_;
						self.iY = iPY + self.iMarginTop;
						if (self instanceof ZC.ZCTextBox) {
							self.iMarginBottom = iMarginBottom_;
						} else {
							self.iMarginBottom = iPHeight - self.iMarginTop - self.iHeight;
						}
					}
				}
			} else {
				if (self.iY !== -1) {
					self.iMarginTop = self.iY - iPY;
					if (iMarginBottom_ === -2) {
						self.iMarginBottom = 0;
					} else {
						self.iMarginBottom = iMarginBottom_;
					}
					self.iHeight = iPHeight - self.iMarginTop - self.iMarginBottom;
				} else {
					if (iMarginTop_ === -2 && iMarginTop_ === -2) {
						
						self.iMarginTop = self.iMarginTop = 0;
						self.iY = iPY + self.iMarginTop;
						self.iHeight = iPHeight - self.iMarginTop - self.iMarginBottom;
					} else if (iMarginTop_ === -2 && iMarginBottom_ !== -2) {
						
						self.iMarginBottom = iMarginBottom_;
						self.iMarginTop = 0;
						self.iY = iPY + self.iMarginTop;
						self.iHeight = iPHeight - self.iMarginTop - self.iMarginBottom;
					} else if (iMarginTop_ === -2 && iMarginBottom_ !== -2) {
						
						self.iMarginTop = iMarginTop_;
						if (self instanceof ZC.ZCTextBox) {
							self.iMarginBottom = iMarginBottom_;
						} else {
							self.iMarginBottom = 0;
						}
						self.iY = iPY + self.iMarginTop;
						self.iHeight = iPHeight - self.iMarginTop - self.iMarginBottom;
					} else {
						self.iMarginTop = iMarginTop_;
						self.iMarginBottom = iMarginBottom_;
						self.iY = iPY + self.iMarginTop;
						self.iHeight = iPHeight - self.iMarginTop - self.iMarginBottom;
					}
				}
			}
			
			if ((mValue=ZC._n_(self.oData['position'])) !== null) {
				if (self.oParent && typeof(self.oParent.iX) !== 'undefined' && typeof(self.oParent.iY) !== 'undefined' && typeof(self.oParent.iWidth) !== 'undefined' && typeof(self.oParent.iHeight) !== 'undefined') {
					h = 0;
					v = 0;
					p = String(mValue).split(/\s+/);
					switch (p[0]) {
						case 'left':
							h = 0;
							break;
						case 'right':
							h = 1;
							break;
						case 'center':
							h = 0.5;
							break;
						default:
							h = ZC._dimension_(p[0]);
							if (h > 1) {
								h = h/self.oParent.iWidth;
							}
							break;
					}
					switch (p[1]) {
						case 'top':
							v = 0;
							break;
						case 'bottom':
							v = 1;
							break;
						case 'middle':
							v = 0.5;
							break;
						default:
							v = ZC._dimension_(p[1]);
							if (v > 1) {
								v = v/self.oParent.iHeight;
							}
							break;
					}
				}

				self.oAttributes['position-info'] = [h, v];

				self.iX = self.oParent.iX + ZC._i_(h*(self.oParent.iWidth-self.iWidth-aMargins_[1]-aMargins_[3])) + aMargins_[3];
				self.iY = self.oParent.iY + ZC._i_(v*(self.oParent.iHeight-self.iHeight-aMargins_[0]-aMargins_[2])) + aMargins_[0];				
			}

			self.aBounds = [self.iX, self.iY, self.iX + self.iWidth, self.iY + self.iHeight];
		}
	},
	parse : function() {
		var self = this, mValue;

		self._super();

		if (!self.oData['tween']) {

			self.assign_a([
				['rect-shortcut', 'bRectShortcut', 'b'],
				['center-ref', 'bCenterRef', 'b'],
				['callout', 'bCallout', 'b'],
				['callout-type', 'sCalloutType'],
				['callout-position', 'sCalloutPosition'],
				['callout-hook', 'aCalloutHook'],
				['callout-ratio', 'aCalloutRatio'],
				['callout-width', 'iCalloutWidth', 'i'],
				['callout-height', 'iCalloutHeight', 'i'],
				['callout-offset', 'iCalloutOffset', 'i'],
				['callout-extension', 'iCalloutExtension', 'i'],

				['border-top', 'sBorderTop'],
				['border-right', 'sBorderRight'],
				['border-bottom', 'sBorderBottom'],
				['border-left', 'sBorderLeft'],
				
			]);
			if ((mValue=ZC._n_(self.oData['border-radius'])) !== null) {
				var aSides = String(mValue).split(/\s+|;|,/);
				if (aSides.length === 2) {
					self.iBorderRadiusTopLeft = self.iBorderRadiusTopRight = ZC._i_(aSides[0]);
					self.iBorderRadiusBottomRight = self.iBorderRadiusBottomLeft = ZC._i_(aSides[1]);
				} else if (aSides.length === 4) {
					self.iBorderRadiusTopLeft = ZC._i_(aSides[0]);
					self.iBorderRadiusTopRight = ZC._i_(aSides[1]);
					self.iBorderRadiusBottomRight = ZC._i_(aSides[2]);
					self.iBorderRadiusBottomLeft = ZC._i_(aSides[3]);
				} else {
					self.iBorderRadiusTopLeft = self.iBorderRadiusTopRight = self.iBorderRadiusBottomRight = self.iBorderRadiusBottomLeft = ZC._i_(aSides[0]);
				}
			}

			if (ZC._n_(self.oData['callout-tip']) !== null) {
				self.oCalloutTip = new ZC.ZCShape(self.oParent);
			}

			self.assign_a([
				['border-radius-top-left', 'iBorderRadiusTopLeft', 'i'],
				['border-radius-top-right', 'iBorderRadiusTopRight', 'i'],
				['border-radius-bottom-right', 'iBorderRadiusBottomRight', 'i'],
				['border-radius-bottom-left', 'iBorderRadiusBottomLeft', 'i']
			]);

		}

	},
	paint : function() {
		var self = this;

		if (self.aCalloutHook !== null && !(self.aCalloutHook instanceof Array)) {
			
			if (self.oParent.sClassName === 'zcgraph') {
				var aHook = self.oParent.getHookXY(self.aCalloutHook);
				self.aCalloutHook = [aHook[0], aHook[1]];
				
				self.aCalloutHook[0] -= self.iOffsetX;
				self.aCalloutHook[1] -= self.iOffsetY;
			}
		}

		if (self.bCenterRef) {
			self.iX -= self.iWidth/2;
			self.iY -= self.iHeight/2;
		}
		
		if (
			(self.sBorderColor === '-1' || self.iBorderWidth === 0)
			&&
			(self.sBorderTop+self.sBorderRight+self.sBorderBottom+self.sBorderLeft === '')
			&&
			self.sBackgroundColor1 === '-1'
			&&
			self.sBackgroundColor2 === '-1'
			&&
			self.sBackgroundImage === ''
			&&
			self.sGradientColors === ''
			&&
			self.sGradientStops === ''
	 	) {
	 		return;
	 	}

		var sOutput = self.oLoader.sOutput;
		if (self.bShadow && self.oCanvasSh) {
			self.paintShadow();
		}

		function _border_info_(sBorderInfo) {
			var aInfo = sBorderInfo.split(/\s/);
			aInfo[0] = ZC._i_(aInfo[0]);
			aInfo[2] = ZC.ZCUtils._color_(aInfo[2]);
			return aInfo;
		}

		
		if (self.sBorderTop+self.sBorderRight+self.sBorderBottom+self.sBorderLeft === '') {
			switch (sOutput) {
				case 'canvas':
					self.paintCANVAS();
					break;
				case 'svg':
					self.paintSVG();
					break;
				case 'vml':
					self.paintVML();
					break;
			}

			if (self.bCallout && self.oCalloutTip) {
				var iCHx, iCHy;
				if (self.aCalloutHook && self.aCalloutHook.length === 2) {
					iCHx = self.aCalloutHook[0];
					iCHy = self.aCalloutHook[1];
				} else if (self.oAttributes['cp']) {
					iCHx = self.oAttributes['cp'][0];
					iCHy = self.oAttributes['cp'][1];					
				}

				self.oCalloutTip.oCanvas = self.oCalloutTip.oCanvasSh = self.oCanvas;
				self.oCalloutTip.copy(self);
				self.oCalloutTip.append(self.oData['callout-tip']);
				self.oCalloutTip.sId = self.sId + '-callout-tip';
				self.oCalloutTip.oData['x'] = iCHx;
				self.oCalloutTip.oData['y'] = iCHy;

				if (self.oAttributes['cm']) {
					var iCMx = self.oAttributes['cm'][0], iCMy = self.oAttributes['cm'][1];
					var iAngle = Math.atan2((ZC._i_(iCMy)-ZC._i_(iCHy)), (ZC._i_(iCMx)-ZC._i_(iCHx)));
					if (isNaN(iAngle)) {
						iAngle = 0;
					}
					if (ZC._n_(self.oCalloutTip.oData['angle']) === null) {
						self.oCalloutTip.oData['angle'] = ZC._deg_(iAngle);
					}
				}

				self.oCalloutTip.parse();
				self.oCalloutTip.paint();
			}
			
		} else {
			var iBorderWidth_ = self.iBorderWidth;
			var iBorderColor_ = self.sBorderColor;
			var sLineStyle_ = self.sLineStyle;

			self.iBorderWidth = 0;

			switch (sOutput) {
				case 'canvas':
					self.paintCANVAS();
					break;
				case 'svg':
					self.paintSVG();
					break;
				case 'vml':
					self.paintVML();
					break;
			}

			var sBackgroundColor1_ = self.sBackgroundColor1;
			var sBackgroundColor2_ = self.sBackgroundColor2;

			self.sBackgroundColor1 = self.sBackgroundColor2 = '-1';

			var aSides = ['top', 'right', 'bottom', 'left'], aProps = ['sBorderTop', 'sBorderRight', 'sBorderBottom', 'sBorderLeft'], sBorderInfo;
			for (var i=0;i<aSides.length;i++) {
				if ((sBorderInfo=self[aProps[i]]) !== '') {
					var aBI = _border_info_(sBorderInfo);
					self.iBorderWidth = aBI[0];
					self.sLineStyle = aBI[1];
					self.sBorderColor = aBI[2];
				}

				switch (sOutput) {
					case 'canvas':
						self.paintCANVAS(aSides[i]);
						break;
					case 'svg':
						self.paintSVG(aSides[i]);
						break;
					case 'vml':
						self.paintVML(aSides[i]);
						break;
				}
				self.iBorderWidth = iBorderWidth_;
				self.sBorderColor = iBorderColor_;
				self.sLineStyle = sLineStyle_;
			}

			self.sBackgroundColor1 = sBackgroundColor1_;
			self.sBackgroundColor2 = sBackgroundColor2_;
		}

		if (self.oData['top-state'] && !self.bIsShadow) {
			if (!self.bIsTop) {
				var oTop = new ZC.ZCBox((self.oParent.iX === -1 && self.oParent.iY === -1)?self:self.oParent);
				oTop.copy(self);
				oTop.bIsTop = true;
				oTop.bShadow = false;
				oTop.oCanvas = self.oCanvas;
				oTop.append(self.oData['top-state']);
				oTop.sId = self.sId + '-top';
				oTop.parse();
				oTop.paint();
			}
		}
	},
	paintShadow : function() {
		var self = this;
		
		var oShadow = zingchart.pool.getInstance('ZCBox', self.oParent, self.sId + '-sh');
		oShadow.copy(self);
		oShadow.oCanvas = self.oCanvasSh;
		oShadow.bShadow = false;
		oShadow.bIsShadow = true;
		oShadow.sBorderTop = oShadow.sBorderRight = oShadow.sBorderBottom = oShadow.sBorderLeft = '';
		oShadow.sBackgroundColor1 = oShadow.sBackgroundColor2 = oShadow.sShadowColor;
		oShadow.sGradientColors = oShadow.sGradientStops = '';
		oShadow.sBackgroundImage = '';
		oShadow.sLineStyle = 'solid';
		oShadow.sBorderColor = oShadow.sShadowColor;
		oShadow.iLineWidth = 0;

		var iShadowX = (self.iShadowDistance)*ZC._cos_(self.iShadowAngle);
		var iShadowY = (self.iShadowDistance)*ZC._sin_(self.iShadowAngle);
		oShadow.iWidth = self.iWidth + (self.oLoader.sOutput==='vml'?0:0.5) - ZC._cos_(self.iShadowAngle)*self.iShadowBlur/2;
		oShadow.iHeight = self.iHeight + (self.oLoader.sOutput==='vml'?0:0.5) - ZC._sin_(self.iShadowAngle)*self.iShadowBlur/2;
		oShadow.fBorderAlpha = oShadow.fAlpha = oShadow.fShadowAlpha*self.fAlpha;
		oShadow.sId = self.sId + '-sh';
		oShadow.iX = self.iX + ZC._i_(iShadowX);
		oShadow.iY = self.iY + ZC._i_(iShadowY);
		oShadow.paint();
	},

	sharedSetupGradients : function(sType) {
		var self = this, iRgrad;
		var iDx = self.iX;
		var iDy = self.iY;
		var iCx = iDx + self.iWidth/2;
		var iCy = iDy + self.iHeight/2;
		var iFOX = self.iFillOffsetX, iFOY = self.iFillOffsetY;
		if (ZC._a_(iFOX) <= 1) {
			iFOX = iFOX*self.iWidth/2;
		}
		if (ZC._a_(iFOY) <= 1) {
			iFOY = iFOY*self.iHeight/2;
		}
		iCx += iFOX;
		iCy += iFOY;
				
		if (sType === 'radial') {
			var iRmed = ZC._i_((self.iWidth+self.iHeight)/2);
			var iRmin = ZC._min_(self.iWidth, self.iHeight);
			iRgrad = (iRmin < iRmed/4)?((iRmin+iRmed)/2):iRmin;
   			return { cx : iCx, cy : iCy, r : ZC._a_(iRgrad) };
		} else if (sType === 'linear') {
			if (self.iWidth >= self.iHeight) {
				iRgrad = (ZC._a_(ZC._sin_(self.iFillAngle)) > 0.5)?self.iHeight/2:self.iWidth/2;
			} else {
				iRgrad = (ZC._a_(ZC._cos_(self.iFillAngle)) > 0.5)?self.iWidth/2:self.iHeight/2;
			}
			var fC_ = iRgrad*ZC._cos_(self.iFillAngle), fS_ = iRgrad*ZC._sin_(self.iFillAngle);
			var iX1 = iCx - fC_;
			var iX2 = iCx + fC_;
			var iY1 = iCy - fS_;
			var iY2 = iCy + fS_;
   			return { x1 : iX1, y1 : iY1, x2 : iX2, y2 : iY2 };
		}
	},

	sharedSetupPoints : function(sBorder) {
		var self = this, aPoint;
		if (typeof(sBorder) === 'undefined') {
			sBorder = 'all';
		}
		var iDx = self.iX;
		var iDy = self.iY;
		var iOffsetS, iOffsetE;

		self.aPoints = [];
		iOffsetS = iOffsetE = self.iBorderWidth/2;
		var iRadiusRatio = 1;
		switch (self.oLoader.sOutput) {
			case 'vml':
				iRadiusRatio = 2;
				if (self.iBorderWidth%2 === 1) {
					iOffsetS = ZC._i_((self.iBorderWidth-1)/2);
					iOffsetE = ZC._i_((self.iBorderWidth+1)/2);
				}
				break;
		}

		

		var aCP = null;
		var iDxp = iDx + iOffsetS, iDxn = iDx - iOffsetE;
		var iDyp = iDy + iOffsetS, iDyn = iDy - iOffsetE;
		var bCalloutHook = (self.aCalloutHook && self.aCalloutHook.length === 2);
		var iCalloutOffsetH = ZC._i_(self.iCalloutOffset*(self.iWidth-self.iCalloutWidth)/100);
		var iCalloutOffsetV = ZC._i_(self.iCalloutOffset*(self.iHeight-self.iCalloutHeight)/100);
		var bBorderRadius = (self.iBorderRadiusTopLeft !== 0 || self.iBorderRadiusTopRight !== 0 || self.iBorderRadiusBottomRight !== 0 || self.iBorderRadiusBottomLeft !== 0);
		var fR0 = self.aCalloutRatio[0], fR1 = self.aCalloutRatio[1];
		switch (self.sCalloutPosition) {
			case 'top':
				self.oAttributes['cm'] = [self.iX + self.iWidth/2 + iCalloutOffsetH, self.iY];
				break;
			case 'bottom':
				self.oAttributes['cm'] = [self.iX + self.iWidth/2 + iCalloutOffsetH, self.iY + self.iHeight];
				break;
			case 'left':
				self.oAttributes['cm'] = [self.iX, self.iY + self.iHeight/2 + iCalloutOffsetV];
				break;
			case 'right':
				self.oAttributes['cm'] = [self.iX + self.iWidth, self.iY + self.iHeight/2 + iCalloutOffsetV];
				break;
		}
		if (!bBorderRadius) {
			
			
			if (sBorder === 'top' || sBorder === 'all') {
				self.aPoints.push([iDxp, iDyp]);
				if (self.bCallout && self.sCalloutPosition === 'top') {
					self.aPoints.push([iDxp + self.iWidth/2 - fR0*self.iCalloutWidth/2 - self.iBorderWidth/2 + iCalloutOffsetH, iDyp]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxp + self.iWidth/2 - self.iBorderWidth/2 + iCalloutOffsetH, iDyp - self.iCalloutHeight];
						self.aPoints.push(aCP);
					}
					if (self.iCalloutExtension > 0) {
						aPoint = self.aPoints[self.aPoints.length-1];
						self.aPoints.push([aPoint[0], aPoint[1] - self.iCalloutExtension*(self.iCalloutHeight>0?1:-1)]);
						self.aPoints.push([aPoint[0], aPoint[1]]);
					}
					self.aPoints.push([iDxp + self.iWidth/2 + fR1*self.iCalloutWidth/2 - self.iBorderWidth/2 + iCalloutOffsetH, iDyp]);
				}
				if (sBorder === 'top') {
					self.aPoints.push([iDxn + self.iWidth, iDyp]);
				}
			}
			if (sBorder === 'right' || sBorder === 'all') {
				self.aPoints.push([iDxn + self.iWidth, iDyp]);
				if (self.bCallout && self.sCalloutPosition === 'right') {
					self.aPoints.push([iDxn + self.iWidth, iDyp + self.iHeight/2 - self.iBorderWidth/2 - fR0*self.iCalloutHeight/2 + iCalloutOffsetV]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxn + self.iWidth + self.iCalloutWidth, iDyp + self.iHeight/2 - self.iBorderWidth/2 + iCalloutOffsetV];
						self.aPoints.push(aCP);
					}
					self.aPoints.push([iDxn + self.iWidth, iDyp + self.iHeight/2 - self.iBorderWidth/2 + fR1*self.iCalloutHeight/2 + iCalloutOffsetV]);
				}
				if (sBorder === 'right') {
					self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight]);
				}
			}
			if (sBorder === 'bottom' || sBorder === 'all') {
				self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight]);
				if (self.bCallout && self.sCalloutPosition === 'bottom') {
					self.aPoints.push([iDxn + self.iWidth/2 + fR0*self.iCalloutWidth/2 + self.iBorderWidth/2 + iCalloutOffsetH, iDyn + self.iHeight]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxn + self.iWidth/2 + self.iBorderWidth/2 + iCalloutOffsetH, iDyn + self.iHeight + self.iCalloutHeight];
						self.aPoints.push(aCP);
					}
					if (self.iCalloutExtension > 0) {
						aPoint = self.aPoints[self.aPoints.length-1];
						self.aPoints.push([aPoint[0], aPoint[1] + self.iCalloutExtension*(self.iCalloutHeight>0?1:-1)]);
						self.aPoints.push([aPoint[0], aPoint[1]]);
					}
					self.aPoints.push([iDxn + self.iWidth/2 - fR1*self.iCalloutWidth/2 + self.iBorderWidth/2 + iCalloutOffsetH, iDyn + self.iHeight]);
				}
				if (sBorder === 'bottom') {
					self.aPoints.push([iDxp, iDyn + self.iHeight]);
				}
			}
			if (sBorder === 'left' || sBorder === 'all') {
				self.aPoints.push([iDxp, iDyn + self.iHeight]);
				if (self.bCallout && self.sCalloutPosition === 'left') {
					self.aPoints.push([iDxp, iDyn + self.iHeight/2 + self.iBorderWidth/2 + fR0*self.iCalloutHeight/2 + iCalloutOffsetV]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxp - self.iCalloutWidth, iDyn + self.iHeight/2 + self.iBorderWidth/2 + iCalloutOffsetV];
						self.aPoints.push(aCP);
					}
					self.aPoints.push([iDxp, iDyn + self.iHeight/2 + self.iBorderWidth/2 - fR1*self.iCalloutHeight/2 + iCalloutOffsetV]);
				}
				self.aPoints.push([iDxp, iDyp]);
				self.aPoints.push([iDxp+0.1, iDyp]);
			}
		} else {
			
			var iBorderRadius;
			var iMinBorderRadius = ZC._min_(self.iWidth/2, self.iHeight/2);
			if (sBorder === 'top' || sBorder === 'all') {
				if (self.iBorderRadiusTopLeft !== 0) {
					iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusTopLeft && self.iHeight/2 >= self.iBorderRadiusTopLeft)?ZC._a_(self.iBorderRadiusTopLeft):iMinBorderRadius;
					self.aPoints.push([iDxp, iDyp + iBorderRadius]);
					if (self.iBorderRadiusTopLeft > 0) {
						self.aPoints.push([iDxp, iDyp, iDxp + iRadiusRatio*iBorderRadius, iDyp]);
					}
					self.aPoints.push([iDxp + iBorderRadius, iDyp]);
				} else {
					self.aPoints.push([iDxp, iDyp]);
				}
				if (self.bCallout && self.sCalloutPosition === 'top') {
					self.aPoints.push([iDxp + self.iWidth/2 - fR0*self.iCalloutWidth/2 - self.iBorderWidth/2 + iCalloutOffsetH, iDyp]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxp + self.iWidth/2 - self.iBorderWidth/2 + iCalloutOffsetH, iDyp - self.iCalloutHeight];
						self.aPoints.push(aCP);
					}
					if (self.iCalloutExtension > 0) {
						aPoint = self.aPoints[self.aPoints.length-1];
						self.aPoints.push([aPoint[0], aPoint[1] - self.iCalloutExtension*(self.iCalloutHeight>0?1:-1)]);
						self.aPoints.push([aPoint[0], aPoint[1]]);
					}
					self.aPoints.push([iDxp + self.iWidth/2 - self.iBorderWidth/2 + fR1*self.iCalloutWidth/2 + iCalloutOffsetH, iDyp]);
				}
				if (sBorder === 'top') {
					if (self.iBorderRadiusTopRight !== 0) {
						iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusTopRight && self.iHeight/2 >= self.iBorderRadiusTopRight)?ZC._a_(self.iBorderRadiusTopRight):iMinBorderRadius;
						self.aPoints.push([iDxn + self.iWidth - iBorderRadius, iDyp]);
					} else {
						self.aPoints.push([iDxn + self.iWidth, iDyp]);
					}
				}
			}
			if (sBorder === 'right' || sBorder === 'all') {
				if (self.iBorderRadiusTopRight !== 0) {
					iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusTopRight && self.iHeight/2 >= self.iBorderRadiusTopRight)?ZC._a_(self.iBorderRadiusTopRight):iMinBorderRadius;
					self.aPoints.push([iDxn + self.iWidth - iBorderRadius, iDyp]);
					if (self.iBorderRadiusTopRight > 0) {
						self.aPoints.push([iDxn + self.iWidth, iDyp, iDxn + self.iWidth, iDyp + iRadiusRatio*iBorderRadius]);
					} else {
						self.aPoints.push([iDxn + self.iWidth, iDyp + iBorderRadius]);
					}
				} else {
					self.aPoints.push([iDxn + self.iWidth, iDyp]);
				}
				if (self.bCallout && self.sCalloutPosition === 'right') {
					self.aPoints.push([iDxn + self.iWidth, iDyp + self.iHeight/2 - fR0*self.iCalloutHeight/2 - self.iBorderWidth/2 + iCalloutOffsetV]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxn + self.iWidth + self.iCalloutWidth, iDyp + self.iHeight/2 - self.iBorderWidth/2 + iCalloutOffsetV];
						self.aPoints.push(aCP);
					}
					self.aPoints.push([iDxn + self.iWidth, iDyp + self.iHeight/2 + fR1*self.iCalloutHeight/2 - self.iBorderWidth/2 + iCalloutOffsetV]);
				}
				if (sBorder === 'right') {
					if (self.iBorderRadiusBottomRight !== 0) {
						iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusBottomRight && self.iHeight/2 >= self.iBorderRadiusBottomRight)?ZC._a_(self.iBorderRadiusBottomRight):iMinBorderRadius;
						self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight - iBorderRadius]);
					} else {
						self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight]);
					}
				}
			}
			if (sBorder === 'bottom' || sBorder === 'all') {
				if (self.iBorderRadiusBottomRight !== 0) {
					iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusBottomRight && self.iHeight/2 >= self.iBorderRadiusBottomRight)?ZC._a_(self.iBorderRadiusBottomRight):iMinBorderRadius;
					self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight - iBorderRadius]);
					if (self.iBorderRadiusBottomRight > 0) {
						self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight, iDxn + self.iWidth - iRadiusRatio*iBorderRadius, iDyn + self.iHeight]);
					} else {
						self.aPoints.push([iDxn + self.iWidth - iBorderRadius, iDyn + self.iHeight]);
					}
				} else {
					self.aPoints.push([iDxn + self.iWidth, iDyn + self.iHeight]);
				}
				if (self.bCallout && self.sCalloutPosition === 'bottom') {
					self.aPoints.push([iDxn + self.iWidth/2 + fR0*self.iCalloutWidth/2 + self.iBorderWidth/2 + iCalloutOffsetH, iDyn + self.iHeight]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxn + self.iWidth/2 + self.iBorderWidth/2 + iCalloutOffsetH, iDyn + self.iHeight + self.iCalloutHeight];
						self.aPoints.push(aCP);
					}
					if (self.iCalloutExtension > 0) {
						aPoint = self.aPoints[self.aPoints.length-1];
						self.aPoints.push([aPoint[0], aPoint[1] + self.iCalloutExtension*(self.iCalloutHeight>0?1:-1)]);
						self.aPoints.push([aPoint[0], aPoint[1]]);
					}
					self.aPoints.push([iDxn + self.iWidth/2 - fR1*self.iCalloutWidth/2 + self.iBorderWidth/2 + iCalloutOffsetH, iDyn + self.iHeight]);
				}
				if (sBorder === 'bottom') {
					if (self.iBorderRadiusBottomLeft !== 0) {
						iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusBottomLeft && self.iHeight/2 >= self.iBorderRadiusBottomLeft)?ZC._a_(self.iBorderRadiusBottomLeft):iMinBorderRadius;
						self.aPoints.push([iDxp + iBorderRadius, iDyn + self.iHeight]);
					} else {
						self.aPoints.push([iDxp, iDyn + self.iHeight]);
					}
				}
			}
			if (sBorder === 'left' || sBorder === 'all') {
				if (self.iBorderRadiusBottomLeft !== 0) {
					iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusBottomLeft && self.iHeight/2 >= self.iBorderRadiusBottomLeft)?ZC._a_(self.iBorderRadiusBottomLeft):iMinBorderRadius;
					self.aPoints.push([iDxp + iBorderRadius, iDyn + self.iHeight]);
					if (self.iBorderRadiusBottomLeft > 0) {
						self.aPoints.push([iDxp, iDyn + self.iHeight, iDxp, iDyn + self.iHeight - iRadiusRatio*iBorderRadius]);
					} else {
						self.aPoints.push([iDxp, iDyn + self.iHeight - iBorderRadius]);
					}
				} else {
					self.aPoints.push([iDxp, iDyn + self.iHeight]);
				}
				if (self.bCallout && self.sCalloutPosition === 'left') {
					self.aPoints.push([iDxp, iDyn + self.iHeight/2 + fR0*self.iCalloutHeight/2 + self.iBorderWidth/2 + iCalloutOffsetV]);
					if (bCalloutHook) {
						self.aPoints.push([self.aCalloutHook[0], self.aCalloutHook[1]]);
					} else {
						aCP = [iDxp - self.iCalloutWidth, iDyn + self.iHeight/2 + self.iBorderWidth/2 + iCalloutOffsetV];
						self.aPoints.push(aCP);
					}
					self.aPoints.push([iDxp, iDyn + self.iHeight/2 - fR1*self.iCalloutHeight/2 + self.iBorderWidth/2 + iCalloutOffsetV]);
				}
				if (self.iBorderRadiusTopLeft !== 0) {
					iBorderRadius = (self.iWidth/2 >= self.iBorderRadiusTopLeft && self.iHeight/2 >= self.iBorderRadiusTopLeft)?ZC._a_(self.iBorderRadiusTopLeft):iMinBorderRadius;
					self.aPoints.push([iDxp, iDyp + iBorderRadius]);
				} else {
					self.aPoints.push([iDxp, iDyp]);
					self.aPoints.push([iDxp+0.1, iDyp]);
				}
			}
		}
		if (aCP) {
			self.oAttributes['cp'] = aCP;
		}
	},

	paintCANVAS : function(sBorder) {
		sBorder = sBorder || 'all';
		var self = this, oGradient, oPattern, iLineWidth_;

		var oCtx = self.oCanvas.getContext('2d');
		oCtx.save();

		oCtx.globalCompositeOperation = self.sComposite;

		var iDx = self.iX;
		var iDy = self.iY;

		var oInfoColors = self.sharedCANVASSetupColors();
		var sBorderColor = oInfoColors.bc;
		var sBackgroundColor1 = oInfoColors.bgc1;
		var sBackgroundColor2 = oInfoColors.bgc2;

		if (sBorder === 'all') {
			if ((sBackgroundColor1 !== sBackgroundColor2) || (self.sGradientColors !== '' && self.sGradientStops !== '')) {
				var oInfoGradient = self.sharedSetupGradients(self.sFillType);
				if (self.sFillType === 'radial') {
		   			oGradient = oCtx.createRadialGradient(oInfoGradient.cx, oInfoGradient.cy, 1, oInfoGradient.cx, oInfoGradient.cy, oInfoGradient.r);
				} else if (self.sFillType === 'linear') {
					
					oInfoGradient.x1 = isNaN(oInfoGradient.x1)?0:oInfoGradient.x1;
					oInfoGradient.x2 = isNaN(oInfoGradient.x2)?0:oInfoGradient.x2;
					oInfoGradient.y1 = isNaN(oInfoGradient.y1)?0:oInfoGradient.y1;
					oInfoGradient.y2 = isNaN(oInfoGradient.y2)?0:oInfoGradient.y2;
					oGradient = oCtx.createLinearGradient(oInfoGradient.x1, oInfoGradient.y1, oInfoGradient.x2, oInfoGradient.y2);
				}
				if (self.sGradientColors !== '' && self.sGradientStops !== '') {
					self.sharedCANVASSetupMGradients(oGradient);
				} else {
					oGradient.addColorStop(0, sBackgroundColor1);
					oGradient.addColorStop(1, sBackgroundColor2);
				}
				oCtx.fillStyle = oGradient;
			} else {
				
				if (self.sBackgroundImage !== '' && ZC._indexof_(['repeat', 'true', true], self.sBackgroundRepeat) !== -1) {
					if (self.sBackgroundColor1 === '-1' && self.sBackgroundColor2 === '-1') {
						sBackgroundColor1 = 'rgba(255,255,255,0)';
					}
				}
				oCtx.fillStyle = sBackgroundColor1;
			}
		}
		
		oCtx.strokeStyle = sBorderColor;
		oCtx.lineWidth = self.iBorderWidth;
		oCtx.translate(self.iOffsetX, self.iOffsetY);
		if (self.iAngle !== 0) {
			oCtx.translate(iDx + self.iWidth/2, iDy + self.iHeight/2);
			oCtx.rotate(ZC._rad_(self.iAngle));
			oCtx.translate(-(iDx + self.iWidth/2), -(iDy + self.iHeight/2));
		}
		oCtx.beginPath();

		self.sharedSetupPoints(sBorder);
		var bBorderRadius = ((self.iBorderRadiusTopLeft+self.iBorderRadiusTopRight+self.iBorderRadiusBottomRight+self.iBorderRadiusBottomLeft) !== 0);

		iLineWidth_ = self.iLineWidth;
		self.iLineWidth = self.iBorderWidth;
		var sLineStyle_ = self.sLineStyle;
		self.sLineStyle = '';
		self.setLineStyle();
		ZC.ZCLine.contour(oCtx, self, self.aPoints);
		self.iLineWidth = iLineWidth_;
		self.sLineStyle = sLineStyle_;
		self.setLineStyle();

		if (sBorder === 'all') {
			if (self.sBackgroundImage !== '' && ZC._indexof_(ZC.IMG404, self.sBackgroundImage) === -1) {
				oCtx.fill();
				oCtx.save();
				oCtx.clip();

				var fGlobalAlpha_ = oCtx.globalAlpha;
				oCtx.globalAlpha = self.fAlpha;

				var oInfoBgImage = self.sharedSetupBgImage();
				var oImage = oInfoBgImage.image;

				switch (self.sBackgroundRepeat) {
					
					default:
						oCtx.translate(oInfoBgImage.x, oInfoBgImage.y);
						oPattern = oCtx.createPattern(oImage, 'repeat');
						oCtx.fillStyle = oPattern;
						oCtx.fill();
						oCtx.translate(-oInfoBgImage.x, -oInfoBgImage.y);
						
						
						break;
					case 'no-repeat':
					case 'false':
					case false:
						oCtx.drawImage(oImage, oInfoBgImage.x, oInfoBgImage.y, self.oAttributes['bg-image-width'], self.oAttributes['bg-image-height']);
						break;
				}
				oCtx.globalAlpha = fGlobalAlpha_;
				oCtx.restore();
			} else {
				oCtx.fill();
			}
		}

		if (self.iBorderWidth > 0) {
			var sLineColor_ = self.sLineColor;
			iLineWidth_ = self.iLineWidth;
			self.sLineColor = self.sBorderColor;
			self.iLineWidth = self.iBorderWidth;
			self.setLineStyle();
			ZC.ZCLine.setup(oCtx, self);
			self.sLineCap = bBorderRadius?'round':'square';
			if (self.iLineSegmentSize + self.iLineGapSize > 0) {
				self.sLineCap = 'butt';
			}
			self.sLineJoin = bBorderRadius?'round':'miter';
			self.oAttributes['skip-top'] = true;
			self.oAttributes['border'] = sBorder;
			ZC.ZCLine.paint(oCtx, self, self.aPoints, true);
			self.sLineColor = sLineColor_;
			self.iLineWidth = iLineWidth_;
			self.setLineStyle();
		}

		oCtx.closePath();
		oCtx.restore();
	},

	paintSVG : function(sBorder) {
		sBorder = sBorder || 'all';
		var self = this;
		var oCtx = self.oCanvas;

		self.oAttributes['fill'] = -1;

		if (sBorder === 'all') {
			if (self.sBackgroundImage !== '' && ZC._indexof_(ZC.IMG404, self.sBackgroundImage) === -1) {
				var oInfoBgImage = self.sharedSetupBgImage();
				self.sharedSVGSetupPattern({
					info : oInfoBgImage,
					x : oInfoBgImage.x,
					y : oInfoBgImage.y
				});
			}

			self.sharedSVGSetupGradient();
		}

		self.sharedSetupPoints(sBorder);
		var bBorderRadius = ((self.iBorderRadiusTopLeft+self.iBorderRadiusTopRight+self.iBorderRadiusBottomRight+self.iBorderRadiusBottomLeft) !== 0);
		self.oAttributes['cx'] = self.iX + self.iWidth/2;
		self.oAttributes['cy'] = self.iY + self.iHeight/2;

		if (self.bBackgroundClip) {
			self.sharedSetupClipPath();
		}

		var bCache_;
		var sLineColor_ = self.sLineColor;
		var iLineWidth_ = self.iLineWidth;
		var fAlpha_ = self.fAlpha;
		var bShadow_ = self.bShadow;
		self.sLineColor = self.sBorderColor;
		self.iLineWidth = self.iBorderWidth;
		self.setLineStyle();
		ZC.ZCLine.setup(oCtx, self);
		self.sLineCap = bBorderRadius?'round':'square';
		if (self.iLineSegmentSize + self.iLineGapSize > 0) {
			self.sLineCap = 'butt';
		}
		self.sLineJoin = bBorderRadius?'round':'miter';

		
		var bRectShortcut = false;
		if (
			!ZC.ZCQuery.browser.msie
			&&
			self.bRectShortcut 
			&& 
			!self.bCallout 
			&& 
			(self.sBorderTop === '' && self.sBorderRight === '' && self.sBorderBottom === '' && self.sBorderLeft === '')
			&&
			(self.iBorderRadiusTopLeft === 0 && self.iBorderRadiusTopRight === 0 && self.iBorderRadiusBottomRight === 0 && self.iBorderRadiusBottomLeft === 0)
		) {
			bRectShortcut = true;
		}

		self.oAttributes['skip-top'] = true;
		self.oAttributes['border'] = sBorder;
		ZC.ZCLine.paint(oCtx, self, self.aPoints, true, null, bRectShortcut);
		self.sLineColor = sLineColor_;
		self.iLineWidth = iLineWidth_;
		self.setLineStyle();
	},

	paintVML : function(sBorder) {
		sBorder = sBorder || 'all';
		var self = this;
		var oCtx = self.oCanvas;

		if (sBorder === 'all') {
			var oImgFill = ZC.ZCHtmlUtils._element_('zcv:fill');
			if (self.sBackgroundImage !== '' && ZC._indexof_(ZC.IMG404, self.sBackgroundImage) === -1) {
				var oInfoBgImage = self.sharedSetupBgImage();
				var oImage = oInfoBgImage.image;

				switch (self.sBackgroundRepeat) {
					default:
						oImgFill.type = 'tile';
						oImgFill.src = self.sBackgroundImage;
						ZC.ZCHtmlUtils._attr_(oImgFill, {
							position : (oInfoBgImage.cx + ',' + oInfoBgImage.cy),
							opacity : self.fAlpha,
							'o:opacity2' : self.fAlpha
						});
						self.oAttributes['imgfill'] = [oImgFill];
						break;
					case 'no-repeat':
					case 'false':
					case false:
						self.oAttributes['imgfill'] = [oImage, oInfoBgImage.x, oInfoBgImage.y];
						break;
				}
			}

			self.sharedVMLSetupGradient('0.5,0.5');
		}

		var oStroke = ZC.ZCHtmlUtils._element_('zcv:stroke');
		oStroke.weight = self.iBorderWidth + 'px';
		oStroke.color = self.sBorderColor;
		oStroke.opacity = self.fAlpha;

		switch (self.sLineStyle) {
			case 'solid':
				oStroke.dashstyle = 'solid';
				break;
			case 'dotted':
				oStroke.dashstyle = 'dot';
				break;
			case 'dashed':
				oStroke.dashstyle = 'dash';
				break;
		}
		self.oAttributes['stroke'] = oStroke;

		self.sharedSetupPoints(sBorder);
		var bBorderRadius = ((self.iBorderRadiusTopLeft+self.iBorderRadiusTopRight+self.iBorderRadiusBottomRight+self.iBorderRadiusBottomLeft) !== 0);
		self.oAttributes['cx'] = self.iX + self.iWidth/2;
		self.oAttributes['cy'] = self.iY + self.iHeight/2;

		var sLineColor_ = self.sLineColor;
		var iLineWidth_ = self.iLineWidth;
		self.sLineColor = self.sBorderColor;
		self.iLineWidth = self.iBorderWidth;
		self.setLineStyle();
		ZC.ZCLine.setup(oCtx, self);
		self.sLineCap = bBorderRadius?'round':'square';
		if (self.iLineSegmentSize + self.iLineGapSize > 0) {
			self.sLineCap = 'butt';
		}
		self.sLineJoin = bBorderRadius?'round':'miter';
		self.oAttributes['border'] = sBorder;
		ZC.ZCLine.paint(oCtx, self, self.aPoints, (sBorder==='all'));
		self.sLineColor = sLineColor_;
		self.iLineWidth = iLineWidth_;
		self.setLineStyle();
	}

});









ZC.ZCGraphShape = ZC.ZCShape.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oShapeData = null;
		self.oShape = null;
		self.oLabel = null;
		self.oConnector = null;
		self.oTooltip = null;
		self.bFlat = false;
		self.bCache = false;
		self.bDynamic = false;
		self.bTranslated = false;
	},
	parse : function() {
		var self = this, mValue;

		
		self.oShape = zingchart.pool.getInstance('ZCShape', self.oParent, self.sId + '-shape', self.oShapeData['tween']);

		self.oShape.append(self.oShapeData);

		self.oShape.iX = self.iX;
		self.oShape.iY = self.iY;
		self.oShape.sId = self.sId + '-gshape';
		self.oShape.bCache = self.bCache;

		if (!self.bTranslated && (ZC._n_(mValue=self.oShape.oData['points']) !== null)) {
			self.oShape.oData['points'] = ZC.ZCUtils._translate_(mValue, self.oParent.iX, self.oParent.iY);
			self.bTranslated = true;
		}

		self.oShape.parse();

		if (ZC._n_(mValue=self.oShape.oData['label']) !== null && ZC._n_(mValue['text']) !== null && mValue['text'] !== '') {
			
			if (typeof(mValue['visible']) === 'undefined' || ZC._b_(mValue['visible'])) {
				
				self.oLabel = zingchart.pool.getInstance('ZCTextBox', self, self.oParent.sId + '-shape-label-' + self.sObjectId, ZC.objmove);
				if (!ZC.objmove) {
					self.oLabel.append(mValue);
				}
			}
		}
		if (ZC._n_(mValue=self.oShape.oData['static']) !== null) {
			self.bFlat = ZC._b_(mValue);
		}
		
		if (ZC._n_(mValue=self.oShape.oData['flat']) !== null) {
			self.bFlat = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=self.oShape.oData['dynamic']) !== null) {
			self.bDynamic = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=self.oShape.oData['connector']) !== null) {
			self.oConnector = new ZC.ZCShape(self);
			self.oConnector.append(mValue);
			self.oConnector.parse();
		}
	},
	paint : function() {
		var self = this, oCtx;

		self.oShape.oCanvas = self.oCanvas;
		self.oShape.oCanvasSh = self.oCanvasSh;
		self.oShape.locate(2);
		self.oShape.bIsTop = false;
		self.oShape.paint();

		if (self.oLabel) {
			self.oLabel.oCanvas = self.oLabel.oCanvasSh = self.oCanvas;
			self.oLabel.oDOMParent = ZC._id_(self.oParent.oParent.sId + '-text');
			self.oLabel.sId = self.oParent.sId + '-shape-label-' + self.sObjectId;
			self.oLabel.sDOMClass = self.oParent.sId + '-shape-label zc-shape-label';
			switch (self.sShape) {
				default:
					self.oLabel.iX = self.iX;
					self.oLabel.iY = self.iY;
					break;
				case 'line':
				case 'poly':
				case 'rect':
				case 'rectangle':
					self.oLabel.iX = ZC._i_((self.oShape.aBounds[0]+self.oShape.aBounds[2])/2);
					self.oLabel.iY = ZC._i_((self.oShape.aBounds[1]+self.oShape.aBounds[3])/2);
					break;
			}
			if (!ZC.objmove) {
				self.oLabel.parse();
			}
			self.oLabel.iX = self.oLabel.iX - self.oLabel.iWidth/2 + self.oShape.iOffsetX;
			self.oLabel.iY = self.oLabel.iY - self.oLabel.iHeight/2 + self.oShape.iOffsetX;

			if (self.oLabel.bVisible) {

				if (self.oConnector && self.oConnector.aPoints.length > 0) {
					
					if (!ZC._id_(self.oParent.sId + '-objects-front')) {
						var sWH = self.oParent.oParent.iWidth + '/' + self.oParent.oParent.iHeight;
						ZC.ZCHtmlUtils._group_({
							cls : 'zc-abs',
							wh : sWH,
							id : self.oParent.sId + '-objects-front',
							p : ZC._id_(self.oParent.oParent.sId + '-objects-front')
						}, self.oParent.oParent.sOutput);
						ZC.ZCHtmlUtils._layer_({
							cls : 'zc-abs zc-layer',
							id : self.oParent.sId + '-objects-front-c',
							p : ZC._id_(self.oParent.sId + '-objects-front'),
							wh : sWH
						}, self.oParent.oParent.sOutput);
					}

					var aPoints = self.oConnector.aPoints;
					var sAnchor = self.oConnector.oData['anchor'] || '';
					var aAnchorPoint = aPoints[aPoints.length-1];
					switch (sAnchor) {
						case 'l':
							self.oLabel.iX = aAnchorPoint[0] + self.oShape.iOffsetX;
							self.oLabel.iY = aAnchorPoint[1] - self.oLabel.iHeight/2 + self.oShape.iOffsetY;
							break;
						case 'r':
							self.oLabel.iX = aAnchorPoint[0] - self.oLabel.iWidth + self.oShape.iOffsetX;
							self.oLabel.iY = aAnchorPoint[1] - self.oLabel.iHeight/2 + self.oShape.iOffsetY;
							break;
						case 't':
							self.oLabel.iX = aAnchorPoint[0] - self.oLabel.iWidth/2 + self.oShape.iOffsetX;
							self.oLabel.iY = aAnchorPoint[1] + self.oShape.iOffsetY;
							break;
						case 'b':
							self.oLabel.iX = aAnchorPoint[0] - self.oLabel.iWidth/2 + self.oShape.iOffsetX;
							self.oLabel.iY = aAnchorPoint[1] - self.oLabel.iHeight + self.oShape.iOffsetY;
							break;
						default:
							self.oLabel.iX = aAnchorPoint[0] - self.oLabel.iWidth/2 + self.oShape.iOffsetX;
							self.oLabel.iY = aAnchorPoint[1] - self.oLabel.iHeight/2 + self.oShape.iOffsetY;
							break;						
					}
					oCtx = ZC.ZCHtmlUtils._context_(ZC._id_(self.oParent.sId + '-objects-front-c'), self.oParent.oLoader.sOutput);
					
					ZC.ZCLine.setup(oCtx, self.oConnector);
					ZC.ZCLine.paint(oCtx, self.oConnector, aPoints);
				}

				self.oLabel.bIsTop = false;
				self.oLabel.paint();
				if (self.oAttributes['print-canvas']) {
					self.oLabel.paintPrintVersion(ZC._id_(self.oAttributes['print-canvas']));
				} else {
					self.oLabel.paintPrintVersion();
				}
			}
		}
	}
});










ZC.ZCTextBox = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oDOMParent = null;
		self.sDOMClass = '';
		self.sText = null;
		self.sTextAlign = 'center';
		self.sVerticalAlign = 'middle';
		self.iFontSize = zingchart.FONTSIZE;
		self.sFontFamily = zingchart.FONTFAMILY;
		self.sColor = '#000';
		self.bBold = false;
		self.bItalic = false;
		self.bUnderline = false;
		self.sTextDecoration = 'none';
		self.iMaxChars = 0;
		self.iPaddingTop = 2;
		self.iPaddingRight = 2;
		self.iPaddingBottom = 2;
		self.iPaddingLeft = 2;
		self.bClipText = false;
		self.bWrapText = false;
		self.iLineHeight = -1;
		self.iTextHeight = 0;
		self.iTextWidth = 0;
		self.iMaxWidth = ZC.MAX;
		self.bRTL = false;

		self.bFastWidth = zingchart.FASTWIDTH;
		self.fWidthRatio = 1.65;
		
		

		self.fTextAlpha = 1;
		self.bPrint = false;
		self.oTooltip = null;
		self.bLockRotation = false;
		self.bSkipText = false;
	},
	getPMap : function() {
		var oMap = this._super();
		this.addPMap(oMap, 'textAlign,verticalAlign,fontSize,fontFamily,color,bold,italic,underline,textDecoration,paddingTop,paddingRight,paddingBottom,paddingLeft,text', 'sTextAlign,sVerticalAlign,iFontSize,sFontFamily,sColor,bBold,bItalic,bUnderline,sTextDecoration,iPaddingTop,iPaddingRight,iPaddingBottom,iPaddingLeft,sText');
		return oMap;
	},
	copy : function(oObject) {
		var self = this;
		self._super(oObject);
		var aAttributes = 'sTextAlign,sVerticalAlign,iFontSize,sFontFamily,sColor,bBold,bItalic,sTextDecoration,bUnderline,iPaddingTop,iPaddingRight,iPaddingBottom,iPaddingLeft,sText'.split(',');
		for (var i=0,iLen=aAttributes.length;i<iLen;i++) {
			if (typeof(oObject[aAttributes[i]]) !== 'undefined') {
				self[aAttributes[i]] = oObject[aAttributes[i]];
			}
		}
	},
	parseText : function(sText) {
		return sText;
	},
	cwidth : function(sText) {
		var self = this;
		if (self.bFastWidth) {
			return sText.replace(/(<([^>]+)>)/ig, '').length*self.iFontSize/(self.fWidthRatio*(self.bBold?0.87:1)*(self.bItalic?0.95:1));
		} else {
			return ZC.ZCHtmlUtils._text_width_(this.oLoader.sId, sText, this.sFontFamily, this.iFontSize, this.bBold);
		}
	},
	parse : function() {
		var self = this, mValue, p, i, iLen;

		
		self.iWidth = self.iHeight = self.iTextWidth = self.iTextHeight = 0;

		self._super();

		if (!self.oData['tween']) {

			self.assign('text', 'sText');

			if (ZC._n_(self.sText) !== null) {
				self.sText = ''+self.sText;
				self.sText = self.parseText(self.sText);
				self.sText = self.sText.replace(/\n/g, '<br />');
				if (self.oLoader.sOutput === 'svg') {
					self.sText = self.sText.replace(/&nbsp;/g, ' ');
				}
			}

			self.assign_a([
				['fast-width', 'bFastWidth', 'b'],
				['max-width', 'iMaxWidth', 'i'],
				['line-height', 'iLineHeight', 'i'],
				['width-ratio', 'fWidthRatio', 'f'],
				['wrap-text', 'bWrapText', 'b'],
				['clip-text', 'bClipText', 'b'],
				['bold', 'bBold', 'b'],
				['italic', 'bItalic', 'b'],
				['underline', 'bUnderline', 'b'],
				['text-decoration', 'sTextDecoration'],
				['rtl', 'bRTL', 'b'],
				['text-align', 'sTextAlign'],
				['align', 'sTextAlign'],
				['anchor', 'sAnchor'],
				['vertical-align', 'sVerticalAlign'],
				['font-size', 'iFontSize', 'f'],
				['max-chars', 'iMaxChars', 'i'],
				['font-family', 'sFontFamily'],
				['font-angle', 'iAngle', 'i'],
				['color', 'sColor', 'c'],
				['font-color', 'sColor', 'c'],
				['text-alpha', 'fTextAlpha', 'f', 0, 1],
				['lock-rotation', 'bLockRotation', 'b']
			]);

			self.iFontSize = ZC._max_(1, self.iFontSize);

			if (ZC._n_(self.oData['text-alpha']) === null) {
				self.fTextAlpha = self.fAlpha;
			}

			

			if ((mValue=ZC._n_(self.oData['font-weight'])) !== null) {
				self.bBold = (mValue === 'bold');
			}
			if (ZC._n_(self.oData['text-decoration']) === null) {
				self.sTextDecoration = self.bUnderline ? 'underline' : 'none';
			}
			
			if ((mValue=ZC._n_(self.oData['font-style'])) !== null) {
				self.bItalic = (mValue === 'italic' || mValue === 'oblique');
			}

			if ((mValue=ZC._n_(self.oData['padding'])) !== null) {
				var aSides = String(mValue).split(/\s+|;|,/);
				if (aSides.length === 1) {
					p = [ZC._i_(aSides[0]), ZC._i_(aSides[0]), ZC._i_(aSides[0]), ZC._i_(aSides[0])];
				} else if (aSides.length === 2) {
					p = [ZC._i_(aSides[0]), ZC._i_(aSides[1]), ZC._i_(aSides[0]), ZC._i_(aSides[1])];
				} else if (aSides.length === 3) {
					p = [ZC._i_(aSides[0]), ZC._i_(aSides[1]), ZC._i_(aSides[2]), ZC._i_(aSides[0])];
				} else {
					p = [ZC._i_(aSides[0]), ZC._i_(aSides[1]), ZC._i_(aSides[2]), ZC._i_(aSides[3])];
				}
				self.iPaddingTop = p[0];
				self.iPaddingRight = p[1];
				self.iPaddingBottom = p[2];
				self.iPaddingLeft = p[3];
			}
			self.assign_a([
				['padding-top', 'iPaddingTop', 'i'],
				['padding-right', 'iPaddingRight', 'i'],
				['padding-bottom', 'iPaddingBottom', 'i'],
				['padding-left', 'iPaddingLeft', 'i']
			]);

			if (self.sText) {
				if (self.iMaxChars > 0 && self.sText.length > self.iMaxChars) {
					self.sText = self.sText.substring(0, self.iMaxChars) + '...';
				}
				var aLines = self.sText.split(/<br>|<br\/>|<br \/>|\n/);
				var iLines = aLines.length;
				if (self.iLineHeight == -1) {
					self.iTextHeight = ZC._i_(iLines*1.25*self.iFontSize) + self.iPaddingTop + self.iPaddingBottom;
					
					
				} else {
					self.iTextHeight = ZC._i_(iLines*self.iLineHeight) + self.iPaddingTop + self.iPaddingBottom;
				}
				for (i=0,iLen=aLines.length;i<iLen;i++) {
					self.iTextWidth = ZC._max_(self.iTextWidth, self.cwidth(aLines[i]) + self.iPaddingLeft + self.iPaddingRight);
				}
			} else {
				self.sText = '';
				self.iTextWidth = ZC._i_(self.iFontSize*1.25);
				self.iTextHeight = (self.iLineHeight==-1)?ZC._i_(self.iFontSize*1.25):self.iLineHeight;
			}
			if (ZC._n_(self.oData['width']) === null || isNaN(self.iWidth)) {
				self.iWidth = self.iTextWidth;
			}
			if (ZC._n_(self.oData['height']) === null || isNaN(self.iHeight)) {
				self.iHeight = self.iTextHeight;
			}

			self.iWidth = ZC._min_(self.iWidth, self.iMaxWidth);

			if (self.bWrapText && self.iTextWidth > self.iWidth && !self.oAttributes['wrapped']) {
				
				var sText = '', iLineWidth = 0;
				var aTokens = self.sText.split(/\s/);
				for (i=0,iLen=aTokens.length;i<iLen;i++) {
					var iTokenWidth = 1 + self.cwidth(aTokens[i] + ' ');
					iLineWidth += iTokenWidth;
					if (iLineWidth > self.iWidth*0.9) {
						if (i > 0) {
							sText += '<br>';
						}
						sText += aTokens[i] + ' ';
						iLineWidth = iTokenWidth;
					} else {
						sText += aTokens[i] + ' ';
					}
				}
				
				sText = sText.replace('<br><br>', '<br>');
				
				var sText_ = self.oData['text'];
				self.oData['text'] = sText;
				self.oAttributes['wrapped'] = true;
				self.parse();
				self.oData['text'] = sText_;
				self.oAttributes['wrapped'] = false;
			}

			
			
			if (
				(ZC._n_(self.oData['width']) === null || ZC._n_(self.oData['height']) === null)
				&&
				(
					ZC._n_(self.oData['position']) !== null || 
					ZC._n_(self.oData['margin']) !== null || 
					ZC._n_(self.oData['margin-top']) !== null || 
					ZC._n_(self.oData['margin-right']) !== null || 
					ZC._n_(self.oData['margin-bottom']) !== null || 
					ZC._n_(self.oData['margin-left']) !== null
				) 
			) {
				self.iX = -1;
				self.iY = -1;
				var iWidth_ = self.oData['width'];
				var iHeight_ = self.oData['height'];
				if (ZC._n_(iWidth_) === null) {
					self.oData['width'] = self.iWidth;
				}
				if (ZC._n_(iHeight_) === null) {
					self.oData['height'] = self.iHeight;
				}
				self.locate();
				self.oData['width'] = iWidth_;
				self.oData['height'] = iHeight_;
			}

			
			if (typeof(self.oData['html-mode']) === 'undefined' || !self.oData['html-mode']) {
				var iSpaces = Math.ceil((self.iTextWidth-self.iPaddingLeft-self.iPaddingRight)/self.iFontSize);
				if (iSpaces > 0) {
					self.sText = self.sText.replace(/<hr>/g, (new Array(iSpaces)).join('\u2014'));
				}
			}

		}

		self.setAnchor();
		
	},
	setAnchor : function() {
		var self = this;
		switch (self.sAnchor) {
			case 'tl':
				break;
			case 'tr':
				self.iX -= self.iWidth;
				break;
			case 'bl':
				self.iY -= self.iHeight;
				break;
			case 'br':
				self.iX -= self.iWidth;
				self.iY -= self.iHeight;
				break;
			case 'c':
				self.iX -= self.iWidth/2;
				self.iY -= self.iHeight/2;
				break;
			case 't':
				self.iX -= self.iWidth/2;
				break;
			case 'r':
				self.iX -= self.iWidth;
				self.iY -= self.iHeight/2;
				break;
			case 'b':
				self.iX -= self.iWidth/2;
				self.iY -= self.iHeight;
				break;
			case 'l':
				self.iY -= self.iHeight/2;
				break;
		}
	},
	paint : function() {
		var self = this, oCtx, iLineWidth, iDx_, iDy_, i, iLen, oText, sColor, oTSpan, aStyleMatches, aSpanMatches;

		var sOutput = self.oLoader.sOutput;
		oCtx = ZC.ZCHtmlUtils._context_(self.oCanvas, sOutput);
		
		if (!self.bPrint) {
			self._super();
		}

		if (self.bSkipText) {
			return;
		}

		if (self.iWidth - self.iPaddingLeft - self.iPaddingRight < 2 || self.iTextHeight - self.iPaddingTop - self.iPaddingBottom < 2) {
			return;
		}

		var sZeroAngle = (self.iAngle%360 === 0)?'0':'';
		if (self.bPrint || (zingchart.CANVASTEXT && sOutput === 'canvas')) {
			sZeroAngle = '';
		}

		
		if (ZC.vml && sOutput === 'svg' && self.sDOMClass === '') {
			self.sDOMClass = self.sId + '-class';
		}
		if (!self.bPrint && ZC._id_(self.sId)) {
			sOutput = '_';
			if (ZC.objmove) {
				ZC._id_(self.sId).style.top = (self.iY+self.iOffsetY) + 'px';
				ZC._id_(self.sId).style.left = (self.iX+self.iOffsetX) + 'px';
				return;
			}
		}
		var bHtmlMode = (typeof(self.oAttributes['html-mode']) !== 'undefined' && self.oAttributes['html-mode']);
		var aLines = [self.sText];
		if (!bHtmlMode) {
			aLines = self.sText.split(/<br>|<br\/>|<br \/>|\n/);
		}

		if (zingchart.HTMLTEXT && sOutput === 'svg' && sZeroAngle === '0') {
			sZeroAngle = '0html';
		}

		var oParent = (!self.oDOMParent)?self.oCanvas.parentNode:self.oDOMParent;
		switch (sOutput+sZeroAngle) {
			case 'canvas0':
			case 'vml0':
			case 'svg0html':
				iDy_ = 1;
				if (!bHtmlMode) {
					switch (self.sVerticalAlign) {
						case 'middle':
							iDy_ += (self.iHeight - self.iTextHeight)/2;
							break;
						case 'bottom':
							iDy_ += (self.iHeight - self.iTextHeight);
							break;
					}
				}
				oText = ZC.ZCHtmlUtils._div_({
					id : self.sId,
					cls : self.sDOMClass,
					tl : ZC._x_(self.iY+self.iOffsetY) + '/' + ZC._x_(self.iX+self.iOffsetX),
					wh : self.iWidth + '/' + self.iHeight,
					position : 'absolute',
					padding : 0,
					margin : 0,
					overflow : bHtmlMode?'visible':'hidden',
					textAlign : self.sTextAlign
				});
				if (bHtmlMode) {
					oParent.appendChild(oText);
				}
				ZC.ZCHtmlUtils._div_({
					id : self.sId + '-t',
					cls : (self.sDOMClass!==''?(self.sDOMClass + '-t'):''),
					p : oText,
					width : self.iWidth - self.iPaddingLeft - self.iPaddingRight,
					height : bHtmlMode?null:(self.iTextHeight - self.iPaddingTop - self.iPaddingBottom),
					tl : iDy_ + '/0',
					html : self.sText + '',
					position : 'absolute',
					whiteSpace : 'nowrap',
					opacity : self.fTextAlpha,
					color : self.sColor,
					fontWeight : (self.bBold?'bold':'normal'),
					fontStyle : (self.bItalic?'oblique':'normal'),
					textDecoration : self.sTextDecoration,
					fontSize : self.iFontSize,
					fontFamily : self.sFontFamily,
					marginTop : self.iPaddingTop,
					marginRight : self.iPaddingRight,
					marginBottom : self.iPaddingBottom,
					marginLeft : self.iPaddingLeft,
					verticalAlign : self.sVerticalAlign,
					textAlign : self.sTextAlign,
					lineHeight : (self.iLineHeight==-1)?'125%':(self.iLineHeight+'px'),
					rtl : self.bRTL,
					padding : 0
				});
				if (bHtmlMode) {
					
					if (self.oLoader && self.oLoader.oTooltip) {
						if (!self.oData['width'] && !self.oData['height']) {
							var oTText = ZC.ZCQuery('#' + self.sId + '-t');
							if (sOutput === 'canvas') {
								ZC._id_(self.oLoader.sId + '-tooltip-c').width = oTText.width() + self.iPaddingLeft + self.iPaddingRight;
								ZC._id_(self.oLoader.sId + '-tooltip-c').height = oTText.height() + self.iPaddingTop + self.iPaddingBottom;
							}
							self.oLoader.oTooltip.clear();
							self.iWidth = oTText.width() + self.iPaddingLeft + self.iPaddingRight;
							self.iHeight = oTText.height() + self.iPaddingTop + self.iPaddingBottom;
							self.paint();
						}
					}
				}
				break;
			case 'canvas':
				
				var bAngleFix = false;
				if (ZC.ZCQuery.browser.opera && self.iAngle%90 === 0 && self.iAngle !== 0) {
					self.iAngle += 0.5;
					bAngleFix = true;
				}
				oCtx = self.oCanvas.getContext('2d');

				if (zingchart.DEV.CACHECANVASTEXT) {
					if (!ZC.CanvasCache) {
						ZC.CanvasCache = {};
					}
				}

				if (!zingchart.DEV.CACHECANVASTEXT || (zingchart.DEV.CACHECANVASTEXT && !ZC.CanvasCache[self.sId])) {
					if (zingchart.DEV.CACHECANVASTEXT) {
						ZC.CanvasCache[self.sId] = document.createElement('canvas');
						ZC.CanvasCache[self.sId].width = self.iTextWidth;
						ZC.CanvasCache[self.sId].height = self.iTextHeight;
					}
					for (i=0,iLen=aLines.length;i<iLen;i++) {
						if (ZC._trim_(aLines[i]) !== '') {
							if (iLen === 1) {
								iLineWidth = self.iTextWidth;
							} else {
								iLineWidth = self.cwidth(aLines[i]) + self.iPaddingRight + self.iPaddingLeft;
							}
							aLines[i] = aLines[i].replace(/<.+?>/gi, '').replace(/<\/.+?>/gi, '');
							iDx_ = 0;
							iDy_ = 0;
							switch (self.sTextAlign) {
								case 'center':
									iDx_ += (self.iWidth - iLineWidth)/2;
									break;
								case 'right':
									iDx_ += (self.iWidth - iLineWidth);
									break;
							}
							switch (self.sVerticalAlign) {
								case 'middle':
									iDy_ += (self.iHeight - self.iTextHeight)/2;
									break;
								case 'bottom':
									iDy_ += (self.iHeight - self.iTextHeight);
									break;
							}

							oCtx.save();
							oCtx.globalAlpha = self.fAlpha;

							var sFont = '';
							sFont = (self.bItalic?'italic':'normal') + ' normal ' + (self.bBold?'bold':'normal') + ' ' + self.iFontSize + 'px ' + self.sFontFamily;
							
							
							
							oCtx.font = sFont;
							oCtx.fillStyle = self.sColor;
							oCtx.textAlign = 'left';
							oCtx.textBaseline = 'alphabetic';

							oCtx.translate(self.iX + self.iOffsetX, self.iY + self.iOffsetY);
							if (self.iAngle !== 0) {
								oCtx.translate(self.iWidth/2, self.iHeight/2);
								oCtx.rotate(ZC._rad_(self.iAngle));
								oCtx.translate(-self.iWidth/2, -self.iHeight/2);
							}
							oCtx.translate(self.iPaddingLeft, self.iPaddingTop + self.iFontSize);
							
							
							
							oCtx.translate(iDx_, iDy_);
							if (self.iLineHeight != -1) {
								oCtx.translate(0, ZC._x_(self.iLineHeight-1.25*self.iFontSize)/2);
							}
							oCtx.fillText(aLines[i], 0, (self.iLineHeight==-1)?(i*1.25*self.iFontSize):(i*self.iLineHeight));
							if (zingchart.DEV.CACHECANVASTEXT) {
								var oCacheCtx = ZC.CanvasCache[self.sId].getContext('2d');
								oCacheCtx.font = sFont;
								oCacheCtx.fillStyle = self.sColor;
								oCacheCtx.textAlign = 'left';
								oCacheCtx.textBaseline = 'alphabetic';
								oCacheCtx.fillText(aLines[i], self.iPaddingLeft, self.iPaddingTop + self.iFontSize+i*1.25*self.iFontSize);
							}
							
							
							oCtx.restore();

						}
					}
				} else {
					oCtx.drawImage(ZC.CanvasCache[self.sId], self.iX + self.iOffsetX, self.iY + self.iOffsetY);
				}
				if (bAngleFix) {
					self.iAngle -= 0.5;
				}
				break;
			case 'vml':
				iDy_ = 0;
				switch (self.sVerticalAlign) {
					case 'top':
						iDy_ -= (self.iHeight - self.iTextHeight)/2;
						break;
					case 'bottom':
						iDy_ += (self.iHeight - self.iTextHeight)/2;
						break;
				}

				var oLine = ZC.ZCHtmlUtils._element_('zcv:line');
				var iCx = self.iX + self.iOffsetX + self.iWidth/2;
				var iCy = self.iY + self.iOffsetY + self.iHeight/2;
				var iCOffset = ZC._cos_(self.iAngle)*(self.iWidth-self.iPaddingLeft-self.iPaddingRight)/2;
				var iSOffset = ZC._sin_(self.iAngle)*(self.iWidth-self.iPaddingLeft-self.iPaddingRight)/2;

				var x1 = ZC._i_(iCx - iCOffset - ZC._cos_(90-self.iAngle)*iDy_);
				var y1 = ZC._i_(iCy - iSOffset + ZC._sin_(90-self.iAngle)*iDy_);
				var x2 = ZC._i_(iCx + iCOffset - ZC._cos_(90-self.iAngle)*iDy_);
				var y2 = ZC._i_(iCy + iSOffset + ZC._sin_(90-self.iAngle)*iDy_);
				
				if (x1 === x2) {
					x1 -= 0.01;
					x2 += 0.01;
				}
				if (y1 === y2) {
					y1 -= 0.01;
					y2 += 0.01;
				}

				
				sColor = self.sColor;
				if (self.iAngle !== 0) {
					if (self.fAlpha < 1) {
						sColor = ZC.ZCUtils._lighten_(sColor, (1-self.fAlpha)*99);
					}
				}

				ZC.ZCHtmlUtils._attr_(oLine, {
					id : self.sId + '-line',
					from : x1 + 'px,' + y1 + 'px',
					to : x2 + 'px,' + y2 + 'px',
					fillcolor : sColor
				});
				oLine.filled = true;
				oLine.stroked = false;

				var oPath = ZC.ZCHtmlUtils._element_('zcv:path');
				oPath.setAttribute('textpathok', true);
				oLine.appendChild(oPath);

				var oTextPath = ZC.ZCHtmlUtils._element_('zcv:textpath');
				var sText = self.sText.replace(/<br>|<br\/>|<br \/>/gi, "\n").replace(/<.+?>/gi, '').replace(/<\/.+?>/gi, '');

				ZC.ZCHtmlUtils._attr_(oTextPath, {
					on : true,
					string : sText
				});

				ZC.ZCHtmlUtils._style_(oTextPath, {
					color : sColor,
					fontWeight : (self.bBold?'bold':'normal'),
					fontStyle : (self.bItalic?'oblique':'normal'),
					textDecoration : self.sTextDecoration,
					fontSize : self.iFontSize + 'px',
					fontFamily : self.sFontFamily,
					'v-text-align' : self.sTextAlign
				});

				oLine.appendChild(oTextPath);
				oCtx.appendChild(oLine);
				break;
			case 'svg':
			case 'svg0':
				var iX_ = self.iX + self.iPaddingLeft + self.iOffsetX;
				var iY_ = self.iY + self.iPaddingTop + self.iOffsetY;

				oText = ZC.ZCHtmlUtils._element_('text', 'http://www.w3.org/2000/svg');

				ZC.ZCHtmlUtils._attr_(oText, {
					x : ZC._x_(iX_),
					y : ZC._x_(iY_),
					id : self.sId,
					'class' : self.sDOMClass,
					opacity : self.fTextAlpha
				});

				if (self.bRTL) {
					ZC.ZCHtmlUtils._attr_(oText, {
						'text-anchor' : (ZC.ZCQuery.browser.msie?'':'end'),
						'writing-mode' : 'rl',
						direction : 'rtl',
						'unicode-bidi' : 'bidi-override'
					});
				}

				if (self.bClipText) {
				    self.oLoader.oSvg.appendChild(
				    	ZC.ZCHtmlUtils._svg_clip_({
				    		id : self.sId + '-clip',
				    		path : [
						    	[self.iX + self.iPaddingLeft + self.iBorderWidth + self.iOffsetX, self.iY + self.iPaddingTop + self.iBorderWidth + self.iOffsetY].join(','),
						    	[self.iX + self.iWidth - self.iPaddingRight - self.iBorderWidth + self.iOffsetX, self.iY + self.iPaddingTop + self.iBorderWidth + self.iOffsetY].join(','),
						    	[self.iX + self.iWidth - self.iPaddingRight - self.iBorderWidth + self.iOffsetX, self.iY + self.iHeight - self.iPaddingBottom - self.iBorderWidth + self.iOffsetY].join(','),
						    	[self.iX + self.iPaddingLeft + self.iBorderWidth + self.iOffsetX, self.iY + self.iHeight - self.iPaddingBottom - self.iBorderWidth + self.iOffsetY].join(','),
						    	[self.iX + self.iPaddingLeft + self.iBorderWidth + self.iOffsetX, self.iY + self.iPaddingTop + self.iBorderWidth + self.iOffsetY].join(',')
					    	].join(' ')
				    	})
			    	);
					ZC.ZCHtmlUtils._attr_(oText, {
						'clip-path' : 'url(#' + self.sId + '-clip)'
					});
				}

				if (self.iAngle%360 !== 0) {
					oText.setAttribute('transform', 'rotate(' + self.iAngle + ' ' + (iX_+(self.iWidth-self.iPaddingLeft-self.iPaddingRight)/2) + ' ' + (iY_+(self.iHeight-self.iPaddingTop-self.iPaddingBottom)/2) + ')');
				}
				if (bHtmlMode) {
					oParent.appendChild(oText);
				}
				
				for (i=0,iLen=aLines.length;i<iLen;i++) {
					if (iLen === 1) {
						iLineWidth = self.iTextWidth;
					} else {
						iLineWidth = self.cwidth(aLines[i]) + self.iPaddingRight + self.iPaddingLeft;
					}
					var sLineHtml = aLines[i];
					var sLineText = (sLineHtml.indexOf('<')===-1)?sLineHtml:(sLineHtml.replace(/<.+?>/gi, '').replace(/<\/.+?>/gi, ''));
					iDx_ = 0;
					iDy_ = self.iFontSize;
					switch (self.sTextAlign) {
						case 'center':
							iDx_ = (self.iWidth-iLineWidth)/2;
							break;
						case 'right':
							iDx_ = self.iWidth-iLineWidth;
							break;
					}
					switch (self.sVerticalAlign) {
						case 'middle':
							iDy_ += (self.iHeight - self.iTextHeight)/2;
							break;
						case 'bottom':
							iDy_ += (self.iHeight - self.iTextHeight);
							break;
					}

					if (bHtmlMode) {
						ZC.ZCHtmlUtils._remove_(self.sId + '-float');
						var oFloatText = ZC.ZCHtmlUtils._element_('div');
						ZC.ZCHtmlUtils._style_(oFloatText, {
							position : 'absolute',
							left : 0,
							top : 0,
							width : (self.iWidth-self.iPaddingLeft-self.iPaddingRight) + 'px',
							height : (self.iHeight-self.iPaddingTop-self.iPaddingBottom) + 'px',
							color : self.sColor,
							fontSize : self.iFontSize + 'px',
							fontFamily : self.sFontFamily,
							fontWeight : (self.bBold?'bold':'normal'),
							textDecoration : self.sTextDecoration,
							fontStyle : (self.bItalic?'italic':'normal')
						});
						oFloatText.id = self.sId + '-float';
						oFloatText.className = 'zc-style zc-html-mode';
						oFloatText.innerHTML = sLineHtml;
						document.body.appendChild(oFloatText);						
						
						if (self.oLoader && self.oLoader.oTooltip) {
							if (!self.oData['width'] && !self.oData['height']) {
								self.oLoader.oTooltip.clear();
								oFloatText.style.width = '';
								oFloatText.style.height = '';
								self.iWidth = ZC.ZCQuery(oFloatText).width() + self.iPaddingLeft + self.iPaddingRight;
								self.iHeight = ZC.ZCQuery(oFloatText).height() + self.iPaddingTop + self.iPaddingBottom;
								self.paint();
							}
						}
					} else {
						var iToken = 0, aMatches;
						if (sLineHtml !== sLineText) {
							while ((aMatches=(/<(.+?)>(.*?)<\/(.+?)>/.exec(sLineHtml)))) {
								var sTagStyle = '', sStyle = '';
								if ((aStyleMatches=(/(.+?)style=(.+?)(\'|")(.*?)/.exec(aMatches[1])))) {
									sStyle = aStyleMatches[2].replace(/\'|"/g, '');
								}
								
								switch (aMatches[3]) {
									case 'b':
									case 'strong':
										sTagStyle = 'font-weight:bold';
										break;
									case 'i':
									case 'em':
										sTagStyle = 'font-style:italic';
										break;
									case 'u':
										sTagStyle = 'text-decoration:underline';
										break;
								}
								var sReplace = '[[span style="' + (sTagStyle===''?'':(sTagStyle+';')) + sStyle + '"]]' + aMatches[2] + '[[/span]]';
								sLineHtml = sLineHtml.replace(aMatches[0], sReplace);
							}
							sLineHtml = sLineHtml.replace(/\[\[/g, '<').replace(/\]\]/g, '>').replace(/<span/g, '[[*]]<span').replace(/<\/span>/g, '</span>[[*]]');
							var bTokenItalic = false;
							aMatches = sLineHtml.split('[[*]]');
							for (var t=0,tLen=aMatches.length;t<tLen;t++) {
								if (aMatches[t] !== '') {
									sColor = self.sColor;
									var bBold = self.bBold, bItalic = self.bItalic, bUnderline = self.bUnderline, iFontSize = self.iFontSize, sFontFamily = self.sFontFamily;
									var sToken = aMatches[t];
									if ((aSpanMatches=(/<span style=(.+?)>(.+?)<\/(.+?)>/.exec(aMatches[t])))) {
										sToken = aSpanMatches[2];
										var aStyle = aSpanMatches[1].replace(/\'|"/g, '').split(/;|:/);
										for (var j=0,jLen=aStyle.length;j<jLen-1;j+=2) {
											switch (ZC._trim_(aStyle[j])) {
												case 'font-size':
													iFontSize = ZC._i_(ZC._trim_(aStyle[j+1]));
													break;
												case 'font-family':
													sFontFamily = ZC._trim_(aStyle[j+1]);
													break;
												case 'font-weight':
													if (ZC._indexof_(['bold', 'bolder'], ZC._trim_(aStyle[j+1])) !== -1) {
														bBold = true;
													}
													break;
												case 'font-style':
													if (ZC._indexof_(['italic', 'oblique'], ZC._trim_(aStyle[j+1])) !== -1) {
														bItalic = true;
													}
													break;
												case 'text-decoration':
													sTextDecoration = ZC._trim_(aStyle[j+1]);
													break;
												case 'color':
													sColor = ZC.ZCUtils._color_(ZC._trim_(aStyle[j+1]));
													break;
											}
										}
									}

									oTSpan = ZC.ZCHtmlUtils._element_('tspan', 'http://www.w3.org/2000/svg');
									if (iToken === 0) {
										ZC.ZCHtmlUtils._attr_(oTSpan, {
											x : ZC._x_(iX_ + iDx_),
											y : ZC._x_(iY_ + iDy_)
										});
										if (i>0) {
											ZC.ZCHtmlUtils._attr_(oTSpan, {
												
												dy : ZC._x_(i*1.25*iFontSize)
											});
										}
									} else {
										ZC.ZCHtmlUtils._attr_(oTSpan, {
											dx : (bTokenItalic||bBold||bUnderline)?2:0
										});
									}
									ZC.ZCHtmlUtils._attr_(oTSpan, {
										color : sColor,
										fill : sColor
									});
									ZC.ZCHtmlUtils._style_(oTSpan, {
										fontWeight : (bBold?'bold':'normal'),
										fontStyle : (bItalic?'oblique':'normal'),
										textDecoration : self.sTextDecoration,
										fontSize : iFontSize + 'px',
										fontFamily : sFontFamily
									});

									var oSpan = document.createElement('span');
									oSpan.innerHTML = sToken;
									sToken = oSpan.innerText || oSpan.textContent;
									oSpan = null;
									oTSpan.textContent = sToken;
									oText.appendChild(oTSpan);

									bTokenItalic = bItalic;
									iToken++;
								}
							}
						} else {

							if (self.bRTL && ZC.ZCQuery.browser.msie) {
								iDx_ += (iLineWidth-self.iPaddingLeft-self.iPaddingRight);
							}

							oTSpan = ZC.ZCHtmlUtils._element_('tspan', 'http://www.w3.org/2000/svg');
							ZC.ZCHtmlUtils._attr_(oTSpan, {
								x : ZC._x_(iX_ + iDx_),
								y : ZC._x_(iY_ + iDy_),
								color : self.sColor,
								fill : self.sColor
							});
							
								ZC.ZCHtmlUtils._attr_(oTSpan, {
									
									dy : (self.iLineHeight==-1?ZC._x_(i*1.25*self.iFontSize):ZC._x_(i*self.iLineHeight+(self.iLineHeight-1.25*self.iFontSize)/2))
								});
							

							ZC.ZCHtmlUtils._style_(oTSpan, {
								fontWeight : (self.bBold?'bold':'normal'),
								fontStyle : (self.bItalic?'oblique':'normal'),
								textDecoration : self.sTextDecoration,
								fontSize : self.iFontSize + 'px',
								fontFamily : self.sFontFamily
							});
							
							oTSpan.textContent = sLineText;
							oText.appendChild(oTSpan);
						}
					}
				}
				break;
		}

		if (!bHtmlMode) {
			if (!self.bPrint && oText) {
				if (self.oLoader.oDOMFragments) {
					var sParentClassName = ZC.ZCHtmlUtils._class_(oParent);
					if (sParentClassName.indexOf('zc-text') !== -1) {
						if (ZC._n_(self.oLoader.oDOMFragments[oParent.id]) === null) {
							self.oLoader.oDOMFragments[oParent.id] = document.createDocumentFragment();
						}
					}
					if (self.oLoader.oDOMFragments[oParent.id]) {
						self.oLoader.oDOMFragments[oParent.id].appendChild(oText);
					} else {
						oParent.appendChild(oText);
					}
				} else {
					oParent.appendChild(oText);
				}
			}
		}
	},
	paintPrintVersion : function(oPrintCanvas) {
		var self = this;
		if (!ZC.canvas || self.oLoader.sOutput !== 'canvas') {
			return;
		}
		if (!oPrintCanvas) {
			oPrintCanvas = ZC._id_(self.oLoader.sId + '-print-c');
		}
		if (zingchart.CANVASTEXT) {
			return;
		}
		if (self.iAngle%360 === 0) {
			var sText_ = self.sText;
			
			self.sText = self.sText.replace(/<br>|<br(\s*)\/>/gi, '[[[NEWLINE]]]');
			var oSpan = document.createElement('span');
			oSpan.innerHTML = self.sText;
			self.sText = oSpan.innerText || oSpan.textContent;
			oSpan = null;
			
			self.sText = self.sText.replace('[[[NEWLINE]]]', '<br>');
			self.oCanvas = oPrintCanvas;
			self.bPrint = true;
			var sOutput_ = self.oLoader.sOutput;
			self.oLoader.sOutput = 'canvas';
			self.paint();
			self.bPrint = false;
			self.sText = sText_;
			self.oLoader.sOutput = sOutput_;
		}
	}
});












ZC.ZCLoader = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sFormat = 'json';
		self.oLayers = {
			'graphset' : true,
			'graph' : true,
			'objects-bottom' : true,
			'objects-top' : true,
			'plotarea' : true,
			'plots' : true,
			'guide' : true,
			'static' : true,
			'value-box' : true
		};
		
		self.bImgGen = false;
		self.sLocale = 'en_us';
		self.oGlobals = null;
		self.sWH = '';
		self.bValidApiKey = false;
		self.oXhrCache = {};
		self.sCacheControl = 'http-headers';
		self.oFlags = {};
		self.sDataUrl = '';
		self.sData = '';
		self.oDataObj = {};
		self.oRefresh = null;
		self.aGraphs = [];
		self.sTheme = '';
		self.oTooltip = null;
		self.oZoom = null;
		self.oGuide = null;
		self.oDefaults = new ZC.ZCDefaults();
		self.sDefaultsUrl = '';
		self.oDefaultsObj = null;
		self.aCache = [null, null, null, null];
		self.bCache = false;
		self.sLayout = 'x';
		self.bFlat = false;
		self.bLicensed = false;
		self.bNoAbout = false;
		self.bBuildCode = false;
		self.bZooming = false;
		self.oCsv = {};
		self.sCsvData = null;
		self.oDataMapping = {};
		self.bFullScreen = false;
		self.bFullScreenMode = false;
		self.oLineCache = null;
		self.aRClickXY = [];
		self.oStyle = {};
		self.oCMStyle = null;
		self.oGui = null;
		self.iLoaded = 0;
		self.iInit = 0;
		self.iInitMain = 1;
		self.oStyleProgress = null;
		self.sCustomString = '';
		self.sKeyString = 'F*nStrlng4Cu$tOmLlc9nc9!';
		self.sStage = '';
		self.oEvents = {};
		self.bShowProgress = false;
		self.sOutput = '';
		self.oSvg = null;
		self.bProgressOn = false;
		self.aStructure = ['',''];
		self.iPage = 0;
		self.aFlags = [];
		self.iHSpace = 0;
		self.iVSpace = 0;
		self.bCM = false;
		self.sModules = '';
		self.bAutoLoadModules = true;
		self.oHistory = null;
		self.aHistory = [];
		self.iHistory = 0;
		self.bStrict = false;
		self.oSockets = {};
		self.bHardRefresh = false;
		self.oDOMFragments = zingchart.DEV.DOMFRAGMENTS?{}:null;
		self.bLockResize = false;
		
	},
	
	usc : function() {
		return ZC._indexof_(this.aFlags, 'use_single_canvas') !== -1;
	},
	mc : function(c) {
		c = c || '';
		return ZC._id_(this.sId + '-main-c' + (c===''?c:('-'+c)));
	},
	hideCM : function() {
		var mValue;
		if ((mValue=ZC._id_(this.sId + '-menu'))) {
			mValue.style.display = 'none';
		}
		this.bCM = false;
	},
	flushCache : function() {
		var self = this;
		var iLen = self.aCache.length;
		for (var c=0;c<iLen;c++) {
			if (ZC._n_(self.aCache[c]) !== null) {
				switch (self.sOutput) {
					case 'svg':
						ZC.ZCLine.paintSVG(self.aCache[c].ctx, self.aCache[c].style, self.aCache[c].path.join(' '), self.aCache[c].filled);
						break;
					case 'vml':
						ZC.ZCLine.paintVML(self.aCache[c].ctx, self.aCache[c].style, self.aCache[c].path.join(' '), self.aCache[c].filled);
						break;
				}
				self.aCache[c] = null;
			}
		}
	},
	checkLicense : function() {
		var self = this, i, iLen, sKey;
		
		var sHost;
		if (document.location.protocol === 'file:') {
			sHost = ZC.HOSTNAME || '';
		} else {
			sHost = document.location.hostname;
		}
		var aHosts = [sHost];
		var aTokens = sHost.split('.');
		if (aTokens[0] === 'www') {
			aHosts.push(sHost.replace('www.', ''));
		} else {
			aHosts.push('www.' + sHost);
		}
		for (i=0;i<=aTokens.length-2;i++) {
			var sWHost = '*';
			for (var j=i;j<aTokens.length;j++) {
				sWHost += '.' + aTokens[j];
			}
			aHosts.push(sWHost);
		}
		function _check_no_about_(sCode) {
			if (ZC.NOABOUT && ZC.NOABOUT instanceof Array) {
				var sNoAboutCode = ZC.ZCMD5.md5(ZC._obfuscate_(ZC._rot13_(sCode)));
				if (ZC._indexof_(ZC.NOABOUT, sNoAboutCode) !== -1) {
					self.bNoAbout = true;
				}
			}
		}
		if (ZC._indexof_(aHosts, 'localhost') !== -1 || ZC._indexof_(aHosts, '127.0.0.1') !== -1) {
			self.bLicensed = true;
			self.bBuildCode = true;
			_check_no_about_('localhost');
		} else {
			
			var aSignatures = [
				
				['jvaqbj.NP.Pber.msyntf', 'Q^fhx]XKoJJLnmLPUYiWUuQKAOGnuAIWrSN_ZIj_LYvS`jRkihLOSfysvRQTBtQOUUO^`SdgZUHWKDVQ[xST_SWRLyFKogwOclSB'],
				
				['jvaqbj.wfAbeguAvar.NccVqragvgl', '09Vczmfsf/Q5G8dRWLio+7PVG0KjUnLRqnRSPOeqf6gu/hpxK6BeHRUtuasojuRTPFQYdzNGN57nxLviTf1hV4lwaFjtbv/tA1g0W0k7AKV1g1ouow1nG/+EJLl0khmPDSKBJa8fkP70KLNtrxt5pE2yjx+IvQ40ajd/03rqqtR=']
			];
			for (i=0,iLen=aSignatures.length;i<iLen;i++) {
				try {
					if (eval(ZC._rot13_(aSignatures[i][0])) === ZC._rot13_(aSignatures[i][1])) {
						self.bLicensed = true;
						
						break;
					}
				} catch(e) {}
			}
			for (i=0,iLen=aHosts.length;i<iLen;i++) {
				var sLicenseCode = ZC.ZCMD5.md5(ZC._obfuscate_(ZC._rot13_(aHosts[i])));
				if (ZC.LICENSE instanceof Array && ZC._indexof_(ZC.LICENSE, sLicenseCode) !== -1) {
					self.bLicensed = true;
					_check_no_about_(sLicenseCode);
				}
			}
			if (ZC.BUILDCODE instanceof Array && ZC.BUILDCODE.length === 2) {
				sKey = ZC._get_key_(self.sKeyString);
				sKey = sKey.replace('O', '0');
				self.sCustomString = ZC._tea_decrypt_(ZC.BUILDCODE[0], sKey);
				if (self.sCustomString === ZC.BUILDCODE[1]) {
					self.bLicensed = true;
					self.bBuildCode = true;
					_check_no_about_(ZC.BUILDCODE[0]);
				}
			}
		}
	},
	loadDefaults : function() {
		var self = this;
		if (self.oDefaultsObj !== null) {
			ZC._todash_(self.oDefaultsObj);
			self.load();
		} else {
			if (ZC._n_(ZC.cache.data['defaults-' + self.sDefaultsUrl]) === null) {
				var sData = [
					self.sCacheControl==='query-string'?('zcrandom='+Math.random()):'',
					zingchart.ZCOUTPUT?('zcoutput=' + self.sOutput):''
				].join('&');
				ZC.ZCQuery.ajax({
					type : 'GET',
					url : self.sDefaultsUrl,
					dataType : 'text',
					beforeSend : function(oXhr) {
						if (!self.oXhrCache['defaults'] && self.sCacheControl === 'http-headers') {
							oXhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jan 1970 00:00:00 GMT');
						}
					},
					data : sData,
					error : function(oXhr, sStatus, oError, sUrl) {
						self._api_error_({name : 'Network error', message : 'Resource not found (' + sUrl + ')'}, 'URL Data loader');
						return false;
					},
					success : function(sResponse) {
						var oResponse;
						try {
							oResponse = JSON.parse(sResponse);
							ZC.cache.data['defaults-' + self.sDefaultsUrl] = sResponse;
						} catch (oError) {
							self._api_error_(oError, 'JSON parser');
							return false;
						}
						self.oDefaultsObj = oResponse;
						ZC._todash_(self.oDefaultsObj);
						self.load();
					}
				});
			} else {
				var oResponse;
				try {
					oResponse = JSON.parse(ZC.cache.data['defaults-' + self.sDefaultsUrl]);
				} catch (oError) {
					self._api_error_(oError, 'JSON parser');
					return false;
				}
				self.oDefaultsObj = oResponse;
				ZC._todash_(self.oDefaultsObj);
				self.load();
			}
		}
		
	},
	load : function(sGraphId, sUrl) {
		var self = this;
		self.sStage = 'load';
		sUrl = sUrl || self.sDataUrl;
		if (sUrl !== '') {
			if (ZC._n_(ZC.cache.data['data-' + sUrl]) === null) {
				var sData = [
					self.sCacheControl==='query-string'?('zcrandom='+Math.random()):'',
					zingchart.ZCOUTPUT?('zcoutput=' + self.sOutput):''
				].join('&');
				ZC.ZCQuery.ajax({
					type : 'GET',
					url : sUrl,
					dataType : 'text',
					beforeSend : function(oXhr) {
						if (!self.oXhrCache['data'] && self.sCacheControl === 'http-headers') {
							oXhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jan 1970 00:00:00 GMT');
						}
					},
					data : sData,
					error : function(oXhr, sStatus, oError, sUrl) {
						self._api_error_({name : 'Network error', message : 'Resource not found (' + sUrl + ')'}, 'URL Data loader');
						return false;
					},
					success : function(sResponse) {
						self.data_(sGraphId, sResponse);
					}
				});
			} else {
				self.data_(sGraphId, ZC.cache.data['data-' + sUrl]);
				ZC.cache.data['data-' + sUrl] = null;
			}
			
		} else if (self.sData !== '') {
			self.data_(sGraphId, self.sData);
		} else if (self.oDataObj !== null) {
			self.data_(sGraphId, self.oDataObj);
		}
	},
	data_ : function(sGraphId, mData) {
		var self = this;
		ZC.TS[self.sId] = (new Date()).getTime();
		if (ZC.ZCUtils._check_event_('dataload', self)) {
			ZC.ZCUtils._trigger_event_('dataload', self, self._api_loader_info_(), mData, function(mValue) {
				self.load_(sGraphId, mValue);
			});
		} else {
			self.load_(sGraphId, mData);
		}
	},
	scanScripts : function(d) {
		var self = this, i, iLen;
		if (!zingchart.DEV.RESOURCES) {
			return [];
		}
		if (!d) {
			d = self.oData;
		}
		var aScripts = [];
		
		if (d.graphset) {
			for (i=0,iLen=d.graphset.length;i<iLen;i++) {
				var sType = d.graphset[i]['type'] || 'null';
				if (ZC._indexof_(ZC.CHARTS, sType) === -1) {
					
					if (sType.substring(sType.length-2) === '3d') {
						sType = sType.substring(0, sType.length-2);
					}
					for (var k in ZC.EQUIV) {
						if (ZC.EQUIV.hasOwnProperty(k)) {
							if (ZC._indexof_(ZC.EQUIV[k], sType) !== -1) {
								sType = k;
							}
						}
					}
					zingchart.loadModules(sType);
					aScripts.push(sType);
				}
			}
		}

		self.scanModules(d);
		for (i=0,iLen=ZC.aModules.length;i<iLen;i++) {
			if (ZC._trim_(ZC.aModules[i]) !== '' && ZC._indexof_(ZC.aLoadedModules, ZC._trim_(ZC.aModules[i])) === -1) {
				aScripts.push(ZC._trim_(ZC.aModules[i]));
			}
		}

		
		return aScripts;
	},
	scanModules : function(d) {
		var self = this, mValue, mValue_, i, iLen, j, jLen;
		if (!d) {
			d = self.oData;
		}
		
		
	},
	load_ : function(sGraphId, mResponse) {
		var self = this, mValue;

		self.oAttributes['rawsource'] = mResponse;

		
		

		var oResponse = null;
		if (typeof(mResponse) === 'string') {
			try {
				oResponse = JSON.parse(mResponse);
			} catch (oError) {
				try {
					oResponse = eval('(' + mResponse + ')');
				} catch (oError) {
					self._api_error_(oError, 'JSON parser');
					return false;
				}
			}
		} else {
			oResponse = mResponse;
		}

		
		if (ZC._n_(oResponse['graphset']) === null) {
			oResponse = {'graphset' : [oResponse]};
		}

		self.oAttributes['source'] = 'N/A';
		if (zingchart.DEV.KEEPSOURCE) {
			self.oAttributes['source'] = ZC._trim_(JSON.stringify(oResponse));
		}

		zingchart.loadScripts(self, self.scanScripts(oResponse), function() {

			oResponse = ZC.ZCUtils._trigger_event_('dataparse', self, self._api_loader_info_(), oResponse);

			zingchart.loadScripts(self, self.scanScripts(oResponse), function() {
				ZC.ZCUtils._trigger_event_('modulesready', self, {id : self.sId});
				if (ZC._n_(sGraphId) === null) {
					self.lookupShapes(oResponse);
					self.oData = oResponse;
					if (self.bImgGen) {
						self.parse();
						self.paint();
					} else {
						self.loadResources(function() {
							
							
							
							self.parse();
							
							
							self.paint();
							
						});
					}
				} else {
					var oGraph = self.findGraph(sGraphId);
					if (oGraph !== null && ZC._n_(mValue=oResponse['graphset']) !== null) {
						var oGraphData = (mValue.length > 1)?mValue[oGraph.iIndex]:mValue[0];
						
						if (!oGraphData['id']) {
							oGraphData['id'] = oGraph.oData['id'] || '';
						}
						self.oData['graphset'][oGraph.iIndex] = oGraphData;
						self.loadResources(function() {
							self.parse(sGraphId);
							self.aGraphs[oGraph.iIndex].paint();
						});
					}
				}
			});
		});
	},
	lookupShapes : function(oResponse) {
		var self = this, mValue, i, iLen, j, jLen;
		

		if (ZC._n_(oResponse['graphset']) === null) {
			oResponse = {'graphset' : [oResponse]};
		}

		
		if (oResponse['graphset'].length === 1 && ZC._n_(oResponse['graphset'][0]) === null) {
			oResponse['graphset'] = [{type:'null'}];
		}

		for (i=0,iLen=oResponse['graphset'].length;i<iLen;i++) {
			if (ZC._n_(oResponse['graphset'][i]) !== null) {
				if (ZC._n_(mValue=oResponse['graphset'][i]['shapes']) !== null) {
					var aShapes = [];
					for (j=0,jLen=mValue.length;j<jLen;j++) {
						aShapes.push(mValue[j]);
						if (ZC._n_(mValue[j]['type']) !== null && mValue[j]['type'].indexOf('zingchart.') === 0) {
							try {
								var oOptions = mValue[j]['options'] || {};
								var sCall = mValue[j]['type'] + '.' + (oOptions['name'] || '');
								oOptions['graphid'] = i;
								var oShapes = eval(sCall).call(self, oOptions, oResponse, mValue[j]);
								for (var sShapeId in oShapes) {
									if (oShapes.hasOwnProperty(sShapeId)) {
										aShapes.push(oShapes[sShapeId]);
									}
								}
							} catch (e) {
							}
						}
					}
					oResponse['graphset'][i]['shapes'] = aShapes;
				}

				var aWidgets;
				if (ZC._n_(aWidgets=oResponse['graphset'][i]['widgets']) !== null) {
					var oGraphInfo = self.getEarlyGraphInfo(oResponse, i);
					for (var k=0;k<aWidgets.length;k++) {
						var oWidget = aWidgets[k];
						if (ZC._n_(oWidget['type']) !== null && ZC._n_(zingchart.widgets[oWidget['type']]) !== null && typeof(zingchart.widgets[oWidget['type']]['parse']) === 'function') {
							try {
								var oInfo = {};
								ZC._cp_(oWidget, oInfo);
								oInfo['graph'] = oGraphInfo['graph'];
								oInfo['loader'] = {
									id : self.sId,
									width : self.iWidth,
									height : self.iHeight
								};
								var oData = zingchart.widgets[oWidget['type']]['parse'].call(self, oInfo);

								if (ZC._n_(mValue=oData['graphs']) !== null) {
									for (j=0;j<mValue.length;j++) {
										oResponse['graphset'].push({});
										ZC._cp_(mValue[j], oResponse['graphset'][oResponse['graphset'].length-1]);
									}
								}
								if (ZC._n_(mValue=oData['labels']) !== null) {
									if (ZC._n_(oResponse['graphset'][i]['labels']) === null) {
										oResponse['graphset'][i]['labels'] = [];
									}
									for (j=0;j<mValue.length;j++) {
										oResponse['graphset'][i]['labels'].push(mValue[j]);
									}
								}
								if (ZC._n_(mValue=oData['shapes']) !== null) {
									if (ZC._n_(oResponse['graphset'][i]['shapes']) === null) {
										oResponse['graphset'][i]['shapes'] = [];
									}
									for (j=0;j<mValue.length;j++) {
										oResponse['graphset'][i]['shapes'].push(mValue[j]);
									}
								}
							} catch (e) {
							}
						}
					}
				}
			}
		}
	},
	createGraph : function(sType, iIndex) {
		var self = this;
		switch (sType) {
			case 'line':
				return new ZC.ZCLineGraph(self);
			case 'area':
				return new ZC.ZCAreaGraph(self);
			case 'vline':
				return new ZC.ZCVLineGraph(self);
			case 'varea':
				return new ZC.ZCVAreaGraph(self);
			case 'bar':
			case 'vbar':
				return new ZC.ZCVBarGraph(self);
			case 'hbar':
				return new ZC.ZCHBarGraph(self);
			case 'mixed':
			case 'hmixed':
			case 'mixed3d':
				
				var b3D = false;
				var aSeries = self.oData['graphset'][iIndex]['series'];
				for (var i=0,iLen=aSeries.length;i<iLen;i++) {
					if (aSeries[i] && aSeries[i]['type'] && aSeries[i]['type'].indexOf('3d') !== -1) {
						b3D = true;
					}
				}
				if (b3D) {
					return new ZC.ZCMixed3DGraph(self);
				} else {
					return (sType==='mixed')?(new ZC.ZCMixedGraph(self)):(new ZC.ZCHMixedGraph(self));
				}
				break;
			case 'scatter':
				return new ZC.ZCScatterGraph(self);
			case 'hscatter':
				return new ZC.ZCHScatterGraph(self);
			case 'bubble':
				return new ZC.ZCBubbleGraph(self);
			case 'hbubble':
				return new ZC.ZCHBubbleGraph(self);
			case 'ring':
				return new ZC.ZCPieGraph(self);
			case 'pie':
				return new ZC.ZCPieGraph(self);
			case 'nestedpie':
				return new ZC.ZCNestedPieGraph(self);
			case 'radar':
				return new ZC.ZCRadarGraph(self);
			case 'venn':
				return new ZC.ZCVennGraph(self);
			case 'bullet':
			case 'vbullet':
				return new ZC.ZCVBulletGraph(self);
			case 'hbullet':
				return new ZC.ZCHBulletGraph(self);
			case 'funnel':
			case 'vfunnel':
				return new ZC.ZCVFunnelGraph(self);
			case 'hfunnel':
				return new ZC.ZCHFunnelGraph(self);
			case 'piano':
				return new ZC.ZCPianoGraph(self);
			case 'stock':
				return new ZC.ZCStockGraph(self);
			case 'range':
				return new ZC.ZCRangeGraph(self);
			case 'gauge':
				return new ZC.ZCGaugeGraph(self);
			case 'line3d':
				return new ZC.ZCLine3DGraph(self);
			case 'area3d':
				return new ZC.ZCArea3DGraph(self);
			case 'ring3d':
				return new ZC.ZCPie3DGraph(self);
			case 'pie3d':
				return new ZC.ZCPie3DGraph(self);
			case 'bar3d':
			case 'vbar3d':
				return new ZC.ZCVBar3DGraph(self);
			case 'hbar3d':
				return new ZC.ZCHBar3DGraph(self);
			case 'null3d':
				return new ZC.ZCNull3DGraph(self);
			
			default:
				return new ZC.ZCNullGraph(self);
		}
	},
	findGraph : function(sGraphId) {
		var self = this;
		for (var i=0,iLen=self.aGraphs.length;i<iLen;i++) {
			if (self.aGraphs[i].sId === self.sId + '-graph-' + sGraphId || self.aGraphs[i].sId === self.sId + '-graph-id' + sGraphId || self.aGraphs[i].sId === sGraphId || i === sGraphId) {
				return self.aGraphs[i];
			}
		}
		return null;
	},
	detectGraph : function(iX, iY) {
		var self = this;
		var oRef = ZC.ZCQuery('#' + self.sId + ((self.sOutput === 'svg')?'-top':'-main'));
		iX -= oRef.offset().left;
		iY -= oRef.offset().top;
		var oGraph = null;
		for (var i=0,iLen=self.aGraphs.length;i<iLen;i++) {
			if (ZC._btw_(iX, self.aGraphs[i].iX, self.aGraphs[i].iX+self.aGraphs[i].iWidth) && ZC._btw_(iY, self.aGraphs[i].iY, self.aGraphs[i].iY+self.aGraphs[i].iHeight)) {
				oGraph = self.aGraphs[i];
			}
		}
		return oGraph;
	},
	setupThemes : function(bDefaultOnly) {
		var self = this, mValue;
		if (typeof(self.oAttributes['themesloaded']) !== 'undefined') {
			return;
		}
		if (typeof(bDefaultOnly) === 'undefined') {
			bDefaultOnly = false;
		}
		self.assign_a([
			['theme', 'sTheme']
		]);

		
		if (self.oData['graphset'] && self.oData['graphset'].length === 1) {
			if (ZC._n_(mValue=self.oData['graphset'][0]['theme']) !== null) {
				self.sTheme = mValue;
			}
		}

		if (self.sTheme === '') { self.sTheme = 'zingchart'; }
		var aThemes = String(self.sTheme).split(/\s+|;|,/);
		for (var i=0,iLen=aThemes.length;i<iLen;i++) {
			self.oDefaults.loadTheme(aThemes[i]);
		}
		self.oDefaults.loadDefaults(self.oDefaultsObj);
		if (ZC.mobile) {
			self.oDefaults.loadTheme('mobile');
		}
		if (!bDefaultOnly) {
			self.oAttributes['themesloaded'] = true;
		}
	},
	parse : function(sGraphId) {
		var self = this, mValue, oDataGraph, sRule, i, iLen;

		self.oAttributes['json'] = ZC._trim_(JSON.stringify(self.oData));

		ZC._cp_(self.oData['layers'], self.oLayers);
		if (self.oData['graphset'].length === 1) {
			ZC._cp_(self.oData['graphset'][0]['layers'], self.oLayers);
		}

		var oInfo = self._api_loader_info_();
		if (ZC._n_(sGraphId) !== null) {
			oInfo['graphid'] = sGraphId;
		}
		ZC.ZCUtils._trigger_event_('dataready', self, oInfo);

		self.sStage = 'parse';

		self.aStructure[1] = self.aStructure[0];
		self.aStructure[0] = '';
		self.aStructure[0] += self.iWidth + ':' + self.iHeight + ':';
		if (ZC._n_(mValue=self.oData['graphset']) !== null) {
			self.aStructure[0] += mValue.length + ':';
			for (i=0;i<mValue.length;i++) {
				self.aStructure[0] += (mValue[i]['type'] || '') + ':';
				self.aStructure[0] += (mValue[i]['x']||'') + ':' + (mValue[i]['y']||'') + ':' + (mValue[i]['width']||'') + ':' + (mValue[i]['height']||'') + ':';
				if (ZC._n_(mValue[i]['series']) !== null) {
					self.aStructure[0] += mValue[i]['series'].length + ':';
				}
			}
		}

		
		if (ZC._id_(self.sId + '-main-c')) {
			self.clear(sGraphId, false);
			
		}

		if (typeof(ZC.ZCZoom) !== 'undefined') {
			self.oZoom = new ZC.ZCZoom(self);
		}

		if (ZC._n_(sGraphId) === null) {

			self.setupThemes();

			var bGui = self.oData['gui']?true:false;
			self.oDefaults.load(self.oData, 'loader', false, true);

			self.assign_a([
				['gui', 'oGui'],
				['globals', 'oGlobals']
			]);

			
			if (self.oData['graphset'] && self.oData['graphset'].length === 1) {
				oDataGraph = self.oData['graphset'][0];
				if (ZC._n_(mValue=oDataGraph['gui']) !== null) {
					self.oGui = mValue;
				}
				if (ZC._n_(mValue=oDataGraph['globals']) !== null) {
					self.oGlobals = mValue;
				}
			}
			ZC._todash_(self.oGlobals);

			
			
			ZC._cp_(self.oDefaults.oDefaults.root.gui, self.oGui, false, true, true);

			if (!bGui) {
				delete self.oData['gui'];
			}
			ZC._todash_(self.oGui);

			if (ZC._n_(mValue=self.oData['style']) !== null) {
				for (sRule in mValue) {
					if (sRule !== 'url') {
						self.oStyle[sRule] = mValue[sRule];
					}
				}
			}
			
			if (self.oData['graphset'] && self.oData['graphset'].length === 1) {
				oDataGraph = self.oData['graphset'][0];
				if (ZC._n_(mValue=oDataGraph['style']) !== null) {
					for (sRule in mValue) {
						if (sRule !== 'url') {
							self.oStyle[sRule] = mValue[sRule];
						}
					}
				}
			}

			ZC._todash_(self.oStyle);

			if (self.oLayers['graphset']) {
				self._super();
			}

			self.assign_a([
				['locale', 'sLocale'],
				['set-locale', 'sLocale'],
				['layout', 'sLayout'],
				['h-space', 'iHSpace', 'i'],
				['v-space', 'iVSpace', 'i'],
				['flat', 'bFlat', 'b'],
				['show-progress', 'bShowProgress', 'b']
			]);

			
			if (self.oData['graphset'] && self.oData['graphset'].length === 1) {
				oDataGraph = self.oData['graphset'][0];
				if (ZC._n_(mValue=oDataGraph['locale']) !== null) {
					self.sLocale = mValue;
				}
				if (ZC._n_(mValue=oDataGraph['set-locale']) !== null) {
					self.sLocale = mValue;
				}
				if (ZC._n_(mValue=oDataGraph['flat']) !== null) {
					self.bFlat = ZC._b_(mValue);
				}
				if (ZC._n_(mValue=oDataGraph['show-progress']) !== null) {
					self.bShowProgress = ZC._b_(mValue);
				}
			}

			
			if (ZC._n_(mValue=zingchart.i18n[self.sLocale]) !== null) {
				ZC.ZCLabels = mValue;
			}

			self.aGraphs = [];
		}

		
		var iLX = 0, iLY = 0, iLW = self.iWidth, iLH = self.iHeight;
		if (ZC._n_(self.oData['margin']) !== null || ZC._n_(self.oData['margin-top']) !== null || ZC._n_(self.oData['margin-right']) !== null || ZC._n_(self.oData['margin-bottom']) !== null || ZC._n_(self.oData['margin-left']) !== null) {
			var oM = new ZC.ZCBox(self);
			oM.append(self.oData, false, false);
			oM.parse();
			iLX = oM.iMarginLeft;
			iLY = oM.iMarginTop;
			iLW = iLW - oM.iMarginLeft - oM.iMarginRight;
			iLH = iLH - oM.iMarginTop - oM.iMarginBottom;
		}

		var oGraph = self.findGraph(sGraphId), aGraphSet, iGraphPage;
		if (ZC._n_(aGraphSet=self.oData['graphset']) !== null) {
			
			var iGraphs = 0;
			for (i=0,iLen=aGraphSet.length;i<iLen;i++) {
				iGraphPage = 0;
				if (ZC._n_(mValue=aGraphSet[i]['page']) !== null) {
					iGraphPage = ZC._i_(mValue);
				}
				iGraphs += (self.iPage === iGraphPage)?1:0;
			}

			var aLayoutInfo = ZC.ZCMath._layout_(self.sLayout, iGraphs);
			var iRows = ZC._i_(aLayoutInfo[0]);
			var iCols = ZC._i_(aLayoutInfo[1]);
			var iCol = 0;
			var iRow = 0;
			var ii = 0;
			for (i=0,iLen=aGraphSet.length;i<iLen;i++) {
				iGraphPage = 0;
				if (oGraph === null) {
					if (ZC._n_(mValue=aGraphSet[i]['page']) !== null) {
						iGraphPage = ZC._i_(mValue);
					}
				}
				if ((oGraph === null || ii === oGraph.iIndex) && self.iPage === iGraphPage) {
					self.aGraphs[ii] = self.createGraph(aGraphSet[i]['type'] || 'null', i);
					self.aGraphs[ii].sTag = self.aGraphs[ii].sType + 'graph';
					self.oDefaults.load(self.aGraphs[ii].oData, 'graph');
					self.oDefaults.load(self.aGraphs[ii].oData, aGraphSet[i]['type'] || 'null');
					self.aGraphs[ii].append(aGraphSet[i]);
					self.aGraphs[ii].iIndex = ii;
					if (ZC._n_(aGraphSet[ii]['id']) === null) {
						self.aGraphs[ii].sId = self.sId + '-graph-id' + ii;
					} else {
						self.aGraphs[ii].sId = self.sId + '-graph-' + aGraphSet[i]['id'];
					}
					if (aGraphSet.length > 0) {
						var iDiffX = 0, iDiffY = 0;
						var iGWidth = ZC._i_((iLW - (iCols+1)*self.iHSpace)/iCols);
						var iGHeight = ZC._i_((iLH - (iRows+1)*self.iVSpace)/iRows);
						if (ZC._n_(self.aGraphs[ii].oData['x']) === null) {
							self.aGraphs[ii].oData['x'] = ZC._i_(self.iX + (iCol+1)*self.iHSpace + iCol*iGWidth) + iLX;
						} else {
							iDiffX = ZC._dimension_(self.aGraphs[ii].oData['x']);
							if (iDiffX < 1) {
								iDiffX = ZC._i_(self.iWidth*iDiffX);
							}
						}
						if (ZC._n_(self.aGraphs[ii].oData['y']) === null) {
							self.aGraphs[ii].oData['y'] = ZC._i_(self.iY + (iRow+1)*self.iVSpace + iRow*iGHeight) + iLY;
						} else {
							iDiffY = ZC._dimension_(self.aGraphs[ii].oData['y']);
							if (iDiffY < 1) {
								iDiffY = ZC._i_(self.iHeight*iDiffY);
							}
						}
						if (ZC._n_(self.aGraphs[ii].oData['width']) === null) {
							self.aGraphs[ii].oData['width'] = iGWidth - iDiffX;
						}
						if (ZC._n_(self.aGraphs[ii].oData['height']) === null) {
							self.aGraphs[ii].oData['height'] = iGHeight - iDiffY;
						}
					}
					
					self.aGraphs[ii].parse();
					
				}

				if (self.iPage === iGraphPage) {
					ii++;
					iCol++;
					if (iCol === iCols) {
						iRow++;
						iCol = 0;
					}
				}

			}
		}

		if (ZC._n_(sGraphId) === null) {
			if (ZC._n_(mValue=self.oData['refresh']) !== null) {
				self.oRefresh = {
					type : 'full',
					interval : 10
				};
				ZC._cp_(mValue, self.oRefresh);
			}
		}

	},
	getResources : function(oData, sParent) {
		sParent = sParent || '';
		var aResources = [];
		for (var p in oData) {
			if (typeof(oData[p]) === 'object') {
				var aResources_ = this.getResources(oData[p], sParent + '.' + p);
				for (var i=0,iLen=aResources_.length;i<iLen;i++) {
					if (ZC._indexof_(aResources, aResources_[i]) === -1) {
						aResources.push(aResources_[i]);
					}
				}
			} else {
				var sPath = sParent + '.' + p;
				if (('background-image' === p || 'backgroundImage' === p) && oData[p] !== '' && oData[p].substring(0, 3) !== 'zc.') {
					
					if (!ZC.ie67 && ZC.PATTERNS) {
						if (oData[p].substring(0, 8) === 'PATTERN_') {
							oData[p] = ZC.PATTERNS[oData[p].substring(8)];
						}
					}
					aResources.push([oData[p], 'image']);
				}
				if ('src' === p && oData[p] !== '' && oData[p].substring(0, 3) !== 'zc.') {
					if (sPath.indexOf('.images.') !== -1) {
						
						if (!ZC.ie67 && ZC.PATTERNS) {
							if (oData[p].substring(0, 8) === 'PATTERN_') {
								oData[p] = ZC.PATTERNS[oData[p].substring(8)];
							}
						}
						aResources.push([oData[p], 'image']);
					}
				}
				if (sPath.substr(sPath.length-4, 4) === '.csv' && typeof(oData[p]) === 'string') {
					aResources.push([oData[p], 'csv']);
				}
				if ('url' === p) {
					if (sPath.indexOf('.style.') !== -1) {
						aResources.push([oData[p], 'css']);
					}
					if (sPath.indexOf('.csv.') !== -1) {
						aResources.push([oData[p], 'csv']);
					}
					if (sPath.indexOf('.marker.') !== -1) {
						aResources.push([oData[p], 'image']);
					}
				}
				if (typeof(oData[p]) === 'string' && p !== 'url' && ((oData[p].indexOf('url:') === 0 && p === 'values') || oData[p].indexOf('javascript:') === 0)) {
					
					if (ZC._indexof_(['format', 'text', 'tooltipText'], ZC._camelcase_(p)) === -1) {
						aResources.push([oData[p], 'data']);
					}
				}
			}
		}
		return aResources;
	},
	loadResources : function(oCallback) {
		var self = this;
		if (!zingchart.DEV.RESOURCES) {
			oCallback();
			return;
		}
		var aResources = self.getResources(self.oData).concat(self.getResources(self.oDefaultsObj));
		if (aResources.length === 0) {
			oCallback();
			return;
		}
		var iLoaded = 0;
		var aImages = {};
		
		var iIdxResource = 0;
		function _loadresource(i) {
			if (i >= aResources.length) {
				return;
			}
			var sData, aTmp;
			var sResourceUrl = aResources[i][0];
			var sResourceType = aResources[i][1];
			if (sResourceUrl.substring(0, 4) === 'url:') {
				var sDataUrl = sResourceUrl.substring(4);
				self.oDataMapping['url:'+sDataUrl] = '[]';
				try {
					sData = [
						self.sCacheControl==='query-string'?('zcrandom='+Math.random()):''
					].join('&');
					ZC.ZCQuery.ajax({
						type : 'GET',
						url : sDataUrl,
						beforeSend : function(oXhr) {
							if (!self.oXhrCache['data'] && self.sCacheControl === 'http-headers') {
								oXhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jan 1970 00:00:00 GMT');
							}
						},
						data : sData,
						error : function(oXhr, sStatus, oError, sUrl) {
							self._api_error_({name : 'Network error', message : 'Resource not found (' + sUrl + ')'}, 'URL Data loader');
							return false;
						},
						success : function(sResponse, sStatus, oXhr, sUrl) {
							self.oDataMapping['url:'+sUrl] = sResponse;
							iLoaded++;
						}
					});
				} catch(oError) {
					self._api_error_(oError, 'URL Data loader');
					return false;
				}
				
			} else if (sResourceUrl.substring(0, 11) === 'javascript:') {
				self.oDataMapping[sResourceUrl] = '[]';
				var aInfo = ZC.ZCUtils._function_(sResourceUrl.substring(11));
				var oParams = {
					id : self.sId,
					resource : sResourceUrl,
					callback : function(oReturn) {
						self.oDataMapping[sResourceUrl] = oReturn;
						iLoaded++;
					}
				};
				var sFunction = aInfo[0];
				oParams['arguments'] = aInfo[1];
				try {
					var oReturn = eval(sFunction).call(self, oParams);
					if (ZC._n_(oReturn) !== null && oReturn) {
						self.oDataMapping[sResourceUrl] = oReturn;
						iLoaded++;
					}
				} catch (oError) {
					self._api_error_(oError, 'JavaScript data loader');
					return false;
				}
			} else if (sResourceType === 'image') {
				aImages[sResourceUrl] = new Image();
				aImages[sResourceUrl].onload = function() {
					iLoaded++;
				};
				aImages[sResourceUrl].onerror = function() {
					var bStrict = ZC._b_(self.oData['strict']);
					ZC.IMG404.push(sResourceUrl);
					if (bStrict) {
						self._api_error_({name : 'Network error', message : 'Resource not found (' + this.src + ')'}, 'Resource loader (image)');
						return false;
					} else {
						this.src = ZC.BLANK;
					}
					iLoaded++;
				};
				aImages[sResourceUrl].src = sResourceUrl;
				ZC.cache.data[sResourceUrl] = aImages[sResourceUrl];
				
				
			} else if (sResourceType === 'css') {
				sData = [
					self.sCacheControl==='query-string'?('zcrandom='+Math.random()):''
				].join('&');
				ZC.ZCQuery.ajax({
					type : 'GET',
					url : sResourceUrl,
					beforeSend : function(oXhr) {
						if (!self.oXhrCache['css'] && self.sCacheControl === 'http-headers') {
							oXhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jan 1970 00:00:00 GMT');
						}
					},
					data : sData,
					error : function(oXhr, sStatus, oError) {
						self._api_error_(oError, 'Resource loader');
						return false;
					},
					success : function(sResponse) {
						var oCss = {};
						var aClasses = sResponse.match(/[a-zA-Z0-9\.\#\-](.+?)\{((.|\s)+?)\}/gi);
						for (var i=0,iLen=aClasses.length;i<iLen;i++) {
							aTmp = aClasses[i].split('{');
							var sClass = ZC._trim_(aTmp[0]);
							
							var aTmp2 = sClass.split(/\s+/);
							if (aTmp2.length === 1 || (aTmp2.length === 2 && ZC._trim_(aTmp2[0]) === ('#' + self.sId))) {
								sClass = ZC._trim_((aTmp2.length === 1)?aTmp2[0]:aTmp2[1]);
								if (!oCss[sClass]) {
									oCss[sClass] = {};
								}
								aTmp = aTmp[1].replace('}', '').split(';');
								for (var j=0,jLen=aTmp.length;j<jLen;j++) {
									var aDef = aTmp[j].split(':');
									if (aDef.length === 2) {
										oCss[sClass][ZC._trim_(aDef[0])] = '' + ZC._trim_(aDef[1]);
									}
								}
							}
						}
						if (ZC._n_(self.oData['style']) !== null) {
							ZC._cp_(oCss, self.oData['style']);
						} else if (ZC._n_(self.oData['graphset']) !== null && self.oData['graphset'].length === 1 && self.oData['graphset'][0]['style']) {
							ZC._cp_(oCss, self.oData['graphset'][0]['style']);
						}
						iLoaded++;
					}
				});
				
			} else if (sResourceType === 'csv') {
				sData = [
					self.sCacheControl==='query-string'?('zcrandom='+Math.random()):''
				].join('&');
				ZC.ZCQuery.ajax({
					type : 'GET',
					url : sResourceUrl,
					beforeSend : function(oXhr) {
						if (!self.oXhrCache['csv'] && self.sCacheControl === 'http-headers') {
							oXhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jan 1970 00:00:00 GMT');
						}
					},
					data : sData,
					error : function(oXhr, sStatus, oError) {
						self._api_error_(oError, 'Resource loader');
						return false;
					},
					success : function(sResponse, sStatus, oXhr, sUrl) {
						self.oCsv[sUrl] = sResponse;
						iLoaded++;
					}
				});
				
			}
		}
		var iTick = window.setInterval(function() {
			if (iLoaded >= aResources.length) {
				window.clearInterval(iTick);
				self.mapData(self.oData);
				oCallback();
			} else {
				iIdxResource++;
				_loadresource(iIdxResource);
			}
		}, 20);
		_loadresource(iIdxResource);
	},
	mapData : function(oObject) {
		var self = this;
		for (var p in oObject) {
			if (typeof(oObject[p]) === 'object') {
				self.mapData(oObject[p]);
			} else {
				for (var sData in self.oDataMapping) {
					if (sData === oObject[p]) {
						oObject[p] = eval(self.oDataMapping[sData]);
					}
				}
			}
		}
	},
	resize : function(bScale) {
		var self = this, mValue, i, iLen;
		if (!self.oData['graphset']) {
			return;
		}
		if (self.bHardRefresh) {
			zingchart.exec(self.sId, 'destroy');
			zingchart.render(zingchart.params[self.sId]);
		} else {
			if (typeof(bScale) === 'undefined') {
				bScale = false;
			}
			ZC.ZCUtils._trigger_event_('resize', self, self._api_loader_info_());
			
			bScale = false;
			if (bScale) {
				
			} else {

				
				var oGS = self.oData['graphset'], aCollections = ['labels', 'shapes'];
				for (var c=0,cLen=oGS.length;c<cLen;c++) {
					for (var k=0;k<aCollections.length;k++) {
						var sCollection = aCollections[k];
						var aItems = [];
						if (ZC._n_(oGS[c][sCollection]) !== null) {
							for (i=0,iLen=oGS[c][sCollection].length;i<iLen;i++) {
								if (!oGS[c][sCollection][i]['generated']) {
									aItems.push(oGS[c][sCollection][i]);
								}
							}
							oGS[c][sCollection] = aItems;
						}
					}
				}

				self.lookupShapes(self.oData);

				self.oData = ZC.ZCUtils._trigger_event_('dataparse', self, self._api_loader_info_(), self.oData);

				ZC.ZCQuery('#' + self.sId + '-top').width(self.iWidth).height(self.iHeight);
				if ((mValue=ZC.ZCQuery('#' + self.sId + '-img')).length === 1) {
					mValue.width(self.iWidth).height(self.iHeight).css('clip', 'rect(1px,' + (self.iWidth-1) + 'px,' + (self.iHeight-1) + 'px,1px)');
				}
				if (self.sOutput === 'svg') {
					self.oSvg.setAttribute('width', self.iWidth);
					self.oSvg.setAttribute('height', self.iHeight);
				}
				if (self.sOutput === 'canvas' || self.sOutput === 'vml') {
					ZC.ZCQuery('#' + self.sId + '-main').width(self.iWidth).height(self.iHeight);
					for (i=0,iLen=self.aGraphs.length;i<iLen;i++) {
						ZC.ZCQuery('#' + self.aGraphs[i].sId + '-hover').remove();
					}
					ZC.ZCQuery('#' + self.sId + '-main>div').width(self.iWidth).height(self.iHeight);
				}
				if (self.sOutput === 'canvas') {
					if ((mValue=ZC._id_(self.sId + '-main-c'))) {
						mValue.width = self.iWidth;
						mValue.height = self.iHeight;
					}
					if ((mValue=ZC._id_(self.sId + '-main-c-top'))) {
						mValue.width = self.iWidth;
						mValue.height = self.iHeight;
					}
					ZC.ZCQuery('#' + self.sId + '-objects-bottom canvas, #' + self.sId + '-objects-top canvas, #' + self.sId + '-tools canvas').each(function() {
						this.width = self.iWidth;
						this.height = self.iHeight;
					});
				}
				if (self.sOutput === 'vml') {
					ZC.ZCQuery('#' + self.sId + '-objects-bottom div, #' + self.sId + '-objects-top div, #' + self.sId + '-tools div').each(function() {
						this.style.width = self.iWidth + 'px';
						this.style.height = self.iHeight + 'px';
					});
				}
				self.parse();

				for (i=0,iLen=self.aGraphs.length;i<iLen;i++) {
					self.aGraphs[i].syncScalesOnFeed();
				}

				self.paint();
			}
		}
	},
	clearGenerated : function() {
		var self = this;
		var oGS = self.oData['graphset'], aCollections = ['labels', 'shapes'];
		if (oGS) {
			for (var c=0,cLen=oGS.length;c<cLen;c++) {
				for (var k=0;k<aCollections.length;k++) {
					var sCollection = aCollections[k];
					var aItems = [];
					if (ZC._n_(oGS[c][sCollection]) !== null) {
						for (var i=0,iLen=oGS[c][sCollection].length;i<iLen;i++) {
							if (!oGS[c][sCollection][i]['generated']) {
								aItems.push(oGS[c][sCollection][i]);
							}
						}
						oGS[c][sCollection] = aItems;
					}
				}
			}
		}
	},
	clear : function(sGraphId, bClearGenerated, bForceDestroy) {
		var self = this;
		if (typeof(bClearGenerated) === 'undefined') {
			bClearGenerated = true;
		}

		ZC.ZCQuery('.' + self.sId + '-history-area').die('click', self.zc_loader_history);
		ZC.ZCQuery('.' + self.sId + '-history-area').remove();
		if (ZC._n_(sGraphId) !== null) {
			self.findGraph(sGraphId).clear();
		} else {
			if (bClearGenerated) {
				
				self.clearGenerated();
			}

			self._unbind_();
			for (var i=0,iLen=self.aGraphs.length;i<iLen;i++) {
				if (self.sOutput === 'vml' && bForceDestroy) {
					self.aGraphs[i].destroy();
				} else {
					self.aGraphs[i].clear();
				}
			}

			var oMainC, oTriggerC, oMainCTop;
			if ((oMainC = ZC._id_(self.sId + '-main-c')) !== null) {
				ZC.ZCHtmlUtils._clear_(oMainC, self.sOutput, self.iX, self.iY, self.iWidth, self.iHeight);
			}
			
			if ((oMainCTop = ZC._id_(self.sId + '-main-c-top')) !== null) {
				ZC.ZCHtmlUtils._clear_(oMainCTop, self.sOutput, self.iX, self.iY, self.iWidth, self.iHeight);
			}
			if ((oTriggerC = ZC._id_(self.sId + '-trigger-c')) !== null) {
				ZC.ZCHtmlUtils._clear_(oTriggerC, self.sOutput, self.iX, self.iY, self.iWidth, self.iHeight);
				ZC.ZCQuery('#' + self.sId + '-menu-area').remove();
			}
			if (self.oTooltip) {
				self.oTooltip.hide();
			}
			ZC.ZCQuery('.' + self.sId + '-menu-item').remove();
			ZC.ZCHtmlUtils._remove_(
				[
					self.sId + '-menu-trigger',
					self.sId + '-menu',
					self.sId + '-license'
				]
			);
			
			if (self.oHistory !== null) {
				ZC.ZCHtmlUtils._remove_(
					[
						self.sId + '-history-path',
						self.sId + '-history-back-path',
						self.sId + '-history-forw-path',
						self.sId + '-history-gradient',
						self.sId + '-history-back-gradient',
						self.sId + '-history-forw-gradient'
					]
				);
			}
		}
	},
	paintMain : function() {
		var self = this;
		var sWH = self.iWidth + '/' + self.iHeight;
		var oTop = ZC.ZCHtmlUtils._div_({
			cls : 'zc-rel zc-top',
			wh : sWH,
			id : self.sId + '-top',
			overflow : 'hidden',
			p : ZC._id_(self.sId)
		});

		if (zingchart.OFFSET) {
			oTop.style.left = '-0.5px';
			oTop.style.top = '-0.5px';
		}

		switch (self.sOutput) {
			case 'svg':
				self.oSvg = ZC.ZCHtmlUtils._element_('svg', 'http://www.w3.org/2000/svg');
				if (self.oSvg.setAttributeNS) {
					self.oSvg.setAttributeNS(null, 'xlink', 'http://www.w3.org/1999/xlink');
				}
				ZC.ZCHtmlUtils._attr_(self.oSvg, {
					version : '1.1',
					id : self.sId + '-svg',
					cls : 'zc-svg',
					width : self.iWidth,
					height : self.iHeight
				});
				oTop.appendChild(self.oSvg);

				var oDefs = ZC.ZCHtmlUtils._element_('defs', 'http://www.w3.org/2000/svg');
				oDefs.id = self.sId + '-defs';
				self.oSvg.appendChild(oDefs);
				ZC.ZCHtmlUtils._group_({
					cls : 'zc-rel zc-main',
					wh : sWH,
					id : self.sId + '-main',
					p : self.oSvg
				}, self.sOutput);
				break;
			case 'vml':
				ZC.ZCHtmlUtils._div_({
					cls : 'zc-rel zc-main',
					wh : sWH,
					id : self.sId + '-main',
					p : oTop
				});
				break;
			case 'canvas':
				ZC.ZCHtmlUtils._div_({
					cls : 'zc-rel zc-main',
					wh : sWH,
					id : self.sId + '-main',
					p : oTop
				});
				break;
		}
	},
	paintHistory : function() {
	},
	paint : function() {
		var self = this, mValue;
		self.sStage = 'paint';
		var sWH = self.iWidth + '/' + self.iHeight;
		self.hideProgress();

		if (ZC._id_(self.sId + '-top') === null) {
			self.paintMain();

			var oMain = ZC._id_(self.sId + '-main');

			if (self.oLayers['graphset']) {
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs',
					id : self.sId + '-main-c',
					wh : sWH,
					p : oMain
				}, self.sOutput);
			}

			if (!self.oLoader.usc()) {

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-objects-bottom',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-graphset',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-objects-maps',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-objects-top',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-hover',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-objects-front',
					p : oMain
				}, self.sOutput);

				

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs zc-text',
					wh : sWH,
					id : self.sId + '-text',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-legend',
					p : oMain
				}, self.sOutput);

				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-tools',
					p : oMain
				}, self.sOutput);

				var oTools = ZC._id_(self.sId + '-tools');

				if (self.oLayers['static']) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer',
						id : self.sId + '-static-c',
						wh : sWH,
						p : oTools
					}, self.sOutput);
				}

				if (self.oLayers['guide']) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer' + ' zc-guide-c',
						id : self.sId + '-guide-c',
						wh : sWH,
						p : oTools
					}, self.sOutput);
				}

				if ((ZC.ZCQuery.browser.opera && ZC._i_(ZC.ZCQuery.browser.version) <= 9.5) || ZC.mobile) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer',
						id : self.sId + '-trigger-c',
						wh : sWH,
						p : oTools
					}, self.sOutput);
				}
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-print-c',
					p : oTools,
					wh : sWH,
					display : 'none'
				}, self.sOutput);
				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-text-top',
					p : oMain
				}, self.sOutput);
			} else {
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs',
					id : self.sId + '-main-c-top',
					wh : sWH,
					p : oMain
				}, self.sOutput);
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-print-c',
					p : oMain,
					wh : sWH,
					display : 'none'
				}, self.sOutput);
			}

			

			var oImg = document.createElement('img');
			oImg.id = self.sId + '-img';
			oImg.className = 'zc-img';
			oImg.setAttribute('useMap', '#' + self.sId + '-map');

			ZC.ZCHtmlUtils._style_(oImg, {
				position : 'absolute',
				borderWidth : 0,
				width : (self.iWidth+2*ZC.MAPTX) + 'px',
				height : (self.iHeight+2*ZC.MAPTX) + 'px',
				left : (-ZC.MAPTX) + 'px',
				top : (-ZC.MAPTX) + 'px',
				zIndex : 0,
				opacity : 0,
				filter : 'alpha(opacity=0)',
				clip : 'rect(' + (ZC.MAPTX+1) + 'px,' + (self.iWidth+ZC.MAPTX-1) + 'px,' + (self.iHeight+ZC.MAPTX-1) + 'px,' + (ZC.MAPTX+1) + 'px)'
			});

			oImg.src = (ZC.ie67?'//':'') + ZC.BLANK;
			ZC._id_(self.sId + '-top').appendChild(oImg);

			if (!self.oLoader.usc()) {
				var oMap = document.createElement('map');
				oMap.className = 'zc-map';
				ZC.ZCHtmlUtils._attr_(oMap, {
					id : self.sId + '-map',
					name : self.sId + '-map'
				});
				ZC._id_(self.sId + '-top').appendChild(oMap);
			}
		}

		self.oCanvas = ZC._id_(self.sId + '-main-c');
		
		
		
		self._super();
		var bGuide = false;

		

		var i, iLen;

		for (i=0,iLen=self.aGraphs.length;i<iLen;i++) {
			self.aGraphs[i].paint();
			if ((self.aGraphs[i].oCrosshairX !== null && self.aGraphs[i].oCrosshairX.bVisible) || (self.aGraphs[i].oCrosshairY !== null && self.aGraphs[i].oCrosshairY.bVisible)) {
				bGuide = true;
			}
		}

		if (self.oDOMFragments) {
			for (var sId in self.oDOMFragments) {
				ZC._id_(sId).appendChild(self.oDOMFragments[sId]);
			}
			self.oDOMFragments = null;
		}

		self.oAttributes['preservezoom'] = null;

		if (!self.bLicensed && !self.bValidApiKey) {

			var oWM = {};
			var oWM_ = self.oGui['watermark'];
			self.oDefaults.load(oWM, 'loader.gui.watermark');
			if (oWM_) {
				ZC._cp_(oWM_, oWM);
			}
			
			if (self.oData['graphset'].length === 1 && self.oData['graphset'][0]['gui'] && (mValue=self.oData['graphset'][0]['gui']['watermark'])) {
				ZC._cp_(mValue, oWM);
			}

			var iWMType = ZC._l_(ZC._i_(oWM['type'] || 1), 1, 2);
			var sWMPos = oWM['position'] || 'br';
			if (ZC._indexof_(['tl', 'tr', 'br', 'bl'], sWMPos) === -1) {
				sWMPos = 'br';
			}

			var iH_ = 32, iW_ = 146, iPT_ = 0, fO_ = 1, sT_ = '';
			if (ZC.ie67) {
				iH_ = 30;
				iW_ = 168;
				iPT_ = 8;
				fO_ = 1;
				
			}
			iW_ = 126;
			iH_ = 22;
			var sColor_ = "#036";
			
			if (self.oData['graphset'].length === 1 && self.oData['graphset'][0]['background-color']){
				sColor_ = ZC.ZCUtils._color_(self.oData['graphset'][0]['background-color']);
				if(sColor_.length == 7){
					sColor_ = ZC.ZCUtils._luminance_(sColor_, "#EEE", "#036");
				}
			}
			var sOrigin = ( (typeof window !== 'undefined') && window.location) ? window.location.origin : "";
			var sPathname = ( (typeof window !== 'undefined') && window.location) ? window.location.pathname : "";
			sT_ = '<a title="JavaScript Charts by ZingChart" style="color:' + sColor_ + ' !important;font-size:11px !important;display:block !important;opacity:1 !important;" href="http://www.zingchart.com/?origin='+sOrigin +'&pathname='+sPathname+'">Powered by ZingChart</a>';
			var iT_, iL_;
			switch (sWMPos) {
				case 'br':
					iT_ = self.iHeight - iH_;
					iL_ = self.iWidth - iW_;
					break;
				case 'bl':
					iT_ = self.iHeight - iH_;
					iL_ = 0;
					break;
				case 'tr':
					iT_ = 0;
					iL_ = self.iWidth - iW_;
					break;
				case 'tl':
					iT_ = 0;
					iL_ = 0;
					break;
			}

			if (ZC._n_(mValue=ZC._id_(self.sId + '-top')) !== null) {
				var sLicenseId = self.sId + '-license';
				if (ZC._id_(sLicenseId) === null) {
					ZC.ZCHtmlUtils._div_({
						cls : 'zc-style zc-license' + (ZC.ie67?'-ie67':''),
						id : sLicenseId,
						p : mValue,
						tl : iT_ + '/' + iL_,
						wh : iW_ + '/' + (iH_-iPT_),
						color : (ZC.ie67?(iWMType===1?'#369':'#fff'):''),
						padding : iPT_,
						opacity : fO_,
						
						html : sT_
					}, self.sOutput);
					ZC._id_(sLicenseId).style.cursor = 'pointer';
					self.zc_license_redirect = function() {
						
						window.top.location.href = 'http://www.zingchart.com/?utm_source=javascript-chart&utm_medium=javascript-chart&utm_campaign=javascript-chart';
					};
					ZC.ZCQuery('#' + sLicenseId).bind('click', self.zc_license_redirect);
				}
			}
		}

		

		if (ZC._indexof_(self.aFlags, 'skip_context_menu') === -1) {
			self.buildContextMenu();
		}

		if (ZC._indexof_(self.aFlags, 'skip_interactivity') === -1) {

			if (typeof(ZC.ZCTooltip) !== 'undefined') {
				self.oTooltip = new ZC.ZCTooltip(self);
			}

			if (typeof(ZC.ZCZoom) !== 'undefined') {
				self.oZoom.bind();
			}

			if (bGuide && typeof(ZC.ZCGuide) !== 'undefined') {
				self.oGuide = new ZC.ZCGuide(self);
				self.oGuide.bind();
			}

			if (ZC.mobile) {
				self.zc_loader_touchstart = function(ev) {
					ZC.swipe = {
						xy : ZC.ZCHtmlUtils._pagexy_(ev),
						ts : new Date().getTime()
					};
					if (ev.target.id === self.sId + '-menu-area') {
						ZC.move = false;
						if (self.oTooltip) {
							self.oTooltip.hide();
						}
						zingchart.zc_contextmenu(ev);
					} else {
						if (self.oGui !== null && ZC._n_(self.oGui['page-scroll']) !== null && !self.oGui['page-scroll']) {
							ev.preventDefault();
						}
						ZC.move = false;
						self.hideCM();
						if (self.oTooltip) {
							self.oTooltip.hide();
						}
						self.trackTouchHold(ev);
					}
				};
				self.zc_loader_kill_touchhold = function() {
					window.clearTimeout(self.iTickTouch);
					self.iTsTouch = null;
				};
				self.zc_loader_touchend = function(ev) {
					if (ZC.swipe) {
						var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
						if (ZC._a_(aPageXY[0] - ZC.swipe.xy[0]) > 100 && new Date().getTime() - ZC.swipe.ts < 1000) {
							var oInfo = self._api_loader_info_();
							oInfo['direction'] = aPageXY[0]>ZC.swipe.xy[0]?'right':'left';
							ZC.ZCUtils._trigger_event_('swipe', self, oInfo);
						}
						ZC.swipe = null;
					}
					if (!self.bCM && !ZC.move) {
						zingchart.zc_click(ev);
					}
					self.zc_loader_kill_touchhold(ev);
				};

				ZC.ZCQuery('#' + self.sId + '-img')
					.bind('touchstart', self.zc_loader_touchstart)
					.bind('touchmove', self.zc_loader_kill_touchhold)
					.bind('touchend', self.zc_loader_touchend);

				ZC.ZCQuery('#' + self.sId + '-menu-area')
					.live('touchstart', self.zc_loader_touchstart);
			}

			self.zc_loader_keyup = function(ev) {
				if (ev.keyCode === 27 && self.bFullScreenMode) {
					
					self.zc_loader_exitfullscreen();
				}
			};
			ZC.ZCQuery(document).bind('keyup', self.zc_loader_keyup);

			self.zc_loader_exitfullscreen = function(ev) {
				if (ev) {
					self.zc_loader_menu_item_click(ev);
				}
				ZC.ZCQuery('#' + self.sId + '-menu-item-exitfullscreen').die('click', self.zc_loader_exitfullscreen);
				ZC.FSSTATUS = null;
				self.destroy();
				if (zingchart.FSID && ZC._id_(zingchart.FSID)) {
					
					ZC._id_(zingchart.FSID).style.display = 'none';
				}
			};
			ZC.ZCQuery('#' + self.sId + '-menu-item-exitfullscreen').live('click', self.zc_loader_exitfullscreen);
		} else {
			if (ZC.mobile) {
				self.zc_loader_touchstart_static = function(ev) {
					ev.preventDefault();
					zingchart.zc_click(ev);
					return false;
				};
				ZC.ZCQuery('#' + self.sId + '-img').bind('touchstart', self.zc_loader_touchstart_static);
			}
		}

		if (self.oRefresh !== null) {
			var iTimeout = ZC._i_(self.oRefresh['interval']);
			iTimeout = (iTimeout>=50)?iTimeout:1000*iTimeout;
			window.setTimeout(function() {
				self.showProgress();
				self.load();
			}, iTimeout);
		}
		

		var aImages;
		

		self.sStage = '';

		

		ZC.TS[self.sId] = (new Date()).getTime() - ZC.TS[self.sId];

		if (self.oAttributes['fire-complete']) {
			ZC.ZCUtils._trigger_event_('complete', self, self._api_loader_info_());
			self.oAttributes['fire-complete'] = null;
		}
		if (self.oAttributes['fire-load']) {
			ZC.ZCUtils._trigger_event_('load', self, self._api_loader_info_());
			self.oAttributes['fire-load'] = null;
		}

	},
	
	_unbind_ : function() {
		var self = this;

		if (self.zc_license_redirect) {
			ZC.ZCQuery('#' + self.sId + '-license').unbind('click', self.zc_license_redirect);
		}

		ZC.ZCQuery('#' + self.sId + '-menu').die('mousedown', self.zc_loader_noselect);
		ZC.ZCQuery('.' + self.sId + '-menu-item').die('mousedown', self.zc_loader_noselect);

		ZC.ZCQuery('.' + self.sId + '-menu-item')
			.die('click', self.zc_loader_menu_item_click)
			.die('mouseover', self.zc_loader_menu_item_mouseover)
			.die('mouseout', self.zc_loader_menu_item_mouseout);
		self.oAttributes['menu-item-events'] = false;

		

		if (self.oZoom !== null) {
			self.oZoom.unbind();
		}
		if (self.oGuide !== null) {
			self.oGuide.unbind();
		}
		if (ZC.mobile) {
			ZC.ZCQuery('#' + self.sId + '-img')
				.unbind('touchstart', self.zc_loader_touchstart)
				.unbind('touchmove', self.zc_loader_kill_touchhold)
				.unbind('touchend', self.zc_loader_touchend);
			ZC.ZCQuery('#' + self.sId + '-menu-area')
				.die('touchstart', self.zc_loader_touchstart);
			ZC.ZCQuery('#' + self.sId + '-img').unbind('touchstart', self.zc_loader_touchstart_static);
		}

		ZC.ZCQuery(document).unbind('keyup', self.zc_loader_keyup);

		ZC.ZCQuery('#' + self.sId + '-menu-item-exitfullscreen').die('click', self.zc_loader_exitfullscreen);
	},
	toggleMenuItem : function(sId, bVisible, bSep) {
		if (typeof(bSep) === 'undefined') { bSep = false; }
		var oItem = ZC._id_('zc-menu-' + (bSep?'sep':'item') + '-' + sId);
		if (oItem) {
			oItem.style.display = bVisible?'block':'none';
		}
	},
	buildContextMenu : function(iGraphIndex, ev) {
		var self = this, mValue, i, iLen, j, jLen;
		if (typeof(iGraphIndex) === 'undefined') {
			iGraphIndex = -1;
		}

		var oGui = {};
		ZC._cp_(self.oGui, oGui);
		if (iGraphIndex !== -1 && self.oData['graphset'][iGraphIndex]) {
			ZC._cp_(self.oData['graphset'][iGraphIndex]['gui'], oGui, null, null, true);
		}

		ZC.ZCQuery('#' + self.sId + '-menu').remove();

		var aBehaviors = [];
		if (typeof(ZC.ZCDraw3D) === 'undefined') {
			aBehaviors.push(
				{id:'3D',enabled:'none'},
				{id:'SwitchTo3D',enabled:'none'},
				{id:'SwitchTo2D',enabled:'none'}
			);
		}
		if (ZC._n_(mValue=oGui['behaviors']) !== null) {
			for (i=0,iLen=mValue.length;i<iLen;i++) {
				var bFound = false;
				for (j=0,jLen=aBehaviors.length;j<jLen;j++) {
					if (aBehaviors[j]['id'] === mValue[i]['id']) {
						
						bFound = true;
					}
				}
				if (!bFound) {
					aBehaviors.push(mValue[i]);
				}
			}
		}

		var oCMData = oGui['context-menu'];
		var oCMDataMobile = oGui['context-menu[mobile]'];

		
		for (i=0,iLen=aBehaviors.length;i<iLen;i++) {
			if (ZC._n_(aBehaviors[i]['function']) !== null) {
				if (ZC._n_(oCMData) === null) {
					oCMData = {};
				}
				if (ZC._n_(oCMData['custom-items']) === null) {
					oCMData['custom-items'] = [];
				}
				oCMData['custom-items'].push(aBehaviors[i]);
			}
		}

		
		if (oCMData['custom-items']) {
			oCMData['custom-items'].sort(function(a, b) {
				var oa = ZC._i_(a.order || '0');
				var ob = ZC._i_(b.order || '0');
				return oa > ob;
			});
		}

		self.oCMStyle = new ZC.ZCTextBox(self);
		self.oDefaults.load(self.oCMStyle.oData, 'loader.gui.context-menu');
		if (oCMData) {
			self.oCMStyle.append(oCMData);
		}
		if (ZC.mobile) {
			self.oDefaults.load(self.oCMStyle.oData, 'loader.gui.context-menu' + '[mobile]');
			if (oCMDataMobile) {
				self.oCMStyle.append(oCMDataMobile);
			}
		}
		self.oCMStyle.bFastWidth = true;
		self.oCMStyle.parse();

		function zc_bg_image(sUrl) {
			return (sUrl===''||!sUrl)?'none':('url(' + ((sUrl.indexOf('zc.')===0)?ZC.IMAGES[sUrl]:sUrl) + ')');
		}
		function zc_loader_menusep(sId) {
			return '<div id="'+self.sId+'-menu-sep-' + sId + '" class="zc-menu-sep" style="background-color:' + oCMItemStyle.sBackgroundColor1 + ';background-image:' + zc_bg_image(oCMItemStyle.sBackgroundImage) + ' repeat-x 50% 0%;">&nbsp;</div>';
		}
		function zc_loader_menuitem(sId, sLabel, bCustom) {
			sLabel = sLabel || ZC.ZCLabels['menu-' + sId];
			var sCustomClass = (typeof(bCustom)==='undefined' || !bCustom)?'':(' zc-custom-menu-item ' + self.sId + '-custom-menu-item');
			return '<div class="zc-menu-item '+self.sId+'-menu-item'+sCustomClass+'" style="color:'+oCMItemStyle.sColor+';background-color:'+oCMItemStyle.sBackgroundColor1+';background-image:'+zc_bg_image(oCMItemStyle.sBackgroundImage)+' repeat-x 50% 0%;border-top:'+(ZC.ie67?oCMItemStyle.iBorderWidth:1)+'px solid '+oCMItemStyle.sBorderColor+';border-left:'+oCMItemStyle.iBorderWidth+'px solid '+oCMItemStyle.sBorderColor+';border-right:'+oCMItemStyle.iBorderWidth+'px solid '+oCMItemStyle.sBorderColor+';padding:'+oCMItemStyle.iPaddingTop+'px '+oCMItemStyle.iPaddingRight+'px '+oCMItemStyle.iPaddingBottom+'px '+oCMItemStyle.iPaddingLeft+'px;text-align:'+oCMItemStyle.sTextAlign+';'+(ZC.ZCLabels['rtl']?'unicode-bidi:bidi-override;direction:rtl;':'')+'" id="' + self.sId + '-menu-item-' + sId + '">' + sLabel + '</div>';
		}
		function zc_loader_menuheader(sId, sLabel, bCustom) {
			sLabel = sLabel || ZC.ZCLabels['menu-' + sId];
			var sCustomClass = (typeof(bCustom)==='undefined' || !bCustom)?'':(' zc-custom-menu-header ' + self.sId + '-custom-menu-header');
			return '<div class="zc-menu-header '+self.sId+'-menu-header'+sCustomClass+'" style="color:'+oCMItemStyle.sColor+';background-color:#666;border-top:'+(ZC.ie67?oCMItemStyle.iBorderWidth:1)+'px solid '+oCMItemStyle.sBorderColor+';border-left:'+oCMItemStyle.iBorderWidth+'px solid '+oCMItemStyle.sBorderColor+';border-right:'+oCMItemStyle.iBorderWidth+'px solid '+oCMItemStyle.sBorderColor+';padding:'+oCMItemStyle.iPaddingTop+'px '+oCMItemStyle.iPaddingRight+'px '+oCMItemStyle.iPaddingBottom+'px '+oCMItemStyle.iPaddingLeft+'px;text-align:'+oCMItemStyle.sTextAlign+';'+(ZC.ZCLabels['rtl']?'unicode-bidi:bidi-override;direction:rtl;':'')+'" id="' + self.sId + '-menu-item-' + sId + '">' + sLabel + '</div>';
		}
		function zc_loader_behavior(sId) {
			if (bEmpty) {
				return {enabled:'none'};
			}
			for (var i=0,iLen=aBehaviors.length;i<iLen;i++) {
				if (aBehaviors[i]['id'] === sId) {
					return aBehaviors[i];
				}
			}
			return {enabled:'all'};
		}

		var oCMButton;
		if (self.oCMStyle.bVisible || !self.bBuildCode) {

			if (!ZC._id_(self.sId + '-menu-area')) {
				if ((ZC.ZCQuery.browser.opera && ZC._i_(ZC.ZCQuery.browser.version) <= 9.5) || ZC.mobile) {
					oCMButton = new ZC.ZCTextBox(self);
					self.oDefaults.load(oCMButton.oData, 'loader.gui.context-menu' + '.button');
					if (oCMData && ZC._n_((mValue=oCMData['button']) !== null)) {
						oCMButton.append(mValue);
					}
					if (ZC.mobile) {
						self.oDefaults.load(oCMButton.oData, 'loader.gui.context-menu' + '[mobile].button');
						if (oCMDataMobile && ZC._n_(mValue=oCMDataMobile['button']) !== null) {
							oCMButton.append(mValue);
						}
					}
					oCMButton.sId = self.sId + '-menu-trigger';
					oCMButton.oDOMParent = ZC._id_(self.sId + '-tools');
					oCMButton.oCanvas = ZC._id_(self.sId + '-trigger-c');
					oCMButton.bFastWidth = true;
					oCMButton.parse();

					if (oCMButton.bVisible) {
						oCMButton.paint();

						if (oCMButton.sText === '') {
							var oCMGear = new ZC.ZCShape(self);
							oCMGear.bPixelCorrection = false;
							self.oDefaults.load(oCMGear.oData, 'loader.gui.context-menu' + '.gear');
							if (oCMData && ZC._n_(mValue=oCMData['gear']) !== null) {
								oCMGear.append(mValue);
							}
							if (ZC.mobile) {
								self.oDefaults.load(oCMGear.oData, 'loader.gui.context-menu' + '[mobile].gear');
								if (oCMDataMobile && ZC._n_(mValue=oCMDataMobile['gear']) !== null) {
									oCMGear.append(mValue);
								}
							}
							oCMGear.sId = self.sId + '-menu-trigger-gear';
							oCMGear.oDOMParent = ZC._id_(self.sId + '-tools');
							oCMGear.oCanvas = ZC._id_(self.sId + '-trigger-c');
							oCMGear.iX = oCMButton.iX + oCMButton.iWidth/2;
							oCMGear.iY = oCMButton.iY + oCMButton.iHeight/2;
							oCMGear.iSize = ZC._min_(oCMButton.iWidth, oCMButton.iHeight)/4.5;
							oCMGear.parse();
							oCMGear.paint();

							var oCMGearHole = new ZC.ZCShape(self);
							oCMGearHole.copy(oCMButton);
							oCMGearHole.sId = self.sId + '-menu-trigger-gear-hole';
							oCMGearHole.oDOMParent = ZC._id_(self.sId + '-tools');
							oCMGearHole.oCanvas = ZC._id_(self.sId + '-trigger-c');
							oCMGearHole.sShape = 'circle';
							oCMGearHole.iSize = ZC._min_(oCMButton.iWidth, oCMButton.iHeight)/7;
							oCMGearHole.parse();
							oCMGearHole.iX = oCMButton.iX + oCMButton.iWidth/2;
							oCMGearHole.iY = oCMButton.iY + oCMButton.iHeight/2;
							oCMGearHole.paint();
						}
						ZC._id_(self.sId + '-map').innerHTML += ZC.ZCHtmlUtils._area_start_('rect') + 'id="' + self.sId + '-menu-area' + '" coords="' + ZC._i_(oCMButton.iX+ZC.MAPTX) + ',' + ZC._i_(oCMButton.iY+ZC.MAPTX) + ',' + ZC._i_(oCMButton.iX+oCMButton.iWidth+ZC.MAPTX) + ',' + ZC._i_(oCMButton.iY+oCMButton.iHeight+ZC.MAPTX) + '" />';
						
					}
				}
			}

			var oCMItemStyle = new ZC.ZCTextBox(self);
			self.oDefaults.load(oCMItemStyle.oData, 'loader.gui.context-menu' + '.item');
			if (oCMData && ZC._n_(mValue=oCMData['item']) !== null) {
				oCMItemStyle.append(mValue);
			}
			if (ZC.mobile) {
				self.oDefaults.load(oCMItemStyle.oData, 'loader.gui.context-menu' + '[mobile].item');
				if (oCMDataMobile && ZC._n_(mValue=oCMDataMobile['item']) !== null) {
					oCMItemStyle.append(mValue);
				}
			}
			oCMItemStyle.bFastWidth = true;
			oCMItemStyle.parse();

			var oCMItemStyleHover = new ZC.ZCTextBox(self);
			oCMItemStyleHover.copy(oCMItemStyle);
			self.oDefaults.load(oCMItemStyleHover.oData, 'loader.gui.context-menu' + '.item.hover-state');
			if (oCMData && ZC._n_(oCMData['item']) !== null && ZC._n_(mValue=oCMData['item']['hover-state']) !== null) {
				oCMItemStyleHover.append(mValue);
			}
			if (ZC.mobile) {
				self.oDefaults.load(oCMItemStyleHover.oData, 'loader.gui.context-menu' + '[mobile].item.hover-state');
				if (oCMDataMobile && ZC._n_(oCMDataMobile['item']) !== null && ZC._n_(mValue=oCMDataMobile['item']['hover-state']) !== null) {
					oCMItemStyleHover.append(mValue);
				}
			}
			oCMItemStyleHover.bFastWidth = true;
			oCMItemStyleHover.parse();

			var aMenu = [];
			var oBehavior = null;
			
			var bEmpty = (ZC._n_(self.oCMStyle.oData['empty'])===null)?false:ZC._b_(self.oCMStyle.oData['empty']);
			oBehavior = zc_loader_behavior('Reload');
			if (oBehavior['enabled'] !== 'none') {
				aMenu.push(zc_loader_menuitem('reload', oBehavior['text']));
				aMenu.push(zc_loader_menusep('reload'));
			}
			if (typeof(ZC.ZCModuleExport) !== 'undefined') {
				oBehavior = zc_loader_behavior('SaveAsImage');
				if (oBehavior['enabled'] !== 'none') {
					oBehavior = zc_loader_behavior('SaveAsImagePNG');
					if (oBehavior['enabled'] !== 'none') {
						aMenu.push(zc_loader_menuitem('viewaspng', oBehavior['text']?(oBehavior['text']+' (PNG)'):null));
					}
					oBehavior = zc_loader_behavior('SaveAsImageJPG');
					if (oBehavior['enabled'] !== 'none') {
						aMenu.push(zc_loader_menuitem('viewasjpg', oBehavior['text']?(oBehavior['text']+' (JPG)'):null));
					}
					aMenu.push(zc_loader_menusep('export'));
				}
				oBehavior = zc_loader_behavior('DownloadPDF');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('downloadpdf', oBehavior['text']));
					aMenu.push(zc_loader_menusep('downloadpdf'));
				}
				oBehavior = zc_loader_behavior('DownloadSVG');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('downloadsvg', oBehavior['text']));
					aMenu.push(zc_loader_menusep('downloadsvg'));
				}
				oBehavior = zc_loader_behavior('ExportData');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('exportdata', oBehavior['text']));
					aMenu.push(zc_loader_menusep('exportdata'));
				}
				oBehavior = zc_loader_behavior('Print');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('print', oBehavior['text']));
					aMenu.push(zc_loader_menusep('print'));
				}
			}

			if (iGraphIndex !== -1) {
				var bZooming = false;
				for (j=0,jLen=self.aGraphs[iGraphIndex].aScales.length;j<jLen;j++) {
					if (self.aGraphs[iGraphIndex].aScales[j].bZooming) {
						bZooming = true;
					}
				}
				if (bZooming && typeof(ZC.ZCZoom) !== 'undefined') {
					var bZoomGroup = false;
					oBehavior = zc_loader_behavior('ZoomIn');
					if (oBehavior['enabled'] !== 'none') {
						aMenu.push(zc_loader_menuitem('zoomin', oBehavior['text']));
						bZoomGroup = true;
					}
					oBehavior = zc_loader_behavior('ZoomOut');
					if (oBehavior['enabled'] !== 'none') {
						aMenu.push(zc_loader_menuitem('zoomout', oBehavior['text']));
						bZoomGroup = true;
					}
					oBehavior = zc_loader_behavior('ViewAll');
					if (oBehavior['enabled'] !== 'none') {
						aMenu.push(zc_loader_menuitem('viewall', oBehavior['text']));
						bZoomGroup = true;
					}
					if (bZoomGroup) {
						aMenu.push(zc_loader_menusep('zoom'));
					}
				}
			}
			var b2D = false, b3D = false;
			if (iGraphIndex !== -1) {
				if (ZC._indexof_(['line','area','bar','vbar','hbar','pie','mixed'], self.aGraphs[iGraphIndex].sType) !== -1) {
					b2D = true;
					self.sCoordSpace = '2d';
				}
				if (ZC._indexof_(['line3d','area3d','bar3d','vbar3d','hbar3d','pie3d','mixed3d'], self.aGraphs[iGraphIndex].sType) !== -1) {
					b3D = true;
					self.sCoordSpace = '3d';
				}
			}

			if ((b2D || b3D)) {
				
				oBehavior = zc_loader_behavior('3D');
				if (oBehavior['enabled'] !== 'none') {
					oBehavior = zc_loader_behavior(b2D?'SwitchTo3D':'SwitchTo2D');
					if (oBehavior['enabled'] !== 'none') {
						aMenu.push(zc_loader_menuitem(b2D?'switchto3d':'switchto2d', oBehavior['text']));
						aMenu.push(zc_loader_menusep('dimension'));
					}
				}
			}

			if (iGraphIndex !== -1) {
				var oGraph = self.aGraphs[iGraphIndex];
				
				var bYScale = false, bLog = false;
				for (j=0;j<oGraph.aScales.length;j++) {
					var oScale = oGraph.aScales[j];
					if (oScale.sName.indexOf('scale-y') === 0) {
						bYScale = true;
					}
					if (oScale.sProgression === 'log') {
						bLog = true;
					}
				}
				if (bYScale) {
					
					oBehavior = zc_loader_behavior('Progression');
					if (oBehavior['enabled'] !== 'none') {
						oBehavior = zc_loader_behavior(bLog?'LinScale':'LogScale');
						if (oBehavior['enabled'] !== 'none') {
							aMenu.push(zc_loader_menuitem(bLog?'switchtolin':'switchtolog', oBehavior['text']));
							aMenu.push(zc_loader_menusep('progression'));
						}
					}
				}
				
				if (oGraph.oCrosshairX || oGraph.oCrosshairY) {
					oBehavior = zc_loader_behavior('Guide');
					if (oBehavior['enabled'] !== 'none') {
						oBehavior = zc_loader_behavior(oGraph.bGuideOn?'HideGuide':'ShowGuide');
						if (oBehavior['enabled'] !== 'none') {
							aMenu.push(zc_loader_menuitem(oGraph.bGuideOn?'hideguide':'showguide', oBehavior['text']));
							aMenu.push(zc_loader_menusep('guide'));
						}
					}
				}
			}

			var iFlag = 0;
			if (typeof(ZC.ZCModuleDebug) !== 'undefined') {
				oBehavior = zc_loader_behavior('ViewSource');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('viewsource', oBehavior['text']));
					iFlag++;
				}
				oBehavior = zc_loader_behavior('BugReport');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('bugreport', oBehavior['text']));
					iFlag++;
				}
			}
			if (iFlag > 0) {
				aMenu.push(zc_loader_menusep('tools'));
			}
			oBehavior = zc_loader_behavior('FullScreen');
			if (oBehavior['enabled'] !== 'none' && !self.bFullScreen) {
				if (self.bFullScreenMode) {
					oBehavior = zc_loader_behavior('ExitFullScreen');
					aMenu.push(zc_loader_menuitem('exitfullscreen', oBehavior['text']));
					aMenu.push(zc_loader_menusep('exitfullscreen'));
				} else {
					aMenu.push(zc_loader_menuitem('fullscreen', oBehavior['text']));
					aMenu.push(zc_loader_menusep('fullscreen'));
				}
			}

			if (self.oHistory) {
				oBehavior = zc_loader_behavior('GoBack');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('goback', oBehavior['text']));
				}
				oBehavior = zc_loader_behavior('GoForward');
				if (oBehavior['enabled'] !== 'none') {
					aMenu.push(zc_loader_menuitem('goforward', oBehavior['text']));
				}
				aMenu.push(zc_loader_menusep('history'));
			}

			if (aMenu.length > 0 && aMenu[aMenu.length-1].indexOf('zc-menu-sep') !== -1) {
				aMenu.splice(aMenu.length-1, 1);
			}

			self.aCustomMenuItems = {};
			if (iGraphIndex !== -1) {
				var aItems;
				if (oCMData && ZC._n_(aItems=oCMData['custom-items']) !== null) {
					if (aMenu.length > 0) {
						aMenu.push(zc_loader_menusep('custom'));
					}
					for (i=0,iLen=aItems.length;i<iLen;i++) {
						var bEnabled = true;
						if (ZC._n_(aItems[i]['enabled']) !== null) {
							if (aItems[i]['enabled'] === 'none') {
								bEnabled = false;
							} else if (aItems[i]['enabled'] !== 'all') {
								
								if (ev) {
									bEnabled = eval(aItems[i]['enabled']).call(self, zingchart.getMouseInfo(ev, self), aItems[i]['id'], ev);
								} else {
									bEnabled = true;
								}
							}
						}
						if (bEnabled) {
							var sText;
							var sId = aItems[i]['id'] || ('custom-' + i);
							if (aItems[i]['id'] === 'sep' || aItems[i]['type'] === 'sep') {
								aMenu.push(zc_loader_menusep(sId));
							} else if (aItems[i]['type'] === 'header') {
								sText = aItems[i]['text'] || ('Custom Menu ' + i);
								aMenu.push(zc_loader_menuheader(sId, sText, true));
							} else {
								sText = aItems[i]['text'] || ('Custom Menu ' + i);
								self.aCustomMenuItems[sId] = {
									fn : aItems[i]['function'] || '',
									url : aItems[i]['url'] || '',
									target : aItems[i]['target'] || ''
								};
								aMenu.push(zc_loader_menuitem(sId, sText, true));
							}
						}
					}
				}
			}

			

			if (!self.bLicensed) {
				aMenu.push(zc_loader_menusep('zingchart'));
				aMenu.push(zc_loader_menuitem('xmiabt', 'About ZingChart'));
			}

			ZC.ZCHtmlUtils._div_({
				id : self.sId + '-menu',
				p : document.body,
				cls : 'zc-menu zc-style',
				top : (ZC._n_(oCMButton)===null?0:(oCMButton.iY + oCMButton.iHeight/2)),
				left : (ZC._n_(oCMButton)===null?0:(oCMButton.iX + oCMButton.iWidth/2)),
				borderBottom : self.oCMStyle.iBorderWidth + 'px solid ' + self.oCMStyle.sBorderColor,
				background : (self.oCMStyle.sBackgroundColor1 === -1?'transparent':self.oCMStyle.sBackgroundColor1)+' '+zc_bg_image(self.oCMStyle.sBackgroundImage),
				paddingTop : self.oCMStyle.iPaddingTop,
				paddingRight : self.oCMStyle.iPaddingRight,
				paddingBottom : self.oCMStyle.iPaddingBottom,
				paddingLeft : self.oCMStyle.iPaddingLeft,
				html : aMenu.join('')
			});

			self.zc_loader_menu_item_click = function(ev) {
				var sMenuId = (ev.target.nodeType !== 1)?ev.target.parentNode.id:ev.target.id;
				var sLoaderId = sMenuId.substring(0, sMenuId.indexOf('-menu-item-'));
				var oLoader = zingchart.getLoader(sLoaderId);
				if (ZC.mobile) { oLoader.zc_loader_kill_touchhold(); }
				var oGraph = oLoader.detectGraph(oLoader.aRClickXY[0], oLoader.aRClickXY[1]);
				oLoader.hideCM();
				if (ZC.mobile) { zingchart.zc_click(ev); }
				var sMenuItemId = sMenuId.replace(oLoader.sId + '-menu-item-', '');
				oLoader._api_menu_item_click_({graphid : oGraph?oGraph.sId:null, menuitemid : sMenuItemId, ev : ZC.ZCQuery._event_(ev)});
				switch (sMenuItemId) {
					case 'switchto2d':
					case 'switchto3d':
						if (oGraph) {
							oLoader._api_2d3d_toggle_(oGraph.sId);
						}
						break;
					case 'showguide':
						oLoader._api_guide_toggle_(oGraph.sId, true);
						break;
					case 'hideguide':
						oLoader._api_guide_toggle_(oGraph.sId, false);
						break;
					case 'switchtolin':
						oLoader._api_progression_toggle_(oGraph.sId, 'lin');
						break;
					case 'switchtolog':
						oLoader._api_progression_toggle_(oGraph.sId, 'log');
						break;
					case 'reload':
						oLoader._api_reload_();
						break;
					case 'viewaspng':
						oLoader._api_view_as_image_('png');
						break;
					case 'viewasjpg':
						oLoader._api_view_as_image_('jpeg');
						break;
					case 'downloadpdf':
						oLoader._api_view_as_image_('pdf');
						break;
					case 'downloadsvg':
						oLoader._api_view_as_image_('svg');
						break;
					case 'exportdata':
						zingchart.exec(oLoader.sId, 'exportdata');
						break;
					case 'print':
						oLoader._api_print_();
						break;
					case 'viewsource':
						oLoader._api_viewsource_();
						break;
					case 'bugreport':
						oLoader._api_bugreport_();
						break;
					case 'fullscreen':
						oLoader._api_fullscreen_();
						break;
					
					case 'goback':
						zingchart.exec(oLoader.sId, 'goback');
						break;
					case 'goforward':
						zingchart.exec(oLoader.sId, 'goforward');
						break;
					case 'zoomin':
						if (oGraph) {
							oLoader.oZoom.oGraph = oGraph;
							oLoader._api_zoomin_({graphid : oGraph.sId});
						}
						break;
					case 'zoomout':
						if (oGraph) {
							oLoader.oZoom.oGraph = oGraph;
							oLoader._api_zoomout_({graphid : oGraph.sId});
						}
						break;
					case 'viewall':
						if (oGraph) {
							oLoader.oZoom.oGraph = oGraph;
							oLoader._api_viewall_({graphid : oGraph.sId});
						}
						break;
					case 'xmiabt':
						oLoader._api_about_();
						break;
					default:
						if (ZC._n_(mValue=self.aCustomMenuItems[sMenuItemId]) !== null) {
							if (mValue.fn !== '') {
								oLoader._api_callfunction_({graphid : oGraph?oGraph.sId:null, menuitemid : sMenuItemId, 'function' : mValue.fn});
							} else if (mValue.url !== '' && oGraph) {
								oGraph._onclick_(ev, mValue.url, mValue.target);
							}
						}
						break;
				}
			};

			self.zc_loader_menu_item_mouseover = function() {
				this.style.backgroundColor = oCMItemStyleHover.sBackgroundColor1;
				this.style.color = oCMItemStyleHover.sColor;
				
				this.style.borderLeft = this.style.borderRight = oCMItemStyleHover.iBorderWidth + 'px solid ' + oCMItemStyleHover.sBorderColor;
			};

			self.zc_loader_menu_item_mouseout = function() {
				this.style.backgroundColor = oCMItemStyle.sBackgroundColor1;
				this.style.color = oCMItemStyle.sColor;
				
				this.style.borderLeft = this.style.borderRight = oCMItemStyle.iBorderWidth + 'px solid ' + oCMItemStyle.sBorderColor;
			};
			if (!self.oAttributes['menu-item-events']) {
				self.zc_loader_noselect = function(ev) { ev.preventDefault();return false; };
				ZC.ZCQuery('#' + self.sId + '-menu').live('mousedown', self.zc_loader_noselect);
				ZC.ZCQuery('.' + self.sId + '-menu-item').live('mousedown', self.zc_loader_noselect);
				ZC.ZCQuery('.' + self.sId + '-menu-item')
					.live('click', self.zc_loader_menu_item_click)
					.live('mouseover', self.zc_loader_menu_item_mouseover)
					.live('mouseout', self.zc_loader_menu_item_mouseout);
				self.oAttributes['menu-item-events'] = true;
			}
		}
	},
	destroy : function() {
		var self = this;
		self._unbind_();
		zingchart.aLoaders.length -= 1;
		self.clear();
		ZC.ZCQuery('#zc-fullscreen').remove();
		document.body.style.overflow = '';
	},
	showProgress : function(oGraph, bInit) {
		var self = this, mValue;
		if (ZC._n_(bInit) === null) {
			bInit = false;
		}
		if (!bInit && !self.bShowProgress) {
			return;
		}
		if (ZC._indexof_(self.aFlags, 'skip_interactivity') !== -1) {
			return;
		}

		var oContainer = ZC.ZCQuery('#' + self.sId);

		if (typeof(oContainer.offset()) === 'undefined' || (oContainer.width() + oContainer.height() === 0)) {
			return;
		}

		self.bProgressOn = true;

		
		if (bInit) {
			ZC.ZCHtmlUtils._div_({
				id : self.sId + '-dummy',
				p : ZC._id_(self.sId),
				wh : self.iWidth + '/' + self.iHeight
			});
		}

		if (!self.oAttributes['hideprogresslogo'] || !self.bLicensed) {
			var iX_ = oContainer.offset().left + ZC._i_(oContainer.css('border-left-width')) + ((oGraph===null)?self.iX:oGraph.iX);
			var iY_ = oContainer.offset().top + ZC._i_(oContainer.css('border-top-width')) + ((oGraph===null)?self.iY:oGraph.iY);

			if (ZC.ipad || ZC.iphone) {
				iX_ -= ZC.ZCQuery(window).scrollLeft();
				iY_ -= ZC.ZCQuery(window).scrollTop();
			}

			var iWidth_ = (oGraph===null)?self.iWidth:oGraph.iWidth;
			var iHeight_ = (oGraph===null)?self.iHeight:oGraph.iHeight;
			var iTextWidth = ZC._i_(self.iWidth*0.8);
			var iTextOffset = 30;

			var oStyleProgress = new ZC.ZCTextBox(self);
			self.oDefaults.load(oStyleProgress.oData, 'loader.gui.progress');
			oStyleProgress.append(self.oAttributes['progress']);
			if (self.oGui !== null && ZC._n_(mValue=self.oGui['progress']) !== null) {
				oStyleProgress.append(mValue);
			}
			oStyleProgress.parse();

			var sText = ZC.ZCLabels['progress-wait-long'], sBackground;
			if (ZC.ie67) {
				sBackground = oStyleProgress.sBackgroundColor1;
			} else {
				var sBackgroundImage = self.oAttributes['customprogresslogo'] || ZC.IMAGES['zc.logo'];
				sBackground = oStyleProgress.sBackgroundColor1 + ' url(' + sBackgroundImage + ') no-repeat center center';
			}

			if (iWidth_ < 180 || iHeight_ < 90) {
				sBackground = oStyleProgress.sBackgroundColor1;
				iTextOffset = -12;
			}
			if (iWidth_ < 120 && iWidth_ > 60) {
				iTextWidth = 60;
				sText = ZC.ZCLabels['progress-wait-short'];
			} else if (iWidth_ < 60) {
				iTextWidth = 20;
				sText = ZC.ZCLabels['progress-wait-mini'];
			}
			var oProgress = ZC.ZCHtmlUtils._div_({
				id : self.sId + '-progress',
				p : document.body,
				tl : iY_ + '/' + iX_,
				width : (iWidth_-2*oStyleProgress.iBorderWidth),
				height : (iHeight_-2*oStyleProgress.iBorderWidth),
				position : 'absolute',
				opacity : 0.8,
				border : oStyleProgress.iBorderWidth + 'px solid ' + oStyleProgress.sBorderColor,
				background : sBackground
			});
			ZC.ZCHtmlUtils._div_({
				id : self.sId + '-progress-text',
				p : oProgress,
				width : iTextWidth,
				html : sText,
				textAlign : 'center',
				marginLeft : ZC._i_((iWidth_-iTextWidth)/2),
				marginTop : ZC._i_(iHeight_/2+iTextOffset),
				fontFamily : zingchart.FONTFAMILY,
				fontSize : zingchart.FONTSIZE,
				color : oStyleProgress.sColor,
				fontWeight : 'bold'
			});
		}
	},
	hideProgress : function() {
		var self = this;
		if (self.oAttributes['hideprogresslogo']) {
			return;
		}
		self.bProgressOn = false;
		ZC.ZCHtmlUtils._remove_(
			[
				self.sId + '-dummy',
				self.sId + '-progress-text',
				self.sId + '-progress'
			]
		);
	},
	getEarlyGraphInfo : function(oData, iGraphIndex) {
		var self = this;
		var aGraphSet, mValue;
		if (ZC._n_(mValue=oData['graphset']) !== null) {
			aGraphSet = mValue;
		} else {
			aGraphSet = [oData];
		}

		var sLayout = oData['layout'] || '';
		var aLayoutInfo = ZC.ZCMath._layout_(sLayout, aGraphSet.length);
		var oGraphData = aGraphSet[iGraphIndex];
		var iWidth = self.iWidth/aLayoutInfo[1];
		var iHeight = self.iHeight/aLayoutInfo[0];
		var iRow = Math.floor(iGraphIndex/aLayoutInfo[1]);
		
		var iCol = iGraphIndex%aLayoutInfo[1];

		var iX = iCol*iWidth;
		var iY = iRow*iHeight;
		if (oGraphData) {
			if (ZC._n_(mValue=oGraphData['x']) !== null) {
				iX = ZC._p_(mValue);
				if (iX <= 1) {
					iX = ZC._i_(iX*self.iWidth);
				}
			}
			if (ZC._n_(mValue=oGraphData['y']) !== null) {
				iY = ZC._p_(mValue);
				if (iY <= 1) {
					iY = ZC._i_(iY*self.iHeight);
				}
			}
			if (ZC._n_(mValue=oGraphData['width']) !== null) {
				iWidth = ZC._p_(mValue);
				if (iWidth <= 1) {
					iWidth = ZC._i_(iWidth*self.iWidth);
				}
			}
			if (ZC._n_(mValue=oGraphData['height']) !== null) {
				iHeight = ZC._p_(mValue);
				if (iHeight <= 1) {
					iHeight = ZC._i_(iHeight*self.iHeight);
				}
			}
		}
		var aMargin = [0, 0, 0, 0];
		if (oGraphData['plotarea']) {
			if (ZC._n_(oGraphData['plotarea']['margin']) !== null) {
				var oBox = new ZC.ZCBox(null);
				aMargin = oBox.m_(oGraphData['plotarea']['margin'], 'all', iWidth, iHeight);
			}
		}
		return {
			graph : {
				x : ZC._i_(iX),
				y : ZC._i_(iY),
				width : ZC._i_(iWidth),
				height : ZC._i_(iHeight)
			},
			plotarea : {
				x : aMargin[3],
				y : aMargin[0],
				width : iWidth - aMargin[1] - aMargin[3],
				height : iHeight - aMargin[0] - aMargin[2]
			}
		};
	},
	repaint : function() {
		var self = this;
		
		if (zingchart.DEV.GC) {
			self.gc();
		}

		
		if (ZC._n_(self.oData['graphset']) === null) {
			self.oData = {'graphset' : [self.oData]};
		}
		self.showProgress();
		zingchart.loadScripts(self, self.scanScripts(), function() {
			self.oData = ZC.ZCUtils._trigger_event_('dataparse', self, self._api_loader_info_(), self.oData);
			ZC._delay_(function() {
				self.loadResources(function() {
					self.parse();
					self.paint();
				});
			});
		});
	},
	render : function() {
		var self = this;

		

		

		

		
		
		function _render_() {
			if (!self.bValidApiKey) {
				self.checkLicense();
			}

			if (!self.oAttributes['hideprogresslogo']) {
				self.showProgress(null, true);
			}

			function _load_() {
				if (self.sDefaultsUrl !== '' || self.oDefaultsObj !== null) {
					self.loadDefaults();
				} else {
					self.load();
				}
			}

			if (zingchart.TIMEOUT > 0) {
				ZC._delay_(_load_);
			} else {
				_load_();
			}
			
		}

		
		
		_render_();

		
	},
	trackTouchHold : function(ev) {
		var self = this;
		if (ZC._n_(self.iTsTouch) === null) {
			self.iTsTouch = new Date().getTime();
			self.iTickTouch = window.setTimeout(function() {
				if (ZC._n_(self.iTsTouch) !== null) {
					self.iTsTouch = null;
					zingchart.zc_contextmenu(ev);
				}
			}, 1500);
		}
	},
	_api_loader_info_ : function() {
		var self = this;
		var iLeft = 0, iTop = 0;
		
		
		if (typeof(self.aRClickXY[0]) !== 'undefined') {
			iLeft = self.aRClickXY[0] - iLeft;
		} else {
			iLeft = 0;
		}
		if (typeof(self.aRClickXY[1]) !== 'undefined') {
			iTop = self.aRClickXY[1] - iTop;
		} else {
			iTop = 0;
		}
		return {id : self.sId, width : self.iWidth, height : self.iHeight, output : self.sOutput, x : iLeft, y : iTop, targetid : self.aRClickXY[2]};
	},
	_api_data_map_ : function(oParams) {
		var self = this;
		oParams = oParams || {};
		if (ZC._n_(oParams['resource']) !== null) {
			self.oDataMapping[oParams['resource']] = oParams['data'] || '[]';
			self.iLoaded++;
		}
	},
	_api_zoomin_ : function() {
	},
	_api_zoomout_ : function() {
	},
	_api_viewall_ : function() {
	},
	_api_zoomto_ : function() {
	},
	_api_clear_ : function(oParams, bForceDestroy) {
		var self = this;
		oParams = oParams || {};
		if (ZC._n_(oParams['graphid']) !== null) {
			var oGraph = self.findGraph(oParams['graphid']);
			if (oGraph !== null) {
				oGraph.clear();
			}
		} else {
			self.clear(null, null, bForceDestroy);
		}
	},
	_api_disable_ : function(sMessage) {
		sMessage = sMessage || ZC.ZCLabels['sync-wait'];
		var self = this;
		if (ZC._id_(self.sId + '-blocker') === null) {
			ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-style zc-blocker',
				id : self.sId + '-blocker',
				p : ZC._id_(self.sId + '-top'),
				wh : self.iWidth + '/' + self.iHeight,
				opacity : 0.75
			});
			ZC.ZCHtmlUtils._div_({
				cls : 'zc-blocker-msg',
				id : self.sId + '-blocker-t',
				p : ZC._id_(self.sId + '-blocker'),
				html : sMessage
			});
			var oWaitDiv = ZC.ZCQuery('#' + self.sId + '-blocker-t');
			oWaitDiv.css('top', (self.iHeight/2-oWaitDiv.height()/2) + 'px').css('left', (self.iWidth/2-oWaitDiv.width()/2) + 'px');
		}
	},
	_api_enable_ : function() {
		ZC.ZCHtmlUtils._remove_(this.sId + '-blocker');
	},
	_api_about_ : function() {
		var self = this;
		ZC.ZCUtils._trigger_event_('about_show', self, self._api_loader_info_());
		ZC.ZCHtmlUtils._div_({
			cls : 'zc-abs',
			id : self.sId + '-about-mask',
			p : ZC._id_(self.sId + '-top'),
			wh : self.iWidth + '/' + self.iHeight,
			background : '#ccc',
			opacity : 0.75
		});
		var iW_ = ZC._min_(320, self.iWidth);
		var iH_ = ZC._min_(215, self.iHeight);
		var iL_ = ZC._max_(0, (self.iWidth-iW_)/2);
		var iT_ = ZC._max_(0, (self.iHeight-iH_)/2);
		var oAbout = ZC.ZCHtmlUtils._div_({
			cls : 'zc-about zc-style',
			id : self.sId + '-about',
			p : ZC._id_(self.sId + '-top'),
			tl : iT_+'/'+iL_,
			wh : (iW_-(ZC.quirks?0:10))+'/'+(iH_-(ZC.quirks?0:10))
		});
		var sCustomStringArea = '';
		if (self.sCustomString !== '') {
			sCustomStringArea = 'Custom Built for<br />' + self.sCustomString;
		}
		oAbout.innerHTML = '<div class="zc-about-1"><a href="http://www.zingchart.com" target="_blank">zingchart.com</a></div><div class="zc-about-2">&copy;2009-2015</div><div class="zc-about-3"><div id="' + self.sId + '-about-close">' + ZC.ZCLabels['about-close'] + '</div></div><div class="zc-about-4" style="padding:' + (iH_-215) + 'px 5px 5px 5px;"><div>&nbsp;<br />Build ' + ZC.VERSION + ' [' + self.sOutput + ']</div>' + sCustomStringArea + '</div>';
		function _about_close_() {
			ZC.ZCUtils._trigger_event_('about_hide', self, self._api_loader_info_());
			ZC.ZCHtmlUtils._remove_([self.sId + '-about', self.sId + '-about-mask']);
		}
		ZC.ZCQuery('#' + self.sId + '-about-close').bind('click', _about_close_);
		
	},
	_api_error_ : function(mError, sSection) {
		var self = this;
		
		if (ZC.ZCUtils._check_event_('error', self)) {
			ZC.ZCUtils._trigger_event_('error', self, {
				id : self.sId,
				error : mError,
				section : sSection,
				json : self.oAttributes['json'] || self.oAttributes['rawsource']
			});
			return;
		}
		var sError = '';
		if (typeof(mError) === 'object') {
			sError += mError['name'] + ': ' + mError['message'] + "\n\n";
		} else {
			sError += (''+mError) + "\n\n";
		}
		if (ZC._n_(sSection) !== null) {
			sError += 'Section: ' + sSection + "\n\n";
		}
		sError += "JSON data:\n\n" + self.oAttributes['json'] + "\n\n";
		self.hideProgress();
		if (ZC._id_(self.sId + '-top') === null) {
			self.paintMain();
		}
		var oViewError = ZC.ZCHtmlUtils._div_({
			cls : 'zc-abs zc-error zc-style',
			id : self.sId + '-error',
			p : ZC._id_(self.sId + '-top'),
			wh : (self.iWidth-(ZC.quirks?0:10)) + '/' + (self.iHeight-(ZC.quirks?0:10))
		});
		oViewError.innerHTML = '<div class="zc-form-row-label zc-form-s0">' + ZC.ZCLabels['error-header'] + '</div><div class="zc-form-row-label zc-form-s1">' + ZC.ZCLabels['error-message'] + '</div><div class="zc-form-row-element"><textarea id="' + self.sId + '-error-message" style="width:' + (self.iWidth-35) + 'px;height:' + (self.iHeight-135) + 'px;"></textarea></div><div class="zc-form-row-element zc-form-row-last"><input type="button" value="' + ZC.ZCLabels['error-close'] + '" id="' + self.sId + '-error-close" /></div>';
		ZC.ZCQuery('#' + self.sId + '-error-message').val(ZC._trim_(sError));
		ZC.ZCQuery('#' + self.sId + '-error-close').bind('click', function() {
			ZC.ZCHtmlUtils._remove_(self.sId + '-error');
		});
		
		
	},
	_api_viewsource_ : function() {
	},
	_api_bugreport_ : function() {
	},
	_api_fullscreen_ : function() {
		var self = this;
		var oDiv = document.createElement('div');
		oDiv.id = 'zc-fullscreen';
		oDiv.style.zIndex = zingchart.FSZINDEX;
		oDiv.style.overflow = 'hidden';

		var oFSContainer = document.body, bFSID = false;
		if (zingchart.FSID && ZC._id_(zingchart.FSID)) {
			bFSID = true;
			oFSContainer = ZC._id_(zingchart.FSID);
			
			oFSContainer.style.display = 'block';
		}

		oFSContainer.appendChild(oDiv);

		
		ZC.FSSTATUS = {};
		var g, gLen;
		for (g=0,gLen=self.aGraphs.length;g<gLen;g++) {
			var oGraph = self.aGraphs[g];
			if (oGraph.oPlotSet !== null) {
				for (var p=0,pLen=oGraph.oPlotSet.aPlots.length;p<pLen;p++) {
					ZC.FSSTATUS['g-'+oGraph.iIndex+'-p-'+p] = oGraph.oAttributes['plot'+p+'.visible'];
				}
			}
		}

		
		var oJson = JSON.parse(self.oAttributes['json']), aGS = oJson['graphset'];
		var sh;
		for (g=aGS.length-1;g>=0;g--) {
			if (aGS[g]['generated']) {
				aGS.splice(g, 1);
			} else {
				if (ZC._n_(aGS[g]['shapes']) !== null) {
					for (sh=aGS[g]['shapes'].length-1;sh>=0;sh--) {
						if (aGS[g]['shapes'][sh]['generated']) {
							aGS[g]['shapes'].splice(sh, 1);
						}
					}
				}
				if (ZC._n_(aGS[g]['labels']) !== null) {
					for (sh=aGS[g]['labels'].length-1;sh>=0;sh--) {
						if (aGS[g]['labels'][sh]['generated']) {
							aGS[g]['labels'].splice(sh, 1);
						}
					}
				}
			}
		}

		if (!bFSID) {
			window.scroll(0, 0);
		}
		zingchart.render({
			id : 'zc-fullscreen',
			output : self.sOutput,
			width : ZC.ZCQuery(bFSID?oFSContainer:window).width(),
			height : ZC.ZCQuery(bFSID?oFSContainer:window).height(),
			fullscreenmode : true,
			theme : self.sTheme,
			modules : self.sModules,
			
			
			data : oJson,
			defaults : self.oDefaultsObj,
			defaultsurl : self.sDefaultsUrl
		});
	},
	_api_progression_toggle_ : function(sId, sProgression) {
		var self = this;
		var iIndex = 0, i, iLen, j;
		var bFast = false;
		for (i=0,iLen=self.aGraphs.length;i<iLen;i++) {
			if (sId === self.aGraphs[i].sId) {
				iIndex = i;
				for (j=0;j<self.aGraphs[i].oPlotSet.aPlots.length;j++) {
					if (self.aGraphs[i].oPlotSet.aPlots[j].bFast) {
						bFast = true;
						break;
					}
				}
				var oGraph;
				if (self.aGraphs[iIndex].oSettings['3d'] || bFast) {
					oGraph = self.oData['graphset'][i];
				} else {
					oGraph = self.aGraphs[i].oData;
				}
				for (j=0;j<10;j++) {
					var sName = 'scale-y' + (j===0?'':('-'+j));
					
					if (ZC._n_(oGraph[sName]) === null && ZC._n_(oGraph[ZC._camelcase_(sName)]) === null && self.aGraphs[i].getScaleByName(sName) !== null) {
						oGraph[sName] = {
							'progression' : sProgression
						};
					} else {
						if (ZC._n_(oGraph[sName]) !== null) {
							oGraph[sName]['progression'] = sProgression;
						}
						if (ZC._n_(oGraph[ZC._camelcase_(sName)]) !== null) {
							oGraph[ZC._camelcase_(sName)]['progression'] = sProgression;
						}
					}
				}
			}
		}
		
		delete self.oAttributes['graph' + iIndex + '.zoom'];
		if (self.aGraphs[iIndex].oSettings['3d'] || bFast) {
			self.repaint();
		} else {
			self.aGraphs[iIndex].repaint(true, true);
		}
	},
	_api_guide_toggle_ : function(sId, bStatus) {
		var self = this;
		for (var i=0,iLen=self.aGraphs.length;i<iLen;i++) {
			if (sId === self.aGraphs[i].sId) {
				self.aGraphs[i].bGuideOn = bStatus;
			}
		}
		if (!bStatus) {
			self.oGuide.clear();
		} else {
			var oContainer = ZC.ZCQuery('#' + self.sId + '-top');
			var iX_ = ZC.aPageXY[0] - oContainer.offset().left;
			var iY_ = ZC.aPageXY[1] - oContainer.offset().top;
			var ev = {
				_pageX_ : iX_,
				_pageY_ : iY_,
				type : 'mousemove',
				target : {
					id : self.sId + '-img'
				}
			};
			self.oGuide.zc_guide_mousemove(ev);
		}
	},
	_api_2d3d_toggle_ : function(sId) {
		var self = this;
		var a3DTypes = ['line','area','bar','vbar','hbar','pie','mixed'];
		for (var i=0,iLen=self.aGraphs.length;i<iLen;i++) {
			if (sId === self.aGraphs[i].sId) {
				var oGraph = self.oData['graphset'][i];
				if (oGraph['type'] === 'mixed') {
					for (var j=0,jLen=oGraph['series'].length;j<jLen;j++) {
						var oSeries = oGraph['series'][j];
						oSeries['type'] = oSeries['type'] || 'line';
						if (self.sCoordSpace === '3d') {
							oSeries['type'] = oSeries['type'].replace('3d', '');
						} else if (ZC._indexof_(a3DTypes, oSeries['type']) !== -1) {
							oSeries['type'] = oSeries['type']+'3d';
						}
					}
				} else {
					if (self.sCoordSpace === '3d') {
						oGraph['type'] = oGraph['type'].replace('3d', '');
					} else if (ZC._indexof_(a3DTypes, oGraph['type']) !== -1) {
						oGraph['type'] = oGraph['type']+'3d';
					}
				}
			}
		}
		self.sCoordSpace = (self.sCoordSpace==='3d')?'2d':'3d';
		self.oAttributes['json'] = ZC._trim_(JSON.stringify(self.oData));
		self.repaint();
	},
	_api_reload_ : function(oParams) {
		var self = this, mValue;
		if (zingchart.DEV.GC) {
			self.gc();
		}
		oParams = oParams || {};
		ZC.ZCUtils._trigger_event_('reload', self, {id : self.sId, graphid : oParams['graphid']});
		if (ZC._n_(mValue=oParams['graphid']) !== null) {
			var oGraph = self._api_getgraphbyid_(mValue);
			if (oGraph !== null) {
				self.showProgress(oGraph);
				self.load(oGraph.sId);
			}
		} else {
			self.aHistory = [];
			self.iHistory = -1;
			self.showProgress();
			self.clearGenerated();
			self.load();
		}
	},
	_api_load_ : function(oParams) {
		var self = this, mValue;
		oParams = oParams || {};
		if (ZC._n_(mValue=oParams['graphid']) !== null) {
			var oGraph = self._api_getgraphbyid_(mValue);
			if (oGraph !== null && ZC._n_(oParams['dataurl']) !== null) {
				self.showProgress(oGraph);
				self.load(mValue, oParams['dataurl']);
			}
		} else {
			if (ZC._n_(mValue=oParams['dataurl']) !== null) {
				self.sDataUrl = mValue;
				self.showProgress();
				self.load();
			}
		}
	},
	_api_print_ : function() {
	},
	_api_view_as_image_ : function() {
	},
	_api_getimagedata_ : function() {
	},
	_api_menu_item_click_ : function(oParams) {
		var self = this;
		ZC._cp_(self._api_loader_info_(), oParams);
		ZC.ZCUtils._trigger_event_('menu_item_click', self, oParams);
	},
	_api_callfunction_ : function(oParams) {
		var self = this;
		try {
			var aInfo = ZC.ZCUtils._function_(oParams['function']);
			oParams['function'] = aInfo[0];
			oParams['arguments'] = aInfo[1];
			ZC._cp_(self._api_loader_info_(), oParams);
			eval(oParams['function']).call(self, oParams);
		} catch(oError) {
			self._api_error_(oError, 'JavaScript data loader');
			return false;
		}
	},
	_api_getgraphbyid_ : function(sId) {
		var self = this;
		if (ZC._n_(sId) === null) {
			if (self.aGraphs.length > 0) {
				return self.aGraphs[0];
			}
		} else {
			return self.findGraph(sId);
		}
		return null;
	},
	bind : function(sEvent, oFn) {
		zingchart.bind(this.sId, sEvent, oFn);
	},
	unbind : function(sEvent, oFn) {
		zingchart.unbind(this.sId, sEvent, oFn);
	},
	exec : function(sCall, oParams) {
		return zingchart.exec(this.sId, sCall, oParams);
	},
	gc : function() {
		for (var i=0,iLen=this.aGraphs.length;i<iLen;i++) {
			this.aGraphs[i].gc();
		}
	}
});












ZC.ZCLoader.prototype._api_zoomin_ = function(oParams) {
	var self = this, oGraph, i, iLen, sScaleIdx;
	oParams = oParams || {};
	oParams['action'] = 'zoomin';
	if (ZC._n_(oParams['graphid']) !== null) {
		oGraph = self.findGraph(oParams['graphid']);
	} else {
		oGraph = self.aGraphs[0];
	}
	if (oGraph) {
		for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
			var oScaleX = oGraph.getScales('k')[i];
			sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
			if (oScaleX.bZooming && (ZC._n_(oParams['zoomx'+sScaleIdx])===null || oParams['zoomx'+sScaleIdx])) {
				oParams['zoomx'+sScaleIdx] = true;
				var iDiffIndex = oScaleX.iMaxIndex-oScaleX.iMinIndex;
				var iMinIndex_ = oScaleX.iMinIndex + (iDiffIndex<2?0:ZC._i_(iDiffIndex/4));
				var iMaxIndex_ = oScaleX.iMaxIndex - (iDiffIndex<2?0:ZC._i_(iDiffIndex/4));
				if (iMinIndex_ < iMaxIndex_) {
					oParams['xmin'+sScaleIdx] = iMinIndex_;
					oParams['xmax'+sScaleIdx] = iMaxIndex_;
				}
			}
		}
		for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
			var oScaleY = oGraph.getScales('v')[i];
			sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
			if (oScaleY.bZooming && (ZC._n_(oParams['zoomy'+sScaleIdx])===null || oParams['zoomy'+sScaleIdx])) {
				oParams['zoomy'+sScaleIdx] = true;
				var fDiff = oScaleY.fMax-oScaleY.fMin;
				var fMin_ = oScaleY.fMin+ZC._f_(fDiff/4);
				var fMax_ = oScaleY.fMax-ZC._f_(fDiff/4);
				if (fMin_ < fMax_) {
					oParams['ymin'+sScaleIdx] = fMin_;
					oParams['ymax'+sScaleIdx] = fMax_;
				}
			}
		}
		self._api_zoomto_(oParams);
	}
};
ZC.ZCLoader.prototype._api_zoomout_ = function(oParams) {
	var self = this, oGraph, i, iLen, iDiffIndex, iMinIndex_, iMaxIndex_, sScaleIdx;
	oParams = oParams || {};
	oParams['action'] = 'zoomout';
	oParams['previewscale'] = true;

	if (ZC._n_(oParams['graphid']) !== null) {
		oGraph = self.findGraph(oParams['graphid']);
	} else {
		oGraph = self.aGraphs[0];
	}
	if (oGraph) {
		for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
			var oScaleX = oGraph.getScales('k')[i];
			sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
			if (oScaleX.bZooming && (ZC._n_(oParams['zoomx'+sScaleIdx])===null || oParams['zoomx'+sScaleIdx])) {
				oParams['zoomx'+sScaleIdx] = true;
				if (oGraph.oPreview && oGraph.oPreview.bAsync) {
					
					var iMinIndex = ZC._i_(oGraph.oPreview.oScaleInfo[oScaleX.sName]['values'].length*oGraph.oPreview.iXLeft/oGraph.oPreview.oViewport.iWidth);
					var iMaxIndex = ZC._i_(oGraph.oPreview.oScaleInfo[oScaleX.sName]['values'].length*oGraph.oPreview.iXRight/oGraph.oPreview.oViewport.iWidth);
					iDiffIndex = ZC._max_(2, iMaxIndex-iMinIndex);
					iMinIndex_ = ZC._max_(0, iMinIndex-ZC._i_(iDiffIndex/2));
					iMaxIndex_ = ZC._min_(oGraph.oPreview.oScaleInfo[oScaleX.sName]['values'].length-1, iMaxIndex+ZC._i_(iDiffIndex/2));
					if (iMinIndex_ < iMaxIndex_) {
						oParams['xmin'+sScaleIdx] = iMinIndex_;
						oParams['xmax'+sScaleIdx] = iMaxIndex_;
					}
				} else {
					iDiffIndex = ZC._max_(2, oScaleX.iMaxIndex-oScaleX.iMinIndex);
					iMinIndex_ = ZC._max_(oScaleX.iMinIndex_, oScaleX.iMinIndex-ZC._i_(iDiffIndex/2));
					iMaxIndex_ = ZC._min_(oScaleX.iMaxIndex_, oScaleX.iMaxIndex+ZC._i_(iDiffIndex/2));
					if (iMinIndex_ < iMaxIndex_) {
						oParams['xmin'+sScaleIdx] = iMinIndex_;
						oParams['xmax'+sScaleIdx] = iMaxIndex_;
					}
				}
			}
		}
		for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
			var oScaleY = oGraph.getScales('v')[i];
			sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
			if (oScaleY.bZooming && (ZC._n_(oParams['zoomy'+sScaleIdx])===null || oParams['zoomy'+sScaleIdx])) {
				oParams['zoomy'+sScaleIdx] = true;
				var fDiff = oScaleY.fMax-oScaleY.fMin;
				var fMin_ = ZC._max_(oScaleY.fMin_, oScaleY.fMin-ZC._f_(fDiff/2));
				var fMax_ = ZC._min_(oScaleY.fMax_, oScaleY.fMax+ZC._f_(fDiff/2));
				if (fMin_ < fMax_) {
					oParams['ymin'+sScaleIdx] = fMin_;
					oParams['ymax'+sScaleIdx] = fMax_;
				}
			}
		}
		self._api_zoomto_(oParams);
	}
};
ZC.ZCLoader.prototype._api_viewall_ = function(oParams) {
	var self = this, oScale, oGraph, i, iLen, sScaleIdx;
	oParams = oParams || {};
	if (ZC._n_(oParams['graphid']) !== null) {
		oGraph = self.findGraph(oParams['graphid']);
	} else {
		oGraph = self.aGraphs[0];
	}
	oParams['action'] = 'viewall';
	for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
		oScale = oGraph.getScales('k')[i];
		sScaleIdx = (oScale.iIndex===1)?'':('-'+oScale.iIndex);
		oParams['zoomx'+sScaleIdx] = true;
		oParams['xmin'+sScaleIdx] = null;
		oParams['xmax'+sScaleIdx] = null;
		oGraph.oData[oScale.sName]['zoom-to'] = null;
		oGraph.oData[oScale.sName]['zoom-to-values'] = null;
		if (oGraph.oPreview && oGraph.oPreview.bAsync) {
			var aValues = oGraph.oPreview.oScaleInfo[oScale.sName]['values'];
			oParams['kmin'+sScaleIdx+'-async'] = aValues[0];
			oParams['kmax'+sScaleIdx+'-async'] = aValues[aValues.length-1];
		}
	}
	for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
		oScale = oGraph.getScales('v')[i];
		if (oGraph.oData[oScale.sName]) {
			oGraph.oData[oScale.sName]['zoom-to'] = null;
			oGraph.oData[oScale.sName]['zoom-to-values'] = null;
		}
		
		oScale.iDecimals = (ZC._n_(oScale.oAttributes['decimals']) !== null)?oScale.oAttributes['decimals']:0;
		sScaleIdx = (oScale.iIndex===1)?'':('-'+oScale.iIndex);
		oScale.aZoomTo = null;
		oParams['zoomy'+sScaleIdx] = true;
		oParams['ymin'+sScaleIdx] = null;
		oParams['ymax'+sScaleIdx] = null;
	}

	self._api_zoomto_(oParams);
};
ZC.ZCLoader.prototype._api_zoomto_ = function(oParams) {
	var self = this, mValue, oGraph, aValues, oScaleX, oScaleY, iXMin, iXMax, i, iLen, sScaleIdx, e, eLen, oPlotNode;

	oParams = oParams || {};
	oParams['id'] = self.sId;

	if (ZC._n_(oParams['graphid']) !== null) {
		oGraph = self.findGraph(oParams['graphid']);
	} else {
		oGraph = self.aGraphs[0];
	}
	if (oGraph) {

		if (typeof(oParams['scroll']) === 'undefined') {
			
			ZC.ZCHtmlUtils._clear_(ZC._id_(oGraph.sId + '-scroll-x-c'), oGraph.oParent.sOutput, oGraph.iX, oGraph.iY, oGraph.iWidth, oGraph.iHeight);
			ZC.ZCHtmlUtils._clear_(ZC._id_(oGraph.sId + '-scroll-y-c'), oGraph.oParent.sOutput, oGraph.iX, oGraph.iY, oGraph.iWidth, oGraph.iHeight);
		}

		if (oGraph.oPreview) {
			oGraph.oPreview.bInit = false;
		}

		var oPreserveZoom = {};

		for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
			oScaleX = oGraph.getScales('k')[i];
			sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
			if (ZC._n_(oParams['kmin'+sScaleIdx]) !== null && ZC._n_(oParams['kmax'+sScaleIdx]) !== null) {
				var bMin = false, bMax = false;
				for (var k=0,kLen=oScaleX.aValues.length;k<kLen;k++) {
					if (oParams['kmin'+sScaleIdx] <= oScaleX.aValues[k] && !bMin) {
						oParams['xmin'+sScaleIdx] = k;
						bMin = true;
					}
					if (oParams['kmax'+sScaleIdx] <= oScaleX.aValues[k] && !bMax) {
						oParams['xmax'+sScaleIdx] = k;
						bMax = true;
					}
					if (bMin && bMax) {
						break;
					}
				}
				if (!bMin) {
					oParams['xmin'+sScaleIdx] = 0;
				}
				if (!bMax) {
					oParams['xmax'+sScaleIdx] = oScaleX.aValues.length - 1;
				}
				oParams['zoomx'+sScaleIdx] = true;
			} else {
				aValues = (oGraph.oPreview && oGraph.oPreview.bAsync && oParams['previewscale'])?oGraph.oPreview.oScaleInfo[oScaleX.sName]['values']:oScaleX.aValues;
				if (ZC._n_(mValue=aValues[oParams['xmin'+sScaleIdx]]) !== null) {
					oParams['kmin'+sScaleIdx] = mValue;
				}
				if (ZC._n_(mValue=aValues[oParams['xmax'+sScaleIdx]]) !== null) {
					oParams['kmax'+sScaleIdx] = mValue;
				}
			}
		}

		var bContinue = ZC.ZCUtils._trigger_event_('zoom', oGraph.oParent, oParams, true);

		
		if (oParams.async) {
			return;
		} else {
			if (oGraph.oPreview && oGraph.oPreview.bAsync) {
				aValues = oGraph.oPreview.oScaleInfo[oScaleX.sName]['values'];
				
				var iScaleMin = ZC._min_a_(aValues), iScaleMax = ZC._max_a_(aValues);
				if (ZC._n_(oParams['kmin']) !== null && typeof(oParams['kmin']) !== 'undefined') {
					iXMin = ZC._i_(oGraph.oPreview.oViewport.iWidth * (oParams['kmin']-iScaleMin)/(iScaleMax-iScaleMin));
					iXMin = ZC._max_(iXMin, 0);
				} else {
					iXMin = 0;
				}
				if (ZC._n_(oParams['kmax']) !== null && typeof(oParams['kmax']) !== 'undefined') {
					iXMax = ZC._i_(oGraph.oPreview.oViewport.iWidth * (oParams['kmax']-iScaleMin)/(iScaleMax-iScaleMin));
					iXMax = ZC._min_(iXMax, oGraph.oPreview.oViewport.iWidth);
				} else {
					iXMax = oGraph.oPreview.oViewport.iWidth;
				}
				oGraph.oPreview.update(iXMin, iXMax, oGraph.oPreview.iYTop, oGraph.oPreview.iYBottom);
			}
		}

		if (bContinue || typeof(bContinue) === 'undefined') {
			for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
				oScaleX = oGraph.getScales('k')[i];
				sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
				if (oParams['zoomx'+sScaleIdx]) {
					oScaleX.zoomTo(oParams['xmin'+sScaleIdx], oParams['xmax'+sScaleIdx]);
					oPreserveZoom['xmin'+sScaleIdx] = oParams['xmin'+sScaleIdx];
					oPreserveZoom['xmax'+sScaleIdx] = oParams['xmax'+sScaleIdx];
				}
			}

			for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
				oScaleY = oGraph.getScales('v')[i];
				sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
				if (oParams['zoomy'+sScaleIdx] && ZC._n_(oScaleY) !== null) {
					oScaleY.zoomTo(oParams['ymin'+sScaleIdx], oParams['ymax'+sScaleIdx]);
					oPreserveZoom['ymin'+sScaleIdx] = oParams['ymin'+sScaleIdx];
					oPreserveZoom['ymax'+sScaleIdx] = oParams['ymax'+sScaleIdx];
				}
			}

			self.oZoom.parse();

			if (self.oZoom.bPreserveZoom) {
				self.oAttributes['graph' + oGraph.iIndex + '.zoom'] = oPreserveZoom;
			}
			if (oGraph.oPreview && !oParams['preview']) {
				oGraph.oPreview.update(oParams['xmin'], oParams['xmax'], oParams['ymin'], oParams['ymax'], true);
			}

			oGraph.clear(true);
			
			if (oScaleY && oScaleY.bAutoFit) {
				var fMinValue = ZC.MAX;
				var fMaxValue = -ZC.MAX;
				for (var p=0,pLen=oGraph.oPlotSet.aPlots.length;p<pLen;p++) {
					if (oGraph.oPlotSet.aPlots[p].bVisible && ZC._indexof_(oGraph.oPlotSet.aPlots[p].aScales, oScaleY.sName) !== -1) {
						if (oScaleX.bKeyValues) {
							for (i=0,iLen=oGraph.oPlotSet.aPlots[p].aPlotNodes.length;i<iLen;i++) {
								if ((oPlotNode=oGraph.oPlotSet.aPlots[p].aPlotNodes[i])) {
									if (ZC._btw_(oPlotNode.fKeyValue, oScaleX.aValues[oScaleX.iMinIndex], oScaleX.aValues[oScaleX.iMaxIndex])) {
										fMinValue = ZC._min_(fMinValue, oPlotNode.fAbsoluteValue);
										fMaxValue = ZC._max_(fMaxValue, oPlotNode.fAbsoluteValue);
										for (e=0,eLen=oPlotNode.aExtraValues.length;e<eLen;e++) {
											fMinValue = ZC._min_(fMinValue, oPlotNode.aExtraValues[e]);
											fMaxValue = ZC._max_(fMaxValue, oPlotNode.aExtraValues[e]);
										}
									}
								}
							}
						} else {
							for (i=oScaleX.iMinIndex;i<=oScaleX.iMaxIndex;i++) {
								if ((oPlotNode=oGraph.oPlotSet.aPlots[p].aPlotNodes[i])) {
									fMinValue = ZC._min_(fMinValue, oPlotNode.fAbsoluteValue);
									fMaxValue = ZC._max_(fMaxValue, oPlotNode.fAbsoluteValue);
									for (e=0,eLen=oPlotNode.aExtraValues.length;e<eLen;e++) {
										fMinValue = ZC._min_(fMinValue, oPlotNode.aExtraValues[e]);
										fMaxValue = ZC._max_(fMaxValue, oPlotNode.aExtraValues[e]);
									}
								}
							}
						}
					}
				}
				oScaleY.setupRange(fMinValue, fMaxValue, true);
				oScaleY.setupStepSize();
			}
			var bZoomTo = ZC._b_(oParams['zoomto']);
			oGraph.oAttributes['skip-preview'] = true;

			var aDir = ['top', 'right', 'bottom', 'left'];
			for (i=0;i<aDir.length;i++) {
				if (oGraph.oAttributes['plotarea.d-margin-' + aDir[i]] || ZC._b_(oGraph.oPlotArea.oData['adjust-layout'])) {
					oGraph.oData['plotarea']['margin-' + aDir[i]] = 'dynamic';
					oGraph.oAttributes['plotarea.d-margin'] = oGraph.oAttributes['plotarea.d-margin-' + aDir[i]] = true;
				}
			}

			

			oGraph.paint(!bZoomTo);
			self.oZoom.oGraph = null;
		}
	}
};

zingchart.exec_html5_zoom = function(sId, sCall, oParams) {
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var i, iLen, oGraph, oInfo, oScaleX, oScaleY, sScaleIdx, xmin, xmax;
	var oLoader = zingchart.getLoader(sId);
	if (ZC._n_(oParams['preservezoom']) !== null) {
		oLoader.oAttributes['preservezoom'] = ZC._b_(oParams['preservezoom']);
	}
	if (oLoader) {
		switch (sCall) {
			case 'getzoom':
				oInfo = {}; 
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					for (i=0,iLen=oGraph.aScales.length;i<iLen;i++) {
						var oScale = oGraph.aScales[i];
						if (oScale.sType === 'k') {
							oInfo[oScale.sName] = {
								xmin : oScale.iMinIndex,
								xmax : oScale.iMaxIndex,
								vmin : oScale.aValues[oScale.iMinIndex],
								vmax : oScale.aValues[oScale.iMaxIndex]
							};
						} else {
							oInfo[oScale.sName] = {
								ymin : oScale.fMin,
								ymax : oScale.fMax,
								vmin : oScale.aValues[oScale.iMinIndex],
								vmax : oScale.aValues[oScale.iMaxIndex]
							};
						}
					}
				}
				return oInfo;
			case 'zoomin':
				oLoader._api_zoomin_(oParams);
				break;
			case 'zoomout':
				oLoader._api_zoomout_(oParams);
				break;
			case 'zoomto':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (ZC._n_(oParams['xall']) !== null && oParams['xall']) {
					for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
						oScaleX = oGraph.getScales('k')[i];
						sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
						oParams['xmin'+sScaleIdx] = oParams['xmin'] || null;
						oParams['xmax'+sScaleIdx] = oParams['xmax'] || null;
						oParams['kmin'+sScaleIdx] = oParams['kmin'] || null;
						oParams['kmax'+sScaleIdx] = oParams['kmax'] || null;
					}
				}
				for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
					oScaleX = oGraph.getScales('k')[i];
					sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
					if ((oParams['xmin'+sScaleIdx]) !== null || ZC._n_(oParams['xmax'+sScaleIdx]) !== null || ZC._n_(oParams['kmin'+sScaleIdx]) !== null || ZC._n_(oParams['kmax'+sScaleIdx]) !== null) {
						oParams['zoomx'+sScaleIdx] = true;
					}
				}
				if (ZC._n_(oParams['yall']) !== null && oParams['yall']) {
					for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
						oScaleY = oGraph.getScales('v')[i];
						sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
						oParams['ymin'+sScaleIdx] = oParams['ymin'] || null;
						oParams['ymax'+sScaleIdx] = oParams['ymax'] || null;
					}
				}
				for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
					oScaleY = oGraph.getScales('v')[i];
					sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
					if (ZC._n_(oParams['ymin'+sScaleIdx]) !== null || ZC._n_(oParams['ymax'+sScaleIdx]) !== null) {
						oParams['zoomy'+sScaleIdx] = true;
					}
				}
				oLoader._api_zoomto_(oParams);
				break;
			case 'zoomtovalues':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (ZC._n_(oParams['xall']) !== null && oParams['xall']) {
					for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
						oScaleX = oGraph.getScales('k')[i];
						sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
						oParams['xmin'+sScaleIdx] = oParams['xmin'] || null;
						oParams['xmax'+sScaleIdx] = oParams['xmax'] || null;
					}
				}
				for (i=0,iLen=oGraph.getScales('k').length;i<iLen;i++) {
					oScaleX = oGraph.getScales('k')[i];
					sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
					if (ZC._n_(oParams['xmin'+sScaleIdx]) !== null || ZC._n_(oParams['xmax'+sScaleIdx]) !== null) {
						
						if (oGraph.oPreview && oGraph.oPreview.bAsync) {
							oParams['previewscale'] = true;
							oParams['kmin'+sScaleIdx+'-async'] = oParams['xmin'+sScaleIdx];
							oParams['xmin'+sScaleIdx] = ZC._closest_a_(oGraph.oPreview.oScaleInfo[oScaleX.sName]['values'], oParams['xmin'+sScaleIdx]);
						} else {
							if ((xmin=ZC._indexof_(oScaleX.aValues, oParams['xmin'+sScaleIdx])) !== -1) {
								oParams['xmin'+sScaleIdx] = xmin;
							}
						}

						if (oGraph.oPreview && oGraph.oPreview.bAsync) {
							oParams['previewscale'] = true;
							oParams['kmax'+sScaleIdx+'-async'] = oParams['xmax'+sScaleIdx];
							oParams['xmax'+sScaleIdx] = ZC._closest_a_(oGraph.oPreview.oScaleInfo[oScaleX.sName]['values'], oParams['xmax'+sScaleIdx]);
						} else {
							if ((xmax=ZC._indexof_(oScaleX.aValues, oParams['xmax'+sScaleIdx])) !== -1) {
								oParams['xmax'+sScaleIdx] = xmax;
							}
						}
						
						oParams['zoomx'+sScaleIdx] = true;
					}
				}
				if (ZC._n_(oParams['yall']) !== null && oParams['yall']) {
					for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
						oScaleY = oGraph.getScales('v')[i];
						sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
						oParams['ymin'+sScaleIdx] = oParams['ymin'] || null;
						oParams['ymax'+sScaleIdx] = oParams['ymax'] || null;
					}
				}
				for (i=0,iLen=oGraph.getScales('v').length;i<iLen;i++) {
					oScaleY = oGraph.getScales('v')[i];
					sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
					if (ZC._n_(oParams['ymin'+sScaleIdx]) !== null || ZC._n_(oParams['ymax'+sScaleIdx]) !== null) {
						oParams['zoomy'+sScaleIdx] = true;
					}
				}
				oLoader._api_zoomto_(oParams);
				break;
			case 'viewall':
				oLoader._api_viewall_(oParams);
				break;
		}
	}
	return null;
};











ZC.ZCModuleExport = {};

ZC.ZCUtils._create_image_data_ = function(mCanvas, iWidth, iHeight, sFormat) {
	sFormat = sFormat || 'png';
	if (sFormat === 'jpg') { sFormat = 'jpeg'; }
	var oCanvas = document.createElement('canvas');
	oCanvas.width = iWidth;
	oCanvas.height = iHeight;
	oCanvas.style.width = iWidth + 'px';
	oCanvas.style.height = iHeight + 'px';
	var oCtx = oCanvas.getContext('2d');
	if (!(mCanvas instanceof Array)) {
		mCanvas = [mCanvas];
	}
	for (var c=0,cLen=mCanvas.length;c<cLen;c++) {
		if (mCanvas[c].className.indexOf('zc-no-print') === -1) {
			oCtx.drawImage(mCanvas[c], 0, 0, mCanvas[c].width, mCanvas[c].height, 0, 0, iWidth, iHeight);
		}
	}
	var sImageData = oCanvas.toDataURL('image/' + sFormat);
	return sImageData;
};
ZC.ZCUtils._save_as_image_ = function(mCanvas, iWidth, iHeight, sFormat, bMakeImage) {
	if (ZC._n_(bMakeImage) === null) { bMakeImage = false; }
	var sImageData = ZC.ZCUtils._create_image_data_(mCanvas, iWidth, iHeight, sFormat);
	if (bMakeImage) {
		var oImage = document.createElement('img');
		oImage.src = sImageData;
		return oImage;
	} else {
		sImageData = sImageData.replace('image/' + sFormat, 'image/octet-stream');
		document.location.href = sImageData;
	}
};
ZC.ZCLoader.prototype._api_print_ = function() {
    var self = this;
	var aDisplay = [];
	if (self.bPrints) {
		return;
	}
	self.bPrints = true;
	var aChildNodes = document.body.childNodes;
	var sBodyCssBgColor = ZC.ZCQuery(document.body).css('background-color');
	var sBodyCssBgImage = ZC.ZCQuery(document.body).css('background-image');
	ZC.ZCQuery(document.body).css('background-color', '#fff').css('background-image', 'none');
	for (var i=0,l=aChildNodes.length;i<l;i++) {
		if (aChildNodes[i].nodeType === 1) {
			aDisplay[i] = aChildNodes[i].style.display;
			aChildNodes[i].style.display = 'none';
		}
	}
	document.body.appendChild(ZC._id_(self.sId + '-top'));
	window.setTimeout(function() {
		window.print();
		window.setTimeout(function() {
			ZC.ZCQuery(document.body).css('background-color', sBodyCssBgColor).css('background-image', sBodyCssBgImage);
			ZC._id_(self.sId).appendChild(ZC._id_(self.sId + '-top'));
			for (var i=0,l=aChildNodes.length;i<l;i++) {
				if (aChildNodes[i].nodeType === 1) {
					aChildNodes[i].style.display = aDisplay[i];
				}
			}
			self.bPrints = false;
		}, 1000);
	}, 50);
};
ZC.ZCLoader.prototype._api_view_as_image_ = function(sFormat, oOptions, bSilent, oCallback) {
	var self = this;
	oOptions = oOptions || {};
	if (typeof(bSilent) === 'undefined') { bSilent = false; }
	if (ZC._id_(self.sId + '-viewimage')) {
		return;
	}
	sFormat = sFormat || 'png';
	var bDownload = oOptions['download'];

	
	ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-guide-c'), self.sOutput, 0, 0, self.iWidth, self.iHeight);
	ZC.ZCQuery('.zc-guide-label').remove();

	var bClose = ((self.sOutput === 'canvas' || zingchart.AJAXEXPORT) && sFormat !== 'pdf' && sFormat !== 'svg');
	var oViewImage, oViewImageClose;

	if (bClose && !bSilent && !bDownload) {
		oViewImage = ZC.ZCHtmlUtils._div_({
			cls : 'zc-abs zc-viewimage zc-style',
			id : self.sId + '-viewimage',
			p : ZC._id_(self.sId + '-top'),
			
			wh : self.iWidth + '/' + self.iHeight
		});
		oViewImageClose = ZC.ZCHtmlUtils._div_({
			id : self.sId + '-viewimage-close',
			p : oViewImage,
			tl : 5 + '/' + (self.iWidth-15),
			html : ZC.ZCLabels['viewimage-close']
		});
	}

	function _post_() {
		var oFields = {
			svg : sSvg,
			w : self.iWidth,
			h : self.iHeight,
			t : sFormat
		};
		ZC._cp_(oOptions, oFields);

		var oDoc, p;

		if (zingchart.AJAXEXPORT && sFormat !== 'pdf' && sFormat !== 'svg' && !bDownload) {
			var sData = 'base64=1&';
			for (p in oFields) {
				sData += p + '=' + encodeURIComponent(oFields[p]) + '&';
			}
			ZC.ZCQuery.ajax({
				type : 'post',
				url : zingchart.EXPORTURL,
				data : sData,
				success : function(sResponse, sStatus, oXhr) {
					self._api_enable_();
					if (bSilent) {
						if (oCallback) {
							oCallback(sResponse, sStatus, oXhr);
						}
					} else {
						var oImage = document.createElement('img');
						oImage.src = sResponse;
						oImage.id = self.sId + '-print-' + sFormat;
						oViewImage.appendChild(oImage);
					}
				}
			});
		} else {

			if (ZC._id_(self.sId + '-export')) {
				ZC.ZCHtmlUtils._remove_(self.sId + '-export');
			}

			var oExport = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-style',
				id : self.sId + '-export',
				p : ZC._id_(self.sId + '-top'),
				display : 'none'
			});

			if (ZC._n_(oFields['uid']) !== null && ZC._n_(oFields['page']) !== null) {
				oDoc = ZC.ZCHtmlUtils._iframe_(ZC._id_(self.sId + '-export'));
			} else {
				oDoc = document;
			}
			var oForm = oDoc.createElement('FORM');
			oForm.action = zingchart.EXPORTURL;
			oForm.method = 'post';
			oForm.enctype = 'multipart/form-data';
			if (ZC._n_(oFields['uid']) !== null && ZC._n_(oFields['page']) !== null) {
				oDoc.body.appendChild(oForm);
			} else {
				oExport.appendChild(oForm);
			}
			oForm.style.display = 'none';
			for (p in oFields) {
				var oInput = oDoc.createElement('INPUT');
				oInput.type = 'hidden';
				oInput.name = p;
				oInput.value = oFields[p];
				oForm.appendChild(oInput);
			}
			oForm.submit();
			oForm = null;

			if (ZC._n_(oFields['uid']) !== null && ZC._n_(oFields['page']) !== null) {
				window.setTimeout(function() {
					ZC.ZCQuery('#' + self.sId + '-export').remove();
				}, 60000);
			}

			window.setTimeout(function() {
				
				self._api_enable_();
			}, 1000);
		}
	}

	if (self.sOutput === 'canvas' && sFormat !== 'pdf' && sFormat !== 'svg') {
		var oCanvas = document.createElement('canvas');
		oCanvas.width = self.iWidth;
		oCanvas.height = self.iHeight;
		for (var g=0,gLen=self.aGraphs.length;g<gLen;g++) {
			for (var l=0,lLen=self.aGraphs[g].aLabels.length;l<lLen;l++) {
				self.aGraphs[g].aLabels[l].paintPrintVersion(oCanvas);
			}
		}

		var aCanvas = [];
		ZC.ZCQuery('#' + self.sId + ' canvas').each(function() {
			if (ZC._indexof_([self.sId + '-guide-c', self.sId + '-trigger-c'], this.id) === -1) {
				aCanvas.push(this);
			}
		});
		aCanvas.push(oCanvas);
		var oImage = ZC.ZCUtils._save_as_image_(aCanvas, self.iWidth, self.iHeight, sFormat, true);
		oImage.id = self.sId + '-print-' + sFormat;
		oViewImage.appendChild(oImage);

	} else {

		if (!bSilent) {
			self._api_disable_(ZC.ZCLabels['export-wait']);
		}

		var sSvg = ZC._id_(self.sId + '-top').innerHTML;

		if (self.sOutput === 'vml' || (self.sOutput === 'canvas' && (sFormat === 'pdf' || sFormat === 'svg'))) {

			var oDiv = document.createElement('div');
			var sExpSvgId = 'zc-export-svg-' + self.sId;
			oDiv.id = sExpSvgId;
			oDiv.style.display = 'none';
			document.body.appendChild(oDiv);

			zingchart.render({
				id : sExpSvgId,
				output : '!svg',
				imggen : true,
				width : self.iWidth,
				height : self.iHeight,
				data : self.oAttributes['json'],
				defaults : self.oDefaultsObj,
				theme : self.sTheme,
				hideprogresslogo : true,
				events : {
					load : function() {
						window.setTimeout(function() {
							var oExpLoader = zingchart.getLoader(sExpSvgId);
							if (oExpLoader.oAttributes['dynamic-objects']) {
								var iTick = window.setInterval(function() {
									if (oExpLoader.oAttributes['dynamic-objects'] === 'ready') {
										window.clearInterval(iTick);
										sSvg = ZC._id_(sExpSvgId+'-top').innerHTML;
										zingchart.exec(sExpSvgId, 'destroy');
										_post_();
									}
								}, 100);
							} else {
								sSvg = ZC._id_(sExpSvgId+'-top').innerHTML;
								zingchart.exec(sExpSvgId, 'destroy');
								_post_();
							}
						}, 100);
					}
				}
			});

		} else if (self.sOutput === 'svg') {
			_post_();
		}

	}

	if (bClose && !bSilent) {
		ZC.ZCQuery(oViewImageClose).css('cursor', 'pointer').css('left', (self.iWidth - 15 - ZC.ZCQuery(oViewImageClose).width()) + 'px');
		ZC.ZCQuery(oViewImageClose).bind('click', function() {
			ZC.ZCQuery(oViewImage).remove();
		});
	}
};
ZC.ZCLoader.prototype._api_getimagedata_ = function(sFormat) {
	var self = this;
	sFormat = sFormat || 'png';
	var aCanvas = [];
	ZC.ZCQuery('#' + self.sId + ' canvas').each(function() {
		if (ZC._indexof_([self.sId + '-guide-c', self.sId + '-tooltip-c'], this.id) === -1) {
			aCanvas.push(this);
		}
	});
	return ZC.ZCUtils._create_image_data_(aCanvas, self.iWidth, self.iHeight, sFormat);
};

zingchart.exec_html5_export = function(sId, sCall, oParams) {
	var mValue, sUrl, oCallback, i, iLen, sFormat, oOptions;
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}

	function _export_(sImageData) {
		ZC.ZCQuery.ajax({
			type : 'post',
			url : sUrl,
			data : sImageData,
			success : function(sResponse, sStatus, oXhr) {
				if (oCallback) {
					oCallback(sResponse, sStatus, oXhr);
				}
			}
		});
	}
	
	var oLoader = zingchart.getLoader(sId);
	if (oLoader) {
		switch (sCall) {
			case 'getimagedata':
				if (oLoader.sOutput !== 'canvas' && !zingchart.AJAXEXPORT) {
					return -1;
				}
				sFormat = 'png';
				if (ZC._n_(mValue=oParams['format']) !== null) {
					sFormat = mValue;
				}
				if (ZC._n_(mValue=oParams['filetype']) !== null) {
					sFormat = mValue;
				}
				if (sFormat === 'jpg') { sFormat = 'jpeg'; }
				if (oLoader.sOutput === 'canvas') {
					return oLoader._api_getimagedata_(sFormat);
				} else {
					oLoader._api_view_as_image_(sFormat, {}, true, oParams['callback']);
				}
				break;
			case 'exportimage':
			case 'saveasimage':
				if (!oParams['download']) {
					if (oLoader.sOutput !== 'canvas' && !zingchart.AJAXEXPORT) {
						return -1;
					}
				}
				sFormat = 'png';
				oOptions = {};
				if (ZC._n_(mValue=oParams['options']) !== null) {
					oOptions = mValue;
				}
				if (ZC._n_(mValue=oParams['uid']) !== null) {
					oOptions['uid'] = mValue;
				}
				if (ZC._n_(mValue=oParams['page']) !== null) {
					oOptions['page'] = mValue;
				}
				if (ZC._n_(mValue=oParams['format']) !== null) {
					sFormat = mValue;
				}
				if (ZC._n_(mValue=oParams['filetype']) !== null) {
					sFormat = mValue;
				}
				sUrl = oLoader.oAttributes['exportimageurl'] || '';
				if (ZC._n_(mValue=oParams['url']) !== null) {
					sUrl = mValue;
				}
				oCallback = null;
				if (ZC._n_(mValue=oParams['callback']) !== null) {
					oCallback = mValue;
				}
				if (sFormat === 'jpg') { sFormat = 'jpeg'; }

				if (oParams['download'] && (oLoader.sOutput !== 'canvas' || sFormat === 'pdf')) {
					oOptions['download'] = true;
					oLoader._api_view_as_image_(sFormat, oOptions);
					return;
				}

				if (sUrl !== '') {
					if (oLoader.sOutput === 'canvas') {
						return _export_(oLoader._api_getimagedata_(sFormat));
					} else {
						oLoader._api_view_as_image_(sFormat, oOptions, true, function(sImageData) {
							return _export_(sImageData);
						});
					}
				}
				break;
			case 'exportdata':
				sUrl = oLoader.oAttributes['exportdataurl'] || '';
				if (ZC._n_(mValue=oParams['url']) !== null) {
					sUrl = mValue;
				}
				var sCsv = '';
				for (var g=0,gLen=oLoader.aGraphs.length;g<gLen;g++) {
					sCsv += ',';
					var oGraph = oLoader.aGraphs[g], aPlots = oGraph.oPlotSet.aPlots;
					for (var p=0,pLen=aPlots.length;p<pLen;p++) {
						sCsv += '"' + (aPlots[p].sText || '').replace('"', '\"') + '",';
					}
					sCsv = sCsv.substr(0, sCsv.length-1);
					sCsv += "\n";
					var oScaleX = oGraph.getScales('k')[0];
					for (var j=0,jLen=oScaleX.aValues.length;j<jLen;j++) {
						sCsv += oScaleX.aValues[j] + ',';
						for (i=0,iLen=aPlots.length;i<iLen;i++) {
							var oNode = aPlots[i].getNode(j);
							if (oNode) {
								sCsv += oNode.sValue;
							}
							sCsv += ',';
							
						}
						sCsv = sCsv.substr(0, sCsv.length-1);
						sCsv += "\n";
					}
					if (gLen > 1 && g < gLen-1) {
						sCsv += "\n$\n\n";
					}
				}
				if (sUrl !== '') {
					oCallback = null;
					if (ZC._n_(mValue=oParams['callback']) !== null) {
						oCallback = mValue;
					}
					ZC.ZCQuery.ajax({
						type : 'post',
						url : sUrl,
						data : sCsv,
						success : function(sResponse, sStatus, oXhr) {
							if (oCallback) {
								oCallback(sResponse, sStatus, oXhr);
							}
						}
					});
				} else {
					return sCsv;
				}
				break;
		}
	}
	return null;
};











ZC.ZCModuleDebug = {};

ZC.ZCUtils._format_json_ = function(sJson) {
	var sJson_ = '';
	sJson = sJson.replace(/\t|\r|\n/g, '');
	var bValue = false;
	var bArray = false;
	var iLevel = 0;
	var sChar, sChar_ = '';
	for (var i=0,iLen=sJson.length;i<iLen;i++) {
		sChar = sJson.substr(i, 1);
		switch (sChar) {
			case '"':
				bValue = !bValue;
				sJson_ += sJson.substr(i, 1);
				sChar_ = sChar;
				break;
			case '{':
				sJson_ += sJson.substr(i, 1);
				if (!bValue) {
					sJson_ += "\n" + (new Array(iLevel+1).join('    '));
					iLevel++;
					sChar_ = sChar;
				}
				break;
			case '}':
				if (!bValue) {
					sJson_ += "\n" + (new Array(iLevel-2+1).join('    '));
					iLevel--;
					sChar_ = sChar;
				}
				sJson_ += sJson.substr(i, 1);
				break;
			case '[':
				var iPos1 = sJson.indexOf(']', i);
				var iPos2a = sJson.indexOf('}', i);
				iPos2a = (iPos2a === -1)?999999:iPos2a;
				var iPos2b = sJson.indexOf('{', i);
				iPos2b = (iPos2b === -1)?999999:iPos2b;
				var iPos2 = ZC._min_(iPos2a, iPos2b);
				if (iPos1 < iPos2) {
					bArray = true;
					sJson_ += sJson.substr(i, 1);
				} else {
					bArray = false;
					sJson_ += sJson.substr(i, 1);
					sJson_ += "\n" + (new Array(iLevel+1).join('    '));
					iLevel++;
				}
				sChar_ = sChar;
				break;
			case ']':
				if (bArray) {
					bArray = false;
				}
				if (sChar_ === '}') {
					iLevel--;
					sJson_ += "\n" + (new Array(iLevel-1+1).join('    '));
				}
				sJson_ += sJson.substr(i, 1);
				sChar_ = sChar;
				break;
			case ' ':
				if (bValue) {
					sJson_ += sJson.substr(i, 1);
					sChar_ = sChar;
				}
				break;
			case ',':
				sJson_ += sJson.substr(i, 1);
				if (!bValue && !bArray) {
					sJson_ += "\n" + (new Array(iLevel-1+1).join('    '));
				}
				sChar_ = sChar;
				break;
			default:
				sJson_ += sJson.substr(i, 1);
				sChar_ = sChar;
				break;
		}
	}
	return sJson_;
};
ZC.ZCLoader.prototype._api_viewsource_ = function() {
	var self = this;
	ZC.ZCUtils._trigger_event_('source_show', self, self._api_loader_info_());
	var oViewSource = ZC.ZCHtmlUtils._div_({
		cls : 'zc-abs zc-viewsource zc-style',
		id : self.sId + '-viewsource',
		p : ZC._id_(self.sId + '-top'),
		wh : (self.iWidth-(ZC.quirks?0:10)) + '/' + (self.iHeight-(ZC.quirks?0:10))
	});
	oViewSource.innerHTML = ZC._h_('<div class="zc-form-row-label zc-form-s1">&nbsp;<a href="javascript:void(0)" id="' + self.sId + '-viewsource-jsonsource" class="zc-tab-active">' + ZC.ZCLabels['viewsource-jsonsource'] + '</a>&nbsp;<a href="javascript:void(0)" id="' + self.sId + '-viewsource-originalsource" class="zc-tab-inactive">' + ZC.ZCLabels['viewsource-originalsource'] + '</a></div><div class="zc-form-row-element"><textarea id="' + self.sId + '-viewsource-json" style="width:' + (self.iWidth-35) + 'px;height:' + (self.iHeight-95) + 'px;"></textarea></div><div class="zc-form-row-element zc-form-row-last" id="' + self.sId + '-viewsource-actions"><input type="button" value="' + ZC.ZCLabels['viewsource-close'] + '" id="' + self.sId + '-viewsource-close" /></div>');
	if (zingchart.EDITSOURCE) {
		
		ZC._id_(self.sId + '-viewsource-actions').innerHTML += '<input type="button" value="' + ZC.ZCLabels['viewsource-apply'] + '" id="' + self.sId + '-viewsource-apply" />';
	}
	ZC.ZCQuery('#' + self.sId + '-viewsource-json').val(ZC.ZCUtils._format_json_(self.oAttributes['json']));
	ZC.ZCQuery('#' + self.sId + '-viewsource-jsonsource').bind('click', function() {
		ZC._id_(self.sId + '-viewsource-jsonsource').className = 'zc-tab-active';
		ZC._id_(self.sId + '-viewsource-originalsource').className = 'zc-tab-inactive';
		ZC.ZCQuery('#' + self.sId + '-viewsource-json').val(ZC.ZCUtils._format_json_(self.oAttributes['json']));
	});
	ZC.ZCQuery('#' + self.sId + '-viewsource-originalsource').bind('click', function() {
		ZC._id_(self.sId + '-viewsource-jsonsource').className = 'zc-tab-inactive';
		ZC._id_(self.sId + '-viewsource-originalsource').className = 'zc-tab-active';
		ZC.ZCQuery('#' + self.sId + '-viewsource-json').val(ZC.ZCUtils._format_json_(self.oAttributes['source']));
	});
	ZC.ZCQuery('#' + self.sId + '-viewsource-close').bind('click', function() {
		ZC.ZCUtils._trigger_event_('source_hide', self, self._api_loader_info_());
		ZC.ZCHtmlUtils._remove_(self.sId + '-viewsource');
	});
	if (zingchart.EDITSOURCE) {
		ZC.ZCQuery('#' + self.sId + '-viewsource-apply').bind('click', function() {
			ZC.ZCUtils._trigger_event_('source_hide', self, self._api_loader_info_());
			var sJson = ZC.ZCQuery('#' + self.sId + '-viewsource-json').val();
			ZC.ZCHtmlUtils._remove_(self.sId + '-viewsource');
			zingchart.exec(self.sId, 'setdata', {data : sJson});
		});
	}
};
ZC.ZCLoader.prototype._api_bugreport_ = function() {
	var self = this;
	if (self.iWidth < 300 || self.iHeight < 300) {
		window.open('http://www.zingchart.com/support/', '', '');
		return;
	}
	var oBugReport = ZC.ZCHtmlUtils._div_({
		cls : 'zc-abs zc-bugreport zc-style',
		id : self.sId + '-bugreport',
		p : ZC._id_(self.sId + '-top'),
		wh : (self.iWidth-(ZC.quirks?0:10)) + '/' + (self.iHeight-(ZC.quirks?0:10))
	});
	var sHtml = '';
	sHtml += '<div class="zc-form-row-label zc-form-s0">' + ZC.ZCLabels['bugreport-header'] + '</div><div class="zc-form-row-label"><input type="checkbox" id="' + self.sId + '-chkdata" checked="checked" /><label for="' + self.sId + '-chkdata">' + ZC.ZCLabels['bugreport-senddata'] + '</label>';
	if (ZC.canvas) {
		sHtml += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="' + self.sId + '-chkcapture" checked="checked" /><label for="' + self.sId + '-chkcapture">' + ZC.ZCLabels['bugreport-sendcapture'] + '</label>';
	}
	sHtml += '</div><div class="zc-form-row-label zc-form-s1">' + ZC.ZCLabels['bugreport-yourcomment'] + '</div><div class="zc-form-row-element"><textarea id="' + self.sId + '-bugreport-comment" style="width:' + (self.iWidth-35) + 'px;height:' + ((self.iHeight-300)/2-10) + 'px;"></textarea></div><div class="zc-form-row-label zc-form-s1">' + ZC.ZCLabels['bugreport-jsondata'] + '</div><div class="zc-form-row-element"><textarea id="' + self.sId + '-bugreport-json" style="width:' + (self.iWidth-35) + 'px;height:' + ((self.iHeight-210)/2) + 'px;"></textarea></div><div class="zc-form-row-label zc-form-s1">' + ZC.ZCLabels['bugreport-youremail'] + (self.iWidth>=510?(' <span>('+ZC.ZCLabels['bugreport-infoemail']+')</span>'):'') + '</div><div class="zc-form-row-element"><input type="text" id="' + self.sId + '-bugreport-email" style="width:' + (self.iWidth-35) + 'px;" /></div><div class="zc-form-row-element zc-form-row-last"><input type="button" value="' + ZC.ZCLabels['bugreport-submit'] + '" id="' + self.sId + '-bugreport-submit" /><input type="button" value="' + ZC.ZCLabels['bugreport-cancel'] + '" id="' + self.sId + '-bugreport-cancel" /></div>';
	oBugReport.innerHTML = ZC._h_(sHtml);

	ZC.ZCQuery('#' + self.sId + '-bugreport-json').val('PARSED\n----------\n' + ZC.ZCUtils._format_json_(self.oAttributes['json']) + '\n\nORIGINAL\n----------\n' + ZC.ZCUtils._format_json_(self.oAttributes['source']));
	ZC.ZCQuery('#' + self.sId + '-bugreport-cancel').bind('click', function() {
		ZC.ZCHtmlUtils._remove_(self.sId + '-bugreport');
	});
	ZC.ZCQuery('#' + self.sId + '-bugreport-submit').bind('click', function() {
		var oRegExp = /^((\w+\+*\-*)+\.?)+@((\w+\+*\-*)+\.?)*[\w-]+\.[a-z]{2,6}$/;
		var oEmail = ZC.ZCQuery('#' + self.sId + '-bugreport-email');
		if (!oRegExp.test(oEmail.val())) {
			oEmail.val(ZC.ZCLabels['bugreport-emailmandatory']);
			return;
		}
		var sImageData = '';
		if (ZC.canvas) {
			sImageData = self._api_getimagedata_('png');
		}
		var sJson = ('Parsed:'+self.oAttributes['json']+' Original:'+self.oAttributes['source']).replace(/\r|\n|\t|(\s{2,})/g, "");
		var sQS = '', aQS = [];

		if (ZC.ZCQuery('#' + self.sId + '-chkcapture').attr('checked')) {
			aQS.push('****IMAGE:', sImageData);
		}
		if (ZC.ZCQuery('#' + self.sId + '-chkdata').attr('checked')) {
			aQS.push('****JSON:', sJson);
		}
		aQS.push(
			'****COMMENT:', ZC.ZCQuery('#' + self.sId + '-bugreport-comment').val(),
			'****EMAIL:', oEmail.val(),
			'****VERSION:', ZC.VERSION,
			'****WIDTH:', self.iWidth,
			'****HEIGHT:', self.iHeight,
			'****URL:', window.location.href,
			'****UA:', navigator.userAgent,
			'****RENDER:', self.sOutput.toUpperCase(),
			'****RESOLUTION:', screen.width + 'x' + screen.height
		);
		for (var i=0;i<aQS.length-1;i+=2) {
			sQS += aQS[i] + encodeURIComponent(aQS[i+1]);
		}
		sQS += '****END';
		var oDoc = ZC.ZCHtmlUtils._iframe_(ZC._id_(self.sId + '-bugreport'));
        var oForm = oDoc.createElement('FORM');
        oForm.action = 'http://www.zingchart.com/support/submitreportH5.php';
        oForm.method = 'post';
        oDoc.body.appendChild(oForm);
        var oText = oDoc.createElement('INPUT');
        oText.type = 'text';
        oText.name = 'data';
        oText.value = sQS;
        oForm.appendChild(oText);
        oForm.submit();
        window.setTimeout(function() {
        	alert(ZC.ZCLabels['bugreport-confirm']);
            ZC.ZCHtmlUtils._remove_(self.sId + '-bugreport');
        }, 1000);
	});
};











ZC.ZCLoader.prototype.paintHistory = function() {
	var self = this, mValue, oHistoryItem, oHistoryItemOff;

	
	ZC.ZCHtmlUtils._remove_(
		[
			self.sId + '-history-path',
			self.sId + '-history-back-path',
			self.sId + '-history-forw-path',
			self.sId + '-history-gradient',
			self.sId + '-history-back-gradient',
			self.sId + '-history-forw-gradient'
		]
	);

	if (ZC._n_(mValue=self.oData['history']) !== null) {
		self.oHistory = new ZC.ZCTextBox(self);
		self.oDefaults.load(self.oHistory.oData, 'loader.gui.history');
		self.oHistory.append(mValue);
		self.oHistory.parse();
		self.oHistory.bSkipText = true;

		oHistoryItem = new ZC.ZCShape(self);
		self.oDefaults.load(oHistoryItem.oData, 'loader.gui.history.item');
		oHistoryItem.append(mValue['item']);
		oHistoryItem.parse();

		oHistoryItemOff = new ZC.ZCShape(self);
		self.oDefaults.load(oHistoryItemOff.oData, 'loader.gui.history.item-off');
		oHistoryItemOff.append(mValue['item']);
		oHistoryItemOff.append(mValue['item-off']);
		oHistoryItemOff.parse();
	}

	var sArea = '';

	if (self.oHistory) {

		self.oHistory.sId = self.sId + '-history';
		self.oHistory.oCanvas = self.oHistory.oCanvasSh = ZC._id_(self.sId + '-static-c');
		self.oHistory.paint();

		
		var iX = self.oHistory.iX + self.oHistory.iPaddingLeft;
		var iY = self.oHistory.iY + self.oHistory.iPaddingTop;
		var iW = self.oHistory.iWidth - self.oHistory.iPaddingLeft - self.oHistory.iPaddingRight;
		var iH = self.oHistory.iHeight - self.oHistory.iPaddingTop - self.oHistory.iPaddingBottom;

		var oBack = new ZC.ZCShape(self);
		oBack.sId = self.sId + '-history-back';
		oBack.copy(oHistoryItem);
		oBack.bPixelCorrection = false;
		if (self.iHistory === 0) {
			oBack.copy(oHistoryItemOff);
		}
		oBack.aPoints = [
			[iX, iY + iH/2],
			[iX + iW/3, iY],
			[iX + iW/3, iY + iH],
			[iX, iY + iH/2]
		];
		oBack.oDOMParent = ZC._id_(self.oParent.sId + '-text');
		oBack.oCanvas = oBack.oCanvasSh = ZC._id_(self.sId + '-static-c');
		oBack.parse();
		oBack.paint();

		if (self.iHistory > 0) {
			sArea += ZC.ZCHtmlUtils._area_start_('rect', true) + 'class="' + (self.sId + '-history-area zc-history-area') + '" id="' + self.sId + '-history-back-area' + '" coords="';
			sArea += ZC._i_(iX+ZC.MAPTX) + ',' + ZC._i_(iY+ZC.MAPTX) + ',' + ZC._i_(iX+iW/3+ZC.MAPTX) + ',' + ZC._i_(iY+iH+ZC.MAPTX);
			sArea += '" />';
		}

		var oForw = new ZC.ZCShape(self);
		oForw.sId = self.sId + '-history-forw';
		oForw.copy(oHistoryItem);
		oForw.bPixelCorrection = false;
		if (self.iHistory === self.aHistory.length-1 || self.aHistory.length === 0) {
			oForw.copy(oHistoryItemOff);
		}
		oForw.aPoints = [
			[iX + iW, iY + iH/2],
			[iX + 2*iW/3, iY],
			[iX + 2*iW/3, iY + iH],
			[iX + iW, iY + iH/2]
		];
		oForw.oDOMParent = ZC._id_(self.oParent.sId + '-text');
		oForw.oCanvas = oForw.oCanvasSh = ZC._id_(self.sId + '-static-c');
		oForw.parse();
		oForw.paint();

		if (self.iHistory < self.aHistory.length-1) {
			sArea += ZC.ZCHtmlUtils._area_start_('rect', true) + 'class="' + (self.sId + '-history-area zc-history-area') + '" id="' + self.sId + '-history-forw-area' + '" coords="';
			sArea += ZC._i_(iX+2*iW/3+ZC.MAPTX) + ',' + ZC._i_(iY+ZC.MAPTX) + ',' + ZC._i_(iX+iW+ZC.MAPTX) + ',' + ZC._i_(iY+iH+ZC.MAPTX);
			sArea += '" />';
		}

		if (sArea !== '') {
			ZC._id_(self.sId + '-map').innerHTML += sArea;
		}

		self.zc_loader_history = function(ev) {
			if (ev.target.id === self.sId + '-history-back-area') {
				zingchart.exec(self.sId, 'goback');
			} else if (ev.target.id === self.sId + '-history-forw-area') {
				zingchart.exec(self.sId, 'goforward');
			}
		};
		ZC.ZCQuery('.' + self.sId + '-history-area').live('click', self.zc_loader_history);

	}
};










ZC.ZCDraw3D = {
	iViewD : 1,
	iViewX : 0,
	iViewY : 0,
	iDepth : 40
};
ZC.ZCMath3D = {
	_get_rotation_angle_ : function(oGraph, oElement) {
		var oPoint1, oPoint2;
		if (oElement.iAngle % 180 === 0) {
			oPoint1 = new ZC.ZCPoint3D(oGraph, -oGraph.iWidth/2, oElement.iY-oGraph.iHeight/4, 0);
			oPoint2 = new ZC.ZCPoint3D(oGraph, oGraph.iWidth/2, oElement.iY-oGraph.iHeight/4, 0);
		} else {
			oPoint1 = new ZC.ZCPoint3D(oGraph, oElement.iX-oGraph.iWidth/4, -oGraph.iHeight/2, 0);
			oPoint2 = new ZC.ZCPoint3D(oGraph, oElement.iX-oGraph.iWidth/4, oGraph.iHeight/2, 0);
		}
		return ZC._deg_(Math.atan((oPoint2.aXY[1]-oPoint1.aXY[1])/(oPoint2.aXY[0]-oPoint1.aXY[0]))) - ((oElement.iAngle % 180 === 0)?0:90);
	},
	_create_3d_face_ : function(oStyle, oGraph, iX1, iX2, iY1, iY2, iZ1, iZ2, sFace) {
		sFace = sFace || 'z';
		var oFace = new ZC.ZCFace3D(oStyle, oGraph);
		var oP1, oP2, oP3, oP4;
		switch (sFace) {
			case 'x':
				oP1 = new ZC.ZCPoint3D(oGraph, iX1, iY1, iZ1);
				oP2 = new ZC.ZCPoint3D(oGraph, iX2, iY1, iZ1);
				oP3 = new ZC.ZCPoint3D(oGraph, iX2, iY2, iZ2);
				oP4 = new ZC.ZCPoint3D(oGraph, iX1, iY2, iZ2);
				break;
			case 'y':
				oP1 = new ZC.ZCPoint3D(oGraph, iX1, iY1, iZ1);
				oP2 = new ZC.ZCPoint3D(oGraph, iX1, iY2, iZ1);
				oP3 = new ZC.ZCPoint3D(oGraph, iX2, iY2, iZ2);
				oP4 = new ZC.ZCPoint3D(oGraph, iX2, iY1, iZ2);
				break;
			case 'z':
				oP1 = new ZC.ZCPoint3D(oGraph, iX1, iY1, iZ1);
				oP2 = new ZC.ZCPoint3D(oGraph, iX1, iY1, iZ2);
				oP3 = new ZC.ZCPoint3D(oGraph, iX2, iY2, iZ2);
				oP4 = new ZC.ZCPoint3D(oGraph, iX2, iY2, iZ1);
				break;
		}
		oFace.add(oP1);
		oFace.add(oP2);
		oFace.add(oP3);
		oFace.add(oP4);
		return oFace;
	},
	_create_3d_facet_ : function(oStyle, oGraph, mPoints, bFlat) {
		if (typeof(bFlat) === 'undefined') {
			bFlat = false;
		}
		var aPoints = null, aMathPoints = null, mValue;
		if (mPoints instanceof Array) {
			aPoints = mPoints;
		} else {
			aPoints = mPoints['points'];
			aMathPoints = mPoints['mathpoints'];
		}
		var oFace = new ZC.ZCFace3D(oStyle, oGraph);
		for (var i=0,iLen=aPoints.length;i<iLen;i++) {
			if (ZC._n_(aPoints[i]) !== null) {
				if (bFlat) {
					oFace.add(aPoints[i], aMathPoints?aMathPoints[i]:null);
				} else {
					oFace.add((new ZC.ZCPoint3D(oGraph, aPoints[i][0], aPoints[i][1], aPoints[i][2])), aMathPoints?(new ZC.ZCPoint3D(oGraph, aMathPoints[i][0], aMathPoints[i][1], aMathPoints[i][2])):null);
				}
			}
		}
		if ((mValue=oStyle.oData['z-modifier'])) {
			oFace.aPriorities = [ZC._i_(mValue), ZC._i_(mValue), ZC._i_(mValue)];
		}
		return oFace;
	}
};

ZC.ZCPoint3D = ZC.Class.extend({
	init : function(oGraph, iX, iY, iZ) {
		var self = this;
		self.oGraph = oGraph;
		self.iX = iX;
		self.iY = iY;
		self.iZ = iZ;
		self.iX_ = 0;
		self.iY_ = 0;
		self.iZ_ = 0;
		self.aXY = [];

		var iAngle = self.oGraph.o3DAspect['angle'], iZoom = self.oGraph.o3DAspect['zoom'];
		if (self.oGraph.o3DAspect['true3d']) {
			var a = {x:iX, y:iY, z:iZ};
			var c = {x:0, y:0, z:0};
			var r = {x:self.oGraph.o3DAspect['x-angle'], y:self.oGraph.o3DAspect['y-angle'], z:self.oGraph.o3DAspect['z-angle']};
			var sx = ZC._sin_(r.x), sy = ZC._sin_(r.y), sz = ZC._sin_(r.z);
			var cx = ZC._cos_(r.x), cy = ZC._cos_(r.y), cz = ZC._cos_(r.z);
			self.iX_ = cy * (sz * (a.y - c.y) + cz * (a.x - c.x)) - sy * (a.z - c.z);
			self.iY_ = sx * (cy * (a.z - c.z) + sy * (sz * (a.y - c.y) + cz * (a.x - c.x))) + cx * (cz * (a.y - c.y) - sz * (a.x - c.x));
			self.iZ_ = cx * (cy * (a.z - c.z) + sy * (sz * (a.y - c.y) + cz * (a.x - c.x))) - sx * (cz * (a.y - c.y) - sz * (a.x - c.x));
			self.aXY[0] = ZC.ZCDraw3D.iViewX + ZC.ZCDraw3D.iViewD/(ZC.ZCDraw3D.iViewD+self.iZ_)*self.iX_*iZoom;
			self.aXY[1] = ZC.ZCDraw3D.iViewY + ZC.ZCDraw3D.iViewD/(ZC.ZCDraw3D.iViewD+self.iZ_)*self.iY_*iZoom;
		} else {
			self.aXY[0] = ZC.ZCDraw3D.iViewX + iX + iZ*ZC._cos_(iAngle)*iZoom;
			self.aXY[1] = ZC.ZCDraw3D.iViewY + iY - iZ*ZC._sin_(iAngle)*iZoom;
		}
	}
});

ZC.ZCFace3D = ZC.Class.extend({
	init : function(oStyle, oGraph) {
		var self = this;
		self.oGraph = oGraph;
		self.oStyle = oStyle;
		self.sId = '';
		self.bFlat = false;
		self.aPriorities = [1, 1, 1];
		self.iPriority = -1;
		self.aPoints = [];
		self.aMathPoints = [];
		self.iFarthestZ = -9999;
		self.iFarthestZ_ = -9999;
		self.iClosestZ = 9999;
		self.iLeftestX = 9999;
		self.iLowestY = 9999;
		self.iAvgX = 0;
		self.iAvgY = 0;
		self.iAvgZ = 0;
	},
	add : function(oPoint, oMathPoint) {
		var self = this;
		self.aPoints.push(oPoint);
		self.aMathPoints.push(oMathPoint || oPoint);
	},
	get2DPoints : function() {
		var aPoints = [];
		for (var p=0,pLen=self.aPoints.length;p<pLen;p++) {
			aPoints.push([self.aPoints[p].aXY[0], self.aPoints[p].aXY[1]]);
		}
		return aPoints;
	},
	evalFace : function() {
		var self = this;
		var iPoints = self.aMathPoints.length;
		for (var p=0;p<iPoints;p++) {
			var oPoint = self.aMathPoints[p];
			self.iFarthestZ = ZC._max_(self.iFarthestZ, oPoint.iZ);
			if (ZC._b_(self.oGraph.o3DAspect['true3d'])) {
				self.iClosestZ = ZC._min_(self.iClosestZ, oPoint.iZ);
				self.iFarthestZ_ = ZC._max_(self.iFarthestZ_, oPoint.iZ_);
				self.iAvgY += oPoint.iY;
			} else {
				self.iLeftestX = ZC._min_(self.iLeftestX, oPoint.iX);
				self.iLowestY = ZC._min_(self.iLowestY, oPoint.iY);
				self.iAvgX += oPoint.iX;
				self.iAvgY += oPoint.iY;
				self.iAvgZ += oPoint.iZ;
			}
		}
		self.iAvgX /= iPoints;
		self.iAvgY /= iPoints;
		self.iAvgZ /= iPoints;
	},
	getAreaCoords : function() {
		var self = this;
		var sCoords = '';
		for (var p=0,pLen=self.aPoints.length;p<pLen;p++) {
			sCoords += ZC._i_(self.aPoints[p].aXY[0]+ZC.MAPTX) + ',' + ZC._i_(self.aPoints[p].aXY[1]+ZC.MAPTX) + ',';
		}
		sCoords = sCoords.substring(0, sCoords.length-1);
		return sCoords;
	}
});

ZC.ZCEngine3D = ZC.Class.extend({
	init : function() {
		var self = this;
		self.aFaces = [];
		self.aAliases = {};
		self.aDistances = [];
	},
	clear : function() {
		var self = this;
		self.aFaces = [];
		self.aDistances = [];
	},
	add : function(oFace) {
		var self = this;
		self.aFaces.push(oFace);
	},
	sortFaces : function(a, b) {
		if (zingchart.V3D === 1) {
			if (a[0][0] > b[0][0]) {
				return -1;
			} else if (a[0][0] < b[0][0]) {
				return 1;
			} else {
				if (a[0][1] > b[0][1]) {
					return 1;
				} else if (a[0][1] < b[0][1]) {
					return -1;
				} else {
					if (a[0][2] > b[0][2]) {
						return -1;
					} else if (a[0][2] < b[0][2]) {
						return 1;
					} else {
						if (a[0][3] > b[0][3]) {
							return -1;
						} else if (a[0][3] < b[0][3]) {
							return 1;
						} else {
							return 0;
						}
					}
				}
			}
		} else if (zingchart.V3D === 2) {
			if (a[0][3] !== -1 || b[0][3] !== -1) {
				if (a[0][3] > b[0][3]) {
					return 1;
				} else if (a[0][3] < b[0][3]) {
					return -1;
				} else {
					return 0;
				}
			} else {
				if (a[0][0] > b[0][0]) {
					return -1;
				} else if (a[0][0] < b[0][0]) {
					return 1;
				} else {
					if (a[0][1] > b[0][1]) {
						return 1;
					} else if (a[0][1] < b[0][1]) {
						return -1;
					} else {
						if (a[0][2] > b[0][2]) {
							return 1;
						} else if (a[0][2] < b[0][2]) {
							return -1;
						} else {
							return 0;
						}
					}
				}
			}
		} else if (zingchart.V3D === 3) {
			if (a[0] > b[0]) {
				return -1;
			} else if (a[0] < b[0]) {
				return 1;
			} else {
				return 0;
			}
		}
  	}
});











ZC.ZCTooltip = ZC.Class.extend({
	init : function(oLoader) {
		var self = this;
		self.oLoader = oLoader;
		self.bSticky = false;
		self.iTimeout = 250;
		self.iLeft = 0;
		self.iTop = 0;
		self.iDistance = 20;
		self.sPlacement = '';
		self.aPlacement = [];
		self.oTooltip = null;
	},
	onmouseout : function() {
		var self = this;
		if (ZC.mobile) { return; }
		if (self.bSticky) {
			self.iTick = window.setInterval(function() {
				var sId = self.oLoader.sId;
				var oRef = ZC.ZCQuery('#' + sId + ((self.oLoader.sOutput === 'svg')?'-top':'-main'));
				var iMLeft = ZC.aPageXY[0] - oRef.offset().left;
				var iMTop = ZC.aPageXY[1] - oRef.offset().top;
				if (
					!(
					ZC._btw_(iMLeft, self.iLeft, self.iLeft+self.oTooltip.iWidth)
					&&
					ZC._btw_(iMTop, self.iTop, self.iTop+self.oTooltip.iHeight)
					)
				) {
					if (ZC._n_(self.iTick) !== null) {
						window.clearInterval(self.iTick);
					}
					self.hide();
				}
			}, self.iTimeout);
		} else {
			self.hide();
		}
	},
	clear : function() {
		var self = this;
		ZC.ZCHtmlUtils._clear_(ZC._id_(self.oLoader.sId + '-tooltip-c'), self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
	},
	hide : function() {
		if (ZC.TTLOCK) {
			return;
		}
		var self = this;
		var sId = self.oLoader.sId;
		ZC.ZCHtmlUtils._remove_(
			[
				sId + '-tooltip-text',
				sId + '-tooltip',
				sId + '-tooltip-text-float'
			]
		);
		
		if (self.oLoader.sOutput === 'svg') {
			ZC.ZCQuery('clipPath').each(function() {
				if (this.id.indexOf('-hover_image-clip') !== -1) {
					ZC.ZCHtmlUtils._remove_(this.id);
				}
			});
		}
	},
	show : function(ev) {
		var self = this, mValue;
		if (ZC._n_(self.iTick) !== null) {
			window.clearInterval(self.iTick);
		}
		var sId = self.oLoader.sId;
		if (ZC.ZCQuery('#' + sId + '-tooltip-c').length === 0) {
			return;
		}

		var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
		var oRef = ZC.ZCQuery('#' + sId + ((self.oLoader.sOutput === 'svg')?'-top':'-main'));
		var iLeft = aPageXY[0] - oRef.offset().left - self.oTooltip.iWidth/2 + ZC._i_(self.oTooltip.oAttributes['offset-x']);
		var iTop = aPageXY[1] - oRef.offset().top - self.oTooltip.iHeight + ZC._i_(self.oTooltip.oAttributes['offset-y']);

		var iMinSpace = 1 + 2*self.oTooltip.iShadowDistance;
		if (iLeft < iMinSpace) {
			iLeft = iMinSpace;
		}
		if (iLeft + self.oTooltip.iWidth > self.oLoader.iWidth - iMinSpace) {
			iLeft = self.oLoader.iWidth - iMinSpace - self.oTooltip.iWidth;
		}
		if (iTop < iMinSpace) {
			iTop = iMinSpace + (aPageXY[1] - oRef.offset().top - ZC._i_(self.oTooltip.oAttributes['offset-y']));
		}
		if (iTop + self.oTooltip.iHeight > self.oLoader.iHeight - iMinSpace) {
			iTop = self.oLoader.iHeight - iMinSpace - self.oTooltip.iHeight;
		}

		
		

		if (ZC._n_(self.oTooltip.oData['x']) !== null) {
			iLeft = ZC._dimension_(self.oTooltip.oData['x']);
			if (iLeft > 0 && iLeft < 1) {
				iLeft = ZC._i_(self.oLoader.iWidth*iLeft);
			}
		}
		if (ZC._n_(self.oTooltip.oData['y']) !== null) {
			iTop = ZC._dimension_(self.oTooltip.oData['y']);
			if (iTop > 0 && iTop < 1) {
				iTop = ZC._i_(self.oLoader.iHeight*iTop);
			}
		}

		self.iLeft = iLeft;
		self.iTop = iTop;

		switch (self.oLoader.sOutput) {
			case 'svg':
				if (ZC._n_(self.oTooltip.oData['x']) === null && ZC._n_(self.oTooltip.oData['y']) === null) {
					ZC._id_(sId + '-tooltip').setAttribute('transform', 'translate(' + iLeft + ',' + iTop + ')');
				}
				if (self.oTooltip.oAttributes['html-mode']) {
					ZC.ZCHtmlUtils._style_(ZC._id_(sId + '-tooltip-text-float'), {
						left : (iLeft + oRef.offset().left + self.oTooltip.iPaddingLeft) + 'px',
						top : (iTop + oRef.offset().top + self.oTooltip.iPaddingTop) + 'px',
						zIndex : (zingchart.ZINDEX > 9999 ? zingchart.ZINDEX : 9999)
					});
				}
				break;
			case 'vml':
				if (ZC._n_(self.oTooltip.oData['x']) === null && ZC._n_(self.oTooltip.oData['y']) === null) {
					ZC.ZCHtmlUtils._style_(ZC._id_(sId + '-tooltip'), {
						left : iLeft + 'px',
						top : iTop + 'px'
					});
				}
				break;
			case 'canvas':
				if (ZC._n_(self.aPlacement['x']) !== null) {
					iLeft = self.aPlacement['x'];
				}
				if (ZC._n_(self.aPlacement['y']) !== null) {
					iTop = self.aPlacement['y'];
				}
				var iOffset = (self.oTooltip.oAttributes['html-mode'])?0:20;
				ZC.ZCHtmlUtils._style_(ZC._id_(sId + '-tooltip-c'), {
					left : (iLeft - iOffset) + 'px',
					top : (iTop - iOffset) + 'px'
				});
				if ((mValue=ZC._id_(sId + '-tooltip-text')) !== null) {
					mValue.style.display = 'none';
					ZC.ZCHtmlUtils._style_(mValue, {
						width : self.oTooltip.iWidth + 'px',
						height : self.oTooltip.iHeight + 'px',
						left : iLeft + 'px',
						top : iTop + 'px'
					});
					mValue.style.display = 'block';
				}
				break;
		}
	},
	onmousemove : function(ev) {
		this.show(ev);
	},
	onmouseover : function(ev, oInfo) {
		var self = this, mValue, i, iLen;
		oInfo = oInfo || {};
		if (self.oLoader.oZoom && self.oLoader.oZoom.bActive) { return; }
		var sId = self.oLoader.sId;
		
		var sTargetId = ev.targetid || ev.target.id;

		var aObjectInfo = sTargetId.replace(/--([a-zA-Z0-9]+)/, '').replace('-gshape-area', '-area').split('-').reverse();
		var aObjectElement = sTargetId.split('--');
		var bNode = false, bLegend = false, bScale = false;
		if ((aObjectInfo[1] === 'node' && aObjectInfo[3] === 'plot' && aObjectInfo[4] === 'plotset')) {
			bNode = true;
		}

		ZC.ZCHtmlUtils._remove_(
			[
				sId + '-tooltip-text',
				sId + '-tooltip',
				sId + '-tooltip-text-float'
			]
		);
		var oGraph, oPlot, oPlotNode;
		if (bNode) {
			oGraph = self.oLoader.findGraph(aObjectInfo[5]);
			oPlot = oGraph.oPlotSet.aPlots[aObjectInfo[2]];
			oPlotNode = oPlot.getNode(aObjectInfo[0]);
			if (!oPlotNode) {
				return;
			}
			ZC.ZCQuery('#' + sId + '-graph-' + aObjectInfo[5] + '-plot-' + aObjectInfo[2] + '-bg-hover-c').show();
		} else {
			if (aObjectInfo[2] === 'legend' && aObjectInfo[1].indexOf('item') === 0) {
				bLegend = true;
			}
			if (aObjectInfo[2].indexOf('scale') === 0 && (aObjectInfo[1].indexOf('item') === 0 || aObjectInfo[1].indexOf('marker') === 0)) {
				bScale = true;
			}
			oGraph = self.oLoader.findGraph(aObjectInfo[3]);
		}
		if (!ZC._id_(sId + '-tooltip')) {
			ZC.ZCHtmlUtils._group_({
				id : sId + '-tooltip',
				p : ZC._id_(sId + '-main'),
				cls : 'zc-abs zc-tooltip',
				wh : self.oLoader.iWidth + '/' + self.oLoader.iHeight,
				overflow : 'hidden'
			}, self.oLoader.sOutput);
			ZC.ZCHtmlUtils._layer_({
				id : sId + '-tooltip-c',
				p : ZC._id_(sId + '-tooltip'),
				cls : 'zc-abs',
				tl : '-999/-999',
				width : 140,
				height : 60
			}, self.oLoader.sOutput);
		}

		self.oTooltip = zingchart.pool.getInstance('ZCTextBox', self, sId + '-tooltip-text');
		self.oTooltip.sTag = 'tooltip';

		self.oTooltip.oParent = self.oLoader;
		if (oGraph && oGraph.oTooltip) {
			self.oTooltip.append(oGraph.oTooltip.oData);
		}

		if (bNode) {
			self.oTooltip.append(oPlot.oTooltip.oData);
			
			if (oGraph.oSelection['p'+oPlot.iIndex] && oGraph.oSelection['p'+oPlot.iIndex]['n'+oPlotNode.iIndex]) {
				self.oTooltip.append(oPlot.oTooltip.oData['selected-state']);
			}
			if (aObjectElement.length === 2) {
				self.oTooltip.append(oPlot.getElementData(aObjectElement[1]));
			}
		} else {
			var bTooltip = false;
			if (bLegend) {
				if (oGraph.oLegend && ZC._n_(oGraph.oLegend.oData['tooltip']) !== null) {
					self.oTooltip.append(oGraph.oLegend.oData['tooltip']);
					bTooltip = true;
				}
			}
			if (bScale) {
				var oScale = oGraph.getScaleByName(aObjectInfo[2].replace(/\_/g, '-'));
				if (oScale && ZC._n_(oScale.oData['tooltip']) !== null) {
					self.oTooltip.append(oScale.oData['tooltip']);
					bTooltip = true;
				}
				if (aObjectInfo[1].indexOf('item_') === 0) {
					if (oScale && oScale.oData['item'] && oScale.oData['item']['tooltip']) {
						self.oTooltip.append(oScale.oData['item']['tooltip']);
						bTooltip = true;
					}
				} else if (aObjectInfo[1].indexOf('marker_') === 0) {
					var iMarkerIndex = ZC._i_(aObjectInfo[1].replace('marker_', ''));
					if (oScale.aMarkers[iMarkerIndex] && oScale.aMarkers[iMarkerIndex].oData['label']) {
						self.oTooltip.append(oScale.aMarkers[iMarkerIndex].oData['label']['tooltip']);
						bTooltip = true;
					}
				}
			}
			if (aObjectInfo[2] === 'shape') {
				if (ev.target.getAttribute('data-lowlevel')) {
					self.oTooltip.append({text: ev.target.getAttribute('data-tooltip-text')});
					bTooltip = true;
				} else {
					for (i=0,iLen=oGraph.aShapes.length;i<iLen;i++) {
						if (ZC._n_(oGraph.aShapes[i]) !== null) {
							var oShape_ = (oGraph.aShapes[i] instanceof ZC.ZCGraphShape)?oGraph.aShapes[i].oShape:oGraph.aShapes[i];
							if (oGraph.sId + '-shape-' + aObjectInfo[1] === oGraph.aShapes[i].sId && ZC._n_(mValue=oShape_.oData['tooltip']) !== null) {
								self.oTooltip.append(mValue);
								bTooltip = true;
							}
						}
					}
				}
			}
			if (aObjectInfo[2] === 'label') {
				for (i=0,iLen=oGraph.aLabels.length;i<iLen;i++) {
					if (oGraph.sId + '-label-' + aObjectInfo[1] === oGraph.aLabels[i].sId && ZC._n_(mValue=oGraph.aLabels[i].oData['tooltip']) !== null) {
						self.oTooltip.append(mValue);
						bTooltip = true;
					}
				}
			}
			if (!bTooltip) {
				return;
			}
		}

		self.bSticky = false;
		self.iTimeout = 250;
		if (ZC._n_(mValue=self.oTooltip.oData['sticky']) !== null) {
			self.bSticky = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=self.oTooltip.oData['timeout']) !== null) {
			self.iTimeout = ZC._i_(mValue);
		}
		if (ZC._n_(mValue=self.oTooltip.oData['placement']) !== null) {
			self.sPlacement = mValue;
		}
		if (ZC._n_(mValue=self.oTooltip.oData['distance']) !== null) {
			self.iDistance = ZC._i_(mValue);
		}

		self.oTooltip.iX = 0;
		self.oTooltip.iY = 0;
		self.oTooltip.oCanvas = self.oTooltip.oCanvasSh = ZC._id_(sId + '-tooltip-c');
		var oTooltipStyle;
		if (bNode) {
			oTooltipStyle = oPlotNode.getTooltipStyle();
			oPlotNode.applyJsRule(oTooltipStyle);
			if (ZC._n_(oTooltipStyle['line-color']) !== null) {
				self.oTooltip.sBackgroundColor1 = self.oTooltip.sBackgroundColor2 = ZC.ZCUtils._darken_(oTooltipStyle['line-color']);
			} else {
				self.oTooltip.sBackgroundColor1 = self.oTooltip.sBackgroundColor2 = ZC.ZCUtils._darken_(oTooltipStyle['background-color']);
			}
			self.oTooltip.sBorderColor = oTooltipStyle['border-color'];
			self.oTooltip.sColor = oTooltipStyle['color'];

			
			if (ZC._n_(oPlot.oData['rules']) !== null) {
				if (!self.oRPlot) {
					self.oRPlot = new ZC.ZCPlot(oPlot.oParent);
					self.oRPlot.oAttributes['quick-parse'] = true;
				}
				self.oRPlot.append(oPlot.oData);
				self.oRPlot.parse();
				self.oRPlot.parseRule = function(sRule) {
					return oPlotNode.parseRule(sRule);
				};
				if (self.oRPlot.applyRules()) {
					self.oRPlot.parse();
				}
				self.oTooltip.sText = self.oRPlot.sTooltipText;
			} else {
				self.oTooltip.sText = oPlot.sTooltipText;
			}
			var oFormat = ZC.ZCUtils._setup_format_(self.oTooltip.oData, oPlot.oData);
			self.oTooltip.parseText = function(sText) {
				return oPlotNode.parseText(sText, oFormat);
			};
			self.oTooltip.oAttributes['plotidx'] = oPlotNode.oParent.iIndex;
			self.oTooltip.oAttributes['nodeidx'] = oPlotNode.iIndex;
		} else if (bLegend) {
			oPlot = oGraph.oPlotSet.aPlots[aObjectInfo[1].replace('item_', '')];
			self.oTooltip.append(oPlot.oData['legend-tooltip']);
			oPlotNode = null;
			for (i=0,iLen=oPlot.aPlotNodes.length;i<iLen;i++) {
				if (oPlot.aPlotNodes[i] !== null) {
					oPlotNode = oPlot.getNode(i);
					break;
				}
			}
			if (oPlotNode) {
				oTooltipStyle = oPlotNode.getTooltipStyle();
				if (oTooltipStyle['background-color'] !== '-1') {
					self.oTooltip.sBackgroundColor1 = self.oTooltip.sBackgroundColor2 = ZC.ZCUtils._darken_(oTooltipStyle['background-color']);
					self.oTooltip.sColor = oTooltipStyle['color'];
				} else {
					return;
				}
			} else {
				self.oTooltip.sBackgroundColor1 = self.oTooltip.sBackgroundColor2 = ZC.ZCUtils._darken_(oPlot.aPalette[1]);
				self.oTooltip.sColor = oPlot.aPalette[0];
			}
			self.oTooltip.sText = oPlot.sDescription;
			self.oTooltip.parseText = function(sText) {
				sText = sText.replace(/%plot-description|%d/g, oPlot.sDescription);
				sText = sText.replace(/%plot-text|%t/g, oPlot.sText);
				return sText;
			};
		} else if (bScale) {
			if (aObjectInfo[1].indexOf('item_') === 0) {
				var iIndex = aObjectInfo[1].replace('item_', '');
				self.oTooltip.parseText = function(sText) {
					sText = sText.replace(/%text|%item-text/g, oScale.aLabels[iIndex] || oScale.aValues[iIndex]);
					sText = sText.replace(/%tooltip-text/g, oScale.aTooltipText[iIndex] || '');
					return sText;
				};
			}
		} else {
			
			self.oTooltip.parseText = function(sText) { return sText; }
		}
		if (self.oTooltip.oData['text-alpha'] === undefined) {
		    self.oTooltip.oData['text-alpha'] = 1;
		}
		self.oTooltip.parse();

		if (!self.oTooltip.bVisible) {
			return;
		}

		if (self.oTooltip.oJsRule) {
			if (bNode) {
				self.oTooltip.applyJsRule(self.oTooltip, self.oTooltip, null, oPlotNode._api_node_info_(null, false));
			}
			self.oTooltip.parse();
		}

		self.oTooltip.oAttributes['html-mode'] = false;
		if (ZC._n_(mValue=self.oTooltip.oData['html-mode']) !== null) {
			self.oTooltip.oAttributes['html-mode'] = ZC._b_(mValue);
		}

		if (bNode) {
			self.oTooltip.parseRule = function(sRule) {
				return oPlotNode.parseRule(sRule);
			};
			if (self.oTooltip.applyRules()) {
				self.oTooltip.parse();
			}
		}

		var iTooltipWidth, iTooltipHeight;
		if ((self.oLoader.sOutput === 'canvas' || self.oLoader.sOutput === 'vml') && self.oTooltip.iAngle !== 0) {
			var iSize = 1.25*ZC._max_(self.oTooltip.iWidth, self.oTooltip.iHeight) + self.oTooltip.iShadowDistance;
			iTooltipWidth = iSize;
			iTooltipHeight = iSize;
			self.oTooltip.iX += (iSize-self.oTooltip.iWidth)/2;
			self.oTooltip.iY += (iSize-self.oTooltip.iHeight)/2;
			self.oTooltip.oAttributes['offset-x'] = -(iSize-self.oTooltip.iWidth)/2 + self.oTooltip.iOffsetX;
			self.oTooltip.oAttributes['offset-y'] = -(iSize-self.oTooltip.iHeight)/2 + self.oTooltip.iOffsetY;
		} else {
			iTooltipWidth = self.oTooltip.iWidth + self.oTooltip.iShadowDistance;
			iTooltipHeight = self.oTooltip.iHeight + self.oTooltip.iShadowDistance;
			iTooltipWidth += 40;
			iTooltipHeight += 40;
			
			self.oTooltip.oAttributes['offset-x'] = self.oTooltip.iOffsetX;
			self.oTooltip.oAttributes['offset-y'] = self.oTooltip.iOffsetY;
		}
		ZC.ZCQuery('#' + sId + '-tooltip-c').attr('width', iTooltipWidth).attr('height', iTooltipHeight);
		if (self.oLoader.sOutput === 'vml') {
			ZC.ZCHtmlUtils._style_(ZC._id_(sId + '-tooltip-c'), {
				top : 0,
				left : 0
			});
		}

		
		self.oTooltip.iOffsetX_ = self.oTooltip.iOffsetX;
		self.oTooltip.iOffsetY_ = self.oTooltip.iOffsetY;
		self.oTooltip.iOffsetX = 0;
		self.oTooltip.iOffsetY = 0;

		if (!ev.type && bNode) {
			if (self.oLoader.sOutput === 'canvas') {
				self.oTooltip.oData['x'] = oPlotNode.iX - self.oTooltip.iWidth/2;
				self.oTooltip.oData['y'] = oPlotNode.iY - self.oTooltip.iHeight - 20;
			} else {
				self.oTooltip.iX = oPlotNode.iX - self.oTooltip.iWidth/2;
				self.oTooltip.iY = oPlotNode.iY - self.oTooltip.iHeight - 20;
			}
		}

		
		self.aPlacement = self.getPlacementInfo(oPlotNode);
		if (self.sPlacement !== '') {
			if (self.oLoader.sOutput !== 'canvas') {
				self.oTooltip.oData['x'] = self.oTooltip.iX = self.aPlacement['x'];
				self.oTooltip.oData['y'] = self.oTooltip.iY = self.aPlacement['y'];
			}
			self.oTooltip.sCalloutPosition = self.aPlacement['cp'];
			self.oTooltip.iCalloutOffset = self.aPlacement['co'];
		}
		

		if (self.oTooltip.bVisible && self.oTooltip.sText !== '') {
			if (self.oLoader.sOutput === 'canvas') {
				if (!self.oTooltip.oAttributes['html-mode']) {
					self.oTooltip.iX = 20;
					self.oTooltip.iY = 20;
				}
			}
			self.oTooltip.paint();
		}

		if (ev.type && bNode) {
			oPlotNode.setUpdate();
			oPlotNode.oGraph.repaintObjects(true);
		}

		if (ev.type || self.oLoader.sOutput === 'canvas') {
			self.show(ev);
		} else {
			if (self.oTooltip.oAttributes['html-mode']) {
				var oRef = ZC.ZCQuery('#' + sId + ((self.oLoader.sOutput === 'svg')?'-top':'-main'));
				ZC.ZCHtmlUtils._style_(ZC._id_(sId + '-tooltip-text-float'), {
					left : (oRef.offset().left + self.oTooltip.iX + self.oTooltip.iPaddingLeft) + 'px',
					top : (oRef.offset().top + self.oTooltip.iY + self.oTooltip.iPaddingTop) + 'px',
					zIndex : zingchart.ZINDEX
				});
			}
		}
	},
	getPlacementInfo : function(oPlotNode) {
		var self = this;
		var iDiff, aPlacement = [];
		var iCalloutWidth = self.oTooltip.iCalloutWidth, iCalloutHeight = self.oTooltip.iCalloutHeight;
		if (self.sPlacement === 'horizontal') {
			if (oPlotNode.iX + oPlotNode.iWidth/2 < oPlotNode.oGraph.iX + oPlotNode.oGraph.iWidth/2) {
				aPlacement['x'] = oPlotNode.iX + oPlotNode.iWidth + self.iDistance;
				aPlacement['y'] = oPlotNode.iY + oPlotNode.iHeight/2 - self.oTooltip.iHeight/2;
				aPlacement['cp'] = 'left';
			} else {
				aPlacement['x'] = oPlotNode.iX - self.oTooltip.iWidth - self.iDistance;
				aPlacement['y'] = oPlotNode.iY + oPlotNode.iHeight/2 - self.oTooltip.iHeight/2;
				aPlacement['cp'] = 'right';
			}
			if (aPlacement['y'] < 5) {
				iDiff = 5 - aPlacement['y'];
				aPlacement['co'] = -ZC._i_(100*iDiff/(self.oTooltip.iHeight-iCalloutHeight));
				aPlacement['y'] = 5;
			}
			if (aPlacement['y'] + self.oTooltip.iHeight > self.oLoader.iHeight - 5) {
				iDiff = self.oLoader.iHeight - 5 - aPlacement['y'] - self.oTooltip.iHeight;
				aPlacement['co'] = -ZC._i_(100*iDiff/(self.oTooltip.iHeight-iCalloutHeight));
				aPlacement['y'] = self.oLoader.iHeight - 5 - self.oTooltip.iHeight;
			}
		} else if (self.sPlacement === 'vertical') {
			if (oPlotNode.iY + oPlotNode.iHeight/2 < oPlotNode.oGraph.iY + oPlotNode.oGraph.iHeight/2) {
				aPlacement['y'] = oPlotNode.iY + oPlotNode.iHeight + self.iDistance;
				aPlacement['x'] = oPlotNode.iX + oPlotNode.iWidth/2 - self.oTooltip.iWidth/2;
				aPlacement['cp'] = 'top';
			} else {
				aPlacement['y'] = oPlotNode.iY - self.oTooltip.iHeight - self.iDistance;
				aPlacement['x'] = oPlotNode.iX + oPlotNode.iWidth/2 - self.oTooltip.iWidth/2;
				aPlacement['cp'] = 'bottom';
			}
			if (aPlacement['x'] < 5) {
				iDiff = 5 - aPlacement['x'];
				aPlacement['co'] = -ZC._i_(100*iDiff/(self.oTooltip.iWidth-iCalloutWidth));
				aPlacement['x'] = 5;
			}
			if (aPlacement['x'] + self.oTooltip.iWidth > self.oLoader.iWidth - 5) {
				iDiff = self.oLoader.iWidth - 5 - aPlacement['x'] - self.oTooltip.iWidth;
				aPlacement['co'] = -ZC._i_(100*iDiff/(self.oTooltip.iWidth-iCalloutWidth));
				aPlacement['x'] = self.oLoader.iWidth - 5 - self.oTooltip.iWidth;
			}
		}
		
		return aPlacement;
	}
});











ZC.ZCZoom = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oLoader = oParent;
		self.bActive = false;
		self.oGraph = null;
		self.iXStart = null;
		self.iYStart = null;
		self.iScaleXStart = 0;
		self.iScaleXEnd = 0;
		self.iScaleYStart = 0;
		self.iScaleYEnd = 0;
		self.oScaleX = null;
		self.oScaleY = null;
		self.bPanning = false;
		self.iPanStart = 0;
		self.bPreserveZoom = false;
		self.oLabel = null;
	},
	parse : function() {
		var self = this;
		if (!self.oGraph) {
			return;
		}
		if (self.oGraph.oZoom) {
			self.append(self.oGraph.oZoom.oData);
		}
		self._super();
		if (self.oGraph.oSettings['3d']) {
			self.bPreserveZoom = true;
		}
		self.assign('preserve-zoom', 'bPreserveZoom', 'b');

		self.oLabel = new ZC.ZCTextBox(self);
		self.oGraph.oParent.oDefaults.load(self.oLabel.oData, 'graph.zoom.label');
		self.oLabel.append(self.oData['label']);
		self.oLabel.parse();
	},
	unbind : function() {
		ZC.ZCQuery('#' + this.oLoader.sId + '-img').unbind('mousedown touchstart', this.zc_zoom_mousedown);
		
		
	},
	bind : function() {
		var self = this;
		var sId = self.oLoader.sId;
		self.zc_zoom_mousedown = function(ev) {
			if (ev.type === 'mousedown' && ZC.TOUCHEVENTS) {
				return;
			}
			
			if (ev.target.id.indexOf('-legend-header-area') !== -1) {
				return;
			}

			if (!ZC.mobile) {
				ev.preventDefault();
			}
			self.oLoader.hideCM();
			if (!ZC.mobile && ev.which > 1) { return; }
			if (self.oLoader.sOutput === 'vml' && ev.target.className.indexOf('zc-node-area') !== -1) {
				return;
			}
			if (ev.shiftKey) {
				self.bPanning = true;
			}

			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
			var iXStart = aPageXY[0] - oOffset.left;
			var iYStart = aPageXY[1] - oOffset.top;
			
			self.iXStart = iXStart;
			self.iYStart = iYStart;

			if (self.bPanning) {
				self.iPanStart = iXStart;
			}
			var bValidZoom = false;
			var oPlotArea;
			for (var i=0,iLen=self.oLoader.aGraphs.length;i<iLen;i++) {
				oPlotArea = self.oLoader.aGraphs[i].oPlotArea;
				if (
					ZC._btw_(iXStart, oPlotArea.iX-5, oPlotArea.iX+oPlotArea.iWidth+5)
					&&
					ZC._btw_(iYStart, oPlotArea.iY-5, oPlotArea.iY+oPlotArea.iHeight+5)
				) {
					self.oGraph = self.oLoader.aGraphs[i];
					
				}
			}
			if (self.oGraph !== null) {
				oPlotArea = self.oGraph.oPlotArea;
				if (self.oGraph.oPlotSet.aPlots.length > 0) {
					self.oScaleX = self.oGraph.getScaleByName(self.oGraph.oPlotSet.aPlots[0].getScales('k')[0]);
					self.oScaleY = self.oGraph.getScaleByName(self.oGraph.oPlotSet.aPlots[0].getScales('v')[0]);
				}
				if (
					self.oScaleX !== null
					&&
					self.oScaleY !== null
				) {
					if (self.oScaleX.bZooming || self.oScaleY.bZooming) {
						self.iScaleXStart = (self.oScaleX.bInversed)?iYStart:iXStart;
						self.iScaleYStart = (self.oScaleY.bInversed)?iXStart:iYStart;
						bValidZoom = true;
						if (self.oScaleX.bZooming) {
							if (self.oScaleX.bInversed) {
								self.iScaleXStart = ZC._l_(self.iScaleXStart, oPlotArea.iY, oPlotArea.iY+oPlotArea.iHeight);
							} else {
								self.iScaleXStart = ZC._l_(self.iScaleXStart, oPlotArea.iX, oPlotArea.iX+oPlotArea.iWidth);
							}
						} else {
							self.iScaleXStart = (self.oScaleX.bInversed)?oPlotArea.iY:oPlotArea.iX;
						}
						if (self.oScaleY.bZooming) {
							if (self.oScaleY.bInversed) {
								self.iScaleYStart = ZC._l_(self.iScaleYStart, oPlotArea.iX, oPlotArea.iX+oPlotArea.iWidth);
							} else {
								self.iScaleYStart = ZC._l_(self.iScaleYStart, oPlotArea.iY, oPlotArea.iY+oPlotArea.iHeight);
							}
						} else {
							self.iScaleYStart = (self.oScaleY.bInversed)?oPlotArea.iX:oPlotArea.iY;
						}
					}
				}
			}
			if (bValidZoom) {
				self.iScaleXEnd = self.iScaleXStart;
				self.iScaleYEnd = self.iScaleYStart;
				self.bActive = true;
				
				ZC.ZCQuery(document.body).bind('mousemove touchmove', self.zc_zoom_mousemove);
				ZC.ZCQuery(document.body).bind('mouseup touchend', self.zc_zoom_mouseup);
				
				if (!self.bPanning) {
					self.parse();
					if (!self.oGraph.oSettings['3d']) {
						ZC.ZCHtmlUtils._div_({
							id : sId + '-zoom',
							p : ZC._id_(sId + '-top'),
							top : -9,
							left : -9,
							wh : '1/1',
							position : 'absolute',
							border : self.iBorderWidth + 'px solid ' + self.sBorderColor,
							background : self.sBackgroundColor1,
							opacity : self.fAlpha
						});
					}
					if (self.oLabel.bVisible) {
						ZC.ZCHtmlUtils._div_({
							id : sId + '-from',
							p : ZC._id_(sId + '-top'),
							top : -9999,
							left : -9999,
							position : 'absolute',
							paddingTop : self.oLabel.iPaddingTop,
							paddingRight : self.oLabel.iPaddingRight,
							paddingBottom : self.oLabel.iPaddingBottom,
							paddingLeft : self.oLabel.iPaddingLeft,
							border : self.oLabel.iBorderWidth + 'px solid ' + self.oLabel.sBorderColor,
							background : self.oLabel.sBackgroundColor1,
							color : self.oLabel.sColor,
							fontWeight : (self.oLabel.bBold?'bold':'normal'),
							fontStyle : (self.oLabel.bItalic?'oblique':'normal'),
							fontSize : self.oLabel.iFontSize,
							text : ''
						});
						ZC.ZCHtmlUtils._div_({
							id : sId + '-to',
							p : ZC._id_(sId + '-top'),
							top : -9999,
							left : -9999,
							position : 'absolute',
							paddingTop : self.oLabel.iPaddingTop,
							paddingRight : self.oLabel.iPaddingRight,
							paddingBottom : self.oLabel.iPaddingBottom,
							paddingLeft : self.oLabel.iPaddingLeft,
							border : self.oLabel.iBorderWidth + 'px solid ' + self.oLabel.sBorderColor,
							background : self.oLabel.sBackgroundColor1,
							color : self.oLabel.sColor,
							fontWeight : (self.oLabel.bBold?'bold':'normal'),
							fontStyle : (self.oLabel.bItalic?'oblique':'normal'),
							fontSize : self.oLabel.iFontSize,
							text : ''
						});
					}	
					document.body.style.cursor = 'crosshair';
				} else {
					document.body.style.cursor = 'pointer';
				}
			}
			if (!ZC.mobile) {
				return false;
			}
		};
		self.zc_zoom_mousemove = function(ev) {
			if (ev.type === 'mousemove' && ZC.TOUCHEVENTS) {
				return;
			}
			ev.preventDefault();
			ZC.move = true;
			var iOffsetS, iOffsetE;
			if (self.bActive) {
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
				var iXEnd = aPageXY[0] - oOffset.left;
				var iYEnd = aPageXY[1] - oOffset.top;
				if (ev.ctrlKey) {
					var iDim = ZC._min_(iXEnd - self.iXStart, iYEnd - self.iYStart);
					iXEnd = self.iXStart + iDim;
					iYEnd = self.iYStart + iDim;
				}
				self.iScaleXEnd = self.oScaleX.bInversed?iYEnd:iXEnd;
				self.iScaleYEnd = self.oScaleY.bInversed?iXEnd:iYEnd;
				if (self.bPanning) {
					
				} else {
					var oPlotArea = self.oGraph.oPlotArea;
					iOffsetS = self.oScaleX.bMirrored?self.oScaleX.iOffsetEnd:self.oScaleX.iOffsetStart;
					iOffsetE = self.oScaleX.bMirrored?self.oScaleX.iOffsetStart:self.oScaleX.iOffsetEnd;
					if (self.oScaleX.bZooming) {
						if (self.oScaleX.bInversed) {
							if (self.oScaleX.bZoomSnap) {
								self.iScaleXStart = self.oScaleX.iY + iOffsetS + self.oScaleX.iStepSize*ZC._i_((self.iScaleXStart - self.oScaleX.iY - iOffsetS)/self.oScaleX.iStepSize);
								self.iScaleXEnd = self.oScaleX.iY + iOffsetS + self.oScaleX.iStepSize*ZC._i_((self.iScaleXEnd - self.oScaleX.iY - iOffsetS)/self.oScaleX.iStepSize);
							}
							self.iScaleXStart = ZC._l_(self.iScaleXStart, oPlotArea.iY + iOffsetE, oPlotArea.iY+oPlotArea.iHeight-iOffsetS);
							self.iScaleXEnd = ZC._l_(self.iScaleXEnd, oPlotArea.iY + iOffsetE, oPlotArea.iY+oPlotArea.iHeight-iOffsetS);
						} else {
							if (self.oScaleX.bZoomSnap) {
								self.iScaleXStart = self.oScaleX.iX + iOffsetS + self.oScaleX.iStepSize*ZC._i_((self.iScaleXStart - self.oScaleX.iX - iOffsetS)/self.oScaleX.iStepSize);
								self.iScaleXEnd = self.oScaleX.iX + iOffsetS + self.oScaleX.iStepSize*ZC._i_((self.iScaleXEnd - self.oScaleX.iX - iOffsetS)/self.oScaleX.iStepSize);
							}
							self.iScaleXStart = ZC._l_(self.iScaleXStart, oPlotArea.iX + iOffsetS, oPlotArea.iX+oPlotArea.iWidth-iOffsetE);
							self.iScaleXEnd = ZC._l_(self.iScaleXEnd, oPlotArea.iX + iOffsetS, oPlotArea.iX+oPlotArea.iWidth-iOffsetE);
						}
					} else {
						self.iScaleXStart = self.oScaleX.bInversed?(oPlotArea.iY+iOffsetE):(oPlotArea.iX+iOffsetS);
						self.iScaleXEnd = self.oScaleX.bInversed?(oPlotArea.iY+oPlotArea.iHeight-iOffsetS):(oPlotArea.iX+oPlotArea.iWidth-iOffsetE);
					}

					iOffsetS = self.oScaleY.bMirrored?self.oScaleY.iOffsetStart:self.oScaleY.iOffsetEnd;
					iOffsetE = self.oScaleY.bMirrored?self.oScaleY.iOffsetEnd:self.oScaleY.iOffsetStart;
					if (self.oScaleY.bZooming) {
						if (self.oScaleY.bInversed) {
							if (self.oScaleY.bZoomSnap) {
								self.iScaleYStart = self.oScaleY.iX + iOffsetS + self.oScaleY.iStepSize*ZC._i_((self.iScaleYStart - self.oScaleY.iX - iOffsetS)/self.oScaleY.iStepSize);
								self.iScaleYEnd = self.oScaleY.iX + iOffsetS + self.oScaleY.iStepSize*ZC._i_((self.iScaleYEnd - self.oScaleY.iX - iOffsetS)/self.oScaleY.iStepSize);
							}
							self.iScaleYStart = ZC._l_(self.iScaleYStart, oPlotArea.iX+iOffsetE, oPlotArea.iX+oPlotArea.iWidth-iOffsetS);
							self.iScaleYEnd = ZC._l_(self.iScaleYEnd, oPlotArea.iX+iOffsetE, oPlotArea.iX+oPlotArea.iWidth-iOffsetS);
						} else {
							if (self.oScaleY.bZoomSnap) {
								self.iScaleYStart = self.oScaleY.iY + iOffsetS + self.oScaleY.iStepSize*ZC._i_((self.iScaleYStart - self.oScaleY.iY - iOffsetS)/self.oScaleY.iStepSize);
								self.iScaleYEnd = self.oScaleY.iY + iOffsetS + self.oScaleY.iStepSize*ZC._i_((self.iScaleYEnd - self.oScaleY.iY - iOffsetS)/self.oScaleY.iStepSize);
							}
							self.iScaleYStart = ZC._l_(self.iScaleYStart, oPlotArea.iY+iOffsetS, oPlotArea.iY+oPlotArea.iHeight-iOffsetE);
							self.iScaleYEnd = ZC._l_(self.iScaleYEnd, oPlotArea.iY+iOffsetS, oPlotArea.iY+oPlotArea.iHeight-iOffsetE);
						}
					} else {
						self.iScaleYStart = self.oScaleY.bInversed?(oPlotArea.iX+iOffsetE):(oPlotArea.iY+iOffsetS);
						self.iScaleYEnd = self.oScaleY.bInversed?(oPlotArea.iX+oPlotArea.iWidth-iOffsetS):(oPlotArea.iY+oPlotArea.iHeight-iOffsetE);
					}
					var iWidth, iHeight, iLeft, iTop;
					var iBorderDiff = ZC.ZCQuery.browser.msie?0:2*self.iBorderWidth;
					if (self.oGraph.oSettings['3d']) {
						iBorderDiff = 0;
					}
					var oZoomObj = ZC._id_(sId + '-zoom');
					if (self.oScaleX.bInversed && self.oScaleY.bInversed) {
						iWidth = ZC._a_(self.iScaleYEnd - self.iScaleYStart - iBorderDiff);
						iHeight = ZC._a_(self.iScaleXEnd - self.iScaleXStart - iBorderDiff);
						iLeft = ZC._min_(self.iScaleYStart,self.iScaleYEnd);
						iTop = ZC._min_(self.iScaleXStart,self.iScaleXEnd);
					} else {
						iWidth = ZC._a_(self.iScaleXEnd - self.iScaleXStart - iBorderDiff);
						iHeight = ZC._a_(self.iScaleYEnd - self.iScaleYStart - iBorderDiff);
						iLeft = ZC._min_(self.iScaleXStart,self.iScaleXEnd);
						iTop =  ZC._min_(self.iScaleYStart,self.iScaleYEnd);
					}
					if (self.oGraph.oSettings['3d']) {
						self.oGraph.setup3DView();
						var oCanvas = ZC._id_(self.oLoader.sId + '-guide-c');
						if (oCanvas) {
							
							ZC.ZCHtmlUtils._clear_(oCanvas, self.oLoader.sOutput, self.oGraph.iX, self.oGraph.iY, self.oGraph.iWidth, self.oGraph.iHeight);
							ZC.ZCQuery('.zc-guide-label').remove();
						}
						oZoomObj = new ZC.ZCShape(self);
						oZoomObj.oCanvas = oCanvas;
						oZoomObj.sBackgroundColor1 = oZoomObj.sBackgroundColor2 = self.sBackgroundColor1;
						oZoomObj.sBorderColor = self.sBorderColor;
						oZoomObj.iBorderWidth = self.iBorderWidth;
						oZoomObj.fAlpha = self.fAlpha;
						oZoomObj.aPoints = [
							[iLeft, iTop],
							[iLeft+iWidth, iTop],
							[iLeft+iWidth, iTop+iHeight],
							[iLeft, iTop+iHeight],
							[iLeft, iTop]
						];
						for (var i=0;i<oZoomObj.aPoints.length;i++) {
							var oPoint3D = new ZC.ZCPoint3D(self.oGraph, oZoomObj.aPoints[i][0] - ZC.ZCDraw3D.iViewX, oZoomObj.aPoints[i][1] - ZC.ZCDraw3D.iViewY, 0);
							oZoomObj.aPoints[i][0] = oPoint3D.aXY[0];
							oZoomObj.aPoints[i][1] = oPoint3D.aXY[1];
						}
						oZoomObj.parse();
						oZoomObj.paint();
					} else {
						ZC.ZCHtmlUtils._style_(oZoomObj, {
							width : iWidth + 'px',
							height : iHeight + 'px',
							left : iLeft + 'px',
							top : iTop + 'px'
						});
					}

					if (self.oLabel.bVisible) {
						var iXMin = ZC._min_(self.iScaleXStart, self.iScaleXEnd);
						var iXMax = ZC._max_(self.iScaleXStart, self.iScaleXEnd);
						var iYMin = ZC._min_(self.iScaleYStart, self.iScaleYEnd);
						var iYMax = ZC._max_(self.iScaleYStart, self.iScaleYEnd);
						var oFrom = ZC._id_(sId + '-from'), oTo = ZC._id_(sId + '-to');
						var oFormat = {
							decimals : (ZC._n_(self.oScaleY.iDecimals)===null?1:self.oScaleY.iDecimals)
						};
						oFrom.innerHTML = self.oScaleX.getParsedItemLabel(self.oScaleX.getIndexByCoord(iXMin)) + '/' + self.oScaleY.getParsedItemLabel(-1, self.oScaleY.getValueByCoord(iYMin), oFormat);
						oTo.innerHTML = self.oScaleX.getParsedItemLabel(self.oScaleX.getIndexByCoord(iXMax)) + '/' + self.oScaleY.getParsedItemLabel(-1, self.oScaleY.getValueByCoord(iYMax), oFormat);
						ZC.ZCHtmlUtils._style_(oFrom, {
							left : (iLeft - self.iBorderWidth - ZC._i_(ZC.ZCQuery(oFrom).width())) + 'px',
							top : (iTop - self.iBorderWidth - ZC._i_(ZC.ZCQuery(oFrom).height())) + 'px'
						});
						ZC.ZCHtmlUtils._style_(oTo, {
							left : (iLeft + self.iBorderWidth + self.oLabel.iBorderWidth + iWidth) + 'px',
							top : (iTop + self.iBorderWidth + self.oLabel.iBorderWidth + iHeight) + 'px'
						});
					}
				}
			}
			return false;
		};
		self.zc_zoom_mouseup = function(ev) {
			if (ev.type === 'mouseup' && ZC.TOUCHEVENTS) {
				return;
			}
			if (!self.oGraph) {
				return;
			}
			ZC.move = false;
			self.bActive = false;

			document.body.style.cursor = 'auto';
			ZC.ZCHtmlUtils._remove_([sId +'-zoom', sId +'-from', sId +'-to']);
			if (self.oGraph.oSettings['3d']) {
				self.oGraph.setup3DView();
				var oCanvas = ZC._id_(self.oLoader.sId + '-guide-c');
				if (oCanvas) {
					
					ZC.ZCHtmlUtils._clear_(oCanvas, self.oLoader.sOutput, self.oGraph.iX, self.oGraph.iY, self.oGraph.iWidth, self.oGraph.iHeight);
					ZC.ZCQuery('.zc-guide-label').remove();
				}
			}
			
			ZC.ZCQuery(document.body).unbind('mousemove touchmove', self.zc_zoom_mousemove);
			ZC.ZCQuery(document.body).unbind('mouseup touchend', self.zc_zoom_mouseup);
			if (self.bPanning) {
				self.bPanning = false;
				return;
			}

			var oParams = {graphid : self.oGraph.sId};
			var iMinIndex, iMaxIndex, aScales, i, iLen, sScaleIdx, fMinValue, fMaxValue, fMinRange;
			if (ZC._a_(self.iScaleXStart-self.iScaleXEnd) > 20 && ZC._a_(self.iScaleYStart-self.iScaleYEnd) > 20) {
				var bZoomX = false, bZoomY = false;
				if (self.oScaleX.bInversed && self.oScaleY.bInversed) {
					iMinIndex = self.oScaleX.getIndexByCoord(ZC._min_(self.iScaleXStart, self.iScaleXEnd));
					iMaxIndex = self.oScaleX.getIndexByCoord(ZC._max_(self.iScaleXStart, self.iScaleXEnd));
					if (ZC._a_(iMaxIndex-iMinIndex) > 1) {
						oParams['zoomx'] = true;
						oParams['xmin'] = ZC._min_(iMinIndex, iMaxIndex);
						oParams['xmax'] = ZC._max_(iMinIndex, iMaxIndex);
						bZoomX = true;
					}
					fMinValue = self.oScaleY.getValueByCoord(ZC._max_(self.iScaleYStart, self.iScaleYEnd));
					fMaxValue = self.oScaleY.getValueByCoord(ZC._min_(self.iScaleYStart, self.iScaleYEnd));
					fMinRange = (self.oScaleY.fMax_-self.oScaleY.fMin_)/1000;
					if (ZC._a_(fMaxValue-fMinValue) > fMinRange) {
						oParams['zoomy'] = true;
						oParams['ymin'] = ZC._min_(fMinValue, fMaxValue);
						oParams['ymax'] = ZC._max_(fMinValue, fMaxValue);
						bZoomY = true;
					}
				} else {
					var oScaleK, oScaleV;
					aScales = self.oGraph.getScales('k');
					for (i=0,iLen=aScales.length;i<iLen;i++) {
						if ((oScaleK=aScales[i]) && aScales[i].bZooming) {
							sScaleIdx = (oScaleK.iIndex===1)?'':('-'+oScaleK.iIndex);
							iMinIndex = oScaleK.getIndexByCoord(ZC._min_(self.iScaleXStart, self.iScaleXEnd));
							iMaxIndex = oScaleK.getIndexByCoord(ZC._max_(self.iScaleXStart, self.iScaleXEnd));
							if (ZC._a_(iMaxIndex-iMinIndex) > 1) {
								oParams['zoomx'+sScaleIdx] = true;
								oParams['xmin'+sScaleIdx] = ZC._min_(iMinIndex, iMaxIndex);
								oParams['xmax'+sScaleIdx] = ZC._max_(iMinIndex, iMaxIndex);
								bZoomX = true;
							}
						}
					}
					aScales = self.oGraph.getScales('v');
					for (i=0,iLen=aScales.length;i<iLen;i++) {
						if ((oScaleV=aScales[i]) && aScales[i].bZooming) {
							sScaleIdx = (oScaleV.iIndex===1)?'':('-'+oScaleV.iIndex);
							fMinValue = oScaleV.getValueByCoord(ZC._max_(self.iScaleYStart, self.iScaleYEnd));
							fMaxValue = oScaleV.getValueByCoord(ZC._min_(self.iScaleYStart, self.iScaleYEnd));
							fMinRange = (oScaleV.fMax_-oScaleV.fMin_)/1000;
							if (ZC._a_(fMaxValue-fMinValue) > fMinRange) {
								oParams['zoomy'+sScaleIdx] = true;
								oParams['ymin'+sScaleIdx] = ZC._min_(fMinValue, fMaxValue);
								oParams['ymax'+sScaleIdx] = ZC._max_(fMinValue, fMaxValue);
								bZoomY = true;
							}
						}
					}
				}

				if (bZoomX || bZoomY) {
					zingchart.SKIP.EVENT = true;
					self.oGraph.oParent._api_zoomto_(oParams);
				} else {
					zingchart.SKIP.EVENT = true;
				}
			} else {
				if (ZC._a_(self.iScaleXStart-self.iScaleXEnd) > 5 || ZC._a_(self.iScaleYStart-self.iScaleYEnd) > 5) {
					zingchart.SKIP.EVENT = true;
				}
			}
			
			self.oGraph = null;
		};
		if (!ZC.mobile || zingchart.TOUCHZOOM === 'normal') {
			
			ZC.ZCQuery('#' + sId + '-img').bind('mousedown touchstart', self.zc_zoom_mousedown);
			
			

		}
	}
});











ZC.ZCPreview = ZC.ZCStyle.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.bInit = true;
		self.bLive = false;
		self.oGraph = oParent;
		self.oLoader = oParent.oParent;
		self.bActive = false;
		self.bMove = false;
		self.oHandlerActive = null;
		self.oViewport = null;
		self.oCanvas = null;
		self.iXLeft = 0;
		self.iXRight = 0;
		self.iMinDistanceX = 0;
		self.iMinDistanceY = 0;
		self.bAsync = false;
		self.oScaleInfo = null;
	},
	parse : function() {
		var self = this, mValue;
		self.sId = self.oGraph.sId + '-preview';

		self.assign_a([
			['live', 'bLive', 'b'],
			['async', 'bAsync', 'b'],
			['min-distance', 'iMinDistanceX', 'i'],
			['min-distance-x', 'iMinDistanceX', 'i'],
			['min-distance-y', 'iMinDistanceX', 'i']
		]);

		
		var sGTP = '(' + self.oGraph.sType + ').preview';
		var oDef = self.oLoader.oDefaults;

		self.oViewport = new ZC.ZCBox(self.oGraph);
		self.oViewport.sId = self.oGraph.sId + '-preview-viewport';
		oDef.load(self.oViewport.oData, [
			sGTP
		]);
		self.oViewport.append(self.oData);
		self.oViewport.parse();

		self.oMaskStyle = new ZC.ZCStyle(self.oGraph);
		oDef.load(self.oMaskStyle.oData, [
			sGTP + '.mask'
		]);
		if (ZC._n_(mValue=self.oData['mask']) !== null) {
			self.oMaskStyle.append(mValue);
		}
		self.oMaskStyle.parse();

		self.oActiveStyle = new ZC.ZCStyle(self.oGraph);
		oDef.load(self.oActiveStyle.oData, [
			sGTP + '.active'
		]);
		if (ZC._n_(mValue=self.oData['active']) !== null) {
			self.oActiveStyle.append(mValue);
		}
		self.oActiveStyle.parse();

		function _def_(sPos) {
			return [
				sGTP + '.handler',
				sGTP + '.handler-' + sPos,
				sGTP + '.handle',
				sGTP + '.handle-' + sPos
			];
		}

		self.oHandlerStyleLeft = new ZC.ZCBox(self);
		self.oHandlerStyleRight = new ZC.ZCBox(self);
		self.oHandlerStyleTop = new ZC.ZCBox(self);
		self.oHandlerStyleBottom = new ZC.ZCBox(self);

		oDef.load(self.oHandlerStyleLeft.oData, _def_('left'));
		oDef.load(self.oHandlerStyleRight.oData, _def_('right'));
		oDef.load(self.oHandlerStyleTop.oData, _def_('top'));
		oDef.load(self.oHandlerStyleBottom.oData, _def_('bottom'));

		
		var aHandleAttrs = ['handle', 'handler'];
		for (var i=0;i<aHandleAttrs.length;i++) {
			if (ZC._n_(mValue=self.oData[aHandleAttrs[i]]) !== null) {
				self.oHandlerStyleLeft.append(mValue);
				self.oHandlerStyleRight.append(mValue);
			}
			if (ZC._n_(mValue=self.oData[aHandleAttrs[i] + '-left']) !== null) {
				self.oHandlerStyleLeft.append(mValue);
			}
			if (ZC._n_(mValue=self.oData[aHandleAttrs[i] + '-right']) !== null) {
				self.oHandlerStyleRight.append(mValue);
			}
			if (ZC._n_(mValue=self.oData[aHandleAttrs[i] + '-top']) !== null) {
				self.oHandlerStyleTop.append(mValue);
			}
			if (ZC._n_(mValue=self.oData[aHandleAttrs[i] + '-bottom']) !== null) {
				self.oHandlerStyleBottom.append(mValue);
			}
		}
		self.oHandlerStyleLeft.parse();
		self.oHandlerStyleRight.parse();
		self.oHandlerStyleTop.parse();
		self.oHandlerStyleBottom.parse();
	},
	paint : function() {
		var self = this;
		
		self.oCanvas = self.oViewport.oCanvas = self.oViewport.oCanvasSh = ZC._id_(self.oGraph.sId + '-preview-c');
		

		self.oViewport.paint();

		var oMain = ZC._id_(self.oLoader.sId + '-top');

		var oScaleX = self.oGraph.getScales('k')[0], oScaleY = self.oGraph.getScales('v')[0];

		if (self.oScaleInfo === null) {
			self.oScaleInfo = {};
			var aScales = self.oGraph.aScales, oScale;
			for (var i=0,iLen=aScales.length;i<iLen;i++) {
				if ((oScale=aScales[i])) {
					
					if (oScale.sType === 'k') {
						self.oScaleInfo[oScale.sName] = {
							minindex : oScale.iMinIndex_, 
							maxindex : oScale.iMaxIndex_, 
							minvalue : oScale.aValues[oScale.iMinIndex_], 
							maxvalue : oScale.aValues[oScale.iMaxIndex_],
							stepsize : oScale.iStepSize,
							values : [].concat(oScale.aValues)
						};
					} else {
						self.oScaleInfo[oScale.sName] = {
							minvalue : oScale.fMin_, 
							maxvalue : oScale.fMax_
						};
					}
				}
			}
		}

		if (self.iMinDistanceX === 0) {
			if (oScaleX) {
				self.iMinDistanceX = ZC._max_(1, ZC._i_(2*self.oViewport.iWidth/oScaleX.aValues.length));
			}
		}

		self.iExtra = ZC.mobile?40:(ZC.ie67?0:20);
		var iHandlerW, iHandlerH, oCtx, yt, yb, xr, xl, aHandlerPoints;

		

		if (oScaleX.bZooming || oScaleY.bZooming) {
			self.oHandlerMiddle = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-handler zc-preview-handler-middle ' + self.oGraph.sId + '-preview-handler',
				id : self.sId + '-handler-middle',
				wh : self.oViewport.iWidth + '/' + self.oViewport.iHeight,
				tl : self.oViewport.iY + '/' + self.oViewport.iX,
				background : self.oActiveStyle.sBackgroundColor1,
				opacity : self.oActiveStyle.fAlpha,
				p : oMain
			});
			self.oHandlerMiddle.style.cursor = 'pointer';
		}

		if (oScaleX.bZooming) {

			self.oMaskXLeft = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-mask zc-preview-mask-left ' + self.oGraph.sId + '-preview-mask',
				id : self.sId + '-mask-x-left',
				wh : '0/' + self.oViewport.iHeight,
				tl : self.oViewport.iY + '/' + self.oViewport.iX,
				background : self.oMaskStyle.sBackgroundColor1,
				opacity : self.oMaskStyle.fAlpha,
				p : oMain
			});
			self.oMaskXRight = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-mask zc-preview-mask-right ' + self.oGraph.sId + '-preview-mask',
				id : self.sId + '-mask-x-right',
				wh : '0/' + self.oViewport.iHeight,
				tl : self.oViewport.iY + '/' + (self.oViewport.iX + self.oViewport.iWidth),
				background : self.oMaskStyle.sBackgroundColor1,
				opacity : self.oMaskStyle.fAlpha,
				p : oMain
			});

			iHandlerW = self.oHandlerStyleLeft.iWidth;
			iHandlerH = self.oHandlerStyleLeft.iHeight;

			self.oHandlerXLeft = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-handler zc-preview-handler-left ' + self.oGraph.sId + '-preview-handler',
				id : self.sId + '-handler-x-left',
				wh : ZC.quirks?null:(iHandlerW + '/' + iHandlerH),
				lineHeight : '10%',
				tl : ZC._i_(self.oViewport.iY + (self.oViewport.iHeight-iHandlerH)/4 - self.iExtra/2) + '/' + ZC._i_(self.oViewport.iX - iHandlerW/2 - self.iExtra/2),
				p : oMain,
				border : self.iExtra/2 + 'px solid transparent'
			});
			self.oHandlerXLeft.style.cursor = 'pointer';

			var oHandlerXLeftContainer = self.oHandlerXLeft;
			if (self.oLoader.sOutput === 'svg') {
				var oHandlerXLeftSvg = ZC.ZCHtmlUtils._element_('svg', 'http://www.w3.org/2000/svg');
				ZC.ZCHtmlUtils._attr_(oHandlerXLeftSvg, {
					version : '1.1',
					width : iHandlerW,
					height : iHandlerH
				});
				self.oHandlerXLeft.appendChild(oHandlerXLeftSvg);
				oHandlerXLeftContainer = oHandlerXLeftSvg;
			}

			var oHandlerXLeftC = ZC.ZCHtmlUtils._layer_({
				cls : 'zc-no-print',
				id : self.sId + '-handler-x-left-c',
				wh : iHandlerW + '/' + iHandlerH,
				p : oHandlerXLeftContainer
			}, self.oLoader.sOutput);
			self.oHandlerStyleLeft.oCanvas = oHandlerXLeftC;
			self.oHandlerStyleLeft.sId = self.sId + '-handler-x-left-c-preview';
			self.oHandlerStyleLeft.iX = 0;
			self.oHandlerStyleLeft.iY = 0;
			self.oHandlerStyleLeft.paint();

			oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.sId + '-handler-x-left-c'), self.oLoader.sOutput);
			var iHSLLW = self.oHandlerStyleLeft.iLineWidth, iHSLBW = self.oHandlerStyleLeft.iBorderWidth;
			xl = ZC._i_(iHandlerW/2 - iHSLLW);
			xr = ZC._i_(iHandlerW/2 + iHSLLW);
			yb = iHSLBW + 3;
			yt = iHandlerH - iHSLBW - 2;
			aHandlerPoints = [
				[xl, yb],
				[xl, yt],
				null,
				[xr, yb],
				[xr, yt]
			];
			self.oHandlerStyleLeft.bPixelCorrection = true;
			ZC.ZCLine.paint(oCtx, self.oHandlerStyleLeft, aHandlerPoints);

			iHandlerW = self.oHandlerStyleRight.iWidth;
			iHandlerH = self.oHandlerStyleRight.iHeight;

			self.oHandlerXRight = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-handler zc-preview-handler-right ' + self.oGraph.sId + '-preview-handler',
				id : self.sId + '-handler-x-right',
				wh : ZC.quirks?null:(iHandlerW + '/' + iHandlerH),
				lineHeight : '10%',
				tl : ZC._i_(self.oViewport.iY + self.oViewport.iHeight - self.oHandlerStyleRight.iHeight - (self.oViewport.iHeight-iHandlerH)/4 - self.iExtra/2) + '/' + ZC._i_(self.oViewport.iX + self.oViewport.iWidth - self.oHandlerStyleRight.iWidth/2 - self.iExtra/2),
				p : oMain,
				border : self.iExtra/2 + 'px solid transparent'
			});
			self.oHandlerXRight.style.cursor = 'pointer';

			var oHandlerXRightContainer = self.oHandlerXRight;
			if (self.oLoader.sOutput === 'svg') {
				var oHandlerXRightSvg = ZC.ZCHtmlUtils._element_('svg', 'http://www.w3.org/2000/svg');
				ZC.ZCHtmlUtils._attr_(oHandlerXRightSvg, {
					version : '1.1',
					width : iHandlerW,
					height : iHandlerH
				});
				self.oHandlerXRight.appendChild(oHandlerXRightSvg);
				oHandlerXRightContainer = oHandlerXRightSvg;
			}

			var oHandlerXRightC = ZC.ZCHtmlUtils._layer_({
				cls : 'zc-no-print',
				id : self.sId + '-handler-x-right-c',
				wh : iHandlerW + '/' + iHandlerH,
				p : oHandlerXRightContainer
			}, self.oLoader.sOutput);
			self.oHandlerStyleRight.oCanvas = oHandlerXRightC;
			self.oHandlerStyleRight.sId = self.sId + '-handler-x-right-c-preview';
			self.oHandlerStyleRight.iX = 0;
			self.oHandlerStyleRight.iY = 0;
			self.oHandlerStyleRight.paint();

			oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.sId + '-handler-x-right-c'), self.oLoader.sOutput);
			var iHSRLW = self.oHandlerStyleRight.iLineWidth, iHSRBW = self.oHandlerStyleRight.iBorderWidth;
			xl = ZC._i_(iHandlerW/2 - iHSRLW);
			xr = ZC._i_(iHandlerW/2 + iHSRLW);
			yb = iHSRBW + 3;
			yt = iHandlerH - iHSRBW - 2;
			aHandlerPoints = [
				[xl, yb],
				[xl, yt],
				null,
				[xr, yb],
				[xr, yt]
			];
			self.oHandlerStyleRight.bPixelCorrection = true;
			ZC.ZCLine.paint(oCtx, self.oHandlerStyleRight, aHandlerPoints);

		}

		

		if (oScaleY.bZooming) {

			self.oMaskYTop = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-mask zc-preview-mask-top ' + self.oGraph.sId + '-preview-mask',
				id : self.sId + '-mask-x-top',
				wh : self.oViewport.iWidth + '/0',
				tl : self.oViewport.iY + '/' + self.oViewport.iX,
				background : self.oMaskStyle.sBackgroundColor1,
				opacity : self.oMaskStyle.fAlpha,
				p : oMain
			});
			self.oMaskYBottom = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-mask zc-preview-mask-bottom ' + self.oGraph.sId + '-preview-mask',
				id : self.sId + '-mask-x-bottom',
				wh : self.oViewport.iWidth + '/0',
				tl : (self.oViewport.iY + self.oViewport.iHeight) + '/' + self.oViewport.iX,
				background : self.oMaskStyle.sBackgroundColor1,
				opacity : self.oMaskStyle.fAlpha,
				p : oMain
			});

			iHandlerW = self.oHandlerStyleTop.iWidth;
			iHandlerH = self.oHandlerStyleTop.iHeight;

			self.oHandlerYTop = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-handler zc-preview-handler-top ' + self.oGraph.sId + '-preview-handler',
				id : self.sId + '-handler-y-top',
				wh : ZC.quirks?null:(iHandlerW + '/' + iHandlerH),
				lineHeight : '10%',
				tl : ZC._i_(self.oViewport.iY - iHandlerH/2 - self.iExtra/2) + '/' + ZC._i_(self.oViewport.iX + (self.oViewport.iWidth-iHandlerW)/4 - self.iExtra/2),
				p : oMain,
				border : self.iExtra/2 + 'px solid transparent'
			});
			self.oHandlerYTop.style.cursor = 'pointer';

			var oHandlerYTopContainer = self.oHandlerYTop;
			if (self.oLoader.sOutput === 'svg') {
				var oHandlerYTopSvg = ZC.ZCHtmlUtils._element_('svg', 'http://www.w3.org/2000/svg');
				ZC.ZCHtmlUtils._attr_(oHandlerYTopSvg, {
					version : '1.1',
					width : iHandlerW,
					height : iHandlerH
				});
				self.oHandlerYTop.appendChild(oHandlerYTopSvg);
				oHandlerYTopContainer = oHandlerYTopSvg;
			}

			var oHandlerYTopC = ZC.ZCHtmlUtils._layer_({
				cls : 'zc-no-print',
				id : self.sId + '-handler-y-top-c',
				wh : iHandlerW + '/' + iHandlerH,
				p : oHandlerYTopContainer
			}, self.oLoader.sOutput);
			self.oHandlerStyleTop.oCanvas = oHandlerYTopC;
			self.oHandlerStyleTop.sId = self.sId + '-handler-y-top-c-preview';
			self.oHandlerStyleTop.iX = 0;
			self.oHandlerStyleTop.iY = 0;
			self.oHandlerStyleTop.paint();

			oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.sId + '-handler-y-top-c'), self.oLoader.sOutput);
			var iHSTLW = self.oHandlerStyleTop.iLineWidth, iHSTBW = self.oHandlerStyleTop.iBorderWidth;
			yt = ZC._i_(iHandlerH/2 - iHSTLW);
			yb = ZC._i_(iHandlerH/2 + iHSTLW);
			xr = iHSTBW + 3;
			xl = iHandlerW - iHSTBW - 2;
			aHandlerPoints = [
				[xl, yb],
				[xr, yb],
				null,
				[xl, yt],
				[xr, yt]
			];
			self.oHandlerStyleTop.bPixelCorrection = true;
			ZC.ZCLine.paint(oCtx, self.oHandlerStyleTop, aHandlerPoints);

			iHandlerW = self.oHandlerStyleBottom.iWidth;
			iHandlerH = self.oHandlerStyleBottom.iHeight;

			self.oHandlerYBottom = ZC.ZCHtmlUtils._div_({
				cls : 'zc-abs zc-preview-handler zc-preview-handler-bottom ' + self.oGraph.sId + '-preview-handler',
				id : self.sId + '-handler-y-bottom',
				wh : ZC.quirks?null:(iHandlerW + '/' + iHandlerH),
				lineHeight : '10%',
				tl : ZC._i_(self.oViewport.iY + self.oViewport.iHeight - self.oHandlerStyleBottom.iHeight/2 - self.iExtra/2) + '/' + ZC._i_(self.oViewport.iX + self.oViewport.iWidth - self.oHandlerStyleBottom.iWidth - (self.oViewport.iWidth-iHandlerW)/4 - self.iExtra/2),
				p : oMain,
				border : self.iExtra/2 + 'px solid transparent'
			});
			self.oHandlerYBottom.style.cursor = 'pointer';

			var oHandlerYBottomContainer = self.oHandlerYBottom;
			if (self.oLoader.sOutput === 'svg') {
				var oHandlerYBottomSvg = ZC.ZCHtmlUtils._element_('svg', 'http://www.w3.org/2000/svg');
				ZC.ZCHtmlUtils._attr_(oHandlerYBottomSvg, {
					version : '1.1',
					width : iHandlerW,
					height : iHandlerH
				});
				self.oHandlerYBottom.appendChild(oHandlerYBottomSvg);
				oHandlerYBottomContainer = oHandlerYBottomSvg;
			}

			var oHandlerYBottomC = ZC.ZCHtmlUtils._layer_({
				cls : 'zc-no-print',
				id : self.sId + '-handler-y-bottom-c',
				wh : iHandlerW + '/' + iHandlerH,
				p : oHandlerYBottomContainer
			}, self.oLoader.sOutput);
			self.oHandlerStyleBottom.oCanvas = oHandlerYBottomC;
			self.oHandlerStyleBottom.sId = self.sId + '-handler-y-bottom-c-preview';
			self.oHandlerStyleBottom.iX = 0;
			self.oHandlerStyleBottom.iY = 0;
			self.oHandlerStyleBottom.paint();

			oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.sId + '-handler-y-bottom-c'), self.oLoader.sOutput);
			var iHSBLW = self.oHandlerStyleBottom.iLineWidth, iHSBBW = self.oHandlerStyleBottom.iBorderWidth;
			yt = ZC._i_(iHandlerH/2 - iHSBLW);
			yb = ZC._i_(iHandlerH/2 + iHSBLW);
			xr = iHSBBW + 3;
			xl = iHandlerW - iHSBBW - 2;
			aHandlerPoints = [
				[xl, yb],
				[xr, yb],
				null,
				[xl, yt],
				[xr, yt]
			];
			self.oHandlerStyleBottom.bPixelCorrection = true;
			ZC.ZCLine.paint(oCtx, self.oHandlerStyleBottom, aHandlerPoints);

		}

		

		self.iXLeft = 0;
		self.iXRight = self.oViewport.iWidth;
		self.iYTop = 0;
		self.iYBottom = self.oViewport.iHeight;
		self.bind();
	},
	update : function(iXLeft, iXRight, iYTop, iYBottom, bIndexes) {
		if (ZC._n_(bIndexes) === null) { bIndexes = false; }
		var self = this;
		var oScaleX = self.oGraph.getScales('k')[0], oScaleY = self.oGraph.getScales('v', true)[0];
		if (!oScaleY) {
			oScaleY = oScaleY = self.oGraph.getScales('v')[0];
		}
		var bUpdate = true;

		if (bIndexes) {
			if (oScaleX && oScaleY) {
				if (ZC._n_(iXLeft) === null) { iXLeft = oScaleX.iMinIndex; }
				if (ZC._n_(iXRight) === null) { iXRight = oScaleX.iMaxIndex; }
				if (ZC._n_(iYTop) === null) { iYTop = oScaleY.bAutoFit?oScaleY.fMin_:oScaleY.fMin; }
				if (ZC._n_(iYBottom) === null) { iYBottom = oScaleY.bAutoFit?oScaleY.fMax_:oScaleY.fMax; }

				self.update(
					(iXLeft - oScaleX.iMinIndex_)*self.oViewport.iWidth/(oScaleX.iMaxIndex_-oScaleX.iMinIndex_),
					(iXRight - oScaleX.iMinIndex_)*self.oViewport.iWidth/(oScaleX.iMaxIndex_-oScaleX.iMinIndex_),
					self.oViewport.iHeight - (iYBottom - oScaleY.fMin_)*self.oViewport.iHeight/(oScaleY.fMax_-oScaleY.fMin_),
					self.oViewport.iHeight - (iYTop - oScaleY.fMin_)*self.oViewport.iHeight/(oScaleY.fMax_-oScaleY.fMin_)
				);
			}
			return;
		}

		if (iXRight - iXLeft < self.iMinDistanceX) {
			if (self.oHandlerActive === self.oHandlerXRight) {
				iXRight = iXLeft + self.iMinDistanceX;
			} else if (self.oHandlerActive === self.oHandlerXLeft) {
				iXLeft = iXRight - self.iMinDistanceX;
			}
		}
		if (iYBottom - iYTop < self.iMinDistanceY) {
			if (self.oHandlerActive === self.oHandlerYBottom) {
				iYBottom = iYTop + self.iMinDistanceY;
			} else if (self.oHandlerActive === self.oHandlerYTop) {
				iYTop = iYBottom - self.iMinDistanceY;
			}
		}

		

		
		if (iXLeft > iXRight) {
			if (self.oHandlerActive === self.oHandlerXLeft) {
				self.update(iXRight-1, iXRight, iYTop, iYBottom);
			} else if (self.oHandlerActive === self.oHandlerXRight) {
				self.update(iXLeft, iXLeft+1, iYTop, iYBottom);
			}
			bUpdate = false;
		}
		if (iXLeft < 0) {
			if (self.oHandlerActive === self.oHandlerXLeft) {
				self.update(0, iXRight, iYTop, iYBottom);
			} else if (self.oHandlerActive === self.oHandlerMiddle) {
				self.update(0, ZC.ZCQuery(self.oHandlerMiddle).width(), iYTop, iYBottom);
			}
			bUpdate = false;
		}
		if (iXRight > self.oViewport.iWidth) {
			if (self.oHandlerActive === self.oHandlerXRight) {
				self.update(iXLeft, self.oViewport.iWidth, iYTop, iYBottom);
			} else if (self.oHandlerActive === self.oHandlerMiddle) {
				self.update(self.oViewport.iWidth - ZC.ZCQuery(self.oHandlerMiddle).width(), self.oViewport.iWidth, iYTop, iYBottom);
			}
			bUpdate = false;
		}

		

		

		
		if (iYTop > iYBottom) {
			if (self.oHandlerActive === self.oHandlerYTop) {
				self.update(iXLeft, iXRight, iYTop-1, iYBottom);
			} else if (self.oHandlerActive === self.oHandlerYBottom) {
				self.update(iXLeft, iXRight, iYTop, iYBottom+1);
			}
			bUpdate = false;
		}
		if (iYTop < 0) {
			if (self.oHandlerActive === self.oHandlerYTop) {
				self.update(iXLeft, iXRight, 0, iYBottom);
			} else if (self.oHandlerActive === self.oHandlerMiddle) {
				self.update(iXLeft, iXRight, 0, ZC.ZCQuery(self.oHandlerMiddle).height());
			}
			bUpdate = false;
		}
		if (iYBottom > self.oViewport.iHeight) {
			if (self.oHandlerActive === self.oHandlerYBottom) {
				self.update(iXLeft, iXRight, iYTop, self.oViewport.iHeight);
			} else if (self.oHandlerActive === self.oHandlerMiddle) {
				self.update(iXLeft, iXRight, self.oViewport.iHeight - ZC.ZCQuery(self.oHandlerMiddle).height(), self.oViewport.iHeight);
			}
			bUpdate = false;
		}

		

		if (bUpdate) {

			if (oScaleX && oScaleX.bZoomSnap) {
				var iStepSize = self.oViewport.iWidth/(oScaleX.aValues.length-(oScaleX.bRanged?0:1));
				iXLeft = iStepSize*Math.round(iXLeft/iStepSize);
				iXRight = ZC._min_(iStepSize*Math.round(iXRight/iStepSize), self.oViewport.iWidth);
			}

			self.iXLeft = iXLeft;
			self.iXRight = iXRight;
			self.iYTop = iYTop;
			self.iYBottom = iYBottom;

			if (oScaleX.bZooming) {
				self.oHandlerXLeft.style.left = ZC._i_(self.oViewport.iX + self.iXLeft - self.oHandlerStyleLeft.iWidth/2 - self.iExtra/2) + 'px';
				self.oMaskXLeft.style.width = ZC._i_(self.iXLeft) + 'px';

				self.oHandlerXRight.style.left = ZC._i_(self.oViewport.iX + self.iXRight - self.oHandlerStyleRight.iWidth/2 - self.iExtra/2) + 'px';
				self.oMaskXRight.style.left = ZC._i_(self.oViewport.iX + self.iXRight) + 'px';
				self.oMaskXRight.style.width = ZC._i_(self.oViewport.iWidth - self.iXRight) + 'px';
			}

			if (oScaleY.bZooming) {
				self.oHandlerYTop.style.top = ZC._i_(self.oViewport.iY + self.iYTop - self.oHandlerStyleTop.iHeight/2 - self.iExtra/2) + 'px';
				self.oMaskYTop.style.height = ZC._i_(self.iYTop) + 'px';

				self.oHandlerYBottom.style.top = ZC._i_(self.oViewport.iY + self.iYBottom - self.oHandlerStyleBottom.iHeight/2 - self.iExtra/2) + 'px';
				self.oMaskYBottom.style.top = ZC._i_(self.oViewport.iY + self.iYBottom) + 'px';
				self.oMaskYBottom.style.height = ZC._i_(self.oViewport.iHeight - self.iYBottom) + 'px';
			}

			if (oScaleX.bZooming || oScaleY.bZooming) {
				self.oHandlerMiddle.style.left = ZC._i_(self.oViewport.iX + self.iXLeft) + 'px';
				self.oHandlerMiddle.style.width = ZC._i_(self.iXRight - self.iXLeft) + 'px';
				self.oHandlerMiddle.style.top = ZC._i_(self.oViewport.iY + self.iYTop) + 'px';
				self.oHandlerMiddle.style.height = ZC._i_(self.iYBottom - self.iYTop) + 'px';
			}

			if (self.bLive && self.bActive) {
				self.oGraph.bScrolling = true;
				self.zoom(true);
			}
		}
	},
	zoom : function(bZooming) {
		var self = this;
		
		var oParams = {
			graphid : self.oGraph.sId,
			preview : 1,
			async : self.bAsync,
			previewscale : true,
			zooming : bZooming
		};
		var aScales = self.oGraph.aScales, oScale;
		var oScaleX = self.oGraph.getScales('k')[0], oScaleY = self.oGraph.getScales('v')[0];
		for (var i=0,iLen=aScales.length;i<iLen;i++) {
			if ((oScale=aScales[i])) {
				var sScaleIdx = (oScale.iIndex===1)?'':('-'+oScale.iIndex);
				if (oScale.sType === 'k') {
					if (oScaleX.bZooming) {
						var iMinIndex = self.bAsync?self.oScaleInfo[oScale.sName]['minindex']:oScale.iMinIndex_, iMaxIndex = self.bAsync?self.oScaleInfo[oScale.sName]['maxindex']:oScale.iMaxIndex_;
						oParams['zoomx'+sScaleIdx] = true;
						oParams['xmin'+sScaleIdx] = ZC._i_((self.iXLeft/self.oViewport.iWidth)*(iMaxIndex-iMinIndex));
						oParams['xmax'+sScaleIdx] = ZC._i_((self.iXRight/self.oViewport.iWidth)*(iMaxIndex-iMinIndex));
					}
				} else {
					if (oScaleY.bZooming) {
						var fMin = self.bAsync?self.oScaleInfo[oScale.sName]['minvalue']:oScale.fMin_, fMax = self.bAsync?self.oScaleInfo[oScale.sName]['maxvalue']:oScale.fMax_;
						oParams['zoomy'+sScaleIdx] = true;
						oParams['ymin'+sScaleIdx] = fMin + ((self.oViewport.iHeight-self.iYBottom)/self.oViewport.iHeight)*(fMax-fMin);
						oParams['ymax'+sScaleIdx] = fMin + ((self.oViewport.iHeight-self.iYTop)/self.oViewport.iHeight)*(fMax-fMin);
					}
				}
			}
		}
		self.oLoader._api_zoomto_(oParams);
	},
	unbind : function() {
		ZC.ZCQuery('.' + this.oGraph.sId + '-preview-handler').unbind('mousedown touchstart', this.zc_preview_mousedown);
		ZC.ZCQuery('.' + this.oGraph.sId + '-preview-mask').unbind('click', this.zc_preview_mask_click);
	},
	bind : function() {
		var self = this;
		var sId = self.oLoader.sId;
		var iXDiff = 0, iYDiff = 0;

		self.zc_preview_mask_click = function(ev) {
			ev.preventDefault();

			if (!self.oLoader.oZoom) { return; }
			self.oLoader.oZoom.oGraph = self.oGraph;
			self.oLoader.oZoom.parse();

			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
			if (ev.target.id.indexOf('preview-mask-x-left') !== -1 || ev.target.id.indexOf('preview-mask-x-right') !== -1) {
				var iX = aPageXY[0] - oOffset.left - self.oViewport.iX;
				var iWidthActive = self.iXRight - self.iXLeft;
				if (iX - iWidthActive/2 < 0) {
					self.iXLeft = 0;
					self.iXRight = iWidthActive;
				} else if (iX + iWidthActive/2 > self.oViewport.iWidth) {
					self.iXLeft = self.oViewport.iWidth - iWidthActive;
					self.iXRight = self.oViewport.iWidth;
				} else {
					self.iXLeft = ZC._i_(iX - iWidthActive/2);
					self.iXRight = ZC._i_(iX + iWidthActive/2);
				}
			} else {
				var iY = aPageXY[1] - oOffset.top - self.oViewport.iY;
				var iHeightActive = self.iYBottom - self.iYTop;
				if (iY - iHeightActive/2 < 0) {
					self.iYTop = 0;
					self.iYBottom = iHeightActive;
				} else if (iY + iHeightActive/2 > self.oViewport.iHeight) {
					self.iYTop = self.oViewport.iHeight - iHeightActive;
					self.iYBottom = self.oViewport.iHeight;
				} else {
					self.iYTop = ZC._i_(iY - iHeightActive/2);
					self.iYBottom = ZC._i_(iY + iHeightActive/2);
				}
			}
			self.bActive = false;
			self.oGraph.bScrolling = false;
			self.update(self.iXLeft, self.iXRight, self.iYTop, self.iYBottom);
			self.zoom(false);
			return false;
		};

		self.zc_preview_mousedown = function(ev) {
			ev.preventDefault();
			
			if (!self.oLoader.oZoom) { return; }
			self.oLoader.oZoom.oGraph = self.oGraph;
			self.oLoader.oZoom.parse();
			var oTrigger = ev.target;
			while (oTrigger && oTrigger.tagName.toUpperCase() !== 'BODY') {
				var sClass = ZC.ZCHtmlUtils._class_(oTrigger);
				if (sClass.indexOf('zc-preview-handler') !== -1) {
					break;
				}
				oTrigger = oTrigger.parentNode;
			}
			if (!ZC.mobile && ev.which > 1) { return; }
			if (!oTrigger) { return; }
			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
			var iX = aPageXY[0] - oOffset.left - self.oViewport.iX;
			var iY = aPageXY[1] - oOffset.top - self.oViewport.iY;
			if (oTrigger.id.indexOf('handler-x-left') !== -1) {
				self.oHandlerActive = self.oHandlerXLeft;
			} else if (oTrigger.id.indexOf('handler-x-right') !== -1) {
				self.oHandlerActive = self.oHandlerXRight;
			} else if (oTrigger.id.indexOf('handler-y-top') !== -1) {
				self.oHandlerActive = self.oHandlerYTop;
			} else if (oTrigger.id.indexOf('handler-y-bottom') !== -1) {
				self.oHandlerActive = self.oHandlerYBottom;
			} else if (oTrigger.id.indexOf('handler-middle') !== -1) {
				self.oHandlerActive = self.oHandlerMiddle;
				iXDiff = iX - self.iXLeft;
				iYDiff = iY - self.iYTop;
			}
			ZC.ZCQuery(document.body).bind('mousemove touchmove', self.zc_preview_mousemove);
			ZC.ZCQuery(document.body).bind('mouseup touchend', self.zc_preview_mouseup);
			self.bActive = true;
			self.bMove = false;
			return false;
		};
		self.zc_preview_mousemove = function(ev) {
			ev.preventDefault();
			if (self.bActive) {
				self.bMove = true;
				zingchart.exec(self.oLoader.sId, 'setmode', {mode : 'static,fast'});
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
				var iX = aPageXY[0] - oOffset.left - self.oViewport.iX;
				var iY = aPageXY[1] - oOffset.top - self.oViewport.iY;
				if (self.oHandlerActive === self.oHandlerXLeft) {
					self.update(iX, self.iXRight, self.iYTop, self.iYBottom);
				} else if (self.oHandlerActive === self.oHandlerXRight) {
					self.update(self.iXLeft, iX, self.iYTop, self.iYBottom);
				} else if (self.oHandlerActive === self.oHandlerYTop) {
					self.update(self.iXLeft, self.iXRight, iY, self.iYBottom);
				} else if (self.oHandlerActive === self.oHandlerYBottom) {
					self.update(self.iXLeft, self.iXRight, self.iYTop, iY);
				} else if (self.oHandlerActive === self.oHandlerMiddle) {
					self.update(iX - iXDiff, iX - iXDiff + ZC.ZCQuery(self.oHandlerMiddle).width(), iY - iYDiff, iY - iYDiff + ZC.ZCQuery(self.oHandlerMiddle).height());
				}
			}
			return false;
		};
		self.zc_preview_mouseup = function() {
			
			zingchart.exec(self.oLoader.sId, 'setmode', {mode : ''});
			if (self.bActive) {
				ZC.ZCQuery(document.body).unbind('mousemove touchmove', self.zc_preview_mousemove);
				ZC.ZCQuery(document.body).unbind('mouseup touchend', self.zc_preview_mouseup);
				self.bActive = false;
				self.oGraph.bScrolling = false;
				if (self.bMove) {
					self.zoom(false);
				}
				self.bMove = false;
			}
			return false;
		};
		ZC.ZCQuery('.' + self.oGraph.sId + '-preview-handler').bind('mousedown touchstart', self.zc_preview_mousedown);
		ZC.ZCQuery('.' + self.oGraph.sId + '-preview-mask').bind('click', self.zc_preview_mask_click);
	}
});












ZC.ZCScroll = ZC.ZCStyle.extend({
	init : function(oParent, sType) {
		var self = this;
		self._super(oParent);
		self.oGraph = oParent;
		self.oLoader = oParent.oParent;
		self.bActive = false;
		self.oCanvas = null;
		self.sFlags = '';
		self.bYX = (self.oGraph.oSettings['layout'] === 'yx');
		self.sType = self.sTypeE = self.sTypeN = 'scroll-' + (sType || 'x');
		if (self.bYX) {
			self.sType += 'i';
			self.sTypeE = (self.sType === 'scroll-xi')?'scroll-y':'scroll-x';
		}
	},
	parse : function() {
		var self = this, mValue;

		self.sId = self.oGraph.sId + '-' + self.sTypeE;

		
		var sGTP = '(' + self.oGraph.sType + ').';
		var oDef = self.oLoader.oDefaults;

		self.oBarStyle = new ZC.ZCBox(self.oGraph);
		oDef.load(self.oBarStyle.oData, [
			sGTP + 'scroll.bar',
			sGTP + self.sType + '.bar'
		]);
		if (ZC._n_(mValue=self.oData['bar']) !== null) {
			self.oBarStyle.append(mValue);
		}
		self.oBarStyle.parse();

		self.oHandleStyle = new ZC.ZCBox(self.oGraph);
		oDef.load(self.oHandleStyle.oData, [
			sGTP + 'scroll.handle',
			sGTP + self.sType + '.handle'
		]);
		if (ZC._n_(mValue=self.oData['handle']) !== null) {
			self.oHandleStyle.append(mValue);
		}
		self.oHandleStyle.parse();
	},
	paint : function() {
		var self = this;

		var oScaleX = self.oGraph.getScales('k')[0], oScaleY = self.oGraph.getScales('v')[0], oPlotArea = self.oGraph.oPlotArea;
		
		if (
			((self.sType === 'scroll-x' || self.sType === 'scroll-xi') && oScaleX.iMinIndex_ === oScaleX.iMinIndex && oScaleX.iMaxIndex_ === oScaleX.iMaxIndex)
			||
			((self.sType === 'scroll-y' || self.sType === 'scroll-yi') && oScaleY.fMin_ === oScaleY.fMin && oScaleY.fMax_ === oScaleY.fMax)
		) {
			
			self.unbind();
			ZC.ZCQuery('#' + self.oGraph.sId + '-' + self.sType + '-handle').remove();
			ZC.ZCQuery('#' + self.oGraph.sId + '-' + self.sType + '-bar').remove();
			return;
		}

		if (self.bActive) {
			return;
		}

		self.oCanvas = ZC._id_(self.oGraph.sId + '-' + self.sTypeN + '-c');
		var oMain = ZC._id_(self.oLoader.sId + '-top');

		if (self.sType === 'scroll-x' || self.sType === 'scroll-yi') {
			self.oBarStyle.iX = oPlotArea.iX;
			self.oBarStyle.iY = oPlotArea.iY+oPlotArea.iHeight+oScaleX.iLineWidth+self.oBarStyle.iOffsetY-1;
			self.oBarStyle.iWidth = oPlotArea.iWidth;

			if (self.bYX) {

				self.oHandleStyle.iWidth = ZC._i_(ZC._max_(4, self.oBarStyle.iWidth*((oScaleY.fMax-oScaleY.fMin)/(oScaleY.fMax_-oScaleY.fMin_))));
				if (oScaleY.fMin_ === oScaleY.fMin) {
					self.oHandleStyle.iX = self.oBarStyle.iX;
				} else if (oScaleY.fMax_ === oScaleY.fMax) {
					self.oHandleStyle.iX = self.oBarStyle.iX + self.oBarStyle.iWidth - self.oHandleStyle.iWidth;
				} else {
					self.oHandleStyle.iX = ZC._i_(self.oBarStyle.iX + (self.oBarStyle.iWidth)*(oScaleY.fMin-oScaleY.fMin_)/(oScaleY.fMax_-oScaleY.fMin_));
				}

			} else {
				self.oHandleStyle.iWidth = ZC._i_(ZC._max_(4, self.oBarStyle.iWidth*((oScaleX.iMaxIndex-oScaleX.iMinIndex)/(oScaleX.iMaxIndex_-oScaleX.iMinIndex_))));
				if (oScaleX.iMinIndex_ === oScaleX.iMinIndex) {
					self.oHandleStyle.iX = self.oBarStyle.iX;
				} else if (oScaleX.iMaxIndex_ === oScaleX.iMaxIndex) {
					self.oHandleStyle.iX = self.oBarStyle.iX + self.oBarStyle.iWidth - self.oHandleStyle.iWidth;
				} else {
					self.oHandleStyle.iX = ZC._i_(self.oBarStyle.iX + (self.oBarStyle.iWidth)*(oScaleX.iMinIndex-oScaleX.iMinIndex_)/(oScaleX.iMaxIndex_-oScaleX.iMinIndex_));
				}
			}

			if (ZC._id_(self.sId + '-handle')) {
				ZC.ZCQuery('#' + self.sId + '-handle')
					.css('left', self.oHandleStyle.iX + 'px')
					.css('width', ZC._max_(1, self.oHandleStyle.iWidth - 2*self.oHandleStyle.iBorderWidth) + 'px');
				self.paint_();
			} else {

				self.oScrollXBar = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-x-bar ' + self.oGraph.sId + '-scroll-x-bar',
					id : self.sId + '-bar',
					wh : self.oBarStyle.iWidth + '/' + self.oBarStyle.iHeight,
					tl : self.oBarStyle.iY + '/' + self.oBarStyle.iX,
					opacity : 0,
					p : oMain
				});

				self.oScrollXHandle = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-x-handle ' + self.oGraph.sId + '-scroll-x-handle',
					id : self.sId + '-handle',
					wh : ZC._max_(1, self.oHandleStyle.iWidth - 2*self.oHandleStyle.iBorderWidth) + '/' + (self.oBarStyle.iHeight - 2*self.oHandleStyle.iBorderWidth),
					tl : self.oBarStyle.iY + '/' + self.oHandleStyle.iX,
					background : '#fff',
					opacity : 0,
					p : oMain
				});
				self.oScrollXHandle.style.cursor = 'pointer';
				self.paint_();
				self.bind();
			}
		} else {
			self.oBarStyle.iX = oPlotArea.iX-self.oBarStyle.iWidth-1;
			self.oBarStyle.iY = oPlotArea.iY;
			self.oBarStyle.iHeight = oPlotArea.iHeight;

			if (self.bYX) {
				self.oHandleStyle.iHeight = ZC._i_(ZC._max_(4, self.oBarStyle.iHeight*((oScaleX.iMaxIndex-oScaleX.iMinIndex)/(oScaleX.iMaxIndex_-oScaleX.iMinIndex_))));
				if (oScaleX.iMinIndex_ === oScaleX.iMinIndex) {
					self.oHandleStyle.iY = self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight;
				} else if (oScaleX.iMaxIndex_ === oScaleX.iMaxIndex) {
					self.oHandleStyle.iY = self.oBarStyle.iY;
				} else {
					self.oHandleStyle.iY = ZC._i_(self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight - (self.oBarStyle.iHeight)*(oScaleX.iMinIndex-oScaleX.iMinIndex_)/(oScaleX.iMaxIndex_-oScaleX.iMinIndex_));
				}
			} else {
				self.oHandleStyle.iHeight = ZC._i_(ZC._max_(4, self.oBarStyle.iHeight*((oScaleY.fMax-oScaleY.fMin)/(oScaleY.fMax_-oScaleY.fMin_))));
				if (oScaleY.fMin_ === oScaleY.fMin) {
					self.oHandleStyle.iY = self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight;
				} else if (oScaleY.fMax_ === oScaleY.fMax) {
					self.oHandleStyle.iY = self.oBarStyle.iY;
				} else {
					self.oHandleStyle.iY = ZC._i_(self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight - (self.oBarStyle.iHeight)*(oScaleY.fMin-oScaleY.fMin_)/(oScaleY.fMax_-oScaleY.fMin_));
				}
			}

			if (ZC._id_(self.sId + '-handle')) {
				ZC.ZCQuery('#' + self.sId + '-handle')
					.css('top', self.oHandleStyle.iY + 'px')
					.css('height', ZC._max_(1, self.oHandleStyle.iHeight - 2*self.oHandleStyle.iBorderWidth) + 'px');
				self.paint_();
			} else {
				self.oScrollYBar = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-y-bar ' + self.oGraph.sId + '-scroll-y-bar',
					id : self.sId + '-bar',
					wh : self.oBarStyle.iWidth + '/' + self.oBarStyle.iHeight,
					tl : self.oBarStyle.iY + '/' + self.oBarStyle.iX,
					opacity : 0,
					p : oMain
				});
				self.oScrollYHandle = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-y-handle ' + self.oGraph.sId + '-scroll-y-handle',
					id : self.sId + '-handle',
					wh : (self.oBarStyle.iWidth - 2*self.oHandleStyle.iBorderWidth) + '/' + ZC._max_(1, self.oHandleStyle.iHeight - 2*self.oHandleStyle.iBorderWidth),
					tl : self.oHandleStyle.iY + '/' + self.oBarStyle.iX,
					background : '#fff',
					opacity : 0,
					p : oMain
				});
				self.oScrollYHandle.style.cursor = 'pointer';
				self.paint_();
				self.bind();
			}
		}

	},
	zoom : function(bZooming) {
		var self = this;

		
		var oParams = {
			graphid : self.oGraph.sId,
			zooming : bZooming,
			scroll : true
		};
		var aScales = self.oGraph.aScales, oScale;
		var oScaleX = self.oGraph.getScales('k')[0], oScaleY = self.oGraph.getScales('v')[0];
		for (var i=0,iLen=aScales.length;i<iLen;i++) {
			if ((oScale=aScales[i])) {
				var sScaleIdx = (oScale.iIndex===1)?'':('-'+oScale.iIndex);

				if (oScaleX.bZooming && self.sType === 'scroll-x' && oScale.sType === 'k' && !self.bYX) {
					oParams['zoomx'+sScaleIdx] = true;
					oParams['xmin'+sScaleIdx] = oScale.iMinIndex_ + ZC._i_(((self.oHandleStyle.iX-self.oBarStyle.iX)/self.oBarStyle.iWidth)*(oScale.iMaxIndex_-oScale.iMinIndex_));
					oParams['xmax'+sScaleIdx] = oScale.iMinIndex_ + ZC._i_(((self.oHandleStyle.iX-self.oBarStyle.iX+self.oHandleStyle.iWidth)/self.oBarStyle.iWidth)*(oScale.iMaxIndex_-oScale.iMinIndex_));
				} else if (oScaleY.bZooming && self.sType === 'scroll-y' && oScale.sType === 'v' && !self.bYX) {
					oParams['zoomy'+sScaleIdx] = true;
					oParams['ymin'+sScaleIdx] = oScale.fMin_ + ZC._f_(((self.oBarStyle.iHeight-self.oHandleStyle.iY+self.oBarStyle.iY-self.oHandleStyle.iHeight)/self.oBarStyle.iHeight)*(oScale.fMax_-oScale.fMin_));
					oParams['ymax'+sScaleIdx] = oScale.fMin_ + ZC._f_(((self.oBarStyle.iHeight-self.oHandleStyle.iY+self.oBarStyle.iY)/self.oBarStyle.iHeight)*(oScale.fMax_-oScale.fMin_));
				} else if (oScaleX.bZooming && self.sType === 'scroll-xi' && oScale.sType === 'k' && self.bYX) {
					oParams['zoomx'+sScaleIdx] = true;
					oParams['xmin'+sScaleIdx] = oScale.iMinIndex_ + ZC._i_(((self.oBarStyle.iHeight-self.oHandleStyle.iY+self.oBarStyle.iY-self.oHandleStyle.iHeight)/self.oBarStyle.iHeight)*(oScale.iMaxIndex_-oScale.iMinIndex_));
					oParams['xmax'+sScaleIdx] = oScale.iMinIndex_ + ZC._i_(((self.oBarStyle.iHeight-self.oHandleStyle.iY+self.oBarStyle.iY)/self.oBarStyle.iHeight)*(oScale.iMaxIndex_-oScale.iMinIndex_));
				} else if (oScaleY.bZooming && self.sType === 'scroll-yi' && oScale.sType === 'v' && self.bYX) {
					oParams['zoomy'+sScaleIdx] = true;
					oParams['ymin'+sScaleIdx] = oScale.fMin_ + ZC._f_(((self.oHandleStyle.iX-self.oBarStyle.iX)/self.oBarStyle.iWidth)*(oScale.fMax_-oScale.fMin_));
					oParams['ymax'+sScaleIdx] = oScale.fMin_ + ZC._f_(((self.oHandleStyle.iX-self.oBarStyle.iX+self.oHandleStyle.iWidth)/self.oBarStyle.iWidth)*(oScale.fMax_-oScale.fMin_));
				}
			}
		}
		self.oLoader._api_zoomto_(oParams);
	},
	paint_ : function() {
		var self = this, oBar, oHandle;
		ZC.ZCHtmlUtils._clear_(self.oCanvas, self.oLoader.sOutput, self.oGraph.iX, self.oGraph.iY, self.oGraph.iWidth, self.oGraph.iHeight);
		if (self.sType === 'scroll-x' || self.sType === 'scroll-yi') {
			oBar = new ZC.ZCBox(self);
			oBar.sId = self.oGraph.sId + '-scroll-x-bar';
			oBar.copy(self.oBarStyle);
			oBar.oCanvas = self.oCanvas;
			oBar.iX = self.oBarStyle.iX;
			oBar.iY = self.oBarStyle.iY;
			oBar.iWidth = self.oBarStyle.iWidth;
			oBar.iHeight = self.oBarStyle.iHeight;
			oBar.paint();

			oHandle = new ZC.ZCBox(self);
			oHandle.sId = self.oGraph.sId + '-scroll-x-handle';
			oHandle.copy(self.oHandleStyle);
			oHandle.oCanvas = self.oCanvas;
			oHandle.iX = self.oHandleStyle.iX;
			oHandle.iY = self.oBarStyle.iY;
			oHandle.iWidth = self.oHandleStyle.iWidth;
			oHandle.iHeight = self.oBarStyle.iHeight;
			oHandle.paint();
		} else {
			oBar = new ZC.ZCBox(self);
			oBar.sId = self.oGraph.sId + '-scroll-y-bar';
			oBar.copy(self.oBarStyle);
			oBar.oCanvas = self.oCanvas;
			oBar.iX = self.oBarStyle.iX;
			oBar.iY = self.oBarStyle.iY;
			oBar.iWidth = self.oBarStyle.iWidth;
			oBar.iHeight = self.oBarStyle.iHeight;
			oBar.paint();

			oHandle = new ZC.ZCBox(self);
			oHandle.sId = self.oGraph.sId + '-scroll-y-handle';
			oHandle.copy(self.oHandleStyle);
			oHandle.oCanvas = self.oCanvas;
			oHandle.iX = self.oBarStyle.iX;
			oHandle.iY = self.oHandleStyle.iY;
			oHandle.iWidth = self.oBarStyle.iWidth;
			oHandle.iHeight = self.oHandleStyle.iHeight;
			oHandle.paint();
		}
	},
	update : function(iCoord) {
		var self = this;
		if (self.sType === 'scroll-x' || self.sType === 'scroll-yi') {
			self.oHandleStyle.iX = iCoord;
			ZC.ZCQuery('#' + self.sId + '-handle').css('left', iCoord + 'px');
			self.paint_();
		} else {
			self.oHandleStyle.iY = iCoord;
			ZC.ZCQuery('#' + self.sId + '-handle').css('top', iCoord + 'px');
			self.paint_();
		}
		if (self.bActive) {
			self.oGraph.bScrolling = true;
			self.zoom(true);
		}
	},
	unbind : function() {
		var self = this;
		ZC.ZCQuery('.' + self.oGraph.sId + '-' + self.sType + '-handle').unbind('mousedown touchstart', self.zc_scroll_mousedown);
		ZC.ZCQuery('.' + self.oGraph.sId + '-' + self.sType + '-bar').unbind('click', self.zc_scroll_bar_click);
	},
	overscroll : function(sType) {
		var self = this;
		var oParams = self.oGraph._api_graph_info_();
		oParams['type'] = sType;
		ZC.ZCUtils._trigger_event_('overscroll', self.oLoader, oParams);
	},
	bind : function() {
		var self = this;
		var sId = self.oLoader.sId;
		var iXDiff = 0, iYDiff = 0;

		self.zc_scroll_mousedown = function(ev) {
			ev.preventDefault();
			if (ev.button > 1) {
				return;
			}
			
			self.sFlags = self.oLoader.aFlags.join(',');
			self.oLoader.aFlags.push('skip_context_menu','skip_objects_tracking','skip_segment_tracking','skip_marker_tracking','skip_interactivity');
			if (!self.oLoader.oZoom) { return; }
			self.oLoader.oZoom.oGraph = self.oGraph;
			self.oLoader.oZoom.parse();
			var oTrigger = ev.target;
			while (oTrigger && oTrigger.tagName.toUpperCase() !== 'BODY') {
				var sClass = ZC.ZCHtmlUtils._class_(oTrigger);
				if (sClass.indexOf('zc-' + self.sType + '-handle') !== -1) {
					break;
				}
				oTrigger = oTrigger.parentNode;
			}
			if (!ZC.mobile && ev.which > 1) { return; }
			if (!oTrigger) { return; }
			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();

			if (self.sType === 'scroll-x' || self.sType === 'scroll-yi') {
				var iX = aPageXY[0] - oOffset.left;
				iXDiff = iX - self.oHandleStyle.iX;
			} else {
				var iY = aPageXY[1] - oOffset.top;
				iYDiff = iY - self.oHandleStyle.iY;
			}
			ZC.ZCQuery(document.body).bind('mousemove touchmove', self.zc_scroll_mousemove);
			ZC.ZCQuery(document.body).bind('mouseup touchend', self.zc_scroll_mouseup);
			self.bActive = true;
			return false;
		};
		self.zc_scroll_mousemove = function(ev) {
			ev.preventDefault();
			if (self.bActive) {
				self.oGraph.bScrolling = false;
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
				if (self.sType === 'scroll-x' || self.sType === 'scroll-yi') {
					var iX = aPageXY[0] - oOffset.left;
					if (iX - iXDiff < self.oBarStyle.iX) {
						if (iX < self.oBarStyle.iX - 15) {
							self.overscroll('scroll-x-left');
						}
						iX = self.oBarStyle.iX + iXDiff;
					}
					if (iX - iXDiff + self.oHandleStyle.iWidth > self.oBarStyle.iX + self.oBarStyle.iWidth) {
						if (iX > self.oBarStyle.iX + self.oBarStyle.iWidth + 15) {
							self.overscroll('scroll-x-right');
						}
						iX = self.oBarStyle.iX + self.oBarStyle.iWidth + iXDiff - self.oHandleStyle.iWidth;
					}
					self.update(iX - iXDiff);
				} else {
					var iY = aPageXY[1] - oOffset.top;
					if (iY - iYDiff < self.oBarStyle.iY) {
						if (iY < self.oBarStyle.iY - 15) {
							self.overscroll('scroll-y-top');
						}
						iY = self.oBarStyle.iY + iYDiff;
					}
					if (iY - iYDiff + self.oHandleStyle.iHeight > self.oBarStyle.iY + self.oBarStyle.iHeight) {
						if (iY > self.oBarStyle.iY + self.oBarStyle.iHeight + 15) {
							self.overscroll('scroll-y-bottom');
						}
						iY = self.oBarStyle.iY + self.oBarStyle.iHeight + iYDiff - self.oHandleStyle.iHeight;
					}
					self.update(iY - iYDiff);
				}
			}
			return false;
		};
		self.zc_scroll_mouseup = function(ev) {
			
			self.oLoader.aFlags = self.sFlags.split(',');
			if (self.bActive) {
				ZC.ZCQuery(document.body).unbind('mousemove touchmove', self.zc_scroll_mousemove);
				ZC.ZCQuery(document.body).unbind('mouseup touchend', self.zc_scroll_mouseup);
				self.bActive = false;
				self.oGraph.bScrolling = false;
				if (ev) {
					self.zoom(false);
				}
			}
			return false;
		};
		self.zc_scroll_bar_click = function(ev) {
			self.bActive = false;
			self.oGraph.bScrolling = false;
			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
			if (self.sType === 'scroll-x' || self.sType === 'scroll-yi') {
				if (aPageXY[0] - oOffset.left > self.oHandleStyle.iX) {
					self.update(ZC._min_(self.oBarStyle.iX + self.oBarStyle.iWidth - self.oHandleStyle.iWidth - 2*self.oHandleStyle.iBorderWidth, self.oHandleStyle.iX + (aPageXY[0] - oOffset.left - self.oHandleStyle.iX)/4));
				} else {
					self.update(ZC._max_(self.oBarStyle.iX, aPageXY[0] - oOffset.left + (self.oHandleStyle.iX - aPageXY[0] + oOffset.left - self.oHandleStyle.iWidth)/4));
				}
			} else {
				if (aPageXY[1] - oOffset.top > self.oHandleStyle.iY) {
					self.update(ZC._min_(self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight - 2*self.oHandleStyle.iBorderWidth, self.oHandleStyle.iY + (aPageXY[1] - oOffset.top - self.oHandleStyle.iY)/4));
				} else {
					self.update(ZC._max_(self.oBarStyle.iY, aPageXY[1] - oOffset.top + (self.oHandleStyle.iY - aPageXY[1] + oOffset.top - self.oHandleStyle.iHeight)/4));
				}
			}
			self.zoom(false);
		};
		ZC.ZCQuery('.' + self.oGraph.sId + '-' + self.sTypeE + '-handle').bind('mousedown touchstart', self.zc_scroll_mousedown);
		ZC.ZCQuery('.' + self.oGraph.sId + '-' + self.sTypeE + '-bar').bind('click', self.zc_scroll_bar_click);
	}
});











ZC.ZCLegendScroll = ZC.ZCStyle.extend({
	init : function(oLegend, sType) {
		var self = this;
		self._super(oLegend);
		self.oLegend = oLegend;
		self.bActive = false;
		self.oCanvas = null;
		self.sFlags = '';
		self.iRows = 1;
		self.iCols = 1;
		self.sType = 'scroll-' + (sType || 'y');
	},
	parse : function() {
		var self = this, mValue;
		self.sId = self.oLegend.sId + '-legend-' + self.sType;

		var oDef = self.oLegend.oParent.oLoader.oDefaults;
		var sGraphType_ = '(' + self.oLegend.oParent.sType + ')';
		
		self.oBarStyle = new ZC.ZCBox(self.oLegend);
		oDef.load(self.oBarStyle.oData, [
			sGraphType_ + '.legend.scroll.bar',
			self.sType + '.bar'
		]);
		if (ZC._n_(mValue=self.oData['bar']) !== null) {
			self.oBarStyle.append(mValue);
		}
		self.oBarStyle.parse();
		
		self.oHandleStyle = new ZC.ZCBox(self.oLegend);
		oDef.load(self.oHandleStyle.oData, [
			sGraphType_ + '.legend.scroll.handle',
			self.sType + '.handle'
		]);
		if (ZC._n_(mValue=self.oData['handle']) !== null) {
			self.oHandleStyle.append(mValue);
		}
		self.oHandleStyle.parse();
	},
	paint : function() {
		var self = this;
		var iTicks;
		
		if (self.bActive) {
			return;
		}

		self.oCanvas = ZC._id_(self.oLegend.oParent.sId + '-legend-scroll-c');
		var oMain = ZC._id_(self.oLoader.sId + '-top');

		if (self.sType === 'scroll-y') {
			self.oBarStyle.iX = self.oLegend.iX + self.oLegend.iWidth-self.oBarStyle.iWidth-1;
			self.oBarStyle.iY = self.oLegend.iY_;
			self.oBarStyle.iHeight = self.oLegend.iHeight - (self.oLegend.oFooter?self.oLegend.oFooter.iHeight:0) - (self.oLegend.iY_ - self.oLegend.iY);

		    iTicks = Math.ceil(self.oLegend.aItems.length/self.iCols - self.oLegend.iMaxItems/self.iCols) + 1;
			
			self.oHandleStyle.iHeight = self.oBarStyle.iHeight/iTicks;
			self.oHandleStyle.iY = self.oBarStyle.iY;
			if (self.oLegend.oPageInfo.min !== 0){
				self.oHandleStyle.iY += self.oLegend.oPageInfo.min/self.iCols * self.oHandleStyle.iHeight;				
			}
			
			if (ZC._id_(self.sId + '-legend-handle')) {
				ZC.ZCQuery('#' + self.sId + '-legend-handle').css('top', self.oHandleStyle.iY + 'px').css('height', (self.oHandleStyle.iHeight - 2*self.oHandleStyle.iBorderWidth) + 'px');
				self.paint_();
			} else {
				self.oScrollYBar = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-y-bar ' + self.oLegend.sId + '-scroll-y-legend-bar',
					id : self.sId + '-legend-bar',
					wh : self.oBarStyle.iWidth + '/' + self.oBarStyle.iHeight,
					tl : self.oBarStyle.iY + '/' + self.oBarStyle.iX,
					opacity : 0,
					zidx: 1,
					p : oMain
				});
				self.oScrollYHandle = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-y-handle ' + self.oLegend.sId + '-scroll-y-legend-handle',
					id : self.sId + '-legend-handle',
					wh : (self.oBarStyle.iWidth - 2*self.oHandleStyle.iBorderWidth) + '/' + (self.oHandleStyle.iHeight - 2*self.oHandleStyle.iBorderWidth),
					tl : self.oHandleStyle.iY + '/' + self.oBarStyle.iX,
					background : '#fff',
					opacity : 0,
					zidx: 1,
					p : oMain
				});
				self.oScrollYHandle.style.cursor = 'pointer';
				self.paint_();
				self.bind();
			}
		}
		else if (self.sType === 'scroll-x') {
			self.oBarStyle.iX = self.oLegend.iX;
			self.oBarStyle.iY = self.oLegend.iY+self.oLegend.iHeight-self.oBarStyle.iHeight-1;
			self.oBarStyle.iWidth = self.oLegend.iWidth;

			iTicks = Math.ceil(self.oLegend.aItems.length/self.iRows - self.oLegend.iMaxItems/self.iRows) + 1;
			self.oHandleStyle.iWidth = self.oBarStyle.iWidth/iTicks;
			self.oHandleStyle.iX = self.oBarStyle.iX;
			
			if (self.oLegend.oPageInfo.min !== 0){
				self.oHandleStyle.iX += self.oLegend.oPageInfo.min/self.iRows * self.oHandleStyle.iWidth;				
			}

			if (ZC._id_(self.sId + '-legend-handle')) {
				ZC.ZCQuery('#' + self.sId + '-legend-handle').css('left', self.oHandleStyle.iX + 'px').css('width', (self.oHandleStyle.iWidth - 2*self.oHandleStyle.iBorderWidth) + 'px');
				self.paint_();
			}
			else {

				self.oScrollXBar = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-x-bar ' + self.oLegend.sId + '-scroll-x-legend-bar',
					id : self.sId + '-legend-bar',
					wh : self.oBarStyle.iWidth + '/' + self.oBarStyle.iHeight,
					tl : self.oBarStyle.iY + '/' + self.oBarStyle.iX,
					opacity : 0,
					zidx: 1,
					p : oMain
				});

				self.oScrollXHandle = ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-scroll zc-scroll-x-handle ' + self.oLegend.sId + '-scroll-x-legend-handle',
					id : self.sId + '-legend-handle',
					wh : (self.oHandleStyle.iWidth - 2*self.oHandleStyle.iBorderWidth) + '/' + (self.oBarStyle.iHeight - 2*self.oHandleStyle.iBorderWidth),
					tl : self.oBarStyle.iY + '/' + self.oHandleStyle.iX,
					background : '#fff',
					opacity : 0,
					zidx: 1,
					p : oMain
				});
				self.oScrollXHandle.style.cursor = 'pointer';
				self.paint_();
				self.bind();
		    }
		}
	},
	
	paint_ : function() {
		var self = this, oBar, oHandle;
		ZC.ZCHtmlUtils._clear_(self.oCanvas, self.oLoader.sOutput, self.oLegend.iX, self.oLegend.iY, self.oLegend.iWidth, self.oLegend.iHeight);
		if (self.sType === 'scroll-y') {
			oBar = new ZC.ZCBox(self);
			oBar.sId = self.oLegend.sId + '-scroll-y-legend-bar';
			oBar.copy(self.oBarStyle);
			oBar.oCanvas = self.oCanvas;
			oBar.iX = self.oBarStyle.iX;
			oBar.iY = self.oBarStyle.iY;
			oBar.iWidth = self.oBarStyle.iWidth;
			oBar.iHeight = self.oBarStyle.iHeight;
			oBar.paint();
			
			oHandle = new ZC.ZCBox(self);
			oBar.className = 'cstest';
			oHandle.sId = self.oLegend.sId + '-scroll-y-legend-handle';
			oHandle.copy(self.oHandleStyle);
			oHandle.oCanvas = self.oCanvas;
			oHandle.iX = self.oBarStyle.iX;
			oHandle.iY = self.oHandleStyle.iY;
			oHandle.iWidth = self.oBarStyle.iWidth;
			oHandle.iHeight = self.oHandleStyle.iHeight;
			oHandle.paint();
		}
		else if (self.sType === 'scroll-x') {
			oBar = new ZC.ZCBox(self);
			oBar.sId = self.oLegend.sId + '-scroll-x-legend-bar';
			oBar.copy(self.oBarStyle);
			oBar.oCanvas = self.oCanvas;
			oBar.iX = self.oBarStyle.iX;
			oBar.iY = self.oBarStyle.iY;
			oBar.iWidth = self.oBarStyle.iWidth;
			oBar.iHeight = self.oBarStyle.iHeight;
			oBar.paint();

			
			oHandle = new ZC.ZCBox(self);
			oHandle.sId = self.oLegend.sId + '-scroll-x-legend-handle';
			oHandle.copy(self.oHandleStyle);
			oHandle.oCanvas = self.oCanvas;
			oHandle.iX = self.oHandleStyle.iX;
			oHandle.iY = self.oBarStyle.iY;
			oHandle.iWidth = self.oHandleStyle.iWidth;
			oHandle.iHeight = self.oBarStyle.iHeight;
			oHandle.paint();
		}
	},
	update : function(iCoord) {
		var self = this;
		var oLegend = self.oLegend;
		var fRel, fOptions, iCurrentPos, iTicks, iLastSpot, iFactor;
		var bForward = true;
		if (self.sType === 'scroll-y') {
		    if (iCoord < self.oHandleStyle.iY){
			    bForward = false;
			}
			if (iCoord === self.oHandleStyle.iY){
				return;
			}
			self.oHandleStyle.iY = iCoord;
			ZC.ZCQuery('#' + self.sId + '-legend-handle').css('top', iCoord + 'px');
			
			fRel = self.oHandleStyle.iY - self.oBarStyle.iY;
			iTicks = Math.ceil(oLegend.aItems.length/self.iCols - oLegend.iMaxItems/self.iCols) + 1;
			fOptions = self.oBarStyle.iHeight/iTicks;
			iFactor = self.iCols;
		}
		else if (self.sType === 'scroll-x') {
		    if (iCoord > self.oHandleStyle.iX){
			    bForward = false;
			}
			if (iCoord === self.oHandleStyle.iX){
				return;
			}
			self.oHandleStyle.iX = iCoord;
			ZC.ZCQuery('#' + self.sId + '-legend-handle').css('left', iCoord + 'px');
			
			fRel = self.oHandleStyle.iX - self.oBarStyle.iX;
			iTicks = Math.ceil(oLegend.aItems.length/self.iRows - oLegend.iMaxItems/self.iRows) + 1;
			fOptions = self.oBarStyle.iWidth/iTicks;
			iFactor = self.iRows;
		}
		
		iCurrentPos = Math.round(fRel/fOptions);
		iLastSpot = oLegend.aItems.length - oLegend.iMaxItems;
		if (oLegend.aItems.length % iFactor){
		    iLastSpot = iLastSpot + (iFactor - (oLegend.aItems.length % iFactor))
		}
		oLegend.oPageInfo.min = Math.min((iCurrentPos * iFactor), iLastSpot);
		oLegend.oPageInfo.max = oLegend.oPageInfo.min + oLegend.iMaxItems;
		
		oLegend.saveInfo();
		oLegend.clear(false);
		oLegend.parse();
		oLegend.paint();
		self.paint_();
		
	},
	unbind : function() {
		var self = this;
		ZC.ZCQuery('.' + self.oLegend.sId + '-' + self.sType + '-handle').unbind('mousedown touchstart', self.zc_scroll_mousedown);
		ZC.ZCQuery('.' + self.oLegend.sId + '-' + self.sType + '-bar').unbind('click', self.zc_scroll_bar_click);
	},
	bind : function() {
		var self = this;
		var sId = self.oLoader.sId;
		var iXDiff = 0, iYDiff = 0;
		self.zc_scroll_mousedown = function(ev) {
			ev.preventDefault();
			if (ev.button > 1) {
				return;
			}
			var oTrigger = ev.target;
			
			while (oTrigger && oTrigger.tagName.toUpperCase() !== 'BODY') {
				var sClass = ZC.ZCHtmlUtils._class_(oTrigger);
				if (sClass.indexOf('zc-' + self.sType + '-handle') !== -1) {
					break;
				}
				oTrigger = oTrigger.parentNode;
			}
			
			if (!ZC.mobile && ev.which > 1) { return; }
			if (!oTrigger) { return; }
			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();

			if (self.sType === 'scroll-y') {
				var iY = aPageXY[1] - oOffset.top;
				iYDiff = iY - self.oHandleStyle.iY;
			}
			else if (self.sType === 'scroll-x') {
				var iX = aPageXY[0] - oOffset.left;
				iXDiff = iX - self.oHandleStyle.iX;
			}
			
			ZC.ZCQuery(document.body).bind('mousemove touchmove', self.zc_scroll_mousemove);
			ZC.ZCQuery(document.body).bind('mouseup touchend', self.zc_scroll_mouseup);
			self.bActive = true;
			return false;
		};
		self.zc_scroll_mousemove = function(ev) {
			ev.preventDefault();
			if (self.bActive) {
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
				if (self.sType === 'scroll-y') {
					var iY = aPageXY[1] - oOffset.top;
					if (iY - iYDiff < self.oBarStyle.iY) {
						iY = self.oBarStyle.iY + iYDiff;	
					}
					if (iY - iYDiff + self.oHandleStyle.iHeight > self.oBarStyle.iY + self.oBarStyle.iHeight) {
						iY = self.oBarStyle.iY + self.oBarStyle.iHeight + iYDiff - self.oHandleStyle.iHeight;
					}
					self.update(iY - iYDiff);
				}
				else if (self.sType === 'scroll-x') {
					var iX = aPageXY[0] - oOffset.left;
					if (iX - iXDiff < self.oBarStyle.iX) {
						iX = self.oBarStyle.iX + iXDiff;
					}
					if (iX - iXDiff + self.oHandleStyle.iWidth > self.oBarStyle.iX + self.oBarStyle.iWidth) {
						iX = self.oBarStyle.iX + self.oBarStyle.iWidth + iXDiff - self.oHandleStyle.iWidth;
					}
					self.update(iX - iXDiff);
				}
			}
			return false;
		};
		
		self.zc_scroll_mouseup = function(ev) {
			
			self.oLoader.aFlags = self.sFlags.split(',');
			if (self.bActive) {
				ZC.ZCQuery(document.body).unbind('mousemove touchmove', self.zc_scroll_mousemove);
				ZC.ZCQuery(document.body).unbind('mouseup touchend', self.zc_scroll_mouseup);
				self.bActive = false;
			}
			return false;
		};
		
		self.zc_scroll_bar_scroll = function(ev){
			var iDelta=(ev.detail ? ev.detail * (-120) : ev.wheelDelta)/120;
			
			if (iDelta > 0){
				self.update(ZC._max_(self.oBarStyle.iY, self.oHandleStyle.iY - self.oHandleStyle.iHeight));
			}
			
			else{
				self.update(ZC._min_(self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight, self.oHandleStyle.iY + self.oHandleStyle.iHeight));
			}
		};
		
		self.zc_scroll_bar_click = function(ev) {
			self.bActive = true;
			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
			var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
			if (self.sType === 'scroll-y') {
				if (aPageXY[1] - oOffset.top > self.oHandleStyle.iY) {
					self.update(ZC._min_(self.oBarStyle.iY + self.oBarStyle.iHeight - self.oHandleStyle.iHeight, self.oHandleStyle.iY + self.oHandleStyle.iHeight));
				} else {
					self.update(ZC._max_(self.oBarStyle.iY, self.oHandleStyle.iY - self.oHandleStyle.iHeight));
				}
			}
			else if (self.sType === 'scroll-x') {
				if (aPageXY[0] - oOffset.left > self.oHandleStyle.iX) {
				    self.update(ZC._min_(self.oBarStyle.iX + self.oBarStyle.iWidth - self.oHandleStyle.iWidth, self.oHandleStyle.iX + self.oHandleStyle.iWidth));
				} else {
					self.update(ZC._max_(self.oBarStyle.iX, self.oHandleStyle.iX - self.oHandleStyle.iWidth));
				}
			}
			
			self.bActive = false;
		};
		ZC.ZCQuery('.' + self.oLegend.sId + '-' + self.sType + '-legend-handle').bind('mousedown touchstart', self.zc_scroll_mousedown);
		ZC.ZCQuery('.' + self.oLegend.sId + '-' + self.sType + '-legend-bar').bind('click', self.zc_scroll_bar_click);
	}
});

ZC.ZCLegend = ZC.ZCTextBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sTag = 'legend';
		self.aItems = null;
		self.aMarkers = null;
		self.sLayout = 'x1';
		self.sToggleAction = 'hide';
		self.sItemToggleAction = '';
		self.sMarkerToggleAction = '';
		self.bMinimize = false;
		self.bDraggable = false;
		self.sOverflow = 'none';
		self.sDragHandler = 'header';
		self.iMaxItems = 9999;
		self.oScroll = null;
		self.oItem = null;
		self.oItemOff = null;
		self.oMarker = null;
		self.oMarkerOff = null;
		self.oHeader = null;
		self.oFooter = null;
		self.iOffsetX_ = 0;
		self.iOffsetY_ = 0;
		self.bApplyOffset = true;
		self.iY_ = 0;
		self.iHeight_ = 0;
		self.sAlign = "";
		self.sVerticalAlign = "";
		self.oPageInfo = {
			enabled : false,
			min : -1,
			max : -1,
			page : -1,
			pages : -1
		};
		self.bCollapsed = false;
		self.iDragIndex = -1;
		self.bShared = false;
		self.iGroup = 1;
		self.bHighlightPlot = 0;
		self.bHighlightLegend = false;
		self.bDynamicItems = false;
		self.bHoverLegend = false;
	},
	highlightItem : function(iPlotIndex) {
		var self = this, mValue;
		var bHighlight = false;
		var bScrolled;
		var bMove = ZC.move;
				
		var bHighlightLegend = self.bHighlightLegend;
		if (iPlotIndex !== -1){
			bHighlightLegend = self.bHighlightLegend || self.oParent.oPlotSet.aPlots[iPlotIndex].bHighlightLegend;
		}
		
		if (self.oData['item'] && ZC._n_(mValue=self.oData['item']['highlight-item']) !== null) {
			bHighlight = ZC._b_(mValue);
			if (ZC._n_(self.oData['highlight-legend']) === null && self.oParent.oPlotSet.aPlots[iPlotIndex].oData['highlight-legend'] === null){
				bHighlightLegend = bHighlight;
			}
		}
		
		if (bHighlight || bHighlightLegend) {
			if (bHighlight){
				self.oAttributes['highlight-item'] = iPlotIndex;
			}
			if (bHighlightLegend){
				self.oAttributes['highlight-legend'] = ZC._i_(iPlotIndex);
			}
			
			
			bScrolled = self.scrollTo(ZC._i_(iPlotIndex));
			
			self.saveInfo();
			if (bScrolled){
				ZC.move = false;
				self.clear(false);
		    }
			else{
				self.clear(true);
		    }
			self.bApplyOffset = true;
			self.parse();
			self.paint();
			ZC.move = bMove;
			
		}
	},
	scrollTo: function(iPlotIndex){
		var self = this, iPage;
		var bScrolled = false;
		var iFactor;
		
		if (iPlotIndex >= 0){
			if (iPlotIndex < self.oPageInfo.min || iPlotIndex >= self.oPageInfo.max){
				bScrolled = true;
				if (self.sOverflow === 'scroll'){
					if (self.oScroll.sType === 'scroll-y'){
						iFactor = self.oScroll.iCols;
					}
					else{
						iFactor = self.oScroll.iRows;
					}
				    
					if ((iPlotIndex % iFactor)){
						iPlotIndex -= (iPlotIndex % iFactor);
				    }
				    self.oPageInfo.min = iPlotIndex;
				    self.oPageInfo.max = iPlotIndex + self.iMaxItems;
				
				    if (self.oPageInfo.max > self.aItems.length){
						self.oPageInfo.min = self.aItems.length - self.iMaxItems;
						if (self.aItems.length % iFactor){
					   	    self.oPageInfo.min = self.oPageInfo.min + (iFactor - (self.aItems.length % iFactor))
						}
				
						self.oPageInfo.max = self.aItems.length;
				    }
				}
				else if (self.sOverflow === 'page'){
					iPage = Math.floor(iPlotIndex/self.iMaxItems);
					self.oPageInfo.min = iPage * self.iMaxItems;
					self.oPageInfo.max = self.oPageInfo.min + self.iMaxItems;
					self.oPageInfo.page = iPage + 1;
				}
			}
		}
		return bScrolled;
	},
	parse : function() {
		var self = this, mValue, i, iLen;

		self.oAttributes['force-margins'] = true;

		self.iOffsetX_ = 0;
		self.iOffsetY_ = 0;

		if (ZC._n_(mValue=self.oParent.oParent.oAttributes['graph-' + self.oParent.sId + '-legend-info']) !== null) {
			self.oData['x'] = mValue['x'];
			self.oData['y'] = mValue['y'];
		} 

		if (!ZC.move) {

			var oDefaults_ = self.oParent.oLoader.oDefaults;
			var sGraphType_ = '(' + self.oParent.sType + ')';

			self._super();

			self.assign_a([
				['minimize', 'bMinimize', 'b'],
				['draggable', 'bDraggable', 'b'],
				['shared', 'bShared', 'b'],
				['overflow', 'sOverflow'],
				['max-items', 'iMaxItems', 'i'],
				['group', 'iGroup', 'i'],
				['drag-handler', 'sDragHandler'],
				['highlight-plot', 'bHighlightPlot', 'b'],
				['highlight-legend', 'bHighlightLegend', 'b'],
				['align', 'sAlign'],
				['vertical-align', 'sVerticalAlign']
			]);
			
			
			if (self.bHighlightPlot && ZC._n_(self.oData['highlight-legend']) === null){
				self.bHighlightLegend = self.bHighlightPlot;
			}

			self.oItem = new ZC.ZCTextBox(self);
			oDefaults_.load(self.oItem.oData, sGraphType_ + '.legend.item');
			if (self.oData['item']) {
				self.oData['item']['visible'] = true;
			}
			self.oItem.append(self.oData['item']);
			self.oItem.parse();
			
			self.oItemOff = new ZC.ZCTextBox(self);
			oDefaults_.load(self.oItemOff.oData, sGraphType_ + '.legend.item-off');
			if (self.oData['item-off']) {
				self.oData['item-off']['visible'] = true;
			}
			self.oItemOff.append(self.oData['item-off']);
			self.oItemOff.parse();

			self.oMarker = new ZC.ZCShape(self);
			oDefaults_.load(self.oMarker.oData, sGraphType_ + '.legend.marker');
			if (self.oData['marker']) {
				self.oData['marker']['visible'] = true;
			}
			self.oMarker.append(self.oData['marker']);

			self.oMarker.oAttributes['type'] = 'default';
			
			self.oMarker.oAttributes['show-marker'] = true;
			self.oMarker.oAttributes['show-line'] = false;
			if (ZC._n_(mValue=self.oMarker.oData['type']) !== null) {
				self.oMarker.oAttributes['type'] = mValue;
			}
			if (ZC._n_(mValue=self.oMarker.oData['show-line']) !== null) {
				self.oMarker.oAttributes['show-line'] = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=self.oItem.oData['marker-style']) !== null) {
				self.oMarker.oAttributes['type'] = mValue;
			}
			if (ZC._n_(mValue=self.oItem.oData['show-line']) !== null) {
				self.oMarker.oAttributes['show-line'] = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=self.oItem.oData['show-marker']) !== null) {
				self.oMarker.oData['visible'] = ZC._b_(mValue);
			}
			self.oMarker.parse();

			self.oMarkerOff = new ZC.ZCShape(self);
			oDefaults_.load(self.oMarkerOff.oData, sGraphType_ + '.legend.marker-off');
			if (self.oData['marker-off']) {
				self.oData['marker-off']['visible'] = true;
			}
			self.oMarkerOff.append(self.oData['marker-off']);

			self.oMarkerOff.oAttributes['type'] = 'default';
			self.oMarkerOff.oAttributes['show-marker'] = true;
			self.oMarkerOff.oAttributes['show-line'] = false;
			if (ZC._n_(mValue=self.oMarkerOff.oData['type']) !== null) {
				self.oMarkerOff.oAttributes['type'] = mValue;
			}
			if (ZC._n_(mValue=self.oMarkerOff.oData['show-line']) !== null) {
				self.oMarkerOff.oAttributes['show-line'] = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=self.oItem.oData['marker-style']) !== null) {
				self.oMarkerOff.oAttributes['type'] = mValue;
			}
			if (ZC._n_(mValue=self.oItem.oData['show-line']) !== null) {
				self.oMarkerOff.oAttributes['show-line'] = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=self.oItem.oData['show-marker']) !== null) {
				self.oMarkerOff.oData['visible'] = ZC._b_(mValue);
			}
			self.oMarkerOff.parse();

			if (ZC._n_(mValue=self.oData['header']) !== null || self.bDraggable || self.bMinimize) {
				self.oHeader = new ZC.ZCTextBox(self);
				self.oHeader.sTag = 'legendheader';
				self.oHeader.sDOMClass = 'zc-legend-item ' + self.sId + '-header';
				self.oHeader.sId = self.sId + '-header';
				oDefaults_.load(self.oHeader.oData, sGraphType_ + '.legend.header');
				self.oHeader.oData['text'] = self.oHeader.oData['text'] || ' ';
				self.oHeader.append(mValue);
				self.oHeader.parse();
				if (!self.oHeader.bVisible) {
					self.oHeader = null;
				}
			}

			if (ZC._n_(mValue=self.oData['footer']) !== null) {
				self.oFooter = new ZC.ZCTextBox(self);
				self.oFooter.sTag = 'legendfooter';
				self.oFooter.sDOMClass = 'zc-legend-item ' + self.sId + '-footer';
				self.oFooter.sId = self.sId + '-footer';
				oDefaults_.load(self.oFooter.oData, sGraphType_ + '.legend.footer');
				self.oFooter.append(mValue);
				self.oFooter.parse();
				if (!self.oFooter.bVisible) {
					self.oFooter = null;
				}
			}
			
			
			var aPlots = self.oParent.oPlotSet.aPlots;

			if (ZC._n_(mValue=self.oData['layout']) !== null) {
				self.sLayout = mValue;
			} else {
				
				if (aPlots.length*25 > self.oParent.iHeight) {
					self.sLayout = 'x' + Math.ceil(aPlots.length*25/self.oParent.iHeight);
				}
			}
			if (ZC._n_(mValue=self.oData['toggle-action']) !== null) {
				self.sToggleAction = mValue;
			}
			self.sItemToggleAction = self.sMarkerToggleAction = self.sToggleAction;
			if (ZC._n_(self.oData['item']) !== null) {
				if (ZC._n_(mValue=self.oData['item']['toggle-action']) !== null) {
					self.sItemToggleAction = mValue;
				}
			}
			if (ZC._n_(self.oData['marker']) !== null) {
				if (ZC._n_(mValue=self.oData['marker']['toggle-action']) !== null) {
					self.sMarkerToggleAction = mValue;
				}
			}

			self.aItems = [];
			for (i=0,iLen=aPlots.length;i<iLen;i++) {
				var oItem = new ZC.ZCTextBox(self);
				oItem.copy(self.oItem);
				oItem.append(aPlots[i].oData['legend-item']);
				var sText = null;
				if (ZC._n_(mValue=aPlots[i].sLegendText) !== null) {
					sText = mValue;
				}
				if (ZC._n_(sText) === null) {
					if (ZC._n_(mValue=aPlots[i].sText) !== null) {
						sText = mValue;
					}
				}
				oItem.sText = (ZC._n_(sText)===null)?('Series '+(i+1)):sText;
				oItem.oAttributes['order'] = i;
				oItem.oAttributes['index'] = i;
				if (ZC._n_(aPlots[i].oData['legend-item']) !== null && ZC._n_(mValue=aPlots[i].oData['legend-item']['order']) !== null) {
					oItem.oAttributes['order'] = ZC._l_(ZC._i_(mValue)-1, 0, iLen-1);
				}

				oItem.parse();
				
				self.aItems.push(oItem);
			}

			if ((mValue=self.oParent.oAttributes['legend-info'])) {
				self.bCollapsed = mValue.collapsed;
			}

		} else {
			if (self.oHeader) {
				self.oHeader.parse();
			}
			if (self.oFooter) {
				self.oFooter.parse();
			}
		}

		
		if (!self.aItems || !self.oMarker) {
			return;
		}

		if (self.sOverflow === 'page') {
			if ((mValue=self.oParent.oAttributes['legend-info'])) {
				self.oPageInfo.min = mValue.min;
				self.oPageInfo.max = mValue.max;
				self.oPageInfo.page = mValue.page;
			} else {
				self.oPageInfo.min = 0;
				self.oPageInfo.max = self.iMaxItems;
				self.oPageInfo.page = 1;
			}
			self.oPageInfo.pages = Math.ceil(self.aItems.length/self.iMaxItems);
			
			if (self.oPageInfo.page > self.oPageInfo.pages) {
				self.oPageInfo.page = self.oPageInfo.pages;
				self.oPageInfo.min = (self.oPageInfo.page-1) * self.iMaxItems;
				self.oPageInfo.max = self.oPageInfo.page * self.iMaxItems - 1;
			}
			self.oPageInfo.page = ZC._min_(self.oPageInfo.page, self.oPageInfo.pages);
		}
		else if (self.sOverflow === 'scroll'){
			if ((mValue=self.oParent.oAttributes['legend-info'])) {
				self.oPageInfo.min = mValue.min;
				self.oPageInfo.max = mValue.max;
				self.oPageInfo.page = mValue.page;
			} else {
				self.oPageInfo.min = 0;
				self.oPageInfo.max = self.iMaxItems;
				self.oPageInfo.page = 1;
			}
		}
		else {
			self.oPageInfo.min = 0;
			self.oPageInfo.max = (self.sOverflow === 'hidden')?self.iMaxItems:self.aItems.length;
			self.oPageInfo.page = 1;
		}
		self.saveInfo(false);

		self.aItems.sort(function(a, b) {
			return (a.oAttributes['order'] >= b.oAttributes['order'])?1:-1;
		});

		var iAllowedWidth = self.oParent.iWidth * 0.9;
		if (ZC._n_(self.oData['width']) !== null) {
			iAllowedWidth = self.iWidth;
		}
		var iWidth_ = 0, iHeight_ = 0;
		var iMaxWidth = -ZC.MAX;
		var iMaxHeight = -ZC.MAX;
		var iMarkerSizeFactor = (self.oMarker.oAttributes['show-line'])?3:2;
		var iAllItems = 0;
		
		if (self.sLayout === 'float') {
			for (i=0,iLen=self.aItems.length;i<iLen;i++) {
				iAllItems += self.aItems[i].bVisible?1:0;
				if (i < self.oPageInfo.min || i >= self.oPageInfo.max || self.bCollapsed) {
					continue;
				}
				if (self.aItems[i].bVisible) {
					var iLabelWidth = self.aItems[i].iWidth + self.aItems[i].iMarginLeft + self.aItems[i].iMarginRight + iMarkerSizeFactor*self.aItems[i].iFontSize;
					iMaxHeight = ZC._max_(iMaxHeight, self.aItems[i].iHeight + self.aItems[i].iMarginTop + self.aItems[i].iMarginBottom);
					if (iWidth_ + iLabelWidth > iAllowedWidth) {
						iMaxWidth = ZC._max_(iMaxWidth, iWidth_);
						iHeight_ += iMaxHeight;
						iWidth_ = iLabelWidth;
						iMaxHeight = ZC._max_(iMaxHeight, self.aItems[i].iHeight + self.aItems[i].iMarginTop + self.aItems[i].iMarginBottom);
					} else {
						iWidth_ += iLabelWidth;
					}
				}
			}
			if (iMaxHeight !== -ZC.MAX) {
				iHeight_ += iMaxHeight;
			}
			if (iMaxWidth !== -ZC.MAX) {
				iWidth_ = iMaxWidth;
			}
		} else {
			var iItems = 0;
			for (i=0,iLen=self.aItems.length;i<iLen;i++) {
				iAllItems += self.aItems[i].bVisible?1:0;
				if (i < self.oPageInfo.min || i >= self.oPageInfo.max || self.bCollapsed) {
					continue;
				}
				iItems += self.aItems[i].bVisible?1:0;
			}
			var aLayoutInfo = ZC.ZCMath._layout_(self.sLayout, iItems);
			var iRows = aLayoutInfo[0];
			var iCols = aLayoutInfo[1];
			for (i=0,iLen=self.aItems.length;i<iLen;i++) {
				if (i < self.oPageInfo.min || i >= self.oPageInfo.max || self.bCollapsed) {
					continue;
				}
				if (self.aItems[i].bVisible) {
					iMaxWidth = ZC._max_(iMaxWidth, self.aItems[i].iWidth + self.aItems[i].iMarginLeft + self.aItems[i].iMarginRight + iMarkerSizeFactor*self.aItems[i].iFontSize);
					iMaxHeight = ZC._max_(iMaxHeight, self.aItems[i].iHeight + self.aItems[i].iMarginTop + self.aItems[i].iMarginBottom);
					if (iCols === 1) {
						iHeight_ += self.aItems[i].iHeight + self.aItems[i].iMarginTop + self.aItems[i].iMarginBottom;
					}
				}
			}
			iWidth_ = iCols*iMaxWidth;
			iHeight_ = iRows*iMaxHeight;
		}
		if (self.sOverflow === 'page' && iAllItems > self.iMaxItems) {
			self.oPageInfo.enabled = true;
		}
		
		if (self.sOverflow === 'scroll' && iAllItems > self.iMaxItems){
			
			if (!self.oScroll){
				if (!iRows || iRows > iCols){
					self.oScroll =  new ZC.ZCLegendScroll(self, 'y');
					oDefaults_.load(self.oScroll.oData, '.scroll-y');
				}
				else{
					self.oScroll =  new ZC.ZCLegendScroll(self, 'x');
					oDefaults_.load(self.oScroll.oData, '.scroll-x');
				}
				self.oScroll.iRows = iRows;
				self.oScroll.iCols = iCols;
				self.oScroll.parse();
			}
			
			if (!self.bCollapsed){
				if (self.oScroll.sType === 'scroll-y'){
					iWidth_ += self.oScroll.oBarStyle.iWidth;
				}
				else{
					iHeight_ += self.oScroll.oBarStyle.iHeight;
				}
			}
		}

		
		if (self.oHeader) {
			var iHWidth_ = self.oHeader.iWidth;
			if (self.bDraggable && self.sDragHandler === 'icon') {
				iHWidth_ += 15;
				if (self.bMinimize) {
					iHWidth_ += 25;
				}
			} else {
				if (self.bMinimize) {
					iHWidth_ += 15;
				}
			}
			iWidth_ = ZC._max_(iWidth_, iHWidth_);
		}
		if (self.oFooter) {
			iWidth_ = ZC._max_(iWidth_, self.oFooter.iWidth);
		}

		var bForceW = false, bForceH = false;
		if (ZC._n_(self.oData['width']) === null) {
			self.oData['width'] = iWidth_;
			bForceW = true;
		}
		if (ZC._n_(self.oData['height']) === null) {
			self.oData['height'] = iHeight_;
			bForceH = true;
		}

		self.iX = -1;
		self.iY = -1;
		
		self.locate();

		
		if (ZC._n_(self.oData['position']) !== null && typeof(self.oAttributes['position-info']) !== 'undefined') {
			if (self.oAttributes['position-info'][0] > 0.5) {
				self.iOffsetX_ += self.iPaddingLeft + self.iPaddingRight;
			}
			if (self.oAttributes['position-info'][1] > 0.5) {
				self.iOffsetY_ += self.iPaddingTop + self.iPaddingBottom;
			} else {
				if (self.oHeader) {
					self.iOffsetY_ -= self.oHeader.iHeight;
				}
				if (self.oFooter) {
					self.iOffsetY_ -= self.oFooter.iHeight;
				}
			}
		} else {
			if (self.oParent.iX === 0 || (self.iX+self.iWidth/2 > self.oParent.iX+self.oParent.iWidth/2)) {
				self.iOffsetX_ += self.iPaddingLeft + self.iPaddingRight;
			}
			if (self.oParent.iY === 0 || (self.iY+self.iHeight/2 > self.oParent.iY+self.oParent.iHeight/2)) {
				self.iOffsetY_ += self.iPaddingTop + self.iPaddingBottom;
			}
		}

		if (!ZC.move && (mValue=self.oParent.oParent.oAttributes['graph-' + self.oParent.sId + '-legend-info'])) {
			if (mValue['x']) {
				self.iX = mValue['x'];
			}
			if (mValue['y']) {
				self.iY = mValue['y'];
			}
		}

		self.iHeight_ = self.iHeight;
		self.iY_ = self.iY;
		if (self.oHeader) {
			self.iHeight += self.oHeader.iHeight;
			self.iY_ += self.oHeader.iHeight;
			self.iOffsetY_ += self.oHeader.iHeight;
		}
		if (self.oFooter) {			
			self.iHeight += self.oFooter.iHeight;
			self.iOffsetY_ += self.oFooter.iHeight;
		}
		
		
		if (self.oPageInfo.enabled && !self.bCollapsed) {
			
			var oStatus = new ZC.ZCTextBox(self);
			oStatus.sText = ' ';
			oStatus.append(self.oData['page-status']);
			oStatus.parse();
			self.iHeight += oStatus.iHeight + 4;
			self.iOffsetY_ += oStatus.iHeight + 4;
		}

		if (bForceW) {
			self.oData['width'] = null;
		}
		if (bForceH) {
			self.oData['height'] = null;
		}

		if (!self.bCollapsed) {
			self.iWidth += self.iPaddingLeft + self.iPaddingRight;
			self.iHeight += self.iPaddingTop + self.iPaddingBottom;
		}

		if (self.oAttributes['default-width']) {
			self.iWidth = self.oAttributes['default-width'];
		}

	},
	alignPosition: function(oSettings){
		var self = this;
		
		if (ZC._n_(oSettings) === null){
		    return;
		}
		
		
		oDefaultLegend_ = self.oParent.oLoader.oDefaults.oDefaults.graph.legend;
		var sAlign = oSettings['align'] || oDefaultLegend_['align'];
		var sVerticalAlign = oSettings['vertical-align'] || oDefaultLegend_['vertical-align'];
		var layout = oSettings['layout'] || oDefaultLegend_['layout'];
		
		if (sAlign || sVerticalAlign){
			if (sAlign === 'center'){
				layout = self.oData['layout'] = 'horizontal';
				self.oData['position'] = '50% ';
			}
			else if (sAlign === 'left'){
				self.oData['position'] = '0% ';
			}
			else{
				self.oData['position'] = '100% ';
			}
			
			if (sVerticalAlign === 'middle'){
				self.oData['position'] += '50%';
			}
			else if (sVerticalAlign === 'bottom'){
				self.oData['position'] += '100%';
			}
			else{
				self.oData['position'] += '0%';
		    }
			
			if (layout === 'horizontal' || sVerticalAlign === 'middle'){
				self.oData['adjust-layout'] = true;
			}
		}
	},
	saveInfo : function(bSavePosition) {
		var self = this;
		if (typeof(bSavePosition) === 'undefined') {
			bSavePosition = true;
		}
		self.oParent.oAttributes['legend-info'] = {
			collapsed : self.bCollapsed,
			min : self.oPageInfo.min,
			max : self.oPageInfo.max,
			page : self.oPageInfo.page
		};
		if (bSavePosition) {
			self.oParent.oParent.oAttributes['graph-' + self.oParent.sId + '-legend-info'] = {
				x : self.iX,
				y : self.iY
			};
		}
	},
	clear : function(bSoftClear) {
		if (ZC._n_(bSoftClear) === null) {
			bSoftClear = false;
		}
		var self = this, mValue = self.oParent.sId + '-legend-';
		var oRoot = null;
		ZC.ZCQuery('.' + mValue + 'item', oRoot).remove();
		ZC.ZCQuery('.' + mValue + 'header', oRoot).remove();
		ZC.ZCQuery('.' + mValue + 'footer', oRoot).remove();
		ZC.ZCQuery('#' + mValue + 'page-status', oRoot).remove();
		if (!bSoftClear) {
			if (!ZC.move) {
				self.unbind();
			}
			ZC.ZCQuery('.' + mValue + 'page-area', oRoot).remove();
			ZC.ZCQuery('.' + mValue + 'header-area', oRoot).remove();
			ZC.ZCQuery('.' + mValue + 'item-area', oRoot).remove();
			ZC.ZCQuery('.' + mValue + 'marker-area', oRoot).remove();
			
		}
		
		if (ZC.move) {
			ZC.ZCHtmlUtils._clear_(ZC._id_(mValue + 'c'), self.oParent.oLoader.sOutput, self.oParent.iX, self.oParent.iY, self.oParent.iWidth, self.oParent.iHeight);
		} else {
			ZC.ZCHtmlUtils._clear_(ZC._id_(mValue + 'c'), self.oParent.oLoader.sOutput, self.iX-2*self.iBorderWidth-2*self.iShadowDistance, self.iY-2*self.iBorderWidth-2*self.iShadowDistance, self.iWidth+4*self.iBorderWidth+4*self.iShadowDistance, self.iHeight+4*self.iBorderWidth+4*self.iShadowDistance);
		}
	},
	unbind : function() {
		var self = this;
		ZC.ZCQuery('#' + self.sId + '-legend-frame').die('DOMMouseScroll mousewheel', self.zc_legend_mousescroll);
		ZC.ZCQuery('#' + self.sId + '-legend-frame').die(ZC.ZCHtmlUtils._event_('mouseover'), self.zc_legend_mouseover);
		ZC.ZCQuery('#' + self.sId + '-legend-frame').die(ZC.ZCHtmlUtils._event_('mouseout'), self.zc_legend_mouseout);
		ZC.ZCQuery('#' + self.sId + '-move-area').die(ZC.ZCHtmlUtils._event_('mousedown'), self.zc_legend_mousedown);
		ZC.ZCQuery('#' + self.sId + '-minimize-area').die(ZC.ZCHtmlUtils._event_('click'), self.zc_legend_toggle);
		ZC.ZCQuery('.' + self.sId + '-page-area').die(ZC.ZCHtmlUtils._event_('click'), self.zc_legend_page_click);

		
		if (!self.oItem) {
			return;
		}

		if (self.oItem.oData['reorder']) {
			ZC.ZCQuery('.' + self.oParent.sId + '-legend-item-area').die('mousedown', self.zc_legend_item_mousedown);
		}
	},
	paint : function(iNodeIndex) {
		var self = this;
		var mValue, oShape, oIcon, x, y, i, iLen, iMarkerHSize, iMarkerVSize, iXPrev, oPrev, iYPrev, iXNext, oNext, iYNext, iR;

		if (!self.bVisible) { return; }

		if (!self.oAttributes['default-width']) {
			self.oAttributes['default-width'] = self.iWidth;
		}

		
		if (!self.aItems) {
			return;
		}

		var aPlots = self.oParent.oPlotSet.aPlots;

		if (self.bApplyOffset && ZC._n_(self.oData['y']) === null) {
			self.iX -= self.iOffsetX_;
			if (self.iX < self.iMarginLeft && (self.iMarginLeft < self.iMarginRight || self.iMarginRight === -2)) {
				self.iX = self.iMarginLeft;
			}
			self.iY -= self.iOffsetY_;
			self.iY_ -= self.iOffsetY_;
			if (self.iY < self.iMarginTop && (self.iMarginTop < self.iMarginBottom || self.iMarginBottom === -2)) {
				var iDiff = self.iY_ - self.iY;
				self.iY = self.iMarginTop;
				self.iY_ = self.iMarginTop + iDiff;
			}
			self.bApplyOffset = false;
		}

		self.bSkipText = true;
		self._super();

		if (self.oHeader) {
			self.oHeader.iX = self.iX;
			self.oHeader.iY = self.iY;
			self.oHeader.iWidth = self.iWidth;
			self.oHeader.oCanvas = self.oHeader.oCanvasSh = self.oCanvas;
			self.oHeader.paint();
			if (!ZC.move) {
				self.oHeader.paintPrintVersion();
			}

			if (self.bDraggable && self.sDragHandler === 'icon') {
				oIcon = new ZC.ZCShape(self);
				oIcon.oCanvas = self.oCanvas;
				oIcon.sLineColor = '#000';
				oIcon.iLineWidth = 1;
				oIcon.sShape = 'line';
				oIcon.append(self.oData['icon']);
				x = self.oHeader.iX + self.oHeader.iWidth - 10;
				y = self.oHeader.iY + self.oHeader.iHeight/2;
				oIcon.aPoints = [
					[x-7,y],
					[x+7,y],
					null,
					[x,y-7],
					[x,y+7],
					null,
					[x-6,y-1],
					[x-6,y+1],
					null,
					[x-5,y-2],
					[x-5,y+2],
					null,
					[x+6,y-1],
					[x+6,y+1],
					null,
					[x+5,y-2],
					[x+5,y+2],
					null,
					[x-1,y-6],
					[x+1,y-6],
					null,
					[x-2,y-5],
					[x+2,y-5],
					null,
					[x-1,y+6],
					[x+1,y+6],
					null,
					[x-2,y+5],
					[x+2,y+5]
				];
				oIcon.parse();
				oIcon.paint();
			}

			if (self.bMinimize) {
				oShape = new ZC.ZCShape(self);
				oShape.oCanvas = self.oCanvas;
				oShape.sLineColor = '#000';
				oShape.iLineWidth = 1;
				oShape.append(self.oData['icon']);
				oShape.sShape = 'line';
				x = self.oHeader.iX + self.oHeader.iWidth - 10 - ((self.bDraggable && self.sDragHandler==='icon')?20:0);
				y = self.oHeader.iY + self.oHeader.iHeight/2;
				oShape.aPoints = [
					[x-7,y-2],
					[x+2,y-2],
					[x+2,y+7],
					[x-7,y+7],
					[x-7,y-2],
					[x+2,y-2],
					null,
					[x-4,y-5],
					[x+5,y-5],
					[x+5,y+4],
					[x-4,y+4],
					[x-4,y-5],
					[x+5,y-5]
				];
				oShape.parse();
				oShape.paint();
			}
		}

		if (self.oFooter) {
			self.oFooter.iX = self.iX;
			self.oFooter.iY = self.iY + self.iHeight - self.oFooter.iHeight;
			self.oFooter.iWidth = self.iWidth;
			self.oFooter.oCanvas = self.oFooter.oCanvasSh = self.oCanvas;
			self.oFooter.paint();
			if (!ZC.move) {
				self.oFooter.paintPrintVersion();
			}
		}

		var iItems = 0;
		for (i=0,iLen=self.aItems.length;i<iLen;i++) {
			if (i < self.oPageInfo.min || i >= self.oPageInfo.max || self.bCollapsed) {
				continue;
			}
			iItems += self.aItems[i].bVisible?1:0;
		}
		var aLayoutInfo = ZC.ZCMath._layout_(self.sLayout, iItems);
		var iRows = aLayoutInfo[0];
		var iCols = aLayoutInfo[1];

		var iSizeH = self.iWidth/iCols;
		var iSizeV = self.iHeight_/iRows;

		var iRow = 0, iCol = 0;
		self.aMarkers = [];
		var iLineY = 0;
		var iMaxHeight = -ZC.MAX;
		var iMarkerSizeFactor = (self.oMarker.oAttributes['show-line'])?3:2;
		var oLastItem = null;

		var _parseText = function(sText) {
			var sText_ = sText;
			if (ZC._n_(iNodeIndex) === null) {
				iNodeIndex = 0;
			}
			if (aPlots[ii] && aPlots[ii].aPlotNodes[iNodeIndex]) {
				sText = aPlots[ii].getNode(iNodeIndex).parseText(sText);
			}
			self.bDynamicItems = self.bDynamicItems || (sText !== sText_);
			return sText;
		};

		var sArea = '';
		self.bDynamicItems = false;
		for (i=0,iLen=self.aItems.length;i<iLen;i++) {
			if (i < self.oPageInfo.min || i >= self.oPageInfo.max || self.bCollapsed) {
				continue;
			}
			var oItem = new ZC.ZCTextBox(self);
			oItem.copy(self.aItems[i]);
			
			
			
			if (self.oAttributes['highlight-legend'] === i) {
				oItem.append({
					bold : true
				});
				if (ZC._n_(self.oData['item']) !== null) {
					oItem.append(self.oData['item']['highlight-state']);
				}
			}
			
			var ii = oItem.oAttributes['index'];
			
			var oItemPaint = new ZC.ZCTextBox(self);
			oItemPaint.sTag = 'legenditem';
			oItemPaint.sId = self.sId + '-item_' + ii;
			oItemPaint.sDOMClass = 'zc-legend-item ' + self.sId + '-item';
			oItemPaint.copy(oItem);
			if (!self.oParent.oAttributes['plot'+ii+'.visible'] || aPlots[ii].oData['legend-status'] === 'off') {
				oItemPaint.append(self.oItemOff.oData);
			}
			oItemPaint.append(aPlots[ii].oData['legend-item']);
			oItemPaint.parseText = _parseText;
			oItemPaint.parse();
			
			if (oItemPaint.bVisible) {
				if (self.sLayout === 'float') {
					iMaxHeight = ZC._max_(iMaxHeight, oItem.iHeight);
					if (ZC._n_(oLastItem) === null) {
						oItem.iX = self.iX + self.iPaddingLeft + oItem.iMarginLeft + iMarkerSizeFactor*oItem.iFontSize;
						oItem.iY = self.iY_ + self.iPaddingTop + oItem.iMarginTop;
						iLineY = self.iY_;
					} else {
						oItem.iX = (oLastItem.iX + oLastItem.iWidth + oLastItem.iMarginRight) + oItem.iMarginLeft + iMarkerSizeFactor*oItem.iFontSize;
						if (ZC._i_(oItem.iX + oItem.iWidth + oItem.iMarginRight) > ZC._i_(self.iX + self.iWidth)) {
							oItem.iX = self.iX + self.iPaddingLeft + oItem.iMarginLeft + iMarkerSizeFactor*oItem.iFontSize;
							iLineY += iMaxHeight + oItem.iMarginTop + oItem.iMarginBottom;
							iMaxHeight = -ZC.MAX;
						}
						oItem.iY = iLineY + self.iPaddingTop + oItem.iMarginTop;
					}
				} else {
					oItem.iX = self.iX + (iCol===0?self.iPaddingLeft:0) + iCol*iSizeH + oItem.iMarginLeft + iMarkerSizeFactor*oItem.iFontSize;
					oItem.iY = self.iY_ + self.iPaddingTop + iRow*iSizeV + oItem.iMarginTop;
					iCol++;
					if (iCol === iCols) {
						iCol = 0;
						iRow++;
					}
				}
				oLastItem = oItem;
				oItemPaint.iX = oItem.iX = ZC._i_(oItem.iX);
				oItemPaint.iY = oItem.iY = ZC._i_(oItem.iY);
				oItemPaint.oCanvas = oItemPaint.oCanvasSh = self.oCanvas;

				oItemPaint.iX += self.iOffsetX;
				oItemPaint.iY += self.iOffsetY;
				
				if (ii === self.iDragIndex) {
					if (self.oAttributes['calculate-y']){
						self.oAttributes['calculate-y'] = false;
						self.oAttributes['dragged-offset-y'] = self.oAttributes['dragged-y'] - oItemPaint.iY;
					}
					oItemPaint.iY = self.oAttributes['dragged-y'] - self.oAttributes['dragged-offset-y'] - oItemPaint.iFontSize/4;
				}
				
				oItemPaint.paint();

				if (typeof(self.oAttributes['showhide']) === 'undefined' || ZC._n_(self.oAttributes['showhide']) === null) {
					if (!ZC.move) {
						oItemPaint.paintPrintVersion();
					}
				}
			}

			var sMarkerType = self.oMarker.oAttributes['type'];
			if (ZC._n_(mValue=aPlots[ii].oData['legend-marker']) !== null) {
				if (ZC._n_(mValue['type']) !== null) {
					sMarkerType = mValue['type'];
				}
			}
			var bImportPlotMarker = false;
			if (sMarkerType === 'match' || sMarkerType === 'inherit') {
				bImportPlotMarker = true;
				if (ZC._n_(mValue=aPlots[ii].oMarker.oData['type']) !== null) {
					sMarkerType = mValue;
				} else {
					sMarkerType = 'default';
				}
			}
			var oMarker;
			if (ZC._indexof_(['default','square'], sMarkerType) !== -1) {
				oMarker = new ZC.ZCBox(self);
			} else {
				oMarker = new ZC.ZCShape(self);
				oMarker.sShape = sMarkerType;
			}

			oMarker.sTag = 'legendmarker';
			oMarker.append(self.oMarker.oData);
			if (!self.oParent.oAttributes['plot'+ii+'.visible'] || aPlots[ii].oData['legend-status'] === 'off') {
				oMarker.append(self.oMarkerOff.oData);
			}

			oMarker.iFillAngle = aPlots[ii].iFillAngle;
			switch (aPlots[ii].sType) {
				case 'pie':
				case 'pie3d':
				case 'nestedpie':
				case 'vbar':
				case 'vbar3d':
				case 'hbar':
				case 'hbar3d':
				case 'vbullet':
				case 'hbullet':
				case 'area':
				case 'area3d':
				case 'gauge':
				case 'vfunnel':
				case 'hfunnel':
				case 'venn':
					oMarker.sBackgroundColor1 = aPlots[ii].sBackgroundColor1;
					oMarker.sBackgroundColor2 = aPlots[ii].sBackgroundColor2;
					oMarker.sGradientColors = aPlots[ii].sGradientColors;
					oMarker.sGradientStops = aPlots[ii].sGradientStops;
					break;
				case 'scatter':
				case 'bubble':
					oMarker.sBackgroundColor1 = (aPlots[ii].oMarker.sBackgroundColor1 !== '-1')?aPlots[ii].oMarker.sBackgroundColor1:aPlots[ii].sBackgroundColor1;
					oMarker.sBackgroundColor2 = (aPlots[ii].oMarker.sBackgroundColor2 !== '-1')?aPlots[ii].oMarker.sBackgroundColor2:aPlots[ii].sBackgroundColor2;
					oMarker.sGradientColors = (aPlots[ii].oMarker.sGradientColors !== '')?aPlots[ii].oMarker.sGradientColors:aPlots[ii].sGradientColors;
					oMarker.sGradientStops = (aPlots[ii].oMarker.sGradientStops !== '')?aPlots[ii].oMarker.sGradientStops:aPlots[ii].sGradientStops;
					break;
				default:
					oMarker.sBackgroundColor1 = aPlots[ii].sLineColor;
					oMarker.sBackgroundColor2 = aPlots[ii].sLineColor;
					break;
			}

			if (oMarker.sShape === 'line' || oMarker.sShape === 'area') {
				oMarker.sLineColor = oMarker.sBackgroundColor1;
				oMarker.iLineWidth = 2;
			}

			if (bImportPlotMarker) {
				oMarker.append(aPlots[ii].oMarker.oData);
			}

			oMarker.oData['line-style'] = 'solid';
			oMarker.oData['type'] = oMarker.sShape;

			oMarker.append(aPlots[ii].oData['legend-marker']);

			if (bImportPlotMarker) {
				oMarker.oData['type'] = oMarker.sShape;
			}

			
			oMarker.oAttributes['show-marker'] = true;
			oMarker.oAttributes['show-line'] = false;
			if (ZC._n_(mValue=oMarker.oData['show-line']) !== null) {
				oMarker.oAttributes['show-line'] = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=oItemPaint.oData['show-line']) !== null) {
				oMarker.oAttributes['show-line'] = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=oItemPaint.oData['show-marker']) !== null) {
				oMarker.oData['visible'] = ZC._b_(mValue);
			}
			

			if (ZC._indexof_(['default','square'], sMarkerType) !== -1) {
				if (ZC._n_(mValue=oMarker.oData['size']) !== null) {
					if (ZC._n_(oMarker.oData['width']) === null) {
						oMarker.oData['width'] = 2*ZC._i_(mValue);
					}
					if (ZC._n_(oMarker.oData['height']) === null) {
						oMarker.oData['height'] = 2*ZC._i_(mValue);
					}
				}
			}

			oMarker.sId = self.sId + '-marker_' + ii;
			oMarker.oCanvas = oMarker.oCanvasSh = self.oCanvas;
			oMarker.iX = oItemPaint.iX - iMarkerSizeFactor*oItemPaint.iFontSize + (iMarkerSizeFactor-1)*oItemPaint.iFontSize/2 + oItemPaint.iFontSize/2;
			oMarker.iY = oItemPaint.iY + (oItemPaint.iHeight-oItemPaint.iFontSize)/2 + oItemPaint.iFontSize/2;

			oMarker.parse();

			if (self.oAttributes['highlight-legend'] === ii) {
				oMarker.append({
					size : oMarker.iSize+1,
					width : oMarker.iWidth+2,
					height : oMarker.iHeight+2
				});
				if (aPlots[ii] && aPlots[ii].aPlotNodes[iNodeIndex] && aPlots[ii].aPlotNodes[iNodeIndex].oStateObj){
				    oMarker.append({
						sBackgroundColor1 : aPlots[ii].aPlotNodes[iNodeIndex].oStateObj.sBackgroundColor1,
						sBackgroundColor2 : aPlots[ii].aPlotNodes[iNodeIndex].oStateObj.sBackgroundColor2,
					});
				}
				oMarker.parse();
			}

			if (oMarker.sShape === 'line') {
				oMarker.oData['points'] = [
					[oMarker.iX - 1.75*oMarker.iSize, oMarker.iY],
					[oMarker.iX + 1.75*oMarker.iSize, oMarker.iY]
				];
				oMarker.parse();
			} else if (oMarker.sShape === 'area') {
				oMarker.oData['points'] = [
					[oMarker.iX - 1.75*oMarker.iSize, oMarker.iY+oMarker.iSize],
					[oMarker.iX + 1.75*oMarker.iSize, oMarker.iY+oMarker.iSize],
					[oMarker.iX + 1*oMarker.iSize, oMarker.iY-oMarker.iSize/2],
					[oMarker.iX, oMarker.iY],
					[oMarker.iX - 1.25*oMarker.iSize, oMarker.iY-oMarker.iSize],
					[oMarker.iX - 1.75*oMarker.iSize, oMarker.iY+oMarker.iSize]
				];
				oMarker.parse();
			}

			var iMarkerLineX = oMarker.iX + oMarker.iOffsetX, iMarkerLineY = oMarker.iY + oMarker.iOffsetY;
			if (ZC._indexof_(['default','square'], sMarkerType) !== -1) {
				oMarker.iX -= oMarker.iWidth/2;
				oMarker.iY -= oMarker.iHeight/2;
			}

			if (!self.oParent.oAttributes['plot'+ii+'.visible'] || aPlots[ii].oData['legend-status'] === 'off') {
				oMarker.fAlpha /= 4;
			}

			if (oItemPaint.bVisible && oMarker.oAttributes['show-line']) {
				var oCtx = ZC.ZCHtmlUtils._context_(self.oCanvas, self.oParent.oLoader.sOutput);
				var oLineStyle = new ZC.ZCStyle(self);
				oLineStyle.oCanvas = self.oCanvas;
				oLineStyle.copy(aPlots[ii]);
				oLineStyle.oData['line-style'] = self.oMarker.sLineStyle;
				oLineStyle.append(aPlots[ii].oData);
				oLineStyle.append(self.oMarker.oData);
				oLineStyle.append(aPlots[ii].oData['legend-item']);
				oLineStyle.append(aPlots[ii].oData['legend-marker']);
				oLineStyle.parse();
				if (!self.oParent.oAttributes['plot'+ii+'.visible']) {
					oLineStyle.fAlpha = 0.25;
				}
				var aPoints = [];
				var fFactor = oMarker.bVisible?2:1;
				iMarkerHSize = (oMarker.sShape==='box')?oMarker.iWidth/2:oMarker.iSize;
				aPoints.push([iMarkerLineX - fFactor*iMarkerHSize - (oLineStyle.iLineWidth>1?1:0), iMarkerLineY - (oLineStyle.iLineWidth>1?0.5:0)]);
				aPoints.push([iMarkerLineX + fFactor*iMarkerHSize, iMarkerLineY - (oLineStyle.iLineWidth>1?0.5:0)]);
				oLineStyle.bPixelCorrection = true;
				ZC.ZCLine.paint(oCtx, oLineStyle, aPoints);
			}

			if (ii === self.iDragIndex) {
				oMarker.iY = self.oAttributes['dragged-y'] - self.oAttributes['dragged-offset-y']/2;
			}

			if (oMarker.bVisible) {
				oMarker.paint();
			}
			self.aMarkers.push(oMarker);

			var bItemToggle = true;
			if (ZC._n_(mValue=self.oItem.oData['toggle']) !== null) {
				bItemToggle = ZC._b_(mValue);
			}
			self.oAttributes['item.toggle'] = bItemToggle;

			if ((oItemPaint.bVisible || oMarker.bVisible)) {
				if (ZC._indexof_(self.oParent.oLoader.aFlags, 'skip_interactivity') === -1) {
					var iMarkerCX = oMarker.iOffsetX + (oMarker.sShape==='box'?(oMarker.iX+oMarker.iWidth/2):oMarker.iX);
					var iMarkerCY = oMarker.iOffsetY + (oMarker.sShape==='box'?(oMarker.iY+oMarker.iHeight/2):oMarker.iY);
					iMarkerHSize = (oMarker.sShape==='box')?oMarker.iWidth/2:oMarker.iSize;
					iMarkerVSize = (oMarker.sShape==='box')?oMarker.iHeight/2:oMarker.iSize;
					var iLineExtent = (oMarker.oAttributes['show-line']?2:1)*iMarkerHSize;
					var oMain = ZC._id_(self.oLoader.sId + '-top');
					if (!ZC._id_(oItemPaint.sId + '-area')) {
						if (self.sMarkerToggleAction !== 'disabled') {
							if (!ZC._id_(oMarker.sId + '-area')) {
								ZC.ZCHtmlUtils._div_({
									cls : self.sId + '-marker-area zc-legend-marker-area zc-abs',
									id : oMarker.sId + '-area',
									wh : iLineExtent*2 + '/' + iMarkerVSize*2,
									tl : (iMarkerCY-iMarkerVSize) + '/' + (iMarkerCX-iLineExtent),
									opacity : 0,
									p : oMain,
									zidx: 1
								});
							}
							
						}
						if (self.sItemToggleAction !== 'disabled') {
							
							if (!ZC._id_(oItemPaint.sId + '-area')) {
								ZC.ZCHtmlUtils._div_({
									cls : self.sId + '-item-area zc-legend-item-area zc-abs',
									id : oItemPaint.sId + '-area',
									wh : oItemPaint.iWidth + '/' + oItemPaint.iHeight,
									tl : (oItemPaint.iY+oItemPaint.iOffsetY) + '/' + (oItemPaint.iX+oItemPaint.iOffsetX),
									opacity : 0,
									p : oMain,
									zidx: 1
								});
							}
						}
					}
					
				}
			}
		}
		
		if (self.oScroll && !self.bCollapsed) {
			self.oScroll.paint();
		}

		if (self.oPageInfo.enabled && !self.bCollapsed) {

			var oStatus = new ZC.ZCTextBox(self);
			oStatus.oCanvas = oStatus.oCanvasSh = self.oCanvas;
			oStatus.sId = self.sId + '-page-status';
			oStatus.sText = ZC.ZCLabels['legend-pagination'].replace('%page%', self.oPageInfo.page).replace('%pages%', self.oPageInfo.pages);
			oStatus.append(self.oData['page-status']);
			oStatus.parse();
			if (self.iWidth < oStatus.iWidth + 48) {
				oStatus.sText = self.oPageInfo.page + '/' + self.oPageInfo.pages;
				oStatus.parse();
			}

			oStatus.iX = self.iX + self.iWidth/2 - oStatus.iWidth/2;
			oStatus.iY = self.iY + self.iHeight - (self.oFooter?self.oFooter.iHeight:0) - oStatus.iHeight - 4;
			if (oStatus.bVisible) {
				oStatus.paint();
			}

			oPrev = new ZC.ZCShape(self);
			oPrev.oCanvas = oPrev.oCanvasSh = self.oCanvas;
			oPrev.sId = self.sId + '-page-prev';
			oPrev.sBackgroundColor1 = oPrev.sBackgroundColor2 = self.oPageInfo.page>1?'#f90':'#999';
			oPrev.append(self.oPageInfo.page>1?self.oData['page-on']:self.oData['page-off']);
			iXPrev = self.iX + self.iWidth/2 - oStatus.iWidth/2 - 6;
			iYPrev = oStatus.iY + oStatus.iHeight/2;
			oPrev.parse();
			oPrev.iSize = ZC._max_(oPrev.iSize, 8);
			iR = ZC._i_(oPrev.iSize*0.75);
			oPrev.aPoints = [
				[iXPrev,iYPrev-iR],
				[iXPrev,iYPrev+iR],
				[iXPrev-oPrev.iSize,iYPrev],
				[iXPrev,iYPrev-iR]
			];
			oPrev.parse();
			if (oPrev.bVisible) {
				oPrev.paint();
			}

			oNext = new ZC.ZCShape(self);
			oNext.oCanvas = oNext.oCanvasSh = self.oCanvas;
			oNext.sId = self.sId + '-page-next';
			oNext.sBackgroundColor1 = oNext.sBackgroundColor2 = self.oPageInfo.page<self.oPageInfo.pages?'#f90':'#999';
			oNext.append(self.oPageInfo.page<self.oPageInfo.pages?self.oData['page-on']:self.oData['page-off']);
			iXNext = self.iX + self.iWidth/2 + oStatus.iWidth/2 + 6;
			iYNext = oStatus.iY + oStatus.iHeight/2;
			oNext.parse();
			oNext.iSize = ZC._max_(oNext.iSize, 8);
			iR = ZC._i_(oNext.iSize*0.75);
			oNext.aPoints = [
				[iXNext,iYNext-iR],
				[iXNext,iYNext+iR],
				[iXNext+oNext.iSize,iYNext],
				[iXNext,iYNext-iR]
			];
			oNext.parse();
			if (oNext.bVisible) {
				oNext.paint();
			}

		}

		if (!ZC.move) {
		
			var oMain = ZC._id_(self.oLoader.sId + '-top');
			
			
			if (!ZC._id_(self.sId + '-legend-frame')) {
				var iHeight = self.iHeight;
				var iY = self.iY;
				if (self.oHeader){
					iHeight -= self.oHeader.iHeight;
					iY += self.oHeader.iHeight;
				}
				
				ZC.ZCHtmlUtils._div_({
					cls : 'zc-abs zc-legend-frame ' + self.sId + '-legend-frame',
					id : self.sId + '-legend-frame',
					wh : self.iWidth + '/' + iHeight,
					tl : iY + '/' + self.iX,
					opacity : 0,
					p : oMain,
					zidx: 0
				});
				
			}
			
			if (self.oPageInfo.enabled && !self.bCollapsed) {
				if (self.oPageInfo.page > 1) {
					ZC.ZCHtmlUtils._div_({
						cls : self.sId + '-page-area zc-legend-page-area zc-abs',
						id : self.sId + '-page-prev-area',
						wh : oPrev.iSize + '/' + oPrev.iSize*2,
						tl : ZC._i_(iYPrev+oPrev.iOffsetY-oPrev.iSize) + '/' + ZC._i_(iXPrev + oPrev.iOffsetX-oPrev.iSize),
						opacity : 0,
						p : oMain,
						zidx: 1
					});
					
				}
				if (self.oPageInfo.page < self.oPageInfo.pages) {
					ZC.ZCHtmlUtils._div_({
						cls : self.sId + '-page-area zc-legend-page-area zc-abs',
						id : self.sId + '-page-next-area',
						wh : oNext.iSize + '/' + oNext.iSize*2,
						tl : ZC._i_(iYNext+oPrev.iOffsetY-oNext.iSize) + '/' + ZC._i_(iXNext + oNext.iOffsetX),
						opacity : 0,
						p : oMain,
						zidx: 1
					});
					
				}
			}

			if (self.oHeader && self.bDraggable) {
				sArea += ZC.ZCHtmlUtils._area_start_('rect', '', 'move') + 'class="' + (self.sId + '-header-area zc-legend-header-area') + '" id="' + self.sId + '-move-area' + '" coords="';
				if (self.sDragHandler === 'icon') {
					sArea += ZC._i_(self.oHeader.iX+self.oHeader.iWidth-20+ZC.MAPTX+oIcon.iOffsetX) + ',' + ZC._i_(self.oHeader.iY+ZC.MAPTX+oIcon.iOffsetY) + ',' + ZC._i_(self.oHeader.iX+self.oHeader.iWidth-1+ZC.MAPTX+oIcon.iOffsetX) + ',' + ZC._i_(self.oHeader.iY+self.oHeader.iHeight+ZC.MAPTX+oIcon.iOffsetY);
				} else {
					sArea += ZC._i_(self.oHeader.iX+ZC.MAPTX) + ',' + ZC._i_(self.oHeader.iY+ZC.MAPTX) + ',' + ZC._i_(self.oHeader.iX+self.oHeader.iWidth-(self.bMinimize?23:0)+ZC.MAPTX) + ',' + ZC._i_(self.oHeader.iY+self.oHeader.iHeight+ZC.MAPTX);
				}
				sArea += '" />';
				
			}

			if (self.bMinimize) {
				sArea += ZC.ZCHtmlUtils._area_start_('rect') + 'class="' + (self.sId + '-header-area zc-legend-header-area') + '" id="' + self.sId + '-minimize-area' + '" coords="';
				if (self.bDraggable && self.sDragHandler === 'icon') {
					sArea += ZC._i_(self.oHeader.iX+self.oHeader.iWidth-41+ZC.MAPTX+oShape.iOffsetX) + ',' + ZC._i_(self.oHeader.iY+ZC.MAPTX+oShape.iOffsetY) + ',' + ZC._i_(self.oHeader.iX+self.oHeader.iWidth-22+ZC.MAPTX+oShape.iOffsetX) + ',' + ZC._i_(self.oHeader.iY+self.oHeader.iHeight+ZC.MAPTX+oShape.iOffsetY);
				} else {
					sArea += ZC._i_(self.oHeader.iX+self.oHeader.iWidth-22+ZC.MAPTX+oShape.iOffsetX) + ',' + ZC._i_(self.oHeader.iY+ZC.MAPTX+oShape.iOffsetY) + ',' + ZC._i_(self.oHeader.iX+self.oHeader.iWidth-1+ZC.MAPTX+oShape.iOffsetX) + ',' + ZC._i_(self.oHeader.iY+self.oHeader.iHeight+ZC.MAPTX+oShape.iOffsetY);
				}
				sArea += '" />';
				
			}

			if (sArea !== '' && (mValue=ZC._id_(self.oParent.oParent.sId + '-map'))) {
				
				mValue.innerHTML = sArea + mValue.innerHTML;
			}

			self.iDiffX = 0;
			self.iDiffY = 0;
			
			self.zc_legend_mouseover = function(ev){
				self.bHoverLegend = true;
			};
			
			self.zc_legend_mouseout = function(ev){
				self.bHoverLegend = false;
			};
			
			self.zc_legend_mousescroll = function(ev){
				if (self.oScroll && self.oScroll.sType === 'scroll-y'){
					ev.preventDefault();
					self.oScroll.zc_scroll_bar_scroll(ev);
				}
			};
			
			self.zc_legend_mousedown = function(ev) {
				ev.preventDefault();
				self.oLoader.hideCM();
				ZC.move = true;
				if (!ZC.mobile && ev.which > 1) { return; }
				self.oParent.oParent.oAttributes['graph-' + self.oParent.sId + '-legend-info'] = null;
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + self.oParent.oParent.sId + '-top').offset();
				self.iDiffX = aPageXY[0] - oOffset.left - self.oHeader.iX;
				self.iDiffY = aPageXY[1] - oOffset.top - self.oHeader.iY;
				self.oldcursor = document.body.style.cursor;
				document.body.style.cursor = 'move';
				ZC.ZCQuery(document.body).bind(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_mousemove);
				ZC.ZCQuery(document.body).bind(ZC.ZCHtmlUtils._event_('mouseup'), self.zc_legend_mouseup);
			};

			self.zc_legend_mousemove = function(ev) {
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + self.oParent.oParent.sId + '-top').offset();
				var iX = aPageXY[0] - oOffset.left - self.iDiffX;
				var iY = aPageXY[1] - oOffset.top - self.iDiffY;
				iX = ZC._max_(iX, self.oParent.iX + 2);
				iX = ZC._min_(iX, self.oParent.iX + self.oParent.iWidth - self.iWidth - 2);
				iY = ZC._max_(iY, self.oParent.iY + 2);
				iY = ZC._min_(iY, self.oParent.iY + self.oParent.iHeight - self.iHeight - 4);
				self.oData['x'] = iX;
				self.oData['y'] = iY;
				
				self.oData['position'] = null;
				self.clear(true);
				self.parse();
				self.paint();
			};

			self.zc_legend_mouseup = function() {
				ZC.move = false;
				document.body.style.cursor = self.oldcursor;
				delete self.oldcursor;
				ZC.ZCQuery(document.body).unbind(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_mousemove);
				ZC.ZCQuery(document.body).unbind(ZC.ZCHtmlUtils._event_('mouseup'), self.zc_legend_mouseup);
				self.clear(false);
				self.parse();
				self.paint();
				self.saveInfo();
			};

			self.zc_legend_page_click = function(ev) {
				self.oAttributes['default-width'] = null;
				var sTargetId = ev.targetid || ev.target.id;
				if (sTargetId.indexOf('-page-next-area') !== -1) {
					self.oPageInfo.min += self.iMaxItems;
					self.oPageInfo.max += self.iMaxItems;
					self.oPageInfo.page += 1;
				} else {
					self.oPageInfo.min -= self.iMaxItems;
					self.oPageInfo.max -= self.iMaxItems;
					self.oPageInfo.page -= 1;
				}
				self.saveInfo();
				self.clear(false);
				self.parse();
				self.paint();
			};

			self.zc_legend_toggle = function() {
				
				var sCall = self.bCollapsed?'legendmaximize':'legendminimize';
				zingchart.exec(self.oParent.oLoader.sId, sCall);
				
			};

			self.zc_legend_item_mousemove = function(ev) {
				ZC.move = true;
				var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
				var oOffset = ZC.ZCQuery('#' + self.oParent.oParent.sId + '-top').offset();
				var iX = aPageXY[0] - oOffset.left;
				var iY = aPageXY[1] - oOffset.top;
				self.oAttributes['dragged-x'] = iX;
				self.oAttributes['dragged-y'] = iY;
				self.saveInfo();
				self.clear(false);
				self.parse();
				self.paint();
			};

			self.zc_legend_item_mousedown = function(ev) {
				ev.preventDefault();
				self.oLoader.hideCM();
				self.sCursor = document.body.style.cursor;
				document.body.style.cursor = 'move';
				if (!ZC.mobile && ev.which > 1) { return; }
				var aMatches = (new RegExp('\-legend\-item\_([0-9]+)\-area', 'g')).exec(ev.target.id);
				if (aMatches) {
					self.oAttributes['dragged-offset-y'] = 0;
				    self.oAttributes['calculate-y'] = true;
					self.oAttributes['dragged-x'] = 0;
				    self.oAttributes['dragged-y'] = 0;
					self.iDragIndex = ZC._i_(aMatches[1]);
					ZC.ZCQuery(document.body).bind(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_item_mousemove);
					ZC.ZCQuery(document.body).bind(ZC.ZCHtmlUtils._event_('mouseup'), self.zc_legend_item_mouseup);
				}
			};

			self.zc_legend_item_mouseup = function() {
				var iDragIndex = self.iDragIndex;
				self.iDragIndex = -1;
				self.oAttributes['calculate-y'] = false;
				document.body.style.cursor = self.sCursor;
				if (!ZC.move){
					iDragIndex = -1;
				}
				ZC.ZCQuery(document.body).unbind(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_item_mousemove);
				ZC.ZCQuery(document.body).unbind(ZC.ZCHtmlUtils._event_('mouseup'), self.zc_legend_item_mouseup);
				if (ZC.move) {
					
					if (iDragIndex !== -1){

						var aPlots = self.oParent.oPlotSet.aPlots;
	
						for (var p=0,pLen=aPlots.length;p<pLen;p++) {
							aPlots[p].oData['legend-item'] = aPlots[p].oData['legend-item'] || {};
							if (ZC._n_(aPlots[p].oData['legend-item']['order']) === null) {
								aPlots[p].oData['legend-item']['order'] = p+1;
							}
						}
	
						var iDropIndex = -1;
						for (var m=0,mLen=self.aMarkers.length;m<mLen;m++) {
							if ((self.oAttributes['dragged-y'] - self.oAttributes['dragged-offset-y']/2) > self.aMarkers[m].iY) {
								iDropIndex = m;
							}
						}
						if (iDropIndex === -1) {
							aPlots[iDragIndex].oData['legend-item']['order'] = 1;
						} else {
							aPlots[iDragIndex].oData['legend-item']['order'] = aPlots[iDropIndex].oData['legend-item']['order'] + 1;
						}
	
						for (m=0,mLen=self.aMarkers.length;m<mLen;m++) {
							if (iDropIndex > iDragIndex) {
								if (m >= iDragIndex && m <= iDropIndex) {
									aPlots[m].oData['legend-item']['order']--;
								}
							} else if (iDropIndex < iDragIndex) {
								if (m > iDropIndex && m < iDragIndex) {
									aPlots[m].oData['legend-item']['order']++;
								}
							}
						}
	
						for (m=0,mLen=self.aMarkers.length;m<mLen;m++) {
							self.oParent.oData['series'][m]['z-index'] = aPlots[m].oData['legend-item']['order'];
						}
					}
				}

				ZC.move = false;
				self.clear(false);
				self.oParent.repaint();

				
			};

			ZC.ZCQuery('#' + self.sId + '-legend-frame').live('DOMMouseScroll mousewheel', self.zc_legend_mousescroll);
			ZC.ZCQuery('#' + self.sId + '-legend-frame').live(ZC.ZCHtmlUtils._event_('mouseover'), self.zc_legend_mouseover);
			ZC.ZCQuery('#' + self.sId + '-legend-frame').live(ZC.ZCHtmlUtils._event_('mouseout'), self.zc_legend_mouseout);
			ZC.ZCQuery('#' + self.sId + '-move-area').live(ZC.ZCHtmlUtils._event_('mousedown'), self.zc_legend_mousedown);
			ZC.ZCQuery('#' + self.sId + '-minimize-area').live(ZC.ZCHtmlUtils._event_('click'), self.zc_legend_toggle);
			ZC.ZCQuery('.' + self.sId + '-page-area').live(ZC.ZCHtmlUtils._event_('click'), self.zc_legend_page_click);
			if (self.oItem.oData['reorder']) {
				ZC.ZCQuery('.' + self.oParent.sId + '-legend-item-area').live('mousedown', self.zc_legend_item_mousedown);
			}
		}

		self.oAttributes['showhide'] = null;
	}
});










ZC.ZCArrow = ZC.ZCShape.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.fAlphaArea = 1;
		self.oFrom = null;
		self.oTo = null;
		self.oLabel = null;
		self.iZIndex = 0;
		self.oShape = null;
	},
	parse : function() {
		var self = this, mValue;
		self.assign_a([
			['alpha-area', 'fAlphaArea', 'f'],
			['z-index', 'iZIndex', 'i']
		]);
		if (ZC._n_(mValue=self.oData['from']) !== null) {
			self.oFrom = new ZC.ZCShape(self.oParent);
			self.oFrom.append(mValue);
			if (mValue['hook'] !== null) {
				self.oFrom.oAttributes['hook'] = mValue['hook'];
			}
			self.oFrom.parse();
			
			if (typeof(mValue) === 'string') {
				self.oFrom.oAttributes['hook'] = mValue;
			}
		}
		if (ZC._n_(mValue=self.oData['to']) !== null) {
			self.oTo = new ZC.ZCShape(self.oParent);
			self.oTo.append(mValue);
			if (mValue['hook'] !== null) {
				self.oTo.oAttributes['hook'] = mValue['hook'];
			}
			self.oTo.parse();
			
			if (typeof(mValue) === 'string') {
				self.oTo.oAttributes['hook'] = mValue;
			}
		}
		if ((ZC._n_(mValue=self.oData['label']) !== null) || (self.oData['text'] !== '' && typeof(self.oData['text']) !== 'undefined')) {
			self.oLabel = new ZC.ZCTextBox(self);
			self.oLabel.append(self.oData);
			self.oLabel.append(mValue);
			self.oLabel.parse();
		}
		self._super();
	},
	paint : function() {
		var self = this, mValue, aHook;
		if (!self.bVisible) { return; }
		if (self.oFrom === null || self.oTo === null) { return; }
		if (self.iSize < 2) {
			self.iSize = 2;
		}
		if (ZC._n_(mValue=self.oFrom.oAttributes['hook']) !== null) {
			aHook = self.oParent.getHookXY(mValue);
			self.oFrom.iX = aHook[0];
			self.oFrom.iY = aHook[1];
		}
		if (ZC._n_(mValue=self.oTo.oAttributes['hook']) !== null) {
			aHook = self.oParent.getHookXY(mValue);
			self.oTo.iX = aHook[0];
			self.oTo.iY = aHook[1];
		}
		self.oFrom.iX += self.oFrom.iOffsetX;
		self.oFrom.iY += self.oFrom.iOffsetY;
		self.oTo.iX += self.oTo.iOffsetX;
		self.oTo.iY += self.oTo.iOffsetY;
		var aFrom = [self.oFrom.iX, self.oFrom.iY];
		var aTo = [self.oTo.iX, self.oTo.iY];
		var iDx = aTo[0] - aFrom[0];
		var iDy = aTo[1] - aFrom[1];
		var iAngle = ZC._deg_(Math.atan2(iDy, iDx));
		var iLength = Math.sqrt(iDx*iDx + iDy*iDy);
		var aPoint, aPoints = [];
		aPoints.push(aFrom);
		aPoint = ZC.ZCMath._cpoint_(aFrom[0], aFrom[1], self.iSize, iAngle + 90);
		aPoints.push(aPoint);
		aPoint = ZC.ZCMath._cpoint_(aPoint[0], aPoint[1], (iLength-4*self.iSize), iAngle);
		aPoints.push(aPoint);
		aPoint = ZC.ZCMath._cpoint_(aPoint[0], aPoint[1], 2*self.iSize, iAngle + 90);
		aPoints.push(aPoint);
		aPoints.push(aTo);
		aPoint = ZC.ZCMath._cpoint_(aPoint[0], aPoint[1], 6*self.iSize, iAngle - 90);
		aPoints.push(aPoint);
		aPoint = ZC.ZCMath._cpoint_(aPoint[0], aPoint[1], 2*self.iSize, iAngle + 90);
		aPoints.push(aPoint);
		aPoint = ZC.ZCMath._cpoint_(aFrom[0], aFrom[1], self.iSize, iAngle - 90);
		aPoints.push(aPoint);
		aPoints.push(aFrom);

		self.oShape = new ZC.ZCShape(self.oParent);
		self.oShape.sId = self.sId;
		self.oShape.oCanvas = self.oShape.oCanvasSh = self.oCanvas;
		self.oShape.copy(self);
		self.oShape.aPoints = aPoints;
		self.oShape.bPixelCorrection = false;
		self.oShape.parse();
		self.oShape.fAlpha = self.fAlphaArea;
		self.oShape.paint();

		if (self.oLabel !== null && self.oLabel.bVisible) {
			self.oLabel.oCanvas = self.oCanvas;
			self.oLabel.sId = self.oParent.sId + '-arrow-label-' + self.sObjectId;
			self.oLabel.sDOMClass = self.oParent.sId + '-arrow-label zc-arrow-label';
			var aMP = ZC.ZCMath._mpoint_(aFrom[0], aFrom[1], aTo[0], aTo[1]);
			self.oLabel.iX = aMP[0];
			self.oLabel.iY = aMP[1];
			self.oLabel.iOffsetX -= self.oLabel.iWidth/2;
			self.oLabel.iOffsetY -= self.oLabel.iHeight/2;
			if (ZC._n_(self.oLabel.oData['font-angle']) !== null && self.oLabel.oData['font-angle'] === 'inherit') {
				self.oLabel.iAngle = iAngle;
			}
			self.oLabel.paint();
			self.oLabel.paintPrintVersion();
		}

	}
});














ZC.ZCGuide = ZC.Class.extend({
	init : function(oLoader) {
		var self = this;
		self.oLoader = oLoader;
		self.bOver = false;
		self.iTick = null;
		self.zc_guide_mousemove = null;
	},
	unbind : function() {
		var self = this;
		if (self.iTick) {
			window.clearInterval(self.iTick);
		}
		ZC.ZCQuery(document.body).unbind('mousemove touchstart touchmove', self.zc_guide_mousemove);
	},
	clear : function() {
		var self = this;
		var sId = self.oLoader.sId;
		var oGuideCanvas = ZC._id_(sId + '-guide-c');
		
		var iGuideWidth = ZC.ZCQuery(oGuideCanvas).width();
		var iGuideHeight = ZC.ZCQuery(oGuideCanvas).height();
		if (ZC._n_(ZC.sLastGuideId) !== null && ZC.sLastGuideId !== oGuideCanvas.id && ZC._id_(ZC.sLastGuideId)) {
			ZC.ZCHtmlUtils._clear_(ZC._id_(ZC.sLastGuideId), self.oLoader.sOutput, 0, 0, ZC.ZCQuery('#'+ZC.sLastGuideId).width(), ZC.ZCQuery('#'+ZC.sLastGuideId).height());
		}
		ZC.sLastGuideId = oGuideCanvas.id;
		ZC.ZCQuery('.zc-guide-label').remove();
		ZC.ZCHtmlUtils._clear_(oGuideCanvas, self.oLoader.sOutput, 0, 0, iGuideWidth, iGuideHeight);
		
		if (self.oLoader.sOutput === 'svg') {
			ZC.ZCQuery('#' + self.oLoader.sId + '-defs').children().each(function() {
				if (this.id.indexOf('-guide-label-') === 0) {
					ZC.ZCHtmlUtils._remove_(this.id);
				}
			});
		}
	},
	bind : function() {
		var self = this, mValue;
		var sId = self.oLoader.sId;
		var oGuideCanvas = ZC._id_(sId + '-guide-c');
		var oGuideCtx = ZC.ZCHtmlUtils._context_(oGuideCanvas, self.oLoader.sOutput);
		var iGuideWidth = 0;
		var iGuideHeight = 0;

		var oIndexCache = {}, oItemsCache = {}, oScaleItemsCache = {}, oBoxNodeHash = {};

		if (!ZC.mobile && ZC._n_(ZC.iGuideTick) === null) {
			ZC.iGuideTick = window.setInterval(function() {
				var bOut = true;
				for (var i=0,iLen=zingchart.aLoaders.length;i<iLen;i++) {
					if (ZC._id_(zingchart.aLoaders[i].sId + '-top')) {
						var oOffset = ZC.ZCQuery('#' + zingchart.aLoaders[i].sId + '-top').offset();
						if (ZC.aPageXY[0] >= oOffset.left && ZC.aPageXY[0] <= oOffset.left + zingchart.aLoaders[i].iWidth && ZC.aPageXY[1] >= oOffset.top && ZC.aPageXY[1] <= oOffset.top + zingchart.aLoaders[i].iHeight) {
							bOut = false;
						}
					} else {
						window.clearInterval(ZC.iGuideTick);
						ZC.iGuideTick = null;
					}
				}
				if (bOut) {
					_clear_guide_(true);
				}
			}, 500);
		}

		var oActiveGraph = null;
		var oLastActiveGraph = null;

		function _clear_guide_(bOut) {
			if (iGuideWidth === 0 || iGuideHeight === 0) {
				iGuideWidth = ZC.ZCQuery(oGuideCanvas).width();
				iGuideHeight = ZC.ZCQuery(oGuideCanvas).height();
			}
			if (ZC._n_(ZC.sLastGuideId) !== null && ZC.sLastGuideId !== oGuideCanvas.id && ZC._id_(ZC.sLastGuideId)) {
				ZC.ZCHtmlUtils._clear_(ZC._id_(ZC.sLastGuideId), self.oLoader.sOutput, 0, 0, ZC.ZCQuery('#'+ZC.sLastGuideId).width(), ZC.ZCQuery('#'+ZC.sLastGuideId).height());
			}
			ZC.sLastGuideId = oGuideCanvas.id;
			ZC.ZCQuery('.zc-guide-label').remove();
			ZC.ZCHtmlUtils._clear_(oGuideCanvas, self.oLoader.sOutput, 0, 0, iGuideWidth, iGuideHeight);
			
			if (self.oLoader.sOutput === 'svg' && oActiveGraph) {
				ZC.ZCQuery('#' + self.oLoader.sId + '-defs').children().each(function() {
					if (this.id.indexOf(oActiveGraph.sId + '-guide-label-') === 0) {
						ZC.ZCHtmlUtils._remove_(this.id);
					}
				});
			}
			oActiveGraph = null;
		}

		self.zc_guide_mousemove = function(ev) {

			var i, iLen, iX, iY, oPlotArea, iIndex, oPlotNode, oBox_, oBox, oBoxScale_, oBoxScale, oFormat, iLineRefX, iRefX, iRefY, p, pLen, oPoint3D, oGuideStyle;

			
			for (i=0;i<zingchart.aLoaders.length;i++) {
				if (zingchart.aLoaders[i].sId !== self.oLoader.sId && zingchart.aLoaders[i].sId.indexOf('-fullscreen') !== -1) {
					return;
				}
			}

			if (ev.type === 'mousemove' && ZC.TOUCHEVENTS) {
				return;
			}

			
			if (ev.target.id.indexOf(self.oLoader.sId+'-') === -1) {
				return;
			}

			if (ZC.move && !ZC.mobile) { return; }
			if (self.oLoader.bProgressOn || !ZC._id_(sId + '-top')) {
				return false;
			}

			
			if (!ZC.ZCHtmlUtils._visible_(ZC._id_(sId + '-top'))) {
				return false;
			}

			var aGraphs = [];

			var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev), iPageX = aPageXY[0], iPageY = aPageXY[1];
			if (ZC._n_(ev._pageX_) !== null) {
				iPageX = ev._pageX_;
			} 
			if (ZC._n_(ev._pageY_) !== null) {
				iPageY = ev._pageY_;
			} 
			if (ZC._n_(ev._pageX_) === null && ZC._n_(ev._pageY_) === null) {
				var oOffset = ZC.ZCQuery('#' + sId + '-top').offset();
				iX = iPageX - oOffset.left;
				iY = iPageY - oOffset.top;
			} else {
				iX = iPageX;
				iY = iPageY;
			}

			for (i=0,iLen=self.oLoader.aGraphs.length;i<iLen;i++) {
				oPlotArea = self.oLoader.aGraphs[i].oPlotArea;
				if (
					ZC._btw_(iX, oPlotArea.iX-15, oPlotArea.iX+oPlotArea.iWidth+15)
					&&
					ZC._btw_(iY, oPlotArea.iY-15, oPlotArea.iY+oPlotArea.iHeight+15)
				) {
					oActiveGraph = self.oLoader.aGraphs[i];
				}
			}

			var iActivePlot = null;
			var bActiveGuideShared = false;
			if (oActiveGraph) {
				oLastActiveGraph = oActiveGraph;

				if (oActiveGraph.oCrosshairX && oActiveGraph.oCrosshairX.oData['trigger'] === 'hover') {
					if (ZC._n_(oActiveGraph.oAttributes['guide-active-plot']) !== null) {
						iActivePlot = oActiveGraph.oAttributes['guide-active-plot'];
					}
					var aMatches = /(.+)-plotset-plot-(.+)-node-(.+)/.exec(ev.target.id);
					if (aMatches && aMatches.length) {
						iActivePlot = parseInt(aMatches[2], 10);
						oActiveGraph.oAttributes['guide-active-plot'] = iActivePlot;
					}
					if (ZC._n_(iActivePlot) === null) {
						return;
					}
				}

				if (!oActiveGraph.bGuideOn) {
					_clear_guide_();
					return;
				}

				aGraphs.push(oActiveGraph);
				if (oActiveGraph && oActiveGraph.oCrosshairX) {
					bActiveGuideShared = (ZC._n_(oActiveGraph.oCrosshairX.oData['shared']) !== null && ZC._b_(oActiveGraph.oCrosshairX.oData['shared']));
				}
				for (i=0,iLen=self.oLoader.aGraphs.length;i<iLen;i++) {
					if (self.oLoader.aGraphs[i] !== oActiveGraph) {
						oPlotArea = self.oLoader.aGraphs[i].oPlotArea;
						var oCrosshairX = self.oLoader.aGraphs[i].oCrosshairX;
						var oCrosshairY = self.oLoader.aGraphs[i].oCrosshairY;
						var bGuideShared = (oCrosshairX && ZC._n_(oCrosshairX.oData['shared']) !== null && ZC._b_(oCrosshairX.oData['shared']));
						if (
							(
								oActiveGraph.oSettings['layout'] === 'xy'
								&&
								(oCrosshairX || oCrosshairY)
								&&
								ZC._btw_(iX, oPlotArea.iX-5, oPlotArea.iX+oPlotArea.iWidth+5)
								&&
								(ZC._btw_(iY, oPlotArea.iY-5, oPlotArea.iY+oPlotArea.iHeight+5) || (bActiveGuideShared && bGuideShared))
							)
							||
							(
								oActiveGraph.oSettings['layout'] === 'yx'
								&&
								(oCrosshairX || oCrosshairY)
								&&
								ZC._btw_(iY, oPlotArea.iY-5, oPlotArea.iY+oPlotArea.iWidth+5)
								&&
								(ZC._btw_(iY, oPlotArea.iY-5, oPlotArea.iY+oPlotArea.iHeight+5) || (bActiveGuideShared && bGuideShared))
							)
						) {
							aGraphs.push(self.oLoader.aGraphs[i]);
						}
					}
				}
			}

			if (aGraphs.length === 0) {
				oIndexCache = {};
				oItemsCache = {};
				oScaleItemsCache = {};
				if (self.bOver) {
					if (ZC._n_(ev._pageX_) === null) {
						_clear_guide_();
					}
					self.bOver = false;
				}
				if (oLastActiveGraph && oLastActiveGraph.oParent.oTooltip) {
					oLastActiveGraph.oParent.oTooltip.hide();
				}
			}

			if (aGraphs.length > 0) {
				self.bOver = true;
				var bCleared = false;
				for (var g=0,gLen=aGraphs.length;g<gLen;g++) {

					var bChange = false;
					if (ZC._n_(oIndexCache[g]) === null) {
						oIndexCache[g] = {};
					}
					if (ZC._n_(oItemsCache[g]) === null) {
						oItemsCache[g] = {};
					}
					if (ZC._n_(oScaleItemsCache[g]) === null) {
						oScaleItemsCache[g] = {};
					}

					if ((aGraphs[g].oCrosshairX || aGraphs[g].oCrosshairY) && aGraphs[g].sStage === 'ready') {
						var aEventInfo = [];
						var aItems = [], aItemsText = [];
						var aCrosshairXPoints = [], aCrosshairYPoints = [];
						var aScaleItems = [], aScales = [], oNodeInfo = {}, oLabelInfo = {}, oValidPlotNode;
						oPlotArea = aGraphs[g].oPlotArea;

						var bMultiple = true, sSingleText = '';
						if (aGraphs[g].oCrosshairX) {
							if (ZC._n_(aGraphs[g].oCrosshairX.oData['plot-label']) !== null && ZC._n_((mValue=aGraphs[g].oCrosshairX.oData['plot-label']['multiple']) !== null)) {
								bMultiple = ZC._b_(mValue);
							}
							if (ZC._n_(aGraphs[g].oCrosshairX.oData['value-label']) !== null && ZC._n_((mValue=aGraphs[g].oCrosshairX.oData['value-label']['multiple']) !== null)) {
								bMultiple = ZC._b_(mValue);
							}
						}

						for (i=0,iLen=aGraphs[g].oPlotSet.aPlots.length;i<iLen;i++) {
							if (aGraphs[g].oAttributes['plot' + i + '.visible']) {

								if (ZC._n_(iActivePlot) !== null && i !== iActivePlot) {
									continue;
								}

								var oScaleX = aGraphs[g].getScaleByName(aGraphs[g].oPlotSet.aPlots[i].getScales('k')[0]);
								if (oScaleX.bInversed) {
									var iScaleMinY = oScaleX.bMirrored?(oScaleX.iY+oScaleX.iOffsetEnd):(oScaleX.iY+oScaleX.iOffsetStart);
									var iScaleMaxY = oScaleX.bMirrored?(oScaleX.iY+oScaleX.iHeight-oScaleX.iOffsetEnd):(oScaleX.iY+oScaleX.iHeight-oScaleX.iOffsetStart);
									iY = ZC._l_(iY, iScaleMinY, iScaleMaxY);
									if (oScaleX.bKeyValues && aGraphs[g].oPlotSet.aPlots[i].bKeyValues) {
										iIndex = oScaleX.getIndexByCoord(iY, aGraphs[g].oPlotSet.aPlots[i]);
									} else {
										iIndex = oScaleX.getIndexByCoord(iY);
									}
								} else {
									var iScaleMinX = oScaleX.bMirrored?(oScaleX.iX+oScaleX.iOffsetEnd):(oScaleX.iX+oScaleX.iOffsetStart);
									var iScaleMaxX = oScaleX.bMirrored?(oScaleX.iX+oScaleX.iWidth-oScaleX.iOffsetStart):(oScaleX.iX+oScaleX.iWidth-oScaleX.iOffsetEnd);
									iX = ZC._l_(iX, iScaleMinX, iScaleMaxX);
									if (oScaleX.bKeyValues && aGraphs[g].oPlotSet.aPlots[i].bKeyValues) {
										iIndex = oScaleX.getIndexByCoord(iX, aGraphs[g].oPlotSet.aPlots[i]);
									} else {										
										iIndex = oScaleX.getIndexByCoord(iX);
									}
								}

								if (ZC._n_(iIndex) === null) {
									continue;
								}
								var aIndexes = [];
								if (typeof(iIndex.length) === 'undefined' || iIndex.length === 0) {
									aIndexes = [iIndex];
								} else {
									aIndexes = iIndex;
								}

								if (aGraphs[g].oCrosshairX) {

									for (var x=0,xLen=aIndexes.length;x<xLen;x++) {
										iIndex = aIndexes[x];

										oBox_ = null;
										oBoxScale_ = null;

										oPlotNode = aGraphs[g].oPlotSet.aPlots[i].getNode(iIndex);

										if (!oPlotNode) {
											continue;
										}
										oValidPlotNode = oPlotNode;

										oPlotNode.setup();

										
										if (oPlotNode.oStyle) {
											ZC.COLORS = [
												oPlotNode.oStyle.sColor, 
												oPlotNode.oStyle.sBackgroundColor1, 
												oPlotNode.oStyle.sBackgroundColor2, 
												oPlotNode.oStyle.sBorderColor, 
												oPlotNode.oStyle.sLineColor
											];
											if (oPlotNode.oStyleMarker) {
												ZC.COLORS.push(
													oPlotNode.oStyleMarker.sBackgroundColor1, 
													oPlotNode.oStyleMarker.sBackgroundColor2, 
													oPlotNode.oStyleMarker.sBorderColor, 
													oPlotNode.oStyleMarker.sLineColor
												);
											}
										} else {
											ZC.COLORS = [];
										}

										iLineRefX = oPlotNode.iX;
										iLineRefY = oPlotNode.iY;

										
										if (oPlotNode.oParent.bFast && typeof(oPlotNode.oAttributes['iGuideX']) !== 'undefined') {
											oPlotNode.paint(true);
										}

										iRefX = oPlotNode.iX;
										iRefY = oPlotNode.iY;

										if (typeof(oPlotNode.oAttributes['iGuideX']) !== 'undefined') {
											iRefX = parseInt(oPlotNode.oAttributes['iGuideX'], 10);
										}
										if (typeof(oPlotNode.oAttributes['iGuideY']) !== 'undefined') {
											iRefY = parseInt(oPlotNode.oAttributes['iGuideY'], 10);
										}

										oNodeInfo[i] = {
											index : iIndex,
											y : iRefY
										};

										if (aGraphs[g].oLegend && aGraphs[g].oLegend.bDynamicItems) {
											aGraphs[g].oLegend.clear(true);
											aGraphs[g].oLegend.parse();
											aGraphs[g].oLegend.paint(iIndex);
										}

										if (ZC._n_(oBox_) === null) {
											oBox = new ZC.ZCTextBox(oScaleX);
											oBox.oCanvas = oBox.oCanvasSh = oGuideCanvas;
											oBox.sId = aGraphs[g].sId + '-guide-label-' + iIndex + '-' + i;
											oBox.sDOMClass = aGraphs[g].sId + '-guide-label zc-guide-label';
											if (bMultiple) {
												oGuideStyle = oPlotNode.getGuideStyle();
												oBox.sBackgroundColor1 = oBox.sBackgroundColor2 = ZC.ZCUtils._darken_(oGuideStyle['background-color']);
												oBox.sColor = oGuideStyle['color'];
												oBox.sText = oPlotNode.oParent.sTooltipText;
											}

											
											

											if (!bMultiple) {
												oBox.append(aGraphs[g].oCrosshairX.oData['plot-label[single]']);
											}

											oBox.append(aGraphs[g].oCrosshairX.oData['plot-label']);
											oBox.append(aGraphs[g].oCrosshairX.oData['value-label']);
											oBox.append(aGraphs[g].oPlotSet.aPlots[i].oData['guide-label']);

											oFormat = ZC.ZCUtils._setup_format_(oBox.oData, aGraphs[g].oPlotSet.aPlots[i].oData);
											oBox.parseText = function(sText) {
												return oPlotNode?oPlotNode.parseText(sText, oFormat):sText;
											};
											oPlotNode.setUpdate();
											var sPlacement = 'auto';
											if (ZC._n_(mValue=oBox.oData['placement']) !== null) {
												sPlacement = mValue;
											}
											oBox.oAttributes['placement'] = sPlacement;
											oBox.bCallout = bMultiple;
											oBox.oAttributes['plotidx'] = oPlotNode.oParent.iIndex;
											oBox.oAttributes['nodeidx'] = oPlotNode.iIndex;
											oBox.parse();

											if (oBox.aRules && oBox.aRules.length) {
												oBox.parseRule = function(sRule) {
													sRule = sRule.replace(/(%i)|(%node-index)/g, iIndex);
													return sRule;
												};

												if (oBox.applyRules()) {
													oBox.parse();
												}
											}

											if (!bMultiple) {
												if (aItems.length === 0) {
													if (ZC._n_(oBox.oData['header-text']) !== null) {
														sSingleText += oPlotNode.parseText(oBox.oData['header-text'], oFormat) + '<br/>';
													}
												}

												if (oBox.bVisible) {
													if (oBox.sText === '') {
														sSingleText += oPlotNode.parseText('<b style="color:%color">%plot-text:</b> %node-value', oFormat) + '<br/>';
													} else {
														sSingleText += oPlotNode.parseText(oBox.sText, oFormat) + '<br/>';
													}
												}
											}

											if (ZC._btw_(oPlotNode.iX, oPlotArea.iX, oPlotArea.iX+oPlotArea.iWidth)) {
												oBox.oAttributes['marker-x'] = iRefX;
												oBox.oAttributes['marker-y'] = iRefY;
												oBox.oAttributes['guide-style'] = oPlotNode.getGuideStyle();
												switch (sPlacement) {
													
													default:
														if (ZC._n_(oBox.oData['x']) === null) {
															if (oScaleX.bInversed) {
																if (oPlotNode.iY <= oPlotArea.iY + oPlotArea.iHeight/2) {
																	oBox.iY = iRefY - oBox.iHeight - 6;
																	oBox.sCalloutPosition = 'bottom';
																} else {
																	oBox.iY = iRefY + 6;
																	oBox.sCalloutPosition = 'top';
																}
															} else {
																if (oPlotNode.iX >= oPlotArea.iX + oPlotArea.iWidth/2) {
																	oBox.iX = iRefX - oBox.iWidth - 6;
																	oBox.sCalloutPosition = 'right';
																} else {
																	oBox.iX = iRefX + 6;
																	oBox.sCalloutPosition = 'left';
																}
															}
														} else {
															oBox.iX -= oPlotArea.iX;
														}
														if (ZC._n_(oBox.oData['y']) === null) {
															if (oScaleX.bInversed) {
																oBox.iX = iRefX - oBox.iWidth/2;
																if (oBox.iX < oPlotArea.iX) {
																	oBox.iX = oPlotArea.iX;
																}
																if (oBox.iX + oBox.iWidth > oPlotArea.iX + oPlotArea.iWidth) {
																	oBox.iX = oPlotArea.iX + oPlotArea.iWidth - oBox.iWidth;
																}
															} else {
																oBox.iY = iRefY - oBox.iHeight/2;
																if (oBox.iY < oPlotArea.iY) {
																	oBox.iY = oPlotArea.iY;
																}
																if (oBox.iY + oBox.iHeight > oPlotArea.iY + oPlotArea.iHeight) {
																	oBox.iY = oPlotArea.iY + oPlotArea.iHeight - oBox.iHeight;
																}
															}
														} else {
															oBox.iY -= oPlotArea.iY;
														}
														oBox.aCalloutHook = [iRefX, iRefY];
														break;
													case 'top':
														if (oScaleX.bInversed) {
															oBox.iX = oPlotArea.iX + oPlotArea.iWidth - oBox.iWidth;
															oBox.iY = iRefY - oBox.iHeight/2;
															oBox.sCalloutPosition = 'left';
															oBox.aCalloutHook = [oPlotArea.iX + oPlotArea.iWidth - oBox.iWidth - 6, iRefY];
														} else {
															oBox.iX = iRefX - oBox.iWidth/2;
															oBox.iY = oPlotArea.iY;
															oBox.sCalloutPosition = 'bottom';
															oBox.aCalloutHook = [iRefX, oBox.iY + oBox.iHeight + 6];
														}
														break;
													case 'node-top':
														if (oScaleX.bInversed) {
															oBox.iX = iRefX + 12;
															oBox.iY = iRefY - oBox.iHeight/2;
															oBox.sCalloutPosition = 'left';
															oBox.aCalloutHook = [iRefX + 6, iRefY];
														} else {
															oBox.iX = iRefX - oBox.iWidth/2;
															oBox.iY = iRefY - oBox.iHeight - 12;
															oBox.sCalloutPosition = 'bottom';
															oBox.aCalloutHook = [iRefX, iRefY - 6];
														}
														break;
													case 'bottom':
														if (oScaleX.bInversed) {
															oBox.iX = oPlotArea.iX;
															oBox.iY = iRefY - oBox.iHeight/2;
															oBox.sCalloutPosition = 'right';
															oBox.aCalloutHook = [oPlotArea.iX + oBox.iWidth + 6, iRefY];
														} else {
															oBox.iX = iRefX - oBox.iWidth/2;
															oBox.iY = oPlotArea.iY + oPlotArea.iHeight - oBox.iHeight;
															oBox.sCalloutPosition = 'top';
															oBox.aCalloutHook = [iRefX, oBox.iY - 6];
														}
														break;
												}

												aEventInfo.push({
													plotindex : oPlotNode.oParent.iIndex,
													nodeindex : oPlotNode.iIndex,
													keyvalue : oPlotNode.fKeyValue || oScaleX.aValues[oPlotNode.iIndex],
													value : oPlotNode.fValue,
													text : oBox.sText,
													x : oBox.iX,
													y : oBox.iY,
													refx : iRefX,
													refy : iRefY
												});												
												
												if (ZC._indexof_(aItemsText, oBox.sText) === -1) {
													oBoxNodeHash[oBox] = oPlotNode;
													
													aItemsText.push(oBox.sText);
												}
												aItems.push(oBox);

												oItemsCache[g][i] = oBox;
												bChange = true;
											}
										} else {
											aItems.push(oBox_);
										}

									}

									if (!oPlotNode) {
										continue;
									}
								}

								if (ZC._indexof_(aScales, oScaleX.sName) === -1 && aGraphs[g].oCrosshairX && ZC._btw_(oPlotNode.iX, oPlotArea.iX, oPlotArea.iX+oPlotArea.iWidth)) {
									if (ZC._n_(oBoxScale_) === null) {
										oBoxScale = new ZC.ZCTextBox(oScaleX);
										oBoxScale.oCanvas = oBoxScale.oCanvasSh = oGuideCanvas;
										oBoxScale.sId = aGraphs[g].sId + '-guide-scale-x-label-' + i;
										oBoxScale.sDOMClass = aGraphs[g].sId + '-guide-label zc-guide-label';
										oBoxScale.sBackgroundColor1 = oBoxScale.sBackgroundColor2 = oScaleX.sLineColor;
										oBoxScale.sColor = (aGraphs[g].oSettings['3d'])?'#999':'#fff';

										
										

										oBoxScale.append(aGraphs[g].oCrosshairX.oData['scale-label']);
										oBoxScale.append(aGraphs[g].oCrosshairX.oData[oScaleX.sName + '-label']);
										oBoxScale.bCallout = true;
										oBoxScale.oAttributes['nodeidx'] = oPlotNode.iIndex;
										oFormat = ZC.ZCUtils._setup_format_(oBoxScale.oData);
										oBoxScale.parseText = function(sText) {
											return oScaleX.parseText(sText, iIndex, (oScaleX.bKeyValues && aGraphs[g].oPlotSet.aPlots[i].bKeyValues)?aGraphs[g].oPlotSet.aPlots[i]:null, oFormat);
										};
										oBoxScale.parse();
										oLabelInfo[oScaleX.sName] = oBoxScale.sText;

										

										if (oScaleX.sPlacement !== 'opposite') {
											if (oScaleX.bInversed) {
												oBoxScale.sCalloutPosition = 'right';
												oBoxScale.iX = oScaleX.oAttributes['iX'] - oBoxScale.iWidth - 6;
												oBoxScale.aCalloutHook = [oScaleX.oAttributes['iX'], iLineRefY];
												oBoxScale.iY = iLineRefY - oBoxScale.iHeight/2;
											} else {
												oBoxScale.sCalloutPosition = 'top';
												oBoxScale.iY = oScaleX.oAttributes['iY'] + 6;
												oBoxScale.aCalloutHook = [iLineRefX, oScaleX.oAttributes['iY']];
												oBoxScale.iX = iLineRefX - oBoxScale.iWidth/2;
											}
										} else {
											if (oScaleX.bInversed) {
												oBoxScale.sCalloutPosition = 'left';
												oBoxScale.iX = oScaleX.oAttributes['iX'] + 6;
												oBoxScale.aCalloutHook = [oScaleX.oAttributes['iX'], iLineRefY];
												oBoxScale.iY = iLineRefY - oBoxScale.iHeight/2;
											} else {
												oBoxScale.sCalloutPosition = 'bottom';
												oBoxScale.iY = oScaleX.oAttributes['iY'] - oBoxScale.iHeight - 6;
												oBoxScale.aCalloutHook = [iLineRefX, oScaleX.oAttributes['iY']];
												oBoxScale.iX = iLineRefX - oBoxScale.iWidth/2;
											}
										}
										
										if (oBoxScale.bVisible && oBoxScale.sText !== '') {
											aScaleItems.push(oBoxScale);
											aScales.push(oScaleX.sName);
											oScaleItemsCache[g][i] = oBoxScale;
											bChange = true;
										}

										if (oScaleX.bInversed) {
											aCrosshairXPoints.push(
												null,
												[oScaleX.oAttributes['iX'], iLineRefY],
												[aGraphs[g].oPlotArea.iX + ((oScaleX.sPlacement === 'opposite')?0:aGraphs[g].oPlotArea.iWidth), iLineRefY]
											);
										} else {
											aCrosshairXPoints.push(
												null,
												[iLineRefX, oScaleX.oAttributes['iY']],
												[iLineRefX, aGraphs[g].oPlotArea.iY + ((oScaleX.sPlacement === 'opposite')?aGraphs[g].oPlotArea.iHeight:0)]
											);
										}
									} else {
										aScaleItems.push(oBoxScale_);
										aScales.push(oScaleX.sName);
									}

								}

								
								var oScaleY = aGraphs[g].getScaleByName(aGraphs[g].oPlotSet.aPlots[i].getScales('v')[0]);
								if (ZC._indexof_(aScales, oScaleY.sName) === -1 && aGraphs[g].oCrosshairY && ZC._btw_(iY, oPlotArea.iY, oPlotArea.iY+oPlotArea.iHeight)) {
									if (ZC._n_(oBoxScale_) === null) {

										var sType = 'single';
										if (aGraphs[g].oCrosshairY.oData['type'] && aGraphs[g].oCrosshairY.oData['type'] === 'multiple') {
											sType = 'multiple';
										}

										if (sType === 'multiple' && ZC._n_(oNodeInfo[i]) !== null) {
											if (oScaleY.bInversed) {
												iX = oNodeInfo[i]['x'];
											} else {
												iY = oNodeInfo[i]['y'];
											}
										}

										oBoxScale = new ZC.ZCTextBox(oScaleY);
										oBoxScale.oCanvas = oBoxScale.oCanvasSh = oGuideCanvas;
										oBoxScale.sId = aGraphs[g].sId + '-guide-scale-y-label-' + i;
										oBoxScale.sDOMClass = aGraphs[g].sId + '-guide-label zc-guide-label';

										var sBackgroundColor = oScaleY.sLineColor;
										if (sType === 'multiple') {
											sBackgroundColor = aGraphs[g].oPlotSet.aPlots[i].sLineColor;
										}
										oBoxScale.sBackgroundColor1 = oBoxScale.sBackgroundColor2 = sBackgroundColor;
										oBoxScale.sColor = (aGraphs[g].oSettings['3d'] && sType !== 'multiple')?'#999':'#fff';
										oBoxScale.append(aGraphs[g].oCrosshairY.oData['scale-label']);
										oBoxScale.append(aGraphs[g].oCrosshairY.oData[oScaleY.sName + '-label']);
										oBoxScale.bCallout = true;

										var sLabel = oScaleY.bInversed?oScaleY.getValueByCoord(iX, true):oScaleY.getValueByCoord(iY, true);
										oFormat = oScaleY.setupFormat();
										ZC._cp_(ZC.ZCUtils._setup_format_(oBoxScale.oData, oScaleY.oData), oFormat);

										
										if (ZC._n_(oFormat['decimals']) === null) {
											oFormat['decimals'] = 0;
										}

										sLabel = oScaleY.getParsedItemLabel(0, sLabel, oFormat);

										oBoxScale.oData['text'] = sLabel;
										oBoxScale.parse();
										
										oLabelInfo[oScaleY.sName] = oBoxScale.sText;

										
										if (oScaleY.sPlacement !== 'opposite') {
											if (oScaleY.bInversed) {
												oBoxScale.sCalloutPosition = 'top';
												oBoxScale.iX = iX - oBoxScale.iWidth/2;
												oBoxScale.iY = oScaleY.oAttributes['iY'] + 6;
												oBoxScale.aCalloutHook = [iX, oScaleY.oAttributes['iY']];
											} else {
												oBoxScale.sCalloutPosition = 'right';
												oBoxScale.iX = oScaleY.oAttributes['iX'] - oBoxScale.iWidth - 6;
												oBoxScale.iY = iY - oBoxScale.iHeight/2;
												oBoxScale.aCalloutHook = [oScaleY.oAttributes['iX'], iY];
											}
										} else {
											if (oScaleY.bInversed) {
												oBoxScale.sCalloutPosition = 'bottom';
												oBoxScale.iX = iX - oBoxScale.iWidth/2;
												oBoxScale.iY = oScaleY.oAttributes['iY'] - oBoxScale.iHeight - 6;
												oBoxScale.aCalloutHook = [iX, oScaleY.oAttributes['iY']];
											} else {
												oBoxScale.sCalloutPosition = 'left';
												oBoxScale.iX = oScaleY.oAttributes['iX'] + 6;
												oBoxScale.iY = iY - oBoxScale.iHeight/2;
												oBoxScale.aCalloutHook = [oScaleY.oAttributes['iX'], iY];
											}
										}

										if (oBoxScale.bVisible) {
											aScaleItems.push(oBoxScale);
											if (sType !== 'multiple' || ZC._n_(oNodeInfo[i]) === null) {
												aScales.push(oScaleY.sName);
											}
											oScaleItemsCache[g][i] = oBoxScale;
											bChange = true;
										}

										if (oScaleY.bInversed) {
											aCrosshairYPoints.push(
												null,
												[iX, oScaleY.oAttributes['iY']],
												[iX, aGraphs[g].oPlotArea.iY + ((oScaleY.sPlacement === 'opposite')?aGraphs[g].oPlotArea.iHeight:0)]
											);
										} else {
											aCrosshairYPoints.push(
												null,
												[oScaleY.oAttributes['iX'], iY],
												[aGraphs[g].oPlotArea.iX + ((oScaleY.sPlacement === 'opposite')?0:aGraphs[g].oPlotArea.iWidth), iY]
											);
										}
									} else {
										aScaleItems.push(oBoxScale_);
										aScales.push(oScaleY.sName);
									}

								}
							}
						}

						if (!bMultiple && aItems.length > 0) {
							if (sSingleText !== '') {
								aItems[0].oData['text'] = sSingleText.substring(0, sSingleText.length-5);
								aItems[0].parse();
							}
							if (ZC._n_(oBox.oData['x']) === null) {
								if (oScaleX.bInversed) {
									if (iX < aGraphs[g].iX + aGraphs[g].iWidth/2) {
										aItems[0].iX = iX + 20;
									} else {
										aItems[0].iX = iX - aItems[0].iWidth - 20;
									}
								} else {
									if (oValidPlotNode && oValidPlotNode.iX >= oPlotArea.iX + oPlotArea.iWidth/2) {
										aItems[0].iX = iRefX - aItems[0].iWidth - 6;
									}
								}
							} else {
								aItems[0].iX -= oPlotArea.iX;
							}
							if (ZC._n_(oBox.oData['y']) === null) {
								if (oScaleX.bInversed) {
									if (oValidPlotNode && oValidPlotNode.iY >= oPlotArea.iY + oPlotArea.iHeight/2) {
										aItems[0].iY = iRefY - aItems[0].iHeight - 6;
									}
								} else {
									if (iY < aGraphs[g].iY + aGraphs[g].iHeight/2) {
										aItems[0].iY = iY + 20;
									} else {
										aItems[0].iY = iY - aItems[0].iHeight - 20;
									}
								}
							} else {
								aItems[0].iY -= oPlotArea.iY;
							}
						}

						if (bChange) {

							if (!bCleared) {
								if (ZC._n_(ev._pageX_) === null) {
									_clear_guide_();
								}
								bCleared = true;
							}

							if (aCrosshairXPoints.length > 0) {
								if (aGraphs[g].oSettings['3d']) {
									aGraphs[g].setup3DView();
									for (p=0,pLen=aCrosshairXPoints.length;p<pLen;p++) {
										if (ZC._n_(aCrosshairXPoints[p]) !== null) {
											oPoint3D = new ZC.ZCPoint3D(aGraphs[g], aCrosshairXPoints[p][0] - ZC.ZCDraw3D.iViewX, aCrosshairXPoints[p][1] - ZC.ZCDraw3D.iViewY, 0);
											aCrosshairXPoints[p][0] = oPoint3D.aXY[0];
											aCrosshairXPoints[p][1] = oPoint3D.aXY[1];
										}
									}
								}
								aGraphs[g].oCrosshairX.sId = aGraphs[g].sId + '-crosshair-x';
								ZC.ZCLine.paint(oGuideCtx, aGraphs[g].oCrosshairX, aCrosshairXPoints);
							}							
							if (aCrosshairYPoints.length > 0) {
								if (aGraphs[g].oSettings['3d']) {
									aGraphs[g].setup3DView();
									for (p=0,pLen=aCrosshairYPoints.length;p<pLen;p++) {
										if (ZC._n_(aCrosshairYPoints[p]) !== null) {
											oPoint3D = new ZC.ZCPoint3D(aGraphs[g], aCrosshairYPoints[p][0] - ZC.ZCDraw3D.iViewX, aCrosshairYPoints[p][1] - ZC.ZCDraw3D.iViewY, 0);
											aCrosshairYPoints[p][0] = oPoint3D.aXY[0];
											aCrosshairYPoints[p][1] = oPoint3D.aXY[1];
										}
									}
								}
								ZC.ZCLine.paint(oGuideCtx, aGraphs[g].oCrosshairY, aCrosshairYPoints);
							}
							
							if (bMultiple) {

								if (aItems.length > 1) {
									var bNotSorted = true;
									while (bNotSorted) {
										bNotSorted = false;
										for (i=0;i<aItems.length-1;i++) {
											if (aItems[i].bVisible) {
												if (
													(oScaleY.bInversed && aItems[i].iX > aItems[i+1].iX)
													||
													(!oScaleY.bInversed && aItems[i].iY > aItems[i+1].iY)
												) {
													var oTmp = aItems[i];
													aItems[i] = aItems[i+1];
													aItems[i+1] = oTmp;
													bNotSorted = true;
												}
											}
										}
									}
								}
								if (aItems.length > 0) {
									var aUnmovable = [];
									var aFixed = [];
									for (i=0;i<aItems.length;i++) {
										if (ZC._n_(aItems[i].oData['x']) !== null && ZC._n_(aItems[i].oData['y']) !== null) {
											aFixed.push(aItems[i]);
										}
									}
									var bCollision = true;
									var iStep=0, iMaxSteps = aItems.length*aItems.length;
									while (bCollision && iStep<iMaxSteps) {
										iStep++;
										bCollision = false;
										for (i=0;i<aItems.length-1;i++) {
											if (aItems[i].bVisible && ZC._indexof_(aFixed, aItems[i]) === -1) {
												if (oScaleX.bInversed) {
													if (aItems[i+1].iX < aItems[i].iX + aItems[i].iWidth) {
														if ((aItems[i+1].iX - aItems[i].iWidth - 4 < oPlotArea.iX) && (ZC._indexof_(aUnmovable, aItems[i]) === -1)) {
															aUnmovable.push(aItems[i]);
															aItems[i].iX = oPlotArea.iX;
														}
														aItems[i+1].iX = aItems[i].iX + aItems[i].iWidth + 4;
														if (aItems[i+1].iX + aItems[i+1].iWidth > oPlotArea.iX + oPlotArea.iWidth) {
															var iDiff = aItems[i+1].iX - (oPlotArea.iX + oPlotArea.iWidth - aItems[i+1].iWidth);
															for (var j=0,jLen=aItems.length;j<jLen;j++) {
																if (aItems[j].iX - iDiff >= oPlotArea.iX) {
																	aItems[j].iX -= iDiff;
																} else {
																	aItems[j].iX = oPlotArea.iX;
																	if (j > 0) {
																		if (aItems[i+1].oAttributes['marker-y'] < oPlotArea.iY + oPlotArea.iHeight/2) {
																			aItems[j].iY = aItems[j-1].iY + aItems[j-1].iHeight + 4;
																		} else {
																			aItems[j].iY = aItems[j-1].iY - aItems[j].iHeight - 4;
																		}
																	}
																}
															}
														}
														bCollision = true;
													}
												} else {
													if (aItems[i+1].iY < aItems[i].iY + aItems[i].iHeight) {
														if ((aItems[i+1].iY - aItems[i].iHeight - 4 < oPlotArea.iY) && (ZC._indexof_(aUnmovable, aItems[i]) === -1)) {
															aUnmovable.push(aItems[i]);
															aItems[i].iY = oPlotArea.iY;
														}
														aItems[i+1].iY = aItems[i].iY + aItems[i].iHeight + 4;
														if (aItems[i+1].iY + aItems[i+1].iHeight > oPlotArea.iY + oPlotArea.iHeight) {
															var iDiff = aItems[i+1].iY - (oPlotArea.iY + oPlotArea.iHeight - aItems[i+1].iHeight);
															for (var j=0,jLen=aItems.length;j<jLen;j++) {
																if (aItems[j].iY - iDiff >= oPlotArea.iY) {
																	aItems[j].iY -= iDiff;
																} else {
																	aItems[j].iY = oPlotArea.iY;
																	if (j > 0) {
																		if (aItems[i+1].oAttributes['marker-x'] < oPlotArea.iX + oPlotArea.iWidth/2) {
																			aItems[j].iX = aItems[j-1].iX + aItems[j-1].iWidth + 4;
																		} else {
																			aItems[j].iX = aItems[j-1].iX - aItems[j].iWidth - 4;
																		}
																	}
																}
															}
														}
														bCollision = true;
													}
												}
											}
										}
									}
								}
							}

							for (i=0,iLen=aScaleItems.length;i<iLen;i++) {

								if (aGraphs[g].oSettings['3d']) {
									aGraphs[g].setup3DView();
									oPoint3D = new ZC.ZCPoint3D(aGraphs[g], aScaleItems[i].iX + aScaleItems[i].iWidth/2 - ZC.ZCDraw3D.iViewX, aScaleItems[i].iY + aScaleItems[i].iHeight/2 - ZC.ZCDraw3D.iViewY, 0);
									aScaleItems[i].iX = oPoint3D.aXY[0] - aScaleItems[i].iWidth/2;
									aScaleItems[i].iY = oPoint3D.aXY[1] - aScaleItems[i].iHeight/2;
									oPoint3D = new ZC.ZCPoint3D(aGraphs[g], aScaleItems[i].aCalloutHook[0] - ZC.ZCDraw3D.iViewX, aScaleItems[i].aCalloutHook[1] - ZC.ZCDraw3D.iViewY, 0);
									aScaleItems[i].aCalloutHook[0] = oPoint3D.aXY[0];
									aScaleItems[i].aCalloutHook[1] = oPoint3D.aXY[1];
								}

								aScaleItems[i].paint();
							}

							for (i=0,iLen=aItems.length;i<iLen;i++) {
								var bInside = (
									ZC._btw_(aItems[i].aCalloutHook[0], oPlotArea.iX - 5, oPlotArea.iX+oPlotArea.iWidth + 5)
									&&
									ZC._btw_(aItems[i].aCalloutHook[1], oPlotArea.iY - 5, oPlotArea.iY+oPlotArea.iHeight + 5)
								);
								if (
									!bMultiple
									||
									bInside
								) {
									if (aItems[i].bVisible) {
										switch (aItems[i].oAttributes['placement']) {
											case 'top':
												if (oScaleX.bInversed) {
													aItems[i].aCalloutHook[0] = aItems[i].iX - aItems[i].iCalloutHeight;
												} else {
													aItems[i].aCalloutHook[1] = aItems[i].iY + aItems[i].iHeight + aItems[i].iCalloutHeight;
												}
												break;
											case 'bottom':
												if (oScaleX.bInversed) {
													aItems[i].aCalloutHook[0] = aItems[i].iX + aItems[i].iWidth + aItems[i].iCalloutHeight;
												} else {
													aItems[i].aCalloutHook[1] = aItems[i].iY - aItems[i].iCalloutHeight;
												}
												break;
										}
										if (ZC._indexof_(['top','bottom'], aItems[i].oAttributes['placement']) !== -1) {
											var iCx = aItems[i].iX + aItems[i].iWidth/2;
											aItems[i].iX = ZC._max_(aItems[i].iX, 0);
											aItems[i].iX = ZC._min_(aItems[i].iX, self.oLoader.iWidth - aItems[i].iWidth);
											aItems[i].iY = ZC._max_(aItems[i].iY, 0);
											aItems[i].iY = ZC._min_(aItems[i].iY, self.oLoader.iHeight - aItems[i].iHeight);
											if (ZC._n_(aItems[i].oData['callout-offset']) === null) {
												aItems[i].iCalloutOffset = parseInt(100*(iCx - aItems[i].iX - aItems[i].iWidth/2)/(aItems[i].iWidth-aItems[i].iCalloutWidth), 10);
											}
										}

										if (aGraphs[g].oSettings['3d']) {
											aGraphs[g].setup3DView();
											oPoint3D = new ZC.ZCPoint3D(aGraphs[g], aItems[i].iX + aItems[i].iWidth/2 - ZC.ZCDraw3D.iViewX, aItems[i].iY + aItems[i].iHeight/2 - ZC.ZCDraw3D.iViewY, 0);
											aItems[i].iX = oPoint3D.aXY[0] - aItems[i].iWidth/2;
											aItems[i].iY = oPoint3D.aXY[1] - aItems[i].iHeight/2;
											oPoint3D = new ZC.ZCPoint3D(aGraphs[g], aItems[i].aCalloutHook[0] - ZC.ZCDraw3D.iViewX, aItems[i].aCalloutHook[1] - ZC.ZCDraw3D.iViewY, 0);
											aItems[i].aCalloutHook[0] = oPoint3D.aXY[0];
											aItems[i].aCalloutHook[1] = oPoint3D.aXY[1];
										}

										if (!bMultiple && i===0) {
											aItems[i].iX = ZC._max_(oPlotArea.iX-5, aItems[i].iX);
											aItems[i].iY = ZC._max_(oPlotArea.iY-5, aItems[i].iY);
											aItems[i].iX = ZC._min_(oPlotArea.iX+oPlotArea.iWidth-aItems[i].iWidth+5, aItems[i].iX);
											aItems[i].iY = ZC._min_(oPlotArea.iY+oPlotArea.iHeight-aItems[i].iHeight+5, aItems[i].iY);
										}

										if (bMultiple || (!bMultiple && i === 0)) {
											aItems[i].paint();
										}
									}

									if (bInside) {
										var oMarker = new ZC.ZCShape(self);
										self.oLoader.oDefaults.load(oMarker.oData, '(' + aGraphs[g].sType + ').guide.marker');
										oMarker.sId = aItems[i].sId + '-marker';
										oMarker.oCanvas = oMarker.oCanvasSh = oGuideCanvas;
										oMarker.iX = aItems[i].oAttributes['marker-x'];
										oMarker.iY = aItems[i].oAttributes['marker-y'];
										if (aGraphs[g].oSettings['3d']) {
											aGraphs[g].setup3DView();
											oPoint3D = new ZC.ZCPoint3D(aGraphs[g], oMarker.iX - ZC.ZCDraw3D.iViewX, oMarker.iY - ZC.ZCDraw3D.iViewY, 0);
											oMarker.iX = oPoint3D.aXY[0];
											oMarker.iY = oPoint3D.aXY[1];
										}
										oGuideStyle = aItems[i].oAttributes['guide-style'];
										oMarker.sBackgroundColor1 = oMarker.sBackgroundColor2 = ZC.ZCUtils._darken_(oGuideStyle['background-color']);
										oMarker.sBorderColor = oGuideStyle['color'];
										oMarker.append(aGraphs[g].oCrosshairX.oData['marker']);
										oMarker.append(aGraphs[g].oPlotSet.aPlots[aItems[i].oAttributes['plotidx']].oData['guide-marker']);
										oMarker.parse();
										if (oMarker.bVisible && oMarker.sShape !== 'none' && oMarker.iSize > 1) {
											oMarker.paint();
										}
									}
								}
							}

							var oEventInfo = aGraphs[g]._api_graph_info_();
							oEventInfo['items'] = aEventInfo;
							oEventInfo['guide'] = {x : iRefX, y : iRefY};
							oEventInfo['ev'] = ev;
							oEventInfo['scale-label'] = oLabelInfo;
							ZC.ZCUtils._trigger_event_('guide_mousemove', self.oLoader, oEventInfo);

							aGraphs[g].repaintObjects(true);

						}
					}
				}
			}
			
		};

		ZC.ZCQuery(document.body).bind('mousemove touchstart touchmove', self.zc_guide_mousemove);
	}
});

zingchart.extendAPI('setguide', function(sId, oParams) {
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var oLoader = zingchart.getLoader(sId);
	var oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
	var oScaleX = oGraph.getScaleByName('scale-x');
	var iX = oScaleX.getCoordByValue(oParams.keyvalue);
	var iY = oGraph.iY + oGraph.iHeight/2;
	var ev = {
		_pageX_ : iX,
		_pageY_ : iY,
		type : 'mousemove',
		target : {
			id : sId + '-img'
		}
	};
	oLoader.oGuide.zc_guide_mousemove(ev);
});










ZC.ZCCsvParser = ZC.Class.extend({
	init : function(oGraph, sCsvData) {
		var self = this;
		self.oData = null;
		self.oGraph = oGraph;
		self.sCsvData = sCsvData;
	},
	parse : function() {
		var self = this, mValue;
		self.oData = self.oGraph.oData;
		var sCsvData = self.sCsvData;
		var sLineSeparator = "\r\n";
		var sSeparator = ',';
		var bMirrored = false;
		var bTitle = null;
		var bHorizontalLabels = null;
		var bVerticalLabels = null;
		var bSmartScales = null;
		var bSeparateScales = null;
		var bKeyValFormat = false;
		var aColumns = null;
		var oDataCsv = {};
		var aCSV_, oRE, sField, i, iLen, r, rLen, c, cLen;
		if (ZC._n_(mValue=self.oData['html5-csv']) !== null) {
			oDataCsv = mValue;
		}
		if (ZC._n_(mValue=self.oData['csv']) !== null) {
			oDataCsv = mValue;
		}
		if (ZC._n_(mValue=oDataCsv['separator']) !== null) {
			sSeparator = mValue;
		}
		if (ZC._n_(mValue=oDataCsv['mirrored']) !== null) {
			bMirrored = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=oDataCsv['title']) !== null) {
			bTitle = ZC._b_(mValue);
		}
		if (bMirrored) {
			if (ZC._n_(mValue=oDataCsv['horizontal-labels']) !== null) {
				bVerticalLabels = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=oDataCsv['vertical-labels']) !== null) {
				bHorizontalLabels = ZC._b_(mValue);
			}
		} else {
			if (ZC._n_(mValue=oDataCsv['horizontal-labels']) !== null) {
				bHorizontalLabels = ZC._b_(mValue);
			}
			if (ZC._n_(mValue=oDataCsv['vertical-labels']) !== null) {
				bVerticalLabels = ZC._b_(mValue);
			}
		}
		if (ZC._n_(mValue=oDataCsv['smart-scales']) !== null) {
			bSmartScales = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=oDataCsv['separate-scales']) !== null) {
			bSeparateScales = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=oDataCsv['keyval-format']) !== null) {
			bKeyValFormat = ZC._b_(mValue);
		}
		if (ZC._n_(mValue=oDataCsv['columns']) !== null) {
			aColumns = mValue;
		}

		if (ZC._n_(aColumns) !== null && aColumns.length > 0) {
			aCSV_ = [];
			if (ZC._n_(mValue=oDataCsv['row-separator']) !== null) {
				sLineSeparator = mValue;
			} else {
				if (sCsvData.split(/\n/).length > 0) {
					sLineSeparator = "\n";
				} else if (sCsvData.split(/\r/).length > 0) {
					sLineSeparator = "\r";
				}
			}
			var aLines = sCsvData.split(sLineSeparator);
			var iRow = 0;
			for (i=0,iLen=aLines.length;i<iLen;i++) {
				if (aLines[i].replace(/\s+/g, '') !== '') {
					aCSV_[iRow] = [];
					var iPos = 0;
					var iCol = 0;
					while (iPos < aLines[i].length-1) {
						sField = aLines[i].substring(iPos, iPos + aColumns[iCol]);
						aCSV_[iRow].push(sField);
						iPos += aColumns[iCol];
						iCol++;
					}
					iRow++;
				}
			}
		} else {
			aCSV_ = [[]];
			if (ZC._n_(mValue=oDataCsv['row-separator']) !== null) {
				oRE = new RegExp(("(\\" + sSeparator + "|" + mValue + "|^)" + "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" + "([^\"\\" + sSeparator + "" + mValue + "]*))"), 'gi');
			} else {
				oRE = new RegExp(("(\\" + sSeparator + "|\\r?\\n|\\r|^)" + "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" + "([^\"\\" + sSeparator + "\\r\\n]*))"), 'gi');
			}
			var aMatches = null;
			while ((aMatches = oRE.exec(sCsvData))) {
				var sSeparator_ = aMatches[1];
				if (sSeparator_.length && (sSeparator_ !== sSeparator)) {
					aCSV_.push([]);
				}
				if (aMatches[2]) {
					sField = aMatches[2].replace(new RegExp("\"\"", "g"), "\"");
				} else {
					sField = aMatches[3];
				}
				aCSV_[aCSV_.length-1].push(sField);
			}
		}

		
		var aCSV = [];
		for (i=0,iLen=aCSV_.length;i<iLen;i++) {
			if (aCSV_[i].join('').replace(/\s+/g, '').length !== 0) {
				aCSV.push(aCSV_[i]);
			}
		}
		var iFirstDataRow = 0;
		var iFirstDataColumn = 0;
		
		if (ZC._n_(bTitle) === null || bTitle) {
			if (aCSV.length > 1 && aCSV[0].length === 1) {
				if (ZC._n_(self.oData['title']) === null) {
					self.oData['title'] = {'text' : aCSV[0][0]};
				} else if (ZC._n_(self.oData['title']['text']) === null) {
					self.oData['title']['text'] = aCSV[0][0];
				}
				bTitle = true;
			} else {
				bTitle = false;
			}
		}
		if (bTitle) {
			iFirstDataRow++;
		}

		if (bMirrored) {
			aCSV_ = [];
			if (bTitle) {
				aCSV_.push(aCSV[0]);
			}
			for (r=iFirstDataRow,rLen=aCSV.length;r<rLen;r++) {
				for (c=0,cLen=aCSV[r].length;c<cLen;c++) {
					if (ZC._n_(aCSV_[c+iFirstDataRow]) === null) {
						aCSV_[c+iFirstDataRow] = [];
					}
					aCSV_[c+iFirstDataRow].push(aCSV[r][c]);
				}
			}
			aCSV = aCSV_;
		}

		var iMaxElements = 0;
		for (i=0,iLen=aCSV.length;i<iLen;i++) {
			iMaxElements = ZC._max_(iMaxElements, aCSV[i].length);
		}

		
		var aHorizontalLabels = [];
		if (ZC._n_(bHorizontalLabels) === null) {
			var iColumnsFullLength = aCSV[iFirstDataRow].join('').length;
			var iColumnsAlphaLength = aCSV[iFirstDataRow].join('').replace(/[0-9]/g, '').length;
			if (iColumnsAlphaLength/iColumnsFullLength > 0.75) {
				bHorizontalLabels = true;
			} else {
				bHorizontalLabels = false;
			}
		}
		if (bHorizontalLabels) {
			aHorizontalLabels = aCSV[iFirstDataRow];
			iFirstDataRow++;
		}
		
		var aVerticalLabels = [];
		if (ZC._n_(bVerticalLabels) === null) {
			if (bHorizontalLabels && aHorizontalLabels[0].indexOf('\\') !== -1) {
				bVerticalLabels = true;
			} else {
				var sRows = '';
				for (r=iFirstDataRow,rLen=aCSV.length;r<rLen;r++) {
					sRows += aCSV[r][0];
				}
				var iRowsFullLength = sRows.length;
				var iRowsAlphaLength = sRows.replace(/[0-9]/g, '').length;
				if (iRowsAlphaLength/iRowsFullLength > 0.75) {
					bVerticalLabels = true;
				} else {
					bVerticalLabels = false;
				}
			}
		}
		if (bVerticalLabels) {
			for (r=iFirstDataRow,rLen=aCSV.length;r<rLen;r++) {
				if (bKeyValFormat) {
					aVerticalLabels.push(ZC._i_(aCSV[r][iFirstDataColumn]));
				} else {
					aVerticalLabels.push(aCSV[r][iFirstDataColumn]);
				}
			}
			iFirstDataColumn++;
		}

		var aSeriesInfo = [];
		var aSeries = [];
		for (c=iFirstDataColumn;c<iMaxElements;c++) {
			aSeries[c-iFirstDataColumn] = [];
			var sThSep = null;
			var sDecSep = null;
			var iDec = 0;
			var sFormat = null;
			for (r=iFirstDataRow,rLen=aCSV.length;r<rLen;r++) {
				if (ZC._n_(aCSV[r][c]) !== null && aCSV[r][c] !== '' && typeof(aCSV[r][c]) !== 'undefined') {
					sField = aCSV[r][c];
					
					if (ZC._n_(sFormat) === null) {
						sFormat = sField.replace(/[0-9\-\,\.\+\e]+/g, '%v');
					}
					sField = sField.replace(/[^0-9\-\,\.\+\e]+/g, '');
					var iDotPos = sField.indexOf('.');
					var iComPos = sField.indexOf(',');
					if (iDotPos !== -1 && iComPos !== -1) {
						if (iDotPos < iComPos) {
							sThSep = '.';
							sDecSep = ',';
							iDec = ZC._max_(0, sField.length-iComPos);
						} else {
							sThSep = ',';
							sDecSep = '.';
							iDec = ZC._max_(0, sField.length-iDotPos);
						}
					} else if (iDotPos === -1 && iComPos !== -1) {
						if (sField.length-iComPos-1 === 3) {
							sThSep = ',';
							sDecSep = '.';
						} else {
							sThSep = '.';
							sDecSep = ',';
							iDec = ZC._max_(0, sField.length-iComPos);
						}
					} else if (iDotPos !== -1 && iComPos === -1) {
						if (sField.length-iDotPos-1 === 3) {
							sThSep = '.';
							sDecSep = ',';
						} else {
							sThSep = ',';
							sDecSep = '.';
							iDec = ZC._max_(0, sField.length-iDotPos);
						}
					}
					if (sThSep === '.') {
						sField = sField.replace(/\./g, '').replace(/,/g, '.');
					}
					if (sThSep === ',') {
						sField = sField.replace(/,/g, '');
					}
					if (isNaN(ZC._f_(sField))) {
						var iAssoc = ZC._indexof_(self.oGraph.aValAssoc, sField);
						if (iAssoc !== -1) {
							aSeries[c-iFirstDataColumn].push(iAssoc);
						} else {
							self.oGraph.aValAssoc.push(sField);
							aSeries[c-iFirstDataColumn].push(self.oGraph.aValAssoc.length-1);
						}
					} else {
						aSeries[c-iFirstDataColumn].push(ZC._f_(sField));
					}

				} else {
					aSeries[c-iFirstDataColumn].push(null);
				}
			}
			aSeriesInfo[c-iFirstDataColumn] = {};
			if (ZC._n_(sFormat) !== null) {
				aSeriesInfo[c-iFirstDataColumn]['format'] = sFormat;
			}
			if (ZC._n_(sThSep) !== null) {
				aSeriesInfo[c-iFirstDataColumn]['thousands-separator'] = sThSep;
			}
			if (ZC._n_(sThSep) !== null) {
				aSeriesInfo[c-iFirstDataColumn]['decimals-separator'] = sDecSep;
			}
			if (iDec !== 0) {
				aSeriesInfo[c-iFirstDataColumn]['decimals'] = iDec;
			}
		}

		if (bKeyValFormat) {
			for (i=0,iLen=aSeries.length;i<iLen;i++) {
				for (var j=0;j<aSeries[i].length;j++) {
					aSeries[i][j] = [aVerticalLabels[j], aSeries[i][j]];
				}
			}
		}

		var aPlotText = [];

		switch (self.oGraph.sType) {
			case 'line':
			case 'area':
			case 'vbar':
			case 'hbar':
			case 'line3d':
			case 'area3d':
			case 'vbar3d':
			case 'hbar3d':
			case 'mixed':
				if (ZC._n_(self.oData['scale-x']) === null) {
					self.oData['scale-x'] = {};
				}
				var aScaleLabels = [];
				if (bVerticalLabels && ZC._n_(aHorizontalLabels[0]) !== null) {
					aScaleLabels = aHorizontalLabels[0].split(/\\/);
				}
				if (ZC._n_(aScaleLabels[0]) !== null) {
					if (ZC._n_(self.oData['scale-x']['label']) === null) {
						self.oData['scale-x']['label'] = {};
					}
					if (ZC._n_(self.oData['scale-x']['label']['text']) === null) {
						self.oData['scale-x']['label']['text'] = aScaleLabels[0];
					}
				}
				if (bVerticalLabels) {
					if (ZC._n_(self.oData['scale-x']['values']) === null) {
						self.oData['scale-x']['values'] = aVerticalLabels;
					} else if (ZC._n_(self.oData['scale-x']['labels']) === null) {
						self.oData['scale-x']['labels'] = aVerticalLabels;
					}
				}
				var aYScales = [];
				var iYScales = 0;
				if (ZC._n_(bSeparateScales) !== null && bSeparateScales) {
					for (i=0,iLen=aSeries.length;i<iLen;i++) {
						aYScales[i] = 'scale-y' + ((i===0)?'':('-'+(i+1)));
						iYScales++;
					}
				} else {
					if (ZC._n_(bSmartScales) !== null && bSmartScales) {
						var aYScalesP = {};
						var iScale = 0;
						var aFormats = [];
						for (i=0,iLen=aSeries.length;i<iLen;i++) {
							var fAvg = 0;
							for (var d=0,dLen=aSeries[i].length;d<dLen;d++) {
								fAvg += aSeries[i][d];
							}
							fAvg /= aSeries[i].length;
							var iPower = Math.round((ZC._log_(fAvg)/Math.LN10)/2);
							if (ZC._n_(aYScalesP[iPower]) === null) {
								aYScalesP[iPower] = 'scale-y' + ((iScale===0)?'':('-'+(iScale+1)));
							}

							if (ZC._indexof_(aFormats, aSeriesInfo[i]['format']) === -1) {
								aYScales[i] = 'scale-y' + ((iScale===0)?'':('-'+(iScale+1)));
								iScale++;
							} else {
								aYScales[i] = aYScalesP[iPower];
								iScale++;
							}
							aFormats.push(aSeriesInfo[i]['format']);
						}
					}
				}

				if (aYScales.length === 0) {
					aYScales[0] = 'scale-y';
				}
				if (ZC._n_(self.oData['series']) === null) {
					self.oData['series'] = [];
				}

				for (i=0,iLen=aSeries.length;i<iLen;i++) {
					if (ZC._n_(self.oData['series'][i]) === null) {
						self.oData['series'][i] = {};
					}
					self.oData['series'][i]['values'] = aSeries[i];
					if (bHorizontalLabels) {
						if (ZC._n_(self.oData['series'][i]['text']) === null) {
							self.oData['series'][i]['text'] = aHorizontalLabels[i+iFirstDataColumn];
							aPlotText.push(aHorizontalLabels[i+iFirstDataColumn]);
						}
						if (ZC._n_(self.oData['series'][i]['legend-text']) === null) {
							self.oData['series'][i]['legend-text'] = aHorizontalLabels[i+iFirstDataColumn];
							aPlotText.push(aHorizontalLabels[i+iFirstDataColumn]);
						}
						if (ZC._n_(self.oData['series'][i]['tooltip-text']) === null && ZC._n_(aSeriesInfo[i]['format']) !== null) {
							self.oData['series'][i]['tooltip-text'] = aSeriesInfo[i]['format'];
						}
					}
					if (ZC._n_(aYScales[i]) !== null) {
						if (ZC._n_(self.oData[aYScales[i]]) === null) {
							self.oData[aYScales[i]] = {};
						}
						if (ZC._n_(aScaleLabels[1]) !== null) {
							if (ZC._n_(self.oData[aYScales[i]]['label']) === null) {
								self.oData[aYScales[i]]['label'] = {};
							}
							if (ZC._n_(self.oData[aYScales[i]]['label']['text']) === null) {
								self.oData[aYScales[i]]['label']['text'] = aScaleLabels[1];
							}
						}
						if (ZC._n_(self.oData['series'][i]['scales']) === null) {
							self.oData['series'][i]['scales'] = 'scale-x,' + aYScales[i];
						}
						if (ZC._n_(self.oData[aYScales[i]]['decimals']) === null && ZC._n_(aSeriesInfo[i]['decimals']) !== null) {
							self.oData[aYScales[i]]['decimals'] = aSeriesInfo[i]['decimals'];
						}
						if (ZC._n_(self.oData[aYScales[i]]['thousands-separator']) === null && ZC._n_(aSeriesInfo[i]['thousands-separator']) !== null) {
							self.oData[aYScales[i]]['thousands-separator'] = aSeriesInfo[i]['thousands-separator'];
						}
						if (ZC._n_(self.oData[aYScales[i]]['decimals-separator']) === null && ZC._n_(aSeriesInfo[i]['decimals-separator']) !== null) {
							self.oData[aYScales[i]]['decimals-separator'] = aSeriesInfo[i]['decimals-separator'];
						}
						if (ZC._n_(self.oData[aYScales[i]]['format']) === null && ZC._n_(aSeriesInfo[i]['format']) !== null) {
							self.oData[aYScales[i]]['format'] = aSeriesInfo[i]['format'];
						}
					}
				}
				break;
			case 'pie':
			case 'pie3d':
			case 'nestedpie':
				if (ZC._n_(self.oData['scale']) === null) {
					self.oData['scale'] = {};
				}
				if (bVerticalLabels && ZC._n_(aHorizontalLabels[0]) !== null) {
					var aLabels = aHorizontalLabels[0].split(/\\/);
					if (ZC._n_(self.oData['scale']['label']) === null) {
						self.oData['scale']['label'] = {};
					}
					if (ZC._n_(self.oData['scale']['label']['text']) === null) {
						self.oData['scale']['label']['text'] = aLabels[0];
					}
				}
				if (bVerticalLabels) {
					if (ZC._n_(self.oData['scale']['values']) === null) {
						self.oData['scale']['values'] = aVerticalLabels;
					} else if (ZC._n_(self.oData['scale']['labels']) === null) {
						self.oData['scale']['labels'] = aVerticalLabels;
					}
				}
				if (ZC._n_(self.oData['series']) === null) {
					self.oData['series'] = [];
				}
				for (i=0,iLen=aSeries.length;i<iLen;i++) {
					if (ZC._n_(self.oData['series'][i]) === null) {
						self.oData['series'][i] = {};
					}
					self.oData['series'][i]['values'] = aSeries[i];
					if (bHorizontalLabels) {
						if (ZC._n_(self.oData['series'][i]['text']) === null) {
							self.oData['series'][i]['text'] = aHorizontalLabels[i+iFirstDataColumn];
							aPlotText.push(aHorizontalLabels[i+iFirstDataColumn]);
						}
						if (ZC._n_(self.oData['series'][i]['legend-text']) === null) {
							self.oData['series'][i]['legend-text'] = aHorizontalLabels[i+iFirstDataColumn];
							aPlotText.push(aHorizontalLabels[i+iFirstDataColumn]);
						}
						if (ZC._n_(self.oData['series'][i]['tooltip-text']) === null && ZC._n_(aSeriesInfo[i]['format']) !== null) {
							self.oData['series'][i]['tooltip-text'] = aSeriesInfo[i]['format'];
						}
					}
					if (ZC._n_(self.oData['scale-v']) === null) {
						self.oData['scale-v'] = {};
					}
					if (ZC._n_(self.oData['scale-v']['decimals']) === null && ZC._n_(aSeriesInfo[i]['decimals']) !== null) {
						self.oData['scale-v']['decimals'] = aSeriesInfo[i]['decimals'];
					}
					if (ZC._n_(self.oData['scale-v']['thousands-separator']) === null && ZC._n_(aSeriesInfo[i]['thousands-separator']) !== null) {
						self.oData['scale-v']['thousands-separator'] = aSeriesInfo[i]['thousands-separator'];
					}
					if (ZC._n_(self.oData['scale-v']['decimals-separator']) === null && ZC._n_(aSeriesInfo[i]['decimals-separator']) !== null) {
						self.oData['scale-v']['decimals-separator'] = aSeriesInfo[i]['decimals-separator'];
					}
					if (ZC._n_(self.oData['scale-v']['format']) === null && ZC._n_(aSeriesInfo[i]['format']) !== null) {
						self.oData['scale-v']['format'] = aSeriesInfo[i]['format'];
					}
				}
				break;
		}

		if (aPlotText.join('') !== '' && ZC._n_(self.oData['legend']) === null) {
			self.oData['legend'] = {};
		}

		return self.oData;
	}
});












ZC.ZCGraph = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self.sClassName = 'zcgraph';
		self._super(oParent);
		self.oLoader = oParent;
		
		self.sType = '';
		self.oTitle = null;
		self.oSubtitle = null;
		self.oSource = null;
		self.oNoData = null;
		self.oPlotArea = null;
		self.oPreview = null;
		self.oScrollX = null;
		self.oScrollY = null;
		self.iScalesBackLayers = 1;
		self.iScalesMiddleLayers = 1;
		self.iScalesFrontLayers = 1;
		self.iIndex = 0;
		self.oRefresh = null;
		self.aFeedStatus = [1, 0]; 
		self.sUrlData = null;
		self.bStacked = false;
		self.sStackType = 'normal';
		self.aScales = [];
		self.aLabels = [];
		self.aArrows = [];
		self.aShapes = [];
		self.aImages = [];
		self.oPlotSet = new ZC.ZCPlotSet(self);
		self.aValAssoc = [];
		self.aKeyAssoc = [];
		self.oZoom = null;
		self.oLegend = null;
		self.oTooltip = null;
		self.oCrosshairX = null;
		self.oCrosshairY = null;
		self.sAnimateType = 'always'; 
		self.bAnimate = true;
		self.sStage = '';
		self.sCsv = null;
		self.bAsync = false;
		self.bUTC = false;
		self.iTimeZone = 0;
		self.bDynamicObjects = false;
		self.bObjectsTweening = false;
		self.o3DAspect = {
			true3d : 1,
			angle : 45,
			depth : 40,
			'x-angle' : 0,
			'y-angle' : 0,
			'z-angle' : 0,
			zoom : 1
		};
		self.oSettings = {
			'enable-guide' : false,
			'enable-preview' : false,
			'enable-scroll' : false,
			'3d' : false,
			'clip' : false,
			'layout' : '',
			'enable-animation' : true,
			'angle-min' : 15,
			'angle-max' : 75,
			'x-angle-min' : -65,
			'x-angle-max' : 65,
			'y-angle-min' : -65,
			'y-angle-max' : 65,
			'z-angle-min' : -65,
			'z-angle-max' : 65
		};
		self.bScrolling = false;
		self.bZoomTo = false;
		self.aVBPositions = [];
		self.bGuideOn = true;
		if (typeof(ZC.ZCTweenManager) !== 'undefined') {
			self.oTweenManager = new ZC.ZCTweenManager(self);
		}
		self.bAnimation = false;
		self.oSelection = {};
		self.aSelection = [];
		self.bSelection = false;
		self.bDisableAnimation = false;
		self.iPage = 0;
		self.aPalette = [];
		self.bSortObjects = true;
		self.iStackingLogic = zingchart.DEV.STACKINGLOGIC;
	},
	getPMap : function() {
		var oMap = this._super();
		this.addPMap(oMap, 'index', 'iIndex');
		return oMap;
	},
	getToggleAction : function() {
		var self = this, mValue;
		var sToggleAction = 'hide';
		if (self.oLegend && self.oAttributes['legend-last-trigger'] !== '' && typeof(self.oAttributes['legend-last-trigger']) !== 'undefined') {
			sToggleAction = (self.oAttributes['legend-last-trigger']==='item')?self.oLegend.sItemToggleAction:self.oLegend.sMarkerToggleAction;
		} else {
			if (self.oData['legend'] && (mValue=self.oData['legend']['toggle-action'])) {
				sToggleAction = mValue;
			}
			if (self.oData['legend'] && self.oData['legend']['item'] && (mValue=self.oData['legend']['item']['toggle-action'])) {
				sToggleAction = mValue;
			}
		}
		if (self.oParent.bFlat || self.oAttributes['toggle-action-remove']) {
			sToggleAction = 'remove';
		}
		return sToggleAction;
	},
	getScales : function(sType, bWithValues) {
		if (typeof(bWithValues) === 'undefined') {
			bWithValues = false;
		}
		var aScales = [];
		var self = this;
		for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
			if (self.aScales[i].sType === sType) {
				if (!bWithValues || (bWithValues && self.aScales[i].aValues.length > 0)) {
					aScales.push(self.aScales[i]);
				}
			}
		}
		return aScales;
	},
	getScaleByName : function(sName) {
		var self = this;
		for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
			if (self.aScales[i].sName === sName) {
				return self.aScales[i];
			}
		}
		return null;
	},
	getScaleKDefaultValue : function(iIndex) {
		return iIndex;
	},
	getCsvParser : function(sCsvData) {
		return new ZC.ZCCsvParser(this, sCsvData);
	},
	parseScales : function() {
		var self = this;
		for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
			var oScale = self.aScales[i], sScaleName = oScale.sName;
			self.oParent.oDefaults.load(oScale.oData, [
				'(' + self.sType + ').SCALE',
				'(' + self.sType + ').' + sScaleName.replace(/\-[0-9]/, ''),
				'(' + self.sType + ').' + sScaleName.replace(/\-[0-9]/, '-n'),
				'(' + self.sType + ').' + sScaleName
			], false, true);
			var sSharedName = sScaleName.replace(/\-[0-9]/, '') + '-n';
			if (self.oData[sSharedName]) {
				oScale.append(self.oData[sSharedName]);
			}
			if (self.oData[sScaleName]) {
				oScale.append(self.oData[sScaleName]);
			}
			if (self.oSettings['3d']) {
				self.oParent.oDefaults.load(oScale.oData, [
					'(' + self.sType + ').SCALE[3d]',
					'(' + self.sType + ').' + sScaleName.replace(/\-[0-9]/, '') + '[3d]',
					'(' + self.sType + ').' + sScaleName.replace(/\-[0-9]/, '-n') + '[3d]',
					'(' + self.sType + ').' + sScaleName + '[3d]'
				], false, true);
			}
			if (self.oSettings['3d']) {
				oScale.append(self.oData[sScaleName + '[3d]']);
			}
			oScale.parse();
		}
	},
	setupScaleValues : function() {
		return null;
	},
	setupScales : function(iStep) {
		var self = this, i, iLen;
		var iMaxNodes = 0, iPlots = self.oPlotSet.aPlots.length;
		for (i=0;i<iPlots;i++) {
			iMaxNodes = ZC._max_(iMaxNodes, self.oPlotSet.aPlots[i].aPlotNodes.length);
		}

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%N|%node-count)/g, iMaxNodes);
			sRule = sRule.replace(/(%P|%plot-count)/g, iPlots);
			sRule = sRule.replace(/(%S|%scale-values-count)/g, oScale.aValues.length);
			return sRule;
		}

		for (i=0,iLen=self.aScales.length;i<iLen;i++) {
			var oScale = self.aScales[i];
			
			oScale.setupValues(iStep);
			

			if (iStep === 2) {
				oScale.parseRule = _parseRule;
				if (oScale.applyRules()) {
					oScale.parse();
				}
			}

			if (ZC._n_(oScale.oData['max-items']) === null && ZC._n_(oScale.oData['max-labels']) === null) {
				oScale.setupMaxItems();
			}
			if (ZC._n_(oScale.oData['max-ticks']) === null) {
				oScale.setupMaxTicks();
			}
		}
	},
	getHookXY : function() {
	},
	setup3DView : function() {
	},
	parse3D : function() {
	},
	parseSelection : function() {
	},
	setupPlotArea : function() {
		var self = this;

		var oDefaults = self.oParent.oDefaults;
		var sGraphType = '(' + self.sType + ')';
		self.oPlotArea = new ZC.ZCBox(self);
		self.oPlotArea.sTag = 'plotarea';
		self.oPlotArea.sId = self.sId + '-plotarea';
		var aPlotAreaDefaults = [
			sGraphType + '.plotarea'
		];
		if (self.oPreview) {
			aPlotAreaDefaults.push(sGraphType + '.plotarea[preview]');
		}
		if (self.oSettings['3d']) {
			aPlotAreaDefaults.push(sGraphType + '.plotarea[3d]');
		}
		oDefaults.load(self.oPlotArea.oData, aPlotAreaDefaults);
		self.oPlotArea.append(self.oData['chart']);
		self.oPlotArea.append(self.oData['plotarea']);
		if (self.oPreview) {
			self.oPlotArea.append(self.oData['plotarea[preview]']);
		}
		if (self.oSettings['3d']) {
			self.oPlotArea.append(self.oData['plotarea[3d]']);
		}

		
		if (!self.oAttributes['plotarea-margins']) {
			self.oAttributes['plotarea-margins'] = true;
			self.oAttributes['plotarea-margin'] = self.oPlotArea.oData['margin'];
			self.oAttributes['plotarea-margin-top'] = self.oPlotArea.oData['margin-top'];
			self.oAttributes['plotarea-margin-right'] = self.oPlotArea.oData['margin-right'];
			self.oAttributes['plotarea-margin-bottom'] = self.oPlotArea.oData['margin-bottom'];
			self.oAttributes['plotarea-margin-left'] = self.oPlotArea.oData['margin-left'];
		}

		if (typeof(self.oAttributes['plotarea-p-x']) !== 'undefined') {
			self.oPlotArea.oAttributes['p-x'] = self.oAttributes['plotarea-p-x'];
			self.oPlotArea.oAttributes['p-y'] = self.oAttributes['plotarea-p-y'];
			self.oPlotArea.oAttributes['p-width'] = self.oAttributes['plotarea-p-width'];
			self.oPlotArea.oAttributes['p-height'] = self.oAttributes['plotarea-p-height'];
		}

		
		if (ZC._n_(self.oPlotArea.oData['adjust-layout']) !== null && ZC._b_(self.oPlotArea.oData['adjust-layout'])) {
			self.oPlotArea.oData['margin'] = 'dynamic';
		}

		self.oPlotArea.parse();

		if (self.oSettings['3d']) {
			if (!self.o3DAspect.true3d) {
				var dy = ZC._a_(ZC._i_(self.o3DAspect.depth*ZC._sin_(self.o3DAspect.angle)));
				self.oPlotArea.iY += dy;
				self.oPlotArea.iHeight -= dy;
				self.oPlotArea.iWidth -= ZC._i_(self.o3DAspect.depth*ZC._cos_(self.o3DAspect.angle));
			}
		}

		if (typeof(self.oAttributes['plotarea-p-x']) !== 'undefined') {
			for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
				self.aScales[i].setupBounds();
				self.aScales[i].setupStepSize();
			}
		}

	},
	setupDynamicPlotArea : function() {
		var self = this, mValue, i, iLen;

		var aDirections = ['top', 'right', 'bottom', 'left'];
		var oDynamic = {};
		for (i=0;i<aDirections.length;i++) {
			oDynamic[aDirections[i]] = false;
			if (self.oAttributes['plotarea.d-margin-' + aDirections[i]]) {
				self.oData['plotarea']['margin-' + aDirections[i]] = null;
			}
			if (self.oData['plotarea'] && self.oData['plotarea']['margin-' + aDirections[i]] === 'dynamic') {
				oDynamic[aDirections[i]] = true;
				self.oData['plotarea']['margin-' + aDirections[i]] = '20';
			}
		}

		if ((self.oSettings['layout'] === 'xy' || self.oSettings['layout'] === 'yx') && (self.oPlotArea.oAttributes['d-margin'] || self.oAttributes['plotarea.d-margin'])) {
			for (var j=0,jLen=self.aScales.length;j<jLen;j++) {
				var iWidth = 0, iHeight = 0;
				var sDirection = '', oScale = self.aScales[j];
				if (oScale.bVisible && oScale.bUsed) {
					if (oScale.sType === 'k') {
						if (oScale.bInversed) {
							sDirection = (oScale.sPlacement==='default')?'left':'right';
						} else {
							sDirection = (oScale.sPlacement==='default')?'bottom':'top';
						}
					} else if (oScale.sType === 'v') {
						if (oScale.bInversed) {
							sDirection = (oScale.sPlacement==='default')?'bottom':'top';
						} else {
							sDirection = (oScale.sPlacement==='default')?'left':'right';
						}
					}

					if (self.oPlotArea.oAttributes['d-margin-' + sDirection] || self.oAttributes['plotarea.d-margin-' + sDirection]) {
						var oItem = new ZC.ZCTextBox(oScale);
						oItem.copy(oScale.oItem);
						var iStep = ZC._max_(1, ZC._i_((oScale.iMaxIndex - oScale.iMinIndex)/oScale.iMaxItems));
						for (i=oScale.iMinIndex;i<=oScale.iMaxIndex;i+=iStep) {
							oItem.sText = oScale.getParsedItemLabel(i);
							if (oItem.bWrapText && ((oScale.sType === 'k' && !oScale.bInversed) || (oScale.sType === 'v' && oScale.bInversed))) {
								oItem.oData['width'] = ZC._i_(oScale.iStepSize*0.9);
							}
							oItem.parse();
							if (oItem.bVisible) {
								iHeight = ZC._max_(iHeight, (oItem.iAngle%180 === 0)?oItem.iHeight:oItem.iWidth);
								iWidth = ZC._max_(iWidth, (oItem.iAngle%180 === 0)?oItem.iWidth:oItem.iHeight);
							}
						}

						var oLabel = new ZC.ZCTextBox(oScale);
						oLabel.copy(oScale.oLabel);
						oLabel.sText = oScale.oLabel.sText;
						oLabel.parse();
						if (oLabel.sText !== '' && oLabel.bVisible) {
							iHeight += (oLabel.iAngle%180 === 0)?oLabel.iHeight:oLabel.iWidth;
							iWidth += (oLabel.iAngle%180 === 0)?oLabel.iWidth:oLabel.iHeight;
						}
					}

					if (!self.oData['plotarea']) {
						self.oData['plotarea'] = {};
					}
					if (self.oData['plotarea']['margin-' + sDirection] === 'dynamic' || self.oPlotArea.oAttributes['d-margin-' + sDirection]) {
						self.oPlotArea.oAttributes['d-margin-' + sDirection] = false;
						oDynamic[sDirection] = true;
						self.oData['plotarea']['margin-' + sDirection] = '0';
					}

					if (oDynamic[sDirection]) {
						self.oData['plotarea']['margin-' + sDirection] = ZC._f_(self.oData['plotarea']['margin-' + sDirection] || '0');
						self.oAttributes[oScale.sName + '-distance'] = self.oData['plotarea']['margin-' + sDirection];
						self.oData['plotarea']['margin-' + sDirection] += ((sDirection === 'top' || sDirection === 'bottom')?ZC._i_(iHeight):ZC._i_(iWidth)) + 10;
						if (sDirection === 'bottom' && self.oScrollX) {
							self.oData['plotarea']['margin-' + sDirection] += 15;
						}
						if (sDirection === 'left' && self.oScrollY) {
							self.oData['plotarea']['margin-' + sDirection] += 15;
						}
						self.oAttributes['plotarea.d-margin-' + sDirection] = true;
					}
				}
			}

			
			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-plotarea-c'), self.oLoader.sOutput, self.oPlotArea.iX, self.oPlotArea.iY, self.oPlotArea.iWidth, self.oPlotArea.iHeight, self.sId);
			
			self.oAttributes['plotarea.paint'] = true;

			self.setupPlotArea();

			var iMaskTolerance = 2, iHoverMaskTolerance = 6;
			if (ZC._n_(mValue=self.oPlotArea.oData['mask-tolerance']) !== null) {
				if (mValue instanceof Array && mValue.length > 1) {
					iMaskTolerance = ZC._i_(mValue[0]);
					iHoverMaskTolerance = ZC._i_(mValue[0]);
				} else {
					iHoverMaskTolerance = ZC._i_(mValue);
				}
			}
			if (self.oLoader.sOutput === 'svg') {
				if ((mValue=ZC._id_(self.sId + '-clip-shape'))) {
					mValue.setAttribute('points', self.getClipPath(iMaskTolerance, 'svg'));
				}
				if ((mValue=ZC._id_(self.sId + '-clip-hover-shape'))) {
					mValue.setAttribute('points', self.getClipPath(iHoverMaskTolerance, 'svg'));
				}
			} else {
				ZC.ZCQuery('#' + self.sId + ' div').each(function() {
					if (this.style.clip !== '') {
						this.style.clip = self.getClipPath(iMaskTolerance);
					}
				});
				if ((mValue=ZC._id_(self.sId + '-hover'))) {
					if (mValue.style.clip !== '') {
						mValue.style.clip = self.getClipPath(iHoverMaskTolerance);
					}
				}
			}
		}

		for (i=0,iLen=self.aScales.length;i<iLen;i++) {
			self.aScales[i].setupBounds();
			self.aScales[i].setupStepSize();
		}

	},
	parse : function() {
		var self = this, mValue, mValue_, iCY, i, iLen, sNodeId, d, dLen;
		var oDefaults = self.oParent.oDefaults;
		var sGraphType = '(' + self.sType + ')';

		self.sStage = 'parse.init';
		self._super();

		self.parse3D();

		var sCsvData = null;
		if (!zingchart.SKIP.CSV) {
			if ((mValue=self.oData['html5-csv'])) {
				self.sCsv = mValue['html5-url'];
			}
			if ((mValue=self.oData['csv'])) {
				if (typeof(mValue) === 'object') {
					if (mValue['url']) {
						self.sCsv = mValue['url'];
					} else if (mValue['data-string']) {
						sCsvData = mValue['data-string'];
					}
				} else {
					self.sCsv = mValue;
				}
			}
			if (self.sCsv !== '') {
				if (ZC._n_(self.oParent.oCsv[self.sCsv]) !== null) {
					sCsvData = self.oParent.oCsv[self.sCsv];
				}
			}
			if (self.oLoader.sCsvData) {
				sCsvData = self.oLoader.sCsvData;
			}
			if (sCsvData) {
				var oCsvParser = self.getCsvParser(sCsvData);
				self.oData = oCsvParser.parse();
			}
		}

		self.bAsync = zingchart.ASYNC;
		self.assign_a([
			['utc', 'bUTC', 'b'],
			['timezone', 'iTimeZone', 'i'],
			['async', 'bAsync', 'b'],
			['stacked', 'bStacked', 'b'],
			['stack-type', 'sStackType'],
			['animate-type', 'sAnimateType'],
			['url-data', 'sUrlData'],
			['page', 'iPage', 'i'],
			['palette', 'aPalette'],
			['sort-objects', 'bSortObjects', 'b']
		]);

		if (self.aPalette.length > 0) {
			oDefaults.oDefaults.palette = [];
			for (i=0;i<self.aPalette.length;i++) {
				var c1 = self.aPalette[i], c2 = ZC.ZCUtils._darken_(self.aPalette[i], 10), c3 = ZC.ZCUtils._lighten_(self.aPalette[i], 10);
				oDefaults.oDefaults.palette.push(['#fff', c1, c2, c3]);
			}
		}

		
		if (self.sType === 'pie3d') {
			self.o3DAspect['true3d'] = true;
		}

		if (self.oSettings['3d'] || self.oParent.bImgGen) {
			self.bAsync = false;
		}

		self.parseSelection();

		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			if ((ZC._n_(mValue=self.oData['preview']) !== null || oDefaults.featureEnabled('preview', self.sType)) && self.oSettings['enable-preview']) {
				if (!self.oPreview && typeof(ZC.ZCPreview) !== 'undefined') {
					self.oPreview = new ZC.ZCPreview(self);
					self.oPreview.sTag = 'preview';
					oDefaults.load(self.oPreview.oData, sGraphType + '.preview');
					if ((mValue_=self.oData['plotarea'])) {
						self.oPreview.append({
							'background-color' : mValue_['background-color'],
							'background-color-1' : mValue_['background-color-1'],
							'background-color-2' : mValue_['background-color-2'],
							'gradient-stops' : mValue_['gradient-stops'],
							'gradient-colors' : mValue_['gradient-colors']
						});	
					}
					self.oPreview.append(mValue);
					self.oPreview.parse();
				}
			}
			if ((ZC._n_(mValue=self.oData['scroll-x']) !== null || oDefaults.featureEnabled('scroll-x', self.sType)) && self.oSettings['enable-scroll']) {
				if (!self.oScrollX && typeof(ZC.ZCScroll) !== 'undefined') {
					self.oScrollX = new ZC.ZCScroll(self, 'x');
					self.oScrollX.sTag = 'scrollx';
					oDefaults.load(self.oScrollX.oData, sGraphType + '.scroll-x');
					self.oScrollX.append(mValue);
					self.oScrollX.parse();
				}
			}
			if ((ZC._n_(mValue=self.oData['scroll-y']) !== null || oDefaults.featureEnabled('scroll-y', self.sType)) && self.oSettings['enable-scroll']) {
				if (!self.oScrollY && typeof(ZC.ZCScroll) !== 'undefined') {
					self.oScrollY = new ZC.ZCScroll(self, 'y');
					self.oScrollY.sTag = 'scrolly';
					oDefaults.load(self.oScrollY.oData, sGraphType + '.scroll-y');
					self.oScrollY.append(mValue);
					self.oScrollY.parse();
				}
			}
		}

		self.setupPlotArea();

		self.setup3DView();

		self.aScales = [];
		
		self.parseScales();
		
		
		self.setupScales(1);
		
		if (ZC._n_(mValue=self.oData['series']) !== null) {
			self.oPlotSet.oData = mValue;
		}
		
		self.oPlotSet.parse();
		
		
		self.setupScales(2);
		

		
		if (ZC._n_(mValue=self.oData['title']) !== null || oDefaults.featureEnabled('title', self.sType)) {
			self.oTitle = new ZC.ZCTextBox(self);
			self.oTitle.sTag = 'title';
			oDefaults.load(self.oTitle.oData, sGraphType + '.title');
			self.oTitle.append(mValue);
			self.oTitle.sId = self.sId + '-title';
			self.oTitle.parse();
		}

		if (ZC._n_(mValue=self.oData['subtitle']) !== null || oDefaults.featureEnabled('subtitle', self.sType)) {
			self.oSubtitle = new ZC.ZCTextBox(self);
			self.oSubtitle.sTag = 'subtitle';
			oDefaults.load(self.oSubtitle.oData, sGraphType + '.subtitle');
			self.oSubtitle.append(mValue);
			self.oSubtitle.sId = self.sId + '-subtitle';
			self.oSubtitle.parse();
		}

		if (ZC._n_(mValue=self.oData['source']) !== null) {
			self.oSource = new ZC.ZCTextBox(self);
			self.oSource.sTag = 'source';
			oDefaults.load(self.oSource.oData, sGraphType + '.source');
			self.oSource.append(mValue);
			self.oSource.sId = self.sId + '-source';
			self.oSource.parse();
		}

		if (typeof(ZC.ZCLegend) !== 'undefined') {
			if (ZC._n_(mValue=self.oData['legend']) !== null || oDefaults.featureEnabled('legend', self.sType)) {
				self.oLegend = new ZC.ZCLegend(self);
				self.oLegend.sId = self.sId + '-legend';
				if (typeof(mValue['alpha']) !== 'undefined' && mValue['alpha'] < 0.1 && typeof(mValue['border-width']) === 'undefined' && typeof(mValue['border-alpha']) === 'undefined'){
					mValue['border-alpha'] = mValue['alpha'];
				}
				oDefaults.load(self.oLegend.oData, sGraphType + '.legend');
				self.oLegend.alignPosition(mValue);
				if ((ZC._n_(mValue) !== null && ZC._n_(mValue['position']) !== null) || ZC._n_(self.oLegend.oData['position']) !== null) {
					oDefaults.load(self.oLegend.oData, sGraphType + '.legend[position]');
				}
				self.oLegend.append(mValue);
				if (ZC._b_(self.oLegend.oData['shared'])) {
					self.oLegend.oAttributes['p-x'] = self.oParent.iX;
					self.oLegend.oAttributes['p-y'] = self.oParent.iY;
					self.oLegend.oAttributes['p-width'] = self.oParent.iWidth;
					self.oLegend.oAttributes['p-height'] = self.oParent.iHeight;
				}
				self.oLegend.parse();
			}
		}

		var bReflow = false;
		var iPX = self.iX, iPY = self.iY, iPW = self.iWidth, iPH = self.iHeight, sTitlePlacement = '';
		
		if (self.oTitle && self.oTitle.oData['adjust-layout']) {
			bReflow = true;
			iCY = self.oTitle.iY + self.oTitle.iHeight/2;
			
			if (iCY < iPY + iPH/2) {
				sTitlePlacement = 'top';
				iPH = iPY + iPH - self.oTitle.iHeight - self.oTitle.iY;
				iPY = self.oTitle.iY + self.oTitle.iHeight;
				if (self.oSubtitle && self.oSubtitle.oData['adjust-layout']) {
					var iSCY = self.oSubtitle.iY + self.oSubtitle.iHeight/2;
					if (iSCY < iPY + iPH/2 && iSCY > iCY) {
						iPH -= self.oSubtitle.iHeight;
						iPY += self.oSubtitle.iHeight;
					}
				}
			}
		}
		
		if (self.oSource && self.oSource.oData['adjust-layout']) {
			bReflow = true;
			iCY = self.oSource.iY + self.oSource.iHeight/2;
			
			if (iCY > iPY + iPH/2) {
				iPH -= self.oSource.iHeight;
			}
		}

		
		if (self.oPreview && self.oPreview.oData['adjust-layout']) {
			bReflow = true;
			iCY = self.oPreview.oViewport.iY + self.oPreview.oViewport.iHeight/2;
			
			if (iCY > iPY + iPH/2) {
				iPH -= self.oPreview.oViewport.iHeight;
			}
		}

		
		if (self.oLegend && self.oLegend.oData['adjust-layout']) {
			bReflow = true;

			if (sTitlePlacement === 'top') {
				if (self.oLegend.iY < self.oTitle.iY + self.oTitle.iHeight + 5) {
					if (ZC._n_(self.oLegend.oData['position']) !== null) {
						var aTmp = (''+self.oLegend.oData['position']).split(' ');
						self.oLegend.oData['position'] = aTmp[0] + ' ' + (self.oTitle.iY - self.iY + self.oTitle.iHeight);
					} else {
						self.oLegend.oData['margin-top'] = self.oTitle.iY - self.iY + self.oTitle.iHeight;
					}
					self.oLegend.parse();
				}
			}

			iCY = self.oLegend.iY + self.oLegend.iHeight/2;
			var sPlacement = '', iMinMargin = ZC.MAX, aPI = self.oLegend.oAttributes['position-info'];

			if (aPI) {
				if (aPI[0] >= 0.8) {
					if (aPI[1] <= 0.2) {
						sPlacement = 'top';
					} else if (aPI[1] >= 0.8) {
						sPlacement = 'bottom';
					} else {
						sPlacement = 'right';
					}
				} else if (aPI[0] <= 0.2) {
					if (aPI[1] <= 0.2) {
						sPlacement = 'top';
					} else if (aPI[1] >= 0.8) {
						sPlacement = 'bottom';
					} else {
						sPlacement = 'left';
					}					
				} else {
					if (aPI[1] <= 0.2) {
						sPlacement = 'top';
					} else if (aPI[1] >= 0.8) {
						sPlacement = 'bottom';
					}
				}
			} else {

				var oDiffs = {
					Bottom : self.oLegend.iY - self.iY,
					Top : self.iY + self.iHeight - self.oLegend.iY - self.oLegend.iHeight,
					Right : self.oLegend.iX - self.iX,
					Left : self.iX + self.iWidth - self.oLegend.iX - self.oLegend.iWidth
				};
				var iMaxDiff = -Number.MAX_VALUE;
				for (var sSide in oDiffs) {
					if (oDiffs[sSide] > iMaxDiff) {
						iMaxDiff = oDiffs[sSide];
						sPlacement = sSide.toLowerCase();
						iMinMargin = self.oLegend['iMargin' + sSide];
					}
				}
			}
			
			var iOffset = 0;

			if (sPlacement === 'top') {
				iPH = iPY + iPH - self.oLegend.iHeight - self.oLegend.iY;
				iPY = self.oLegend.iY + self.oLegend.iHeight;
			}
			if (sPlacement === 'bottom') {
				iOffset = iPH - self.oLegend.iY + iPY + self.oLegend.iPaddingTop + self.oLegend.iPaddingBottom;
				iPH = iPH - iOffset;
			}
			if (sPlacement === 'left') {
				iOffset = self.oLegend.iX - self.iX + self.oLegend.iWidth;
				iPX = iPX + iOffset; 
				iPW = iPW - iOffset;
			}
			if (sPlacement === 'right') {
				iOffset = iPW - (self.oLegend.iX - self.iX) + self.oLegend.iPaddingLeft + self.oLegend.iPaddingRight;
				iPW = iPW - iOffset;
			}

		}

		if (bReflow) {
			self.oAttributes['plotarea-p-x'] = iPX;
			self.oAttributes['plotarea-p-y'] = iPY;
			self.oAttributes['plotarea-p-width'] = iPW;
			self.oAttributes['plotarea-p-height'] = iPH;
			self.setupPlotArea();
		}

		self.setupDynamicPlotArea();
		if (self.oPlotSet.parseLayout) {
			self.oPlotSet.parseLayout(true);
		}

		
		if (self.oPreview && self.oPreview.oData['adjust-layout']) {
			self.oPreview.oViewport.iX = self.oPlotArea.iX;
			self.oPreview.oViewport.iWidth = self.oPlotArea.iWidth;
		}

		
		var iNodes = 0;
		for (i=0;i<self.oPlotSet.aPlots.length;i++) {
			iNodes += self.oPlotSet.aPlots[i].aPlotNodes.length;
		}
		if (ZC._n_(mValue=self.oData['no-data']) !== null && iNodes === 0) {
			self.oNoData = new ZC.ZCTextBox(self);
			self.oNoData.sTag = 'nodata';
			oDefaults.load(self.oNoData.oData, sGraphType + '.nodata');
			self.oNoData.append({
				x : self.oPlotArea.iX,
				y : self.oPlotArea.iY,
				width : self.oPlotArea.iWidth,
				height : self.oPlotArea.iHeight
			});
			self.oNoData.append(mValue);
			self.oNoData.sId = self.sId + '-nodata';
			
			self.oNoData.parse();
		} else {
			self.oNoData = null;
		}

		if (self.oAttributes['plotarea-margins']) {
			self.oAttributes['plotarea-margins'] = null;
			self.oData['plotarea'] = self.oData['plotarea'] || {};
			self.oData['plotarea']['margin'] = self.oAttributes['plotarea-margin'];
			self.oData['plotarea']['margin-top'] = self.oAttributes['plotarea-margin-top'];
			self.oData['plotarea']['margin-right'] = self.oAttributes['plotarea-margin-right'];
			self.oData['plotarea']['margin-bottom'] = self.oAttributes['plotarea-margin-bottom'];
			self.oData['plotarea']['margin-left'] = self.oAttributes['plotarea-margin-left'];
		}
		var aDirections = ['top', 'right', 'bottom', 'left'];
		for (i=0;i<aDirections.length;i++) {
			self.oAttributes['plotarea.d-margin-' + aDirections[i]] = null;
		}

		ZC.ZCHtmlUtils._remove_(self.oParent.sId + '-tooltip');

		if (typeof(self.oAttributes['datalength']) !== 'undefined' && ZC._n_(self.oAttributes['datalength']) !== null && self.oAttributes['datalength'].length > 0 && self.oLoader.sOutput !== 'canvas') {
			if (self.oPlotSet.aPlots) {
				for (var p=0,pLen=self.oPlotSet.aPlots.length;p<pLen;p++) {
					if (self.oPlotSet.aPlots[p].aPlotNodes.length < self.oAttributes['datalength'][p]) {
						for (d=self.oPlotSet.aPlots[p].aPlotNodes.length,dLen=self.oAttributes['datalength'][p];d<dLen;d++) {
							sNodeId = self.sId + '-plotset-plot-' + p + '-node-' + d;
							ZC.ZCHtmlUtils._remove_(
								[
									sNodeId + '-path',
									sNodeId + '-area-path',
									sNodeId + '-sh-path'
								]
							);
							if (ZC._indexof_(['scatter','bubble'], self.sType) !== -1) {
								ZC.ZCHtmlUtils._remove_(
									[
										sNodeId + '-marker-gradient',
										sNodeId + '-marker-path',
										sNodeId + '-marker-sh-path',
										sNodeId + '-marker-circle',
										sNodeId + '-marker-sh-circle'
									]
								);
							}
							self.oLast[p+'-'+d] = null;
						}
					}
					
					if (ZC._indexof_(['scatter','bubble'], self.sType) === -1 || ZC.ZCQuery.browser.webkit) {
						for (d=0,dLen=self.oAttributes['datalength'][p];d<dLen;d++) {
							sNodeId = self.sId + '-plotset-plot-' + p + '-node-' + d;
							ZC.ZCHtmlUtils._remove_(
								[
									sNodeId + '-marker-gradient',
									sNodeId + '-marker-path',
									sNodeId + '-marker-sh-path',
									sNodeId + '-marker-circle',
									sNodeId + '-marker-sh-circle'
								]
							);
						}
					}
				}
			}
		}
		self.oAttributes['datalength'] = null;

		
		for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
			self.bAnimation = self.bAnimation || self.oPlotSet.aPlots[i].bAnimation;
		}
		if (self.bDisableAnimation || typeof(ZC.ZCTweenManager) === 'undefined') {
			self.bAnimation = false;
		}
		if (self.bAnimation) {
			self.oTweenManager.onStop = function() {
				self.sStage = 'ready';
			};
		}

		

		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.oZoom = new ZC.ZCBox(self);
			self.oZoom.sId = self.sId + '-zoom';
			oDefaults.load(self.oZoom.oData, sGraphType + '.zoom');
			self.oZoom.append(self.oData['zoom']);

			self.oTooltip = new ZC.ZCTextBox(self);
			self.oTooltip.sTag = 'tooltip';
			oDefaults.load(self.oTooltip.oData, sGraphType + '.tooltip');
			self.oTooltip.append(self.oData['tooltip']);
			self.oTooltip.bIgnoreLocate = true;
			self.oTooltip.parse();

			if (ZC._n_(mValue=self.oData['guide']) !== null) {
				self.oData['crosshair-x'] = mValue;
			}
			if ((ZC._n_(mValue=self.oData['crosshair-x']) !== null || oDefaults.featureEnabled('guide', self.sType) || oDefaults.featureEnabled('crosshair-x', self.sType)) && self.oSettings['enable-guide']) {
				self.oCrosshairX = new ZC.ZCStyle(self);
				self.oCrosshairX.sTag = 'crosshairx';
				oDefaults.load(self.oCrosshairX.oData, [
					sGraphType + '.guide',
					sGraphType + '.crosshair-x'
				], true, true);
				self.oCrosshairX.append(mValue);
				self.oCrosshairX.parse();
			}
			if ((ZC._n_(mValue=self.oData['crosshair-y']) !== null || oDefaults.featureEnabled('crosshair-y', self.sType)) && self.oSettings['enable-guide']) {
				self.oCrosshairY = new ZC.ZCStyle(self);
				self.oCrosshairY.sTag = 'crosshairy';
				oDefaults.load(self.oCrosshairY.oData, [
					sGraphType + '.guide',
					sGraphType + '.crosshair-y'
				], true, true);
				self.oCrosshairY.append(mValue);
				self.oCrosshairY.parse();
			}
		}

		self.detectDynamicObjects();

		ZC.ZCUtils._trigger_event_('gparse', self.oParent, self._api_graph_info_());

		if (ZC._n_(mValue=self.oData['refresh']) !== null) {
			self.oRefresh = {
				type : 'full',
				interval : 10,
				transport : 'http',
				method : 'pull',
				'adjust-scale' : false,
				'max-ticks' : 20,
				'reset-timeout' : 100,
				'stop-timeout' : 0,
				storage : false,
				'storage-size' : 1000
			};
			ZC._cp_(mValue, self.oRefresh);
			self.iStackingLogic = 1;
		}
		self.sStage = 'parse.complete';
	},
	detectDynamicObjects : function() {
	},
	parseObjects : function() {
	},
	getClipPath : function(d, sOutput, oElement) {
		var self = this;
		oElement = oElement || self.oPlotArea;
		var x = oElement.iX, y = oElement.iY, w = oElement.iWidth, h = oElement.iHeight;
		if (sOutput === 'svg') {
			return [
				[x - d, y - d].join(','),
				[x + w + d, y - d].join(','),
				[x + w + d, y + h + d].join(','),
				[x - d, y + h + d].join(','),
				[x - d, y - d].join(',')
			].join(' ');
		} else {
			return 'rect(' + (y - d) + 'px,' + (x + w + d) + 'px,' + (y + h + d)  + 'px,' + (x - d) + 'px)';
		}
	},
	build : function() {
		var self = this, mValue, i, iLen, l, sClipPreview, sClipPathPreview;
		var sWH = self.oParent.iWidth + '/' + self.oParent.iHeight;
		var sTL = 0 + '/' + 0;

		if (!self.oLoader.usc()) {

			var iMaskTolerance = 2, iHoverMaskTolerance = 6;
			if (ZC._n_(mValue=self.oPlotArea.oData['mask-tolerance']) !== null) {
				if (mValue instanceof Array && mValue.length > 1) {
					iMaskTolerance = ZC._i_(mValue[0]);
					iHoverMaskTolerance = ZC._i_(mValue[1]);
				} else {
					iHoverMaskTolerance = ZC._i_(mValue);
				}
			}

			if (self.oParent.sOutput === 'svg' && !self.oSettings['3d'] && self.oSettings['clip']) {
				ZC.ZCHtmlUtils._remove_(
					[
						self.sId + '-clip',
						self.sId + '-clip-hover',
						self.sId + '-clip-preview'
					]
				);

				self.oParent.oSvg.appendChild(
					ZC.ZCHtmlUtils._svg_clip_({
						id : self.sId + '-clip',
						path : self.getClipPath(iMaskTolerance, 'svg')
					})
				);

				self.oParent.oSvg.appendChild(
					ZC.ZCHtmlUtils._svg_clip_({
						id : self.sId + '-clip-hover',
						path : self.getClipPath(iHoverMaskTolerance, 'svg')
					})
				);

				if (self.oPreview) {
					self.oParent.oSvg.appendChild(
						ZC.ZCHtmlUtils._svg_clip_({
							id : self.sId + '-clip-preview',
							path : self.getClipPath(0, 'svg', self.oPreview.oViewport)
						})
					);					
				}

			}

			var bNoClip = self.oSettings['3d'] || !self.oSettings['clip'];
			var sClip = bNoClip?null:self.getClipPath(iMaskTolerance);
			var sClipPath = bNoClip?null:('url(#' + self.sId + '-clip)');
			var sClipHover = bNoClip?null:self.getClipPath(iHoverMaskTolerance);
			var sClipPathHover = bNoClip?null:('url(#' + self.sId + '-clip-hover)');
			if (self.oPreview) {
				sClipPreview = bNoClip?null:self.getClipPath(0, self.oParent.sOutput, self.oPreview.oViewport);
				sClipPathPreview = bNoClip?null:('url(#' + self.sId + '-clip-preview)');
			}

			ZC.ZCHtmlUtils._group_({
				cls : 'zc-abs',
				id : self.sId,
				p : ZC._id_(self.oParent.sId + '-graphset'),
				tl : sTL,
				wh : sWH
			}, self.oParent.sOutput);
			if (self.oParent.oLayers['graph']) {
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer' + ' zc-persistent',
					id : self.sId + '-c',
					p : ZC._id_(self.sId),
					wh : sWH
				}, self.oParent.sOutput);
			}
			ZC.ZCHtmlUtils._group_({
				id : self.sId + '-plotarea',
				p : ZC._id_(self.sId),
				tl : sTL,
				wh : sWH,
				position : 'absolute',
				'clip-path' : sClipPath,
				clip : sClip
			}, self.oParent.sOutput);
			if (self.oData['plotarea'] && self.oParent.oLayers['plotarea']) {
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-plotarea-c',
					p : ZC._id_(self.sId + '-plotarea'),
					wh : sWH
				}, self.oParent.sOutput);
			}
			if (self.oData['title'] || self.oData['subtitle'] || self.oData['source']) {
				ZC.ZCHtmlUtils._group_({
					id : self.sId + '-titles',
					p : ZC._id_(self.sId),
					tl : sTL,
					wh : sWH,
					position : 'absolute'
				}, self.oParent.sOutput);
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-titles-c',
					p : ZC._id_(self.sId + '-titles'),
					wh : sWH
				}, self.oParent.sOutput);
			}
			
			if (self.sType !== 'null' && self.oParent.oLayers['plots']) {

				ZC.ZCHtmlUtils._group_({
					id : self.sId + '-scales-bl',
					p : ZC._id_(self.sId),
					tl : sTL,
					wh : sWH,
					position : 'absolute',
					'clip-path' : sClipPath,
					clip : sClip
				}, self.oParent.sOutput);
				for (i=0;i<self.iScalesBackLayers;i++) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer',
						id : self.sId + '-scales-bl-' + i + '-c',
						p : ZC._id_(self.sId + '-scales-bl'),
						wh : sWH
					}, self.oParent.sOutput);
				}

				if (self.oParent.bFlat || self.oSettings['3d']) {
					if (!ZC._id_(self.sId + '-plots-bl')) {
						ZC.ZCHtmlUtils._group_({
							id : self.sId + '-plots-bl',
							p : ZC._id_(self.sId),
							tl : sTL,
							wh : sWH,
							position : 'absolute',
							'clip-path' : sClipPath,
							clip : sClip
						}, self.oParent.sOutput);
					}
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer zc-bl',
						id : self.sId + '-plots-bl-c',
						p : ZC._id_(self.sId + '-plots-bl'),
						wh : sWH
					}, self.oParent.sOutput);
				} else {
					for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
						for (l=0;l<self.oPlotSet.aPlots[i].iBackLayers;l++) {
							if (!ZC._id_(self.sId + '-plots-bl-' + l)) {
								ZC.ZCHtmlUtils._group_({
									id : self.sId + '-plots-bl-' + l,
									p : ZC._id_(self.sId),
									tl : sTL,
									wh : sWH,
									position : 'absolute',
									'clip-path' : sClipPath,
									clip : sClip
								}, self.oParent.sOutput);
							}
							ZC.ZCQuery('#' + self.sId + '-plot-' + i + '-bl-' + l + '-c').show();
							ZC.ZCHtmlUtils._layer_({
								cls : 'zc-abs zc-layer zc-bl',
								id : self.sId + '-plot-' + i + '-bl-' + l + '-c',
								p : ZC._id_(self.sId + '-plots-bl-' + l),
								wh : sWH
							}, self.oParent.sOutput);
						}
					}
				}

				for (i=0;i<self.iScalesMiddleLayers;i++) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer',
						id : self.sId + '-scales-ml-' + i + '-c',
						p : ZC._id_(self.sId),
						wh : sWH
					}, self.oParent.sOutput);
				}

				if (self.oParent.bFlat || self.oSettings['3d']) {
					if (!ZC._id_(self.sId + '-plots-fl')) {
						ZC.ZCHtmlUtils._group_({
							id : self.sId + '-plots-fl',
							p : ZC._id_(self.sId),
							tl : sTL,
							wh : sWH,
							position : 'absolute'
						}, self.oParent.sOutput);
					}
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer zc-fl',
						id : self.sId + '-plots-fl-c',
						p : ZC._id_(self.sId + '-plots-fl'),
						wh : sWH
					}, self.oParent.sOutput);
				} else {
					for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
						for (l=0;l<self.oPlotSet.aPlots[i].iFrontLayers;l++) {
							if (!ZC._id_(self.sId + '-plots-fl-' + l)) {
								ZC.ZCHtmlUtils._group_({
									id : self.sId + '-plots-fl-' + l,
									p : ZC._id_(self.sId),
									tl : sTL,
									wh : sWH,
									position : 'absolute'
								}, self.oParent.sOutput);
							}
							ZC.ZCQuery('#' + self.sId + '-plot-' + i + '-fl-' + l + '-c').show();
							ZC.ZCHtmlUtils._layer_({
								cls : 'zc-abs zc-layer zc-fl',
								id : self.sId + '-plot-' + i + '-fl-' + l + '-c',
								p : ZC._id_(self.sId + '-plots-fl-' + l),
								wh : sWH
							}, self.oParent.sOutput);
						}
					}
				}

				ZC.ZCHtmlUtils._group_({
					id : self.sId + '-scales-fl',
					p : ZC._id_(self.sId),
					tl : sTL,
					wh : sWH,
					position : 'absolute',
					'clip-path' : sClipPath,
					clip : sClip
				}, self.oParent.sOutput);

				for (i=0;i<self.iScalesFrontLayers;i++) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs zc-layer',
						id : self.sId + '-scales-fl-' + i + '-c',
						p : ZC._id_(self.sId + '-scales-fl'),
						wh : sWH
					}, self.oParent.sOutput);
				}

				if (self.oPreview) {
					ZC.ZCHtmlUtils._group_({
						id : self.sId + '-preview',
						p : ZC._id_(self.oParent.sId + '-tools'),
						tl : sTL,
						wh : sWH,
						position : 'absolute',
						'clip-path' : sClipPathPreview,
						clip : sClipPreview
					}, self.oParent.sOutput);
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs',
						id : self.sId + '-preview-c',
						p : ZC._id_(self.sId + '-preview'),
						wh : sWH
					}, self.oParent.sOutput);
				}

				ZC.ZCHtmlUtils._group_({
					id : self.sId + '-scroll',
					p : ZC._id_(self.sId),
					tl : sTL,
					wh : sWH,
					position : 'absolute'
				}, self.oParent.sOutput);
				if (self.oData['scroll-x']) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs',
						id : self.sId + '-scroll-x-c',
						p : ZC._id_(self.sId + '-scroll'),
						wh : sWH
					}, self.oParent.sOutput);
				}
				if (self.oData['scroll-y']) {
					ZC.ZCHtmlUtils._layer_({
						cls : 'zc-abs',
						id : self.sId + '-scroll-y-c',
						p : ZC._id_(self.sId + '-scroll'),
						wh : sWH
					}, self.oParent.sOutput);
				}
				ZC.ZCHtmlUtils._group_({
					id : self.sId + '-plots-vb',
					p : ZC._id_(self.sId),
					tl : sTL,
					wh : sWH,
					position : 'absolute'
				}, self.oParent.sOutput);

				
				if (self.oParent.oLayers['value-box']) {
					if (self.oParent.bFlat || self.oSettings['3d']) {
						ZC.ZCHtmlUtils._layer_({
							cls : 'zc-abs zc-layer zc-vb',
							id : self.sId + '-plots-vb-c',
							p : ZC._id_(self.sId + '-plots-vb'),
							wh : sWH
						}, self.oParent.sOutput);
					} else {
						for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
							ZC.ZCHtmlUtils._layer_({
								cls : 'zc-abs zc-layer zc-vb',
								id : self.sId + '-plot-' + i + '-vb-c',
								p : ZC._id_(self.sId + '-plots-vb'),
								wh : sWH
							}, self.oParent.sOutput);
						}
					}
				}

			}

			ZC.ZCHtmlUtils._group_({
				cls : 'zc-abs',
				wh : sWH,
				id : self.sId + '-hover',
				p : ZC._id_(self.oParent.sId + '-hover'),
				'clip-path' : sClipPathHover,
				clip : sClipHover
			}, self.oParent.sOutput);
			if (self.oParent.sOutput === 'canvas') {
				ZC._id_(self.sId + '-hover').style.clip = sClipHover;
			}
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-hover-c',
				p : ZC._id_(self.sId + '-hover'),
				wh : sWH
			}, self.oParent.sOutput);

			if (self.oParent.oAttributes['json'].indexOf('zingchart.maps') !== -1) {
				ZC.ZCHtmlUtils._group_({
					cls : 'zc-abs',
					wh : sWH,
					id : self.sId + '-objects-maps',
					p : ZC._id_(self.oParent.sId + '-objects-maps')
				}, self.oParent.sOutput);
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-objects-maps-sh-c',
					p : ZC._id_(self.sId + '-objects-maps'),
					wh : sWH
				}, self.oParent.sOutput);			
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-objects-maps-c',
					p : ZC._id_(self.sId + '-objects-maps'),
					wh : sWH
				}, self.oParent.sOutput);
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-objects-maps-hover-c',
					p : ZC._id_(self.sId + '-objects-maps'),
					wh : sWH
				}, self.oParent.sOutput);
			}

			self.initObjectsLayers();

			

			if (self.oData['legend']) {
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-legend-c',
					p : ZC._id_(self.oParent.sId + '-legend'),
					wh : sWH
				}, self.oParent.sOutput);
				
				ZC.ZCHtmlUtils._layer_({
					cls : 'zc-abs zc-layer',
					id : self.sId + '-legend-scroll-c',
					p : ZC._id_(self.oParent.sId + '-legend'),
					wh : sWH
				}, self.oParent.sOutput);
			}
		}

		self.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.sId + '-c');
		
		
		
	},
	initObjectsLayers : function() {
		var self = this;
		var sWH = self.oParent.iWidth + '/' + self.oParent.iHeight;

		if (!ZC._id_(self.sId + '-objects-bottom') && self.oParent.oLayers['objects-bottom'] && (self.oData['shapes'] || self.oData['labels'] || self.oData['arrows'] || self.oData['images'])) {
			ZC.ZCHtmlUtils._group_({
				cls : 'zc-abs',
				wh : sWH,
				id : self.sId + '-objects-bottom',
				p : ZC._id_(self.oParent.sId + '-objects-bottom')
			}, self.oParent.sOutput);
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-bottom-sh-c',
				p : ZC._id_(self.sId + '-objects-bottom'),
				wh : sWH
			}, self.oParent.sOutput);
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-bottom-c',
				p : ZC._id_(self.sId + '-objects-bottom'),
				wh : sWH
			}, self.oParent.sOutput);
		}

		if (!ZC._id_(self.sId + '-objects-top') && self.oParent.oLayers['objects-top'] && (self.oData['shapes'] || self.oData['labels'] || self.oData['arrows'] || self.oData['images'])) {
			ZC.ZCHtmlUtils._group_({
				cls : 'zc-abs',
				wh : sWH,
				id : self.sId + '-objects-top',
				p : ZC._id_(self.oParent.sId + '-objects-top')
			}, self.oParent.sOutput);				
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-top-sh-c',
				p : ZC._id_(self.sId + '-objects-top'),
				wh : sWH
			}, self.oParent.sOutput);
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-top-c',
				p : ZC._id_(self.sId + '-objects-top'),
				wh : sWH
			}, self.oParent.sOutput);
		}

		if ((self.oParent.oLayers['objects-bottom'] || self.oParent.oLayers['objects-top']) && (self.oData['shapes'] || self.oData['labels'] || self.oData['arrows'])) {
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-print-c',
				p : ZC._id_(self.sId + '-objects-top'),
				wh : sWH,
				display : 'none'
			}, self.oParent.sOutput);
		}

		if (!ZC._id_(self.sId + '-objects-click') && (self.oParent.oLayers['objects-bottom'] || self.oParent.oLayers['objects-top']) && (self.oData['shapes'] || self.oData['labels'] || self.oData['arrows'] || self.oData['images'])) {
			ZC.ZCHtmlUtils._group_({
				cls : 'zc-abs',
				wh : sWH,
				id : self.sId + '-objects-click',
				p : ZC._id_(self.oParent.sId + '-hover')
			}, self.oParent.sOutput);
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-click-c',
				p : ZC._id_(self.sId + '-objects-click'),
				wh : sWH
			}, self.oParent.sOutput);
		}

		if (!ZC._id_(self.sId + '-objects-hover') && (self.oParent.oLayers['objects-bottom'] || self.oParent.oLayers['objects-top']) && (self.oData['shapes'] || self.oData['labels'] || self.oData['arrows'] || self.oData['images'])) {
			ZC.ZCHtmlUtils._group_({
				cls : 'zc-abs',
				wh : sWH,
				id : self.sId + '-objects-hover',
				p : ZC._id_(self.oParent.sId + '-hover')
			}, self.oParent.sOutput);
			ZC.ZCHtmlUtils._layer_({
				cls : 'zc-abs zc-layer',
				id : self.sId + '-objects-hover-c',
				p : ZC._id_(self.sId + '-objects-hover'),
				wh : sWH
			}, self.oParent.sOutput);
		}
	},
	clearObjects : function() {
	},
	clear_ : function() {
	},
	destroy : function() {
		
		var self = this, mValue;

		if (ZC._n_(mValue=self.oParent.oSockets[self.sId]) !== null) {
			if (self.oRefresh['type'] === 'feed') {
				mValue.send('zingchart.stopfeed');
				mValue.close();
				self.oParent.oSockets[self.sId] = null;
			}
		}

		if (self.bAnimation) {
			self.oTweenManager.stop(true);
		}

		self.sStage = 'clear.init';

		self.unbind();

		if (self.oLegend) {
			self.oLegend.unbind();
		}
		if (self.oPreview) {
			self.oPreview.unbind();
		}
		if (self.oScrollX) {
			self.oScrollX.unbind();
		}
		if (self.oScrollY) {
			self.oScrollY.unbind();
		}
		self.sStage = 'clear.complete';
	},
	clear : function(bSoftClear, bSmartPlots) {
		

		if (ZC._n_(bSoftClear) === null) { bSoftClear = false; }
		if (ZC._n_(bSmartPlots) === null) { bSmartPlots = false; }
		var self = this, mValue, i, iLen, aMatches;

		self.oClicks = {};

		if (ZC._n_(mValue=self.oParent.oSockets[self.sId]) !== null && !bSoftClear) {
			if (self.oRefresh['type'] === 'feed') {
				mValue.send('zingchart.stopfeed');
				mValue.close();
				self.oParent.oSockets[self.sId] = null;
			}
		}

		if (self.bAnimation) {
			self.oTweenManager.stop(true);
		}

		self.sStage = 'clear.init';

		self.unbind(bSoftClear);

		self.clearObjects(false, true);

		self.hideLayer();
		self.hideLayer('click');
		self.hideLayer('guide', true);
		self.hideLayer('print', true);
		if (!bSoftClear) {
			if (!self.oPreview || (self.oPreview && !self.oPreview.bAsync)) {
				self.hideLayer('static', true);
			}
		}
		
		if (!zingchart.SKIP.LEGEND) {
			if (self.oLegend) {
				self.oLegend.clear();
			}
		}
		self.oAttributes['datalength'] = [];

		
		

		var oRoot = ZC.ie67?ZC._id_(self.oParent.sId):null;

		if (ZC.mobile || ZC.ie67) {
			
			ZC.ZCQuery('.' + self.sId + '-node-area', oRoot).remove();
		} else {
			
			if (ZC._id_(self.oParent.sId + '-img') && ZC._id_(self.oParent.sId + '-map')) {
				ZC._id_(self.oParent.sId + '-img').setAttribute('useMap', '');
				var oCloneMap = ZC._id_(self.oParent.sId + '-map').cloneNode(true);
				iLen = oCloneMap.childNodes.length;
				for (i=iLen-1;i>=0;i--) {
					if (oCloneMap.childNodes[i].className.indexOf(self.sId + '-node-area') !== -1) {
						oCloneMap.removeChild(oCloneMap.childNodes[i]);
					}
				}
				ZC.ZCHtmlUtils._remove_(self.oParent.sId + '-map');
				ZC._id_(self.oParent.sId + '-top').appendChild(oCloneMap);
				ZC._id_(self.oParent.sId + '-img').setAttribute('useMap', '#' + self.oParent.sId + '-map');
			}
		}
		
		self.oPlotSet.aAreas = [];

		ZC.ZCQuery('.' + self.sId + '-value-box', oRoot).remove();
		ZC.ZCQuery('.' + self.sId + '-scale-marker-label', oRoot).remove();
		ZC.ZCQuery('.' + self.sId + '-scale-item', oRoot).remove();
		ZC.ZCQuery('.' + self.sId + '-scale-label', oRoot).remove();
		ZC.ZCQuery('.' + self.sId + '-guide-label', oRoot).remove();
		ZC.ZCQuery('.' + self.sId + '-shape-label', oRoot).remove();

		
		

		switch (self.oParent.sOutput) {
			case 'svg':

				
				for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
					self.oPlotSet.aPlots[i].oClonedMarkerNode = null;
				}

				ZC.ZCQuery('#' + self.oParent.sId + '-defs').children().each(function() {
					if (this.id.indexOf(self.sId + '-') === 0 || self.oParent.aGraphs.length === 1) {
						if (!bSoftClear) {
							if (this.id.indexOf('zc-menu-') === -1 && this.id.indexOf('-menu-trigger-') === -1) {
								if (this.id.indexOf(self.sId + '-legend-') !== -1) {
									if (!zingchart.SKIP.LEGEND) {
										ZC.ZCQuery(this).remove();
									}
								} else {
									if (self.oPreview && self.oPreview.bAsync) {
										if (this.id.indexOf('-preview-gradient') === -1) {
											ZC.ZCQuery(this).remove();	
										}
									} else {
										ZC.ZCQuery(this).remove();
									}
								}
							}
						} else {
							if (this.id !== self.sId + '-gradient' && this.id.indexOf('-preview-gradient') === -1 && this.id.indexOf('-menu-trigger-gradient') === -1 && this.id.indexOf(self.sId + '-plotset-plot-') !== -1) {
								if (!bSmartPlots || !self.bAnimation) {
									if (this.id.indexOf(self.sId + '-legend-') !== -1) {
										if (!zingchart.SKIP.LEGEND) {
											ZC.ZCQuery(this).remove();
										}
									} else {
										ZC.ZCQuery(this).remove();
									}
								}
							}
						}
					}
				});
				if (!bSoftClear) {
					ZC.ZCHtmlUtils._remove_(
						[
							self.sId + '-clip',
							self.sId + '-clip-hover',
							self.sId + '-clip-preview'
						]
					);
				}
				
				ZC.ZCQuery('#' + self.oParent.sId + '-svg').children().each(function() {
					var sCPId = self.sId + '-';
					if (this.tagName.toLowerCase() === 'clippath' && this.id.substring(0, sCPId.length) === sCPId) {
						if (this.id !== self.sId + '-clip' && this.id !== self.sId + '-clip-hover' && this.id !== self.sId + '-clip-preview') {
							ZC.ZCHtmlUtils._remove_(this.id);
						}
					}
				});
				break;
		}

		
		

		ZC.ZCHtmlUtils._remove_(self.sId + '-nodata');

		if (!bSoftClear) {
			ZC.ZCHtmlUtils._remove_(
				[
					self.sId + '-title',
					self.sId + '-subtitle',
					self.sId + '-source',
					self.sId + '-hover'
				]
			);

			if (!zingchart.SKIP.LEGEND) {
				ZC.ZCHtmlUtils._remove_(self.sId + '-legend-c');
				ZC.ZCHtmlUtils._remove_(self.sId + '-legend-scroll-c');
				ZC.ZCQuery('.' + self.sId + '-legend-item-area', oRoot).remove();
				ZC.ZCQuery('.' + self.sId + '-legend-marker-area', oRoot).remove();
				ZC.ZCQuery('.' + self.sId + '-legend-item', oRoot).remove();
				ZC.ZCQuery('.' + self.sId + '-legend-header', oRoot).remove();
				ZC.ZCQuery('.' + self.sId + '-legend-footer', oRoot).remove();
			}
			
			if (self.oPreview) {
				if (!self.oPreview.bAsync) {
					self.oPreview.unbind();
					ZC.ZCQuery('.' + self.sId + '-preview-handler').remove();
					ZC.ZCQuery('.' + self.sId + '-preview-mask').remove();
					ZC.ZCQuery('#' + self.sId + '-preview').remove();
				}
			}

			if (self.oScrollX) {
				self.oScrollX.unbind();
			}

			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-scroll-x-c'), self.oParent.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-scroll-y-c'), self.oParent.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);

			ZC.ZCQuery('#' + self.sId + '-scroll-x-handle').remove();
			ZC.ZCQuery('#' + self.sId + '-scroll-x-bar').remove();

			if (self.oScrollY) {
				self.oScrollY.unbind();
			}
			ZC.ZCQuery('#' + self.sId + '-scroll-y-handle').remove();
			ZC.ZCQuery('#' + self.sId + '-scroll-y-bar').remove();

			ZC.ZCQuery('#' + self.sId + '-c').empty();

			if (self.oLoader.aStructure[0] !== self.oLoader.aStructure[1] && self.oLoader.aStructure[1] !== '') {
				if (self.oLoader.sOutput === 'canvas') {
					ZC.ZCQuery('#' + self.sId + ' canvas').each(function() {
						this.width = 1;
						this.height = 1;
						ZC.ZCHtmlUtils._remove_(this);
					});
				}
				ZC.ZCQuery('#' + self.sId + ' div').each(function() {
					ZC.ZCHtmlUtils._remove_(this);
				});

				ZC.ZCHtmlUtils._remove_(self.sId);
			}
		}

		ZC.ZCQuery('#' + self.sId + ' .zc-layer').each(function() {
			var sClassName = ZC.ZCHtmlUtils._class_(this);
			if (sClassName.indexOf('zc-persistent') === -1) {
				
				if (bSoftClear && (this.id === self.sId + '-plotarea-c' || this.id === self.sId + '-titles-c')) {
					return;
				}
				if (this.id.indexOf(self.sId + '-plot-') === -1 && this.id.indexOf(self.sId + '-plots-') === -1) {
					ZC.ZCHtmlUtils._clear_(this, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
				} else {
					if (bSmartPlots && self.bAnimation && !self.bDisableAnimation) {
						if (self.oLoader.sOutput !== 'canvas') {
							for (var i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
								self.oAttributes['datalength'][i] = self.oPlotSet.aPlots[i].aPlotNodes.length;
							}
						}
						if (self.oParent.bFlat) {
							aMatches = (new RegExp('\-plots\-[a-z]+\-c', 'g')).exec(this.id);
						} else {
							aMatches = (new RegExp('\-plot\-(\\d+)\-[a-z]+\-\\d+\-', 'g')).exec(this.id);
						}
						if (aMatches) {
							if ((!self.oAttributes['plot'+aMatches[1]+'.visible'] && self.getToggleAction() === 'remove') || self.oParent.bFlat) {
								ZC.ZCHtmlUtils._clear_(this, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
							}
						}
						if (sClassName.indexOf('zc-vb') !== -1 || sClassName.indexOf('zc-fl') !== -1) {
							ZC.ZCHtmlUtils._clear_(this, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
						}
					} else {
						ZC.ZCHtmlUtils._clear_(this, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
					}
				}
			}
		});

		

		
		if (ZC._indexof_(self.oLoader.aFlags, 'use_single_canvas') !== -1) {
			var oMainC, oMainCTop, oPrintC;
			if ((oMainC = ZC._id_(self.oLoader.sId + '-main-c'))) {
				ZC.ZCHtmlUtils._clear_(oMainC, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			}
			if ((oMainCTop = ZC._id_(self.oLoader.sId + '-main-c-top'))) {
				ZC.ZCHtmlUtils._clear_(oMainCTop, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			}
			if ((oPrintC = ZC._id_(self.oLoader.sId + '-print-c'))) {
				ZC.ZCHtmlUtils._clear_(oPrintC, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			}
		}

		self.clear_();
		self.sStage = 'clear.complete';
	},
	unbind : function(bSoftClear) {
		if (ZC._n_(bSoftClear) === null) { bSoftClear = false; }
		var self = this;
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			ZC.ZCQuery('.' + self.sId + '-node-area')
				.die('mousedown mouseover touchstart', self.zc_node_mouseover)
				.die('mouseup mouseout touchend', self.zc_node_mouseout)
				.die('mousemove touchmove', self.zc_node_mousemove)
				.die('click', self.zc_node_click)
				.die('contextmenu', self.zc_node_click)
				.die('dblclick', self.zc_node_dblclick);
			if (!bSoftClear) {
				if (self.oLegend) {
					if (!zingchart.SKIP.LEGEND) {
						ZC.ZCQuery('.' + self.sId + '-legend-item-area').die('mouseup touchstart', self.zc_legend_item_click);
						ZC.ZCQuery('.' + self.sId + '-legend-marker-area').die('mouseup touchstart', self.zc_legend_item_click);

						if (!ZC.mobile) {
							ZC.ZCQuery('.' + self.sId + '-legend-item-area')
								.die(ZC.ZCHtmlUtils._event_('mouseover'), self.zc_legend_item_mouseover)
								.die(ZC.ZCHtmlUtils._event_('mouseout'), self.zc_legend_item_mouseout)
								.die(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_item_mousemove_tt);
							ZC.ZCQuery('.' + self.sId + '-legend-marker-area')
								.die(ZC.ZCHtmlUtils._event_('mouseover'), self.zc_legend_item_mouseover)
								.die(ZC.ZCHtmlUtils._event_('mouseout'), self.zc_legend_item_mouseout)
								.die(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_item_mousemove_tt);
						}
					}
				}
			}
			self.unbindObjects();
		}
	},
	unbindObjects : function() {
	},
	paint3D : function() {
	},
	repaintObjects : function() {
	},
	paintObjects : function() {
	},
	showObjectsLayer : function() {
	},
	bindObjects : function() {
	},
	hideLayer : function(sLayer, bTopLayer) {
		var self = this;
		sLayer = sLayer || 'hover';
		if (ZC._n_(bTopLayer) === null) {
			bTopLayer = false;
		}
		var oLayer = ZC._id_((bTopLayer?self.oParent.sId:self.sId) + '-' + sLayer + '-c');
		if (oLayer) {
			ZC.ZCHtmlUtils._clear_(oLayer, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			ZC.ZCQuery('.' + self.sId + '-label-hover').remove();
		}
		if (sLayer === 'hover') {
			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-objects-hover-c'), self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-objects-maps-hover-c'), self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
		}
		if (sLayer === 'click') {
			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-objects-click-c'), self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
			ZC.ZCHtmlUtils._clear_(ZC._id_(self.sId + '-objects-maps-click-c'), self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
		}
		self.hideLayer_(sLayer, bTopLayer);
	},
	hideLayer_ : function() {
	},
	updateSelection : function(iPlotIndex, iNodeIndex) {
		var self = this, pp;
		if (ZC._n_(iPlotIndex) !== null && ZC._n_(iNodeIndex) !== null) {
			var sSelectionMode = self.oPlotSet.aPlots[iPlotIndex].sSelectionMode;
			var bGroupSelections = self.oPlotSet.aPlots[iPlotIndex].bGroupSelections;
			if (sSelectionMode === 'none') {
				return;
			}
			if (ZC._n_(self.oSelection['p'+iPlotIndex]) !== null) {
				if (ZC._n_(self.oSelection['p'+iPlotIndex]['n'+iNodeIndex]) !== null) {
					delete self.oSelection['p'+iPlotIndex]['n'+iNodeIndex];
					if (bGroupSelections) {
						for (pp=0;pp<self.oPlotSet.aPlots.length;pp++) {
							delete self.oSelection['p'+pp]['n'+iNodeIndex];
						}
					}
				} else {
					if (sSelectionMode === 'graph') {
						self.oSelection = {};
						self.oSelection['p'+iPlotIndex] = {};
					} else if (sSelectionMode === 'plot') {
						self.oSelection['p'+iPlotIndex] = {};
					}
					self.oSelection['p'+iPlotIndex]['n'+iNodeIndex] = true;
					if (bGroupSelections) {
						for (pp=0;pp<self.oPlotSet.aPlots.length;pp++) {
							self.oSelection['p'+pp] = self.oSelection['p'+pp] || {};
							self.oSelection['p'+pp]['n'+iNodeIndex] = true;
						}
					}
				}
			} else {
				if (sSelectionMode === 'graph') {
					self.oSelection = {};
				}
				self.oSelection['p'+iPlotIndex] = {};
				self.oSelection['p'+iPlotIndex]['n'+iNodeIndex] = true;
				if (bGroupSelections) {
					for (pp=0;pp<self.oPlotSet.aPlots.length;pp++) {
						self.oSelection['p'+pp] = self.oSelection['p'+pp] || {};
						self.oSelection['p'+pp]['n'+iNodeIndex] = true;
					}
				}
			}
		}

		if (ZC._n_(iPlotIndex) !== null && ZC._n_(iNodeIndex) !== null) {
			self.bDisableAnimation = true;
			self.repaint(true, true);
		}
	},
	paint : function(bSoftPaint) {
		if (ZC._n_(bSoftPaint) === null) { bSoftPaint = false; }
		var self = this, mValue, p, pLen, oCTSS, i, iLen;
		self.oParent.GRAPHID = self.sId;
		self.bSoftPaint = bSoftPaint;

		self.bSelection = false;
		for (p=0,pLen=self.oPlotSet.aPlots.length;p<pLen;p++) {
			self.aSelection[p] = false;
		}
		for (p in self.oSelection) {
			if (self.oSelection.hasOwnProperty(p)) {
				var pp = ZC._i_(p.replace('p', ''));
				for (var n in self.oSelection[p]) {
					if (self.oSelection[p].hasOwnProperty(n)) {
						self.aSelection[pp] = true;
						self.bSelection = true;
						break;
					}
				}
			}
		}

		self.oParent.hideProgress();

		self.setup3DView();

		function _plotarea_paint_() {
			if (self.oSettings['3d']) {
				var oMathFace = ZC.ZCMath3D._create_3d_face_(self.oPlotArea, self, self.oPlotArea.iX - ZC.ZCDraw3D.iViewX, self.oPlotArea.iX - ZC.ZCDraw3D.iViewX + self.oPlotArea.iWidth, self.oPlotArea.iY - ZC.ZCDraw3D.iViewY, self.oPlotArea.iY - ZC.ZCDraw3D.iViewY + self.oPlotArea.iHeight, ZC.ZCDraw3D.iDepth+10, ZC.ZCDraw3D.iDepth+10, 'y');
				var oFace = ZC.ZCMath3D._create_3d_face_(self.oPlotArea, self, self.oPlotArea.iX - ZC.ZCDraw3D.iViewX, self.oPlotArea.iX - ZC.ZCDraw3D.iViewX + self.oPlotArea.iWidth, self.oPlotArea.iY - ZC.ZCDraw3D.iViewY, self.oPlotArea.iY - ZC.ZCDraw3D.iViewY + self.oPlotArea.iHeight, ZC.ZCDraw3D.iDepth, ZC.ZCDraw3D.iDepth, 'y');
				oFace.sId = self.sId + '-plotarea';
				oFace.aMathPoints = oMathFace.aPoints;
				self.oEngine3D.add(oFace);
			} else {
				self.oPlotArea.oCanvas = self.oPlotArea.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.sId + '-plotarea-c');
				

				
				
				var aPAInfo = [self.oPlotArea.iX, self.oPlotArea.iY, self.oPlotArea.iWidth, self.oPlotArea.iHeight];
				var aInfo, iBT = self.iBorderWidth, iBR = self.iBorderWidth, iBB = self.iBorderWidth, iBL = self.iBorderWidth;
				if ((mValue=self.oPlotArea.sBorderTop) !== '') {
					aInfo = mValue.split(/\s/);
					iBT = ZC._i_(aInfo[0]);
				}
				if ((mValue=self.oPlotArea.sBorderRight) !== '') {
					aInfo = mValue.split(/\s/);
					iBR = ZC._i_(aInfo[0]);
				}
				if ((mValue=self.oPlotArea.sBorderBottom) !== '') {
					aInfo = mValue.split(/\s/);
					iBB = ZC._i_(aInfo[0]);
				}
				if ((mValue=self.oPlotArea.sBorderLeft) !== '') {
					aInfo = mValue.split(/\s/);
					iBL = ZC._i_(aInfo[0]);
				}

				self.oPlotArea.iX -= iBL;
				self.oPlotArea.iY -= iBT;
				self.oPlotArea.iWidth += iBL + iBR;
				self.oPlotArea.iHeight += iBT + iBB;

				self.oPlotArea.paint();

				
				self.oPlotArea.iX = aPAInfo[0];
				self.oPlotArea.iY = aPAInfo[1];
				self.oPlotArea.iWidth = aPAInfo[2];
				self.oPlotArea.iHeight = aPAInfo[3];
			}
		}

		if (!self.bSoftPaint) {
			self.build();

			if (self.oCanvas) {
				self.oCanvasSh = self.oCanvas;
				self._super();
			}

			_plotarea_paint_();
			
		} else {
			if (self.oAttributes['plotarea.paint']) {
				_plotarea_paint_();
				self.oAttributes['plotarea.paint'] = null;
			}
		}

		
		for (i=0,iLen=self.aScales.length;i<iLen;i++) {
			self.aScales[i].oCanvas = self.aScales[i].oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.sId + '-scales-bl-0-c');
			

			self.oParent.bCache = true;
			self.aScales[i].paint();
			self.oParent.flushCache();
			self.oParent.bCache = false;

			
		}
		

		var bSharedZoom = (typeof(self.oAttributes['shared-zoom']) !== 'undefined' && ZC._n_(self.oAttributes['shared-zoom']) !== null)?self.oAttributes['shared-zoom']:false;
		if (self.oPreview && self.oPreview.bAsync) {
			if (self.oPreview.bInit) {
				self.oPreview.bInit = true;
				self.oPreview.paint();				
			}
		} else {
			if (!self.oAttributes['skip-preview'] && self.oPreview && (!self.bSoftPaint || self.oPreview.bInit) && !bSharedZoom) {
				self.oPreview.bInit = true;
				self.oPreview.paint();
			}
		}
		self.oAttributes['shared-zoom'] = null;
		self.oAttributes['skip-preview'] = null;

		if (self.oScrollX) {
			self.oScrollX.paint();
		}
		if (self.oScrollY) {
			self.oScrollY.paint();
		}

		if (!self.bSoftPaint) {
			
			oCTSS = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.sId + '-titles-c');
			
			if (self.oTitle) {
				if (self.oTitle.bVisible && ZC._n_(self.oTitle.sText) !== null) {
					self.oTitle.oCanvas = self.oTitle.oCanvasSh = oCTSS;
					self.oTitle.paint();
				}
			}
			if (self.oSubtitle) {
				if (self.oSubtitle.bVisible && ZC._n_(self.oSubtitle.sText) !== null) {
					self.oSubtitle.oCanvas = self.oSubtitle.oCanvasSh = oCTSS;
					self.oSubtitle.paint();
				}
			}
			if (self.oSource) {
				if (self.oSource.bVisible && ZC._n_(self.oSource.sText) !== null) {
					self.oSource.oCanvas = self.oSource.oCanvasSh = oCTSS;
					self.oSource.paint();
				}
			}
			if (self.oNoData) {
				if (self.oNoData.bVisible && ZC._n_(self.oNoData.sText) !== null) {
					self.oNoData.oCanvas = self.oNoData.oCanvasSh = oCTSS;
					self.oNoData.paint();
				}
			}
		}
		if (self.oTitle) {
			self.oTitle.paintPrintVersion();
		}
		if (self.oSubtitle) {
			self.oSubtitle.paintPrintVersion();
		}
		if (self.oSource) {
			self.oSource.paintPrintVersion();
		}

		if (!self.oSettings['3d']) {
			self.paintLegend();
		}

		self.oParent.bCache = !self.bAnimation;

		if (self.oParent.oAttributes['graph.'+self.sId+'.disableanimation']) {
			for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
				self.oPlotSet.aPlots[i].bAnimation = false;
			}
		}

		self.oPlotSet.paint();

		self.oLoader.paintHistory();

		
		
		
	},
	paintLegend : function() {
	},
	flatten : function() {
		var self = this, oCtx;
		
		
	},
	_end_ : function() {
		var self = this, mValue, i, iLen, sScaleIdx;

		self.oAttributes['toggle-action-remove'] = null;

		if (!self.bAnimation) {
			self.oParent.flushCache();
		}
		self.oParent.bCache = false;

		if (!self.bAnimation || self.oLoader.oAttributes['graph.'+self.sId+'.disableanimation'] || !self.oSettings['enable-animation'] || ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') !== -1 || zingchart.SKIP.ANIMATION) {
			self.sStage = 'ready';
		}

		if (self.sAnimateType === 'initial') {
			self.bAnimate = false;
			self.oLoader.oAttributes['graph.'+self.sId+'.disableanimation'] = true;
		}

		for (i=0,iLen=self.aScales.length;i<iLen;i++) {
			self.aScales[i].paint_();
		}

		ZC.ZCUtils._trigger_event_('objectsinit', self.oParent, self._api_graph_info_());

		

		if (!self.oSettings['3d']) {
			self.flatten();
			self.parseObjects();
			self.paintObjects();
			if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
				self.bindObjects();
			}
		}

		function _pn_(ev) {
			var sTargetId = ev.targetid || ev.target.id;
			var aNodeInfo = sTargetId.replace(/--([a-zA-Z0-9]+)/, '').split('-').reverse();
			var iPlotIndex, iNodeIndex;
			if (aNodeInfo[1] === 'node') {
				iPlotIndex = aNodeInfo[2];
				iNodeIndex = aNodeInfo[0];
			}
			return [iPlotIndex, iNodeIndex];
		}

		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {

			var oNodeArea = ZC.ZCQuery('.' + self.sId + '-node-area');

			self.zc_node_mouseover = function(ev) {
				if (ZC.move) { return; }
				if (self.oLegend && self.oLegend.bHoverLegend){ return; }
				if (ev.target.className.indexOf('zc-node-area') === -1) { return; }
				if (self.sStage !== 'ready') { return; }
				if (ZC.mobile) {
					
					self.oAttributes['node-target-id'] = ev.target.id;
					
					ZC.move = false;
					self.oLoader.hideCM();
					ev.preventDefault();
					self.oParent.trackTouchHold(ev);
				}

				var aPN = _pn_(ev);
				var oNode = self.oPlotSet.aPlots[aPN[0]].getNode(aPN[1]);
				if (!oNode) { return; }
				
				if (oNode.oStyle) {
					ZC.COLORS = [
						oNode.oStyle.sColor, 
						oNode.oStyle.sBackgroundColor1, 
						oNode.oStyle.sBackgroundColor2, 
						oNode.oStyle.sBorderColor, 
						oNode.oStyle.sLineColor
					];
					if (oNode.oStyleMarker) {
						ZC.COLORS.push(
							oNode.oStyleMarker.sBackgroundColor1, 
							oNode.oStyleMarker.sBackgroundColor2, 
							oNode.oStyleMarker.sBorderColor, 
							oNode.oStyleMarker.sLineColor
						);
					}
				} else {
					ZC.COLORS = [];
				}

				if (self.oAttributes['plot' + aPN[0] + '.visible']) {
					var sEvent = ZC.mobile?'mousedown':(ev.xtype || ev.type);
					if ((ZC.mobile || sEvent !== 'mousedown') && self.oParent.oTooltip && self.oTooltip && self.oTooltip.bVisible) {
						self.oParent.oTooltip.onmouseover(ev);
					}
					if (self.oPlotSet.aPlots[aPN[0]].sHoverMode  === 'plot'){
						for (i=0,iLen=self.oPlotSet.aPlots[aPN[0]].aPlotNodes.length;i<iLen;i++) {
							if (self.oPlotSet.aPlots[aPN[0]].aPlotNodes[i] !== null) {
								self.oPlotSet.aPlots[aPN[0]].getNode(i).showLayer();
							}
						}
					}
					else{
						oNode.showLayer();
					}
					
					oNode._api_node_event_(ev, sEvent);
					oNode.oParent._api_plot_event_(ev, sEvent);
					
					if (self.oLegend) {
						ZC.move = true;
						self.oLegend.highlightItem(aPN[0]);
						ZC.move = false;
					}
				}
			};
			oNodeArea.live('mousedown mouseover touchstart', self.zc_node_mouseover);

			self.zc_node_mouseout = function(ev) {
				if (ZC.move) { return; }
				if (self.oLegend && self.oLegend.bHoverLegend){ return; }
				var target = ev.target;
				
				if (ZC.mobile && document.elementFromPoint) {
					var aPageXY = ZC.ZCHtmlUtils._pagexy_(ev);
					var sx = ZC._i_(document.body.scrollLeft || '0');
					var sy = ZC._i_(document.body.scrollTop || '0');
					target = document.elementFromPoint(aPageXY[0] - sx, aPageXY[1] - sy);
					if (target && self.oAttributes['node-target-id'] && self.oAttributes['node-target-id'] !== target.id) {
						return;
					}
				}
				if (target.className.indexOf('zc-node-area') === -1) { return; }
				if (self.sStage !== 'ready') { return; }
				if (ZC.mobile) {
					self.oParent.zc_loader_kill_touchhold(ev);
				}
				var aPN = _pn_(ev);
				var oNode = self.oPlotSet.aPlots[aPN[0]].getNode(aPN[1]);
				if (!oNode) { return; }
				if (self.oAttributes['plot' + aPN[0] + '.visible']) {
					if (self.oParent.oTooltip && self.oTooltip && self.oTooltip.bVisible) {
						self.oParent.oTooltip.onmouseout(ev);
					}
					self.oPlotSet.aPlots[aPN[0]].aPoints = [];
					oNode.hideLayer();
					self.hideLayer();
					var sEvent = ZC.mobile?'mouseup':(ev.xtype || ev.type);
					oNode._api_node_event_(ev, sEvent);
					oNode.oParent._api_plot_event_(ev, sEvent);
					
					if (self.oLegend) {
						ZC.move = true;
						self.oLegend.highlightItem(-1);
						ZC.move = false;
					}
				}
				if (ZC.mobile && !self.oLoader.bCM && !ZC.move) {
					zingchart.zc_click(ev);
					self.zc_node_click(ev);
				}
			};
			oNodeArea.live('mouseup mouseout touchend', self.zc_node_mouseout);

			self.zc_node_mousemove = function(ev) {
				
				if (ev.target.className.indexOf('zc-node-area') === -1) { return; }
				if (self.sStage !== 'ready') { return; }
				if (ZC.mobile) { self.oParent.zc_loader_kill_touchhold(ev); }
				var aPN = _pn_(ev);
				if (self.oAttributes['plot' + aPN[0] + '.visible']) {
					if (self.oParent.oTooltip && self.oTooltip && self.oTooltip.bVisible) {
						self.oParent.oTooltip.onmousemove(ev);
					}
				}
			};
			oNodeArea.live('mousemove touchmove', self.zc_node_mousemove);

			self.zc_node_click = function(ev) {
				if (ev.target.className.indexOf('zc-node-area') === -1) { return; }
				if (self.sStage !== 'ready') { return; }
				var aPN = _pn_(ev);
				var oNode = self.oPlotSet.aPlots[aPN[0]].getNode(aPN[1]);
				if (oNode.oParent.sSelectionMode !== 'none') {
					self.oParent.oAttributes['preservezoom'] = true;
					self.updateSelection(oNode.oParent.iIndex, oNode.iIndex);
				}
				oNode._api_node_event_(ev, 'click');
				oNode.oParent._api_plot_event_(ev, 'click');

				if (ZC._n_(oNode.oParent.sUrl) !== null && oNode.oParent.sUrl !== 'NULL') {
					if (oNode.oParent.sUrl instanceof Array) {
						for (var u=0;u<oNode.oParent.sUrl.length;u++) {
							if (ZC._n_(oNode.oParent.sTarget[u]) !== null) {
								self._onclick_(ev, oNode.parseText(oNode.oParent.sUrl[u], null, null, true), oNode.oParent.sTarget[u]);
							}
						}
					} else {
						self._onclick_(ev, oNode.parseText(oNode.oParent.sUrl, null, null, true), oNode.oParent.sTarget);
					}
				}
			};
			self.zc_node_dblclick = function(ev) {
				if (ev.target.className.indexOf('zc-node-area') === -1) { return; }
				if (self.sStage !== 'ready') { return; }
				var aPN = _pn_(ev);
				var oNode = self.oPlotSet.aPlots[aPN[0]].getNode(aPN[1]);
				oNode._api_node_event_(ev, 'doubleclick');
				oNode.oParent._api_plot_event_(ev, 'doubleclick');
			};

			if (!ZC.mobile) {
				oNodeArea
					.live('click', self.zc_node_click)
					.live('contextmenu', self.zc_node_click)
					.live('dblclick', self.zc_node_dblclick);
			}
		}

		self.processRefresh();

		if (self.oParent.oAttributes['tr-ev-' + self.iIndex]) {
			self.oParent.oAttributes['tr-ev-' + self.iIndex] = null;
			self.triggerEvents();
		} else {
			self.triggerEvents();
		}
		
		if (self.bZoomTo) {
			self.bZoomTo = false;
			var oParams = {};
			for (i=0,iLen=self.getScales('k').length;i<iLen;i++) {
				var oScaleX = self.getScales('k')[i];
				if (ZC._n_(mValue=oScaleX.aZoomTo) !== null) {
					sScaleIdx = (oScaleX.iIndex===1)?'':('-'+oScaleX.iIndex);
					oParams['zoomx'+sScaleIdx] = true;
					oParams['xmin'+sScaleIdx] = mValue[0];
					oParams['xmax'+sScaleIdx] = mValue[1];
				}
			}
			for (i=0,iLen=self.getScales('v').length;i<iLen;i++) {
				var oScaleY = self.getScales('v')[i];
				if (ZC._n_(mValue=oScaleY.aZoomTo) !== null) {
					sScaleIdx = (oScaleY.iIndex===1)?'':('-'+oScaleY.iIndex);
					oParams['zoomy'+sScaleIdx] = true;
					oParams['ymin'+sScaleIdx] = mValue[0];
					oParams['ymax'+sScaleIdx] = mValue[1];
				}
			}
			oParams['zoomto'] = true;
			
			if (self.oParent.oDOMFragments) {
				for (var sId in self.oParent.oDOMFragments) {
					ZC._id_(sId).appendChild(self.oParent.oDOMFragments[sId]);
				}
				self.oParent.oDOMFragments = null;
			}

			self.oParent._api_zoomto_(oParams);
		}

	},
	processRefresh : function() {
	},
	triggerEvents : function() {
		var self = this;
		if (self.oParent.iInit < self.oParent.aGraphs.length) {
			self.oParent.iInit++;
			ZC.ZCUtils._trigger_event_('gload', self.oParent, self._api_graph_info_());
		}
		ZC.ZCUtils._trigger_event_('gcomplete', self.oParent, self._api_graph_info_());

		if (self.oParent.iInitMain < self.oParent.aGraphs.length) {
			self.oParent.iInitMain++;
		} else {
			self.oParent.iInitMain = 1;
			if (self.oParent.iInit === self.oParent.aGraphs.length) {
				self.oParent.iInit++;
				self.oParent.oAttributes['fire-load'] = true;
				if (self.bAsync && self.oPlotSet.aPlots.length > 1) {
					if (!zingchart.SKIP.EVENT) {
						ZC.ZCUtils._trigger_event_('load', self.oParent, self.oParent._api_loader_info_());
					}
				}
			}
			self.oParent.oAttributes['fire-complete'] = true;
			if (self.oAttributes['graph-repaint'] || (self.bAsync && self.oPlotSet.aPlots.length > 1)) {
				if (!zingchart.SKIP.EVENT) {
					ZC.ZCUtils._trigger_event_('complete', self.oParent, self.oParent._api_loader_info_());
				}
				self.oAttributes['graph-repaint'] = null;
			}
		}
		if (self.oParent.aHistory.length === 0 || (self.oParent.aHistory[self.oParent.aHistory.length-1] !== self.oParent.oAttributes['json'])) {
			if (self.oParent.aHistory[self.oParent.iHistory] !== self.oParent.oAttributes['json']) {
				self.oParent.aHistory.length = self.oParent.iHistory+1;
			}
			self.oParent.aHistory[self.oParent.iHistory] = self.oParent.oAttributes['json'];
		}
	},
	repaint : function(bSoftClear, bSmartPlots) {
		if (ZC._n_(bSoftClear) === null) { bSoftClear = false; }
		if (ZC._n_(bSmartPlots) === null) { bSmartPlots = false; }
		var self = this;
		
		if (!bSoftClear && !bSmartPlots) {
			if (zingchart.DEV.GC) {
				self.gc();
			}
		}
		self.oParent.showProgress(self);
		self.oAttributes['graph-repaint'] = true;
		
		self.clear(bSoftClear, bSmartPlots);
		
		self.parse();
		self.paint(bSoftClear);
		self.bDisableAnimation = false;
		zingchart.SKIP.CSV = false;
	},
	_onclick_ : function(ev, sUrl, sTarget) {
		if (ev.button === 2) {
			return;
		}
		var self = this, oGraph;
		var aTargetInfo = [''];
		if (ZC._n_(sTarget) !== null) {
			aTargetInfo = sTarget.split('=');
		}
		switch (aTargetInfo[0]) {
			case '_blank':
				window.open(sUrl, '_blank');
				break;
			case '_top':
				window.top.location.href = sUrl;
				break;
			case '_parent':
				window.parent.location.href = sUrl;
				break;
			case 'window':
				if (ZC._n_(aTargetInfo[1]) !== null && aTargetInfo[1] !== '') {
					window.top[aTargetInfo[1]].location.href = sUrl;
				}
				break;
			case 'graph':
				var oUrlData = null;
				if (sUrl.substring(sUrl.length-2) === '()' || sUrl.substring(0, 11) === 'javascript:') {
					try {
						var sCall = sUrl.replace('javascript:', '').replace('()', '');
						if (eval(sCall)) {
							oUrlData = eval(sCall).call(self);
						}
					} catch (e) {}
				}
				if (ZC._n_(aTargetInfo[1]) !== null && aTargetInfo[1] !== '') {
					if (aTargetInfo[1] === '_top' || aTargetInfo[1] === '_parent') {
						self.oParent.showProgress();
						if (oUrlData) {
							zingchart.exec(self.oParent.sId, 'setdata', {
								data : oUrlData
							});
	 					} else {
							self.oParent.load(null, sUrl);
						}
					} else {
						oGraph = self.oParent.findGraph(aTargetInfo[1]);
						if (oGraph) {
							self.oParent.showProgress(oGraph);
							
							self.oParent.oAttributes['tr-ev-' + oGraph.iIndex] = true;
							self.oParent.iHistory++;
							if (oUrlData) {
								zingchart.exec(self.oParent.sId, 'setdata', {
									graphid : aTargetInfo[1],
									data : oUrlData
								});
		 					} else {
								self.oParent.load(aTargetInfo[1], sUrl);
							}
						}
					}
				} else {
					oGraph = self.oParent.aGraphs[0];
					self.oParent.showProgress(oGraph);
					if (oUrlData) {
						zingchart.exec(self.oParent.sId, 'setdata', {
							graphid : oGraph.sId,
							data : oUrlData
						});
 					} else {
						
						self.oParent.oAttributes['tr-ev-' + oGraph.iIndex] = true;
						self.oParent.iHistory++;
						self.oParent.load(oGraph.sId, sUrl);
					}
				}
				break;
			
			default:
				window.location.href = sUrl;
				break;
		}
	},
	_api_getplot_ : function(iIndex, sId, iDefaultIndex) {
		var self = this;
		if (ZC._n_(iDefaultIndex) === null) {
			iDefaultIndex = self.oPlotSet.aPlots.length-1;
		}
		if (ZC._n_(iIndex) === null || typeof(iIndex) === 'undefined') {
			if (ZC._n_(sId) === null || typeof(sId) === 'undefined') {
				return self.oPlotSet.aPlots[iDefaultIndex];
			} else {
				for (var i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
					if (sId === self.oPlotSet.aPlots[i].sObjectId) {
						return self.oPlotSet.aPlots[i];
					}
				}
			}
		} else {
			return self.oPlotSet.aPlots[iIndex];
		}
		return null;
	},
	_api_plot_showhide_ : function(oParams, sSH) {
		var self = this, i, iLen;
		oParams = oParams || {};
		oParams['toggle-action'] = oParams['toggle-action'] || self.getToggleAction();
		var mPlotIndex = null;
		if (typeof(oParams['plotindex']) !== 'undefined') {
			mPlotIndex = ZC._i_(oParams['plotindex']);
		}
		if (mPlotIndex === -1) {
			
			mPlotIndex = [];
			for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
				mPlotIndex.push(i);
			}
		}
		if (!(mPlotIndex instanceof Array)) {
			mPlotIndex = [mPlotIndex];
		}
		var mPlotId = oParams['plotid'] || '';
		if (!(mPlotId instanceof Array)) {
			mPlotId = [mPlotId];
		}
		var aToggles = [];
		for (i=0,iLen=ZC._max_(mPlotIndex.length, mPlotId.length);i<iLen;i++) {
			var oPlot = self._api_getplot_(mPlotIndex[i], mPlotId[i]);
			if (oPlot) {
				var oToggle = {};
				ZC._cp_(oParams, oToggle);
				var iPlotIndex = oPlot.iIndex;
				oToggle['plotindex'] = mPlotIndex[i];
				oToggle['plotid'] = mPlotId[i];
				if (
					(sSH === 'show' && !self.oAttributes['plot'+iPlotIndex+'.visible'])
					||
					(sSH === 'hide' && self.oAttributes['plot'+iPlotIndex+'.visible'])
				) {
					aToggles.push(oToggle);
				}

			}
		}
		for (i=0,iLen=aToggles.length;i<iLen;i++) {
			if (i === iLen-1) {
				aToggles[i]['repaint'] = 1;
			}
			self._api_plot_toggle_(aToggles[i]);
		}
	},
	_api_plot_toggle_ : function(oParams) {
		var self = this, mValue, aCoords, l;
		self.oParent.oAttributes['graph.'+self.sId+'.disableanimation'] = false;
		oParams = oParams || {};
		var bSkip = false;
		if (ZC._n_(oParams['skip']) !== null && oParams['skip']) {
			bSkip = true;
		}
		var bIgnoreLegend = false;
		oParams['toggle-action'] = oParams['toggle-action'] || self.getToggleAction();
		if (ZC._n_(mValue=oParams['ignore-legend']) !== null) {
			bIgnoreLegend = ZC._b_(mValue);
		}
		var oPlot = self._api_getplot_(oParams['plotindex'], oParams['plotid']);
		if (oPlot) {
			var iPlotIndex = oPlot.iIndex;
			switch (oParams['toggle-action']) {
				case 'hide':				
					if (self.oLegend) {
						self.oLegend.oAttributes['showhide'] = true;
					}
					self.oAttributes['plot' + iPlotIndex + '.visible'] = !self.oAttributes['plot' + iPlotIndex + '.visible'];
					if (self.oSettings['3d']) {
						bIgnoreLegend = true;
						if (!bSkip) {
							self.repaint();
						}
					} else {
						var sDisplayState = self.oAttributes['plot' + iPlotIndex + '.visible']?'block':'none';

						
						ZC.ZCQuery('.' + self.sId + '-plotset-plot-' + iPlotIndex + '-node-area').each(function() {
							var oArea = ZC.ZCQuery(this);
							var sCoords = oArea.attr('coords'), sType = oArea.attr('shape');
							if (sDisplayState === 'none') {
								sCoords = '-' + sCoords.replace(/,/g, ',-');
								
								if (sType === 'rect') {
									aCoords = sCoords.split(',');
									if (aCoords.length === 4) {
										sCoords = [aCoords[2], aCoords[3], aCoords[0], aCoords[1]].join(',');
									}
								} else if (sType === 'circle') {
									aCoords = sCoords.split(',');
									if (aCoords.length === 3) {
										sCoords = [aCoords[0], aCoords[1], -aCoords[2]].join(',');
									}
								}
							} else {
								sCoords = sCoords.replace(/\-/g, '');
								
								if (sType === 'rect') {
									aCoords = sCoords.split(',');
									if (aCoords.length === 4) {
										sCoords = [aCoords[2], aCoords[3], aCoords[0], aCoords[1]].join(',');
									}
								}
							}
							oArea.attr('coords', sCoords);
						});

						if (self.oParent.bFlat) {
							ZC._id_(self.sId + '-plots-bl-c').style.display = sDisplayState;
							ZC._id_(self.sId + '-plots-fl-c').style.display = sDisplayState;
							ZC._id_(self.sId + '-plots-vb-c').style.display = sDisplayState;
						} else {
							for (l=0;l<oPlot.iBackLayers;l++) {
								if ((mValue=ZC._id_(self.sId + '-plot-' + iPlotIndex + '-bl-' + l + '-c'))) {
									mValue.style.display = sDisplayState;
								}
							}
							for (l=0;l<oPlot.iFrontLayers;l++) {
								if ((mValue=ZC._id_(self.sId + '-plot-' + iPlotIndex + '-fl-' + l + '-c'))) {
									mValue.style.display = sDisplayState;
								}
							}
							if ((mValue=ZC._id_(self.sId + '-plot-' + iPlotIndex + '-vb-c'))) {
								mValue.style.display = sDisplayState;
							}
						}
						var oVB = ZC.ZCQuery('.' + self.sId + '-plot-' + iPlotIndex + '-value-box');
						if (self.oAttributes['plot' + iPlotIndex + '.visible']) {
							oVB.show();
						} else {
							oVB.hide();
						}
					}
					break;
				case 'remove':
					bIgnoreLegend = true;
					self.oAttributes['toggle-action-remove'] = true;
					self.oAttributes['plot' + iPlotIndex + '.visible'] = !self.oAttributes['plot' + iPlotIndex + '.visible'];
					if (oParams['repaint']) {
						if (!bSkip) {
							self._set_animation_('on-legend-toggle');
							self.repaint(true, true);
							
						}
					}
					break;
			}
			if (self.oLegend && !bIgnoreLegend) {
				self.oLegend.clear();
				self.oLegend.paint();
			}
		}
	},
	_set_animation_ : function(sType) {
		var self = this;
		var bStatus = true;
		var oPlot = self.oData['plot'] || {};
		if (ZC._n_(oPlot['animation']) !== null && ZC._n_(oPlot['animation'][sType]) !== null) {
			bStatus = ZC._b_(oPlot['animation'][sType]);
		}
		self.bDisableAnimation = (self.sAnimateType === 'initial' || !bStatus);
	},
	_api_graph_info_ : function() {
		return {id : this.oParent.sId, graphidx : this.iIndex, graphid : this.sId.replace(this.oParent.sId + '-graph-', ''), x : this.iX, y : this.iY, width : this.iWidth, height : this.iHeight, loader : this.oParent._api_loader_info_()};
	},
	_api_label_event_ : function() {
	},
	_api_shape_event_ : function() {
	},
	gc : function() {
		this.oCrosshairX = null;
		this.oCrosshairY = null;
		for (var sc=0;sc<this.aScales.length;sc++) {
			this.aScales[sc].aValues = null;
			this.aScales[sc].aLabels = null;
		}
		for (var pl=0;pl<this.oPlotSet.aPlots.length;pl++) {
			this.oPlotSet.aPlots[pl].aValues = null;
			this.oPlotSet.aPlots[pl].aPlotNodes = [];
			this.oPlotSet.aPlots[pl].aNodeInstances = null;
			this.oPlotSet.aPlots[pl].oKeyPlotAssoc = null;
		}
	}
});













ZC.ZCGraph.prototype.parseObjects = function() {
	
	var self = this, mValue, i, iLen, sId, bReuse, bSkipParse, oGraphShape, oPoint;

	self.initObjectsLayers();

	self.aLabels = [];
	self.aShapes = [];
	self.aArrows = [];
	self.aImages = [];
	self.aObjects = [];
	var oDefaults = self.oParent.oDefaults;
	var sGraphType = '(' + self.sType + ')';

	var aLabels;
	if (ZC._n_(aLabels=self.oData['labels']) !== null) {
		for (i=0,iLen=aLabels.length;i<iLen;i++) {
			sId = aLabels[i]['id'] || i;

			bReuse = false;
			bSkipParse = false;
			if (self.oAttributes['objects.updates']) {
				if (ZC._indexof_(self.oAttributes['objects.updates'], sId) === -1) {
					bReuse = true;
					bSkipParse = true;
				}
			}

			if (aLabels[i]['tween']) {
				bReuse = true;
			}

			var oLabel = zingchart.pool.getInstance('ZCTextBox', self, self.sId + '-label-' + sId, bReuse);
			if (!bSkipParse) {
				oDefaults.load(oLabel.oData, sGraphType + '.label');
				oLabel.append(aLabels[i]);

				if (ZC._n_(mValue=oLabel.oData['parent']) !== null) {
					
					for (var j=0;j<self.aLabels.length;j++) {
						if ((''+self.aLabels[j].sObjectId) === (''+mValue)) {
							oLabel.oAttributes['p-x'] = self.aLabels[j].iX;
							oLabel.oAttributes['p-y'] = self.aLabels[j].iY;
							oLabel.oAttributes['p-width'] = self.aLabels[j].iWidth;
							oLabel.oAttributes['p-height'] = self.aLabels[j].iHeight;
							break;
						}
					}
				}

				oLabel.sObjectId = sId;
				oLabel.sId = self.sId + '-label-' + sId;
				oLabel.sDOMClass = self.sId + '-label zc-label';

				if (ZC._n_(mValue=aLabels[i]['hook']) !== null) {
					oLabel.oAttributes['hook'] = mValue;
				}
				oLabel.parseText = function(sText) {
					
					if (!sText || (''+sText).indexOf('%') === -1) {
						return sText;
					}
					sText = ''+sText;
					var aTokens = [], oRE;
					aTokens.push(['%id', self.oParent.sId]);
					aTokens.push(['%graphid', self.sId.replace(self.oParent.sId+'-graph-', '')]);
					var oUpdate = self.oAttributes['update'];
					for (var sToken in oUpdate) {
						aTokens.push(['%' + sToken, oUpdate[sToken]]);
					}
					aTokens.sort(ZC._token_sort_);
					for (var i=0,iLen=aTokens.length;i<iLen;i++) {
						oRE = new RegExp(aTokens[i][0], 'g');
						sText = sText.replace(oRE, aTokens[i][1]);
					}
					var sValue = oLabel.oData['default-value'] || ' ';
					oRE = new RegExp('(%plot\-([0-9]+?)\-value(\-*)([0-9]*?))|(%plot\-value\-([0-9]+?))|(%plot\-value)', 'g');
					sText = sText.replace(oRE, sValue);

					oRE = new RegExp('\\((.+?)\\)\\(([0-9]*)\\)\\(([0-9]*)\\)');
					var aMatches, sText_, oNode, oPlot;
					while ((aMatches = oRE.exec(sText))) {
						if (aMatches[1] === '%node-value') {
							sText_ = '';
							var iPlotIndex = 0;
							var iNodeIndex = 0;
							if ((mValue=aMatches[2]) !== '') {
								iPlotIndex = ZC._i_(mValue);
							}
							if ((mValue=aMatches[3]) !== '') {
								iNodeIndex = ZC._i_(mValue);
							}
							if ((oPlot=self.oPlotSet.aPlots[iPlotIndex])) {
								oNode = oPlot.getNode(iNodeIndex, 3);
								if (oNode) {
									sText_ = oNode.parseText(aMatches[1]);
								}
							}
							sText = sText.replace(aMatches[0], sText_);
						}
					}
					return sText;
				};
				oLabel.parse();

				if (aLabels[i]['3d']) {
					var oPoint3D = new ZC.ZCPoint3D(self, oLabel.iX, oLabel.iY, ZC._i_(aLabels[i]['z'] || '0'));
					oLabel.iX = oPoint3D.aXY[0];
					oLabel.iY = oPoint3D.aXY[1];
				}
			}

			self.aLabels.push(oLabel);
			self.aObjects.push({type : 'label', index : i, zindex : oLabel.iZIndex});
		}
	}
	var aArrows;
	if (ZC._n_(aArrows=self.oData['arrows']) !== null) {
		for (i=0,iLen=aArrows.length;i<iLen;i++) {
			var oArrow = new ZC.ZCArrow(self);
			oDefaults.load(oArrow.oData, sGraphType + '.arrow');
			oArrow.append(aArrows[i]);
			sId = aArrows[i]['id'] || i;
			oArrow.sId = self.sId + '-arrow-' + sId;
			oArrow.parse();
			self.aArrows.push(oArrow);
			self.aObjects.push({type : 'arrow', index : i, zindex : oArrow.iZIndex});
		}
	}
	var aShapes;
	var idx = 0;
	if (ZC._n_(aShapes=self.oData['shapes']) !== null) {
		for (i=0,iLen=aShapes.length;i<iLen;i++) {
			if (ZC._n_(aShapes[i]['type']) !== null && aShapes[i]['type'].indexOf('zingchart.') === 0) {
				continue;
			}
			sId = aShapes[i]['id'] || i;

			bSkipParse = (ZC._n_(zingchart.pool[self.sId + '-shape-' + sId]) !== null && zingchart.SKIP.PARSE3D);
			bReuse = false;
			if (self.oAttributes['objects.updates']) {
				if (ZC._indexof_(self.oAttributes['objects.updates'], sId) === -1) {
					bReuse = true;
					bSkipParse = true;
				}
			}

			if (aShapes[i]['tween']) {
				bReuse = true;
			}

			if (aShapes[i]['3d']) {
				oGraphShape = zingchart.pool.getInstance('ZCShape', self, self.sId + '-shape-' + sId, true);
				oGraphShape.oData = aShapes[i];
				if (aShapes[i]['type'] !== 'poly' || aShapes[i]['map-item']) {
					bSkipParse = false;
				}
			} else {
				if (ZC._n_(aShapes[i]['label']) !== null) {
					oGraphShape = zingchart.pool.getInstance('ZCGraphShape', self, self.sId + '-shape-' + sId, bReuse);
					oGraphShape.oShapeData = aShapes[i];
				} else {
					oGraphShape = zingchart.pool.getInstance('ZCShape', self, self.sId + '-shape-' + sId, bReuse);					
					oGraphShape.oData = aShapes[i];
					oGraphShape.append({}, true);
				}
				if (!bReuse) {
					bSkipParse = false;
				}
			}

			if (!bSkipParse) {
				
				
				oGraphShape.sObjectId = sId;
				oGraphShape.sId = self.sId + '-shape-' + sId;
				oGraphShape.bCache = true;
				oGraphShape.parse();	
			}

			if (aShapes[i]['3d']) {
				if (aShapes[i]['map-item']) {
					var aPoints = [];
					for (var p=0,pLen=oGraphShape.aPoints.length;p<pLen;p++) {
						if (oGraphShape.aPoints[p] !== null) {
							oPoint = new ZC.ZCPoint3D(self, oGraphShape.aPoints[p][0], oGraphShape.aPoints[p][1], ZC._i_(oGraphShape.aPoints[p][2] || aShapes[i]['z'] || '0'));
							aPoints.push(oPoint.aXY);
						} else {
							aPoints.push(null);
						}
					}
					oGraphShape.aPoints = aPoints;
					self.aShapes.push(oGraphShape);
					self.aObjects.push({type : 'shape', index : idx, zindex : oGraphShape.iZIndex, z3d : oPoint.iZ_});
				} else {
					if (aShapes[i]['type'] === 'poly') {
						var oFace = ZC.ZCMath3D._create_3d_facet_(oGraphShape, self, aShapes[i]['points'], false);
						self.oEngine3D.add(oFace);
						self.aShapes.push(null);						
					} else {
						if (oGraphShape.aPoints.length > 0) {
							var aPoints = [];
							for (var p=0,pLen=oGraphShape.aPoints.length;p<pLen;p++) {
								oPoint = new ZC.ZCPoint3D(self, oGraphShape.aPoints[p][0], oGraphShape.aPoints[p][1], ZC._i_(oGraphShape.aPoints[p][2] || aShapes[i]['z'] || '0'));
								aPoints.push(oPoint.aXY);
							}
							oGraphShape.aPoints = aPoints;
						} else {
							oPoint = new ZC.ZCPoint3D(self, oGraphShape.iX, oGraphShape.iY, ZC._i_(aShapes[i]['z'] || '0'));
							oGraphShape.iX = ZC._i_(oPoint.aXY[0]);
							oGraphShape.iY = ZC._i_(oPoint.aXY[1]);
							
						}
						self.aShapes.push(oGraphShape);
						self.aObjects.push({type : 'shape', index : idx, zindex : oGraphShape.iZIndex, z3d : oPoint.iZ_});
					}
				}
				oGraphShape.oAttributes['3dtx'] = true;
				oGraphShape.oAttributes['3d'] = true;
			} else {
				self.aShapes.push(oGraphShape);
				if (oGraphShape instanceof ZC.ZCGraphShape) {
					self.aObjects.push({type : 'shape', index : idx, zindex : oGraphShape.oShape.iZIndex});
				} else {
					self.aObjects.push({type : 'shape', index : idx, zindex : oGraphShape.iZIndex});
				}
			}

			idx++;
		}
	}
	var aImages;
	if (ZC._n_(aImages=self.oData['images']) !== null) {
		for (i=0,iLen=aImages.length;i<iLen;i++) {
			var oImage = new ZC.ZCBox(self);
			var sSrc = aImages[i]['src'];
			oImage.append({
				'background-repeat' : 'no-repeat',
				'background-image' : sSrc,
				width : ZC.cache.data[sSrc].width,
				height : ZC.cache.data[sSrc].height
			});
			oImage.append(aImages[i]);
			sId = aImages[i]['id'] || i;
			oImage.sObjectId = sId;
			oImage.sId = self.sId + '-image-' + sId;
			oImage.iIndex = i;
			oImage.parse();
			self.aImages.push(oImage);
			self.aObjects.push({type : 'image', index : i, zindex : oImage.iZIndex});
		}
	}

	self.oAttributes['objects.updates'] = null;

	
	self.aObjects = self.aObjects.sort(function(a, b) {
		if (ZC._n_(a.z3d) !== null && ZC._n_(b.z3d) !== null) {
			if (a.z3d - b.z3d > 0) {
				return 1;
			} else {
				return -1;
			}
		} else {
			return 0;
		}
	});

	
	self.aObjects = self.aObjects.sort(function(a, b) {
		
		if (a.zindex - b.zindex === 0) {
			return a.index - b.index;
		} else {
			return a.zindex - b.zindex;
		}
	});
		
	
};
ZC.ZCGraph.prototype.clearObjects = function(bDynamic, bAll) {
	if (typeof(bDynamic) === 'undefined') { bDynamic = false; }
	if (typeof(bAll) === 'undefined') { bAll = false; }
	var self = this, oLayerC;
	var aLayers = [
		self.sId + '-objects-bottom-sh-c',
		self.sId + '-objects-bottom-c',
		self.sId + '-objects-top-sh-c',
		self.sId + '-objects-top-c',
		self.sId + '-objects-maps-sh-c',
		self.sId + '-objects-maps-c',
		self.sId + '-objects-front-c',
		self.sId + '-objects-print-c'
	];
	for (var i=0;i<aLayers.length;i++) {
		if ((oLayerC = ZC._id_(aLayers[i]))) {
			ZC.ZCHtmlUtils._clear_(oLayerC, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
		}	
	}
	
	if (self.oParent.sOutput !== 'canvas' || zingchart.CANVASTEXT || !ZC.objmove) {
		ZC.ZCQuery('.' + self.sId + '-label').remove();
		ZC.ZCQuery('.' + self.sId + '-shape-label').remove();
		ZC.ZCQuery('.' + self.sId + '-arrow-label').remove();
	}	
	if (!bDynamic) {
		ZC.ZCQuery('.' + self.sId + '-label-area').each(function() {
			var aMatches = (new RegExp('scale_(x|y|k|v)-(item_|marker_)([0-9]+)')).exec(this.id);
			if (bAll || (!aMatches || !aMatches.length)) {
				ZC.ZCHtmlUtils._remove_(this.id);
			}
		});
		ZC.ZCQuery('.' + self.sId + '-shape-area').remove();
		ZC.ZCQuery('.' + self.sId + '-arrow-area').remove();
		
	}
	if (self.oParent.sOutput === 'svg') {
		
		ZC.ZCQuery('#' + self.oParent.sId + '-svg').children().each(function() {
			var sCPId = self.sId + '-label-';
			if (this.tagName.toLowerCase() === 'clippath' && this.id.substring(0, sCPId.length) === sCPId) {
				ZC.ZCHtmlUtils._remove_(this.id);
			}
		});
	}
};
ZC.ZCGraph.prototype.unbindObjects = function() {
	var self = this;
	ZC.ZCQuery('.' + self.sId + '-label-area')
		.die('mousedown mouseover touchstart', self.zc_label_mouseover)
		.die('mouseup mouseout touchend', self.zc_label_mouseout)
		.die('mousemove touchmove', self.zc_label_mousemove)
		.die('click', self.zc_label_click);
	ZC.ZCQuery('.' + self.sId + '-shape-area')
		.die('mousedown mouseover touchstart', self.zc_shape_mouseover)
		.die('mouseup mouseout touchend', self.zc_shape_mouseout)
		.die('mousemove touchmove', self.zc_shape_mousemove)
		.die('click', self.zc_shape_click);
};
ZC.ZCGraph.prototype.detectDynamicObjects = function() {
	var self = this, i, iLen;
	self.bDynamicObjects = false;
	
	var aLabels, aShapes;
	if (ZC._n_(aLabels=self.oData['labels']) !== null) {
		for (i=0,iLen=aLabels.length;i<iLen;i++) {
			var sText = ''+(aLabels[i]['text'] || '');
			if (sText.indexOf('%node-') !== -1 || sText.indexOf('%plot-') !== -1 || ZC._b_(aLabels[i]['dynamic'])) {
				self.bDynamicObjects = true;
				break;
			}
		}
	}
	if (ZC._n_(aShapes=self.oData['shapes']) !== null) {
		for (i=0,iLen=aShapes.length;i<iLen;i++) {
			if (ZC._b_(aShapes[i]['dynamic'])) {
				self.bDynamicObjects = true;
				break;
			}
		}
	}
};
ZC.ZCGraph.prototype.repaintObjects = function(bDynamic) {
	var self = this;
	var bProcessRepaint = true;
	if (bDynamic && !self.bDynamicObjects) {
		bProcessRepaint = false;
	}
	if (bProcessRepaint) {
		self.clearObjects(bDynamic);
		self.parseObjects();
		self.paintObjects(bDynamic);
	}
};
ZC.ZCGraph.prototype.paintObjects = function(bDynamic) {
	
	if (typeof(bDynamic) === 'undefined') { bDynamic = false; }
	var self = this, mValue, i, iLen;
	var aHtmlBottom = [], aHtmlTop = [];
	function _paint_arrow_(i) {
		var oArrow = self.aArrows[i];
		if (oArrow.bVisible) {
			oArrow.oCanvas = oArrow.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-' + (oArrow.iZIndex<0?'bottom':'top') + '-c');
			
			oArrow.paint();
			if (ZC._id_(self.oParent.sId + '-map')) {
				var aAreaInfo = oArrow.oShape.getAreaInfo();
				var sHtml = ZC.ZCHtmlUtils._area_start_(aAreaInfo[0], oArrow.oShape.sUrl, oArrow.oShape.sCursor) + 'class="' + self.sId + '-arrow-area zc-arrow-area' + '" id="' + oArrow.oShape.sId + '-area" coords="' + aAreaInfo[1] + '" />';
				if (oArrow.oData['placement'] === 'top') {
					aHtmlTop.push(sHtml);
				} else {
					aHtmlBottom.push(sHtml);
				}
			}
		}
	}
	function _paint_shape_(i) {
		if (!self.aShapes[i]) {
			return;
		}
		var oGraphShape = self.aShapes[i];
		var oShape_ = (oGraphShape instanceof ZC.ZCGraphShape)?oGraphShape.oShape:oGraphShape;
		

		if (oShape_.bVisible) {
			if (!oGraphShape.oAttributes['3d'] || oGraphShape.oAttributes['3dtx']) {
				oGraphShape.oCanvas = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-' + (oShape_.iZIndex<0?'bottom':'top') + '-c');
				oGraphShape.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-' + (oShape_.iZIndex<0?'bottom':'top') + '-sh-c');
				if (oShape_.oData['map-item']) {
					oGraphShape.oCanvas = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-maps-c');
					oGraphShape.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-maps-sh-c');
				}
				
				oGraphShape.bIsTop = false;
				oGraphShape.oAttributes['print-canvas'] = self.sId + '-objects-print-c';
				oGraphShape.paint();
			}
			if (!oGraphShape.bFlat && !self.bObjectsTweening && zingchart.OBJECTMODE === 'normal') {
				var aAreaInfo = oShape_.getAreaInfo();
				if (ZC._id_(self.oParent.sId + '-map')) {
				
				for (var j=1,jLen=aAreaInfo.length;j<jLen;j++) {
						if (aAreaInfo[j] !== '') {
							var sDataMap = (oShape_.oData['map-item'])?' data-map="1"':'';
							var sHtml = ZC.ZCHtmlUtils._area_start_(aAreaInfo[0], oShape_.sUrl, oShape_.sCursor) + 'class="' + self.sId + '-shape-area zc-shape-area' + '" id="' + oShape_.sId + '-area' + (j>1?('--'+j):'') + '" coords="' + aAreaInfo[j] + '" data-z-sort="' + oShape_.iZSort + '"' + sDataMap + ' />';
							if (oGraphShape.oData['placement'] === 'top') {
								aHtmlTop.push(sHtml);
							} else {
								aHtmlBottom.push(sHtml);
							}
							
				}
					}
				}
			}
		}
	}
	function _paint_image_(i) {
		var oImage = self.aImages[i];
		if (oImage.bVisible) {
			oImage.oCanvas = oImage.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-' + (oImage.iZIndex<0?'bottom':'top') + '-c');
			
			oImage.paint();
		}
	}
	function _paint_label_(i) {
		var oLabel = self.aLabels[i];
		if (oLabel.bVisible) {
			if (ZC._n_(mValue=oLabel.oAttributes['hook']) !== null) {
				var aHook = self.getHookXY(mValue);
				if (aHook[0] !== -1) {
					oLabel.iX = aHook[0];
				}
				if (aHook[1] !== -1) {
					oLabel.iY = aHook[1];
				}
				if (ZC._n_(aHook[2]) !== null && !oLabel.oData['anchor']) {
					if (ZC._n_(aHook[2]['center']) !== null && aHook[2]['center']) {
						oLabel.iX -= oLabel.iWidth/2;
						oLabel.iY -= oLabel.iHeight/2;
					}
				}
				if (oLabel.oData['anchor']) {
					oLabel.setAnchor();
				}
			}

			oLabel.iX = ZC._i_(oLabel.iX);
			oLabel.iY = ZC._i_(oLabel.iY);

			oLabel.oDOMParent = ZC._id_(self.oParent.sId + '-text');
			oLabel.oCanvas = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-' + (oLabel.iZIndex<0?'bottom':'top') + '-c');
			oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-objects-' + (oLabel.iZIndex<0?'bottom':'top') + '-sh-c');
			

			var sLimit = '';
			if (ZC._n_(mValue=oLabel.oData['limit']) !== null) {
				if (mValue === 'x') {
					sLimit = 'x';
				} else if (mValue === 'y') {
					sLimit = 'y';
				} else if (mValue === 'xy') {
					sLimit = 'xy';
				}
			}

			if (
				(sLimit === '')
				||
				(sLimit === 'x' && ZC._btw_(oLabel.iX - oLabel.iOffsetX, self.oPlotArea.iX - oLabel.iWidth/2 - 2, self.oPlotArea.iX + self.oPlotArea.iWidth - oLabel.iWidth/2 + 2))
				||
				(sLimit === 'y' && ZC._btw_(oLabel.iY - oLabel.iOffsetY, self.oPlotArea.iY - oLabel.iHeight/2 - 2, self.oPlotArea.iY + self.oPlotArea.iHeight - oLabel.iHeight/2 + 2))
				||
				(sLimit === 'xy' && ZC._btw_(oLabel.iX + oLabel.iOffsetX, self.oPlotArea.iX - oLabel.iWidth/2 - 2, self.oPlotArea.iX + self.oPlotArea.iWidth - oLabel.iWidth/2 + 2) && ZC._btw_(oLabel.iY + oLabel.iOffsetY, self.oPlotArea.iY - oLabel.iHeight/2 - 2, self.oPlotArea.iY + self.oPlotArea.iHeight - oLabel.iHeight/2 + 2))
			) {
				oLabel.bIsTop = false;
				oLabel.paint();
				oLabel.paintPrintVersion(ZC._id_(self.sId + '-objects-print-c'));
				if (!oLabel.bFlat && !self.bObjectsTweening && zingchart.OBJECTMODE === 'normal')  {
					if (ZC._id_(self.oParent.sId + '-map')) {
						var sHtml = ZC.ZCUtils._box_area_(self.sId, oLabel);
						if (oLabel.oData['placement'] === 'top') {
							aHtmlTop.push(sHtml);
						} else {
							aHtmlBottom.push(sHtml);
						}
					}
					
				}
			}
		}
	}

	for (i=0,iLen=self.aObjects.length;i<iLen;i++) {
		var ii = self.aObjects[i].index;
		switch (self.aObjects[i].type) {
			case 'arrow':
				_paint_arrow_(ii);
				break;
			case 'shape':
				_paint_shape_(ii);
				break;
			case 'image':
				_paint_image_(ii);
				break;
			case 'label':
				_paint_label_(ii);
				break;
		}
	}

	if (!bDynamic && zingchart.OBJECTMODE === 'normal') {
		if ((aHtmlTop.length > 0 || aHtmlBottom.length > 0) && ZC._id_(self.oParent.sId + '-map')) {
			if (self.bSortObjects) {
				var _sort_ = function(a, b) {
					if (a.indexOf('data-map') !== -1 && b.indexOf('data-map') !== -1) {
						
						return ZC.ZCUtils._area_score_(b) - ZC.ZCUtils._area_score_(a);
					} else {
						
						return ZC.ZCUtils._area_score_(a) - ZC.ZCUtils._area_score_(b);
					}
				};
				aHtmlTop.sort(_sort_);
				aHtmlBottom.sort(_sort_);
			}
			ZC._id_(self.oParent.sId + '-map').innerHTML = aHtmlTop.join('') + ZC._id_(self.oParent.sId + '-map').innerHTML + aHtmlBottom.join('');
		}
	}
	ZC.ZCUtils._trigger_event_('objectsready', self.oParent, self._api_graph_info_());
	
};
ZC.ZCGraph.prototype.showObjectsLayer = function(sType, iIdx, sLayer) {
	var self = this, oShape, sId;
	sLayer = sLayer || 'hover';
	switch (sType) {
		case 'shape':
			var si = self.aShapes[iIdx];
			
			var oShape_ = (si instanceof ZC.ZCGraphShape)?si.oShape:si;

			if (ZC._n_(oShape_.oData[sLayer + '-state']) !== null) {
				
				oShape = new ZC.ZCShape(self);

				oShape.append(oShape_.oData);
				oShape.append(oShape_.oData[sLayer + '-state']);
				sId = si['id'] || iIdx;
				oShape.sObjectId = sId + '-' + sLayer;
				oShape.sId = self.sId + '-shape-' + sId + '-' + sLayer;
				oShape.parse();

				if (si.oAttributes['3d']) {
					oShape.aPoints = oShape_.aPoints;
					oShape.iX = si.iX;
					oShape.iY = si.iY;
				}
				if (oShape.bVisible) {
					oShape.oCanvas = oShape.oCanvasSh = ZC._id_(self.sId + '-objects-' + sLayer + '-c');
					if (oShape.oData['map-item']) {
						oShape.oCanvas = oShape.oCanvasSh = ZC._id_(self.sId + '-objects-maps-' + sLayer + '-c');
					}
					
					if (oShape.oData['map-item'] && zingchart.maps.LITE && self.oParent.sOutput !== 'canvas') {
						if (self.oParent.sOutput === 'svg') {
							var oSVGPath = ZC.ZCQuery('#'+self.sId+'-shape-'+oShape.sObjectId+'-gshape-path');
							self.oAttributes['map-shape-info'] = {
								'fill' : oSVGPath.attr('fill'),
								'stroke' : oSVGPath.attr('stroke'),
								'stroke-width' : oSVGPath.attr('stroke-width')
							};
							if (oShape.sShape === 'poly') {
								oSVGPath.attr('fill', oShape.sBackgroundColor1);
								oSVGPath.attr('stroke-width', oShape.iBorderWidth);
								oSVGPath.attr('stroke', oShape.sBorderColor);
							} else if (oShape.sShape === 'line') {
								oSVGPath.attr('stroke-width', oShape.iLineWidth);
								oSVGPath.attr('stroke', oShape.sLineColor);
							}
						} else if (self.oParent.sOutput === 'vml') {
							var oVMLShape = ZC._id_(self.sId+'-shape-'+oShape.sObjectId+'-gshape-path');
							var oVMLStroke = ZC.ZCQuery(oVMLShape.childNodes[1]);
							var oVMLFill = ZC.ZCQuery(oVMLShape.childNodes[2]);
							self.oAttributes['map-shape-info'] = {
								fill : (''+oVMLFill.attr('color')),
								stroke : (''+oVMLStroke.attr('color')),
								'stroke-width' : (''+oVMLStroke.attr('weight'))
							};
							if (oShape.sShape === 'poly') {
								oVMLFill.attr('color', oShape.sBackgroundColor1);
								oVMLStroke.attr('weight', oShape.iBorderWidth);
								oVMLStroke.attr('color', oShape.sBorderColor);
							} else if (oShape.sShape === 'line') {
								oVMLStroke.attr('weight', oShape.iLineWidth);
								oVMLStroke.attr('color', oShape.sLineColor);
							}
						}
					} else {
						oShape.paint();
						if (self.oParent.sOutput === 'canvas' && zingchart.CANVASTEXT) {
							if (si.oLabel) {
								si.oLabel.oCanvas = si.oLabel.oCanvasSh = ZC._id_(self.sId + '-objects-' + sLayer + '-c');
								si.oLabel.paint();
							}
						}
					}
				}
			}
			break;
		case 'label':
			var li = self.aLabels[iIdx];
			if (li && ZC._n_(li.oData[sLayer + '-state']) !== null) {
				
				var oLabel = zingchart.pool.getInstance('ZCTextBox', self, self.sId + '-label-' + sLayer);
				oLabel.append(li.oData);
				oLabel.append(li.oData[sLayer + '-state']);
				sId = li['id'] || iIdx;
				oLabel.sObjectId = sId + '-' + sLayer;
				oLabel.sId = self.sId + '-label-' + sId + '-' + sLayer;
				oLabel.sDOMClass = self.sId + '-label ' + self.sId + '-label-' + sLayer + ' zc-label zc-label-' + sLayer;
				oLabel.oDOMParent = ZC._id_(self.oParent.sId + '-text');
				oLabel.parse();
				if (oLabel.bVisible) {
					oLabel.iX = li.iX;
					oLabel.iY = li.iY;
					oLabel.iWidth = li.iWidth;
					oLabel.iHeight = li.iHeight;
					oLabel.oCanvas = oLabel.oCanvasSh = ZC._id_(self.sId + '-objects-' + sLayer + '-c');
					
					if (ZC._id_(self.sId + '-label-' + sId)) {
						ZC._id_(self.sId + '-label-' + sId).style.display = 'none';
					}
					oLabel.paint();
				}
			}
			break;
	}
};
ZC.ZCGraph.prototype.bindObjects = function() {
	var self = this;
	function _shape_info_(ev) {
		var sTargetId = ev.targetid || ev.target.id;
		var sObjectId = sTargetId.replace(/\-\-\d+/g, '').replace(self.sId + '-shape-', '').replace('-gshape-area', '').replace('-area', '');
		var iShapeIdx = -1, oShape = null;
		for (var i=0,iLen=self.aShapes.length;i<iLen;i++) {
			if (self.aShapes[i]) {
				if ((''+self.aShapes[i].sObjectId) === (''+sObjectId)) {
					iShapeIdx = i;
					
					oShape = (self.aShapes[i] instanceof ZC.ZCGraphShape)?self.aShapes[i].oShape:self.aShapes[i];
					break;
				}
			}
		}
		if (!oShape && ev.target.getAttribute('data-lowlevel')) {
			return {
				shapeid : ev.target.id,
				lowlevel : true,
				ev : ev
			};
		}

		if (iShapeIdx===-1) {
			return null;
		} else {
			var oShapeInfo = {
				
				shapeid : sObjectId, 
				shapeindex : iShapeIdx, 
				shape : {
					id : sObjectId, 
					index : iShapeIdx,
					cls : oShape.sClass, 
					x : oShape.iX, 
					y : oShape.iY, 
					type : oShape.sShape,
					mapItem : oShape.oData['map-item'],
					points : oShape.aPoints,
					width : oShape.iWidth, 
					height : oShape.iHeight,
					size : oShape.iSize,
					size2 : oShape.iSize2,
					angle : oShape.iAngle,
					zIndex : oShape.iZIndex
				},
				ev : ev
			};
			for (var p in oShape.oData) {
				if (oShape.oData.hasOwnProperty(p) && p.substring(0, 5) === 'data-') {
					oShapeInfo[p] = oShape.oData[p];
				}
			}
			return oShapeInfo;
		}
	}
	self.zc_shape_mouseover = function(ev) {
		if (ZC.mobile) {
			ZC.move = false;
			self.oLoader.hideCM();
			ev.preventDefault();
			self.oParent.trackTouchHold(ev);
		}
		if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
			self.oParent.oTooltip.onmouseover(ev);
		}
		var sEvent = ZC.mobile?'mousedown':(ev.xtype || ev.type);
		var oInfo = _shape_info_(ev);
		if (!oInfo.lowlevel) {
			self.showObjectsLayer('shape', oInfo['shapeindex']);
		}
		self._api_shape_event_(sEvent, oInfo);
	};
	self.zc_shape_mouseout = function(ev) {
		if (ZC.mobile) {
			if (!self.oLoader.bCM && !ZC.move) {
				zingchart.zc_click(ev);
				self.zc_shape_click(ev);
			}
			self.oParent.zc_loader_kill_touchhold(ev);
		}
		if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
			self.oParent.oTooltip.onmouseout(ev);
		}
		if (!ZC.mobile) {
			self.hideLayer();
		}
		var sEvent = ZC.mobile?'mouseup':(ev.xtype || ev.type);
		var oInfo = _shape_info_(ev);
		
		if (oInfo.shape && oInfo.shape.mapItem && zingchart.maps.LITE && self.oParent.sOutput !== 'canvas') {
			if (self.oParent.sOutput === 'svg') {
				var oSVGPath = ZC.ZCQuery('#'+self.sId+'-shape-'+oInfo.shape.id+'-gshape-path');
				if (oInfo.shape.type === 'poly') {
					oSVGPath.attr('fill', self.oAttributes['map-shape-info']['fill']);
				}
				oSVGPath.attr('stroke', self.oAttributes['map-shape-info']['stroke']);
				oSVGPath.attr('stroke-width', self.oAttributes['map-shape-info']['stroke-width']);
			} else if (self.oParent.sOutput === 'vml') {
				var oVMLShape = ZC._id_(self.sId+'-shape-'+oInfo.shape.id+'-gshape-path');
				var oVMLStroke = oVMLShape.childNodes[1];
				var oVMLFill = oVMLShape.childNodes[2];
				var oMapShapeInfo = self.oAttributes['map-shape-info'];
				if (oInfo.shape.type === 'poly') {
					ZC.ZCHtmlUtils._attr_(oVMLFill, {
						color : oMapShapeInfo['fill']
					});
				}
				ZC.ZCHtmlUtils._attr_(oVMLStroke, {
					weight : oMapShapeInfo['stroke-width'],
					color : oMapShapeInfo['stroke']
				});
			}
		}
		
		self._api_shape_event_(sEvent, oInfo);
	};
	self.zc_shape_mousemove = function(ev) {
		if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
			self.oParent.oTooltip.onmousemove(ev);
		}
		var oInfo = _shape_info_(ev);
		self._api_shape_event_('mousemove', oInfo);
	};
	self.zc_shape_click = function(ev) {
		var oInfo = _shape_info_(ev);
		if (!ev.ctrlKey) {
			self.hideLayer('click');
		}
		self.oClicks = self.oClicks || {};
		if (self.oClicks['s_'+oInfo['shapeid']]) {
			self.oClicks['s_'+oInfo['shapeid']] = null;
			self.hideLayer('click');
		} else {
			if (!ev.ctrlKey) {
				self.oClicks = {};
			}
			self.oClicks['s_'+oInfo['shapeid']] = 1;
			self.showObjectsLayer('shape', oInfo['shapeindex'], 'click');
		}
		self._api_shape_event_('click', oInfo);
		var oShape = self.aShapes[oInfo['shapeindex']].oShape || self.aShapes[oInfo['shapeindex']];
		if (oShape && oShape.sUrl && oShape.sUrl !== 'NULL') {
			if (oShape.sUrl instanceof Array) {
				for (var u=0;u<oShape.sUrl.length;u++) {
					if (ZC._n_(oShape.sTarget[u]) !== null) {
						self._onclick_(ev, oShape.sUrl[u], oShape.sTarget[u]);
					}
				}
			} else {
				self._onclick_(ev, oShape.sUrl, oShape.sTarget);
			}
		}
	};
	ZC.ZCQuery('.' + self.sId + '-shape-area')
		.live('mousedown mouseover touchstart', self.zc_shape_mouseover)
		.live('mouseup mouseout touchend', self.zc_shape_mouseout)
		.live('mousemove touchmove', self.zc_shape_mousemove);
	if (!ZC.mobile) {
		ZC.ZCQuery('.' + self.sId + '-shape-area')
			.live('click', self.zc_shape_click);
	}
	var sObjectId, aTokens, sText;
	function _label_info_(ev) {
		var sTargetId = ev.targetid || ev.target.id;
		if (sTargetId.indexOf('-scale') !== -1 && (sTargetId.indexOf('-item') !== -1 || sTargetId.indexOf('-marker') !== -1)) {
			
			sObjectId = sTargetId.replace(self.sId + '-', '').replace('-area', '');
			aTokens = sObjectId.split('-');
			var aItemTokens = aTokens[1].split('_');
			var iItemIdx = 0;
			if (aItemTokens.length === 2) {
				iItemIdx = ZC._i_(aItemTokens[1]);
			} else if (aItemTokens.length === 3) {
				iItemIdx = ZC._i_(aItemTokens[2]);
			}
			var sScaleName = aTokens[0].replace(/_/g, '-');
			var oScale = self.getScaleByName(sScaleName);

			var sType, sId;
			if (sTargetId.indexOf('-item') !== -1) {
				sType = 'scale-item';
				sId = 'si_' + aTokens[1].replace('item_', '');
				sText = oScale.aLabels[iItemIdx] || oScale.aValues[iItemIdx];
			} else {
				sType = 'scale-marker';
				sId = 'sm_' + aTokens[1].replace('marker_', '');
				sText = oScale.oAttributes['marker_text_'+iItemIdx] || '';
			}
			
			return {
				
				type : sType,
				labelid : sId, 
				labelindex : iItemIdx,
				scale : sScaleName,
				text : sText, 
				label : {
					id : sId, 
					index : iItemIdx, 
					text : sText
				},
				ev : ev
			};
		} else if (sTargetId.indexOf('-value-box-') !== -1) {
			sObjectId = sTargetId.replace(self.sId + '-plotset-plot-', '').replace('-value-box-area', '');
			aTokens = sObjectId.split('-node-');
			var oNode = self.oPlotSet.aPlots[ZC._i_(aTokens[0])].getNode(ZC._i_(aTokens[1]));
			return !oNode?null:{
				
				type : 'value-box',
				labelid : 'vb_' + aTokens.join('_'), 
				plotindex : ZC._i_(aTokens[0]), 
				nodeindex : ZC._i_(aTokens[1]), 
				text : oNode.fValue, 
				label : {
					id : 'vb_' + aTokens.join('_'), 
					text : oNode.fValue
				},
				ev : ev
			};
		} else {
			sObjectId = sTargetId.replace(self.sId + '-label-', '').replace('-area', '');
			var iLabelIdx = -1, oLabel = null;
			for (var i=0,iLen=self.aLabels.length;i<iLen;i++) {
				if ((''+self.aLabels[i].sObjectId) === (''+sObjectId)) {
					iLabelIdx = i;
					oLabel = self.aLabels[i];
					break;
				}
			}
			sText = (iLabelIdx===-1)?'':self.aLabels[iLabelIdx].sText;
			if (iLabelIdx===-1) {
				return null;
			} else {
				var oLabelInfo = {
					
					type : 'label',
					labelid : sObjectId, 
					labelindex : iLabelIdx, 
					text : sText, 
					label : {
						id : sObjectId, 
						index : iLabelIdx, 
						cls : oLabel.sClass,
						x : oLabel.iX,
						y : oLabel.iY,
						width : oLabel.iWidth,
						height : oLabel.iHeight,
						text : sText
					},
					ev : ev
				};
				for (var p in oLabel.oData) {
					if (oLabel.oData.hasOwnProperty(p) && p.substring(0, 5) === 'data-') {
						oLabelInfo[p] = oLabel.oData[p];
					}
				}
				return oLabelInfo;
			}
		}
	}
	self.zc_label_mouseover = function(ev) {
		if (ZC.mobile) {
			ZC.move = false;
			self.oLoader.hideCM();
			ev.preventDefault();
			self.oParent.trackTouchHold(ev);
		}
		if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
			self.oParent.oTooltip.onmouseover(ev);
		}
		var oInfo = _label_info_(ev);
		if (oInfo !== null) {
			var sEvent = ZC.mobile?'mousedown':(ev.xtype || ev.type);
			self.showObjectsLayer('label', oInfo['labelindex']);
			self._api_label_event_(sEvent, oInfo);
		}
	};
	self.zc_label_mouseout = function(ev) {
		if (ZC.mobile) {
			if (!self.oLoader.bCM && !ZC.move) {
				zingchart.zc_click(ev);
				self.zc_label_click(ev);
			}
			self.oParent.zc_loader_kill_touchhold(ev);
		}
		if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
			self.oParent.oTooltip.onmouseout(ev);
		}
		if (!ZC.mobile) {
			self.hideLayer();
		}
		var oInfo = _label_info_(ev);
		if (oInfo !== null) {
			var sEvent = ZC.mobile?'mouseup':(ev.xtype || ev.type);
			if (ZC._id_(self.sId + '-label-' + oInfo.label.id)) {
				ZC._id_(self.sId + '-label-' + oInfo.label.id).style.display = 'block';
			}
			self._api_label_event_(sEvent, oInfo);
		}
	};
	self.zc_label_mousemove = function(ev) {
		if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
			self.oParent.oTooltip.onmousemove(ev);
		}
		var oInfo = _label_info_(ev);
		self._api_label_event_('mousemove', oInfo);
	};
	self.zc_label_click = function(ev) {
		var oInfo = _label_info_(ev);
		if (!ev.ctrlKey) {
			self.hideLayer('click');
		}
		self.oClicks = self.oClicks || {};
		if (self.oClicks['l_'+oInfo['labelid']]) {
			self.oClicks['l_'+oInfo['labelid']] = null;
			self.hideLayer('click');
		} else {
			if (!ev.ctrlKey) {
				self.oClicks = {};
			}
			self.oClicks['l_'+oInfo['labelid']] = 1;
			self.showObjectsLayer('label', oInfo['labelindex'], 'click');
		}
		self._api_label_event_('click', oInfo);
		var oLabel = self.aLabels[oInfo['labelindex']];
		if (oLabel && oLabel.sUrl && oLabel.sUrl !== 'NULL') {
			if (oLabel.sUrl instanceof Array) {
				for (var u=0;u<oLabel.sUrl.length;u++) {
					if (ZC._n_(oLabel.sTarget[u]) !== null) {
						oLabel.sUrl[u] = oLabel.sUrl[u].replace('%id', self.oParent.sId);
						oLabel.sUrl[u] = oLabel.sUrl[u].replace('%graphid', self.sId.replace(self.oParent.sId+'-graph-', ''));
						self._onclick_(ev, oLabel.sUrl[u], oLabel.sTarget[u]);
					}
				}
			} else {
				oLabel.sUrl = oLabel.sUrl.replace('%id', self.oParent.sId);
				oLabel.sUrl = oLabel.sUrl.replace('%graphid', self.sId.replace(self.oParent.sId+'-graph-', ''));
				self._onclick_(ev, oLabel.sUrl, oLabel.sTarget);
			}
		}
	};
	ZC.ZCQuery('.' + self.sId + '-label-area')
		.live('mousedown mouseover touchstart', self.zc_label_mouseover)
		.live('mouseup mouseout touchend', self.zc_label_mouseout)
		.live('mousemove touchmove', self.zc_label_mousemove);
	if (!ZC.mobile) {
		ZC.ZCQuery('.' + self.sId + '-label-area')
			.live('click', self.zc_label_click);
	}
};
ZC.ZCGraph.prototype._api_label_event_ = function(sEvent, oParams) {
	var self = this;
	ZC._cp_(self._api_graph_info_(), oParams);
	oParams.ev = ZC.ZCQuery._event_(oParams.ev);
	ZC.ZCUtils._trigger_event_('label_' + sEvent, self.oParent, oParams);
};
ZC.ZCGraph.prototype._api_shape_event_ = function(sEvent, oParams) {
	var self = this;
	ZC._cp_(self._api_graph_info_(), oParams);
	oParams.ev = ZC.ZCQuery._event_(oParams.ev);
	ZC.ZCUtils._trigger_event_('shape_' + sEvent, self.oParent, oParams);
};
ZC.ZCGraph.prototype.getHookXY = function(oHook) {
	var self = this, mValue;
	if (typeof(oHook) === 'string') {
		var oHook_ = {};
		var aTmp = oHook.split(':');
		if (aTmp.length === 2) {
			oHook_['type'] = aTmp[0];
			aTmp = aTmp[1].split(/\s|,|;/);
			for (var i=0,iLen=aTmp.length;i<iLen;i++) {
				var aKV = aTmp[i].split('=');
				oHook_[aKV[0]] = aKV[1];
			}
		}
		oHook = oHook_;
	}
	var aXY = [-1, -1];
	if (ZC._n_(oHook['x']) !== null) {
		aXY[0] = ZC._i_(oHook['x']);
	}
	if (ZC._n_(oHook['y']) !== null) {
		aXY[1] = ZC._i_(oHook['y']);
	}
	switch (oHook['type']) {
		case 'scale':
			var sScaleName = '';
			var iScaleIndex = -1;
			var fScaleValue = null;
			if (ZC._n_(mValue=oHook['name']) !== null) {
				sScaleName = mValue;
			}
			if (ZC._n_(mValue=oHook['index']) !== null) {
				iScaleIndex = ZC._i_(mValue);
			}
			if (ZC._n_(mValue=oHook['value']) !== null) {
				fScaleValue = ZC._i_(mValue);
			}
			var oScale = null, iX, iY;
			if (sScaleName === '') {
				sScaleName = 'scale-x';
			}
			oScale = self.getScaleByName(sScaleName);
			if (oScale) {
				if (ZC._n_(fScaleValue) !== null) {
					iX = oScale.getCoordByValue(fScaleValue);
				} else if (iScaleIndex !== -1) {
					iX = oScale.getCoordByValue(oScale.aValues[iScaleIndex]);
				}
				iY = oScale.iY;
				if (oScale.iIndex === 1) {
					iY += oScale.iHeight;
				}
			}
			aXY = [iX, iY, {center:true}];
			break;
		case 'node':
			
			var iNodeIndex = -1;
			var fNodeValue = null;
			var fNodeKeyValue = null;
			var sPlotIndex = null, sPlotId = null;
			if (ZC._n_(mValue=oHook['plot']) !== null) {
				sPlotIndex = mValue;
			}
			if (ZC._n_(mValue=oHook['plotindex']) !== null) {
				sPlotIndex = mValue;
			}
			if (ZC._n_(mValue=oHook['plotid']) !== null) {
				sPlotId = mValue;
			}
			var oPlot = self._api_getplot_(sPlotIndex, sPlotId);

			if (ZC._n_(mValue=oHook['index']) !== null) {
				iNodeIndex = ZC._i_(mValue);
			}
			if (ZC._n_(mValue=oHook['value']) !== null) {
				fNodeValue = mValue;
			}
			if (ZC._n_(mValue=oHook['keyvalue']) !== null) {
				fNodeKeyValue = mValue;
			}

			var oNode = null;

			if (oPlot) {
				if (iNodeIndex !== -1 && oPlot.aPlotNodes[iNodeIndex]) {
					oNode = oPlot.getNode(iNodeIndex, 3);
				} else if (ZC._n_(fNodeValue) !== null || ZC._n_(fNodeKeyValue) !== null) {
					for (var j=0,jLen=oPlot.aPlotNodes.length;j<jLen;j++) {
						if (oPlot.aPlotNodes[j]) {
							if (oPlot.aPlotNodes[j].fValue === fNodeValue) {
								oNode = oPlot.getNode(j, 3);
							}
							if (ZC._n_(oPlot.aPlotNodes[j].fKeyValue) !== null && oPlot.aPlotNodes[j].fKeyValue === fNodeKeyValue) {
								oNode = oPlot.getNode(j, 3);
							}
						}
					}
				}
				if (oNode) {
					oNode.setup();
					aXY = oNode.getHookXY(oHook);
				}
			}
			break;
	}
	if (ZC._n_(mValue=oHook['offset-x']) !== null) {
		aXY[0] += ZC._i_(mValue);
	}
	if (ZC._n_(mValue=oHook['offset-y']) !== null) {
		aXY[1] += ZC._i_(mValue);
	}
	return aXY;
};

zingchart.exec_html5_objects = function(sId, sCall, oParams) {
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var bUpdate = !(ZC._n_(oParams['update']) !== null && !ZC._b_(oParams['update']));

	

	var bDynamic = oParams['dynamic']?ZC._b_(oParams['dynamic']):false;
	var oLoader = zingchart.getLoader(sId);
	var oGraph, sType, aIds, aCls, i, iLen, aObjects, bSet, oData, bFound, j, jLen, k;
	if (oLoader) {
		switch (sCall) {
			case 'addobject':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph && oParams['data']) {
					bSet = (oParams['data'] instanceof Array);
					oData = bSet?[]:{};
					ZC._cp_(oParams['data'], oData);
					sType = oParams['type'] || 'label';
					if (bSet) {
						for (i=0,iLen=oData.length;i<iLen;i++) {
							sType = oParams['type'] || oData[i]['objtype'] || 'label';
							if (!oGraph.oData[sType + 's']) {
								oGraph.oData[sType + 's'] = [];
							}
							oGraph.oData[sType + 's'].push(oData[i]);
						}
					} else {
						if (!oGraph.oData[sType + 's']) {
							oGraph.oData[sType + 's'] = [];
						}
						oGraph.oData[sType + 's'].push(oData);
					}
					if (bUpdate) {
						oGraph.detectDynamicObjects();
						oGraph.repaintObjects(bDynamic);
					}
				}
				break;
			case 'removeobject':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oParams['class']) { oParams['cls'] = oParams['class']; } 
				if (oGraph && (oParams['id'] || oParams['cls'])) {
					oGraph.hideLayer();
					sType = oParams['type'] || 'label';
					aObjects = oGraph.oData[sType + 's'] || [];
					if (oParams['id']) {
						aIds = (typeof(oParams['id']) === 'string')?[oParams['id']]:oParams['id'];
					} else {
						aIds = [];
					}
					if (oParams['cls']) {
						aCls = (typeof(oParams['cls']) === 'string')?[oParams['cls']]:oParams['cls'];
					} else {
						aCls = [];
					}
					bFound = false;
					var aRemove = [];
					for (i=aObjects.length-1;i>=0;i--) {
						if (
							(ZC._n_(aObjects[i]['id']) !== null && ZC._indexof_(aIds, aObjects[i]['id']) !== -1)
							||
							(ZC._n_(aObjects[i]['cls']) !== null && ZC._indexof_(aCls, aObjects[i]['cls']) !== -1)
						) {
							if (ZC._n_(aObjects[i]['id']) !== null) {
								aRemove.push(aObjects[i]['id']);
							}
							aObjects.splice(i, 1);
							bFound = true;
						}
					}
					for (i=0;i<aRemove.length;i++) {
						
						ZC.ZCHtmlUtils._remove_([
							oGraph.sId + '-label-' + aRemove[i] + '-gradient', 
							oGraph.sId + '-label-' + aRemove[i] + '-top-gradient', 
							oGraph.sId + '-shape-' + aRemove[i] + '-gradient', 
							oGraph.sId + '-shape-' + aRemove[i] + '-top-gradient',
							oGraph.sId + '-shape-' + aRemove[i] + '-gshape-gradient', 
							oGraph.sId + '-shape-' + aRemove[i] + '-gshape-top-gradient'
						]);
					}
					if (bFound && bUpdate) {
						oGraph.detectDynamicObjects();
						oGraph.repaintObjects(bDynamic);
					}
				}
				break;
			case 'updateobject':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph && oParams['data']) {
					oGraph.oAttributes['objects.updates'] = [];
					sType = oParams['type'] || 'label';
					aObjects = oGraph.oData[sType + 's'];
					bSet = (oParams['data'] instanceof Array);
					oData = bSet?[]:{};
					ZC._cp_(oParams['data'], oData);

					bFound = false;

					var _update_ = function(oData, oObject) {
						var i, iLen;
						oGraph.oAttributes['objects.updates'].push(oData['id']);
						ZC._cp_(oData, oObject);
						if (ZC._n_(oData['animation']) !== null) {
							var oGraphObject = null;
							
							if (sType === 'label') {
								for (i=0,iLen=oGraph.aLabels.length;i<iLen;i++) {
									if (oGraph.aLabels[i].sObjectId === oData['id']) {
										oGraphObject = oGraph.aLabels[i];
										break;
									}
								}
							} else if (sType === 'shape') {
								for (i=0,iLen=oGraph.aShapes.length;i<iLen;i++) {
									if (oGraph.aShapes[i].sObjectId === oData['id']) {
										oGraphObject = (oGraph.aShapes[i] instanceof ZC.ZCGraphShape)?oGraph.aShapes[i].oShape:oGraph.aShapes[i];
										break;
									}
								}
							}
							var oTM = oGraph.oTweenManager;
							var oAnimationData = {};
							ZC._cp_(oData, oAnimationData);

							
							if (ZC._n_(oAnimationData['x']) !== null) {
								oAnimationData['x'] += oGraph.iX;
							}
							if (ZC._n_(oAnimationData['y']) !== null) {
								oAnimationData['y'] += oGraph.iY;
							}
							if (ZC._n_(oAnimationData['points']) !== null) {
								for (i=0,iLen=oAnimationData['points'].length;i<iLen;i++) {
									if (ZC._n_(oAnimationData['points'][i]) !== null) {
										oAnimationData['points'][i][0] += oGraph.iX;
										oAnimationData['points'][i][1] += oGraph.iY;
										if (ZC._n_(oAnimationData['points'][i][2]) !== null) {
											oAnimationData['points'][i][2] += oGraph.iX;
										}
										if (ZC._n_(oAnimationData['points'][i][3]) !== null) {
											oAnimationData['points'][i][3] += oGraph.iY;
										}
									}
								}
							}

							oAnimationData['animation'] = null;
							var oTween = new ZC.ZCTween(
								oGraphObject,
								oAnimationData,
								ZC._i_(oData['animation']['speed'] || '300'),
								ZC._i_(oData['animation']['delay'] || '0'),
								ZC.ZCTween.aMethods[ZC._i_(oData['animation']['method'] || '0')],
								function() {
									if (ZC._n_(oData['animation']['end']) !== null) {
										oData['animation']['end'].call();
									}
								}
							);
							oGraph.bObjectsTweening = true;
							window.setTimeout(function() {
								oTM.add(oTween);
							}, 33);
						}
						bFound = true;
					};

					if (bSet) {
						
						var bYes = false, bNo = false;
						for (i=0,iLen=oData.length;i<iLen;i++) {
							if (ZC._n_(oData[i]['objtype']) !== null) {
								aObjects = oGraph.oData[oData[i]['objtype'] + 's'];
							}
							if (aObjects) {
								for (j=0,jLen=aObjects.length;j<jLen;j++) {
									if (ZC._n_(oData[i]['id']) !== null && ZC._n_(aObjects[j]['id']) !== null && aObjects[j]['id'] === oData[i]['id']) {
										_update_(oData[i], aObjects[j]);
									}
								}
							}
							if (ZC._n_(oData[i]['animation']) !== null) {
								bYes = true;
							} else {
								bNo = true;
							}
							if (bNo && bYes) {
								oGraph.parseObjects();
							}
						}
					} else {
						sId = oData['id'] || oParams['id'];
						for (j=0,jLen=aObjects.length;j<jLen;j++) {
							if (ZC._n_(aObjects[j]['id']) !== null && ZC._n_(sId) !== null && aObjects[j]['id'] === sId) {
								oData['id'] = sId;
								_update_(oData, aObjects[j]);
							}
						}
					}
					if (bFound && (bUpdate || !oGraph.bObjectsTweening)) {
						if (!oGraph.bObjectsTweening) {
							oGraph.detectDynamicObjects();
							oGraph.repaintObjects(bDynamic);
						}
					}
				}
				break;
			case 'repaintobjects':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oGraph.detectDynamicObjects();
					oGraph.repaintObjects(bDynamic);
				}
				break;
			case 'getobjectsbyclass':
				if (oParams['class']) { oParams['cls'] = oParams['class']; } 
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				aIds = [];
				if (oGraph && oParams['cls']) {
					sType = oParams['type'] || 'label';
					aObjects = oGraph.oData[sType + 's'] || [];
					var aClass = (oParams['cls'] instanceof Array)?oParams['cls']:[oParams['cls']];
					for (i=0,iLen=aObjects.length;i<iLen;i++) {
						if ((ZC._indexof_(aClass, aObjects[i]['cls']) !== -1 || ZC._indexof_(aClass, aObjects[i]['class']) !== -1) && ZC._n_(aObjects[i]['id']) !== null) {
							aIds.push(aObjects[i]['id']);
						}
					}
				}
				return aIds;
			case 'getobjectinfo':
				var oAttrs = {
					x : 'iX',
					y : 'iY',
					width : 'iWidth',
					height : 'iHeight',
					color : 'sColor',
					lineColor : 'sLineColor',
					lineWidth : 'iLineWidth',
					borderColor : 'sBorderColor',
					borderWidth : 'iBorderWidth',
					backgroundColor1 : 'sBackgroundColor1',
					backgroundColor2 : 'sBackgroundColor2',
					size : 'iSize',
					type : 'sShape',
					text : 'sText',
					fontSize : 'iFontSize',
					callout : 'bCallout',
					calloutPosition : 'sCalloutPosition',
					offsetX : 'iOffsetX',
					offsetY : 'iOffsetY'
				};
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				sType = oParams['type'] || 'label';
				sId = oParams['id'] || '';
				if (oGraph && sId !== '') {
					var aCollection = [];
					if (sType === 'label') {
						aCollection = oGraph.aLabels;
					} else if (sType === 'shape') {
						aCollection = oGraph.aShapes;
					}
					var oObject = null;
					for (i=0,iLen=aCollection.length;i<iLen;i++) {
						if (aCollection[i].sObjectId === sId) {
							oObject = aCollection[i];
						}
					}
					if (oObject) {
						var oInfo = {};
						if (sType === 'shape') {
							if (oObject.oLabel) {
								oInfo['label'] = {};
								for (k in oAttrs) {
									oInfo['label'][k] = oObject.oLabel[oAttrs[k]];
								}
							}
							oObject = oObject.oShape;
						}
						for (k in oAttrs) {
							oInfo[k] = oObject[oAttrs[k]];
						}
						return oInfo;
					}
				}
				return null;
			case 'setobjectsmode':
				zingchart.OBJECTMODE = 'normal';
				if (oParams['mode'] && oParams['mode'] === 'flat') {
					zingchart.OBJECTMODE = 'flat';
				}
				break;
			case 'settweenmode':
				ZC.objmove = false;
				if (oParams['mode'] && oParams['mode'] === 'position') {
					ZC.objmove = true;
				}
				break;
		}
	}
	return null;
};












ZC.ZCGraph.prototype.getScalesMaxElements = function() {
	var self = this, i, iLen;
	var iMaxElements = 0;
	for (i=0,iLen=self.aScales.length;i<iLen;i++) {
		if (self.aScales[i].sType === 'k' && self.oData[self.aScales[i].sName] && self.oData[self.aScales[i].sName]['values']) {
			iMaxElements = ZC._max_(iMaxElements, self.oData[self.aScales[i].sName]['values'].length);
		}
	}
	for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
		if (ZC._n_(self.oData['series'][i]) !== null && self.oData['series'][i]['values']) {
			iMaxElements = ZC._max_(iMaxElements, self.oData['series'][i]['values'].length);
		}
	}
	return iMaxElements;
};
ZC.ZCGraph.prototype.syncScalesOnFeed = function() {
	var self = this, iMaxStepSize;
	if (!self.oRefresh) {
		return;
	}
	var iMaxElements = self.getScalesMaxElements();
	for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
		if (self.aScales[i].sType === 'k') {
			if (self.aScales[i].bInversed) {
				iMaxStepSize = (self.aScales[i].iHeight - self.aScales[i].iOffsetStart - self.aScales[i].iOffsetEnd)/ZC._i_(self.oRefresh['max-ticks']);
				self.aScales[i].iOffsetData = ZC._max_(0, self.aScales[i].iHeight - iMaxElements*iMaxStepSize);
			} else {
				iMaxStepSize = (self.aScales[i].iWidth - self.aScales[i].iOffsetStart - self.aScales[i].iOffsetEnd)/ZC._i_(self.oRefresh['max-ticks']);
				self.aScales[i].iOffsetData = ZC._max_(0, self.aScales[i].iWidth - iMaxElements*iMaxStepSize);
			}
			if (ZC._b_(self.oRefresh['adjust-scale'])) {
				self.aScales[i].iOffsetData = 0;
			}
			self.aScales[i].iOffsetStart = self.aScales[i].iOffsetStart_ + self.aScales[i].iOffsetData;
			self.oParent.oAttributes[self.aScales[i].sName + '-feed-offset-start'] = self.aScales[i].iOffsetStart;
			self.aScales[i].iMinIndex = ZC._max_(0, self.aScales[i].iMaxIndex-self.oRefresh['max-ticks']+1);
			self.aScales[i].setupStepSize();
		}
	}
};
ZC.ZCGraph.prototype.processRefresh = function() {
	var self = this, mValue, iMaxElements, ws;
	if (self.oRefresh) {
		var iTimeout = ZC._i_(self.oRefresh['interval']);
		iTimeout = (iTimeout>=50)?iTimeout:1000*iTimeout;

		if (self.oRefresh['type'] === 'full') {
			if (self.oRefresh['transport'] === 'http') {
				window.setTimeout(function() {
					self.oParent.showProgress(self);
					ZC._delay_(function() {
						self.oParent.load(self.sId, self.sUrlData);
					});
				}, iTimeout);
			} else if (self.oRefresh['transport'] === 'websockets' && ZC.websockets) {
				if (!self.oLoader.oSockets[self.sId]) {
					ws = new WebSocket(self.oRefresh['url'], 'zingchart');
					ws.onopen = function() {
						ws.send('zingchart.' + self.oRefresh['type']);
						ws.send('zingchart.' + self.oRefresh['method']);
						ws.send('zingchart.getdata');
					};
					ws.onmessage = function(evt) {
						if (self.sStage !== 'ready') {
							return;
						}
						self.oParent.showProgress(self);
						self.sStage = 'full';
						ZC._delay_(function() {
							zingchart.exec(self.oParent.sId, 'setdata', {graphid : self.sId, data : evt.data, softclear : true});
						});
					};
					self.oLoader.oSockets[self.sId] = ws;
				} else {
					if (self.oRefresh['method'] === 'pull') {
						window.setTimeout(function() {
							self.oLoader.oSockets[self.sId].send('zingchart.getdata');
						}, iTimeout);
					}
				}
			}

		} else if (self.oRefresh['type'] === 'feed' && ZC._n_(self.oRefresh['url']) !== null) {

			if (ZC._n_(self.oRefresh['curtain']) !== null) {
				var aKeyScales = self.getScales('k');
				if (aKeyScales.length > 0) {
					ZC.ZCHtmlUtils._remove_(self.sId + '-curtain-t');
					if (aKeyScales[0].iOffsetData > 0) {
						var oCurtain = new ZC.ZCTextBox(self);
						
						self.oParent.oDefaults.load(oCurtain.oData, '(' + self.sType + ').refresh.curtain');
						oCurtain.append(self.oRefresh['curtain']);
						oCurtain.parse();
						if (oCurtain.bVisible) {
							if ((aKeyScales[0].bInversed && oCurtain.iHeight <= aKeyScales[0].iOffsetData) ||
								(!aKeyScales[0].bInversed && oCurtain.iWidth <= aKeyScales[0].iOffsetData)) {
								oCurtain.sId = self.sId + '-curtain-t';
								oCurtain.oDOMParent = ZC._id_(self.oParent.sId + '-text-top');
								if (aKeyScales[0].bInversed) {
									if (oCurtain.iHeight > aKeyScales[0].iOffsetData) {
										oCurtain.sText = '';
										oCurtain.parse();
									}
									oCurtain.iX = self.oPlotArea.iX;
									oCurtain.iY = (aKeyScales[0].bMirrored)?self.oPlotArea.iY:(self.oPlotArea.iY + self.oPlotArea.iHeight - aKeyScales[0].iOffsetData);
									oCurtain.iWidth = self.oPlotArea.iWidth;
									oCurtain.iHeight = aKeyScales[0].iOffsetData;
								} else {
									if (oCurtain.iWidth > aKeyScales[0].iOffsetData) {
										oCurtain.sText = '';
										oCurtain.parse();
									}
									oCurtain.iX = (aKeyScales[0].bMirrored)?(self.oPlotArea.iX + self.oPlotArea.iWidth - aKeyScales[0].iOffsetData):self.oPlotArea.iX;
									oCurtain.iY = self.oPlotArea.iY;
									oCurtain.iWidth = aKeyScales[0].iOffsetData;
									oCurtain.iHeight = self.oPlotArea.iHeight;
								}
								oCurtain.oCanvas = oCurtain.oCanvasSh = ZC._id_(self.sId + '-scales-ml-0-c');
								oCurtain.paint();
							}
						}
					}
				}
			}

			var sTransport = self.oRefresh['transport'];
			var iResetTimeout = ZC._i_(self.oRefresh['reset-timeout']);
			var iStopTimeout = ZC._i_(self.oRefresh['stop-timeout']);
			var bStorage = ZC._b_(self.oRefresh['storage']);
			

			var _push_data_ = function(sResponse) {
				var mResponse = eval('(' + sResponse + ')');
				var i, iLen;
				var aResponse = (mResponse instanceof Array)?mResponse:[mResponse];
				for (var r=0,rLen=aResponse.length;r<rLen;r++) {
					var oResponse = aResponse[r];
					for (i=0,iLen=self.aScales.length;i<iLen;i++) {
						if (self.aScales[i].sType === 'k') {
							var sName = self.aScales[i].sName;
							if (ZC._n_(oResponse[sName]) !== null && ZC._n_(self.oData[sName]) !== null) {
								if (ZC._n_(self.oData[sName]['values']) === null) {
									self.oLoader.oData['graphset'][self.iIndex][sName]['values'] = [];
									self.oData[sName]['values'] = [];
								}
								self.oData[sName]['values'].push(oResponse[sName]);
								self.oLoader.oData['graphset'][self.iIndex][sName]['values'].push(oResponse[sName]);
								if (self.oData[sName]['values'].length > iResetTimeout || self.aFeedStatus[1] === 1) {
									self.oLoader.oData['graphset'][self.iIndex][sName]['values'] = [];
									self.oData[sName]['values'] = [];
								}
								if (ZC.webstorage && bStorage) {
									ZC.ZCUtils.storage.push('zingchart.scale.' + self.sId + '.' + sName, (''+oResponse[sName]));
								}
							}
						}
					}
					for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
						if (ZC._n_(self.oData['series'][i]) !== null) {
							var mData = null;
							if (ZC._n_(mValue=oResponse['plot-'+i]) !== null) {
								mData = mValue;
							} else if (ZC._n_(mValue=oResponse['plot'+i]) !== null) {
								mData = mValue;
							}
							if (self.oSettings['layout'] == 'xy' || self.oSettings['layout'] == 'yx') {
								
								self.oLoader.oData['graphset'][self.iIndex]['series'][i]['values'].push(mData);
							} else {
								self.oLoader.oData['graphset'][self.iIndex]['series'][i]['values'] = [mData];
								
							}
							if (ZC.webstorage && bStorage) {
								mValue = oResponse['plot'+i];
								if (typeof(mValue) === 'object') {
									mValue = mValue.join('###');
								}
								ZC.ZCUtils.storage.push('zingchart.plot.' + self.sId + '.plot' + i, (''+mValue));
							}
							if (self.oData['series'][i]['values'].length > iResetTimeout || self.aFeedStatus[1] === 1) {
								ZC.ZCUtils._trigger_event_('feed_clear', self.oParent, self._api_graph_info_(), oResponse);
								self.oLoader.oData['graphset'][self.iIndex]['series'][i]['values'] = [];
								
							}
						}
					}
					iMaxElements = self.getScalesMaxElements();
				}
				if (self.sStage !== 'ready') {
					return;
				}
				if (self.aFeedStatus[1] === 1) {
					self.aFeedStatus[1] = 0;
				}
				if (iMaxElements <= iStopTimeout || iStopTimeout === 0) {
					self.sStage = 'feed';
					ZC._delay_(function() {
						if (ZC._id_(self.oParent.sId+'-main')) {
							self.parse();
							self.clear(true);
							self.syncScalesOnFeed();
							self.paint(true, true);
						}
					});
				}
			};

			if (sTransport === 'http' || sTransport === 'js') {
				var sUrl = self.oRefresh['url'];
				window.setTimeout(function() {
					if (self.aFeedStatus[0] === 1) {
						self.oParent.showProgress(self);
						if (sTransport === 'http') {
							var sData = [
								self.oParent.sCacheControl==='query-string'?('zcrandom='+Math.random()):'',
								zingchart.ZCOUTPUT?('zcoutput=' + self.oLoader.sOutput):''
							].join('&');
							ZC.ZCQuery.ajax({
								type : 'GET',
								url : sUrl,
								beforeSend : function(oXhr) {
									if (!self.oParent.oXhrCache['data'] && self.oParent.sCacheControl === 'http-headers') {
										oXhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jan 1970 00:00:00 GMT');
									}
								},
								data : sData,
								dataType : 'text',
								error : function() {
								},
								success : function(sResponse) {
									_push_data_(sResponse);
								}
							});
						} else {
							if (sUrl.substring(sUrl.length-2) === '()' || sUrl.substring(0, 11) === 'javascript:') {
								try {
									var sCall = sUrl.replace('javascript:', '').replace('()', '');
									if (eval(sCall)) {
										eval(sCall).call(self, function(sResponse) {
											_push_data_(sResponse);	
										});
									}
								} catch (e) {}
							}
						}
					}
				}, iTimeout);
			} else if (sTransport === 'websockets' && ZC.websockets) {
				if (!self.oLoader.oSockets[self.sId]) {
					ws = new WebSocket(self.oRefresh['url'], 'zingchart');
					ws.onopen = function() {
						ws.send('zingchart.' + self.oRefresh['type']);
						ws.send('zingchart.' + self.oRefresh['method']);
						ws.send('zingchart.startfeed');
						if (self.oRefresh['method'] === 'pull') {
							ws.send('zingchart.getdata');
						}
					};
					ws.onmessage = function(evt) {
						if (self.aFeedStatus[0] === 1) {
							_push_data_(evt.data);
						}
					};
					self.oLoader.oSockets[self.sId] = ws;
				} else {
					if (self.oRefresh['method'] === 'pull') {
						window.setTimeout(function() {
							self.oLoader.oSockets[self.sId].send('zingchart.getdata');
						}, iTimeout);
					}
				}
			}
		}
	}
};


zingchart.exec_html5_feed = function(sId, sCall, oParams) {
	var mValue;
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var oLoader = zingchart.getLoader(sId);
	if (oLoader) {
		var oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
		switch (sCall) {
			case 'clearfeed':
				oGraph.aFeedStatus[1] = 1;
				break;
			case 'getinterval':
				return oGraph.oRefresh['interval'];
			case 'setinterval':
				ZC.ZCUtils._trigger_event_('feed_interval_modify', oLoader, oGraph._api_graph_info_());
				oGraph.oData['refresh'] = oGraph.oData['refresh'] || {};
				oGraph.oData['refresh']['interval'] = oParams['interval'] || 1;
				break;
			case 'stopfeed':
				ZC.ZCUtils._trigger_event_('feed_stop', oLoader, oGraph._api_graph_info_());
				oGraph.aFeedStatus[0] = 0;
				if (ZC._n_(mValue=oLoader.oSockets[oGraph.sId]) !== null) {
					mValue.send('zingchart.stopfeed');
				}
				break;
			case 'startfeed':
				ZC.ZCUtils._trigger_event_('feed_start', oLoader, oGraph._api_graph_info_());
				oGraph.aFeedStatus[0] = 1;
				if (ZC._n_(mValue=oLoader.oSockets[oGraph.sId]) !== null) {
					mValue.send('zingchart.startfeed');
				}
				ZC._delay_(function() {
					oGraph.parse();
					oGraph.clear(true);
					oGraph.syncScalesOnFeed();
					oGraph.paint(true, true);
				});
				break;
		}
	}
	return null;
};












ZC.ZCUtils._format_selection_ = function(mValue) {
	var oSelection = {}, aSelection = [];
	if (typeof(mValue) === 'object') {
		aSelection = mValue;
	} else {
		aSelection = JSON.parse(mValue);
	}
	for (var p=0,pLen=aSelection.length;p<pLen;p++) {
		if (ZC._n_(mValue=aSelection[p]) !== null) {
			oSelection['p'+p] = {};
			var aNodeIndex = [];
			if (typeof(mValue) === 'object') {
				aNodeIndex = mValue;
			} else {
				if (typeof(mValue) === 'string' && /\d+\-\d+/.test(mValue)) {
					var aInfo = mValue.split('-');
					if (aInfo.length === 2) {
						aNodeIndex = [];
						for (var i=ZC._i_(aInfo[0]);i<=ZC._i_(aInfo[1]);i++) {
							aNodeIndex.push(i);
						}
					}
				} else {
					aNodeIndex = [mValue];
				}
			}
			for (var n=0,nLen=aNodeIndex.length;n<nLen;n++) {
				oSelection['p'+p]['n'+aNodeIndex[n]] = true;
			}
		}
	}
	return oSelection;
};
ZC.ZCGraph.prototype.parseSelection = function() {
	var self = this, mValue;
	if (ZC._n_(mValue=self.oData['selection']) !== null) {
		self.oSelection = ZC.ZCUtils._format_selection_(mValue);
		self.oData['selection'] = null;
	}
};

zingchart.exec_html5_selection = function(sId, sCall, oParams) {
	var mValue, oGraph, p, pLen, aInfo, aSelection, n, nLen, i;
	if (document.getElementById('zc-fullscreen')) {
		sId = 'zc-fullscreen';
	}
	oParams = oParams || {};
	if (typeof(oParams) === 'string') {
		oParams = JSON.parse(oParams);
	}
	var oLoader = zingchart.getLoader(sId);
	if (oLoader) {
		switch (sCall) {
			case 'clearselection':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oGraph.oSelection = {};
					for (p=0,pLen=oGraph.oPlotSet.aPlots.length;p<pLen;p++) {
						oGraph.aSelection[p] = false;
					}
					oGraph.bDisableAnimation = true;
					oGraph.repaint(true, true);
				}
				break;
			case 'getselection':
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					
					aSelection = [];
					for (p=0,pLen=oGraph.oPlotSet.aPlots.length;p<pLen;p++) {
						aSelection[p] = null;
						if (ZC._n_(oGraph.oSelection['p'+p]) !== null) {
							var aNodeIndex = [];
							for (n in oGraph.oSelection['p'+p]) {
								if (oGraph.oSelection['p'+p].hasOwnProperty(n) && oGraph.oSelection['p'+p][n]) {
									aNodeIndex.push(ZC._i_(n.replace('n', '')));
								}
							}
							aSelection[p] = aNodeIndex;
						}
					}
					return aSelection;
				}
				return {};
			case 'setselection':
				var oSelection = {};
				aSelection = [];
				if (ZC._n_(mValue=oParams['selection']) !== null) {
					oSelection = ZC.ZCUtils._format_selection_(mValue);
				}
				oGraph = oLoader._api_getgraphbyid_(oParams['graphid']);
				if (oGraph) {
					oGraph.oSelection = oSelection;
					oGraph.bDisableAnimation = true;
					oGraph.repaint(true, true);
				}
				break;
			case 'select':
			case 'deselect':
				var aGraphs = [];
				var _select_ = function(oParams_) {
					var bToggle = false;
					if (ZC._n_(mValue=oParams_['toggle']) !== null) {
						bToggle = ZC._b_(mValue);
					}
					var oGraph = oLoader._api_getgraphbyid_(oParams_['graphid']);
					if (oGraph) {
						for (p=0,pLen=oGraph.oPlotSet.aPlots.length;p<pLen;p++) {
							oGraph.aSelection[p] = false;
						}
						var aPlotIndex = null, aNodeIndex = null;
						if (ZC._n_(mValue=oParams_['plotindex']) !== null) {
							if (typeof(mValue) === 'object') {
								aPlotIndex = mValue;
							} else {
								if (typeof(mValue) === 'string' && /\d+\-\d+/.test(mValue)) {
									aInfo = mValue.split('-');
									if (aInfo.length === 2) {
										aPlotIndex = [];
										for (i=ZC._i_(aInfo[0]);i<=ZC._i_(aInfo[1]);i++) {
											aPlotIndex.push(i);
										}
									}
								} else {
									aPlotIndex = [mValue];
								}
							}
						}
						if (ZC._n_(mValue=oParams_['nodeindex']) !== null) {
							if (typeof(mValue) === 'object') {
								aNodeIndex = mValue;
							} else {
								if (typeof(mValue) === 'string' && /\d+\-\d+/.test(mValue)) {
									aInfo = mValue.split('-');
									if (aInfo.length === 2) {
										aNodeIndex = [];
										for (i=ZC._i_(aInfo[0]);i<=ZC._i_(aInfo[1]);i++) {
											aNodeIndex.push(i);
										}
									}
								} else {
									aNodeIndex = [mValue];
								}
							}
						}
						if (ZC._n_(aPlotIndex) === null) {
							aPlotIndex = [];
							for (p=0,pLen=oGraph.oPlotSet.aPlots.length;p<pLen;p++) {
								aPlotIndex.push(p);
							}
						}
						for (p=0,pLen=aPlotIndex.length;p<pLen;p++) {
							var pp = aPlotIndex[p];
							if (oGraph.oPlotSet.aPlots[pp]) {
								if (ZC._n_(oGraph.oSelection['p'+pp]) === null) {
									oGraph.oSelection['p'+pp] = {};
								}
								if (ZC._n_(aNodeIndex) === null) {
									for (n=0,nLen=oGraph.oPlotSet.aPlots[pp].aPlotNodes.length;n<nLen;n++) {
										if (sCall === 'select') {
											if (!bToggle) {
												oGraph.oSelection['p'+pp]['n'+n] = true;
											} else {
												if (oGraph.oSelection['p'+pp]['n'+n]) {
													delete oGraph.oSelection['p'+pp]['n'+n];
												} else {
													oGraph.oSelection['p'+pp]['n'+n] = true;
												}
											}
										} else if (sCall === 'deselect') {
											delete oGraph.oSelection['p'+pp]['n'+n];
										}
									}
								} else {
									for (n=0,nLen=aNodeIndex.length;n<nLen;n++) {
										if (sCall === 'select') {
											if (!bToggle) {
												oGraph.oSelection['p'+pp]['n'+aNodeIndex[n]] = true;
											} else {
												if (oGraph.oSelection['p'+pp]['n'+aNodeIndex[n]]) {
													delete oGraph.oSelection['p'+pp]['n'+aNodeIndex[n]];
												} else {
													oGraph.oSelection['p'+pp]['n'+aNodeIndex[n]] = true;
												}
											}
										} else if (sCall === 'deselect') {
											delete oGraph.oSelection['p'+pp]['n'+aNodeIndex[n]];
										}
									}
								}
							}
						}

						if (ZC._indexof_(aGraphs, oGraph) === -1) {
							aGraphs.push(oGraph);
						}
					}
				};
				if (oParams instanceof Array) {
					for (i=0;i<oParams.length;i++) {
						_select_(oParams[i]);
					}
				} else {
					_select_(oParams);
				}
				for (i=0;i<aGraphs.length;i++) {
					aGraphs[i].bDisableAnimation = true;
					aGraphs[i].repaint(true, true);
				}
				break;
		}
	}
	return null;
};










ZC.ZCGraph.prototype.setup3DView = function() {
	var self = this;
	if (self.oSettings['3d'] && typeof(ZC.ZCDraw3D) !== 'undefined') {
		ZC.ZCDraw3D.iViewD = 2.5*ZC._max_(self.iWidth, self.iHeight);
		ZC.ZCDraw3D.iViewX = self.oPlotArea.iX + self.oPlotArea.iWidth/2;
		ZC.ZCDraw3D.iViewY = self.oPlotArea.iY + self.oPlotArea.iHeight/2;
		ZC.ZCDraw3D.iDepth = ZC._i_(self.o3DAspect['depth']);
		
		ZC.ZCDraw3D.iViewX += self.o3DAspect['offset-x'];
		ZC.ZCDraw3D.iViewY += self.o3DAspect['offset-y'];
	}
};
ZC.ZCGraph.prototype.parse3D = function() {
	var self = this, mValue, i;
	if (self.oSettings['3d'] && typeof(ZC.ZCDraw3D) !== 'undefined') {
		self.oParent.oDefaults.load(self.o3DAspect, 'graph.3d-aspect');
		self.oParent.oDefaults.load(self.o3DAspect, self.sType + '.3d-aspect');
		if (ZC._n_(mValue=self.oData['3d-aspect']) !== null) {
			ZC._cp_(mValue, self.o3DAspect);
		}
		
		if (self.sType === 'pie3d' && self.oData['plot'] && self.oData['plot']['tilt']) {
			var fTilt = ZC._l_(ZC._f_(self.oData['plot']['tilt']), 1, 3);
			self.o3DAspect['x-angle'] = 25 + ((fTilt-1)/2)*(self.oSettings['x-angle-max'] - self.oSettings['x-angle-min']);
		}
		var a3DAttrs = ['angle', 'depth', 'x-angle', 'y-angle', 'z-angle', 'zoom', 'offset-x', 'offset-y'];
		for (i=0;i<a3DAttrs.length;i++) {
			self.o3DAspect[a3DAttrs[i]] = ZC._f_(self.o3DAspect[a3DAttrs[i]]);
		}
		var a3DAngles = ['angle', 'x-angle', 'y-angle', 'z-angle'];
		for (i=0;i<a3DAngles.length;i++) {
			if (!ZC._btw_(self.o3DAspect[a3DAngles[i]], self.oSettings[a3DAngles[i]+'-min'], self.oSettings[a3DAngles[i]+'-max'])) {
				self.o3DAspect[a3DAngles[i]] = self.oSettings[a3DAngles[i]+'-min'];
			}
		}
		self.o3DAspect['true3d'] = ZC._b_(self.o3DAspect['true3d']);
	}
};
ZC.ZCGraph.prototype.paint3D = function() {
	var self = this, f, oFace;

	if (zingchart.V3D !== 3) {
		zingchart.V3D = self.o3DAspect['true3d']?1:2;
	}

	var iFaces = self.oEngine3D.aFaces.length;

	for (f=0;f<iFaces;f++) {
		oFace = self.oEngine3D.aFaces[f];
		oFace.evalFace();
		if (self.o3DAspect['true3d']) {
			if (zingchart.V3D === 3) {
				self.oEngine3D.aDistances[f] = [ZC._f_(oFace.iFarthestZ_.toFixed(1))*oFace.aPriorities[2], f];
			} else {
				self.oEngine3D.aDistances[f] = [
					[
						ZC._f_(oFace.iFarthestZ.toFixed(1))*oFace.aPriorities[0],
						ZC._f_(oFace.iClosestZ.toFixed(1))*oFace.aPriorities[1],
						ZC._f_(oFace.iFarthestZ_.toFixed(1))*oFace.aPriorities[2],
						ZC._f_(oFace.iAvgY.toFixed(1))
					], f];
			}
		} else {
			self.oEngine3D.aDistances[f] = [
				[
					ZC._f_(oFace.iFarthestZ.toFixed(1))*oFace.aPriorities[0],
					ZC._f_(oFace.iLeftestX.toFixed(1))*oFace.aPriorities[1],
					ZC._f_(oFace.iAvgX.toFixed(1))*oFace.aPriorities[2],
					ZC._i_(oFace.iPriority)
				], f];
		}
	}

	self.oEngine3D.aDistances.sort(self.oEngine3D.sortFaces);

	var oShape = new ZC.ZCShape(self);
	var oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.sId + '-plots-bl-c');

	

	for (f=0;f<iFaces;f++) {
		var aPoints = [];

		var iFace = self.oEngine3D.aDistances[f][1];
		oFace = self.oEngine3D.aFaces[iFace];

		var iPoints = oFace.aPoints.length;
		if (iPoints > 0) {
			var bView = true;
			for (var p=0;p<iPoints;p++) {
				aPoints.push(oFace.aPoints[p].aXY);
			}
			if (bView) {
				aPoints.push(oFace.aPoints[0].aXY);
				oShape.init(self);

				
				oShape.sId = self.sId + '-3dshape-' + ((oFace.sId !== '')?oFace.sId:ZC.SEQ++);
				
				oShape.copy(oFace.oStyle);
				oShape.bPixelCorrection = false;
				oShape.oCanvas = oCanvas;
				
				oShape.locate(1);
				oShape.aPoints = aPoints;
				oShape.sShape = 'poly';
				oShape.locate(2);
				oShape.paint();

				

			}
		}
	}

	
};












ZC.ZCGraph.prototype.paintLegend = function() {
	if (zingchart.SKIP.LEGEND) {
		return;
	}
	var self = this, mValue;
	if (self.oLegend) {
		self.oLegend.oCanvas = self.oLegend.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.sId + '-legend-c');
		

		self.oLegend.paint();
		if (!self.bSoftPaint) {
			if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
				self.zc_legend_item_mouseover = function(ev) {
					var i,iLen;
					if (ZC.move){return;}
					if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
						self.oParent.oTooltip.onmouseover(ev);
					}					
					var sTargetId = ev.targetid || ev.target.id;
					var iPlotIndex = ZC._i_(sTargetId.replace(self.sId, '').replace('-legend-item_', '').replace('-legend-marker_', '').replace('-area', '').replace('-marker', ''));
					var oPlot = self.oPlotSet.aPlots[iPlotIndex];
					if ((self.oLegend.bHighlightPlot || oPlot.bHighlight) && oPlot.getNode(0)) {
						for (i=0,iLen=oPlot.aPlotNodes.length;i<iLen;i++) {
							if (oPlot.aPlotNodes[i] !== null) {
								oPlot.getNode(i).showLayer('highlight');
							}
						}
					}
					ZC.move = true;
				    self.oLegend.highlightItem(iPlotIndex);
					ZC.move = false;
				};
				self.zc_legend_item_mousemove_tt = function(ev) {
					if (ZC.move){return;}
					if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
						self.oParent.oTooltip.onmousemove(ev);
					}
				};
				self.zc_legend_item_mouseout = function(ev) {
					if (ZC.move){return;}
					if (self.oTooltip && self.oParent.oTooltip && self.oTooltip.bVisible) {
						self.oParent.oTooltip.onmouseout(ev);
					}
					
					self.hideLayer();
					
					ZC.move = true;
				    self.oLegend.highlightItem(-1);
					
					ZC.move = false;
				};
				self.zc_legend_item_click = function(ev) {
					if (ZC.move){return;}
					zingchart.zc_click(ev);
					
					if (ev.which > 1) {
						return;
					}
					var sTargetId = ev.targetid || ev.target.id;
					var bIgnoreLegend = ZC._b_(self.oLegend.oItem.oData['reorder']);
					var i, iLen, bRepaint;

					if (ZC.mobile && self.oLoader.oTooltip) {
						self.oLoader.oTooltip.hide();
					}

					var sTargetType = 'item';
					if (sTargetId.indexOf('-legend-marker_') !== -1) {
						sTargetType = 'marker';
					}

					self.hideLayer();

					ev.preventDefault();
					
					var sToggleAction = self.oLegend.sToggleAction;
					if (sTargetType === 'item') {
						sToggleAction = self.oLegend.sItemToggleAction;
					} else if (sTargetType === 'marker') {
						sToggleAction = self.oLegend.sMarkerToggleAction;
					}
					if (self.oParent.bFlat) {
						sToggleAction = 'remove';
					}
					self.oAttributes['legend-last-trigger'] = sTargetType;

					var iPlotIndex = ZC._i_(sTargetId.replace(self.sId + '-legend-item_', '').replace(self.sId + '-legend-marker_', '').replace('-area', ''));
					
					
					if (self.oData['series'] && self.oData['series'][iPlotIndex]) {
						
						if (ZC._n_(mValue=self.oData['series'][iPlotIndex]['legend-item']) !== null) {
							var sUrl = mValue['url'] || '';
							var sTarget = mValue['target'] || '';
							if (sUrl !== '') {
								self._onclick_(ev, sUrl, sTarget);
							}
						}
						self.oData['series'][iPlotIndex]['visible'] = true;	
					}

					var oPlotInfo = self.oPlotSet.aPlots[iPlotIndex]._api_plot_info_(ev);
					oPlotInfo['visible'] = ZC._b_(self.oAttributes['plot'+iPlotIndex+'.visible']);
					ZC.ZCUtils._trigger_event_('legend_' + sTargetType + '_click', self.oParent, oPlotInfo);

					if (!self.oLegend.oAttributes['item.toggle']) {
						return;
					}

					if (self.oLegend.bShared) {
						for (i=0,iLen=self.oLoader.aGraphs.length;i<iLen;i++) {
							var oGraph = self.oLoader.aGraphs[i];
							if (oGraph.oLegend && oGraph.oLegend.bShared && oGraph.oLegend.iGroup === self.oLegend.iGroup && oGraph.sId !== self.sId) {
								oGraph._api_plot_toggle_({'ignore-legend': bIgnoreLegend, repaint : 1, plotindex : iPlotIndex, 'toggle-action' : sToggleAction});
							}
						}
					}

					switch (sToggleAction) {
						
						default:
							break;
						case 'hide':
						case 'remove':
							if (!ev.shiftKey) {
								self._api_plot_toggle_({'ignore-legend': bIgnoreLegend, repaint : 1, plotindex : iPlotIndex, 'toggle-action' : sToggleAction});
							} else {
								var c = 0;
								for (i=0,iLen=self.oPlotSet.aPlots.length;i<iLen;i++) {
									if (i !== iPlotIndex) {
										c++;
										bRepaint = (c === iLen-1);
										self._api_plot_toggle_({'ignore-legend': bIgnoreLegend, repaint : bRepaint, plotindex : i, 'toggle-action' : sToggleAction});
									}
								}
							}
							break;
					}
				};
				
				ZC.ZCQuery('.' + self.sId + '-legend-item-area').live('mouseup touchstart', self.zc_legend_item_click);
				ZC.ZCQuery('.' + self.sId + '-legend-marker-area').live('mouseup touchstart', self.zc_legend_item_click);
				ZC.ZCQuery('.' + self.sId + '-legend-marker-area').live('DOMMouseScroll mousewheel', self.oLegend.zc_legend_mousescroll);
				ZC.ZCQuery('.' + self.sId + '-legend-item-area').live('DOMMouseScroll mousewheel', self.oLegend.zc_legend_mousescroll);

				if (!ZC.mobile) {
					ZC.ZCQuery('.' + self.sId + '-legend-item-area')
						.live(ZC.ZCHtmlUtils._event_('mouseover'), self.zc_legend_item_mouseover)
						.live(ZC.ZCHtmlUtils._event_('mouseout'), self.zc_legend_item_mouseout)
						.live(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_item_mousemove_tt);
					ZC.ZCQuery('.' + self.sId + '-legend-marker-area')
						.live(ZC.ZCHtmlUtils._event_('mouseover'), self.zc_legend_item_mouseover)
						.live(ZC.ZCHtmlUtils._event_('mouseout'), self.zc_legend_item_mouseout)
						.live(ZC.ZCHtmlUtils._event_('mousemove'), self.zc_legend_item_mousemove_tt);
				}
			}
		}
	}
};









ZC.ZCNullGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'null';
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
	}
});










ZC.ZCNull3DGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'null3d';
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['x-angle-min'] = -1800;
		self.oSettings['x-angle-max'] = 1800;
		self.oSettings['y-angle-min'] = -1800;
		self.oSettings['y-angle-max'] = 1800;
		self.oSettings['z-angle-min'] = -1800;
		self.oSettings['z-angle-max'] = 1800;
		zingchart.V3D = 3;
	},
	clear : function() {
		var self = this;
		self._super();
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.parseObjects();
		self.paint3D();
		self.flatten();
		self.paintObjects();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
		
	}
});









ZC.ZCXYGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'xy';
		self.oSettings['clip'] = true;
		self.oSettings['layout'] = 'xy';
	},
	createScale : function(sType) {
		var self = this;
		switch (sType) {
			case 'x':
				return new ZC.ZCScaleX(self);
			case 'y':
				return new ZC.ZCScaleY(self);
		}
	},
	parseScales : function() {
		var self = this, i;

		var oScaleX = self.createScale('x', 'scale-x');
		oScaleX.sName = 'scale-x';
		oScaleX.sId = self.sId + '-scale-x';
		self.aScales.push(oScaleX);

		for (i=2;i<10;i++) {
			if (ZC._n_(self.oData['scale-x-' + i]) !== null) {
				var oScaleXn = self.createScale('x', 'scale-x-' + i);
				oScaleXn.iIndex = i;
				oScaleXn.sName = 'scale-x-' + i;
				oScaleXn.sId = self.sId + '-scale-x-' + i;
				self.aScales.push(oScaleXn);
			}
		}

		var oScaleY = self.createScale('y', 'scale-y');
		oScaleY.sName = 'scale-y';
		oScaleY.sId = self.sId + '-scale-y';
		self.aScales.push(oScaleY);

		for (i=2;i<10;i++) {
			if (ZC._n_(self.oData['scale-y-' + i]) !== null) {
				var oScaleYn = self.createScale('y', 'scale-y-' + i);
				oScaleYn.iIndex = i;
				oScaleYn.sName = 'scale-y-' + i;
				oScaleYn.sId = self.sId + '-scale-y-' + i;
				self.aScales.push(oScaleYn);
			}
		}

		self._super();
	}
});










ZC.ZCLineGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'line';
		self.oPlotSet = new ZC.ZCLinePlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-scroll'] = true;
	}
});










ZC.ZCAreaGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'area';
		self.oPlotSet = new ZC.ZCAreaPlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-scroll'] = true;
	}
});










ZC.ZCVLineGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vline';
		self.oSettings['layout'] = 'yx';
		self.oPlotSet = new ZC.ZCVLinePlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = false;
		self.oSettings['enable-scroll'] = true;
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				return new ZC.ZCScaleXi(this);
			case 'y':
				return new ZC.ZCScaleYi(this);
		}
	}
});










ZC.ZCVAreaGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'varea';
		self.oSettings['layout'] = 'yx';
		self.oPlotSet = new ZC.ZCVAreaPlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = false;
		self.oSettings['enable-scroll'] = true;
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				return new ZC.ZCScaleXi(this);
			case 'y':
				return new ZC.ZCScaleYi(this);
		}
	}
});










ZC.ZCVBarGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vbar';
		self.oPlotSet = new ZC.ZCVBarPlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-scroll'] = true;
	},
	createScale : function(sType, sName) {
		switch (sType) {
			case 'x':
				var oScaleX = this._super(sType, sName);
				oScaleX.bRanged = true;
				return oScaleX;
			case 'y':
				return this._super(sType, sName);
		}
	}
});










ZC.ZCHBarGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbar';
		self.oSettings['layout'] = 'yx';
		self.oSettings['enable-guide'] = true;
		self.oPlotSet = new ZC.ZCHBarPlotSet(self);
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				var oScaleX = new ZC.ZCScaleXi(this);
				oScaleX.bRanged = true;
				return oScaleX;
			case 'y':
				return new ZC.ZCScaleYi(this);
		}
	}
});









ZC.ZCMixedGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'mixed';
		self.oPlotSet = new ZC.ZCMixedPlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-scroll'] = true;
	},
	createScale : function(sType, sName) {
		switch (sType) {
			case 'x':
				var bHasBar = false;
				if (this.oData['series']) {
					for (var i=0;i<this.oData['series'].length;i++) {
						if (this.oData['series'][i] && this.oData['series'][i]['type'] && this.oData['series'][i]['type'].indexOf('bar') !== -1) {
							var aScales = (this.oData['series'][i]['scales'] || 'scale-x,scale-y').split(',');
							if (ZC._indexof_(aScales, sName) !== -1) {
								bHasBar = true;
							}
						}
					}
				}
				var oScaleX = this._super(sType, sName);
				oScaleX.bRanged = bHasBar;
				return oScaleX;
			case 'y':
				return this._super(sType, sName);
		}
	}
});









ZC.ZCHMixedGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hmixed';
		self.oSettings['layout'] = 'yx';
		self.oSettings['enable-guide'] = true;
		self.oPlotSet = new ZC.ZCMixedPlotSet(self);
	},
	createScale : function(sType, sName) {
		switch (sType) {
			case 'x':
				var oScaleX = new ZC.ZCScaleXi(this);
				var bHasBar = false;
				if (this.oData['series']) {
					for (var i=0;i<this.oData['series'].length;i++) {
						if (this.oData['series'][i] && this.oData['series'][i]['type'] && this.oData['series'][i]['type'].indexOf('bar') !== -1) {
							var aScales = (this.oData['series'][i]['scales'] || 'scale-x,scale-y').split(',');
							if (ZC._indexof_(aScales, sName) !== -1) {
								bHasBar = true;
							}
						}
					}
				}
				oScaleX.bRanged = bHasBar;
				return oScaleX;
			case 'y':
				return new ZC.ZCScaleYi(this);
		}
	}
});









ZC.ZCMixed3DGraph = ZC.ZCMixedGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'mixed3d';
		self.oPlotSet = new ZC.ZCMixedPlotSet(self);
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['enable-preview'] = false;
		self.oSettings['enable-animation'] = false;
		self.oSettings['enable-scroll'] = false;
	},
	clear : function() {
		var self = this;
		self._super();
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.paint3D();
		self.flatten();
		self.oEngine3D.clear();
		self.parseObjects();
		self.paintObjects();
		self.paint3D();
		self.paintLegend();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
	}
});










ZC.ZCScatterGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'scatter';
		self.oPlotSet = new ZC.ZCScatterPlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-scroll'] = true;
	}
});










ZC.ZCHScatterGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hscatter';
		self.oSettings['layout'] = 'yx';
		self.oSettings['enable-guide'] = true;
		self.oPlotSet = new ZC.ZCHScatterPlotSet(self);
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				return new ZC.ZCScaleXi(this);
			case 'y':
				return new ZC.ZCScaleYi(this);
		}
	}
});










ZC.ZCBubbleGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'bubble';
		self.oPlotSet = new ZC.ZCBubblePlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-scroll'] = true;
	}
});










ZC.ZCHBubbleGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbubble';
		self.oSettings['layout'] = 'yx';
		self.oSettings['enable-guide'] = true;
		self.oPlotSet = new ZC.ZCHBubblePlotSet(self);
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				return new ZC.ZCScaleXi(this);
			case 'y':
				return new ZC.ZCScaleYi(this);
		}
	}
});










ZC.ZCPieGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		this._super(oParent);
		this.sType = 'pie';
		this.oPlotSet = new ZC.ZCPiePlotSet(this);
	},
	getScaleKDefaultValue : function() {
		return '';
	},
	createScale : function(sType) {
		switch (sType) {
			case 'm':
				return new ZC.ZCScaleM(this);
			case 'v':
				return new ZC.ZCScaleV(this);
			case 'r':
				return new ZC.ZCScaleRK(this);
		}
	},
	parseScales : function() {
		var self = this;
		var oScaleM = self.createScale('m', 'scale'), oScaleV = self.createScale('v', 'scale-v'), oScaleRK = self.createScale('r', 'scale-r');

		oScaleM.sName = 'scale';
		oScaleM.sId = self.sId + '-scale';
		
		if (self.oData['series'] && self.oData['series'].length && self.oData['series'][0]['values']) {
			oScaleM.sLayout = '1x' + self.oData['series'][0]['values'].length;
		}

		oScaleV.sName = 'scale-v';
		oScaleV.sId = self.sId + '-scale-v';

		oScaleRK.sName = 'scale-r';
		oScaleRK.sId = self.sId + '-scale-r';

		self.aScales.push(
			oScaleM,
			oScaleV,
			oScaleRK
		);

		self._super();
	},
	clear_ : function() {
		var self = this;
		if (ZC._indexof_(['svg','vml'], self.oLoader.sOutput) !== -1) {
			ZC.ZCQuery('#' + self.sId + ' .zc-layer').each(function() {
				if (/\-plot-\d+\-fl\-\d+\-/.test(this.id)) {
					ZC.ZCQuery(this).children().each(function() {
						if (/\-connector\-path/.test(this.id)) {
							ZC.ZCHtmlUtils._remove_(this);
						}
					});
				}
			});
		}
	}
});










ZC.ZCNestedPieGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'nestedpie';
		self.oPlotSet = new ZC.ZCNestedPiePlotSet(self);
	},
	getScaleKDefaultValue : function() {
		return '';
	},
	createScale : function(sType) {
		switch (sType) {
			case 'm':
				return new ZC.ZCScaleM(this);
		}
	},
	parseScales : function() {
		var self = this;
		var oScaleM = self.createScale('m', 'scale');
		oScaleM.sName = 'scale';
		oScaleM.sId = self.sId + '-scale';
		self.aScales.push(oScaleM);
		self._super();
	}
});










ZC.ZCRadarGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'radar';
		self.oPlotSet = new ZC.ZCRadarPlotSet(self);
	},
	getScaleKDefaultValue : function() {
		return '';
	},
	createScale : function(sType) {
		var self = this;
		switch (sType) {
			case 'm':
				return new ZC.ZCScaleM(self);
			case 'k':
				return new ZC.ZCRadarScaleRK(self);
			case 'v':
				return new ZC.ZCRadarScaleRV(self);
		}
	},
	parseScales : function() {
		var self = this;

		var oScaleRK = self.createScale('k', 'scale-k');
		oScaleRK.sName = 'scale-k';
		oScaleRK.sId = self.sId + '-scale-k';
		self.aScales.push(oScaleRK);

		var oScaleRV = self.createScale('v', 'scale-v');
		oScaleRV.sName = 'scale-v';
		oScaleRV.sId = self.sId + '-scale-v';
		self.aScales.push(oScaleRV);

		var oScaleM = self.createScale('m', 'scale');
		oScaleM.sName = 'scale';
		oScaleM.sId = self.sId + '-scale';
		self.aScales.push(oScaleM);

		self._super();
	}
});










ZC.ZCVBulletGraph = ZC.ZCVBarGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vbullet';
		self.oPlotSet = new ZC.ZCVBulletPlotSet(self);
		self.oSettings['enable-animation'] = false;
	}
});










ZC.ZCHBulletGraph = ZC.ZCHBarGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbullet';
		self.oSettings['layout'] = 'yx';
		self.oPlotSet = new ZC.ZCHBulletPlotSet(self);
		self.oSettings['enable-animation'] = false;
	}
});










ZC.ZCPianoGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'piano';
		self.oPlotSet = new ZC.ZCPianoPlotSet(self);
		self.oSettings['enable-animation'] = false;
		
	},
	setupScaleValues : function(sType) {
		var self = this;
		if (sType === 'v') {
			var aValues = [];
			for (var i=0;i<self.oData['series'].length;i++) {
				aValues.push(self.oData['series'][i]['text'] || ('Metric ' + (i+1)));
			}
			return aValues;
		}
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				var oScaleX = new ZC.ZCScaleX(this);
				oScaleX.bRanged = true;
				return oScaleX;
			case 'y':
				var oScaleY = new ZC.ZCScaleY(this);
				oScaleY.bRanged = true;
				return oScaleY;
		}
	}
});










ZC.ZCVFunnelGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vfunnel';
		self.oPlotSet = new ZC.ZCVFunnelPlotSet(self);
		self.oSettings['enable-animation'] = false;
	},
	createScale : function(sType, sName) {
		switch (sType) {
			case 'x':
				var oScaleX = this._super(sType, sName);
				oScaleX.bRanged = true;
				return oScaleX;
			case 'y':
				var oScaleY = this._super(sType, sName);
				oScaleY.bRanged = true;
				return oScaleY;
		}
	},
	setupScaleValues : function(sType) {
		var self = this;
		if (sType === 'v') {
			var aValues = [];
			for (var i=0;i<self.oData['series'].length;i++) {
				aValues.push('Step ' + (i+1));
			}
			return aValues;
		}
	},
	paint : function() {
		var self = this;
		for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
			if (self.aScales[i].sType === 'v') {
				self.aScales[i].bMirrored = !self.aScales[i].bMirrored;
			}
		}
		self._super();
	}
});










ZC.ZCHFunnelGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hfunnel';
		self.oPlotSet = new ZC.ZCHFunnelPlotSet(self);
		self.oSettings['enable-animation'] = false;
	},
	setupScaleValues : function(sType) {
		var self = this;
		if (sType === 'v') {
			var aValues = [];
			for (var i=0;i<self.oData['series'].length;i++) {
				aValues.push('Step ' + (i+1));
			}
			return aValues;
		}
	},
	createScale : function(sType) {
		switch (sType) {
			case 'x':
				var oScaleX = new ZC.ZCScaleXi(this);
				oScaleX.bRanged = true;
				return oScaleX;
			case 'y':
				var oScaleY = new ZC.ZCScaleYi(this);
				oScaleY.bRanged = true;
				return oScaleY;
		}
	}
});










ZC.ZCStockGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'stock';
		self.oPlotSet = new ZC.ZCStockPlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-animation'] = false;
		self.oSettings['enable-scroll'] = true;
	},
	createScale : function(sType, sName) {
		switch (sType) {
			case 'x':
				var oScaleX = this._super(sType, sName);
				oScaleX.bRanged = true;
				return oScaleX;
			case 'y':
				return this._super(sType, sName);
		}
	}
});










ZC.ZCGaugeGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'gauge';
		self.oPlotSet = new ZC.ZCGaugePlotSet(self);
	},
	getScaleKDefaultValue : function() {
		return '';
	},
	createScale : function(sType) {
		var self = this;
		switch (sType) {
			case 'm':
				return new ZC.ZCScaleM(self);
			case 'r':
				return new ZC.ZCGaugeScaleRV(self);
			case 'v':
				return new ZC.ZCScaleV(self);
		}
	},
	parseScales : function() {
		var self = this;

		var oScaleM = self.createScale('m', 'scale');
		oScaleM.sName = 'scale';
		oScaleM.sId = self.sId + '-scale';
		self.aScales.push(oScaleM);
		
		for (i=2;i<10;i++) {
			if (ZC._n_(self.oData['scale-' + i]) !== null) {
				var oScaleMn = self.createScale('m', 'scale-' + i);
				oScaleMn.iIndex = i;
				oScaleMn.sName = 'scale-' + i;
				oScaleMn.sId = self.sId + '-scale-' + i;
				self.aScales.push(oScaleMn);
			}
		}

		var oScaleRV = self.createScale('r', 'scale-r');
		oScaleRV.sName = 'scale-r';
		oScaleRV.sId = self.sId + '-scale-r';
		self.aScales.push(oScaleRV);

		for (i=2;i<10;i++) {
			if (ZC._n_(self.oData['scale-r-' + i]) !== null) {
				var oScaleRVn = self.createScale('r', 'scale-r-' + i);
				oScaleRVn.iIndex = i;
				oScaleRVn.sName = 'scale-r-' + i;
				oScaleRVn.sId = self.sId + '-scale-r-' + i;
				self.aScales.push(oScaleRVn);
			}
		}

		

		

		self._super();
	},
	hideLayer_ : function() {
		var self = this;
		ZC.ZCQuery('#' + self.sId + '-plots-bl-2').children().each(function() {
			ZC.ZCHtmlUtils._clear_(this, self.oLoader.sOutput, self.iX, self.iY, self.iWidth, self.iHeight, self.sId);
		});
	}
});










ZC.ZCRangeGraph = ZC.ZCXYGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'range';
		self.oPlotSet = new ZC.ZCRangePlotSet(self);
		self.oSettings['enable-guide'] = true;
		self.oSettings['enable-animation'] = false;
		self.oSettings['enable-scroll'] = true;
	}
});










ZC.ZCPie3DGraph = ZC.ZCPieGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'pie3d';
		self.oPlotSet = new ZC.ZCPie3DPlotSet(self);
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['enable-animation'] = false;
		self.oSettings['x-angle-min'] = 15;
		self.oSettings['x-angle-max'] = 75;
		self.oSettings['y-angle-min'] = 0;
		self.oSettings['y-angle-max'] = 0;
		self.oSettings['z-angle-min'] = 0;
		self.oSettings['z-angle-max'] = 0;
	},
	clear : function() {
		var self = this;
		self._super();
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.paint3D();
		self.flatten();
		self.oEngine3D.clear();
		self.parseObjects();
		self.paintObjects();
		self.paint3D();
		self.paintLegend();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
	}
});










ZC.ZCHBar3DGraph = ZC.ZCHBarGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbar3d';
		self.oPlotSet = new ZC.ZCHBar3DPlotSet(self);
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['enable-preview'] = false;
		self.oSettings['enable-animation'] = false;
		self.oSettings['x-angle-min'] = -20;
		self.oSettings['x-angle-max'] = 20;
		self.oSettings['y-angle-min'] = -20;
		self.oSettings['y-angle-max'] = 0;
	},
	clear : function() {
		var self = this;
		self._super();
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.paint3D();
		self.flatten();
		self.oEngine3D.clear();
		self.parseObjects();
		self.paintObjects();
		self.paint3D();
		self.paintLegend();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
	}
});










ZC.ZCVBar3DGraph = ZC.ZCVBarGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vbar3d';
		self.oPlotSet = new ZC.ZCVBar3DPlotSet(self);
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-animation'] = false;
		self.oSettings['enable-scroll'] = false;
	},
	clear : function(bSoftClear, bSmartPlots) {
		var self = this;
		self._super(bSoftClear, bSmartPlots);
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.paint3D();
		self.flatten();
		self.oEngine3D.clear();
		self.parseObjects();
		self.paintObjects();
		self.paint3D();
		self.paintLegend();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
	}
});










ZC.ZCLine3DGraph = ZC.ZCLineGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'line3d';
		self.oPlotSet = new ZC.ZCLine3DPlotSet(self);
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-animation'] = false;
		self.oSettings['enable-scroll'] = false;
	},
	clear : function(bSoftClear, bSmartPlots) {
		var self = this;
		self._super(bSoftClear, bSmartPlots);
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.paint3D();
		self.flatten();
		self.oEngine3D.clear();
		self.parseObjects();
		self.paintObjects();
		self.paint3D();
		self.paintLegend();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
	}
});










ZC.ZCArea3DGraph = ZC.ZCAreaGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'area3d';
		self.oPlotSet = new ZC.ZCArea3DPlotSet(self);
		self.oEngine3D = new ZC.ZCEngine3D();
		self.oSettings['3d'] = true;
		self.oSettings['enable-preview'] = true;
		self.oSettings['enable-animation'] = false;
		self.oSettings['enable-scroll'] = false;
	},
	clear : function(bSoftClear, bSmartPlots) {
		var self = this;
		self._super(bSoftClear, bSmartPlots);
		self.oEngine3D.clear();
	},
	paint : function() {
		var self = this;
		self._super();
		self.paint3D();
		self.flatten();
		self.oEngine3D.clear();
		self.parseObjects();
		self.paintObjects();
		self.paint3D();
		self.paintLegend();
		if (ZC._indexof_(self.oLoader.aFlags, 'skip_interactivity') === -1) {
			self.bindObjects();
		}
	}
});










ZC.ZCVennGraph = ZC.ZCGraph.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'venn';
		self.oPlotSet = new ZC.ZCVennPlotSet(self);
	},
	getScaleKDefaultValue : function() {
		return '';
	},
	createScale : function(sType) {
		var self = this;
		switch (sType) {
			case 'm':
				return new ZC.ZCScaleM(self);
		}
	},
	parseScales : function() {
		var self = this;

		var oScaleM = self.createScale('m', 'scale');
		oScaleM.sName = 'scale';
		oScaleM.sId = self.sId + '-scale';
		self.aScales.push(oScaleM);

		self._super();
	}
});











ZC.ZCPlotSet = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oGraph = oParent;
		self.oLoader = self.oGraph.oParent;
		self.aPlots = [];
		self.aAreas = null;
		self.aPlotGroups = [];
		self.aBarGroups = [];
		self.bIgnoreLocate = true;
		self.oPlotSetInfo = null;
		self.bForceEnd = true;
	},
	createPlot : function() {
		return new ZC.ZCPlot(this);
	},
	parse : function() {
		var self = this, mValue, i, iLen;
		self.sId = self.oParent.sId + '-plotset';

		self.oPlotSetInfo = null;

		
		for (i=self.oData.length-1;i>=0;i--) {
			if (typeof(self.oData[i]) === 'undefined') {
				self.oData.splice(i, 1);
			}
		}

		if (self.oData.length > 1) {

			
			for (i=0,iLen=self.oData.length;i<iLen;i++) {
				if (typeof(self.oData[i]['palette']) === 'undefined') {
					self.oData[i]['palette'] = i;
				}
			}

			var bSorted = false;
			while (!bSorted) {
				bSorted = true;
				for (i=0,iLen=self.oData.length;i<iLen-1;i++) {
					var iZIndex1 = self.oData[i]['z-index'] || 0;
					var iZIndex2 = self.oData[i+1]['z-index'] || 0;
					if (iZIndex1 > iZIndex2) {
						var oTmp = self.oData[i];
						self.oData[i] = self.oData[i+1];
						self.oData[i+1] = oTmp;
						bSorted = false;
					}
				}
			}
		}

		self.aPlots = [];
		for (i=0,iLen=self.oData.length;i<iLen;i++) {
			var sPlotType = '';
			if (ZC._n_(mValue=self.oData[i]['type']) !== null) {
				sPlotType = mValue;
			}
			var oPlot = self.createPlot(sPlotType, i);
			oPlot.sTag = oPlot.sType + 'plot';
			oPlot.iIndex = i;
			oPlot.iZIndex = i;
			self.oGraph.oParent.oDefaults.load(oPlot.oData, [
				'(' + oPlot.sType + ').plot'
			]);
			if (oPlot.sTypeX) {
				self.oGraph.oParent.oDefaults.load(oPlot.oData, [
					'(' + oPlot.sTypeX + ').plot'
				]);
			}
			self.oGraph.oParent.oDefaults.load(oPlot.oData, [
				'(' + oPlot.sType + ').plot.animation'
			]);
			if (ZC._n_(mValue=self.oParent.oData['plot']) !== null) {
				oPlot.append(mValue);
			}
			oPlot.append(self.oData[i]);
			oPlot.bStacked = self.oParent.bStacked;
			oPlot.parse();
			self.aPlots.push(oPlot);
		}

		var oBarGroups = {};
		var aPlotGroups = [];
		var aPlotGroups_ = [];
		var aBarGroups = {};
		var aBarGroups_ = {};
		var iBarIndex = 0;
		var iStackIndex = 0;
		for (i=0,iLen=self.aPlots.length;i<iLen;i++) {
			if (self.oGraph.oAttributes['plot'+i+'.visible'] || self.oGraph.getToggleAction() === 'hide') {
				if (self.aPlots[i].bStacked) {
					iStackIndex = ZC._indexof_(aPlotGroups_, self.aPlots[i].iStack);
					if (iStackIndex === -1) {
						aPlotGroups_.push(self.aPlots[i].iStack);
						iStackIndex = aPlotGroups_.length-1;
					}
					if (ZC._n_(aPlotGroups[iStackIndex]) === null) {
						aPlotGroups[iStackIndex] = [i];
					} else {
						aPlotGroups[iStackIndex].push(i);
					}
				} else {
					aPlotGroups_.push(-1);
					iStackIndex = aPlotGroups_.length-1;
					if (ZC._n_(aPlotGroups[iStackIndex]) === null) {
						aPlotGroups[iStackIndex] = [i];
					} else {
						aPlotGroups[iStackIndex].push(i);
					}
				}
				var sPType = self.aPlots[i].sType;
				
				if (self.aPlots[i].oData['type'] && sPType !== self.aPlots[i].oData['type']) {
					var p1 = sPType.indexOf('3d'), p2 = self.aPlots[i].oData['type'].indexOf('3d');
					if ((p1 === -1 && p2 !== -1) || (p1 === -1 && p2 === -1)) {
						sPType = self.aPlots[i].oData['type'];
					}
				}
				
				if (ZC._indexof_(['bar','bar3d','bullet'], sPType) !== -1) {
					sPType = 'v' + sPType;
				}
				if (ZC._indexof_(['vbar', 'hbar', 'vbullet', 'hbullet', 'stock', 'vbar3d', 'hbar3d'], sPType) !== -1 && !self.aPlots[i].bIgnore) {
					if (ZC._n_(aBarGroups[sPType]) === null) {
						aBarGroups[sPType] = [];
					}
					if (ZC._n_(aBarGroups_[sPType]) === null) {
						aBarGroups_[sPType] = [];
					}
					if (self.aPlots[i].bStacked) {
						if (ZC._n_(oBarGroups[self.aPlots[i].iStack]) === null) {
							oBarGroups[self.aPlots[i].iStack] = 1;
						} else {
							oBarGroups[self.aPlots[i].iStack]++;
						}
						iBarIndex = ZC._indexof_(aBarGroups_[sPType], self.aPlots[i].iStack);
						if (iBarIndex === -1) {
							aBarGroups_[sPType].push(self.aPlots[i].iStack);
							iBarIndex = aBarGroups_[sPType].length-1;
						}
						if (ZC._n_(aBarGroups[sPType][iBarIndex]) === null) {
							aBarGroups[sPType][iBarIndex] = [i];
						} else {
							aBarGroups[sPType][iBarIndex].push(i);
						}
					} else {
						aBarGroups_[sPType].push(-1);
						iBarIndex = aBarGroups_[sPType].length-1;
						if (ZC._n_(aBarGroups[sPType][iBarIndex]) === null) {
							aBarGroups[sPType][iBarIndex] = [i];
						} else {
							aBarGroups[sPType][iBarIndex].push(i);
						}
					}
				}
			}
		}
		self.aPlotGroups = aPlotGroups;
		self.aBarGroups = aBarGroups;

		if (self.aKeys) {
			self.aKeys.sort();
		}
	},
	paint : function() {
		var self = this;
		self.aAreas = [];

		function _plot_(i) {
			if (self.aPlots[i].oJsRule) {
				self.oLoader.bCache = false;
			}
			self.bForceEnd = true;

			var sToggleAction = self.oGraph.getToggleAction();

			if (self.oGraph.oSettings['3d']) {
				if (self.oGraph.oAttributes['plot'+i+'.visible']) {
					self.aPlots[i].paint();
					self.oLoader.flushCache();
				}
			} else {
				if (self.oGraph.oAttributes['plot'+i+'.visible'] || sToggleAction === 'hide') {
					self.aPlots[i].paint();
					self.oLoader.flushCache();
					if (!self.oGraph.oAttributes['plot'+i+'.visible'] && sToggleAction === 'hide') {
						self.oGraph.oAttributes['plot'+i+'.visible'] = true;
						self.oParent._api_plot_toggle_({plotindex : i, 'ignore-legend' : true});
					}
				}
			}

			self.oGraph.oAttributes['plot-' + i + '-first-run'] = false;

			if (i < self.aPlots.length-1) {
				if (self.oGraph.bAsync) {
					window.setTimeout(function() {
						_plot_(i+1);
					}, 10);
				} else {
					_plot_(i+1);
				}
			} else {
				if (!self.oGraph.bAsync || (self.oGraph.bAsync && self.bForceEnd)) {
					self._end_();
				}
			}
		}

		if (self.aPlots.length > 0) {
			_plot_(0);
		} else {
			self._end_();
		}
	},
	_end_ : function() {

		var self = this, mValue, k, oRegExp;

		self.oLastContour = null;
		self.oCurrentContour = null;

		
		
		var aSortable = ['bubble', 'hbubble', 'vbullet', 'hbullet', 'radar', 'vbar3d', 'hbar3d', 'mixed3d', 'pie3d'];
		
		if (self.oGraph.sType === 'mixed') {
			var bBars = false, bNonBars = false;
			for (var i=0;i<self.aPlots.length;i++) {
				if (self.aPlots[i].sType === 'vbar') {
					bBars = true;
				} else {
					bNonBars = true;
				}
			}
			if (bBars && bNonBars) {
				aSortable.push('mixed');
			}
		}

		function _z_(sAreaDef) {
			var plot = 0;
			var p1 = sAreaDef.indexOf('-plotset-plot-'), p2 = sAreaDef.indexOf('-node-', p1);
			if (p1 !== -1 && p2 !== -1) {
				plot = sAreaDef.substr(p1 + 14, p2 - p1 - 14);
			}
			if (typeof(self.aPlots[plot].oAttributes['z-mid']) !== 'undefined') {
				return self.aPlots[plot].oAttributes['z-mid'];
			} else {
				return plot;
			}
		}

		
		
		

		if ((mValue=ZC._id_(self.oGraph.oParent.sId + '-map')) && !self.oLoader.bImgGen) {
			if (ZC._indexof_(aSortable, self.oGraph.sType) !== -1 || zingchart.SORTTRACKERS === 1) {
				self.aAreas.sort(function(a, b) {
					if (self.oGraph.sType == 'pie3d') {
						if (ZC.ZCUtils._area_score_(a) > ZC.ZCUtils._area_score_(b)) {
							return 1;
						} else if (ZC.ZCUtils._area_score_(a) < ZC.ZCUtils._area_score_(b)) {
							return -1;
						} else {
							return 0;
						}
					} else {
						if (_z_(a) > _z_(b) && self.oParent.oSettings['3d']) {
							return 1;
						} else if (_z_(a) < _z_(b) && self.oParent.oSettings['3d']) {
							return -1;
						} else {
							if (ZC.ZCUtils._area_score_(a) > ZC.ZCUtils._area_score_(b)) {
								return 1;
							} else if (ZC.ZCUtils._area_score_(a) < ZC.ZCUtils._area_score_(b)) {
								return -1;
							} else {
								return 0;
							}
						}
					}
				});
			}
			if (zingchart.DEV.DELAYEDTRACKERS) {
				window.setTimeout(function() {
					mValue.innerHTML += self.aAreas.join('');
				}, 500);
			} else {
				mValue.innerHTML += self.aAreas.join('');
			}
		}
		self.aLastContour = null;
		self.aPointsContour = null;
		self.oGraph.aVBPositions = [];

		self.oParent._end_();
	}
});









ZC.ZCLinePlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCLinePlot(this);
	}
});









ZC.ZCAreaPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCAreaPlot(this);
	}
});









ZC.ZCVLinePlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		var oLinePlot = new ZC.ZCLinePlot(this);
		oLinePlot.bInverted = true;
		return oLinePlot;
	}
});









ZC.ZCVAreaPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		var oAreaPlot = new ZC.ZCAreaPlot(this);
		oAreaPlot.bInverted = true;
		return oAreaPlot;
	}
});









ZC.ZCVBarPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCVBarPlot(this);
	}
});









ZC.ZCHBarPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCHBarPlot(this);
	}
});









ZC.ZCMixedPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function(sType) {
		var self = this;
		switch (sType) {
			
			default:
				return new ZC.ZCLinePlot(self);
			case 'vline':
				var oLinePlot = new ZC.ZCLinePlot(self);
				oLinePlot.bInverted = true;
				return oLinePlot;
			case 'poly':
				var oPolyPlot = new ZC.ZCScatterPlot(self);
				oPolyPlot.bPoly = true;
				oPolyPlot.sTypeX = 'poly';
				return oPolyPlot;
			case 'area':
				return new ZC.ZCAreaPlot(self);
			case 'varea':
				var oAreaPlot = new ZC.ZCAreaPlot(self);
				oAreaPlot.bInverted = true;
				return oAreaPlot;
			case 'bar':
			case 'vbar':
				return new ZC.ZCVBarPlot(self);
			case 'hbar':
				return new ZC.ZCHBarPlot(self);
			case 'scatter':
				return new ZC.ZCScatterPlot(self);
			case 'hscatter':
				return new ZC.ZCScatterPlot(self, 'hscatter');
			case 'bubble':
				return new ZC.ZCBubblePlot(self);
			case 'hbubble':
				return new ZC.ZCBubblePlot(self, 'hbubble');
			case 'stock':
				return new ZC.ZCStockPlot(self);
			case 'range':
				return new ZC.ZCRangePlot(self);
			case 'line3d':
				return new ZC.ZCLine3DPlot(self);
			case 'area3d':
				return new ZC.ZCArea3DPlot(self);
			case 'bar3d':
			case 'vbar3d':
				return new ZC.ZCVBar3DPlot(self);
			case 'bullet':
			case 'vbullet':
				return new ZC.ZCVBulletPlot(self);
		}
	}
});









ZC.ZCScatterPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCScatterPlot(this);
	}
});

ZC.ZCPolyPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		var oPlot = new ZC.ZCScatterPlot(this);
		oPlot.bPoly = true;
		oPlot.sTypeX = 'poly';
		return oPlot;
	}
});









ZC.ZCHScatterPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCScatterPlot(this, 'hscatter');
	}
});









ZC.ZCBubblePlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCBubblePlot(this);
	}
});









ZC.ZCHBubblePlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCBubblePlot(this, 'hbubble');
	}
});










ZC.ZCPiePlotSet = ZC.ZCPlotSet.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.aTotals = [];
		self.aLastAngles = [];
		self.aLocations = [];
	},
	createPlot : function() {
		return new ZC.ZCPiePlot(this);
	},
	parseLayout : function(bForce) {
		var self = this, p, pLen, iPieAngleEnd;
		if (bForce) {
			self.aLocations = [];
			self.aLastAngles = [];
		}
		var oScaleR = self.oParent.getScaleByName('scale-r');
		var oScaleM = self.oParent.getScaleByName('scale');
		
		var fSF = 0.9, iR, fFactor = 1;

		if (self.aPlots.length >= 10) {
			fFactor = 1.0;
		}
		if (self.aPlots.length >= 20) {
			fFactor = 1.25;
		}
		if (self.aPlots.length >= 30) {
			fFactor = 1.5;
		}

		
		var iRefAngle = oScaleR.iRefAngle;
		for (p=0,pLen=self.aPlots.length;p<pLen;p++) {
			if (ZC._n_(self.aPlots[p].oData['ref-angle']) !== null) {
				iRefAngle = self.aPlots[p].iRefAngle;
			}
		}

		for (p=0,pLen=self.aPlots.length;p<pLen;p++) {
			if (self.oGraph.oAttributes['plot'+p+'.visible'] || self.oGraph.getToggleAction() === 'hide') {
				for (var n=0,nLen=self.aPlots[p].aPlotNodes.length;n<nLen;n++) {
					if (self.aPlots[p].aPlotNodes[n]) {
						self.oAngles['n'+n] = self.oAngles['n'+n] || [];
						var oPlotNode = self.aPlots[p].aPlotNodes[n];
						if (ZC._n_(self.aLastAngles[n]) === null) {
							self.aLastAngles[n] = iRefAngle;
						}

						var iPieAngleStart = self.aLastAngles[n];
						if (self.aTotals[n] === 0) {
							iPieAngleEnd = iPieAngleStart + oScaleR.iAperture*(1/pLen);
						} else {
							iPieAngleEnd = iPieAngleStart + oScaleR.iAperture*oPlotNode.fValue/self.aTotals[n];
						}
						self.aLastAngles[n] = iPieAngleEnd;
						oPlotNode.iPieAngleStart = iPieAngleStart;
						oPlotNode.iPieAngleEnd = iPieAngleEnd;

						var oValueBox = oPlotNode.paintValueBox(true);
						if (oValueBox.oData['placement'] === 'out' && oValueBox.bVisible) {
							var iAngleM = ZC._i_((iPieAngleStart+iPieAngleEnd)/2);
							self.oAngles['n'+n][p] = iAngleM - iRefAngle;
							iR = ZC._min_(oScaleM.iWidth/2 - fFactor*oValueBox.iWidth - oValueBox.iOffsetR - 35, oScaleM.iHeight/2 - fFactor*oValueBox.iHeight - oValueBox.iOffsetR - 15);
							fSF = ZC._min_(fSF, 2*iR/ZC._min_(oScaleM.iWidth, oScaleM.iHeight));
						}
					}
				}
			}
		}

		if (self.oParent.sType === 'pie3d') {
			fSF *= 0.75;
		}

		
		fSF = ZC._max_(0.1, ZC._min_(0.9, fSF));
		if (oScaleM.oData['size-factor'] === 'auto') {
			
			oScaleM.fSizeFactor = fSF;
		}

		if (bForce) {
			for (var sKey in self.oAngles) {
				
				self.oAngles[sKey] = ZC.ZCMath._distribute_(self.oAngles[sKey], iRefAngle);
				
			}
		}
	},
	parse : function() {
		var self = this;
		if (self.oParent.oData['plot'] && self.oParent.oData['plot']['layout'] === 'auto') {
			if (ZC._n_(self.oParent.oData['plot']['ref-angle']) === null) {
				self.oParent.oData['plot']['ref-angle'] = -90;
			}
			self.oData.sort(function(a, b) {
				return b['values'][0] - a['values'][0];
			});
		}
		self.aLocations = [];
		self.aTotals = [];
		self.aLastAngles = [];
		self.oAngles = {};
		self._super();
		self.parseLayout();
	}
});









ZC.ZCNestedPiePlotSet = ZC.ZCPlotSet.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.aTotals = [];
		self.aLastAngles = [];
	},
	createPlot : function() {
		return new ZC.ZCNestedPiePlot(this);
	},
	parse : function() {
		var self = this;
		self.aTotals = [];
		self.aLastAngles = [];
		self._super();

		
		var oScaleM = self.oParent.getScaleByName('scale');
		var iCX = oScaleM.iX + oScaleM.iWidth/2;
		
		var fSF = 1, iR, iX;

		for (var p=0,pLen=self.aPlots.length;p<pLen;p++) {
			if (self.oGraph.oAttributes['plot'+p+'.visible'] || self.oGraph.getToggleAction() === 'hide') {
				for (var n=0,nLen=self.aPlots[p].aPlotNodes.length;n<nLen;n++) {
					if (self.aPlots[p].aPlotNodes[n]) {
						var oPlotNode = self.aPlots[p].aPlotNodes[n];
						if (ZC._n_(self.aLastAngles[n]) === null) {
							self.aLastAngles[n] = self.aPlots[p].iRefAngle;
						}
						var iPieAngleStart = self.aLastAngles[n];
						var iPieAngleEnd = iPieAngleStart + 360*oPlotNode.fValue/self.aTotals[n];
						self.aLastAngles[n] = iPieAngleEnd;
						oPlotNode.iPieAngleStart = iPieAngleStart;
						oPlotNode.iPieAngleEnd = iPieAngleEnd;
						
						var oValueBox = oPlotNode.paintValueBox(true);

						if (oValueBox.oData['placement'] !== 'in') {
							var iAngleM = ZC._i_((iPieAngleStart+iPieAngleEnd)/2);
							if ((iAngleM >=0 && iAngleM <= 90) || (iAngleM >= 270 && iAngleM <= 360)) {
								iX = oScaleM.iX + oScaleM.iWidth - (oValueBox.iWidth + 25);
							} else {
								iX = oScaleM.iX + (oValueBox.iWidth + 25);
							}
							iR = (iX - iCX)/ZC._cos_(iAngleM);
							fSF = ZC._min_(fSF, 2*iR/oScaleM.iWidth);
							iR = oScaleM.iHeight/2 - (oValueBox.iHeight/2 + 10);
							fSF = ZC._min_(fSF, 2*iR/oScaleM.iHeight);
						}
						
					}
				}
			}
		}

		
		fSF = ZC._max_(0.15, ZC._min_(0.85, fSF));
		if (oScaleM.oData['size-factor'] === 'auto') {
			oScaleM.oData['size-factor'] = oScaleM.fSizeFactor = fSF;
		}

	}
});









ZC.ZCRadarPlotSet = ZC.ZCPlotSet.extend({
	oStackedR : {},
	createPlot : function() {
		return new ZC.ZCRadarPlot(this);
	},
	paint : function() {
		var self = this;
		self.oStackedR = {};
		self._super();
	}
});









ZC.ZCVBulletPlotSet = ZC.ZCVBarPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCVBulletPlot(this);
	}
});









ZC.ZCHBulletPlotSet = ZC.ZCHBarPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCHBulletPlot(this);
	}
});









ZC.ZCPianoPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCPianoPlot(this);
	}
});









ZC.ZCFunnelPlotSet = ZC.ZCPlotSet.extend({
	parse : function() {
		var self = this, p, pLen, n, nLen, oPlotNode;
		self.fMin = ZC.MAX;
		self.fMax = -ZC.MAX;
		self.aMax = [];
		self.aMin = [];
		self._super();
		for (p=0,pLen=self.aPlots.length;p<pLen;p++) {
			for (n=0,nLen=self.aPlots[p].aPlotNodes.length;n<nLen;n++) {
				if (self.aPlots[p].aPlotNodes[n]) {
					oPlotNode = self.aPlots[p].aPlotNodes[n];
					if (ZC._n_(self.aMin[n]) === null) {
						self.aMin[n] = ZC.MAX;
					}
					if (ZC._n_(self.aMax[n]) === null) {
						self.aMax[n] = -ZC.MAX;
					}
					self.aMin[n] = ZC._min_(self.aMin[n], oPlotNode.fValue);
					self.aMax[n] = ZC._max_(self.aMax[n], oPlotNode.fValue);
				}
			}
		}

		for (p=0,pLen=self.aPlots.length;p<pLen;p++) {
			for (n=0,nLen=self.aPlots[p].aPlotNodes.length;n<nLen;n++) {
				if (self.aPlots[p].aPlotNodes[n]) {
					oPlotNode = self.aPlots[p].aPlotNodes[n];
					self.fMin = ZC._min_(self.fMin, oPlotNode.fValue);
					self.fMax = ZC._max_(self.fMax, oPlotNode.fValue);
				}
			}
		}
	}
});









ZC.ZCVFunnelPlotSet = ZC.ZCFunnelPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCVFunnelPlot(this);
	}
});









ZC.ZCHFunnelPlotSet = ZC.ZCFunnelPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCHFunnelPlot(this);
	}
});









ZC.ZCStockPlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCStockPlot(this);
	}
});









ZC.ZCGaugePlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCGaugePlot(this);
	}
});









ZC.ZCRangePlotSet = ZC.ZCPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCRangePlot(this);
	}
});









ZC.ZCPie3DPlotSet = ZC.ZCPiePlotSet.extend({
	createPlot : function() {
		return new ZC.ZCPie3DPlot(this);
	}
});









ZC.ZCVBar3DPlotSet = ZC.ZCVBarPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCVBar3DPlot(this);
	}
});









ZC.ZCHBar3DPlotSet = ZC.ZCHBarPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCHBar3DPlot(this);
	}
});









ZC.ZCLine3DPlotSet = ZC.ZCLinePlotSet.extend({
	createPlot : function() {
		return new ZC.ZCLine3DPlot(this);
	}
});









ZC.ZCArea3DPlotSet = ZC.ZCAreaPlotSet.extend({
	createPlot : function() {
		return new ZC.ZCArea3DPlot(this);
	}
});










ZC.ZCVennPlotSet = ZC.ZCPlotSet.extend({
	aInfo : [],
	aIPoints : [],
	aIArea : [],
	createPlot : function() {
		return new ZC.ZCVennPlot(this);
	},
	paint : function() {
		var self = this, i, iLen, j, jLen, oFormat, iAngle, dx, dy, k;
		var oScale = self.oParent.getScaleByName('scale');
		var iPlotSize = ZC._min_(oScale.iVStepSize, oScale.iHStepSize);
		var aPlotNodes;
		var iMaxArea = -ZC.MAX;
		for (i=0,iLen=self.aPlots.length;i<iLen;i++) {
			aPlotNodes = self.aPlots[i].aPlotNodes;
			oFormat = ZC.ZCUtils._setup_format_(self.aPlots[i].oData['value-box'], self.aPlots[i].oData);
			for (j=0,jLen=aPlotNodes.length;j<jLen;j++) {
				aPlotNodes[j].setup();
				iMaxArea = ZC._max_(iMaxArea, aPlotNodes[j].fValue);
				aPlotNodes[j].fJoinValue = ZC.ZCUtils._format_(self.aPlots[i].aJoin[j], oFormat);
			}
		}
		var iMaxRadius = Math.sqrt(iMaxArea/Math.PI);
		var fShrinkFactor = iPlotSize/(4*iMaxRadius);

		function _segment_(x1y1, x2y2) {
			var dx = ZC._a_(x1y1[0] - x2y2[0]), dy = ZC._a_(x1y1[1] - x2y2[1]);
			return Math.sqrt(dx*dx+dy*dy);
		}

		var d = [];
		var x = [];
		var y = [];
		var aNextPlotNodes = [];
		var fAreaRatio = null;
		for (i=0,iLen=self.aPlots.length;i<iLen;i++) {
			if (!d[i]) {
				d[i] = [];
			}
			if (!x[i]) {
				x[i] = [];
				y[i] = [];
			}
			if (!self.aInfo[i]) {
				self.aInfo[i] = [];
			}
			aPlotNodes = self.aPlots[i].aPlotNodes;
			if (self.aPlots[i+1]) {
				aNextPlotNodes = self.aPlots[i+1].aPlotNodes;
			} else {
				aNextPlotNodes = self.aPlots[0].aPlotNodes;
			}
			for (j=0,jLen=aPlotNodes.length;j<jLen;j++) {
				if (!self.aIPoints[j]) {
					self.aIPoints[j] = [];
				}
				if (!self.aIArea[j]) {
					self.aIArea[j] = {};
				}
				aPlotNodes[j].fNextValue = aNextPlotNodes[j].fValue;
				if (i === 0) {
					d[i][j] = fShrinkFactor*ZC.ZCMath._distance_(aPlotNodes[j].fValue, aPlotNodes[j].fNextValue, aPlotNodes[j].fJoinValue);
					x[i][j] = aPlotNodes[j].iX - fShrinkFactor*(ZC._max_(Math.sqrt(aPlotNodes[j].fValue/Math.PI), Math.sqrt(aPlotNodes[j].fNextValue/Math.PI)))/2;
					y[i][j] = aPlotNodes[j].iY + aPlotNodes[j].iHeight/4;
				} else if (i === 1) {
					d[i][j] = fShrinkFactor*ZC.ZCMath._distance_(aPlotNodes[j].fValue, aPlotNodes[j].fNextValue, aPlotNodes[j].fJoinValue);
					x[i][j] = x[0][j] + d[0][j];
					y[i][j] = y[0][j];
				} else if (i === 2) {
					d[i][j] = fShrinkFactor*ZC.ZCMath._distance_(aPlotNodes[j].fValue, aPlotNodes[j].fNextValue, aPlotNodes[j].fJoinValue);
					dx = (d[0][j]*d[0][j]-d[1][j]*d[1][j]+d[2][j]*d[2][j])/(2*d[0][j]);
					x[i][j] = x[0][j] + dx;
					dy = Math.sqrt(d[2][j]*d[2][j]-dx*dx);
					y[i][j] = y[0][j] - dy;
				}

				aPlotNodes[j].iX = x[i][j];
				aPlotNodes[j].iY = y[i][j];
				aPlotNodes[j].iWidth = fShrinkFactor*Math.sqrt(aPlotNodes[j].fValue/Math.PI);
				aPlotNodes[j].iHeight = fShrinkFactor*Math.sqrt(aPlotNodes[j].fValue/Math.PI);
				aPlotNodes[j].iSize = fShrinkFactor*Math.sqrt(aPlotNodes[j].fValue/Math.PI);

				if (ZC._n_(fAreaRatio) === null) {
					fAreaRatio = aPlotNodes[j].fValue/(Math.PI * aPlotNodes[j].iSize * aPlotNodes[j].iSize);
				}

				var r1 = fShrinkFactor*Math.sqrt(aPlotNodes[j].fValue/Math.PI);
				var r2 = fShrinkFactor*Math.sqrt(aPlotNodes[j].fNextValue/Math.PI);
				var a = r1 + r2 - d[i][j];
				var dx2 = (2*a*r2 - a*a)/(2*(r1+r2-a));
				var dx1 = a - dx2;

				self.aInfo[i][j] = {x : x[i][j], y : y[i][j], sz : aPlotNodes[j].iSize, r1 : r1, r2 : r2, dx1 : dx1, dx2 : dx2};

				if (i === 0) {
					dy = Math.sqrt(r1*r1 - (r1-dx2)*(r1-dx2));
					self.aIPoints[j].push([x[0][j] + r1 - dx2, y[0][j] - dy]);
				} else if (i === 2) {
					r1 = self.aInfo[1][j].r1;
					r2 = self.aInfo[1][j].r2;
					dx1 = self.aInfo[1][j].dx1;
					dx2 = self.aInfo[1][j].dx2;
					iAngle = ZC._deg_(Math.asin((y[1][j] - y[2][j])/d[1][j])) - ZC._deg_(Math.acos((r1-dx2)/r1));
					self.aIPoints[j].push([x[1][j] - r1*ZC._cos_(iAngle), y[1][j] - r1*ZC._sin_(iAngle)]);

					r1 = self.aInfo[2][j].r1;
					r2 = self.aInfo[2][j].r2;
					dx1 = self.aInfo[2][j].dx1;
					dx2 = self.aInfo[2][j].dx2;
					iAngle = ZC._deg_(Math.asin((y[0][j] - y[2][j])/d[2][j])) - ZC._deg_(Math.acos((r2-dx1)/r2));
					self.aIPoints[j].push([x[0][j] + r2*ZC._cos_(iAngle), y[0][j] - r2*ZC._sin_(iAngle)]);

				}
				if (i === self.aPlots.length-1) {
					if (self.aPlots.length === 3) {

						if (ZC._n_(self.aPlots[0].aShare[j]) !== null) {
							self.aIArea[j].area = self.aPlots[0].aShare[j];
						} else {
							
							var c = [-1], r = [-1];
							c[1] = _segment_(self.aIPoints[j][0], self.aIPoints[j][2]);
							c[2] = _segment_(self.aIPoints[j][0], self.aIPoints[j][1]);
							c[3] = _segment_(self.aIPoints[j][2], self.aIPoints[j][1]);

							r[1] = self.aInfo[0][j].sz;
							r[2] = self.aInfo[1][j].sz;
							r[3] = self.aInfo[2][j].sz;

							var iArea = 0.25*Math.sqrt( (c[1]+c[2]+c[3]) * (c[1]+c[2]-c[3]) * (c[1]+c[3]-c[2]) * (c[2]+c[3]-c[1]) );
							for (k=1;k<=3;k++) {
								iArea += r[k] * r[k] * Math.asin(c[k]/(2*r[k])) - (c[k]/4) * Math.sqrt(4*r[k]*r[k] - c[k]*c[k]);
							}
							self.aIArea[j].area = fAreaRatio*iArea;
						}

						
						self.aInfo[0][j].intxy = ZC.ZCMath._lpoint_(self.aInfo[0][j].x, self.aInfo[0][j].y, self.aInfo[1][j].x, self.aInfo[1][j].y, self.aInfo[0][j].r1 - (self.aInfo[0][j].dx1+self.aInfo[0][j].dx2)/2);
						self.aInfo[1][j].intxy = ZC.ZCMath._lpoint_(self.aInfo[1][j].x, self.aInfo[1][j].y, self.aInfo[2][j].x, self.aInfo[2][j].y, -(self.aInfo[1][j].r1 - (self.aInfo[1][j].dx1+self.aInfo[1][j].dx2)/2));
						self.aInfo[2][j].intxy = ZC.ZCMath._lpoint_(self.aInfo[2][j].x, self.aInfo[2][j].y, self.aInfo[0][j].x, self.aInfo[0][j].y, -(self.aInfo[2][j].r1 - (self.aInfo[2][j].dx1+self.aInfo[2][j].dx2)/2));
						
						self.aIArea[j].xy = [
							(self.aInfo[0][j].intxy[0] + self.aInfo[1][j].intxy[0] + self.aInfo[2][j].intxy[0])/3,
							(self.aInfo[0][j].intxy[1] + self.aInfo[1][j].intxy[1] + self.aInfo[2][j].intxy[1])/3
						];
					} else {
						self.aInfo[0][j].intxy = ZC.ZCMath._lpoint_(self.aInfo[0][j].x, self.aInfo[0][j].y, self.aInfo[1][j].x, self.aInfo[1][j].y, self.aInfo[0][j].r1 - (self.aInfo[0][j].dx1+self.aInfo[0][j].dx2)/2);
						self.aInfo[1][j].intxy = [-9999, -9999];
					}
				}

			}
		}

		if (self.aPlots.length === 3) {
			for (i=0,iLen=self.aPlots.length;i<iLen;i++) {
				oFormat = ZC.ZCUtils._setup_format_(self.aPlots[i].oData['value-box'], self.aPlots[i].oData);
				
				if (ZC._n_(oFormat['decimals']) === null || oFormat['decimals'] === -1) {
					oFormat['decimals'] = 0;
				}
				for (j=0,jLen=self.aPlots[i].aPlotNodes.length;j<jLen;j++) {
					self.aIArea[j].area = ZC.ZCUtils._format_(self.aIArea[j].area, oFormat);
				}
			}
		}

		self._super();

	}
});










ZC.ZCPlot = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oGraph = oParent.oParent;
		self.oLoader = self.oGraph.oParent;
		self.oRulesCache = {};
		self.bIgnore = false;
		self.iBackLayers = 2;
		self.iFrontLayers = 1;
		self.aValues = [];
		self.oXData = {};
		self.aPlotNodes = [];
		self.sType = '';
		self.sTypeX = null;
		self.oHoverState = null;
		self.bGroupSelections = false;
		self.sSelectionMode = 'none';
		self.sBackgroundMode = 'plot';
		self.bMidPoint = true;
		self.oSelectedState = null;
		self.oBackgroundState = null;
		self.oMarker = null;
		self.oHoverMarker = null;
		self.oSelectedMarker = null;
		self.oBackgroundMarker = null;
		self.aPalette = null;
		self.iIndex = -1;
		self.aScales = [];
		self.bStacked = false;
		self.sStackType = 'normal';
		self.iStack = 0;
		self.oValueBox = null;
		self.aValueBoxExtra = null;
		self.oTooltip = null;
		self.oPlotInfo = null;
		self.sText = null;
		self.sTooltipText = null;
		self.sLegendText = null;
		self.sDescription = null;
		self.iDecimals = -1;
		self.sThousandsSeparator = null;
		self.sDecimalsSeparator = null;
		self.bExponent = false;
		self.bExponentDecimals = 2;
		self.bShort = false;
		self.sShortUnit = '';
		self.sNegation = 'standard';
		self.sAspect = null;
		self.sMode = null;
		self.iMaxNodes = null;
		self.iMaxTrackers = null;
		self.bSegmentTrackers = true;
		self.iSamplingStep = null;
		
		self.iScrollStepMultiplier = 1;
		self.bExact = false;
		self.bPreview = true;
		self.iZIndex = 0;
		self.aUrl = null;
		self.aTarget = null;
		self.bIgnoreLocate = true;
		self.oKeyPlotAssoc = null;
		self.fMinKeyDiff = 1;
		self.fMaxKeyDiff = 1;
		self.aErrors = [];
		self.oError = null;
		self.bKeyValues = false;
		self.aStyles = [];
		self.iPalette = -1;
		
		self.bAnimation = false;
		self.iAnimationEffect = 0;
		self.fAnimationSpeed = 0.6;
		self.iAnimationMethod = 0;
		self.iAnimationDelay = 0;
		self.sAnimationDelay = null;
		self.iAnimationSequence = 0;
		self.oAnimationAttributes = null;
		self.bFast = false;
		self.bFastMarkers = true;
		self.bFastRules = false;
		self.fDensity = 1;
		self.iExtraValues = 0;
		self.bHighlight = false;
		self.bHighlightLegend = false;
		self.sHoverMode = 'node';
		self.bMonotone = false;
		self.aNodeInstances = [null, null, null, null];
		self.sColorDef = 'line';
		
	},
	getNode : function(i, p) {
		var self = this;
		if (typeof(p) === 'undefined' || (!self.aNodeInstances[p] && self.aNodeInstances[1])) {
			p = 1;
		}
		i = parseInt(i, 10);
		if (self.bFast && (self.oGraph.oSettings['layout'] === 'xy' || self.oGraph.oSettings['layout'] === 'yx')) {
			if (self.aPlotNodes[i] && self.aNodeInstances[p]) {
				self.aNodeInstances[p].sId = self.sId + '-node-' + i;
				self.aNodeInstances[p].oData = {'value' : self.aValues[i]};
				if (typeof(self.aValues[i]) === 'string') {
					self.aNodeInstances[p].bValAssoc = true;
				}
				self.aNodeInstances[p].iIndex = i;
				
				if ((self.sType === 'line' || self.sType === 'area' || self.sType === 'vline' || self.sType === 'varea') && !self.oValueBox) {
					if (self.aPlotNodes[i].fKeyValue !== null || typeof(self.oGraph.oAttributes['plot-' + self.iIndex + '-first-run']) !== 'undefined') {
						self.aNodeInstances[p].parse();
					}
				} else {
					self.aNodeInstances[p].parse();
				}
				
				if (self.sType === 'line' || self.sType === 'area' || self.sType === 'vline' || self.sType === 'varea') {
					if (self.oGraph.oSettings['layout'] === 'xy') {
						if (self.aPlotNodes[i].fKeyValue !== null) {
							self.aNodeInstances[p].iX = self.aPlotNodes[i].iX = self._oScaleKey.getCoordByValue(self.aPlotNodes[i].fKeyValue);
						} else {
							self.aNodeInstances[p].iX = self.aPlotNodes[i].iX = self._oScaleKey.getCoordByIndex(i);
						}
						if (self.bStacked && self.sStackType === '100%') {
							self.aNodeInstances[p].iY = self.aPlotNodes[i].iY = self._oScaleVal.getCoordByValue(100*self.aPlotNodes[i].fAbsoluteValue/self.oParent.oPlotSetInfo[i]['%total-'+self.iStack]);
						} else {
							self.aNodeInstances[p].iY = self.aPlotNodes[i].iY = self._oScaleVal.getCoordByValue(self.aPlotNodes[i].fAbsoluteValue);
						}
					} else {
						if (self.aPlotNodes[i].fKeyValue !== null) {
							self.aNodeInstances[p].iY = self.aPlotNodes[i].iY = self._oScaleKey.getCoordByValue(self.aPlotNodes[i].fKeyValue);
						} else {
							self.aNodeInstances[p].iY = self.aPlotNodes[i].iY = self._oScaleKey.getCoordByIndex(i);
						}
						if (self.bStacked && self.sStackType === '100%') {
							self.aNodeInstances[p].iX = self.aPlotNodes[i].iX = self._oScaleVal.getCoordByValue(100*self.aPlotNodes[i].fAbsoluteValue/self.oParent.oPlotSetInfo[i]['%total-'+self.iStack]);
						} else {
							self.aNodeInstances[p].iX = self.aPlotNodes[i].iX = self._oScaleVal.getCoordByValue(self.aPlotNodes[i].fAbsoluteValue);
						}						
					}
				} else {
					self.aNodeInstances[p].setupXY();
				}
				return self.aNodeInstances[p];
			} else {
				return null;
			}
		} else {
			return self.aPlotNodes[i];
		}
	},
	addKeyPlotAssoc : function(oKey, oInfo) {
		var self = this;
		if (!self.oKeyPlotAssoc[oKey]) {
			self.oKeyPlotAssoc[oKey] = [];
		}
		if (!self.bFast || (self.bFast && ZC._indexof_(self.oKeyPlotAssoc[oKey], oInfo) === -1)) {
			self.oKeyPlotAssoc[oKey].push(oInfo);
		}
	},
	createPlotNode : function() {
		return new ZC.ZCPlotNode(this);
	},
	getElementData : function() {
		return {};
	},
	loadPalette : function() {
		this.assign('palette', 'iPalette', 'i');
		return this.oGraph.oParent.oDefaults.findPalette((this.iPalette!==-1)?this.iPalette:this.iIndex, this.oGraph.sType);
	},
	loadXPalette : function() {
		var self = this;
		if (self.aPalette[4]) {
			var iPos, oGlobals = {};
			for (var sAttr in self.aPalette[4]) {
				if ((iPos=sAttr.indexOf('.')) === -1) {
					if (ZC._n_(self.oData[sAttr]) === null) {
						oGlobals[sAttr] = true;
						self.oData[sAttr] = self.aPalette[4][sAttr];
					}
				} else {
					if (sAttr.substring(0, iPos) === self.sType) {
						if (ZC._n_(self.oData[sAttr.substring(iPos+1)]) === null || oGlobals[sAttr.substring(iPos+1)]) {
							self.oData[sAttr.substring(iPos+1)] = self.aPalette[4][sAttr];
						}
					}
				}
			}
		}
	},
	applySelectionStyle : function(oNode, oStyle) {
		var self = this, mValue;
		var oStyle_;
		if (self.oGraph.aSelection[self.iIndex] || self.oGraph.bSelection || self.aStyles[oNode.iIndex]) {
			oStyle_ = new ZC.ZCTextBox(self);
			oStyle_.copy(oStyle);
			if (self.oGraph.oSelection['p'+self.iIndex] && self.oGraph.oSelection['p'+self.iIndex]['n'+oNode.iIndex]) {
				if (oNode.oAttributes['selected-state']) {
					oStyle_.oSelectionData = oNode.oAttributes['selected-state'];
				} else {
					oStyle_.oSelectionData = self.oSelectedState?self.oSelectedState.oData:{};
				}
			} else {
				if ((self.sBackgroundMode !== 'none') && ((self.sBackgroundMode === 'plot' && self.oGraph.aSelection[self.iIndex]) || (self.sBackgroundMode === 'graph' && self.oGraph.bSelection))) {
					if (oNode.oAttributes['background-state']) {
						oStyle_.oSelectionData = oNode.oAttributes['background-state'];
					} else {
						oStyle_.oSelectionData = self.oBackgroundState?self.oBackgroundState.oData:{};
					}
				}
			}
			oStyle_.bIgnoreLocate = true;
			oStyle_.parse();
		} else {
			oStyle_ = oStyle;
		}
		if (ZC._n_(mValue=self.aStyles[oNode.iIndex]) !== null) {
			
			if (oNode.oParent.aRules.length === 0) {
				oNode.oParent.aRules = [{}];
			}
			
			if (typeof(self.aStyles[oNode.iIndex]) === 'string') {
				oStyle_.append({
					'background-color' : ZC.ZCUtils._darken_(mValue, 20) + ' ' + mValue,
					'line-color' : mValue,
					'border-color' : ZC.ZCUtils._darken_(mValue, 20)
				});
			} else {
				oStyle_.append(self.aStyles[oNode.iIndex]);
			}
			oStyle_.parse();
		}
		return oStyle_;
	},
	getScales : function(sType) {
		var self = this;
		var aScales = [];
		if (ZC._n_(sType) !== null) {
			for (var i=0,iLen=self.aScales.length;i<iLen;i++) {
				var oScale = self.oGraph.getScaleByName(self.aScales[i]);
				if (oScale && oScale.sType === sType) {
					aScales.push(self.aScales[i]);
				}
			}
		} else {
			aScales = self.aScales;
		}
		return aScales;
	},
	setupFormat : function() {
		var self = this;
		var oFormat = {
			'negation' : self.sNegation,
			'thousands-separator' : self.sThousandsSeparator,
			'decimals-separator' : self.sDecimalsSeparator,
			'decimals' : self.iDecimals,
			'short' : self.bShort,
			'short-unit' : self.sShortUnit,
			'exponent' : self.bExponent,
			'exponent-decimals' : self.iExponentDecimals
		};
		return oFormat;
	},
	parse : function() {
		var self = this, mValue, mValue_, i, iLen;
		self.oCanvasCache = {};
		self._super();
		self.oKeyPlotAssoc = {};
		if (ZC._n_(mValue=self.oData['scales']) !== null) {
			self.aScales = mValue.split(/,|;|\s/);
		}
		
		if (self.oGraph.oData['legend'] && self.oGraph.oData['legend']['highlight-plot']){
		    self.bHighlight = true;
		}
		
		
		if (ZC._n_(self.oData['multiplier']) !== null && ZC._n_(self.oData['short']) === null) {
			self.oData['short'] = self.oData['multiplier'];
		}

		
		if (ZC._n_(self.oData['click-marker']) !== null) {
			if (ZC._n_(self.oData['selection-mode']) === null && ZC._n_(self.oData['selected-marker']) === null) {
				self.oData['selection-mode'] = 'multiple';
				self.oData['selected-marker'] = {};
				ZC._cp_(self.oData['click-marker'], self.oData['selected-marker']);
			}
		}

		
		self.sStackType = self.oGraph.sStackType;

		self.assign_a([
			['ignore', 'bIgnore', 'b'],
			['exponent', 'bExponent', 'b'],
			['exponent-decimals', 'iExponentDecimals', 'ia'],
			['decimals', 'iDecimals', 'ia'],
			['preview', 'bPreview', 'b'],
			['stacked', 'bStacked', 'b'],
			['stack-type', 'sStackType'],
			['exact', 'bExact', 'b'],
			['text', 'sText'],
			['tooltip-text', 'sTooltipText'],
			['legend-text', 'sLegendText'],
			['description', 'sDescription'],
			['stack', 'iStack', 'i'],
			['z-index', 'iZIndex', 'i'],
			['aspect', 'sAspect'],
			['mode', 'sMode'],
			['density', 'fDensity', 'f'],
			['max-nodes', 'iMaxNodes'],
			['max-trackers', 'iMaxTrackers'],
			['segment-trackers', 'bSegmentTrackers', 'b'],
			['sampling-step', 'iSamplingStep', 'i'],
			['scroll-step-multiplier', 'iScrollStepMultiplier', 'i'],
			['url', 'sUrl'],
			['target', 'sTarget'],
			['decimals-separator', 'sDecimalsSeparator'],
			['thousands-separator', 'sThousandsSeparator'],
			['short', 'bShort', 'b'],
			['negation', 'sNegation'],
			['short-unit', 'sShortUnit'],
			['fast-rules', 'bFastRules', 'b'],
			['errors', 'aErrors'],
			['styles', 'aStyles'],
			['monotone', 'bMonotone', 'b'],
			['highlight', 'bHighlight', 'b'],
			['highlight-legend', 'bHighlightLegend', 'b'],
			['hover-mode', 'sHoverMode'],
			['mid-point', 'bMidPoint', 'b'],
			
			['animate', 'bAnimation', 'b'],
			['effect', 'iAnimationEffect', 'i'],
			['speed', 'fAnimationSpeed', 'f'],
			['selection-mode', 'sSelectionMode'],
			['group-selections', 'bGroupSelections', 'b'],
			['background-mode', 'sBackgroundMode'],
			['extra-values', 'iExtraValues', 'ia']
		]);

		
		if (self.oAttributes['quick-parse']) {
			return;
		}

		ZC._todash_(self.aStyles);
		
		
		if (self.bHighlight && (ZC._n_(self.oGraph.oData['legend']) === null || ZC._n_(self.oGraph.oData['legend']['highlight-legend']) === null) && ZC._n_(self.oData['highlight-legend'] === null)){
			self.bHighlightLegend = self.bHighlight;
		}

		if (ZC._n_(mValue=self.oData['animation']) !== null) {
			self.bAnimation = true;
			var mValue__;
			if (ZC._n_(mValue_=mValue['effect']) !== null) {
				if ((mValue_+'').indexOf('ANIMATION_') === 0) {
					if (ZC._n_(mValue__=ZC.ANIMATION[(mValue_+'').substring(10)]) !== null) {
						mValue_ = mValue__;
					}
				}
				self.iAnimationEffect = ZC._i_(mValue_);
				if (self.iAnimationEffect === 0) {
					self.bAnimation = false;
				}
			}
			if (ZC._n_(mValue_=mValue['speed']) !== null) {
				if ((mValue_+'').indexOf('ANIMATION_') === 0) {
					if (ZC._n_(mValue__=ZC.ANIMATION[(mValue_+'').substring(10)]) !== null) {
						mValue_ = mValue__;
					}
				}
				self.fAnimationSpeed = ZC._f_(mValue_);
			}
			if (ZC._n_(mValue_=mValue['delay']) !== null) {
				self.fAnimationDelay = ZC._f_(mValue_);
			}
			if (ZC._n_(mValue_=mValue['method']) !== null) {
				if ((mValue_+'').indexOf('ANIMATION_') === 0) {
					if (ZC._n_(mValue__=ZC.ANIMATION[(mValue_+'').substring(10)]) !== null) {
						mValue_ = mValue__;
					}
				}
				self.iAnimationMethod = ZC._i_(mValue_);
			}
			if (ZC._n_(mValue_=mValue['sequence']) !== null) {
				if ((mValue_+'').indexOf('ANIMATION_') === 0) {
					if (ZC._n_(mValue__=ZC.ANIMATION[(mValue_+'').substring(10)]) !== null) {
						mValue_ = mValue__;
					}
				}
				self.iAnimationSequence = ZC._i_(mValue_);
			}
			if (ZC._n_(mValue_=mValue['attributes']) !== null) {
				self.oAnimationAttributes = mValue_;
			}
		}
		if (self.fAnimationSpeed < 10) {
			self.fAnimationSpeed *= 1000;
		}
		if (self.fAnimationDelay < 10) {
			self.fAnimationDelay *= 1000;
		}
		if (typeof(ZC.ZCTweenManager) !== 'undefined') {
			self.fAnimationSpeed = ZC._max_(ZC.ZCTweenManager.iAnimationStepDuration, self.fAnimationSpeed);
		}
		if (self.sMode === 'fast' || typeof(ZC.ZCTweenManager) === 'undefined' || zingchart.SKIP.ANIMATION) {
			self.bAnimation = false;
		}
		
		if (self.oLoader.bImgGen) {
			self.bAnimation = false;
		}

		if (ZC._indexof_(['line', 'area', 'vbar', 'hbar', 'stock', 'scatter', 'bubble', 'radar', 'piano'], self.sType) !== -1) {
			

			if (
				self.sMode !== 'normal'
				&& 
				!self.bAnimation
				&&
				
				JSON.stringify(self.oData).indexOf('"rules"') === -1
				&& 
				JSON.stringify(self.oData).indexOf('"js-rule"') === -1
				&& 
				self.aStyles.length === 0
				&&
				self.oLoader.oAttributes['json'].indexOf('"override"') === -1
				&&
				self.sSelectionMode === 'none'
			) {
				self.bFast = true;
			} else {
				self.bFast = false;
			}
			
			if (self.sMode === 'fast') {
				self.bFast = true;
			}
		}

		for (var sKey in self.oData) {
			if (sKey.substring(0, 5) === 'data-') {
				var sAttr = sKey.substring(5);
				self.oXData[sAttr] = self.oData[sKey];
			}
		}

		
		function _def_(sObject) {
			var aDefs = ['(' + self.sType + ').plot.' + sObject];
			if (self.sTypeX) {
				aDefs.push('(' + self.sTypeX + ').plot.' + sObject);
			}
			return aDefs;
		}

		var oDefaults = self.oLoader.oDefaults;

		self.oHoverState = new ZC.ZCStyle(self);
		oDefaults.load(self.oHoverState.oData, _def_('hover-state'));
		self.oHoverState.append(self.oData);
		self.oHoverState.append(self.oData['hover-state']);

		if (self.bHighlight) {
			self.oHighlightState = new ZC.ZCStyle(self);
			oDefaults.load(self.oHighlightState.oData, _def_('highlight-state'));
			self.oHighlightState.append(self.oData);
			if (ZC._n_(mValue=self.oData['highlight-state']) !== null) {
				self.oHighlightState.append(mValue);
			}
			
			self.oHighlightState.oData['shadow'] = true;
		}

		if (ZC._n_(mValue=self.oData['selected-state']) !== null) {
			self.oSelectedState = new ZC.ZCStyle(self);
			oDefaults.load(self.oSelectedState.oData, _def_('selected-state'));
			self.oSelectedState.append(mValue);
		}

		if (ZC._n_(mValue=self.oData['background-state']) !== null) {
			self.oBackgroundState = new ZC.ZCStyle(self);
			oDefaults.load(self.oBackgroundState.oData, _def_('background-state'));
			self.oBackgroundState.append(mValue);
		}

		self.oMarker = new ZC.ZCStyle(self);
		oDefaults.load(self.oMarker.oData, _def_('marker'));
		self.oMarker.append(self.oData['marker']);
		
		self.oMarker.parse();
		if (self.oMarker.aRules.length > 0 || self.aStyles.length > 0 || self.oMarker.oData['top-state']) {
			self.bFastMarkers = false;
		}

		self.oHoverMarker = new ZC.ZCStyle(self);
		oDefaults.load(self.oHoverMarker.oData, _def_('hover-marker'));
		self.oHoverMarker.append(self.oData['marker']);
		self.oHoverMarker.append(self.oData['hover-marker']);

		if (ZC._n_(mValue=self.oData['selected-marker']) !== null) {
			self.oSelectedMarker = new ZC.ZCStyle(self);
			oDefaults.load(self.oSelectedMarker.oData, _def_('selected-marker'));
			self.oSelectedMarker.append(mValue);
		}

		if (ZC._n_(mValue=self.oData['background-marker']) !== null) {
			self.oBackgroundMarker = new ZC.ZCStyle(self);
			oDefaults.load(self.oBackgroundMarker.oData, _def_('background-marker'));
			self.oBackgroundMarker.append(mValue);
		}

		self.oTooltip = new ZC.ZCTextBox(self);
		
		self.oTooltip.append(self.oData['tooltip']);

		if (ZC._n_(mValue=self.oData['error']) !== null) {
			self.oError = new ZC.ZCShape(self);
			oDefaults.load(self.oError.oData, _def_('error'));
			self.oError.append(mValue);
			if (ZC._n_(self.oError.oData['size']) === null) {
				self.oError.oData['size'] = 4;
			}
		}

		if (ZC._n_(mValue=self.oData['value-box']) !== null) {
			if (mValue instanceof Array) {
				self.oValueBox = new ZC.ZCStyle(self);
				oDefaults.load(self.oValueBox.oData, _def_('value-box'));
				if (ZC._n_(mValue_=self.oGraph.oData['plot']) !== null) {
					self.oValueBox.append(mValue_['value-box']);
				}
				self.oValueBox.append(mValue[0]);

				if (mValue.length > 1) {
					self.aValueBoxExtra = [];
				}
				for (i=1;i<mValue.length;i++) {
					self.aValueBoxExtra[i-1] = new ZC.ZCStyle(self);
					oDefaults.load(self.aValueBoxExtra[i-1].oData, _def_('value-box'));
					if (ZC._n_(mValue_=self.oGraph.oData['plot']) !== null) {
						self.aValueBoxExtra[i-1].append(mValue_['value-box']);
					}
					self.aValueBoxExtra[i-1].append(mValue[i]);
				}
			} else {
				self.oValueBox = new ZC.ZCStyle(self);
				oDefaults.load(self.oValueBox.oData, _def_('value-box'));
				if (ZC._n_(mValue_=self.oGraph.oData['plot']) !== null) {
					self.oValueBox.append(mValue_['value-box']);
				}
				self.oValueBox.append(mValue);
			}
			self.oValueBox.parse();
		}

		
		if (self.oLoader.bFullScreenMode) {
			self.bVisible = ZC.FSSTATUS['g-'+self.oGraph.iIndex+'-p-'+self.iIndex];
		}

		var bInit = false;
		if (typeof(self.oGraph.oAttributes['plot'+self.iIndex+'.visible']) === 'undefined') {
			bInit = true;
		}
		if (bInit) {
			self.oGraph.oAttributes['plot'+self.iIndex+'.visible'] = true;
		}
		if (!self.bVisible) {
			if (bInit) {
				self.oGraph.oAttributes['plot'+self.iIndex+'.visible'] = false;
			}
		}

		for (i=0,iLen=self.oGraph.aScales.length;i<iLen;i++) {
			if (ZC._n_(self.oGraph.aScales[i].oData['values']) !== null) {
				self.oGraph.aScales[i].bUsed = true;
			} else {
				if (ZC._indexof_(self.aScales, self.oGraph.aScales[i].sName) !== -1) {
					if (self.oGraph.getToggleAction() === 'remove' || self.oGraph.oParent.bFlat) {
						if (self.bVisible && self.oGraph.oAttributes['plot' + self.iIndex + '.visible']) {
							self.oGraph.aScales[i].bUsed = true;
						}
					} else {
						self.oGraph.aScales[i].bUsed = true;
					}
				}
			}
		}

		var oPlotNode = null;
		self.sId = self.oParent.sId + '-plot-' + self.iIndex;
		self.aPlotNodes = [];

		if (!self.oParent.oPlotSetInfo) {
			self.oParent.oPlotSetInfo = {};
		}

		

		if (self.sType.indexOf('area') !== -1 && self.sType.indexOf('3d') === -1 && self.bStacked) {
			if (!self.oParent.aKeys) {
				self.oParent.aKeys = [];
			}
			
			var bKeyValues = false;
			if (self.oData['values'] !== null) {
				for (i=0,iLen=self.oData['values'].length;i<iLen;i++) {
					if (typeof(self.oData['values'][i]) === 'object') {
						bKeyValues = true;
						break;
					}
				}
			}
			if (bKeyValues) {
				self.bAnimation = false;
				if (!self.oJsRule && self.aRules.length === 0) {
					self.bFast = true;
				}
			}
		}

		if (ZC._n_(self.oData['values']) !== null && self.sType !== '') {
			self.aValues = self.oData['values'];
			var fKeyValue = null;
			var aKeyDiffSet = [], aValuesSet = [];
			for (i=0,iLen=self.aValues.length;i<iLen;i++) {
				var bNullValue = false;
				if (ZC._n_(self.aValues[i]) !== null && typeof(self.aValues[i]) === 'object' && self.aValues[i].length > 1) {
					if (ZC._n_(self.aValues[i][1]) === null || (typeof(self.aValues[i][1]) === 'string' && self.aValues[i][1].toUpperCase() === 'NULL')) {
						bNullValue = true;
					}
				} else {
					if (ZC._n_(self.aValues[i]) === null || (typeof(self.aValues[i]) === 'string' && self.aValues[i].toUpperCase() === 'NULL')) {
						bNullValue = true;
					}
				}
				
				if (self.oGraph.sType === 'piano') {
					bNullValue = false;
				}

				if (bNullValue) {
					
					self.aPlotNodes.push(null);
				} else {
					if (self.bFast && (self.oGraph.oSettings['layout'] === 'xy' || self.oGraph.oSettings['layout'] === 'yx')) {
						if (!self.aNodeInstances[1]) {
							if (self.sType === 'bubble' || self.sType === 'scatter') {
								self.aNodeInstances[1] = oPlotNode = self.createPlotNode();	
							} else {
								self.aNodeInstances[0] = self.createPlotNode();
								self.aNodeInstances[1] = oPlotNode = self.createPlotNode();
								self.aNodeInstances[2] = self.createPlotNode();
								self.aNodeInstances[3] = self.createPlotNode();
							}
						}
					} else {
						oPlotNode = self.createPlotNode();
					}
					oPlotNode.sId = self.sId + '-node-' + i;
					
					if (typeof(self.aValues[i]) === 'string' && zingchart.QUOTEDVALUES) {
						self.aValues[i] = ZC._f_(self.aValues[i]);
					}

					oPlotNode.oData = {value : self.aValues[i]};
					if (typeof(self.aValues[i]) === 'string') {
						oPlotNode.bValAssoc = true;
					}
					oPlotNode.iIndex = i;
					oPlotNode.parse();

					if (oPlotNode.fKeyValue) {
						if (fKeyValue !== null) {
							aKeyDiffSet.push(ZC._a_(oPlotNode.fKeyValue-fKeyValue));
						}
						fKeyValue = oPlotNode.fKeyValue;
					}

					if (self.oParent.aKeys) {
						if (fKeyValue !== null) {
							if (ZC._indexof_(self.oParent.aKeys, oPlotNode.fKeyValue) === -1) {
								self.oParent.aKeys.push(oPlotNode.fKeyValue);
							}
						} else {
							if (ZC._indexof_(self.oParent.aKeys, i) === -1) {
								self.oParent.aKeys.push(i);
							}
						}
					}

					if (self.bFast && (self.oGraph.oSettings['layout'] === 'xy' || self.oGraph.oSettings['layout'] === 'yx')) {
						var oFakeNode = {
							iX : oPlotNode.iX,
							iY : oPlotNode.iY,
							iIndex : oPlotNode.iIndex,
							fKeyValue : oPlotNode.fKeyValue,
							fValue : oPlotNode.fValue,
							fAbsoluteValue : oPlotNode.fValue,
							aExtraValues : oPlotNode.aExtraValues,
							bOnViewport : oPlotNode.bOnViewport
						};
						if (self.sType === 'bubble') {
							oFakeNode.fSizeValue = oPlotNode.fSizeValue;
						}
						self.aPlotNodes.push(oFakeNode);
					} else {
						self.aPlotNodes.push(oPlotNode);
					}
					if (self.oGraph.oAttributes['plot'+self.iIndex+'.visible']) {
						
						if (zingchart.DEV.PLOTSTATS || self.sStackType === '100%') {
							if (self.bStacked) {
								if (ZC._n_(self.oParent.oPlotSetInfo[i]) === null) {
									self.oParent.oPlotSetInfo[i] = {};
									self.oParent.oPlotSetInfo[i]['%total-' + self.iStack] = oPlotNode.fValue;
								} else {
									if (ZC._n_(self.oParent.oPlotSetInfo[i]['%total-' + self.iStack]) === null) {
										self.oParent.oPlotSetInfo[i]['%total-' + self.iStack] = oPlotNode.fValue;
									} else {
										self.oParent.oPlotSetInfo[i]['%total-' + self.iStack] += oPlotNode.fValue;
									}
								}
							}
						}
					}

					if (zingchart.DEV.PLOTSTATS) {
						aValuesSet.push(oPlotNode.fValue);
						if (!self.oPlotInfo) {
							self.oPlotInfo = {
								'%plot-min-index' : i,
								'%plot-max-index' : i,
								'%plot-sum' : oPlotNode.fValue,
								'%plot-values' : oPlotNode.fValue
							};
						} else {
							self.oPlotInfo['%plot-max-index'] = i;
							self.oPlotInfo['%plot-sum'] += oPlotNode.fValue;
							self.oPlotInfo['%plot-values'] += ',' + oPlotNode.fValue;
						}
						if (!self.oParent.oPlotSetInfo) {
							self.oParent.oPlotSetInfo = {};
						}
						if (ZC._n_(self.oParent.oPlotSetInfo['%pstack-'+i+'-'+self.iStack+'-sum']) === null) {
							self.oParent.oPlotSetInfo['%pstack-'+i+'-'+self.iStack+'-sum'] = oPlotNode.fValue;
						} else {
							self.oParent.oPlotSetInfo['%pstack-'+i+'-'+self.iStack+'-sum'] += oPlotNode.fValue;
						}
					}
				}
			}
			if (zingchart.DEV.PLOTSTATS) {
				if (self.oPlotInfo) {
					self.oPlotInfo['%plot-average'] = self.oPlotInfo['%plot-sum']/self.aValues.length;
				}
				if (aValuesSet.length > 0) {
					self.oPlotInfo['%plot-min-value'] = ZC._min_a_(aValuesSet);
					self.oPlotInfo['%plot-max-value'] = ZC._max_a_(aValuesSet);
				}
			} else {
				self.oPlotInfo = {
					'%plot-min-index' : 0,
					'%plot-max-index' : self.aValues.length,
					'%plot-sum' : -1,
					'%plot-values' : '',
					'%plot-average' : -1,
					'%plot-min-value' : -1,
					'%plot-max-value' : -1
				};
			}
			if (fKeyValue) {
				if (aKeyDiffSet.length > 0) {
					self.fMinKeyDiff = ZC._min_a_(aKeyDiffSet);
					self.fMaxKeyDiff = ZC._max_a_(aKeyDiffSet);
				}
			}
		}
		
	},
	mapPointsToPreview : function(aPoints) {
		var self = this;
		var oPlotArea = self.oGraph.oPlotArea;
		var oPreview = self.oGraph.oPreview;
		var oViewport = oPreview.oViewport;
		var aPointsPreview = [];
		for (var i=0,iLen=aPoints.length;i<iLen;i++) {
			if (aPoints[i]) {
				var fRatioX = (aPoints[i][0]-oPlotArea.iX)/oPlotArea.iWidth;
				var fRatioY = (aPoints[i][1]-oPlotArea.iY)/oPlotArea.iHeight;
				var iPreviewX = oViewport.iX + oViewport.iBorderWidth + fRatioX*(oViewport.iWidth-2*oViewport.iBorderWidth);
				var iPreviewY = oViewport.iY + oViewport.iBorderWidth + fRatioY*(oViewport.iHeight-2*oViewport.iBorderWidth);
				aPointsPreview.push([iPreviewX, iPreviewY]);
			} else {
				aPointsPreview.push(null);
			}
		}
		return aPointsPreview;
	},
	paint : function() {
		var self = this;

		var iDimension = self.oGraph.oPlotArea.iWidth;
		var iRatio = 4;
		switch (self.oGraph.sType) {
			case 'scatter':
			case 'bubble':
				iDimension = 1000000;
				break;
			case 'hbar':
			case 'hbar3d':
				iDimension = self.oGraph.oPlotArea.iHeight;
				break;
		}
		if (ZC._n_(self.iMaxNodes) === null) {
			self.iMaxNodes = ZC._i_(iDimension/iRatio);
		}
		if (ZC._n_(self.iMaxTrackers) === null) {
			self.iMaxTrackers = ZC._i_(iDimension/iRatio);
		}

		if (self.bFastMarkers) {
			self.oClonedMarker = null;
			self.oClonedMarkerNode = null;
			self.oClonedMarkerNodeSh = null;
			self.oClonedMarkerNodeFill = null;
		}

	},
	prepareNodes : function(bAll) {
		var self = this, i, iLen, iNodes;
		for (i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
			if (self.aPlotNodes[i]) {
				self.aPlotNodes[i].bOnViewport = false;
			}
		}
		var oPlotArea = self.oGraph.oPlotArea;
		self._bShowMarkers = false;
		self._bCreateAreaMap = true;
		self._bNormalizeAspect = false;
		iNodes = 0;
		if (bAll) {
			self._bShowMarkers = true;
			if (self.iMaxTrackers < self.aPlotNodes.length) {
				self._bCreateAreaMap = false;
			}
		} else {
			if (self._oScaleKey.bKeyValues && self.bKeyValues) {
				
				for (i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
					if (
						self.aPlotNodes[i]
						&&
						(
						self.oGraph.aKeyAssoc.length > 0
						||
						ZC._btw_(self.aPlotNodes[i].fKeyValue, self._oScaleKey.aValues[self._oScaleKey.iMinIndex], self._oScaleKey.aValues[self._oScaleKey.iMaxIndex])
						)
					) {
						iNodes++;
					}
				}
				if (self.iMaxTrackers < iNodes) {
					self._bCreateAreaMap = false;
				}
				if (iNodes*self.fDensity > oPlotArea.iWidth) {
					self._bNormalizeAspect = true;
				}
				if (self.iMaxNodes >= iNodes) {
					self._bShowMarkers = true;
				}

			} else {
				if (self.iMaxNodes > self._oScaleKey.iMaxIndex - self._oScaleKey.iMinIndex) {
					self._bShowMarkers = true;
				}
			}

			self.iStep = 1;

			if (!self._oScaleKey.bKeyValues || !self.bKeyValues) {
				iNodes = self._oScaleKey.iMaxIndex-self._oScaleKey.iMinIndex;
				if (self.iMaxTrackers < iNodes) {
					self._bCreateAreaMap = false;
				}
				if (iNodes*self.fDensity > oPlotArea.iWidth) {
					self._bNormalizeAspect = true;
				}
				if (!self.bExact && iNodes*self.fDensity > oPlotArea.iWidth) {
					self.iStep = ZC._max_(1, ZC._i_(iNodes*self.fDensity/oPlotArea.iWidth));
				}
			}

			if (self._oScaleKey.bKeyValues && self.bKeyValues) {
				if (!self.bExact) {
					if (iNodes*self.fDensity > oPlotArea.iWidth) {
						self.iStep = ZC._max_(1, ZC._i_(iNodes*self.fDensity/oPlotArea.iWidth));
					}
				}
			}
			if (self.oGraph.bScrolling) {
				self.iStep *= self.iScrollStepMultiplier;
			}
		}
		if (ZC._n_(self.iSamplingStep) !== null && self.iStep > self.iSamplingStep) {
			self.iStep = self.iSamplingStep;
		}
	},
	paintNodes : function(bAll) {
		var self = this, i, iLen, iStep;
		if (ZC._n_(bAll) === null || !bAll) {
			bAll = false;
		}

		self.prepareNodes(bAll);

		function _nodes_(iStart, iCount) {
			for (var i=iStart;i<iStart+iCount;i++) {
				if (self.aPlotNodes[i]) {
					oNode = self.getNode(i);
					oNode.oCanvas = self._oCanvasNode;
					oNode.paint();
					
					oNode.bOnViewport = true;
				}
			}
			if (iStart+iCount < self.aPlotNodes.length) {
				if (self.oGraph.bAsync) {
					window.setTimeout(function() {
						_nodes_(iStart+iCount, iCount);
					}, 10);
				} else {
					_nodes_(iStart+iCount, iCount);
				}
			} else {
				if (self.oGraph.bAsync) {
					if (self.iIndex === self.oParent.aPlots.length-1) {
						self.oParent._end_();
					}
				}
			}
		}

		var oNode = null;
		if (bAll) {

			self.oParent.bForceEnd = false;

			_nodes_(0, (ZC.ie678 || ZC.mobile)?100:1000);

		} else {

			var bNoBar = (self.sType !== 'vbar' && self.sType !== 'hbar');

			if (self._oScaleKey.bKeyValues && self.bKeyValues) {

				iStep = self.iStepPrev = self.iStepNext = self.iStep;
				var bFirstNode = true, iLastIndex = 0, iNodes_ = 0;

				for (i=0,iLen=self.aPlotNodes.length;i<iLen;i+=iStep) {
					if (self.sType !== 'vbar' && self.sType !== 'hbar') {
						if (iLen-i === 1) {
							self.iStepPrev = iStep;
							self.iStepNext = 1;
						} else {
							if (iLen-i < self.iStep) {
								self.iStepPrev = self.iStep;
								self.iStepNext = iLen-i-1;
								iStep = iLen-i-1;
							}
						}
					}

					if (
						self.aPlotNodes[i]
						&&
						(
							self.oGraph.aKeyAssoc.length > 0
							||
							ZC._btw_(self.aPlotNodes[i].fKeyValue, self._oScaleKey.aValues[self._oScaleKey.iMinIndex], self._oScaleKey.aValues[self._oScaleKey.iMaxIndex])
							||
							(bNoBar && bFirstNode && self.aPlotNodes[i+iStep] && self.aPlotNodes[i+iStep].fKeyValue >= self._oScaleKey.aValues[self._oScaleKey.iMinIndex])
						)
					) {
						if (bNoBar) {
							if (bFirstNode && self.aPlotNodes[i-iStep]) {
								oNode = self.getNode(i-iStep);
								oNode.oCanvas = self._oCanvasNode;
								oNode.paint();
															
								oNode.bOnViewport = true;
								bFirstNode = false;
								iNodes_++;
							}
						}
						oNode = self.getNode(i);
						oNode.oCanvas = self._oCanvasNode;
						oNode.paint();
												
						oNode.bOnViewport = true;
						iNodes_++;
						bFirstNode = false;
						iLastIndex = i;
					}
				}
				if (bNoBar) {
					if (iNodes_ > 0 && self.aPlotNodes[iLastIndex+iStep]) {
						oNode = self.getNode(iLastIndex+iStep);
						oNode.oCanvas = self._oCanvasNode;
						oNode.paint();
						
						oNode.bOnViewport = true;
					}
				}
			} else {

				
				iStep = self.iStepPrev = self.iStepNext = self.iStep;

				for (i=self._oScaleKey.iMinIndex;i<=self._oScaleKey.iMaxIndex;i+=iStep) {
					if ((self._oScaleKey.iMaxIndex-self._oScaleKey.iMinIndex)%self.iStep !== 0) {
						if (bNoBar) {
							if (self._oScaleKey.iMaxIndex-i === 0) {
								self.iStepPrev = iStep;
								self.iStepNext = 1;
							} else {
								if (self._oScaleKey.iMaxIndex-i <= self.iStep) {
									self.iStepPrev = self.iStep;
									self.iStepNext = self._oScaleKey.iMaxIndex-i;
									iStep = self._oScaleKey.iMaxIndex-i;
								}
							}
						}
					}

					if (self.aPlotNodes[i]) {
						oNode = self.getNode(i);
						oNode.oCanvas = self._oCanvasNode;
						oNode.paint();
						
						oNode.bOnViewport = true;
					}

				}
			}
		}
	},
	getCanvas : function(sLayerType, iLayerIndex) {
		var self = this;
		if (self.oCanvasCache[sLayerType+iLayerIndex]) {
			return self.oCanvasCache[sLayerType+iLayerIndex];
		}
		var oCanvas = null;
		if (self.oLoader.usc()) {
			oCanvas = ZC._id_(self.oLoader.sId + '-main-c' + (sLayerType==='fl'?'-top':''));
		} else {
			if (self.oLoader.bFlat || self.oGraph.oSettings['3d']) {
				oCanvas = ZC._id_(self.oGraph.sId + '-plots-' + sLayerType + '-c');
			} else {
				oCanvas = ZC._id_(self.oGraph.sId + '-plot-' + self.iIndex + '-' + sLayerType + '-' + iLayerIndex + '-c');
			}
		}
		if (!self.oCanvasCache[sLayerType+iLayerIndex]) {
			self.oCanvasCache[sLayerType+iLayerIndex] = oCanvas;
		}
		return oCanvas;
	},
	_api_plot_info_ : function(ev) {
		var self = this;
		var oInfo = {
			id : self.oLoader.sId,
			graphid : self.oGraph.sId,
			plotid : self.sObjectId,
			plotindex : self.iIndex,
			ev : ev?ZC.ZCQuery._event_(ev):null,
			xdata : self.oXData
		};
		return oInfo;
	},
	_api_plot_event_ : function(ev, sType) {
		ZC.ZCUtils._trigger_event_('plot_' + sType, this.oLoader, this._api_plot_info_(ev));
	}
});









ZC.ZCXYPlot = ZC.ZCPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.bXY = true;
		self.sType = 'xy';
		self.aScales = ['scale-x', 'scale-y'];
	},
	paint : function() {
		var self = this;
		self._super();
	}
});










ZC.ZCLinePlot = ZC.ZCXYPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'line';
		self.sAspect = 'segmented';
		self.iStep = 1;
		self.sStepStart = 'middle';
		self.aLPoints = [];
		self.bSmartSampling = false;
		self.bInverted = false;
	},
	createPlotNode : function() {
		return new ZC.ZCLinePlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['step-start', 'sStepStart'],
			['smart-sampling', 'bSmartSampling', 'b']
		]);
		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	paint : function() {
		var self = this, i, iLen, iStep, iLastIndex, aMP, oPrevNode, oNextNode;

		self._super();

		self.aLPoints = [];

		var bVLine = self.bInverted;

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		self._oCtxLine = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 1), self.oLoader.sOutput);
		

		if (!self.bFast || self.oGraph.oSettings['3d']) {
			self.paintNodes();
			self.aPoints = null;
		} else {
			self.prepareNodes();
			self.oCanvasSh = self.getCanvas('bl', 0);
			

			
			var bMarkers = true;
			if (
				(ZC._n_(self.oMarker.oData['visible']) !== null && !ZC._b_(self.oMarker.oData['visible']))
				||
				(ZC._n_(self.oParent.oData['type']) !== null && self.oMarker.oData['type'] === 'none')
			) {
				bMarkers = false;
			}

			var aPoints = [], aControlPoints = [], aXPoints = [];

			var bFirstNode = true, iNodes_ = 0, oNode = null;
			iLastIndex = 0;
			var iMinIndex = -1, iMaxIndex = -1;
			var bErrors = self.oParent.aPlots[0].aErrors && self.oParent.aPlots[0].aErrors.length;

			var iStepOrig = self.iStep;

			var sAspect = self.sAspect;
			if (self.iStep > 1 && sAspect === 'spline') {
				sAspect = 'segmented';
			}

			if (self._oScaleKey.bKeyValues && self.bKeyValues) {
				iStep = self.iStep;
				for (i=0,iLen=self.aPlotNodes.length;i<iLen;i+=iStep) {
					if (iMaxIndex-i <= self.iStep) {
						iStep = ZC._max_(1, iMaxIndex-i);
					}
					if (self.aPlotNodes[i]) {
						if (
							self.oGraph.aKeyAssoc.length > 0
							||
							ZC._btw_(self.aPlotNodes[i].fKeyValue, self._oScaleKey.aValues[self._oScaleKey.iMinIndex], self._oScaleKey.aValues[self._oScaleKey.iMaxIndex])
							||
							(bFirstNode && self.aPlotNodes[i+iStep] && self.aPlotNodes[i+iStep].fKeyValue >= self._oScaleKey.aValues[self._oScaleKey.iMinIndex])
						) {
							if (bFirstNode && self.aPlotNodes[i-iStep]) {
								if (iMinIndex === -1) { iMinIndex = i-iStep; }
								iMaxIndex = i-iStep;
								bFirstNode = false;
								iNodes_++;
							}
							if (iMinIndex === -1) { iMinIndex = i; }
							iMaxIndex = i;
							iNodes_++;
							bFirstNode = false;
							iLastIndex = i;
						}
					}
				}
				if (iNodes_ > 0 && self.aPlotNodes[iLastIndex+iStep]) {
					if (iMinIndex === -1) { iMinIndex = iLastIndex+iStep; }
					iMaxIndex = iLastIndex+iStep;
					self.aPlotNodes[iLastIndex+iStep].bOnViewport = true;
				}
			} else {
				iMinIndex = self._oScaleKey.iMinIndex;
				iMaxIndex = self._oScaleKey.iMaxIndex;
			}

			self.iStep = iStepOrig;

			var iXStart = -1;
			
			iStep = self.iStep;

			var fLastValue = null, fSpikeDiff = 0, iSpikeStep = 1;
			iLastIndex = iMinIndex;
			if (bVLine) {
				if (iMaxIndex - iMinIndex > self.oGraph.oPlotArea.iHeight) {
					
					fSpikeDiff = (4/self.oGraph.oPlotArea.iWidth)*(self._oScaleVal.fMax - self._oScaleVal.fMin);
					
					iSpikeStep = ZC._i_((iMaxIndex - iMinIndex)/(4*self.oGraph.oPlotArea.iHeight));
				}
			} else {
				if (iMaxIndex - iMinIndex > self.oGraph.oPlotArea.iWidth) {
					
					fSpikeDiff = (4/self.oGraph.oPlotArea.iHeight)*(self._oScaleVal.fMax - self._oScaleVal.fMin);
					
					iSpikeStep = ZC._i_((iMaxIndex - iMinIndex)/(4*self.oGraph.oPlotArea.iWidth));
				}
			}

			

			for (i=iMinIndex;i<=iMaxIndex;i+=iStep) {
				var bSkipSampling = false;
				if ((iMaxIndex-iMinIndex)%self.iStep !== 0 || (self._oScaleKey.bKeyValues && self.bKeyValues)) {
					if (iMaxIndex-i <= self.iStep) {
						iStep = ZC._max_(1, iMaxIndex-i);
						bSkipSampling = true;
					}
				}

				if (self.bSmartSampling) {
					if (!bSkipSampling) {
						if (self.aPlotNodes[i]) {
							if (ZC._n_(fLastValue) === null) {
								fLastValue = self.aPlotNodes[i].fAbsoluteValue;
								iLastIndex = i;
							} else {
								if (Math.abs(self.aPlotNodes[i].fAbsoluteValue - fLastValue) < fSpikeDiff && i-iLastIndex < iSpikeStep) {
									continue;
								} else {
									fLastValue = self.aPlotNodes[i].fAbsoluteValue;
									iLastIndex = i;
								}
							}
						}
					}
				}

				oNode = self.getNode(i);

				if (oNode) {
					
					if (self._bCreateAreaMap) {
						oNode.paint(true);
					}
					
					if (iXStart === -1) {
						iXStart = oNode.iX;
					}
					switch (sAspect) {
						
						default:
							aPoints.push([oNode.iX, oNode.iY]);
							break;
						case 'spline':
							if (bVLine) {
								aControlPoints.push(oNode.iX);
								aXPoints.push(oNode.iY);
								if (aControlPoints.length === 1) {
									aControlPoints.push(oNode.iX);
									aXPoints.push(oNode.iY);
								}
							} else {
								aControlPoints.push(oNode.iY);
								aXPoints.push(oNode.iX);
								if (aControlPoints.length === 1) {
									aControlPoints.push(oNode.iY);
									aXPoints.push(oNode.iX);
								}
							}
							break;
						case 'stepped':
							switch (self.sStepStart) {
								
								default:
									oPrevNode = self.getNode(i-iStep, 0);
									if (oPrevNode) {
										oPrevNode.setup();
										aMP = ZC.ZCMath._mpoint_(self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY, oNode.iX, oNode.iY);
										aPoints.push(bVLine?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
									} 
									aPoints.push([oNode.iX, oNode.iY]);
									oNextNode = self.getNode(i+iStep, 0);
									if (oNextNode) {
										oNextNode.setup();
										aMP = ZC.ZCMath._mpoint_(oNode.iX, oNode.iY, self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY);
										aPoints.push(bVLine?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
									}
									break;
								case 'before':
									oPrevNode = self.getNode(i-iStep, 0);
									if (oPrevNode) {
										oPrevNode.setup();
										aPoints.push(
											[self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY],
											[self.aPlotNodes[i-iStep].iX, oNode.iY]
										);
									} 
									aPoints.push([oNode.iX, oNode.iY]);
									break;
								case 'after':
									aPoints.push([oNode.iX, oNode.iY]);
									oNextNode = self.getNode(i+iStep, 0);
									if (oNextNode) {
										oNextNode.setup();
										aPoints.push(
											[self.aPlotNodes[i+iStep].iX, oNode.iY],
											[self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY]
										);
									}
									break;
							}
							break;
						case 'jumped':
							oPrevNode = self.getNode(i-iStep, 0);
							if (oPrevNode) {
								oPrevNode.setup();
								aMP = ZC.ZCMath._mpoint_(self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY, oNode.iX, oNode.iY);
								aPoints.push(bVLine?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
							} else {
								aPoints.push(bVLine?[oNode.iX, oNode.iY - self._oScaleKey.iStepSize/2]:[oNode.iX - self._oScaleKey.iStepSize/2, oNode.iY]);
							}
							aPoints.push([oNode.iX, oNode.iY]);
							oNextNode = self.getNode(i+iStep, 0);
							if (oNextNode) {
								oNextNode.setup();
								aMP = ZC.ZCMath._mpoint_(oNode.iX, oNode.iY, self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY);
								aPoints.push(bVLine?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
							} else {
								aPoints.push(bVLine?[oNode.iX, oNode.iY + self._oScaleKey.iStepSize/2]:[oNode.iX + self._oScaleKey.iStepSize/2, oNode.iY]);
							}
							aPoints.push(null);
							break;
					}
					if (bErrors) {
						oNode.sharedErrors(ZC.ZCHtmlUtils._context_(self.getCanvas('fl', 0), self.oLoader.sOutput));
						
					}
					if ((self._bShowMarkers && bMarkers) || self._bCreateAreaMap) {
						oNode.sharedMarker();
					}
					oNode.bOnViewport = true;
				} else {
					aPoints.push(null);
					aControlPoints.push(null);
					aXPoints.push(null);
				}
			}
			if (sAspect === 'spline') {

				aControlPoints.push(aControlPoints[aControlPoints.length-1]);
				aXPoints.push(aXPoints[aXPoints.length-1]);

				aPoints = [];

				for (var p=1;p<aControlPoints.length-1;p++) {
					var aControlPoints_ = [aControlPoints[p-1], aControlPoints[p], aControlPoints[p+1], aControlPoints[p+2]];
					var iXDiff = ZC._a_(aXPoints[p+1] - aXPoints[p]);
					var aSplinePoints = ZC.ZCMath._spline_(self.bMonotone, aControlPoints_, iXDiff);

					for (i=0;i<aSplinePoints.length;i++) {
						if (ZC._n_(aSplinePoints[i][0]) !== null && ZC._n_(aSplinePoints[i][1]) !== null) {
							if (bVLine) {
								aPoints.push([aSplinePoints[i][1], aXPoints[p] + (self._oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
							} else {
								aPoints.push([aXPoints[p] + (self._oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
							}
						} else {
							aPoints.push(null);
						}
					}
				}
			}

			self.bPixelCorrection = false;
			var bCache_ = self.oLoader.bCache;
			self.oLoader.bCache = false;

			self.oAttributes['fast-vector-path'] = true;

			ZC.ZCLine.setup(self._oCtxLine, self);
			ZC.ZCLine.paint(self._oCtxLine, self, aPoints);
			self.oLoader.bCache = bCache_;

			

			
			if (self.oGraph.oPreview && self.oGraph.oPreview.bInit && self.bPreview) {
				var aPointsPreview = self.mapPointsToPreview(aPoints);
				var oCtxPreview = ZC.ZCHtmlUtils._context_(self.oGraph.oPreview.oCanvas, self.oLoader.sOutput);
				var oStyleP = new ZC.ZCStyle(self);
				oStyleP.copy(self);
				oStyleP.iLineWidth = 1;
				
				ZC.ZCLine.paint(oCtxPreview, oStyleP, aPointsPreview, null, 3);
				
			}

		}
	}

});











ZC.ZCAreaPlot = ZC.ZCXYPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'area';
		self.iStep = 1;
		self.sAspect = 'segmented';
		self.iBackLayers = 3;
		self.fAlphaArea = self.oGraph.oSettings['3d']?1:0.5;
		self.sStepStart = 'middle';
		self.bContourOnTop = true;
		self.aLPoints = [];
		self.bSmartSampling = false;
		self.bActiveArea = false;
		self.bInverted = false;
	},
	createPlotNode : function() {
		return new ZC.ZCAreaPlotNode(this);
	},
	parse : function() {
		var self = this;		
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		if (self.oGraph.oSettings['3d']) {
			self.sBackgroundColor1 = self.sBackgroundColor2 = self.aPalette[1];
		} else {
			self.sBackgroundColor1 = self.aPalette[0];
			self.sBackgroundColor2 = self.aPalette[1];
		}
		self.loadXPalette();
		self._super();
		self.assign_a([
			['alpha-area', 'fAlphaArea', 'f', 0, 1],
			['step-start', 'sStepStart'],
			['active-area', 'bActiveArea', 'b'],
			['contour-on-top', 'bContourOnTop', 'b'],
			['smart-sampling', 'bSmartSampling', 'b']
		]);
		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	paint : function() {
		var self = this, i, iLen, iLastIndex, iStep, iScaleCoord, aMP, oPrevNode, oNextNode, aPoint, oPlotArea, k;
		self._super();

		self.aLPoints = [];

		var bVArea = self.bInverted;

		if (ZC._indexof_(['segmented','spline','stepped'], self.sAspect) === -1) {
			self.sAspect = 'segmented';
		}

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		self._oCtxArea = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 1), self.oLoader.sOutput);
		self._oCtxLine = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', self.bContourOnTop?2:1), self.oLoader.sOutput);
		

		oPlotArea = self.oGraph.oPlotArea;

		if (!self.bFast || self.oGraph.oSettings['3d']) {

			
			var fMin = ZC.MAX, fMax = -ZC.MAX;
			for (i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
				if (self.aPlotNodes[i]) {
					fMin = ZC._min_(fMin, self.aPlotNodes[i].fAbsoluteValue);
					fMax = ZC._max_(fMax, self.aPlotNodes[i].fAbsoluteValue);
				}
			}
			
			var fMinY = self._oScaleVal.getCoordByValue(fMin), fMaxY = self._oScaleVal.getCoordByValue(fMax);
			var fRefY = self._oScaleVal.getCoordByValue(self._oScaleVal.fRefValue);
			
			
			if (ZC._btw_(fRefY, fMinY, fMaxY)) {
				if (self._oScaleVal.bMirrored) {
					if (fRefY < fMinY) {
						fMinY = fRefY;
					}
				} else {
					if (fRefY > fMaxY) {
						fMaxY = fRefY;
					}
				}
			}

			self.oAttributes['min-y'] = Math.min(fMinY, fMaxY);
			self.oAttributes['max-y'] = Math.max(fMinY, fMaxY);

			if (self.bStacked && self.oParent.aLastContour) {
				var fMinY_ = ZC.MAX, fMaxY_ = -ZC.MAX;
				for (i=0,iLen=self.oParent.aLastContour.length;i<iLen;i++) {
					if (self.oParent.aLastContour[i]) {
						for (var j=0,jLen=self.oParent.aLastContour[i].length;j<jLen;j++) {
							fMinY_ = ZC._min_(fMinY_, self.oParent.aLastContour[i][j][1]);
							fMaxY_ = ZC._max_(fMaxY_, self.oParent.aLastContour[i][j][1]);
						}
					}
				}
				if (self._oScaleVal.bMirrored) {
					self.oAttributes['min-y'] = fMinY_;
				} else {
					self.oAttributes['max-y'] = fMaxY_;
				}
			}

			
			if (self.oAttributes['max-y'] - self.oAttributes['min-y'] < 100) {
				self.oAttributes['max-y'] += 50;
				self.oAttributes['min-y'] -= 50;
			}

			self.paintNodes();
			self.aPoints = null;
			
			self.aPointsContour = null;
			self.aPointsArea = null;
			
		} else {
			self.prepareNodes();
			self.oCanvasSh = self.getCanvas('bl', 0);
			

			
			var bMarkers = true;
			if (
				(ZC._n_(self.oMarker.oData['visible']) !== null && !ZC._b_(self.oMarker.oData['visible']))
				||
				(ZC._n_(self.oParent.oData['type']) !== null && self.oMarker.oData['type'] === 'none')
			) {
				bMarkers = false;
			}

			var bStacked = self.bStacked && (self.oGraph.iStackingLogic === 0);

			var aPoints = [], aPointsArea = [], aPointsContour = [], aControlPoints = [], aXPoints = [];

			var fRefValue = self._oScaleVal.fRefValue;
			var iCoordRef = self._oScaleVal.getCoordByValue(fRefValue);
			if (bVArea) {
				iCoordRef = ZC._l_(iCoordRef, self._oScaleVal.iX, self._oScaleVal.iX + self._oScaleVal.iWidth);
			} else {
				iCoordRef = ZC._l_(iCoordRef, self._oScaleVal.iY, self._oScaleVal.iY + self._oScaleVal.iHeight);
			}

			var bFirstNode = true, iNodes_ = 0, oNode = null;
			iLastIndex = 0;
			var iMinIndex = -1, iMaxIndex = -1;

			var bErrors = self.oParent.aPlots[0].aErrors && self.oParent.aPlots[0].aErrors.length;

			var iStepOrig = self.iStep;

			

			var sAspect = self.sAspect;
			if (self.iStep > 1 && sAspect === 'spline') {
				sAspect = 'segmented';
			}

			if (self._oScaleKey.bKeyValues && self.bKeyValues) {
				iStep = self.iStep;
				for (i=0,iLen=self.aPlotNodes.length;i<iLen;i+=iStep) {
					if (iMaxIndex-i <= self.iStep) {
						iStep = ZC._max_(1, iMaxIndex-i);
					}
					if (self.aPlotNodes[i]) {
						if (
							self.oGraph.aKeyAssoc.length > 0
							||
							ZC._btw_(self.aPlotNodes[i].fKeyValue, self._oScaleKey.aValues[self._oScaleKey.iMinIndex], self._oScaleKey.aValues[self._oScaleKey.iMaxIndex])
							||
							(bFirstNode && self.aPlotNodes[i+iStep] && self.aPlotNodes[i+iStep].fKeyValue >= self._oScaleKey.aValues[self._oScaleKey.iMinIndex])
						) {
							if (bFirstNode && self.aPlotNodes[i-iStep]) {
								if (iMinIndex === -1) { iMinIndex = i-iStep; }
								iMaxIndex = i-iStep;
								bFirstNode = false;
								iNodes_++;
							}
							if (iMinIndex === -1) { iMinIndex = i; }
							iMaxIndex = i;
							iNodes_++;
							bFirstNode = false;
							iLastIndex = i;
						}
					}
				}
				if (iNodes_ > 0 && self.aPlotNodes[iLastIndex+iStep]) {
					if (iMinIndex === -1) { iMinIndex = iLastIndex+iStep; }
					iMaxIndex = iLastIndex+iStep;
					self.aPlotNodes[iLastIndex+iStep].bOnViewport = true;
				}
			} else {
				iMinIndex = self._oScaleKey.iMinIndex;
				iMaxIndex = self._oScaleKey.iMaxIndex;
			}

			self.iStep = iStepOrig;

			if (!bStacked) {
				if (self.oParent.aPointsContour) {
					aPointsArea = self.oParent.aPointsContour.reverse();
				}
			}

			var fLastValue = null, fSpikeDiff = 0, iSpikeStep = 1;
			iLastIndex = iMinIndex;
			if (bVArea) {
				if (iMaxIndex - iMinIndex > self.oGraph.oPlotArea.iHeight) {
					
					fSpikeDiff = (4/self.oGraph.oPlotArea.iWidth)*(self._oScaleVal.fMax - self._oScaleVal.fMin);
					
					iSpikeStep = ZC._i_((iMaxIndex - iMinIndex)/(4*self.oGraph.oPlotArea.iHeight));
				}
			} else {
				if (iMaxIndex - iMinIndex > self.oGraph.oPlotArea.iWidth) {
					
					fSpikeDiff = (4/self.oGraph.oPlotArea.iHeight)*(self._oScaleVal.fMax - self._oScaleVal.fMin);
					
					iSpikeStep = ZC._i_((iMaxIndex - iMinIndex)/(4*self.oGraph.oPlotArea.iWidth));
				}
			}

			var bFirst = false;
			var bNull = false;
			var iXStart = -1;
			
			iStep = self.iStep;

			bFirst = true;

			if (!self.oParent.oLastContour && bStacked) {
				self.oParent.oLastContour = {};
				self.oParent.oCurrentContour = {};
				for (i=0;i<=self.oParent.aKeys.length;i++) {
					if (ZC._n_(self.oParent.aKeys[i]) !== null) {
						if (!self._oScaleKey.bKeyValues) {
							iScaleCoord = ZC._i_(self._oScaleKey.getCoordByIndex(self.oParent.aKeys[i]));	
						} else {
							iScaleCoord = ZC._i_(self._oScaleKey.getCoordByValue(self.oParent.aKeys[i]));
						}
						self.oParent.oLastContour[iScaleCoord] = iCoordRef;
						self.oParent.oCurrentContour[iScaleCoord] = iCoordRef;
					}
				}
			}

			

			for (i=iMinIndex;i<=iMaxIndex;i+=iStep) {
				var bSkipSampling = false;
				if ((iMaxIndex-iMinIndex)%self.iStep !== 0 || (self._oScaleKey.bKeyValues && self.bKeyValues)) {
					if (iMaxIndex-i <= self.iStep) {
						iStep = ZC._max_(1, iMaxIndex-i);
						bSkipSampling = true;
					}
				}

				if (self.bSmartSampling) {
					if (!bSkipSampling) {
						if (self.aPlotNodes[i]) {
							if (ZC._n_(fLastValue) === null) {
								fLastValue = self.aPlotNodes[i].fAbsoluteValue;
								iLastIndex = i;
							} else {
								if (Math.abs(self.aPlotNodes[i].fAbsoluteValue - fLastValue) < fSpikeDiff && i-iLastIndex < iSpikeStep) {
									continue;
								} else {
									fLastValue = self.aPlotNodes[i].fAbsoluteValue;
									iLastIndex = i;
								}
							}
						}
					}
				}

				oNode = self.getNode(i);
				if (oNode) {
					
					if (self._bCreateAreaMap) {
						oNode.paint(true);
					}
						
					if (bNull || ((sAspect === 'segmented' || sAspect === 'stepped') && i === iMinIndex && aPointsArea.length === 0)) {
						if (!bStacked) {
							aPointsArea.push(bVArea?[iCoordRef, oNode.iY]:[oNode.iX, iCoordRef]);
							if (bNull) {
								aPointsContour.push(bVArea?[iCoordRef, oNode.iY]:[oNode.iX, iCoordRef]);
							}
						}
					}
					bNull = false;
					if (iXStart === -1) {
						iXStart = oNode.iX;
					}
					switch (sAspect) {
						
						default:
							if (!bStacked) {
								if (bFirst) {
									if (bVArea) {
										if (oNode.iY > self._oScaleKey.iY) {
											aPointsContour.push([iCoordRef, self._oScaleKey.iY]);
											aPointsContour.push([iCoordRef, oNode.iY]);
											aPointsArea.push([iCoordRef, oNode.iY]);
										}
									} else {
										if (oNode.iX > self._oScaleKey.iX) {
											aPointsContour.push([self._oScaleKey.iX, iCoordRef]);
											aPointsContour.push([oNode.iX, iCoordRef]);
											aPointsArea.push([oNode.iX, iCoordRef]);
										}
									}
									bFirst = false;	
								}
							}
							aPoints.push([oNode.iX, oNode.iY]);
							if (bStacked) {
								if (bVArea) {
									self.oParent.oCurrentContour[ZC._i_(oNode.iY)] = oNode.iX;
								} else {
									self.oParent.oCurrentContour[ZC._i_(oNode.iX)] = oNode.iY;
								}
							} else {
								aPointsContour.push([oNode.iX, oNode.iY]);
								aPointsArea.push([oNode.iX, oNode.iY]);
							}
							break;
						case 'spline':
							if (bVArea) {
								aControlPoints.push(oNode.iX);
								aXPoints.push(oNode.iY);
								if (aControlPoints.length === 1) {
									aControlPoints.push(oNode.iX);
									aXPoints.push(oNode.iY);
								}
							} else {
								aControlPoints.push(oNode.iY);
								aXPoints.push(oNode.iX);
								if (aControlPoints.length === 1) {
									aControlPoints.push(oNode.iY);
									aXPoints.push(oNode.iX);
								}
							}
							break;
						case 'stepped':
							var iPixel = self._oScaleKey.bMirrored?-1:1;
							switch (self.sStepStart) {
								
								default:
									oPrevNode = self.getNode(i-iStep, 0);
									if (oPrevNode) {
										oPrevNode.setup();
										aMP = ZC.ZCMath._mpoint_(self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY, oNode.iX, oNode.iY);
										aPoints.push(bVArea?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
										if (bStacked) {
											if (bVArea) {
												self.oParent.oCurrentContour[ZC._i_(aMP[1])-iPixel] = oNode.iX;
											} else {
												self.oParent.oCurrentContour[ZC._i_(aMP[0])+iPixel] = oNode.iY;
											}
										} else {
											aPointsContour.push(bVArea?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
											aPointsArea.push(bVArea?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
										}
									} 
									aPoints.push([oNode.iX, oNode.iY]);
									if (bStacked) {
										if (bVArea) {
											self.oParent.oCurrentContour[ZC._i_(oNode.iY)] = oNode.iX;
										} else {
											self.oParent.oCurrentContour[ZC._i_(oNode.iX)] = oNode.iY;
										}
									} else {
										aPointsContour.push([oNode.iX, oNode.iY]);
										aPointsArea.push([oNode.iX, oNode.iY]);
									}
									oNextNode = self.getNode(i+iStep, 0);
									if (oNextNode) {
										oNextNode.setup();
										aMP = ZC.ZCMath._mpoint_(oNode.iX, oNode.iY, self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY);
										aPoints.push(bVArea?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
										if (bStacked) {
											if (bVArea) {
												self.oParent.oCurrentContour[ZC._i_(aMP[1])+iPixel] = oNode.iX;
											} else {
												self.oParent.oCurrentContour[ZC._i_(aMP[0])-iPixel] = oNode.iY;
											}
										} else {
											aPointsContour.push(bVArea?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
											aPointsArea.push(bVArea?[oNode.iX, aMP[1]]:[aMP[0], oNode.iY]);
										}
									}
									break;
								case 'before':
									oPrevNode = self.getNode(i-iStep, 0);
									if (oPrevNode) {
										oPrevNode.setup();
										aPoints.push(
											[self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY],
											[self.aPlotNodes[i-iStep].iX, oNode.iY]
										);
										if (bStacked) {
											if (bVArea) {
												self.oParent.oCurrentContour[ZC._i_(oNode.iY)+iPixel] = self.aPlotNodes[i-iStep].iX;
												self.oParent.oCurrentContour[ZC._i_(oNode.iY)] = self.aPlotNodes[i-iStep].iX;
											} else {
												self.oParent.oCurrentContour[ZC._i_(self.aPlotNodes[i-iStep].iX)] = self.aPlotNodes[i-iStep].iY;
												self.oParent.oCurrentContour[ZC._i_(self.aPlotNodes[i-iStep].iX)+iPixel] = oNode.iY;
											}
										} else {
											aPointsContour.push(
												[self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY],
												[self.aPlotNodes[i-iStep].iX, oNode.iY]
											);
											aPointsArea.push(
												[self.aPlotNodes[i-iStep].iX, self.aPlotNodes[i-iStep].iY],
												[self.aPlotNodes[i-iStep].iX, oNode.iY]
											);
										}
									} 
									aPoints.push([oNode.iX, oNode.iY]);
									if (bStacked) {
										if (bVArea) {
											self.oParent.oCurrentContour[ZC._i_(oNode.iY)] = oNode.iX;
										} else {
											self.oParent.oCurrentContour[ZC._i_(oNode.iX)] = oNode.iY;
										}
									} else {
										aPointsContour.push([oNode.iX, oNode.iY]);
										aPointsArea.push([oNode.iX, oNode.iY]);
									}
									break;
								case 'after':
									aPoints.push([oNode.iX, oNode.iY]);
									if (bStacked) {
										if (bVArea) {
											self.oParent.oCurrentContour[ZC._i_(oNode.iY)] = oNode.iX;
										} else {
											self.oParent.oCurrentContour[ZC._i_(oNode.iX)] = oNode.iY;
										}
									} else {
										aPointsContour.push([oNode.iX, oNode.iY]);
										aPointsArea.push([oNode.iX, oNode.iY]);
									}
									oNextNode = self.getNode(i+iStep, 0);
									if (oNextNode) {
										oNextNode.setup();
										aPoints.push(
											[self.aPlotNodes[i+iStep].iX, oNode.iY],
											[self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY]
										);
										if (bStacked) {
											if (bVArea) {
												self.oParent.oCurrentContour[ZC._i_(oNode.iY)-iPixel] = self.aPlotNodes[i+iStep].iX;
												self.oParent.oCurrentContour[ZC._i_(self.aPlotNodes[i+iStep].iY)] = self.aPlotNodes[i+iStep].iX;
											} else {
												self.oParent.oCurrentContour[ZC._i_(self.aPlotNodes[i+iStep].iX)-iPixel] = oNode.iY;
												self.oParent.oCurrentContour[ZC._i_(self.aPlotNodes[i+iStep].iX)] = self.aPlotNodes[i+iStep].iY;
											}
										} else {
											aPointsContour.push(
												[self.aPlotNodes[i+iStep].iX, oNode.iY],
												[self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY]
											);
											aPointsArea.push(
												[self.aPlotNodes[i+iStep].iX, oNode.iY],
												[self.aPlotNodes[i+iStep].iX, self.aPlotNodes[i+iStep].iY]
											);
										}
									}
									break;
							}											
							break;
					}
					if (bErrors) {
						oNode.sharedErrors(ZC.ZCHtmlUtils._context_(self.getCanvas('fl', 0), self.oLoader.sOutput));
						
					}
					if ((self._bShowMarkers && bMarkers) || self._bCreateAreaMap) {
						oNode.sharedMarker();
					}
					oNode.bOnViewport = true;
				} else {
					aPoints.push(null);
					aControlPoints.push(null);
					aXPoints.push(null);
					if (!bStacked) {
						if (aPointsArea.length-1 >= 0) {
							aPointsArea.push(bVArea?[iCoordRef, aPointsArea[aPointsArea.length-1][1]]:[aPointsArea[aPointsArea.length-1][0], iCoordRef]);
						}
						if (aPointsContour.length-1 >= 0) {
							aPointsContour.push(bVArea?[iCoordRef, aPointsArea[aPointsArea.length-1][1]]:[aPointsArea[aPointsArea.length-1][0], iCoordRef]);
						}
						bNull = true;
					}
				}
			}
			if (sAspect === 'segmented' || sAspect === 'stepped') {
				if (!bStacked) {
					if (aPointsArea.length-1 >= 0) {
						if (bVArea) {
							aPointsArea.push([iCoordRef, aPointsArea[aPointsArea.length-1][1]]);
						} else {
							aPointsArea.push([aPointsArea[aPointsArea.length-1][0], iCoordRef]);
						}
					}
				}
			}
			if (sAspect === 'spline') {

				aControlPoints.push(aControlPoints[aControlPoints.length-1]);
				aXPoints.push(aXPoints[aXPoints.length-1]);

				aPoints = [];

				if (!bStacked) {
					aPointsArea.push(bVArea?[iCoordRef, aXPoints[0]]:[aXPoints[0], iCoordRef]);
				}

				for (var p=1;p<aControlPoints.length-1;p++) {
					var aControlPoints_ = [aControlPoints[p-1], aControlPoints[p], aControlPoints[p+1], aControlPoints[p+2]];
					var iXDiff = ZC._a_(aXPoints[p+1] - aXPoints[p]);
					var aSplinePoints = ZC.ZCMath._spline_(self.bMonotone, aControlPoints_, iXDiff);

					for (i=0;i<aSplinePoints.length;i++) {
						if (ZC._n_(aSplinePoints[i][0]) !== null && ZC._n_(aSplinePoints[i][1]) !== null) {
							if (bVArea) {
								aPoint = [aSplinePoints[i][1], aXPoints[p] + (self._oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff];
							} else {
								aPoint = [aXPoints[p] + (self._oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]];
							}
							aPoints.push(aPoint);
							if (bStacked) {
								if (bVArea) {
									self.oParent.oCurrentContour[ZC._i_(aPoint[1])] = aPoint[0];
								} else {
									self.oParent.oCurrentContour[ZC._i_(aPoint[0])] = aPoint[1];
								}
							} else {
								aPointsArea.push(aPoint);
								aPointsContour.push(aPoint);
							}
						} else {
							aPoints.push(null);
						}
					}
				}
				if (!bStacked) {
					aPointsArea.push(bVArea?[iCoordRef, aPointsArea[aPointsArea.length-1][1]]:[aPointsArea[aPointsArea.length-1][0], iCoordRef]);
				}
			}

			if (!bStacked) {
				if (aPointsContour.length > 0) {
					var aLast = aPointsContour[aPointsContour.length-1];
					if (!bVArea) {
						if (aLast[0] < self._oScaleKey.iX + self._oScaleKey.iWidth) {
							aPointsContour.push(bVArea?[iCoordRef, aLast[1]]:[aLast[0], iCoordRef]);
							aPointsContour.push(bVArea?[iCoordRef, self._oScaleKey.iY]:[self._oScaleKey.iX + self._oScaleKey.iWidth, iCoordRef]);
						}						
					}
				}
			}

			if (bStacked) {
				
				var aPointsArea1 = [], aPointsArea2 = [];
				
				for (k in self.oParent.oCurrentContour) {
					if (bVArea) {
						aPointsArea1.push([self.oParent.oCurrentContour[k], k]);
					} else {
						aPointsArea1.push([k, self.oParent.oCurrentContour[k]]);
					}
				}
				for (k in self.oParent.oLastContour) {
					if (bVArea) {
						aPointsArea2.push([self.oParent.oLastContour[k], k]);
					} else {
						aPointsArea2.push([k, self.oParent.oLastContour[k]]);
					}
				}
				aPointsArea = aPointsArea1.concat(aPointsArea2.reverse());
				if (aPointsArea[0]) {
					aPointsArea.push(aPointsArea[0]);
				}

				self.oParent.oLastContour = {};
				for (k in self.oParent.oCurrentContour) {
					self.oParent.oLastContour[k] = self.oParent.oCurrentContour[k];
				}
			}

			var oArea = new ZC.ZCShape(self);
			oArea.copy(self);
			oArea.fAlpha = self.fAlphaArea;
			oArea.bPixelCorrection = true;
			oArea.bAreaCorrection = true;
			oArea.iLineWidth = 0;
			oArea.iBorderWidth = 0;
			oArea.iLineSegmentSize = 0;
			oArea.iLineGapSize = 0;
			oArea.iFillAngle = self.bInverted?180:90;
			oArea.oCanvas = self.getCanvas('bl', self.oGraph.bStacked?0:1);
			
			oArea.aPoints = aPointsArea;
			oArea.getBounds();
			oArea.sId = self.sId + '-area';
			oArea.paint();

			self.bPixelCorrection = false;
			ZC.ZCLine.setup(self._oCtxLine, self);
			ZC.ZCLine.paint(self._oCtxLine, self, aPoints);

			
			if (self.oGraph.oPreview && self.oGraph.oPreview.bInit && self.bPreview) {
				var oPreview = self.oGraph.oPreview;

				var aPointsAreaPreview = self.mapPointsToPreview(aPointsArea);

				var oAreaPreview = new ZC.ZCShape(self.oParent);
				oAreaPreview.copy(self);
				oAreaPreview.bPixelCorrection = true;
				oAreaPreview.bAreaCorrection = true;
				oAreaPreview.iLineWidth = 0;
				oAreaPreview.iBorderWidth = 0;
				oAreaPreview.iLineSegmentSize = 0;
				oAreaPreview.iLineGapSize = 0;
				oAreaPreview.fAlpha = self.fAlphaArea;
				oAreaPreview.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
				oAreaPreview.sId = self.sId + '-area-preview';
				oAreaPreview.oCanvas = oPreview.oCanvas;
				oAreaPreview.aPoints = aPointsAreaPreview;
				oAreaPreview.paint();

				var aPointsPreview = self.mapPointsToPreview(aPoints);

				var oCtxPreview = ZC.ZCHtmlUtils._context_(oPreview.oCanvas, self.oLoader.sOutput);
				var oStyleP = new ZC.ZCStyle(self);
				oStyleP.copy(self);
				oStyleP.iLineWidth = 1;
				
				ZC.ZCLine.paint(oCtxPreview, oStyleP, aPointsPreview, null, 3);
				
			}

			if (self.bStacked) {
				self.oParent.aPointsContour = aPointsContour;
			}

		}

	}
});










ZC.ZCBarPlot = ZC.ZCXYPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'bar';
		self.iBarSpace = 0.1;
		self.iBarWidth = 0;
		self.iBarsSpaceLeft = 0.07;
		self.iBarsSpaceRight = 0.07;
		self.iBarsOverlap = 0;
		self.bShowZero = false;
		self.aOffsetValues = [];
		self.sColorDef = 'bg';
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.sBorderColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[1];
		self.sBackgroundColor2 = self.aPalette[2];
		self.loadXPalette();
		self._super();
		if (self.sAspect === 'histogram') {
			self.iBarSpace = self.iBarsSpaceLeft = self.iBarsSpaceRight = 0;
		}
		self.assign_a([
			['show-zero', 'bShowZero', 'b'],
			['offset-values', 'aOffsetValues'],
			['bar-space', 'iBarSpace', 'fp'],
			['bar-width', 'iBarWidth', 'fp'],
			['bars-space-left', 'iBarsSpaceLeft', 'fp'],
			['bars-space-right', 'iBarsSpaceRight', 'fp'],
			['bars-overlap', 'iBarsOverlap', 'fp']
		]);

		
		if (self.iBarSpace === 0 && self.iBarsSpaceLeft === 0 && self.iBarsSpaceRight === 0) {
			self.bRectShortcut = false;
		}

		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	sharedBarDimensions : function() {
		var self = this;

		if (self.oBarDimensions) {
			return self.oBarDimensions;
		}

		var iStepSize = self._oScaleKey.iStepSize * self.iStep;
		var iBarIndex = self.iIndex;
		var iBarGroups = 0;

		for (var i=0;i<self.oParent.aBarGroups[self.sType].length;i++) {
			
			var iFirstPlot = self.oParent.aBarGroups[self.sType][i][0];
			if (self.oParent.aPlots[iFirstPlot].aScales[0] === self.aScales[0]) {
				iBarGroups++;
			}
			if (ZC._indexof_(self.oParent.aBarGroups[self.sType][i], self.iIndex) !== -1) {
				iBarIndex = i;
			}
		}

		

		
		var bForcedWidths = true, iTotalBarsWidth = 0, aStacksUsed = [];
		for (var p=0;p<self.oParent.aPlots.length;p++) {
			if (self.oParent.aPlots[p].iBarWidth <= 1) {
				bForcedWidths = false;
			} else {
				if (ZC._n_(self.oParent.aPlots[p].iBarWidth) !== null) {
					if (!self.oParent.aPlots[p].bStacked || ZC._indexof_(aStacksUsed, self.oParent.aPlots[p].iStack) === -1) {
						aStacksUsed.push(self.oParent.aPlots[p].iStack);
						iTotalBarsWidth += self.oParent.aPlots[p].iBarWidth;
					}
				}
			}
		}

		var iBarsSpaceLeft = self.iBarsSpaceLeft;
		if (iBarsSpaceLeft <= 1) {
			iBarsSpaceLeft *= iStepSize;
		}
		var iBarsSpaceRight = self.iBarsSpaceRight;
		if (iBarsSpaceRight <= 1) {
			iBarsSpaceRight *= iStepSize;
		}
		iBarsSpaceLeft = ZC._i_(iBarsSpaceLeft);
		iBarsSpaceRight = ZC._i_(iBarsSpaceRight);
		var iBarsWidth;
		if (bForcedWidths) {
			iBarsWidth = iTotalBarsWidth;
			iBarsSpaceLeft = iBarsSpaceRight = (iStepSize - iBarsWidth)/2;
		} else {
			iBarsWidth = iStepSize - iBarsSpaceLeft - iBarsSpaceRight;
		}
		if (iBarsWidth < 1) {
			
			iBarsWidth = iStepSize*0.8;
			iBarsSpaceLeft = iStepSize*0.1;
			iBarsSpaceRight = iStepSize*0.1;
		}
		var iBarSpace = self.iBarSpace;
		if (self.iBarSpace !== 0) {
			if (iBarSpace <= 1) {
				iBarSpace *= iBarsWidth;
			}
			if (iBarGroups > 1) {
				iBarSpace /= iBarGroups-1;
			}
			iBarSpace = ZC._max_(1, iBarSpace);
		}
		var iBarWidth = iBarsWidth;
		var iBarsOverlap = self.iBarsOverlap;
		if (iBarsOverlap !== 0) {
			iBarSpace = 0;
		}

		if (iBarGroups > 1) {
			if (iBarsOverlap > 1) {
				iBarWidth = (iBarsWidth-(iBarGroups-1)*iBarSpace+(iBarGroups-1)*iBarsOverlap)/iBarGroups;
			} else {
				iBarWidth = (iBarsWidth-(iBarGroups-1)*iBarSpace)/(iBarGroups-(iBarGroups-1)*iBarsOverlap);
				iBarsOverlap *= iBarWidth;
			}
		}
		iBarWidth = ZC._l_(iBarWidth, 1, iBarsWidth);

		if (iBarsOverlap === 0) {
			if (iBarWidth*iBarGroups + iBarSpace*(iBarGroups-1) + iBarsSpaceLeft + iBarsSpaceRight - iBarsOverlap > iStepSize) {
				var p = 0.1;
				iBarWidth = (iStepSize - iBarsSpaceLeft - iBarsSpaceRight)/((1+p)*iBarGroups);
				iBarSpace = iBarWidth*p;
				if (iBarSpace < 1) {
					iBarSpace = 1;
					iBarWidth = (iStepSize - iBarsSpaceLeft - iBarsSpaceRight - iBarGroups)/iBarGroups;
				}
			}
		}

		iBarWidth = ZC._max_(1.01, iBarWidth);

		
		self.oBarDimensions = {
			iStepSize : iStepSize,
			iBarIndex : iBarIndex,
			iBarsSpaceLeft : iBarsSpaceLeft,
			iBarsSpaceRight : iBarsSpaceRight,
			iBarSpace : iBarSpace,
			iBarWidth : iBarWidth,
			iBarsOverlap : iBarsOverlap
		};

		return {
			iStepSize : iStepSize,
			iBarIndex : iBarIndex,
			iBarsSpaceLeft : iBarsSpaceLeft,
			iBarsSpaceRight : iBarsSpaceRight,
			iBarSpace : iBarSpace,
			iBarWidth : iBarWidth,
			iBarsOverlap : iBarsOverlap
		};
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self.paintNodes();

		self.oBarDimensions = null;

	}
});









ZC.ZCVBarPlot = ZC.ZCBarPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vbar';
	},
	createPlotNode : function() {
		return new ZC.ZCVBarPlotNode(this);
	}
});









ZC.ZCHBarPlot = ZC.ZCBarPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbar';
	},
	createPlotNode : function() {
		return new ZC.ZCHBarPlotNode(this);
	}
});









ZC.ZCScatterPlot = ZC.ZCXYPlot.extend({
	init : function(oParent, sType) {
		this._super(oParent);
		this.sType = sType || 'scatter';
		this.sColorDef = 'markerbg';
		this.bPoly = false;
		this.fAlphaArea = 0.5;
	},
	createPlotNode : function() {
		return new ZC.ZCScatterPlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sBackgroundColor1 = self.aPalette[1];
		self.sBackgroundColor2 = self.aPalette[1];
		self.sLineColor = self.aPalette[2];
		self.sBorderColor = self.aPalette[2];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['alpha-area', 'fAlphaArea', 'f', 0, 1]
		]);
		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	paint : function() {
		var self = this, aPoints, i, iLen;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		self._oCtxNode = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 0), self.oLoader.sOutput);
		

		self.paintNodes(true);

		if (self.bPoly) {

			aPoints = [];
			for (i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
				aPoints.push([self.aPlotNodes[i].iX, self.aPlotNodes[i].iY]);
			}
			if (aPoints.length) {
				aPoints.push(aPoints[0]);
			}

			var oArea = new ZC.ZCShape(self);
			oArea.copy(self);
			oArea.fAlpha = self.fAlphaArea;
			oArea.bPixelCorrection = true;
			oArea.bAreaCorrection = true;
			oArea.iLineWidth = 0;
			oArea.iBorderWidth = 0;
			oArea.iLineSegmentSize = 0;
			oArea.iLineGapSize = 0;
			oArea.oCanvas = self._oCanvasNode;
			
			oArea.aPoints = aPoints;
			oArea.getBounds();
			oArea.sId = self.sId + '-area';
			oArea.paint();

			self.bPixelCorrection = false;
			ZC.ZCLine.setup(self._oCtxNode, self);
			ZC.ZCLine.paint(self._oCtxNode, self, aPoints);
		}
	}
});










ZC.ZCBubblePlot = ZC.ZCXYPlot.extend({
	init : function(oParent, sType) {
		this._super(oParent);
		this.sType = sType || 'bubble';
		this.iMaxSize = null;
		this.iSizingGroup = 1;
		this.fSizeFactor = 1;
		this.sScaling = 'area';
		this.sColorDef = 'markerbg';
	},
	createPlotNode : function() {
		return new ZC.ZCBubblePlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sBackgroundColor1 = self.aPalette[2];
		self.sBackgroundColor2 = self.aPalette[1];
		self.sLineColor = self.aPalette[2];
		self.sBorderColor = self.aPalette[2];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['max-size', 'iMaxSize', 'i'],
			['scaling', 'sScaling'],
			['sizing-group', 'iSizingGroup', 'i'],
			['size-factor', 'fSizeFactor', 'f']
		]);
		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);

		if (ZC._n_(self.iMaxSize) === null) {
			self.iMaxSize = Math.max(2, Math.min(self._oScaleKey.iWidth, self._oScaleKey.iHeight, self._oScaleVal.iWidth, self._oScaleVal.iHeight)/2);
		}

	},
	getSize : function(fValue) {
		var self = this;
		var iSize = null;
		
		iSize = fValue*self.iMaxSize/self._iMaxValueSize;
		switch (self.sScaling) {
			case 'radius':
				iSize = iSize/2;
				break;
			case 'sqrt':
				iSize = Math.sqrt(iSize);
				break;
			case 'area':
				iSize = iSize/(2*Math.PI);
				break;
		}
		return ZC._max_(3, iSize);
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		if (ZC._n_(self.iMaxSize) !== null) {
			self.iMaxSize = ZC._max_(3, self.iMaxSize);
			self._iMaxValueSize = -ZC.MAX;
			self._iMinValueSize = ZC.MAX;
			var aPlots = self.oParent.aPlots;
			for (var p=0,pLen=aPlots.length;p<pLen;p++) {
				if (aPlots[p].iSizingGroup === self.iSizingGroup) {
					for (var i=0,iLen=aPlots[p].aPlotNodes.length;i<iLen;i++) {
						
						self._iMaxValueSize = ZC._max_(self._iMaxValueSize, ZC._a_(aPlots[p].aPlotNodes[i].fSizeValue));
						self._iMinValueSize = ZC._min_(self._iMinValueSize, ZC._a_(aPlots[p].aPlotNodes[i].fSizeValue));
					}
				}
			}
		}

		self.paintNodes(true);
	}
});










ZC.ZCPiePlot = ZC.ZCPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'pie';
		self.aScales = ['scale', 'scale-v', 'scale-r'];
		self.iSlice = 0;
		self.iRefAngle = 0;
		self.bDetach = true;
		self.oValueBoxConnector = null;
		self.sColorDef = 'bg';
	},
	createPlotNode : function() {
		return new ZC.ZCPiePlotNode(this);
	},
	parse : function() {
		var self = this, mValue, mValue_;
		if (ZC._n_(self.oData['value-box']) === null) {
			self.oData['value-box'] = {};
		}
		if (self.oParent.oParent.oData['type'] === 'ring' || self.oParent.oParent.oData['type'] === 'ring3d') {
		    self.iSlice = 0.35;
		}
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sBackgroundColor1 = self.aPalette[1];
		self.sBackgroundColor2 = self.aPalette[2];
		self.sBorderColor = self.aPalette[0];
		self.sLineColor = self.aPalette[0];
		self.loadXPalette();
		self._super();
		self.oValueBoxConnector = new ZC.ZCStyle(self);
		self.oGraph.oParent.oDefaults.load(self.oValueBoxConnector.oData, [
			'graph.plot.value-box.connector',
			self.sType + '.plot.value-box.connector'
		]);
		if (ZC._n_(mValue=self.oGraph.oData['plot']) !== null) {
			if (ZC._n_(mValue['value-box']) !== null && ZC._n_(mValue_=mValue['value-box']['connector']) !== null) {
				self.oValueBoxConnector.append(mValue_);
			}
		}
		self.oValueBoxConnector.append(self.oData['value-box']['connector']);
		self.assign_a([
			['offset', 'iOffsetR', 'fp'], 
			['slice', 'iSlice', 'fp'],
			['detach', 'bDetach', 'b'],
			['ref-angle', 'iRefAngle', 'i']
		]);
		self.iRefAngle %= 360;

		for (var i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
			if (self.aPlotNodes[i]) {
				self.aPlotNodes[i].iPieSlice = self.iSlice;
				if (self.aPlotNodes[i] && (self.oGraph.oAttributes['plot'+self.iIndex+'.visible'] || self.oGraph.getToggleAction() === 'hide')) {
					if (ZC._n_(self.oParent.aTotals[i]) === null) {
						self.oParent.aTotals[i] = 0;
					}
					self.oParent.aTotals[i] += ZC._f_(self.aPlotNodes[i].fValue);
				}
			}
		}

	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self.paintNodes(true);

	}
});










ZC.ZCNestedPiePlot = ZC.ZCPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'nestedpie';
		self.aScales = ['scale'];
		self.iSliceStart = 0;
		self.iBandSpace = 0;
		self.iRefAngle = 0;
		self.oValueBoxConnector = null;
		self.sColorDef = 'bg';
	},
	createPlotNode : function() {
		return new ZC.ZCNestedPiePlotNode(this);
	},
	parse : function() {
		var self = this, mValue, mValue_;
		if (ZC._n_(self.oData['value-box']) === null) {
			self.oData['value-box'] = {};
		}
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sBackgroundColor1 = self.aPalette[1];
		self.sBackgroundColor2 = self.aPalette[2];
		self.sBorderColor = self.aPalette[0];
		self.sLineColor = self.aPalette[0];
		self.loadXPalette();
		self._super();
		self.oValueBoxConnector = new ZC.ZCStyle(self);
		self.oGraph.oParent.oDefaults.load(self.oValueBoxConnector.oData, [
			'graph.plot.value-box.connector',
			self.sType + '.plot.value-box.connector'
		]);
		if (ZC._n_(mValue=self.oGraph.oData['plot']) !== null) {
			if (ZC._n_(mValue['value-box']) !== null && ZC._n_(mValue_=mValue['value-box']['connector']) !== null) {
				self.oValueBoxConnector.append(mValue_);
			}
		}
		self.oValueBoxConnector.append(self.oData['value-box']['connector']);
		self.assign_a([
			['slice-start', 'iSliceStart', 'fp'],
			['offset', 'iSliceStart', 'fp'],
			['band-space', 'iBandSpace', 'fp'],
			['ref-angle', 'iRefAngle', 'i']
		]);
		self.iRefAngle %= 360;
		for (var i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
			if (self.aPlotNodes[i] && (self.oGraph.oAttributes['plot'+self.iIndex+'.visible'] || self.oGraph.getToggleAction() === 'hide')) {
				if (ZC._n_(self.oParent.aTotals[i]) === null) {
					self.oParent.aTotals[i] = 0;
				}
				self.oParent.aTotals[i] += ZC._f_(self.aPlotNodes[i].fValue);
			}
		}
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self.paintNodes(true);
	}
});










ZC.ZCRadarPlot = ZC.ZCPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'radar';
		self.iBackLayers = 3;
		self.aScales = ['scale-k', 'scale-v', 'scale'];
		self.fAlphaArea = 0.5;
		self.sAspect = 'line';
		self.fAngleSpace = null;
		self.aPoints = [];
		self.aPointsArea = [];
	},
	createPlotNode : function() {
		return new ZC.ZCRadarPlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[3];
		self.sBackgroundColor2 = self.aPalette[3];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['alpha-area', 'fAlphaArea', 'f', 0, 1],
			['angle-space', 'fAngleSpace', 'f']
		]);
		
		self._oScaleKey = self.oGraph.getScaleByName('scale-k');
		self._oScaleVal = self.oGraph.getScaleByName('scale-v');
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = ZC._id_(self.oGraph.sId + '-plot-' + self.iIndex + '-bl-0-c');
		self._oCtxArea = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 0), self.oLoader.sOutput);
		self._oCtxLine = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 2), self.oLoader.sOutput);
		

		self.paintNodes(true);

	}
});









ZC.ZCBulletPlot = ZC.ZCBarPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.iBarSpace = 0.2;
		self.iBarsSpaceLeft = 0.28;
		self.iBarsSpaceRight = 0.28;
		self.iBarsOverlap = 0;
		self.oGoal = null;
		self.aGoals = [];
		self.aNumericGoals = [];
		self.bExtraValues = true;
		self.sColorDef = 'bg';
	},
	getElementData : function(sElement) {
		var self = this, mValue;
		if (sElement === 'goal') {
			if (ZC._n_(mValue=self.oGoal.oData['tooltip']) !== null) {
				return mValue;
			}
			if (ZC._n_(mValue=self.oGoal.oData['tooltip-text']) !== null) {
				return { text : mValue };
			}
		}
		return {};
	},
	parse : function() {
		var self = this, mValue;
		self._super();
		if (ZC._n_(self.aGoals=self.oData['goals']) !== null) {
			for (var i=0,iLen=self.aGoals.length;i<iLen;i++) {
				if (typeof(self.aGoals[i]) === 'string') {
					self.aNumericGoals[i] = ZC._indexof_(self.oGraph.aValAssoc, self.aGoals[i]);
				} else {
					self.aNumericGoals[i] = ZC._f_(self.aGoals[i]);
				}
			}
		}
		self.oGoal = new ZC.ZCBox(self);
		self.oGoal.copy(self);
		
		self.oGoal.oData['tooltip-text'] = '%node-goal-value';
		if (ZC._n_(mValue=self.oData['goal']) !== null) {
			self.oLoader.oDefaults.load(self.oGoal.oData, [
				'(' + self.sType + ').plot.goal'
			], true, true);
			self.oGoal.append(mValue);
		}
		self.oGoal.parse();
	}
});









ZC.ZCVBulletPlot = ZC.ZCBulletPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vbullet';
	},
	createPlotNode : function() {
		return new ZC.ZCVBulletPlotNode(this);
	}
});









ZC.ZCHBulletPlot = ZC.ZCBulletPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbullet';
	},
	createPlotNode : function() {
		return new ZC.ZCHBulletPlotNode(this);
	}
});










ZC.ZCPianoPlot = ZC.ZCXYPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'piano';
		self.sAspect = 'alpha';
		self.sReference = 'plot-max';
		self.fMinRatio = 0.2;
		self.fMaxRatio = 1;
		self.sColorDef = 'bg';
	},
	createPlotNode : function() {
		return new ZC.ZCPianoPlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.sBorderColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[2];
		self.sBackgroundColor2 = self.aPalette[1];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['min-ratio', 'fMinRatio', 'f', 0, 1],
			['max-ratio', 'fMaxRatio', 'f', 0, 1],
			['reference', 'sReference', '']
		]);
		if (self.fMinRatio >= self.fMaxRatio) {
			self.fMinRatio = 0.2;
			self.fMaxRatio = 1;
		}
		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self._iPlotMax = self._iChartMax = -ZC.MAX;
		self._iPlotMin = self._iChartMin = ZC.MAX;
		self._iPlotTotal = self._iChartTotal = 0;

		for (var p=0,pLen=self.oParent.aPlots.length;p<pLen;p++) {
			var oPlot = self.oParent.aPlots[p];
			for (var n=0,nLen=oPlot.aPlotNodes.length;n<nLen;n++) {
				if (oPlot.aPlotNodes[n]) {
					var fValue = ZC._f_(oPlot.aPlotNodes[n].fValue);
					if (oPlot.iIndex === self.iIndex) {
						self._iPlotMax = ZC._max_(self._iPlotMax, fValue);
						self._iPlotMin = ZC._min_(self._iPlotMin, fValue);
						self._iPlotTotal += fValue;
					}
					self._iChartMax = ZC._max_(self._iChartMax, fValue);
					self._iChartMin = ZC._min_(self._iChartMin, fValue);
					self._iChartTotal += fValue;
				}
			}
		}

		

		self.paintNodes(true);
	}
});










ZC.ZCFunnelPlot = ZC.ZCXYPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.iSpaceEntry = 0.1;
		self.iSpaceExit = 0.1;
		self.iMinExit = 0;
		self.sStartWidth = 'dynamic';
		self.aEntry = [];
		self.aExit = [];
		self.sColorDef = 'bg';
	},
	parse : function() {
		var self = this, i, iLen, aEntry, aExit;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.sBorderColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[2];
		self.sBackgroundColor2 = self.aPalette[1];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['start-width', 'sStartWidth'],
			['min-exit', 'iMinExit', 'fp'],
			['space-entry', 'iSpaceEntry', 'fp'],
			['space-exit', 'iSpaceExit', 'fp'],
			['offset', 'iSpaceEntry', 'fp'],
			['offset', 'iSpaceExit', 'fp']
		]);
		if (ZC._n_(aEntry=self.oData['entry']) !== null) {
			if (!(aEntry instanceof Array)) {
				aEntry = [aEntry];
			}
			for (i=0,iLen=aEntry.length;i<iLen;i++) {
				var oEntry = new ZC.ZCShape(self);
				oEntry.oData = aEntry[i];
				oEntry.parse();
				self.aEntry.push(oEntry);
			}
		}
		if (ZC._n_(aExit=self.oData['exit']) !== null) {
			if (!(aExit instanceof Array)) {
				aExit = [aExit];
			}
			for (i=0,iLen=aExit.length;i<iLen;i++) {
				var oExit = new ZC.ZCShape(self);
				oExit.oData = aExit[i];
				oExit.parse();
				self.aExit.push(oExit);
			}
		}

		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self.paintNodes();
	}
});









ZC.ZCVFunnelPlot = ZC.ZCFunnelPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vfunnel';
	},
	createPlotNode : function() {
		return new ZC.ZCVFunnelPlotNode(this);
	}
});









ZC.ZCHFunnelPlot = ZC.ZCFunnelPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hfunnel';
	},
	createPlotNode : function() {
		return new ZC.ZCHFunnelPlotNode(this);
	}
});









ZC.ZCStockPlot = ZC.ZCBarPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'stock';
		self.sAspect = 'candlestick';
		self.oStyleCache = {
			size : 0
		};
		self.sColorDef = 'bg';
	},
	createPlotNode : function() {
		return new ZC.ZCStockPlotNode(this);
	},
	parse : function() {
		var self = this;
		self._super();
	}
});










ZC.ZCGaugePlot = ZC.ZCPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'gauge';
		self.iBackLayers = 3;
		self.aScales = ['scale-r', 'scale-v', 'scale'];
		self.fAlphaArea = 0.5;
		
		self.aIndicator = [10, 0, 0, 180, 0, 180];
		self.sColorDef = 'bg';
	},
	createPlotNode : function() {
		return new ZC.ZCGaugePlotNode(this);
	},
	parse : function() {
		var self = this, mValue;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[3];
		self.sBackgroundColor2 = self.aPalette[3];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['alpha-area', 'fAlphaArea', 'f', 0, 1],
			['indicator', 'aIndicator']
		]);
		if (ZC._n_(mValue=self.oData['csize']) !== null) {
			self.aIndicator[0] = ZC._i_(mValue);
		}
		self.aIndicator = [
			ZC._i_(self.aIndicator[0] || '10'),
			ZC._i_(self.aIndicator[1] || '0'),
			ZC._i_(self.aIndicator[2] || '0'),
			ZC._i_(self.aIndicator[3] || '180'),
			ZC._i_(self.aIndicator[4] || '0'),
			ZC._i_(self.aIndicator[5] || '180')
		];
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self.paintNodes(true);
	}
});









ZC.ZCRangePlot = ZC.ZCXYPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'range';
		self.iStep = 1;
		self.sAspect = 'segmented';
		self.iBackLayers = 3;
		self.fAlphaArea = 0.5;
	},
	createPlotNode : function() {
		return new ZC.ZCRangePlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sLineColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[0];
		self.sBackgroundColor2 = self.aPalette[1];
		self.loadXPalette();
		self._super();
		self.assign('alpha-area', 'fAlphaArea', 'f', 0, 1);
		
		self._oScaleKey = self.oGraph.getScaleByName(self.getScales('k')[0]);
		self._oScaleVal = self.oGraph.getScaleByName(self.getScales('v')[0]);
	},
	paintNodes : function() {
		var self = this, i, iLen;

		self.prepareNodes(false);

		var oPlotArea = self.oGraph.oPlotArea;
		self.iStep = 1;
		if (!self._oScaleKey.bKeyValues) {
			if (!self.bExact && (self._oScaleKey.iMaxIndex-self._oScaleKey.iMinIndex)*5 > oPlotArea.iWidth) {
				self.iStep = ZC._i_((self._oScaleKey.iMaxIndex-self._oScaleKey.iMinIndex)*5/oPlotArea.iWidth);
			}
			
		}
		if (self._oScaleKey.bKeyValues) {
			for (i=0,iLen=self.aPlotNodes.length;i<iLen;i++) {
				if (
					self.aPlotNodes[i]
					&&
					ZC._btw_(self.aPlotNodes[i].fKeyValue, self._oScaleKey.aValues[self._oScaleKey.iMinIndex], self._oScaleKey.aValues[self._oScaleKey.iMaxIndex])
				) {
					self.aPlotNodes[i].oCanvas = self._oCanvasNode;
					self.aPlotNodes[i].sSet = 'min';
					self.aPlotNodes[i].paint();
					self.aPlotNodes[i].sSet = 'max';
					self.aPlotNodes[i].paint();
				}
			}
		} else {
			for (i=self._oScaleKey.iMinIndex;i<=self._oScaleKey.iMaxIndex;i+=self.iStep) {
				if (self.aPlotNodes[i]) {
					self.aPlotNodes[i].sSet = 'min';
					self.aPlotNodes[i].paint();
					self.aPlotNodes[i].sSet = 'max';
					self.aPlotNodes[i].paint();
				}
			}
		}
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		self._oCtxArea = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 1), self.oLoader.sOutput);
		self._oCtxLine = ZC.ZCHtmlUtils._context_(self.getCanvas('bl', 2), self.oLoader.sOutput);
		

		self.paintNodes();

		self.aPoints = null;
		self.aPointsContour = null;
	}
});










ZC.ZCPie3DPlot = ZC.ZCPiePlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'pie3d';
		
		self.iThickness = -1;
	},
	parse : function() {
		var self = this;
		self._super();
		self.assign_a([
			
			['thickness', 'iThickness', 'ia']
		]);
	},
	createPlotNode : function() {
		return new ZC.ZCPie3DPlotNode(this);
	}
});









ZC.ZCVBar3DPlot = ZC.ZCVBarPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'vbar3d';
	},
	createPlotNode : function() {
		return new ZC.ZCVBar3DPlotNode(this);
	},
	parse : function() {
		var self = this;
		self._super();
		if (ZC._n_(self.oData['border-color']) === null) {
			self.sBorderColor = self.aPalette[0];
		}
		if (ZC._n_(self.oData['line-color']) === null) {
			self.sLineColor = self.aPalette[0];
		}
	}
});









ZC.ZCHBar3DPlot = ZC.ZCHBarPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'hbar3d';
	},
	createPlotNode : function() {
		return new ZC.ZCHBar3DPlotNode(this);
	},
	parse : function() {
		var self = this;
		self._super();
		if (ZC._n_(self.oData['border-color']) === null) {
			self.sBorderColor = self.aPalette[0];
		}
		if (ZC._n_(self.oData['line-color']) === null) {
			self.sLineColor = self.aPalette[0];
		}
	}
});









ZC.ZCLine3DPlot = ZC.ZCLinePlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'line3d';
	},
	createPlotNode : function() {
		return new ZC.ZCLine3DPlotNode(this);
	},
	parse : function() {
		var self = this;
		self._super();
		if (ZC._n_(self.oData['border-color']) === null) {
			self.sBorderColor = self.aPalette[1];
		}
	}
});









ZC.ZCArea3DPlot = ZC.ZCAreaPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'area3d';
	},
	createPlotNode : function() {
		return new ZC.ZCArea3DPlotNode(this);
	},
	parse : function() {
		var self = this;
		self._super();
		if (ZC._n_(self.oData['border-color']) === null) {
			self.sBorderColor = self.aPalette[1];
		}
	}
});










ZC.ZCVennPlot = ZC.ZCPlot.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'venn';
		self.aJoin = [];
		self.aShare = [];
		self.aScales = ['scale'];
		self.sColorDef = 'bg';
	},
	createPlotNode : function() {
		return new ZC.ZCVennPlotNode(this);
	},
	parse : function() {
		var self = this;
		self.aPalette = self.loadPalette();
		self.sColor = self.aPalette[0];
		self.sBorderColor = self.aPalette[1];
		self.sBackgroundColor1 = self.aPalette[3];
		self.sBackgroundColor2 = self.aPalette[3];
		self.loadXPalette();
		self._super();
		self.assign_a([
			['join', 'aJoin'],
			['share', 'aShare']
		]);
	},
	paint : function() {
		var self = this;
		self._super();

		
		self._oCanvasNode = self.getCanvas('bl', 0);
		

		self.paintNodes(true);

	}
});











ZC.ZCPlotNode = ZC.ZCTextBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oGraph = oParent.oParent.oParent;
		self.oLoader = self.oGraph.oParent;
		self.iIndex = -1;
		self.fValue = null;
		self.aExtraValues = [];
		self.fAbsoluteValue = null;
		self.fKeyValue = null;
		self.sValue = null;
		self.aXYRef = [];
		self.bInit = false;
		self.bIgnoreLocate = true;
		self.oStyle = self;
		self.bOnViewport = false;
		self.bValAssoc = false;
	},
	applyJsRule : function(oTarget, sLayer) {
		var self = this;
		self._super(self.oParent, oTarget, sLayer, self._api_node_info_(null, false));
	},
	getHookXY : function() {
		return [this.iX, this.iY, {reference:this,center:true}];
	},
	getCXY : function() {
		return [this.iX, this.iY];
	},
	setNodeData : function(o) {
		var self = this;
		for (var k in o) {
			if (o.hasOwnProperty(k)) {
				if (self.oParent.bFast) {
					self.oParent.aPlotNodes[self.iIndex][k] = o[k];
				} else {
					self.oAttributes[k] = o[k];
				}
			}
		}
	},
	getNodeData : function(k) {
		return this.oParent.bFast?this.oParent.aPlotNodes[this.iIndex][k]:this.oAttributes[k];
	},
	setUpdate : function() {
		var self = this, i, iLen;
		var oAttr = self.oGraph.oAttributes, iPIdx = self.oParent.iIndex;
		if (ZC._n_(oAttr['update']) === null) {
			oAttr['update'] = {};
		}
		var oUpdate = oAttr['update'];

		var sValue = ''+self.fValue;
		var oFormat = self.oParent.setupFormat();
		var bNegative = ZC._isnumber_(sValue) && ZC._f_(sValue) < 0;
		if (bNegative && oFormat['negation'] === 'currency') {
			sValue = ZC._a_(ZC._f_(sValue));
		}
		oFormat['utc'] = self.oGraph.bUTC;
		oFormat['timezone'] = self.oGraph.iTimeZone;
		sValue = ZC.ZCUtils._format_(sValue, oFormat, self.oParent);

		oUpdate['plot-'+iPIdx+'-value'] = sValue;
		oUpdate['plot-'+iPIdx+'-value-0'] = sValue;
		for (i=0,iLen=self.aExtraValues.length;i<iLen;i++) {
			oUpdate['plot-'+iPIdx+'-value-'+(i+1)] = self.aExtraValues[i];
		}
		oUpdate['plot-value'] = oUpdate['plot-value-0'] = sValue;
		for (i=0,iLen=self.aExtraValues.length;i<iLen;i++) {
			oUpdate['plot-value-'+(i+1)] = self.aExtraValues[i];
		}
	},
	setupXY : function() {
		var self = this, sHash, mValue;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];

		if (self.oParent.bFast) {
			self.fAbsoluteValue = self.oParent.aPlotNodes[self.iIndex].fAbsoluteValue;
		}

		if (self.aXYRef !== aXYRef_) {
			var fOffsetValue = 0;
			if (oScaleKey.bInversed) {
				if (self.fKeyValue !== null) {
					self.iY = oScaleKey.getCoordByValue(self.fKeyValue);
				} else {
					self.iY = oScaleKey.getCoordByIndex(self.iIndex);
				}
				if (self.oParent.bStacked && self.oParent.sStackType === '100%') {
					if (self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack] > 0) {
						self.iX = oScaleVal.getCoordByValue(100*self.fAbsoluteValue/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
					} else {
						self.iX = oScaleVal.getCoordByValue(100*self.fAbsoluteValue);
					}
				} else {
					self.iX = oScaleVal.getCoordByValue(self.fAbsoluteValue + fOffsetValue);
				}
			} else {
				if (self.fKeyValue !== null) {
					self.iX = oScaleKey.getCoordByValue(self.fKeyValue);
				} else {
					self.iX = oScaleKey.getCoordByIndex(self.iIndex);
				}
				if (self.oParent.bStacked && self.oParent.sStackType === '100%') {
					if (self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack] > 0) {
						self.iY = oScaleVal.getCoordByValue(100*self.fAbsoluteValue/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
					} else {
						self.iY = oScaleVal.getCoordByValue(100*self.fAbsoluteValue);
					}
				} else {
					self.iY = oScaleVal.getCoordByValue(self.fAbsoluteValue + fOffsetValue);
				}
			}
			if (self.oParent.bFast) {
				self.oParent.aPlotNodes[self.iIndex].iX = self.iX;
				self.oParent.aPlotNodes[self.iIndex].iY = self.iY;
			}
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			if (self.oParent.aRules.length === 0 && ZC._indexof_(['line', 'area', 'vbar', 'hbar', 'line3d', 'area3d', 'vbar3d', 'hbar3d'], self.oParent.sType) !== -1 && !self.oParent.oData['override']) {
				self.oStyle = self.oParent;
			} else {

				
				if (ZC.ZCQuery.browser.mozilla) {
					self.copy(self.oParent);
					self.aRules = self.oParent.aRules;
					self.applyRules();
					self.parse(false);
					self.oStyle = self;
				} else {
					if (!self.oParent.oData['override']) {
						sHash = self.getRulesHash(self.oParent.aRules);
						if (ZC._n_(mValue=self.oParent.oRulesCache[sHash]) === null) {
							self.copy(self.oParent);
							self.aRules = self.oParent.aRules;
							self.applyRules();
							self.parse(false);
							self.oStyle = self;
							self.oParent.oRulesCache[sHash] = self;
						} else {
							self.oStyle = mValue;
						}
					} else {
						self.copy(self.oParent);
						self.aRules = self.oParent.aRules;
						self.applyRules();
						self.parse(false);
						self.oStyle = self;
					}
				}
				
			}

			if (self.oParent.oData['override']) {
				self.oStyle.oAttributes['plotidx'] = self.oParent.iIndex;
				self.oStyle.oAttributes['nodeidx'] = self.iIndex;
				self.oStyle.parse(false);
			}
			self.bInit = true;
		}
	},
	setupValues : function() {
		var self = this, iAssoc;
		if (self.oData['value'] instanceof Array) {			
			self.sValue = self.oData['value'].join(' ');
			if (typeof(self.oData['value'][0]) === 'string') {
				iAssoc = ZC._indexof_(self.oGraph.aKeyAssoc, self.oData['value'][0]);
				if (iAssoc !== -1) {
					self.fKeyValue = iAssoc;
				} else {
					self.oGraph.aKeyAssoc.push(self.oData['value'][0]);
					self.fKeyValue = self.oGraph.aKeyAssoc.length-1;
				}
			} else {
				self.fKeyValue = parseFloat(self.oData['value'][0]);
			}
			if (typeof(self.oData['value'][1]) === 'string') {
				iAssoc = ZC._indexof_(self.oGraph.aValAssoc, self.oData['value'][1]);
				if (iAssoc !== -1) {
					self.fValue = iAssoc;
				} else {
					self.oGraph.aValAssoc.push(self.oData['value'][1]);
					self.fValue = self.oGraph.aValAssoc.length-1;
				}
			} else {
				self.fValue = parseFloat(self.oData['value'][1]);
			}
			if (self.fKeyValue !== null) {
				self.oParent.addKeyPlotAssoc(self.fKeyValue, self.iIndex);
			}
			if (self.oParent.iExtraValues > 0 && self.oData['value'].length > self.oParent.iExtraValues) {
				for (var i=self.oData['value'].length-self.oParent.iExtraValues;i<self.oData['value'].length;i++) {
					self.aExtraValues.push(self.oData['value'][i]);
				}
			}
		}
	},
	parse : function(bDataOnly) {
		var self = this;
		
		self.oAttributes['plotidx'] = self.oParent.iIndex;
		self.oAttributes['nodeidx'] = self.iIndex;
		self.sId = self.oParent.sId + '-node-' + self.iIndex;
		if (ZC._n_(bDataOnly) === null) {
			bDataOnly = true;
		}
		if (bDataOnly) {
			if (self.oData['value'] instanceof Array || self.oParent.bExtraValues) {
				self.setupValues();
				
			} else {
				self.sValue = self.oData['value'];
				if (typeof(self.oData['value']) === 'string') {
					var iAssoc = ZC._indexof_(self.oGraph.aValAssoc, self.oData['value']);
					if (iAssoc !== -1) {
						self.fValue = iAssoc;
					} else {
						self.oGraph.aValAssoc.push(self.oData['value']);
						self.fValue = self.oGraph.aValAssoc.length-1;
					}
				} else {
					
					
					
					self.fValue = self.oData['value'];
				}
			}
			if (self.fAbsoluteValue === null) {
				self.fAbsoluteValue = self.fValue;
			}
		} else {
			self._super();
		}
	},
	parseRule : function(sRule) {
		return this.parseText(sRule, {});
	},
	getFormatValue : function() {
		return this.fValue;
	},
	parseText : function(sText, oExtraFormat, bEncode, bUrl) {
		var self = this, mValue, sValue, oFormat, i, iLen, aMatches;

		if (typeof(bEncode) === 'undefined') {
			bEncode = false;
		}
		var oRE, oPPI = self.oParent.oPlotInfo, oPS = self.oParent.oParent;

		if (!bUrl) {
			if (sText.substring(0, 11) === 'javascript:') {
				try {
					var sCall = sText.replace('javascript:', '').replace('()', '');
					if (eval(sCall)) {
						mValue = (self.aExtraValues.length === 0)?self.fValue:[self.fValue].concat(self.aExtraValues);
						
						sText = eval(sCall).call(self, mValue, {
							nodeindex : self.iIndex, 
							plotindex : self.oParent.iIndex, 
							plotid : self.oParent.sObjectId, 
							nodeinfo : self._api_node_info_(null, false), 
							plotinfo : self.oParent._api_plot_info_()
						}) || sText;
					}
				} catch (e) {}
			}
		}

		if (self.oParent.bFastRules) {
			sValue = self.getFormatValue();
			if (ZC._n_(self.oGraph.aValAssoc[sValue]) !== null && self.bValAssoc) {
				sValue = self.oGraph.aValAssoc[sValue];
			}
			sText = sText
				.replace('%node-numeric-value', self.fValue)
				.replace('%node-value', sValue)
				.replace('%node-index', self.iIndex)
				.replace('%plot-index', self.oParent.iIndex)
				.replace('%plot-count', oPS.aPlots.length)
				.replace('%p', self.oParent.iIndex)
				.replace('%P', oPS.aPlots.length)
				.replace('%v', sValue)
				.replace('%V', self.fValue)
				.replace('%i', self.iIndex)
				.replace('%n', self.iIndex);
			return sText;
		}

		var sKeyValue = '', sKeyLabel = '', sKeyText = '', sPlotText = '';
		var oScaleKey = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);
		var oScaleVal = self.oGraph.getScaleByName(self.oParent.getScales('v')[0]);

		if (oScaleKey) {
			if (self.fKeyValue !== null) {
				sKeyValue = sKeyLabel = sKeyText = self.fKeyValue;
			} else {
				if (ZC._n_(oScaleKey.aValues[self.iIndex]) !== null) {
					sKeyValue = sKeyLabel = sKeyText = oScaleKey.aValues[self.iIndex];
				}
				if (ZC._n_(oScaleKey.aLabels[self.iIndex]) !== null) {
					sKeyText = sKeyLabel = oScaleKey.aLabels[self.iIndex];
				}
			}
		}

		if (ZC._n_(mValue=self.oGraph.aKeyAssoc[sKeyValue]) !== null && typeof(sKeyValue) === 'number') {
			sKeyValue = mValue;
		}
		if (ZC._n_(mValue=self.oGraph.aKeyAssoc[sKeyLabel]) !== null && typeof(sKeyLabel) === 'number') {
			sKeyLabel = mValue;
		}
		if (ZC._n_(mValue=self.oGraph.aKeyAssoc[sKeyText]) !== null && typeof(sKeyText) === 'number') {
			sKeyText = mValue;
		}

		if (ZC._n_(self.oParent.sText) !== null) {
			sPlotText = self.oParent.sText;
		} else {
			sPlotText = 'Series ' + (self.oParent.iIndex+1);
		}
		var aPlotText = (sPlotText+'').split(/\s+/);		

		var sKeyValueTs = sKeyValue;
		if (oScaleKey) {
			oFormat = oScaleKey.setupFormat();
			
			if (oExtraFormat && oExtraFormat['transform-date']) {
				ZC._cp_({
					'transform-date' : true,
					'transform-date-format' : oExtraFormat['transform-date-format']
				}, oFormat);
			}
			oFormat['utc'] = self.oGraph.bUTC;
			oFormat['timezone'] = self.oGraph.iTimeZone;
			if (ZC._n_(oScaleKey.aLabels[self.iIndex]) !== null) {
				sKeyText = sKeyLabel = ZC.ZCUtils._format_(sKeyText, oFormat, oScaleKey, true);
			}
			sKeyValue = ZC.ZCUtils._format_(sKeyValue, oFormat, oScaleKey, true);
		}

		var aKeyLabel = (sKeyLabel+'').split(/\s+/);
		var aKeyText = (sKeyText+'').split(/\s+/);
		var aKeyValue = (sKeyValue+'').split(/\s+/);

		sValue = self.getFormatValue();
		if (ZC._n_(self.oGraph.aValAssoc[sValue]) !== null && self.bValAssoc) {
			sValue = self.oGraph.aValAssoc[sValue];
		}

		var bNegative = ZC._isnumber_(sValue) && ZC._f_(sValue) < 0;

		oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);

		if (bNegative && oFormat['negation'] === 'currency') {
			sValue = ZC._a_(ZC._f_(sValue));
		}

		oFormat['utc'] = self.oGraph.bUTC;
		oFormat['timezone'] = self.oGraph.iTimeZone;
		
		sValue = ZC.ZCUtils._format_(sValue, oFormat, self.oParent, (oScaleVal && oScaleVal.oTransform)?oScaleVal.oTransform:false);

		
		if (sText === '%v' || sText === '%node-value') {
			return sValue;
		}
		if (sText === '%t' || sText === '%plot-text') {
			return sPlotText;
		}

		var aTokens = self.aTokens || [];

		if (oScaleVal && sText.indexOf('%scale-value-text') !== -1) {
			if ((mValue=ZC._indexof_(oScaleVal.aValues, self.fValue)) !== -1 && ZC._n_(oScaleVal.aLabels) !== null && ZC._n_(oScaleVal.aLabels[mValue]) !== null) {
				aTokens.push(['%scale-value-text', oScaleVal.aLabels[mValue]]);
			} else {
				aTokens.push(['%scale-value-text', self.fValue]);
			}
			
			oRE = new RegExp('(%scale-value-text)\\(([0-9]*)\\)');
			var oNode_, sNodeText_, iPlotIndex_, oPlot_;
			while ((aMatches = oRE.exec(sText))) {
				sNodeText_ = '';
				if ((mValue=aMatches[2]) !== '') {
					iPlotIndex_ = ZC._i_(mValue);
					if (ZC._n_(oPlot_=self.oParent.oParent.aPlots[iPlotIndex_]) !== null) {
						oNode_ = oPlot_.getNode(self.iIndex);
						if (oNode_ !== null) {
							sNodeText_ = oNode_.parseText(aMatches[1]);
						}
					}
				}
				sText = sText.replace(aMatches[0], sNodeText_);
				if (sNodeText_ !== '') {
					aTokens.push([aMatches[0], sNodeText_]);
				}
			}
		}

		for (var sKey in self.oParent.oXData) {
			var sXValue;
			if (self.oParent.oXData[sKey] instanceof Array) {
				if (self.oParent.oXData[sKey][self.iIndex] !== null) {
					sXValue = self.oParent.oXData[sKey][self.iIndex];
				} else {
					sXValue = '';
				}
			} else {
				if (self.oParent.oXData[sKey] !== null) {
					sXValue = self.oParent.oXData[sKey];
				} else {
					sXValue = '';
				}
			}
			if (typeof(sXValue) === 'number') {
				sXValue = ZC.ZCUtils._format_(sXValue, oFormat, self.oParent, (oScaleVal && oScaleVal.oTransform)?oScaleVal.oTransform:false);
			}
			aTokens.push(['%data-' + sKey, sXValue]);
		}
		for (i=0;i<aKeyLabel.length;i++) {
			aTokens.push(
				['%scale-key-label-' + i, aKeyLabel[i]],
				['%kl' + i, aKeyLabel[i]]
			);
		}
		for (i=0;i<aKeyText.length;i++) {
			aTokens.push(
				['%scale-key-text-' + i, aKeyText[i]],
				['%kt' + i, aKeyText[i]]
			);
		}
		for (i=0;i<aKeyValue.length;i++) {
			aTokens.push(
				['%scale-key-value-' + i, aKeyValue[i]],
				['%kv' + i, aKeyValue[i]],
				['%k' + i, aKeyValue[i]]
			);
		}

		aTokens.push(
			['%scale-key-label', sKeyLabel],
			['%scale-key-text', sKeyText],
			['%scale-key-value', sKeyValue],
			['%scale-key-value-ts', sKeyValueTs],
			['%kt', sKeyText],
			['%kl', sKeyLabel],
			['%kv', sKeyValue],
			['%k', sKeyValue],
			['%node-value', sValue],
			['%v', sValue],
			['%node-numeric-value', self.fValue],
			['%V', self.fValue],
			['%node-index', self.iIndex],
			['%node-x', self.iX],
			['%node-y', self.iY],
			['%chart-width', self.oLoader.iWidth],
			['%chart-height', self.oLoader.iHeight],
			['%i', self.iIndex],
			['%n', self.iIndex],
			['%node-count', self.oParent.aPlotNodes.length],
			['%N', self.oParent.aPlotNodes.length]
		);

		var fPlotSum = oPPI['%plot-sum'], sPlotSum = fPlotSum+'';
		var fPlotAvg = oPPI['%plot-average'], sPlotAvg = fPlotAvg+'';
		var fStackSum = oPS.oPlotSetInfo['%pstack-'+self.iIndex+'-'+self.oParent.iStack+'-sum'] || 0;
		var sStackSum = fStackSum + '';
		var fPlotTotal = 0;
		if (ZC._n_(oPS.oPlotSetInfo) !== null && ZC._n_(oPS.oPlotSetInfo[self.iIndex]) !== null) {
			fPlotTotal = oPS.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack] || 1;
		}
		var sPlotTotal = fPlotTotal+'';
		if (ZC._n_(oFormat['decimals']) !== null && oFormat['decimals'] !== -1) {
			sPlotSum = ZC.ZCUtils._format_(sPlotSum, oFormat);
			sPlotAvg = ZC.ZCUtils._format_(sPlotAvg, oFormat);
			sPlotTotal = ZC.ZCUtils._format_(sPlotTotal, oFormat);
			sStackSum = ZC.ZCUtils._format_(sStackSum, oFormat);
		}

		aTokens.push(
			['%node-error-plus', self.oAttributes['node-error-plus']],
			['%node-error-minus', self.oAttributes['node-error-minus']],
			['%stack-total', sStackSum],
			['%total', sPlotTotal],
			['%plot-min-index', oPPI['%plot-min-index']],
			['%pmi', oPPI['%plot-min-index']],
			['%plot-max-index', oPPI['%plot-max-index']],
			['%pxi', oPPI['%plot-max-index']],
			['%plot-min-value', oPPI['%plot-min-value']],
			['%pmv', oPPI['%plot-min-value']],
			['%plot-max-value', oPPI['%plot-max-value']],
			['%pxv', oPPI['%plot-max-value']],
			['%plot-sum', sPlotSum],
			['%psum', sPlotSum],
			['%plot-average', sPlotAvg],
			['%pavg', sPlotAvg],
			['%plot-values', oPPI['%plot-values']],
			['%pv', oPPI['%plot-values']]
		);

		var fPlotPercent = 100*self.fValue/oPPI['%plot-sum'], sPlotPercent = fPlotPercent+'';
		if (ZC._n_(oFormat['decimals']) !== null) {
			sPlotPercent = ZC.ZCUtils._format_(sPlotPercent, oFormat);
		}

		aTokens.push(
			['%plot-percent', sPlotPercent],
			['%pper', sPlotPercent]
		);

		
		var bNpv = false;
		for (i=0,iLen=aTokens.length;i<iLen;i++) {
			if (aTokens[i][0] === '%npv') {
				bNpv = true;
				break;
			}
		}
		if (!bNpv) {
			if (ZC._n_(self.oParent.oParent.oPlotSetInfo) !== null && ZC._n_(self.oParent.oParent.oPlotSetInfo[self.iIndex]) !== null) {
				var fNodePercent = self.fValue*100/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack], sNodePercent = fNodePercent+'';
				if (ZC._n_(oFormat['decimals']) !== null) {
					sNodePercent = ZC.ZCUtils._format_(sNodePercent, oFormat);
				}
				aTokens.push(
					['%node-percent-value', sNodePercent],
					['%npv', sNodePercent]
				);
			}
		}

		for (i=0;i<aPlotText.length;i++) {
			aTokens.push(
				['%plot-text-' + i, aPlotText[i]],
				['%t' + i, aPlotText[i]]
			);
		}

		aTokens.push(
			['%plot-text', sPlotText],
			['%t', sPlotText],
			['%plot-description', self.oParent.sDescription],
			
			['%plot-index', self.oParent.iIndex],
			['%p', self.oParent.iIndex],
			['%plot-count', oPS.aPlots.length],
			['%P', oPS.aPlots.length],
			['%id', self.oLoader.sId],
			['%graphid', self.oGraph.sId.replace(self.oLoader.sId+'-graph-', '')]
		);

		

		if (sText.indexOf('%negation') !== -1) {
			if (bNegative && oFormat['negation'] === 'currency') {
				aTokens.push(['%negation', '-']);
				bNegative = false;
			} else {
				aTokens.push(['%negation', '']);
			}
		}

		if (zingchart.DEV.SORTTOKENS) {
			aTokens.sort(ZC._token_sort_);
		}

		
		oRE = new RegExp('\\((.+?)\\)\\(([0-9]*)\\)(\\(*)([0-9]*)(\\)*)');
		var sText_, oNode, oPlot;
		while ((aMatches = oRE.exec(sText))) {
			sText_ = '';
			var iPlotIndex = self.oParent.iIndex;
			var iNodeIndex = self.iIndex;
			if ((mValue=aMatches[2]) !== '') {
				iPlotIndex = ZC._i_(mValue);
			}
			if ((mValue=aMatches[4]) !== '') {
				iNodeIndex = ZC._i_(mValue);
			}
			if ((oPlot=oPS.aPlots[iPlotIndex]) !== null) {
				oNode = oPlot.getNode(iNodeIndex, 3);
				if (oNode !== null) {
					sText_ = oNode.parseText(aMatches[1], oExtraFormat);
				}
			}
			sText = sText.replace(aMatches[0], sText_);
		}

		if (sText.indexOf('%prop-') !== -1) {
			oRE = new RegExp('%prop-([a-zA-Z0-9\-]+)');
			var oMap = self.getPMap();
			while ((aMatches = oRE.exec(sText))) {
				if (ZC._n_(oMap[aMatches[1]]) !== null && ZC._n_(self[oMap[aMatches[1]]]) !== null) {
					sText = sText.replace(aMatches[0], self[oMap[aMatches[1]]]);
				}
			}
		}

		var oObject;
		if (sText.indexOf('%linecolor') !== -1) {
			oRE = new RegExp('%linecolor([0-9]*)');
			while ((aMatches = oRE.exec(sText))) {
				if (aMatches[1] === '') {
					oObject = self.oStyle || self;
					if (!oObject.sLineColor) {
						oObject = self.oParent;
					}
				} else {
					oObject = oPS.aPlots[aMatches[1]];
				}
				sText = sText.replace(aMatches[0], oObject?(oObject.sLineColor || '#000'):'#000');
			}
		}
		if (sText.indexOf('%backgroundcolor') !== -1) {
			oRE = new RegExp('%backgroundcolor([0-9]*)');
			while ((aMatches = oRE.exec(sText))) {
				if (aMatches[1] === '') {
					oObject = self.oStyle || self;
					if (!oObject.sLineColor) {
						oObject = self.oParent;
					}
				} else {
					oObject = oPS.aPlots[aMatches[1]];
				}
				if (self.oParent.sColorDef === 'markerbg') {
					sText = sText.replace(aMatches[0], oObject?(oObject.oMarker?(oObject.oMarker.sBackgroundColor1 || '#000'):'#000'):'#000');
				} else {
					sText = sText.replace(aMatches[0], oObject?(oObject.sBackgroundColor1 || '#000'):'#000');
				}
			}
		}
		if (sText.indexOf('%color') !== -1) {
			oRE = new RegExp('%color([0-9]*)');
			while ((aMatches = oRE.exec(sText))) {
				if (aMatches[1] === '') {
					oObject = self.oStyle || self;
					if (!oObject.sLineColor) {
						oObject = self.oParent;
					}
				} else {
					oObject = oPS.aPlots[aMatches[1]];
				}
				if (self.oParent.sColorDef === 'line') {
					sText = sText.replace(aMatches[0], oObject?(oObject.sLineColor || '#000'):'#000');
				} else if (self.oParent.sColorDef === 'markerbg') {
					sText = sText.replace(aMatches[0], oObject?(oObject.oMarker?(oObject.oMarker.sBackgroundColor1 || '#000'):'#000'):'#000');
				} else {
					sText = sText.replace(aMatches[0], oObject?(oObject.sBackgroundColor1 || '#000'):'#000');
				}
			}
		}

		sText = ZC.ZCUtils._color_tokens_(sText);

		for (i=0,iLen=aTokens.length;i<iLen;i++) {
			oRE = new RegExp(aTokens[i][0], 'g');
			if (typeof(aTokens[i][1]) === 'undefined') {
				sText = sText.replace(oRE, '');
			} else {
				if (bEncode) {
					sText = sText.replace(oRE, encodeURIComponent(aTokens[i][1]));
				} else {
					sText = sText.replace(oRE, aTokens[i][1]);
				}
			}
		}
		sText = sText.replace(new RegExp('%data-([a-zA-Z0-9]+)', 'g'), '');

		if (bNegative && oFormat['negation'] === 'currency') {
			sText = '-' + sText;
		}
		return sText;
	},
	paint : function() {
	},
	paint_ : function() {
		
	},
	getValueBoxStyle : function() {
		return {
			'color': this.oStyle.sBackgroundColor1
		};
	},
	getTooltipStyle : function() {
		return {
			'border-color' : this.oStyle.sBackgroundColor1,
			'background-color' : this.oStyle.sBackgroundColor2,
			'color' : this.oStyle.sColor
		};
	},
	getGuideStyle : function() {
		return this.getTooltipStyle();
	},
	paintValueBox : function(bEstimate, iIndex) {
		var self = this, mValue, sTypes, oFormat;

		if (!iIndex) {
			iIndex = 1;
		}

		if (self.oParent.aValueBoxExtra && self.oParent.aValueBoxExtra.length > 0 && self.oParent.aValueBoxExtra.length > iIndex-1) {
			self.paintValueBox(bEstimate, iIndex+1);
		}
		
		if (!self.bVisible) {
			return;
		}

		var oVB = (iIndex===1)?self.oParent.oValueBox:self.oParent.aValueBoxExtra[iIndex-2];
		var oValueBox;

		if (!self.oParent.oValueBox_) {
			oValueBox = new ZC.ZCTextBox(self.oParent);
			if (!oVB.oData['rules']) {
				
				
				sTypes = 'all';
				if (ZC._n_(mValue=oVB.oData['type']) !== null) {
					sTypes = mValue;
				}
				if (self.oGraph.sType !== 'pie' && self.oGraph.sType !== 'nestedpie' && self.oGraph.sType !== 'pie3d' && sTypes === 'all' && (!self.oParent.aValueBoxExtra || self.oParent.aValueBoxExtra.length === 0)) {
					self.oParent.oValueBox_ = oValueBox;
				}
			}

			oValueBox.append(oVB.oData);
			oValueBox.sDOMClass = self.oGraph.sId + '-value-box ' + self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-value-box zc-value-box';
			oValueBox.sId = self.sId + '-value-box-' + iIndex;
			oValueBox.oCanvas = oValueBox.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):((self.oGraph.oSettings['3d'] || self.oLoader.bFlat)?ZC._id_(self.oGraph.sId + '-plots-vb-c'):ZC._id_(self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-vb-c'));
			oValueBox.oDOMParent = self.oLoader.usc()?ZC._id_(self.oGraph.oParent.sId + '-top'):ZC._id_(self.oGraph.oParent.sId + '-text');
			

			oFormat = ZC.ZCUtils._setup_format_(oValueBox.oData, self.oParent.oData);
			oValueBox.parseText = function(sText) {
				return self.parseText(sText, oFormat);
			};
			var oValueBoxStyle = self.getValueBoxStyle(oValueBox);
			if (ZC._n_(mValue=oValueBoxStyle['color']) !== null) {
				oValueBox.sColor = mValue;
			}
			if (ZC._n_(mValue=oValueBoxStyle['background-color']) !== null) {
				oValueBox.sBackgroundColor1 = oValueBox.sBackgroundColor2 = mValue;
			}

			oValueBox.oAttributes['plotidx'] = self.oParent.iIndex;
			oValueBox.oAttributes['nodeidx'] = self.iIndex;

			

			if (self.oParent.oValueBox.oJsRule) {
				self.oParent.oValueBox.applyJsRule(self.oParent.oValueBox, oValueBox, null, self._api_node_info_(null, false));
				oValueBox.parse();
			}

			oValueBox.parse();
			oValueBox.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oValueBox.applyRules()) {
				oValueBox.parse();
			}

			
			if (!self.oParent.oValueBoxRef) {
				var oValueBoxRef = new ZC.ZCTextBox(self.oParent);
				oValueBoxRef.copy(oValueBox);
				self.oParent.oValueBoxRef = oValueBoxRef;
			}

			
			sTypes = 'all';
			if (ZC._n_(mValue=oVB.oData['type']) !== null) {
				sTypes = mValue;
			}
			if (oValueBox.bVisible) {
				oValueBox.bVisible = false;

				var mVBText = self.oParent.oData['value-box']['text'] || '';

				if (sTypes.substring(0, 7) === 'values(') {
					var sValues = sTypes.substring(7, sTypes.length).replace(')', '');
					var aValues = sValues.split(',');
					if (ZC._indexof_(aValues, self.fValue) !== -1) {
						oValueBox.bVisible = true;
					}
				} else {
					var aTypes = sTypes.split(',');
					var oTokens = {
						'min' : '%plot-min-value',
						'max' : '%plot-max-value',
						'first' : '%plot-min-index',
						'last' : '%plot-max-index'
					};

					for (var sToken in oTokens) {
						if (ZC._indexof_(aTypes, sToken) !== -1) {
							if (
								((sToken === 'first' || sToken === 'last') && self.iIndex === self.oParent.oPlotInfo[oTokens[sToken]])
								||
								((sToken === 'min' || sToken === 'max') && self.fValue === self.oParent.oPlotInfo[oTokens[sToken]])
							) {
								if (typeof(mVBText) === 'object' && ZC._n_(mVBText[sToken]) !== null) {
									oValueBox.oData['text'] = mVBText[sToken];
									oValueBox.parse();
								}
								oValueBox.bVisible = true;
							}
						}
					}
					if (ZC._indexof_(aTypes, 'all') !== -1) {
						oValueBox.bVisible = true;
					}
				}
			}
		} else {
			oValueBox = self.oParent.oValueBox_;
			oValueBox.sId = self.sId + '-value-box';
			oValueBox.oAttributes['plotidx'] = self.oParent.iIndex;
			oValueBox.oAttributes['nodeidx'] = self.iIndex;
			oFormat = ZC.ZCUtils._setup_format_(oValueBox.oData, self.oParent.oData);
			oValueBox.parseText = function(sText) {
				return self.parseText(sText, oFormat);
			};
			oValueBox.parse();
		}

		if (bEstimate) {
			return oValueBox;
		}

		if (oValueBox.bVisible && ZC._n_(oValueBox.sText) !== null && oValueBox.sText !== '') {
			var aValueBoxPosition = self.setupValueBox(oValueBox);
			oValueBox.oAttributes['positioninfo'] = aValueBoxPosition;
			oValueBox.iX = aValueBoxPosition[0];
			oValueBox.iY = aValueBoxPosition[1];
			if (oValueBox.iX !== -1 && oValueBox.iY !== -1) {
				oValueBox.paint();
				oValueBox.paintPrintVersion();
				if (!oValueBox.bFlat && ZC._id_(self.oLoader.sId + '-map')) {
					self.oParent.oParent.aAreas.push(ZC.ZCUtils._box_area_(self.oGraph.sId, oValueBox));
				}
				
			}
		}
		return oValueBox;
	},
	setupValueBoxWH : function(oValueBox) {
		if (ZC._n_(oValueBox.oData['width']) !== null) {
			var _iWidth_ = ZC._dimension_(oValueBox.oData['width']);
			if (_iWidth_ <= 1) {
				_iWidth_ = this.iWidth*_iWidth_;
			}
			oValueBox.iWidth = _iWidth_;
		}
		if (ZC._n_(oValueBox.oData['height']) !== null) {
			var _iHeight_ = ZC._dimension_(oValueBox.oData['height']);
			if (_iHeight_ <= 1) {
				_iHeight_ = this.iWidth*_iHeight_;
			}
			oValueBox.iHeight = _iHeight_;
		}
		return oValueBox;
	},
	setupValueBox : function(oValueBox) {
		var self = this, mValue;
		var oScaleVal = self.oGraph.getScaleByName(self.oParent.getScales('v')[0]);
		var iFactor = ((self.fValue >= oScaleVal.fRef && !oScaleVal.bMirrored)||(self.fValue < oScaleVal.fRef && oScaleVal.bMirrored))?-1:1;
		var sPlacement = 'auto';
		if (ZC._n_(mValue=oValueBox.oData['placement']) !== null) {
			sPlacement = mValue;
		}
		if (sPlacement === 'auto') {
			var fValueP = (ZC._n_(self.oParent.aPlotNodes[self.iIndex-1])!==null)?self.oParent.aPlotNodes[self.iIndex-1].fValue:self.fValue;
			var fValueN = (ZC._n_(self.oParent.aPlotNodes[self.iIndex+1])!==null)?self.oParent.aPlotNodes[self.iIndex+1].fValue:self.fValue;
			if (fValueP >= self.fValue && self.fValue <= fValueN) {
				sPlacement = 'bottom';
			} else if (fValueP <= self.fValue && self.fValue >= fValueN) {
				sPlacement = 'top';
			} else if (fValueP >= self.fValue && self.fValue >= fValueN) {
				if (fValueP/self.fValue > self.fValue/fValueN) {
					sPlacement = 'bottom';
				} else {
					sPlacement = 'top';
				}
			} else if (fValueP <= self.fValue && self.fValue <= fValueN) {
				if (self.fValue/fValueP > fValueN/self.fValue) {
					sPlacement = 'top';
				} else {
					sPlacement = 'bottom';
				}
			}
		}
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var iX = self.iX - iWidth/2;
		var iY = self.iY - iHeight/2;
		switch (sPlacement) {
			case 'top':
				iY -= iFactor*(iHeight/2 + 4);
				break;
			case 'bottom':
				iY += iFactor*(iHeight/2 + 4);
				break;
			case 'left':
				iX -= iWidth/2 + 4;
				break;
			case 'right':
				iX += iWidth/2 + 4;
				break;
			case 'over':
				break;
			default:
				break;
		}
		if (!self.oGraph.oSettings['3d']) {
			iX = ZC._max_(self.oGraph.oPlotArea.iX - iWidth/2, iX);
			iX = ZC._min_(self.oGraph.oPlotArea.iX + self.oGraph.oPlotArea.iWidth - iWidth/2, iX);
			iY = ZC._max_(self.oGraph.oPlotArea.iY - iHeight, iY);
			iY = ZC._min_(self.oGraph.oPlotArea.iY + self.oGraph.oPlotArea.iHeight, iY);
		}
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}

		return [ZC._i_(iX), ZC._i_(iY)];
	},
	sharedMarker : function(b3D, bAll) {

		var self = this, mValue, mValue_, sCoords, oMarker, oPoint3D;

		var aBS = ['bubble','hbubble','scatter','hscatter'];

		if (typeof(self.oParent.bBS) === 'undefined') {
			self.oParent.bBS = (ZC._indexof_(aBS, self.oParent.sType) === -1);
		}

		if (self.oGraph.bScrolling && self.oParent.bBS) {
			return;
		}

		if (ZC._n_(b3D) === null) { b3D = false; }
		if (ZC._n_(bAll) === null) { bAll = false; }

		if (
			!ZC._btw_(self.iX, self.oGraph.oPlotArea.iX-2, self.oGraph.oPlotArea.iX+self.oGraph.oPlotArea.iWidth+2)
			||
			!ZC._btw_(self.iY, self.oGraph.oPlotArea.iY-2, self.oGraph.oPlotArea.iY+self.oGraph.oPlotArea.iHeight+2)
		) {
			return;
		}

		var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';

		if (ZC._indexof_(self.oLoader.aFlags, 'skip_segment_tracking') === -1 && self.oParent.bSegmentTrackers) {
			if (self.oParent._bCreateAreaMap) {
				var aPoints = self.getNodeData('points');
				if (ZC._indexof_(self.oLoader.aFlags, 'use_fast_mode') !== -1 && ZC._indexof_(['line','area'], self.oParent.sType) !== -1) {
					if (typeof(aPoints) === 'undefined') {
						self.paint(true);
					}
				}
				if (typeof(self.oAttributes['polypoints']) === 'undefined') {
					sCoords = ZC.ZCMath._htmlarea_(ZC.ZCMath._contour_(aPoints, self.oParent.iLineWidth/2), 4);
				} else {
					sCoords = ZC.ZCMath._htmlarea_(aPoints, 4);
				}
				if (sCoords !== '') {
					self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />');
					
				}

				if ((self.oParent.sType === 'area' || self.oParent.sType === 'area3d') && self.oParent.bActiveArea) {
					var aPointsArea = self.getNodeData('pointsarea');
					sCoords = ZC.ZCMath._htmlarea_(aPointsArea, 4);
					if (sCoords !== '') {
						self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--area" coords="' + sCoords + '" />');
						
					}
				}
			}
		}

		
		var bMarkers = true;
		
		
		

		if (bMarkers && (bAll || self.oParent._bShowMarkers)) {

			if (self.oParent.oClonedMarker) {
				oMarker = self.oParent.oClonedMarker;
				if (self.oLoader.sOutput !== 'svg') {
					if (b3D) {
						oPoint3D = new ZC.ZCPoint3D(self.oGraph, self.iX - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start'] || 0);
						oMarker.iX = ZC._x_(oPoint3D.aXY[0]);
						oMarker.iY = ZC._x_(oPoint3D.aXY[1]);
					} else {
						oMarker.iX = ZC._x_(self.iX);
						oMarker.iY = ZC._x_(self.iY);
					}
					oMarker.oAttributes['plotidx'] = self.oParent.iIndex;
					oMarker.oAttributes['nodeidx'] = self.iIndex;
					oMarker.sId = self.sId + '-marker';
					oMarker.parse();
				}
			} else {

				oMarker = new ZC.ZCShape(self.oParent);
				oMarker.sId = self.sId + '-marker';
				oMarker.oAttributes['p-width'] = self.oParent._oScaleKey.iStepSize;
				oMarker.oAttributes['p-height'] = self.oParent._oScaleVal.iStepSize;
				

				if (!self.oParent.bBS) {
					oMarker.oCanvas = self.oParent.getCanvas('bl', 1);
					oMarker.oCanvasSh = self.oParent.getCanvas('bl', 0);
				} else {
					oMarker.oCanvas = self.oParent.getCanvas('fl', 0);
					oMarker.oCanvasSh = self.oParent.getCanvas('fl', 0);
				}
				
				if (b3D) {
					oPoint3D = new ZC.ZCPoint3D(self.oGraph, self.iX - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start'] || 0);
					oMarker.iX = ZC._x_(oPoint3D.aXY[0]);
					oMarker.iY = ZC._x_(oPoint3D.aXY[1]);
				} else {
					oMarker.iX = ZC._x_(self.iX);
					oMarker.iY = ZC._x_(self.iY);
				}
				oMarker.sLineColor = self.oParent.aPalette[3];
				oMarker.sBorderColor = self.oParent.aPalette[3];
				oMarker.sBackgroundColor1 = self.oParent.aPalette[2];
				if (self.oParent.sType === 'bubble' || self.oParent.sType === 'hbubble') {
					oMarker.sBackgroundColor2 = self.oParent.aPalette[1];
				} else {
					oMarker.sBackgroundColor2 = self.oParent.aPalette[2];
				}
				oMarker.append(self.oParent.oMarker.oData);
				if (ZC._n_(self.oAttributes['marker.size']) !== null) {
					oMarker.iSize = self.oAttributes['marker.size'];
				}
				oMarker.oAttributes['plotidx'] = self.oParent.iIndex;
				oMarker.oAttributes['nodeidx'] = self.iIndex;

				if (self.oGraph.aSelection[self.oParent.iIndex] || self.oGraph.bSelection) {
					if (self.oGraph.oSelection['p'+self.oParent.iIndex] && self.oGraph.oSelection['p'+self.oParent.iIndex]['n'+self.iIndex]) {
						oMarker.oSelectionData = self.oParent.oSelectedMarker?self.oParent.oSelectedMarker.oData:{};
					} else {
						if ((self.oParent.sBackgroundMode !== 'none') && ((self.oParent.sBackgroundMode === 'plot' && self.oGraph.aSelection[self.oParent.iIndex]) || (self.oParent.sBackgroundMode === 'graph' && self.oGraph.bSelection))) {
							oMarker.oSelectionData = self.oParent.oBackgroundMarker?self.oParent.oBackgroundMarker.oData:{};
						}
					}
				}

				
				if (ZC._n_(mValue=self.oParent.oData['marker']) !== null) {
					if (ZC._n_(mValue['styles']) !== null && ZC._n_(mValue_=mValue['styles'][self.iIndex]) !== null) {
						if (typeof(mValue_) === 'string') {
							oMarker.append({
								'background-color' : ZC.ZCUtils._lighten_(mValue_, 20),
								'line-color' : ZC.ZCUtils._darken_(mValue_, 20),
								'border-color' : ZC.ZCUtils._darken_(mValue_, 20)
							});
						} else {
							oMarker.append(mValue_);
						}
					}
				}

				oMarker.parse();
				oMarker.parseRule = function(sRule) {
					return self.parseRule(sRule);
				};
				if (oMarker.applyRules()) {
					oMarker.parse();
				}
			}
			self.oAttributes['marker.size'] = ZC._max_(2.02, oMarker.iSize);

			if (oMarker.oJsRule) {
				self.oParent.bFastMarkers = false;
				oMarker.applyJsRule(oMarker, oMarker, null, self._api_node_info_(null, false));
				oMarker.parse();
			}

			self.oStyleMarker = oMarker;

			
			if (!self.oParent.oMarkerRef) {
				var oMarkerRef = new ZC.ZCShape(self.oParent);
				oMarkerRef.copy(oMarker);
				self.oParent.oMarkerRef = oMarkerRef;
			}

			if (oMarker.bVisible && oMarker.sType !== 'none') {

				var _fn_end_ = function() {
					if (!self.oParent.bBS) {
						self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oParent.getCanvas('bl', 0), self.oLoader.sOutput));
						
					}
					self.oAttributes['marker.type'] = oMarker.sShape;
					if (self.oParent._bCreateAreaMap && ZC._indexof_(self.oLoader.aFlags, 'skip_marker_tracking') === -1) {
						var iMX = self.oAttributes['3dxy']?self.oAttributes['3dxy'][0]:self.iX;
						var iMY = self.oAttributes['3dxy']?self.oAttributes['3dxy'][1]:self.iY;
						if (oMarker.sShape === 'pie') {
							self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--marker' + '" coords="' + oMarker.getAreaCoords() + '" />');
						} else {
							self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('circle', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--marker' + '" coords="' + ZC._i_(iMX+oMarker.iOffsetX+ZC.MAPTX) + ',' + parseInt(iMY+oMarker.iOffsetY+ZC.MAPTX, 10) + ',' + parseInt(ZC._max_((ZC.mobile?6:3), oMarker.iSize)*(ZC.mobile?1.25:1.05), 10) + '" />');
						}
						
					}
					if (self.oParent.oValueBox) {
						self.paintValueBox();
					}

					
					if (!self.oParent.bBS) {
						if (self.oGraph.oPreview && self.oGraph.oPreview.bInit && self.oParent.bPreview) {
							var oPlotArea = self.oGraph.oPlotArea;
							var oPreview = self.oGraph.oPreview;
							var oViewport = oPreview.oViewport;
							var oMarkerO = self.oParent.oClonedMarker || oMarker;
							var oMarkerP = new ZC.ZCShape(self.oParent);
							oMarkerP.copy(oMarkerO);
							var fRatioX = (self.iX-oPlotArea.iX)/oPlotArea.iWidth;
							var fRatioY = (self.iY-oPlotArea.iY)/oPlotArea.iHeight;
							oMarkerP.iX = oViewport.iX + oViewport.iBorderWidth + fRatioX*(oViewport.iWidth-2*oViewport.iBorderWidth);
							oMarkerP.iY = oViewport.iY + oViewport.iBorderWidth + fRatioY*(oViewport.iHeight-2*oViewport.iBorderWidth);
							oMarkerP.sId = self.sId + '-marker-preview';
							oMarkerP.iSize = ZC._max_(2.02, ZC._min_(fRatioX, fRatioY)*oMarkerO.iSize);
							oMarkerP.oCanvas = oMarkerP.oCanvasSh = oPreview.oCanvas;
							oMarkerP.parse();
							oMarkerP.paint();
						}
					}
				};

				var bValidChartType = false;
				if (
					(!self.oParent.bBS)
					||
					(self.oParent.sType === 'radar' && self.oParent.sAspect === 'dots')
				) {
					bValidChartType = true;
				}

				if (!self.oParent.bAnimation || !bValidChartType) {					
					var sShape = ((oMarker.sShape==='circle')?'circle':'path');
					if (self.oParent.oClonedMarkerNode) {
						var _clone_ = function(oElement, sCloneId) {
							
							var oClone = oElement.cloneNode(false);
							var iDX = self.iX, iDY = self.iY;
							if (b3D) {
								var oPoint3D = new ZC.ZCPoint3D(self.oGraph, iDX - ZC.ZCDraw3D.iViewX, iDY - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start'] || 0);
								iDX = ZC._x_(oPoint3D.aXY[0]);
								iDY = ZC._x_(oPoint3D.aXY[1]);
								self.oAttributes['3dxy'] = [iDX, iDY];
							}
							oClone.setAttribute('transform', 'translate(' + ZC._i_(iDX - oMarker.iX) + ',' + ZC._i_(iDY - oMarker.iY) + ') ' + (oClone.getAttribute('transform') || ''));
							oClone.setAttribute('id', sCloneId);
							oElement.parentNode.appendChild(oClone);
						};
						if (oMarker.bShadow) {
							_clone_(self.oParent.oClonedMarkerNodeSh, self.sId + '-marker-sh-' + sShape);
						}
						_clone_(self.oParent.oClonedMarkerNode, self.sId + '-marker-' + sShape);
						if (oMarker.sBackgroundImage) {
							_clone_(self.oParent.oClonedMarkerNodeFill, self.sId + '-marker-imgfill');
						}
					} else {
						oMarker.paint();

						if (!self.oGraph.aSelection[self.oParent.iIndex] && self.oParent.bFastMarkers && self.oParent.sType !== 'bubble' && self.oParent.sType !== 'hbubble') {
							if (self.oLoader.sOutput === 'svg') {
								if (ZC._indexof_(['cross','plus','custom'], oMarker.sShape) === -1) {
									self.oParent.oClonedMarker = oMarker;
									if (!zingchart.DEV.DOMFRAGMENTS || !document.querySelector) {
										self.oParent.oClonedMarkerNode = ZC._id_(self.sId + '-marker-' + sShape);
										if (oMarker.bShadow) {
											self.oParent.oClonedMarkerNodeSh = ZC._id_(self.sId + '-marker-sh-' + sShape);
										}
										if (oMarker.sBackgroundImage) {
											self.oParent.oClonedMarkerNodeFill = ZC._id_(self.sId + '-marker-imgfill') || ZC._id_(self.sId + '-marker-path-imgfill');
										}
									} else {
										for (var sId in self.oLoader.oDOMFragments) {
											if (!self.oParent.oClonedMarkerNode) {
												self.oParent.oClonedMarkerNode = self.oLoader.oDOMFragments[sId].querySelector('#' + self.sId + '-marker-' + sShape);
											}
											if (oMarker.bShadow && !self.oParent.oClonedMarkerNodeSh) {
												self.oParent.oClonedMarkerNodeSh = self.oLoader.oDOMFragments[sId].querySelector('#' + self.sId + '-marker-sh-' + sShape);
											}
											if (oMarker.sBackgroundImage && !self.oParent.oClonedMarkerNodeFill) {
												self.oParent.oClonedMarkerNodeFill = self.oLoader.oDOMFragments[sId].querySelector('#' + self.sId + '-marker-imgfill') || self.oLoader.oDOMFragments[sId].querySelector('#' + self.sId + '-marker-path-imgfill');
											}
										}
										if (!self.oParent.oClonedMarkerNode) {
											self.oParent.oClonedMarkerNode = ZC._id_(self.sId + '-marker-' + sShape);
											if (oMarker.bShadow) {
												self.oParent.oClonedMarkerNodeSh = ZC._id_(self.sId + '-marker-sh-' + sShape);
											}
											if (oMarker.sBackgroundImage) {
												self.oParent.oClonedMarkerNodeFill = ZC._id_(self.sId + '-marker-imgfill');
											}
										}
									}
								}
							} else {
								self.oParent.oClonedMarker = oMarker;
							}
						}

					}
					_fn_end_();
				} else {
					var oStart = oMarker, oEnd = {};
					var fAlpha = oMarker.fAlpha;
					var iSize = oMarker.iSize;
					var iX = oMarker.iX;
					var iY = oMarker.iY;

					oStart.iX = iX;
					oStart.iY = iY;
					oEnd.x = iX;
					oEnd.y = iY;

					var iAE = self.oParent.iAnimationEffect, oPA = self.oGraph.oPlotArea;
					oStart.fAlpha = 0;
					oEnd.alpha = fAlpha;

					if (iAE === 3) {
						oStart.iSize = 2;
						oEnd.size = iSize;
					} else if (iAE === 8) {
						oStart.iX = iX - oPA.iX;
						oEnd.x = iX;
					} else if (iAE === 9) {
						oStart.iX = iX + oPA.iX;
						oEnd.x = iX;
					} else if (iAE === 10) {
						oStart.iY = iY - oPA.iY;
						oEnd.y = iY;
					} else if (iAE === 11) {
						oStart.iY = iY + oPA.iY;
						oEnd.y = iY;
					}

					var p;

					for (p in self.oParent.oAnimationAttributes) {
						oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
						oEnd[ZC._camelcase_(p)] = self.oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
					}

					if (ZC._n_(self.oGraph.oLast) === null) {
						self.oGraph.oLast = {};
					}
					if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
						for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
							oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
						}
					}
					self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
					ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);					

					var oTween = new ZC.ZCTween(
						oStart,
						oEnd,
						self.oParent.fAnimationSpeed,
						self.oParent.fAnimationDelay,
						ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
						function() {
							_fn_end_();
						}
					);
					oTween.oNode = self;
					oTween.oSeqFinishedCallback = function() {
						self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oParent.getCanvas('bl', 0), self.oLoader.sOutput));
						
					};

					self.sharedAnimationSetup(oTween);
				}

			} else {
				if (self.oParent.oValueBox) {
					self.paintValueBox();
				}
			}
		} else {
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}
	},
	sharedAnimationSetup : function(oTween, oTweenArea) {
		var self = this, sSequenceName;
		var oTM = self.oGraph.oTweenManager, oTMS = oTM.oSequences, iAS = self.oParent.iAnimationSequence;
		switch (iAS) {
			
			default:
				if (oTweenArea) {
					oTM.add(oTweenArea);
				}
				oTM.add(oTween);
				break;
			case 1:
			case 2:
			case 3:
				if (oTweenArea) {
					var sSequenceAreaName = 'all';
					if (iAS === 1) {
						sSequenceAreaName = 'plots-group-' + self.iIndex + '-area';
					} else if (iAS === 2) {
						sSequenceAreaName = 'nodes-group-' + self.oParent.iIndex + '-area';
					}
					if (ZC._n_(oTMS[sSequenceAreaName]) === null) {
						var oSequenceArea = new ZC.ZCTweenSequence(sSequenceAreaName);
						oTM.addSequence(oSequenceArea);
					}
					oTMS[sSequenceAreaName].add(oTweenArea);
				}
				sSequenceName = 'all';
				if (iAS === 1) {
					sSequenceName = 'plots-group-' + self.iIndex;
				} else if (iAS === 2) {
					sSequenceName = 'nodes-group-' + self.oParent.iIndex;
				}
				if (ZC._n_(oTMS[sSequenceName]) === null) {
					var oSequence = new ZC.ZCTweenSequence(sSequenceName);
					oTM.addSequence(oSequence);
				}
				oTMS[sSequenceName].add(oTween);
				break;
		}
	},
	sharedLayerMarker : function(sLayer) {
		var self = this;
		if (self.oParent.bFast && self.oParent.bXY) {
			self.setupXY();
			if (self.oParent.sType === 'bubble' || self.oParent.sType === 'hbubble') {
				self.paint(true);
			}
		}
		var aPalette = self.oParent.aPalette;
		self.sharedLayerSetup({
			layer : sLayer,
			type : 'shape',
			id : 'marker',
			marker : true,
			initcb : function() {
				this.sShape = self.oAttributes['marker.type'];
				this.iX = self.iX;
				this.iY = self.iY;
				if (self.oParent.sType === 'bubble' || self.oParent.sType === 'hbubble') {
					this.sBackgroundColor1 = aPalette[2];
					this.sBackgroundColor2 = aPalette[3];
				} else {
					this.sLineColor = aPalette[3];
					this.sBorderColor = aPalette[3];
					this.sBackgroundColor1 = aPalette[2];
					this.sBackgroundColor2 = aPalette[1];
				}
				this.iSize = self.oAttributes['marker.size'];
			}
		});
	},
	sharedLayerLine : function(sLayer) {
		var self = this;
		self.sharedLayerSetup({
			layer : sLayer,
			type : 'line',
			id : 'line',
			initcb : function() {
				this.sLineColor = self.oParent.aPalette[3];
			}
		});
	},
	sharedLayerSetup : function(oParams) {
		if (ZC.move) { return; }
		var self = this, mValue, mValue_, oState, sCanvas, oCtx, oStateObj;
		var sLayer = oParams['layer'] || 'hover';
		var sId = oParams['id'] || '';
		var bMarker = false;
		self.oStateObj = null;
		if (ZC._n_(mValue=oParams['marker']) !== null) { bMarker = ZC._b_(mValue); }
		switch (sLayer) {
			case 'hover':
				if (ZC._n_(self.oGraph.oSelection['p'+self.oParent.iIndex]) === null || ZC._n_(self.oGraph.oSelection['p'+self.oParent.iIndex]['n'+self.iIndex]) === null) {
					oState = bMarker?self.oParent.oHoverMarker:self.oParent.oHoverState;
					sCanvas = 'hover';
				}
				break;
			case 'highlight':
				oState = self.oParent.oHighlightState;
				sCanvas = 'hover';
				break;
		}
		if (ZC._n_(oParams['state']) !== null) {
			oState = oParams['state'];
		}
		if (oState && self.oGraph.oAttributes['plot'+self.oParent.iIndex+'.visible'] && oState.bVisible) {
			switch (oParams['type']) {
				case 'box':
					oStateObj = new ZC.ZCBox(self.oParent);
					oStateObj.bIgnoreLocate = true;
					break;
				case 'line':
					oStateObj = new ZC.ZCShape(self.oParent);
					oCtx = ZC.ZCHtmlUtils._context_(self.oGraph.sId + '-' + sCanvas + '-c', self.oLoader.sOutput);
					oStateObj.bPixelCorrection = false;
					break;
				case 'shape':
					oStateObj = new ZC.ZCShape(self.oParent);
					break;
				case 'area':
					oStateObj = new ZC.ZCShape(self.oParent);
					oCtx = ZC.ZCHtmlUtils._context_(self.oGraph.sId + '-' + sCanvas + '-c', self.oLoader.sOutput);
					break;
			}
			if (bMarker) {
				oStateObj.oAttributes['p-width'] = self.oParent._oScaleKey.iStepSize;
				oStateObj.oAttributes['p-height'] = self.oParent._oScaleVal.iStepSize;
			}
			oStateObj.oCanvas = oStateObj.oCanvasSh = ZC._id_(self.oGraph.sId + '-' + sCanvas + '-c');
			oStateObj.sId = self.sId + '-' + (sId!==''?(sId+'-'):'') + sLayer;
			oStateObj.oAttributes['plotidx'] = self.oParent.iIndex;
			oStateObj.oAttributes['nodeidx'] = self.iIndex;
			if (sLayer !== 'hover') {
				oStateObj.bIgnoreOverride = true;
			}
			if (oParams['initcb']) {
				oParams['initcb'].call(oStateObj);
			}
			oStateObj.append(oState.oData);
			if (oParams['parsecb']) {
				oParams['parsecb'].call(oStateObj);
			}

			
			if (ZC._n_(mValue=self.oParent.oData[sLayer + '-state']) !== null) {
				if (ZC._n_(mValue['styles']) !== null && ZC._n_(mValue_=mValue['styles'][self.iIndex]) !== null) {
					if (typeof(mValue_) === 'string') {
						oStateObj.append({
							'background-color' : mValue_,
							'line-color' : mValue_,
							'border-color' : mValue_
						});
					} else {
						oStateObj.append(mValue_);
					}
				}
			}

			if (self.oParent.oJsRule) {
				self.applyJsRule(oStateObj, sLayer);
			}

			if (sLayer === 'hover' && self.oParent.oMarker && self.oParent.oMarker.oJsRule) {
				self.oParent.oMarker.applyJsRule(self.oParent.oMarker, oStateObj, null, self._api_node_info_(null, false));
				oStateObj.parse();
			}

			oStateObj.parse();

			oStateObj.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oStateObj.applyRules()) {
				oStateObj.parse();
			}
			if (oStateObj.bVisible) {
				if (oParams['setupcb']) {
					oParams['setupcb'].call(oStateObj);
				}
				switch (oParams['type']) {
					case 'box':
					case 'shape':
						oStateObj.locate(2);
						oStateObj.paint();
						break;
					case 'line':
						ZC.ZCLine.setup(oCtx, oStateObj);
						if (self.oParent.sHoverMode === 'plot') {
							ZC.ZCLine.paint(oCtx, oStateObj, self.oParent.aLPoints);
						} else {
							ZC.ZCLine.paint(oCtx, oStateObj, self.getNodeData('points'));	
						}
						break;
					case 'area':
						if (self.oParent.sAspect !== 'spline') {
							if (ZC._n_(mValue=oState.oData['alpha-area']) !== null) {
								oStateObj.fAlpha = ZC._f_(mValue);
							}
							ZC.ZCLine.setup(oCtx, oStateObj);
							oStateObj.paint();
						}
						break;
				}
				self.oStateObj = oStateObj;
			}
		}
	},
	sharedErrors : function() {
	},
	setup : function() {
	},
	showLayer : function() {
	},
	hideLayer : function() {
		var self = this;
		ZC.ZCHtmlUtils._remove_(
			[
				self.sId + '-hover-gradient',
				self.sId + '-marker-hover-gradient',
				self.oLoader.sId + '-tooltip-text-gradient',
				self.oLoader.sId + '-tooltip-text-sh-gradient'
			]
		);
	},
	_api_node_info_ : function(ev, bParse) {
		var self = this;
		if (typeof(bParse) === 'undefined') {
			bParse = true;
		}
		var oInfo = {
			id : self.oGraph.oParent.sId,
			graphid : self.oGraph.sId,
			graphindex : self.oGraph.iIndex,
			plotid : self.oParent.sObjectId,
			plotindex : self.oParent.iIndex,
			nodeindex : self.iIndex,
			key : (self.fKeyValue===null)?self.iIndex:self.fKeyValue,
			scaletext : self.oParent._oScaleKey?(self.oParent._oScaleKey.getParsedItemLabel(self.iIndex, (self.fKeyValue===null?null:self.oParent))):null,
			value : self.fValue,
			text : bParse?self.parseText(self.oParent.sTooltipText):self.oParent.sTooltipText,
			ev : ev?ZC.ZCQuery._event_(ev):null
		};

		for (var sKey in self.oParent.oXData) {
			if (self.oParent.oXData[sKey] instanceof Array) {
				if (ZC._n_(self.oParent.oXData[sKey][self.iIndex]) !== null) {
					oInfo['data-' + sKey] = self.oParent.oXData[sKey][self.iIndex];
				}
			} else {
				oInfo['data-' + sKey] = self.oParent.oXData[sKey];
			}
		}
		return oInfo;
	},
	_api_node_event_ : function(ev, sType) {
		ZC.ZCUtils._trigger_event_('node_' + sType, this.oLoader, this._api_node_info_(ev));
	}
});












ZC.ZCLinePlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.oStyle.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.oStyle.sLineColor,
			'border-color': this.oStyle.sLineColor,
			'color' : this.oStyle.sColor
		};
	},
	paint : function(bPointsOnly) {
		var self = this;
		if (typeof(bPointsOnly) === 'undefined') {
			bPointsOnly = false;
		}
		self._super();

		var bVLine = self.oParent.bInverted;

		var oCtxLine = self.oParent._oCtxLine;
		var oScaleKey = self.oParent._oScaleKey;
		var aPlotNodes = self.oParent.aPlotNodes;

		self.setup();

		if (self.oParent.bFast && !self.oGraph.oSettings['3d'] && !self.oParent._bCreateAreaMap) {
			return;
		}

		self.oStyle.bPixelCorrection = self.bPixelCorrection = false;
		self.oStyle.oCanvasSh = self.oParent.getCanvas('bl', 0);
		

		
		var aPoints = [];

		var sAspect = self.oParent.sAspect;
		if ((self.oGraph.bScrolling || self.oParent._bNormalizeAspect) && self.oParent.sAspect === 'spline') {
			sAspect = 'segmented';
		}

		var iStepPrev = (typeof(self.oParent.iStepPrev) !== 'undefined')?self.oParent.iStepPrev:self.oParent.iStep;
		var iStepNext = (typeof(self.oParent.iStepNext) !== 'undefined')?self.oParent.iStepNext:self.oParent.iStep;

		var bPreviousNode = true, bNextNode = true;
		if (ZC._n_(aPlotNodes[self.iIndex-iStepPrev]) === null || (!oScaleKey.bKeyValues && self.iIndex <= oScaleKey.iMinIndex)) {
			bPreviousNode = false;
		}
		if (ZC._n_(aPlotNodes[self.iIndex+iStepNext]) === null || (!oScaleKey.bKeyValues && self.iIndex >= oScaleKey.iMaxIndex)) {
			bNextNode = false;
		}

		var aMP, i, iLen, p;

		switch (sAspect) {
			
			default:
				if (bPreviousNode) {
					self.oParent.getNode(self.iIndex-iStepPrev, 0).setup();
					if (self.oParent.bMidPoint) {
						aMP = ZC.ZCMath._mpoint_(self.oParent.aPlotNodes[self.iIndex-iStepPrev].iX, self.oParent.aPlotNodes[self.iIndex-iStepPrev].iY, self.oParent.aPlotNodes[self.iIndex].iX, self.oParent.aPlotNodes[self.iIndex].iY);
						aPoints.push(aMP);
					}
				}
				aPoints.push([self.iX, self.iY]);
				if (bNextNode) {
					self.oParent.getNode(self.iIndex+iStepNext, 2).setup();
					if (self.oParent.bMidPoint) {
						aMP = ZC.ZCMath._mpoint_(self.oParent.aPlotNodes[self.iIndex].iX, self.oParent.aPlotNodes[self.iIndex].iY, self.oParent.aPlotNodes[self.iIndex+iStepNext].iX, self.oParent.aPlotNodes[self.iIndex+iStepNext].iY, self.oStyle.fAlpha);
					} else {
						aMP = [aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY];
					}
					aPoints.push(aMP);
				}
				break;
			case 'spline':
				if (self.oParent.aPoints) {
					aPoints = self.oParent.aPoints;
				}
				self.oParent.aPoints = [];
				if (aPlotNodes[self.iIndex+1]) {
					var aControlPoints = [], aXPoints = [];
					for (i=-1;i<3;i++) {
						if (aPlotNodes[self.iIndex+i]) {
							self.oParent.getNode(self.iIndex+i, 2).setup();
							if (bVLine) {
								aControlPoints.push(aPlotNodes[self.iIndex+i].iX);
								aXPoints.push(aPlotNodes[self.iIndex+i].iY);
							} else {
								aControlPoints.push(aPlotNodes[self.iIndex+i].iY);
								aXPoints.push(aPlotNodes[self.iIndex+i].iX);
							}
						} else {
							if (aControlPoints.length === 0) {
								if (bVLine) {
									aXPoints.push(self.iY);
									aControlPoints.push(self.iX);
								} else {
									aXPoints.push(self.iX);
									aControlPoints.push(self.iY);
								}
							} else {
								aControlPoints.push(aControlPoints[aControlPoints.length-1]);
								aXPoints.push(aXPoints[aXPoints.length-1]);
							}
						}
					}

					var iXDiff = ZC._a_(aXPoints[2]-aXPoints[1]);

					if (iXDiff < 5) {
						aPoints.push(
							[aXPoints[0], aControlPoints[0]],
							[aXPoints[1], aControlPoints[1]],
							[aXPoints[2], aControlPoints[2]]
						);
					} else {
						var aSplinePoints = ZC.ZCMath._spline_(self.oParent.bMonotone, aControlPoints, iXDiff);
						if (self.oParent.bMidPoint) {
							for (i=0;i<ZC._i_(aSplinePoints.length/2)+(self.oStyle.fAlpha===1?1:0);i++) {
								if (bVLine) {
									aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
							for (i=ZC._i_(aSplinePoints.length/2)-1,iLen=aSplinePoints.length;i<iLen;i++) {
								if (bVLine) {
									self.oParent.aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									self.oParent.aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
						} else {
							for (i=0;i<ZC._i_(aSplinePoints.length);i++) {
								if (bVLine) {
									aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
						}
					}
				}
				break;
			case 'stepped':
				if (bPreviousNode) {
					self.oParent.getNode(self.iIndex-iStepPrev, 0).setup();
					aMP = ZC.ZCMath._mpoint_(self.oParent.aPlotNodes[self.iIndex-iStepPrev].iX, self.oParent.aPlotNodes[self.iIndex-iStepPrev].iY, self.oParent.aPlotNodes[self.iIndex].iX, self.oParent.aPlotNodes[self.iIndex].iY);
					switch (self.oParent.sStepStart) {
						
						default:
							if (bVLine) {
								aPoints.push(
									[aPlotNodes[self.iIndex-iStepPrev].iX, aMP[1]],
									[self.iX, aMP[1]]
								);
							} else {
								aPoints.push(
									[aMP[0], aPlotNodes[self.iIndex-iStepPrev].iY],
									[aMP[0], self.iY]
								);
							}
							break;
						case 'before':
							aPoints.push(
								[self.oParent.aPlotNodes[self.iIndex-iStepPrev].iX, aPlotNodes[self.iIndex-iStepPrev].iY],
								[self.oParent.aPlotNodes[self.iIndex-iStepPrev].iX, self.iY]
							);
							break;
						case 'after':
							break;
					}
				}

				aPoints.push([self.iX, self.iY]);
				
				if (bNextNode) {
					self.oParent.getNode(self.iIndex+iStepNext, 0).setup();
					aMP = ZC.ZCMath._mpoint_(self.oParent.aPlotNodes[self.iIndex+iStepPrev].iX, self.oParent.aPlotNodes[self.iIndex+iStepPrev].iY, self.oParent.aPlotNodes[self.iIndex].iX, self.oParent.aPlotNodes[self.iIndex].iY);
					switch (self.oParent.sStepStart) {
						
						default:
							aPoints.push(bVLine?[self.iX, aMP[1]]:[aMP[0], self.iY]);
							break;
						case 'before':
							break;
						case 'after':
							aPoints.push(
								[self.oParent.aPlotNodes[self.iIndex+iStepPrev].iX, self.iY],
								[self.oParent.aPlotNodes[self.iIndex+iStepPrev].iX, aPlotNodes[self.iIndex+iStepNext].iY]
							);
							break;
					}
				}
				break;
			case 'jumped':
				if (bPreviousNode) {
					self.oParent.getNode(self.iIndex-iStepPrev, 0).setup();
					aMP = ZC.ZCMath._mpoint_(self.oParent.aPlotNodes[self.iIndex-iStepPrev].iX, self.oParent.aPlotNodes[self.iIndex-iStepPrev].iY, self.oParent.aPlotNodes[self.iIndex].iX, self.oParent.aPlotNodes[self.iIndex].iY);
					aPoints.push(bVLine?[self.iX, aMP[1]]:[aMP[0], self.iY]);
				} else {
					aPoints.push(bVLine?[self.iX, self.iY - oScaleKey.iStepSize/2]:[self.iX - oScaleKey.iStepSize/2, self.iY]);
				}
				aPoints.push([self.iX, self.iY]);
				if (bNextNode) {
					self.oParent.getNode(self.iIndex+iStepNext, 0).setup();
					aMP = ZC.ZCMath._mpoint_(self.oParent.aPlotNodes[self.iIndex+iStepPrev].iX, self.oParent.aPlotNodes[self.iIndex+iStepPrev].iY, self.oParent.aPlotNodes[self.iIndex].iX, self.oParent.aPlotNodes[self.iIndex].iY);
					aPoints.push(bVLine?[self.iX, aMP[1]]:[aMP[0], self.iY]);
				} else {
					aPoints.push(bVLine?[self.iX, self.iY + oScaleKey.iStepSize/2]:[self.iX + oScaleKey.iStepSize/2, self.iY]);
				}
				break;
		}

		self.setNodeData({points : aPoints});

		if (self.oGraph.sStage !== 'ready') {
			self.oParent.aLPoints = self.oParent.aLPoints.concat(aPoints);
		}

		if (bPointsOnly || self.oGraph.oSettings['3d']) {
			return;
		}
		
		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

		if (self.oParent.oJsRule) {
			self.applyJsRule(oStyle);
		}

		ZC.ZCLine.setup(oCtxLine, oStyle);

		self.paintPreview(oStyle, aPoints);

		function _fn_end_() {
			if (!self.oGraph.bScrolling && ZC._btw_(self.iX, oScaleKey.iX - 1, oScaleKey.iX + oScaleKey.iWidth + 1) && ZC._btw_(self.iY, oScaleKey.iY - 1, oScaleKey.iY + oScaleKey.iHeight + 1)) {
				self.sharedMarker();
				self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oParent.getCanvas('bl', 1), self.oLoader.sOutput));
				
				if (self.oParent.oValueBox) {
					self.paintValueBox();
				}
			}
		}

		if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
			var oStart = new ZC.ZCShape(self), oEnd = {};
			oStart.copy(oStyle);
			oStart.sId = self.sId;
			oStart.oCanvas = self.oParent.getCanvas('bl', 1);
			oStart.oCanvasSh = self.oParent.getCanvas('bl', 0);

			oStart.aPoints = aPoints;
			oEnd.points = aPoints;

			var aPointsStart = [];
			
			var iAE = self.oParent.iAnimationEffect, oPA = self.oGraph.oPlotArea;
			oStart.fAlpha = 0;
			oEnd.alpha = oStyle.fAlpha;

			for (i=0;i<aPoints.length;i++) {
				if (iAE === 2) {
					aPointsStart[i] = [aPoints[i][0], oPA.iY + oPA.iHeight/2];
				} else if (iAE === 3) {
					aPointsStart[i] = [aPoints[i][0], oPA.iY - 5];
				} else if (iAE === 4) {
					aPointsStart[i] = [aPoints[i][0], oPA.iY + oPA.iHeight + 5];
				} else if (iAE === 5) {
					aPointsStart[i] = [oPA.iX - 5, aPoints[i][1]];
				} else if (iAE === 6) {
					aPointsStart[i] = [oPA.iX + oPA.iWidth + 5, aPoints[i][1]];
				} else if (iAE === 7) {
					aPointsStart[i] = [oPA.iX + oPA.iWidth/2, aPoints[i][1]];
				} else if (iAE === 8) {
					aPointsStart[i] = [aPoints[i][0] - oPA.iWidth, aPoints[i][1]];
				} else if (iAE === 9) {
					aPointsStart[i] = [aPoints[i][0] + oPA.iWidth, aPoints[i][1]];
				} else if (iAE === 10) {
					aPointsStart[i] = [aPoints[i][0], aPoints[i][1] - oPA.iHeight];
				} else if (iAE === 11) {
					aPointsStart[i] = [aPoints[i][0], aPoints[i][1] + oPA.iHeight];
				} else if (iAE === 12) {
					aPointsStart[i] = [(aPoints[0][0]+aPoints[aPoints.length-1][0])/2, aPoints[0][1]];
				} else if (iAE === 13) {
					aPointsStart[i] = [aPoints[0][0], (aPoints[0][1]+aPoints[aPoints.length-1][1])/2];
				}
				if (iAE > 1) {
					oStart.aPoints = aPointsStart;
					oEnd.points = aPoints;
				}
			}

			for (p in self.oParent.oAnimationAttributes) {
				oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
			}

			if (!self.oGraph.oLast) {
				self.oGraph.oLast = {};
			}
			if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
				for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
				}
			}
			self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

			

			var oTween = new ZC.ZCTween(
				oStart,
				oEnd,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					_fn_end_();
				}
			);
			oTween.oNode = self;
			oTween.oSeqFinishedCallback = function() {
				self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oParent.getCanvas('bl', 1), self.oLoader.sOutput));
			};
			oTween.oCtxLine = oCtxLine;

			self.sharedAnimationSetup(oTween);
		} else {
			ZC.ZCLine.paint(oCtxLine, oStyle, aPoints);
			_fn_end_();
		}

	},

	paintPreview : function(oStyle, aPoints) {
		var self = this;
		
		if (self.oGraph.oPreview && self.oGraph.oPreview.bInit && self.oParent.bPreview) {

			var oStyleP, aPointsPreview = self.oParent.mapPointsToPreview(aPoints);

			if (self.oParent._oStyleP) {
				oStyleP = self.oParent._oStyleP;
			} else {
				oStyleP = new ZC.ZCStyle(self);
				self.oParent._oStyleP = oStyleP;
			}
			oStyleP.copy(oStyle);
			var oCtxPreview = ZC.ZCHtmlUtils._context_(self.oGraph.oPreview.oCanvas, self.oLoader.sOutput);
			oStyleP.iLineWidth = 1;
			
			ZC.ZCLine.paint(oCtxPreview, oStyleP, aPointsPreview, null, 3);
			
		}
	},

	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }

		

		self.sharedLayerLine(sLayer);
		if (self.oParent._bShowMarkers) {
			self.sharedLayerMarker(sLayer);
		}
	}
});











ZC.ZCAreaPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.oStyle.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.oStyle.sLineColor,
			'border-color': this.oStyle.sLineColor,
			'color' : this.oStyle.sColor
		};
	},
	paint : function(bPointsOnly) {

		var self = this, mValue, iContourOffset, fSideOffset, aMPArea, aMP, i, iLen, iBackStepsArea;
		if (typeof(bPointsOnly) === 'undefined') {
			bPointsOnly = false;
		}

		self._super();

		var bVArea = self.oParent.bInverted;

		var oCtxLine = self.oParent._oCtxLine;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		var aPlotNodes = self.oParent.aPlotNodes;

		self.setup();

		if (self.oParent.bFast && !self.oGraph.oSettings['3d'] && !self.oParent._bCreateAreaMap) {
			return;
		}

		self.oStyle.bPixelCorrection = self.bPixelCorrection = false;
		self.oStyle.oCanvasSh = self.oParent.getCanvas('bl', 1);
		

		var fRefValue = oScaleVal.fRefValue;
		var iCoordRef = oScaleVal.getCoordByValue(fRefValue);
		if (bVArea) {
			iCoordRef = ZC._l_(iCoordRef, oScaleVal.iX, oScaleVal.iY + oScaleVal.iWidth);
		} else {
			iCoordRef = ZC._l_(iCoordRef, oScaleVal.iY, oScaleVal.iY + oScaleVal.iHeight);
		}

		
		var iStepOffset = oScaleKey.bRanged?oScaleKey.iStepSize/2:0;

		var aPoints = [];
		var aPointsArea = [];
		var aPointsContour = [];
		var aLastContour = null;
		if (ZC._n_(self.oParent.oParent.aLastContour) !== null && ZC._n_(self.oParent.oParent.aLastContour[self.iIndex]) !== null) {
			aLastContour = self.oParent.oParent.aLastContour[self.iIndex];
		}

		var sAspect = self.oParent.sAspect;
		if ((self.oGraph.bScrolling || self.oParent._bNormalizeAspect) && self.oParent.sAspect === 'spline') {
			sAspect = 'segmented';
		}		

		iContourOffset = self.oStyle.iLineWidth/2-1;
		
		fSideOffset = (self.oLoader.sOutput==='svg' && ZC.mobile)?self.oStyle.fAlphaArea/4:0;
		
		if (self.oLoader.sOutput === 'vml' && self.oParent.bAnimation) {
			fSideOffset = 0.5;
		}

		if (self.oGraph.oSettings['3d']) {
			if (self.oParent.fAlphaArea === 1) {
				fSideOffset = 1;
			} else {
				fSideOffset = self.oParent.fAlphaArea/3;
				if (self.oLoader.sOutput === 'canvas') {
					if (ZC.ZCQuery.browser.msie || ZC.ZCQuery.browser.opera) {
						fSideOffset = 0.5;
					}
				}
			}
			if (oScaleKey.bMirrored) {
				fSideOffset = -fSideOffset;
			}
		}

		var iStepPrev = (typeof(self.oParent.iStepPrev) !== 'undefined')?self.oParent.iStepPrev:self.oParent.iStep;
		var iStepNext = (typeof(self.oParent.iStepNext) !== 'undefined')?self.oParent.iStepNext:self.oParent.iStep;
		var bPreviousNode = true, bNextNode = true, oPreviousPlot;
		if (!aPlotNodes[self.iIndex-iStepPrev] || (!oScaleKey.bKeyValues && self.iIndex <= oScaleKey.iMinIndex)) {
			bPreviousNode = false;
		}
		if (!aPlotNodes[self.iIndex+iStepNext] || (!oScaleKey.bKeyValues && self.iIndex >= oScaleKey.iMaxIndex)) {
			bNextNode = false;
		}

		switch (sAspect) {
			
			default:				
				if (bPreviousNode) {
					self.oParent.getNode(self.iIndex-iStepPrev, 0).setup();
					if (self.oParent.bMidPoint) {
						aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex-iStepPrev].iX, aPlotNodes[self.iIndex-iStepPrev].iY, aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY);
						aPointsContour.push([ZC._i_(aMP[0])-fSideOffset, aMP[1]-iContourOffset]);
						if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
							aPointsArea.push([ZC._i_(aMP[0])-fSideOffset, iCoordRef]);
						}
						aPointsArea.push([ZC._i_(aMP[0])-fSideOffset, aMP[1]+iContourOffset]);
						aPoints.push([aMP[0], aMP[1]]);
					} else {
						aPointsArea.push([ZC._i_(self.iX), iCoordRef]);
					}
				} else {
					if (!oScaleKey.bKeyValues && self.iIndex === oScaleKey.iMinIndex) {
						if (oScaleKey.bMirrored) {
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset), iCoordRef]);
							}
							aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset), self.iY+iContourOffset]);
						} else {
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iOffsetStart + iStepOffset), iCoordRef]);
							}
							aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iOffsetStart + iStepOffset), self.iY+iContourOffset]);
						}
					} else {
						if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
							aPointsArea.push([ZC._i_(self.iX), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX - oScaleKey.iStepSize/2), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX), iCoordRef]);
						} else {
							if ((oPreviousPlot=self.oParent.oParent.aPlots[self.oParent.iIndex-1])) {
								if (oPreviousPlot.aPlotNodes[self.iIndex]) {
									aPointsArea.push([ZC._i_(self.iX), oPreviousPlot.aPlotNodes[self.iIndex].iY+iContourOffset]);
								}
							}
						}
					}
				}
				aPointsContour.push([ZC._i_(self.iX), self.iY-iContourOffset]);
				aPointsArea.push([ZC._i_(self.iX), self.iY+iContourOffset]);
				aPoints.push([self.iX, self.iY]);

				if (bNextNode) {
					self.oParent.getNode(self.iIndex+iStepNext, 2).setup();
					if (self.oParent.bMidPoint) {
						aMPArea = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY, aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY);
					} else {
						aMPArea = [aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY];
					}
					aPointsContour.push([ZC._i_(aMPArea[0]), aMPArea[1]-iContourOffset]);
					aPointsArea.push([ZC._i_(aMPArea[0]), aMPArea[1]+iContourOffset]);
					if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
						aPointsArea.push([ZC._i_(aMPArea[0]), iCoordRef]);
					}
					if (self.oParent.bMidPoint) {
						aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY, aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY, self.oStyle.fAlpha);
					} else {
						aMP = [aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY];
					}
					aPoints.push([aMP[0], aMP[1]]);
				} else {
					if (self.iIndex === oScaleKey.iMaxIndex) {
						if (oScaleKey.bMirrored) {
							aPointsArea.push([oScaleKey.iX + oScaleKey.iOffsetStart - iStepOffset, self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iOffsetStart - iStepOffset), iCoordRef]);
							}
						} else {
							aPointsArea.push([oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset, self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset), iCoordRef]);
							}
						}
					} else {
						if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
							aPointsArea.push([ZC._i_(self.iX), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX + oScaleKey.iStepSize/2), iCoordRef]);
						} else {
							if ((oPreviousPlot=self.oParent.oParent.aPlots[self.oParent.iIndex-1])) {
								if (oPreviousPlot.aPlotNodes[self.iIndex]) {
									aPointsArea.push([ZC._i_(self.iX), oPreviousPlot.aPlotNodes[self.iIndex].iY+iContourOffset]);
								}
							}
						}
					}
				}
				break;
			case 'spline':
				if (ZC._n_(self.oParent.aPointsContour) !== null) {
					aPointsContour = self.oParent.aPointsContour;
				}
				if (ZC._n_(self.oParent.aPointsArea) !== null) {
					aPointsArea = self.oParent.aPointsArea;
				}
				self.oParent.aPointsContour = [];
				self.oParent.aPointsArea = [];
				if (ZC._n_(self.oParent.aPoints) !== null) {
					aPoints = self.oParent.aPoints;
				}
				self.oParent.aPoints = [];
				if (aPlotNodes[self.iIndex+1]) {
					var aControlPoints = [], aXPoints = [];
					for (i=-1;i<3;i++) {
						if (aPlotNodes[self.iIndex+i]) {
							self.oParent.getNode(self.iIndex+i, 2).setup();
							if (bVArea) {
								aControlPoints.push(aPlotNodes[self.iIndex+i].iX);
								aXPoints.push(aPlotNodes[self.iIndex+i].iY);
							} else {
								aControlPoints.push(aPlotNodes[self.iIndex+i].iY);
								aXPoints.push(aPlotNodes[self.iIndex+i].iX);
							}
						} else {
							if (aControlPoints.length === 0) {
								if (bVArea) {
									aXPoints.push(self.iY);
									aControlPoints.push(self.iX);
								} else {
									aXPoints.push(self.iX);
									aControlPoints.push(self.iY);
								}
							} else {
								aControlPoints.push(aControlPoints[aControlPoints.length-1]);
								aXPoints.push(aXPoints[aXPoints.length-1]);
							}
						}
					}

					var iXDiff = ZC._a_(aXPoints[2]-aXPoints[1]);
					if (iXDiff < 5) {
						aPoints.push(
							[aXPoints[0], aControlPoints[0]],
							[aXPoints[1], aControlPoints[1]],
							[aXPoints[2], aControlPoints[2]]
						);
						aPointsContour.push(
							[aXPoints[0], aControlPoints[0]],
							[aXPoints[1], aControlPoints[1]],
							[aXPoints[2], aControlPoints[2]]
						);
						aPointsArea.push(
							[aXPoints[0], aControlPoints[0]],
							[aXPoints[1], aControlPoints[1]],
							[aXPoints[2], aControlPoints[2]]
						);
					} else {

						var aSplinePoints = ZC.ZCMath._spline_(self.oParent.bMonotone, aControlPoints, iXDiff);
						if (self.oParent.bMidPoint) {
							if (aPointsArea.length === 0) {
								if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
									aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[0][0]*iXDiff), iCoordRef]);
								}
							}
							for (i=0;i<ZC._i_(aSplinePoints.length/2)+(self.oStyle.fAlpha===1?1:0);i++) {
								if (bVArea) {
									aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
							for (i=0;i<ZC._i_(aSplinePoints.length/2)+(self.oStyle.fAlphaArea===1?1:0);i++) {
								aPointsContour.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]-iContourOffset]);
								aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]]);
							}
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(aPointsArea[aPointsArea.length-1][0]), iCoordRef]);
							}
							iBackStepsArea = (self.fAlphaArea === 1)?ZC._min_(2, ZC._i_(aSplinePoints.length/2)):1;
							for (i=ZC._i_(aSplinePoints.length/2)-1,iLen=aSplinePoints.length;i<iLen;i++) {
								if (bVArea) {
									self.oParent.aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									self.oParent.aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
							for (i=ZC._i_(aSplinePoints.length/2)-iBackStepsArea,iLen=aSplinePoints.length;i<iLen;i++) {
								if (self.oParent.aPointsArea.length === 0) {
									if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
										self.oParent.aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), iCoordRef]);
									}
								}
								self.oParent.aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]]);
								self.oParent.aPointsContour.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]-iContourOffset]);
							}
						} else {

							if (aPointsArea.length === 0) {
								if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
									aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[0][0]*iXDiff), iCoordRef]);
								}
							}
							for (i=0;i<aSplinePoints.length;i++) {
								if (bVArea) {
									aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
							for (i=0;i<aSplinePoints.length;i++) {
								aPointsContour.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]-iContourOffset]);
								aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]]);
							}
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(aPointsArea[aPointsArea.length-1][0]), iCoordRef]);
							}
							iBackStepsArea = (self.fAlphaArea === 1)?ZC._min_(2, ZC._i_(aSplinePoints.length/2)):1;
							for (i=aSplinePoints.length,iLen=aSplinePoints.length;i<iLen;i++) {
								if (bVArea) {
									self.oParent.aPoints.push([aSplinePoints[i][1], self.iY + (oScaleKey.bMirrored?1:-1)*aSplinePoints[i][0]*iXDiff]);
								} else {
									self.oParent.aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
								}
							}
							for (i=aSplinePoints.length-iBackStepsArea,iLen=aSplinePoints.length;i<iLen;i++) {
								if (self.oParent.aPointsArea.length === 0) {
									if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
										self.oParent.aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), iCoordRef]);
									}
								}
								self.oParent.aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]]);
								self.oParent.aPointsContour.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]-iContourOffset]);
							}

						}
					}
				} else {
					if (aPointsArea.length > 0) {
						aPointsArea.push([aPointsArea[aPointsArea.length-1][0], iCoordRef]);
					}
				}
				break;
			case 'stepped':
				if (bPreviousNode) {
					self.oParent.getNode(self.iIndex-iStepPrev, 0).setup();
					aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex-iStepPrev].iX, aPlotNodes[self.iIndex-iStepPrev].iY, aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY);

					switch (self.oParent.sStepStart) {
						
						default:
							aPointsContour.push([ZC._i_(aMP[0])-fSideOffset, self.iY-iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(aMP[0])-fSideOffset, iCoordRef]);
							}
							aPointsArea.push([ZC._i_(aMP[0])-fSideOffset, self.iY+iContourOffset]);
							aPoints.push(bVArea?[aPlotNodes[self.iIndex-iStepPrev].iX, aMP[1]]:[aMP[0], aPlotNodes[self.iIndex-iStepPrev].iY]);
							aPoints.push(bVArea?[self.iX, aMP[1]]:[aMP[0], self.iY]);
							break;
						case 'before':
							aPointsContour.push([ZC._i_(aPlotNodes[self.iIndex-iStepPrev].iX)-fSideOffset, self.iY-iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(aPlotNodes[self.iIndex-iStepPrev].iX)-fSideOffset, iCoordRef]);
							}
							aPointsArea.push([ZC._i_(aPlotNodes[self.iIndex-iStepPrev].iX)-fSideOffset, self.iY+iContourOffset]);
							aPoints.push([aPlotNodes[self.iIndex-iStepPrev].iX, aPlotNodes[self.iIndex-iStepPrev].iY]);
							aPoints.push([aPlotNodes[self.iIndex-iStepPrev].iX, self.iY]);
							break;
						case 'after':
							aPointsContour.push([ZC._i_(self.iX)-fSideOffset, self.iY-iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(self.iX)-fSideOffset, iCoordRef]);
							}
							aPointsArea.push([ZC._i_(self.iX)-fSideOffset, self.iY+iContourOffset]);
							break;	
					}
				} else {
					if (!oScaleKey.bKeyValues && self.iIndex === oScaleKey.iMinIndex) {
						if (oScaleKey.bMirrored) {
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset), iCoordRef]);
							}
							aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset), self.iY+iContourOffset]);
						} else {
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iOffsetStart + iStepOffset), iCoordRef]);
							}
							aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iOffsetStart + iStepOffset), self.iY+iContourOffset]);
						}
					} else {
						if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
							aPointsArea.push([ZC._i_(self.iX), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX - oScaleKey.iStepSize/2), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX), iCoordRef]);
						} else {
							if ((oPreviousPlot=self.oParent.oParent.aPlots[self.oParent.iIndex-1])) {
								if (oPreviousPlot.aPlotNodes[self.iIndex]) {
									aPointsArea.push([ZC._i_(self.iX), oPreviousPlot.aPlotNodes[self.iIndex].iY+iContourOffset]);
								}
							}
						}
					}
				}
				aPointsContour.push([ZC._i_(self.iX), self.iY-iContourOffset]);
				aPointsArea.push([ZC._i_(self.iX), self.iY+iContourOffset]);
				aPoints.push([self.iX, self.iY]);

				if (bNextNode) {
					self.oParent.getNode(self.iIndex+iStepNext, 2).setup();
					aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY, aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY, self.oStyle.fAlpha);

					switch (self.oParent.sStepStart) {
						
						default:
							aPointsContour.push([ZC._i_(aMP[0]), self.iY-iContourOffset]);
							aPointsArea.push([ZC._i_(aMP[0]), self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(aMP[0]), iCoordRef]);
							}
							aPoints.push(bVArea?[self.iX, aMP[1]]:[aMP[0], self.iY]);
							break;
						case 'before':
							aPointsContour.push([ZC._i_(self.iX), self.iY-iContourOffset]);
							aPointsArea.push([ZC._i_(self.iX), self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(self.iX), iCoordRef]);
							}
							break;
						case 'after':
							aPointsContour.push([ZC._i_(aPlotNodes[self.iIndex+iStepNext].iX), self.iY-iContourOffset]);
							aPointsArea.push([ZC._i_(aPlotNodes[self.iIndex+iStepNext].iX), self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(aPlotNodes[self.iIndex+iStepNext].iX), iCoordRef]);
							}
							aPoints.push([aPlotNodes[self.iIndex+iStepNext].iX, self.iY]);
							aPoints.push([aPlotNodes[self.iIndex+iStepNext].iX, aPlotNodes[self.iIndex+iStepNext].iY]);
							break;	
					}
				} else {
					if (self.iIndex === oScaleKey.iMaxIndex) {
						if (oScaleKey.bMirrored) {
							aPointsArea.push([oScaleKey.iX + oScaleKey.iOffsetStart - iStepOffset, self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iOffsetStart - iStepOffset), iCoordRef]);
							}
						} else {
							aPointsArea.push([oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset, self.iY+iContourOffset]);
							if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
								aPointsArea.push([ZC._i_(oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetEnd - iStepOffset), iCoordRef]);
							}
						}
					} else {
						if (!self.oParent.bStacked || ZC._n_(aLastContour) === null) {
							aPointsArea.push([ZC._i_(self.iX), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX), iCoordRef]);
							aPointsContour.push([ZC._i_(self.iX + oScaleKey.iStepSize/2), iCoordRef]);
						} else {
							if ((oPreviousPlot=self.oParent.oParent.aPlots[self.oParent.iIndex-1])) {
								if (oPreviousPlot.aPlotNodes[self.iIndex]) {
									aPointsArea.push([ZC._i_(self.iX), oPreviousPlot.aPlotNodes[self.iIndex].iY+iContourOffset]);
								}
							}
						}
					}
				}
				break;
		}

		if (self.oParent.bStacked && ZC._n_(aLastContour) !== null) {
			for (i=aLastContour.length-1;i>=0;i--) {
				aPointsArea.push(aLastContour[i]);
			}
		}

		self.setNodeData({
			points : aPoints,
			
			pointsarea : aPointsArea
		});

		if (self.oGraph.sStage !== 'ready') {
			self.oParent.aLPoints = self.oParent.aLPoints.concat(aPoints);
		}

		if (ZC._n_(self.oParent.oParent.aLastContour) === null) {
			self.oParent.oParent.aLastContour = [];
		}
		self.oParent.oParent.aLastContour[self.iIndex] = aPointsContour;

		if (bPointsOnly || self.oGraph.oSettings['3d']) {
			return;
		}

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

		if (self.oParent.oJsRule) {
			self.applyJsRule(oStyle);
		}

		var oPlotArea = self.oGraph.oPlotArea;

		var oArea;
		if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oArea) !== 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
			oArea = self.oParent._oArea;
		} else  {
			oArea = new ZC.ZCShape(self.oParent);
			oArea.copy(oStyle);
			oArea.fAlpha = self.oParent.fAlphaArea;
		}
		self.applyJsRule(oArea);
		oArea.bPixelCorrection = false;
		oArea.bAreaCorrection = true;
		oArea.iLineWidth = 0;
		oArea.iBorderWidth = 0;
		oArea.iLineSegmentSize = 0;
		oArea.iLineGapSize = 0;
		oArea.oCanvas = self.oParent.getCanvas('bl', self.oGraph.bStacked?0:1);
		

		

		oArea.aPoints = aPointsArea;

		oArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];

		if (ZC._n_(mValue=self.oParent.oAttributes['min-y']) !== null) {
			oArea.oAttributes['bound-1'] = mValue;
			oArea.aBounds[1] = mValue;
		}
		if (ZC._n_(mValue=self.oParent.oAttributes['max-y']) !== null) {
			oArea.oAttributes['bound-3'] = mValue;
			oArea.aBounds[3] = mValue;
		}

		oArea.sId = self.sId + '-area';
		if (!self.oParent.bAnimation) {
			oArea.oAttributes['areanode'] = true;
		}

		ZC.ZCLine.setup(oCtxLine, oStyle);

		self.paintPreview(oStyle, aPoints, aPointsArea);

		function _fn_end_() {
			if (!self.oGraph.bScrolling && ZC._btw_(self.iX, oScaleKey.iX - 1, oScaleKey.iX + oScaleKey.iWidth + 1) && ZC._btw_(self.iY, oScaleKey.iY - 1, oScaleKey.iY + oScaleKey.iHeight + 1)) {
				self.sharedMarker();
				self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oParent.getCanvas('bl', 1), self.oLoader.sOutput));
				
				if (self.oParent.oValueBox) {
					self.paintValueBox();
				}
			}
		}

		if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
			var oStart = new ZC.ZCShape(self), oEnd = {};
			oStart.copy(oStyle);
			oStart.sId = self.sId;
			oStart.oCanvas = self.oParent.getCanvas('bl', 2);
			oStart.oCanvasSh = self.oParent.getCanvas('bl', 1);
			oStart.aPoints = aPoints;

			var oStartArea = oArea, oEndArea = {};
			var aPointsStart = [], aPointsStartArea = [];

			oStart.aPoints = aPoints;
			oEnd.points = aPoints;
			oStartArea.aPoints = aPointsArea;
			oEndArea.points = aPointsArea;

			var iAE = self.oParent.iAnimationEffect, oPA = self.oGraph.oPlotArea;
			oStart.fAlpha = 0;
			oEnd.alpha = oStyle.fAlpha;
			oStartArea.fAlpha = 0;
			oEndArea.alpha = self.oParent.fAlphaArea;

			var _translate_ = function(bArea) {
				var aP = bArea?aPointsArea:aPoints, aPS = bArea?aPointsStartArea:aPointsStart;
				for (var i=0;i<aP.length;i++) {
					if (iAE === 2) {
						aPS[i] = [aP[i][0], oPA.iY + self.oGraph.oPlotArea.iHeight/2];
					} else if (iAE === 3) {
						aPS[i] = [aP[i][0], oPA.iY - 5];
					} else if (iAE === 4) {
						aPS[i] = [aP[i][0], oPA.iY + oPA.iHeight + 5];
					} else if (iAE === 5) {
						aPS[i] = [oPA.iX - 5, aP[i][1]];
					} else if (iAE === 6) {
						aPS[i] = [oPA.iX + oPA.iWidth + 5, aP[i][1]];
					} else if (iAE === 7) {
						aPS[i] = [oPA.iX + oPA.iWidth/2, aP[i][1]];
					} else if (iAE === 8) {
						aPS[i] = [aP[i][0] - oPA.iWidth, aP[i][1]];
					} else if (iAE === 9) {
						aPS[i] = [aP[i][0] + oPA.iWidth, aP[i][1]];
					} else if (iAE === 10) {
						aPS[i] = [aP[i][0], aP[i][1] - oPA.iHeight];
					} else if (iAE === 11) {
						aPS[i] = [aP[i][0], aP[i][1] + oPA.iHeight];
					} else if (iAE === 12) {
						aPS[i] = [(aP[0][0]+aP[aP.length-1][0])/2, aP[0][1]];
					} else if (iAE === 13) {
						aPS[i] = [aP[0][0], (aP[0][1]+aP[aP.length-1][1])/2];
					}
					if (iAE > 1) {
						if (bArea) {
							oStartArea.aPoints = aPointsStartArea;
							oEndArea.points = aPointsArea;
						} else {
							oStart.aPoints = aPointsStart;
							oEnd.points = aPoints;
						}
					}
				}
			};

			_translate_();
			_translate_(true);

			var p;
			for (p in self.oParent.oAnimationAttributes) {
				oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
				oStartArea[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEndArea[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
			}

			if (ZC._n_(self.oGraph.oLast) === null) {
				self.oGraph.oLast = {};
			}
			if (ZC._n_(self.oGraph.oLastArea) === null) {
				self.oGraph.oLastArea = {};
			}
			if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
				for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
				}
				for (p in self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex]) {
					oStartArea[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex][p];
				}
			}
			self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);
			self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEndArea, self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex]);

			var oTween = new ZC.ZCTween(
				oStart,
				oEnd,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					_fn_end_();
				}
			);
			oTween.oNode = self;
			oTween.oSeqFinishedCallback = function() {
				self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oParent.getCanvas('bl', 1), self.oLoader.sOutput));
			};
			oTween.oCtxLine = oCtxLine;

			var oTweenArea = new ZC.ZCTween(
				oStartArea,
				oEndArea,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					
				}
			);
			oTweenArea.oNode = self;

			self.sharedAnimationSetup(oTween, oTweenArea);
		} else {
			oArea.paint();
			if (self.oParent.aRules.length === 0 && typeof(self.oParent._oArea) === 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
				self.oParent._oArea = oArea;
			}
			ZC.ZCLine.paint(oCtxLine, oStyle, aPoints);
			_fn_end_();
		}
	},

	paintPreview : function(oStyle, aPoints, aPointsArea) {
		var self = this;
		
		if (self.oGraph.oPreview && self.oGraph.oPreview.bInit && self.oParent.bPreview) {
			var oPlotArea = self.oGraph.oPlotArea;
			var oPreview = self.oGraph.oPreview;

			var aPointsAreaPreview = self.oParent.mapPointsToPreview(aPointsArea);

			var oAreaPreview = new ZC.ZCShape(self.oParent);
			oAreaPreview.copy(oStyle);
			oAreaPreview.bPixelCorrection = true;
			oAreaPreview.bAreaCorrection = true;
			oAreaPreview.iLineWidth = 0;
			oAreaPreview.iBorderWidth = 0;
			oAreaPreview.iLineSegmentSize = 0;
			oAreaPreview.iLineGapSize = 0;
			oAreaPreview.fAlpha = self.oParent.fAlphaArea;
			oAreaPreview.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
			oAreaPreview.sId = self.sId + '-area-preview';
			oAreaPreview.oCanvas = oPreview.oCanvas;
			oAreaPreview.aPoints = aPointsAreaPreview;
			oAreaPreview.paint();

			var oStyleP, aPointsPreview = self.oParent.mapPointsToPreview(aPoints);
			if (self.oParent._oStyleP) {
				oStyleP = self.oParent._oStyleP;
			} else {
				oStyleP = new ZC.ZCStyle(self);
				self.oParent._oStyleP = oStyleP;
			}
			oStyleP.copy(oStyle);
			var oCtxPreview = ZC.ZCHtmlUtils._context_(oPreview.oCanvas, self.oLoader.sOutput);
			oStyleP.iLineWidth = 1;
			
			ZC.ZCLine.paint(oCtxPreview, oStyleP, aPointsPreview, null, 3);
			
		}
	},

	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }

		if (!self.oParent.bInverted) {
			self.sharedLayerSetup({
				layer : sLayer,
				type : 'area',
				initcb : function() {
					this.sBackgroundColor1 = self.oParent.aPalette[2];
					this.sBackgroundColor2 = self.oParent.aPalette[2];
					this.aPoints = self.getNodeData('pointsarea') || [];
				},
				setupcb : function() {
					this.iLineWidth = 0;
					this.iBorderWidth = 0;
					this.fAlpha = self.oParent.fAlphaArea;
					var oPlotArea = self.oGraph.oPlotArea;
					this.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
				}
			});
		}
		self.sharedLayerLine(sLayer);
		if (self.oParent._bShowMarkers) {
			self.sharedLayerMarker(sLayer);
		}
	}
});











ZC.ZCVBarPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getHookXY : function() {
		var self = this;
		self.paint(true);
		return [self.iX + self.iWidth/2, self.iY, {reference:self, center:true}];
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var sPlacement = 'top-out';
		var oScaleVal = self.oGraph.getScaleByName(self.oParent.getScales('v')[0]);

		var iFactor = ((self.fValue >= oScaleVal.fRefValue && !oScaleVal.bMirrored)||(self.fValue < oScaleVal.fRefValue && oScaleVal.bMirrored))?1:-1;		

		oValueBox = self.setupValueBoxWH(oValueBox);

		if (ZC._n_(oValueBox.oData['placement']) !== null) {
			sPlacement = oValueBox.oData['placement'];
		}
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var iX = self.iX + self.iWidth/2 - iWidth/2;
		
		var iY = self.iYVal - iHeight/2;
		
		switch (sPlacement) {
			case 'top-out':
			case 'top':
				iY -= iFactor*(iHeight/2 + 5);
				break;
			case 'top-in':
				iY += iFactor*(iHeight/2 + 5);
				break;
			case 'middle':
				iY += iFactor*(self.iHeight/2);
				break;
			case 'bottom-in':
				iY += iFactor*(self.iHeight - iHeight/2 - 5);
				break;
			case 'bottom-out':
			case 'bottom':
				iY += iFactor*(self.iHeight + iHeight/2 + 5);
				break;
			case 'over':
				break;
			default:
				break;
		}
		
		if (ZC._n_(oValueBox.oData['x']) !== null || ZC._n_(oValueBox.oData['y']) !== null) {
			if (ZC._n_(oValueBox.oData['x']) !== null) {
				iX = oValueBox.iX;
			}
			if (ZC._n_(oValueBox.oData['y']) !== null) {
				iY = oValueBox.iY;
			}
		} else {
			if (
				!ZC.ZCMath._boxinbox_(self, self.oGraph.oPlotArea)
				&&
				(
					iX < self.oGraph.oPlotArea.iX || iX > self.oGraph.oPlotArea.iX+self.oGraph.oPlotArea.iWidth
					||
					iY < self.oGraph.oPlotArea.iY || iY > self.oGraph.oPlotArea.iY+self.oGraph.oPlotArea.iHeight
				)
			) {
				return [-1, -1];
			}
		}
		return [ZC._i_(iX), ZC._i_(iY)];
	},
	getPMap : function() {
		var oMap = this._super();
		this.addPMap(oMap, 'barWidth', 'iWidth');
		return oMap;
	},	
	paint : function(bPosOnly) {

		var self = this, mValue;
		self._super();

		if (self.oGraph.oSettings['3d']) {
			return;
		}

		if (typeof(bPosOnly) === 'undefined') {
			bPosOnly = false;
		}

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		var fRefValue = oScaleVal.fRefValue;
		var iYRef = oScaleVal.getCoordByValue(fRefValue);
		

		var oInfo = self.oParent.sharedBarDimensions();
		var iStepSize = oInfo.iStepSize,
			iBarIndex = oInfo.iBarIndex,
			iBarsSpaceLeft = oInfo.iBarsSpaceLeft,
			iBarsSpaceRight = oInfo.iBarsSpaceRight,
			iBarSpace = oInfo.iBarSpace,
			iBarWidth = oInfo.iBarWidth,
			iBarsOverlap = oInfo.iBarsOverlap;

		var iStackTotal, iYPrevious, iHeight, iHT, iHB;

		if (self.oParent.bStacked) {
			
			iStackTotal = 0;
			var aPlotsIdx = self.oParent.oParent.aPlotGroups[iBarIndex];
			for (var i=0;i<aPlotsIdx.length;i++) {
				var oNode = self.oParent.oParent.aPlots[aPlotsIdx[i]].aPlotNodes[self.iIndex];
				if (oNode) {
					iStackTotal += oNode.fValue;
				}
			}
		}

		var fRatioBottom = 1, fRatioTop = 1;
		if (self.oParent.bStacked) {
			if (self.fAbsoluteValue !== self.fValue) {
				fRatioBottom = (iStackTotal-self.fAbsoluteValue+self.fValue)/iStackTotal;
			}
			fRatioTop = (iStackTotal-self.fAbsoluteValue)/iStackTotal;
		}
		if (oScaleVal.bMirrored) {
			
			var fRatio = fRatioBottom;
			fRatioBottom = fRatioTop;
			fRatioTop = fRatio;
		}

		var iX = self.iX - iStepSize/2 + iBarsSpaceLeft + iBarIndex*(iBarWidth + iBarSpace) - iBarIndex*iBarsOverlap;
		iX = ZC._l_(iX, self.iX - iStepSize/2 + iBarsSpaceLeft, self.iX + iStepSize/2 - iBarsSpaceRight);

		if (self.oParent.iBarWidth > 0) {
			var iBarWidth_ = iBarWidth;
			iBarWidth = self.oParent.iBarWidth;
			if (iBarWidth <= 1) {
				iBarWidth *= iBarWidth_;
			}
			
			iX = iX + (iBarWidth_-iBarWidth)/2;
		}

		var iWidth = iBarWidth;
		var iY = self.iY;

		var iOffsetValue = (ZC._n_(self.oParent.aOffsetValues[self.iIndex]) !== null)?self.oParent.aOffsetValues[self.iIndex]:0;
		if (self.oParent.sStackType === '100%') {
			iY = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
		} else {
			iY = oScaleVal.getCoordByValue(self.fAbsoluteValue+iOffsetValue);
		}
		if (self.oParent.bStacked) {
			if (self.oParent.sStackType === '100%') {
				iYPrevious = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue-self.fValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
			} else {
				iYPrevious = oScaleVal.getCoordByValue(self.fAbsoluteValue-self.fValue+iOffsetValue);
			}
			iHeight = iY - iYPrevious;
			if (self.fValue < 0) {
				iY = iYPrevious;
			}
			if (oScaleVal.bMirrored) {
				if (iHeight > 0) {
					iHeight = ZC._a_(iHeight);
					iY = iYPrevious;
				}				
			} else {
				if (iHeight < 0) {
					iHeight = ZC._a_(iHeight);
					iY = iYPrevious - iHeight;
				}
			}
		} else {
			iYPrevious = oScaleVal.getCoordByValue(oScaleVal.fRefValue+iOffsetValue);
			iHeight = iY - iYPrevious;
			if (iHeight < 0) {
				iHeight = ZC._a_(iHeight);
				iY = iYPrevious - iHeight;
			} else {
				iY = iYPrevious;
			}
		}

		if (iHeight < 1 && (self.fValue > 0 || self.oParent.bShowZero)) {
			iHeight = 1;
			if (oScaleVal.bMirrored) {
				if (self.oParent.bStacked) {
					if (self.oParent.iIndex > 0) {
						iY -= 1;
					}
				}
			} else {
				if (self.oParent.bStacked) {
					if (self.oParent.iIndex === 0) {
						iY -= 1;
					}
				} else {
					iY = iYRef - 2;
				}
			}
		}

		self.iWidth = iWidth;
		self.iHeight = iHeight;
		self.iX = iX;
		self.iY = iY;

		if (oScaleVal.bMirrored) {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iYVal = iY + self.iHeight;
			} else {
				self.iYVal = iY;
			}
		} else {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iYVal = iY;
			} else {
				self.iYVal = iY + self.iHeight;
			}
		}

		if (self.oGraph.oCrosshairX) {
			var sAlignment = 'middle';
			if (self.oGraph.oCrosshairX.oData['marker'] && ZC._n_(mValue=self.oGraph.oCrosshairX.oData['marker']['alignment']) !== null) {
				sAlignment = mValue;
			}
			if (ZC._n_(self.oParent.oData['guide-marker']) !== null && ZC._n_(mValue=self.oParent.oData['guide-marker']['alignment']) !== null) {
				sAlignment = mValue;
			}
			if (sAlignment === 'node') {
				self.oAttributes['iGuideX'] = self.iX + self.iWidth/2;
			}
		}

		if (bPosOnly) {
			return;
		}

		self.setNodeData({
			x : iX,
			y : iY,
			w : iWidth,
			h : iHeight
		});

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

		if (self.bVisible) {
			
			var oBar;

			switch (self.oParent.sAspect) {
				
				default:
					if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oBar) !== 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
						oBar = self.oParent._oBar;
					} else {
						oBar = new ZC.ZCBox(self.oParent);
						oBar.copy(oStyle);
					}
					
					if (self.oParent.oJsRule) {
						self.applyJsRule(oBar);
					}
					
					oBar.sId = self.sId;
					oBar.iX = iX;
					oBar.iY = iY;
					oBar.iWidth = self.iWidth;
					oBar.iHeight = self.iHeight;
					if (oScaleKey.iStepSize < 20) {
						oBar.iWidth = ZC._max_(1, oBar.iWidth) + 1;
						oBar.bBoxCorrection = false;
						oBar.bPixelCorrection = false;
					} else {
						oBar.bBoxCorrection = true;
						oBar.bPixelCorrection = true;
					}
					
					

					break;
				case 'pyramid':
				case 'cone':
					if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oBar) !== 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
						oBar = self.oParent._oBar;
					} else {
						oBar = new ZC.ZCShape(self.oParent);
						oBar.copy(oStyle);
					}
					oBar.sId = self.sId;

					if (oScaleVal.bMirrored && !self.oParent.bStacked) {
						iHB = self.fValue>=0?0:self.iHeight;
						iHT = self.fValue>=0?self.iHeight:0;
					} else {
						iHB = self.fValue>=0?self.iHeight:0;
						iHT = self.fValue>=0?0:self.iHeight;
					}

					oBar.aPoints = [];
					oBar.aPoints.push(
						[iX+self.iWidth/2-fRatioBottom*self.iWidth/2, iY+iHB],
						[iX+self.iWidth/2+fRatioBottom*self.iWidth/2, iY+iHB]
					);
					if (self.oParent.bStacked && fRatioTop !== 0) {
						oBar.aPoints.push(
							[iX+self.iWidth/2+fRatioTop*self.iWidth/2, iY+iHT],
							[iX+self.iWidth/2-fRatioTop*self.iWidth/2, iY+iHT]
						);
					} else {
						oBar.aPoints.push([iX+self.iWidth/2, iY+iHT]);
					}
					oBar.aPoints.push([oBar.aPoints[0][0], oBar.aPoints[0][1]]);

					self.setNodeData({points : oBar.aPoints});
					oBar.iX = iX;
					oBar.iY = iY;
					oBar.locate(2);
					break;
			}

			oBar.oCanvas = self.oParent.getCanvas('bl', 1);
			oBar.oCanvasSh = self.oParent.getCanvas('bl', 0);
			

			self.paintPreview(oStyle);

			var _fn_end_ = function() {
				if (typeof(self.paint_) !== 'undefined') {
					self.paint_();
				}
				self.sharedErrors(ZC.ZCHtmlUtils._context_(oBar.oCanvas, self.oLoader.sOutput));
				
				if (self.oParent._bCreateAreaMap && ZC._indexof_(self.oLoader.aFlags, 'skip_segment_tracking') === -1) {
					var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
					
					
					var fOffsetX = iWidth<3?1:-1;
					var fOffsetY = iHeight<3?1:-1;
					
					var sHtmlArea = ZC.ZCHtmlUtils._area_start_('rect', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + ZC._i_(iX+ZC.MAPTX-fOffsetX) + ',' + ZC._i_(iY+ZC.MAPTX-fOffsetY) + ',' + ZC._i_(iX+iWidth+ZC.MAPTX+fOffsetX) + ',' + ZC._i_(iY+iHeight+ZC.MAPTX+fOffsetY) + '" />';
					self.oParent.oParent.aAreas.push(sHtmlArea);
					
				}
				if (self.oParent.oValueBox) {
					self.paintValueBox();
				}
			};

			if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
				var oStart = oBar, oEnd = {};

				oStart.iX = iX;
				oStart.iY = iY;
				oStart.iWidth = iWidth;
				oStart.iHeight = iHeight;

				oEnd.x = iX;
				oEnd.y = iY;
				oEnd.width = iWidth;
				oEnd.height = iHeight;

				var iAE = self.oParent.iAnimationEffect, oPA = self.oGraph.oPlotArea;
				oStart.fAlpha = 0;
				oEnd.alpha = oStyle.fAlpha;

				if (iAE === 2) {
					oStart.iY = oPA.iY + oPA.iHeight/2;
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
					oEnd.y = iY;
				} else if (iAE === 3) {
					oStart.iY = oPA.iY;
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
					oEnd.y = iY;
				} else if (iAE === 4) {
					oStart.iY = oPA.iY + oPA.iHeight;
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
					oEnd.y = iY;
				} else if (iAE === 5) {
					oStart.iX = oPA.iX;
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
					oEnd.x = iX;
				} else if (iAE === 6) {
					oStart.iX = oPA.iX + oPA.iWidth;
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
					oEnd.x = iX;
				} else if (iAE === 7) {
					oStart.iX = oPA.iX + oPA.iWidth/2;
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
					oEnd.x = iX;
				} else if (iAE === 8) {
					oStart.iX = iX - oPA.iWidth;
					oEnd.x = iX;
				} else if (iAE === 9) {
					oStart.iX = iX + oPA.iWidth;
					oEnd.x = iX;
				} else if (iAE === 10) {
					oStart.iY = iY - oPA.iHeight;
					oEnd.y = iY;
				} else if (iAE === 11) {
					oStart.iY = iY + oPA.iHeight;
					oEnd.y = iY;
				} else if (iAE === 12) {
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
				} else if (iAE === 13) {
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
				}

				var p;

				for (p in self.oParent.oAnimationAttributes) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
					oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
				}

				if (ZC._n_(self.oGraph.oLast) === null) {
					self.oGraph.oLast = {};
				}
				if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
					for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
						oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
					}
				}
				self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
				ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

				

				var oTween = new ZC.ZCTween(
					oStart,
					oEnd,
					self.oParent.fAnimationSpeed,
					self.oParent.fAnimationDelay,
					ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
					function() {
						_fn_end_();
					}
				);
				oTween.oNode = self;
				oTween.oSeqFinishedCallback = function() {
					self.sharedErrors(ZC.ZCHtmlUtils._context_(oBar.oCanvas, self.oLoader.sOutput));
				};

				self.sharedAnimationSetup(oTween);

				
			} else {
				oBar.paint();
				_fn_end_();
			}

			if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oBar) === 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
				if (!self.oParent.bAnimation) {
					self.oParent._oBar = oBar;
				}
			}

		}

	},

	paintPreview : function(oStyle) {
		var self = this, oBarPreview;
		
		if (self.oGraph.oPreview && self.oGraph.oPreview.bInit && self.oParent.bPreview) {
			var oPlotArea = self.oGraph.oPlotArea;
			var oPreview = self.oGraph.oPreview;
			var oViewport = oPreview.oViewport;
			var fRatioX = (self.iX-oPlotArea.iX)/oPlotArea.iWidth;
			var fRatioY = (self.iY-oPlotArea.iY)/oPlotArea.iHeight;
			if (self.oParent._oBarPreview) {
				oBarPreview = self.oParent._oBarPreview;
			} else {
				oBarPreview = new ZC.ZCBox(self.oParent);
				self.oParent._oBarPreview = oBarPreview;
			}
			oBarPreview.copy(oStyle);
			oBarPreview.sId = self.sId + '-preview';
			oBarPreview.iX = oViewport.iX + oViewport.iBorderWidth + fRatioX*(oViewport.iWidth-2*oViewport.iBorderWidth);
			oBarPreview.iY = oViewport.iY + oViewport.iBorderWidth + fRatioY*(oViewport.iHeight-2*oViewport.iBorderWidth);
			
			oBarPreview.iWidth = (self.iWidth/oPlotArea.iWidth)*(oViewport.iWidth-2*oViewport.iBorderWidth);
			oBarPreview.iHeight = (self.iHeight/oPlotArea.iHeight)*(oViewport.iHeight-2*oViewport.iBorderWidth);
			if (oViewport.iWidth/self.oParent.aPlotNodes.length < 10) {
				oBarPreview.iWidth = oBarPreview.iWidth + 0.5;
				oBarPreview.bBoxCorrection = false;
				oBarPreview.bPixelCorrection = false;
			} else {
				oBarPreview.bBoxCorrection = true;
				oBarPreview.bPixelCorrection = true;
			}
			oBarPreview.oCanvas = oBarPreview.oCanvasSh = oPreview.oCanvas;
			oBarPreview.paint();
		}
	},

	showLayer : function(sLayer) {
		var self = this;
		sLayer = sLayer || 'hover';
		if (ZC.move) { return; }
		var sType = '';
		switch (self.oParent.sAspect) {
			
			default:
				sType = 'box';
				break;
			case 'pyramid':
				sType = 'shape';
				break;
		}
		self.sharedLayerSetup({
			layer : sLayer,
			type : sType,
			initcb : function() {
				this.sLineColor = self.oParent.aPalette[1];
				this.sBorderColor = self.oParent.aPalette[1];
				this.sBackgroundColor1 = self.oParent.aPalette[3];
				this.sBackgroundColor2 = self.oParent.aPalette[2];
			},
			setupcb : function() {
				switch (self.oParent.sAspect) {
					
					default:
						this.iX = self.getNodeData('x');
						this.iY = self.getNodeData('y');
						this.iWidth = self.getNodeData('w');
						this.iHeight = self.getNodeData('h');
						var oPlotArea = self.oGraph.oPlotArea;
						if (this.iY < oPlotArea.iY) {
							this.iHeight = this.iHeight - (oPlotArea.iY - this.iY);
							this.iY = oPlotArea.iY;
						}
						if (this.iY + this.iHeight > oPlotArea.iY + oPlotArea.iHeight) {
							this.iHeight = oPlotArea.iY + oPlotArea.iHeight - this.iY;
						}
						break;
					case 'pyramid':
					case 'cone':
						this.aPoints = self.getNodeData('points');
						break;
				}
			}
		});
		self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oGraph.sId + '-hover-c', self.oLoader.sOutput), true);
	}
});











ZC.ZCHBarPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getHookXY : function() {
		var self = this;
		self.paint(true);
		return [self.iX, self.iY + self.iHeight/2, {reference:self, center:true}];
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var sPlacement = 'top-out';
		var oScaleVal = self.oGraph.getScaleByName(self.oParent.getScales('v')[0]);
		
		var iFactor = ((self.fValue >= oScaleVal.fRefValue && !oScaleVal.bMirrored)||(self.fValue < oScaleVal.fRefValue && oScaleVal.bMirrored))?-1:1;

		if (ZC._n_(oValueBox.oData['placement']) !== null) {
			sPlacement = oValueBox.oData['placement'];
		}
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var iX = self.iXVal - iWidth/2;
		var iY = self.iY + self.iHeight/2 - iHeight/2;
		switch (sPlacement) {
			case 'top-out':
			case 'top':
				iX -= iFactor*(iWidth/2 + 5);
				break;
			case 'top-in':
				iX += iFactor*(iWidth/2 + 5);
				break;
			case 'middle':
				iX += iFactor*(self.iWidth/2);
				break;
			case 'bottom-in':
				iX += iFactor*(self.iWidth - iWidth/2 - 5);
				break;
			case 'bottom-out':
			case 'bottom':
				iX += iFactor*(self.iWidth + iWidth/2 + 5);
				break;
			case 'over':
				break;
			default:
				break;
		}
		if (ZC._n_(oValueBox.oData['x']) !== null || ZC._n_(oValueBox.oData['y']) !== null) {
			if (ZC._n_(oValueBox.oData['x']) !== null) {
				iX = oValueBox.iX;
			}
			if (ZC._n_(oValueBox.oData['y']) !== null) {
				iY = oValueBox.iY;
			}
		} else {
			if (
				!ZC.ZCMath._boxinbox_(self, self.oGraph.oPlotArea)
				&&
				(
					iX < self.oGraph.oPlotArea.iX || iX > self.oGraph.oPlotArea.iX+self.oGraph.oPlotArea.iWidth
					||
					iY < self.oGraph.oPlotArea.iY || iY > self.oGraph.oPlotArea.iY+self.oGraph.oPlotArea.iHeight
				)
			) {
				return [-1, -1];
			}
		}
		return [ZC._i_(iX), ZC._i_(iY)];
	},
	paint : function(bPosOnly) {
		var self = this;
		self._super();

		if (self.oGraph.oSettings['3d']) {
			return;
		}

		if (typeof(bPosOnly) === 'undefined') {
			bPosOnly = false;
		}

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		var fRefValue = oScaleVal.fRefValue;
		var iXRef = oScaleVal.getCoordByValue(fRefValue);
		

		var oInfo = self.oParent.sharedBarDimensions();
		var iStepSize = oInfo.iStepSize,
			iBarIndex = oInfo.iBarIndex,
			iBarsSpaceLeft = oInfo.iBarsSpaceLeft,
			iBarsSpaceRight = oInfo.iBarsSpaceRight,
			iBarSpace = oInfo.iBarSpace,
			iBarWidth = oInfo.iBarWidth,
			iBarsOverlap = oInfo.iBarsOverlap;

		var iStackTotal, iXPrevious, iWidth, iWT, iWB;

		if (self.oParent.bStacked) {
			
			iStackTotal = 0;
			var aPlotsIdx = self.oParent.oParent.aPlotGroups[iBarIndex];
			for (var i=0;i<aPlotsIdx.length;i++) {
				var oNode = self.oParent.oParent.aPlots[aPlotsIdx[i]].aPlotNodes[self.iIndex];
				if (oNode) {
					iStackTotal += oNode.fValue;
				}
			}
		}

		var fRatioBottom = 1, fRatioTop = 1;
		if (self.oParent.bStacked) {
			if (self.fAbsoluteValue !== self.fValue) {
				fRatioBottom = (iStackTotal-self.fAbsoluteValue+self.fValue)/iStackTotal;
			}
			fRatioTop = (iStackTotal-self.fAbsoluteValue)/iStackTotal;
		}
		if (oScaleVal.bMirrored) {
			
			var fRatio = fRatioBottom;
			fRatioBottom = fRatioTop;
			fRatioTop = fRatio;
		}

		var iY = self.iY - iStepSize/2 + iBarsSpaceLeft + iBarIndex*(iBarWidth + iBarSpace) - iBarIndex*iBarsOverlap;
		iY = ZC._l_(iY, self.iY - iStepSize/2 + iBarsSpaceLeft, self.iY + iStepSize/2 - iBarsSpaceRight);

		if (self.oParent.iBarWidth > 0) {
			var iBarWidth_ = iBarWidth;
			iBarWidth = self.oParent.iBarWidth;
			if (iBarWidth <= 1) {
				iBarWidth *= iBarWidth_;
			}
			
			iY = iY + (iBarWidth_-iBarWidth)/2;
		}

		var iHeight = iBarWidth;
		var iX = self.iX;

		var iOffsetValue = (ZC._n_(self.oParent.aOffsetValues[self.iIndex]) !== null)?self.oParent.aOffsetValues[self.iIndex]:0;
		if (self.oParent.sStackType === '100%') {
			iX = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
		} else {
			iX = oScaleVal.getCoordByValue(self.fAbsoluteValue+iOffsetValue);
		}
		if (self.oParent.bStacked) {
			if (self.oParent.sStackType === '100%') {
				iXPrevious = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue-self.fValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
			} else {
				iXPrevious = oScaleVal.getCoordByValue(self.fAbsoluteValue-self.fValue+iOffsetValue);
			}
			iWidth = iX - iXPrevious;
			if (self.fValue > 0) {
				iX = iXPrevious;
			} else {
				iWidth = ZC._a_(iWidth);
			}
			if (oScaleVal.bMirrored) {
				if (iWidth > 0) {
					iWidth = ZC._a_(iWidth);
					iX = iXPrevious;
				} else {
					iWidth = ZC._a_(iWidth);
					iX = iX - iWidth;
				}
			} else {
				if (iWidth < 0) {
					iWidth = ZC._a_(iWidth);
					iX = iXPrevious - iWidth;
				}
			}
		} else {
			iXPrevious = oScaleVal.getCoordByValue(oScaleVal.fRefValue+iOffsetValue);
			iWidth = iX - iXPrevious;
			if (iWidth < 0) {
				iWidth = ZC._a_(iWidth);
				iX = iXPrevious - iWidth;
			} else {
				iX = iXPrevious;
			}
		}

		if (iWidth < 1 && (self.fValue > 0 || self.oParent.bShowZero)) {
			iWidth = 1;
			if (oScaleVal.bMirrored) {
				if (self.oParent.bStacked) {
					if (self.oParent.iIndex === 0) {
						iX -= 1;
					}
				} else {
					iX -= 2;
				}
			} else {
				if (self.oParent.iIndex > 0 && self.oParent.bStacked) {
					iX -= 1;
				}
			}
		}

		self.iWidth = iWidth;
		self.iHeight = iHeight;
		self.iX = iX;
		self.iY = iY;

		if (oScaleVal.bMirrored) {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iXVal = iX;
			} else {
				self.iXVal = iX + self.iWidth;
			}
		} else {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iXVal = iX + self.iWidth;
			} else {
				self.iXVal = iX;
			}
		}

		if (bPosOnly) {
			return;
		}

		self.setNodeData({
			x : iX,
			y : iY,
			w : iWidth,
			h : iHeight
		});

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

		if (self.bVisible) {
			
			var oBar;

			switch (self.oParent.sAspect) {
				
				default:
					if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oBar) !== 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
						oBar = self.oParent._oBar;
					} else  {
						oBar = new ZC.ZCBox(self.oParent);
						oBar.copy(oStyle);
					}

					if (self.oParent.oJsRule) {
						self.applyJsRule(oBar);
					}
					
					oBar.sId = self.sId;
					oBar.iX = iX;
					oBar.iY = iY;
					oBar.iWidth = self.iWidth;
					oBar.iHeight = self.iHeight;
					if (oScaleKey.iStepSize < 20) {
						oBar.iHeight = ZC._max_(1, oBar.iHeight) + 1;
						oBar.bBoxCorrection = false;
						oBar.bPixelCorrection = false;
					} else {
						oBar.bBoxCorrection = true;
						oBar.bPixelCorrection = true;
					}
					break;
				case 'pyramid':
				case 'cone':
					if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oBar) !== 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
						oBar = self.oParent._oBar;
					} else  {
						oBar = new ZC.ZCShape(self.oParent);
						oBar.copy(oStyle);
					}
					oBar.sId = self.sId;

					if (oScaleVal.bMirrored && !self.oParent.bStacked) {
						iWB = self.fValue>=0?self.iWidth:0;
						iWT = self.fValue>=0?0:self.iWidth;
					} else {
						iWB = self.fValue>=0?0:self.iWidth;
						iWT = self.fValue>=0?self.iWidth:0;
					}

					oBar.aPoints = [];
					oBar.aPoints.push(
						[iX+iWB, iY+self.iHeight/2-fRatioBottom*self.iHeight/2],
						[iX+iWB, iY+self.iHeight/2+fRatioBottom*self.iHeight/2]
					);
					if (self.oParent.bStacked && fRatioTop !== 0) {
						oBar.aPoints.push(
							[iX+iWT, iY+self.iHeight/2+fRatioTop*self.iHeight/2],
							[iX+iWT, iY+self.iHeight/2-fRatioTop*self.iHeight/2]
						);
					} else {
						oBar.aPoints.push([iX+iWT, iY+self.iHeight/2]);
					}
					oBar.aPoints.push([oBar.aPoints[0][0], oBar.aPoints[0][1]]);

					self.oAttributes['points'] = oBar.aPoints;
					oBar.iX = iX;
					oBar.iY = iY;
					oBar.locate(2);
					break;
			}


			oBar.oCanvas = self.oParent.getCanvas('bl', 1);
			oBar.oCanvasSh = self.oParent.getCanvas('bl', 0);
			

			var _fn_end_ = function() {
				if (typeof(self.paint_) !== 'undefined') {
					self.paint_();
				}
				self.sharedErrors(ZC.ZCHtmlUtils._context_(oBar.oCanvas, self.oLoader.sOutput));
				
				if (self.oParent._bCreateAreaMap && ZC._indexof_(self.oLoader.aFlags, 'skip_segment_tracking') === -1) {
					var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
					
					
					var fOffsetX = iWidth<3?1:-1;
					var fOffsetY = iHeight<3?1:-1;
					
					var sHtmlArea = ZC.ZCHtmlUtils._area_start_('rect', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + ZC._i_(iX+ZC.MAPTX-fOffsetX) + ',' + ZC._i_(iY+ZC.MAPTX-fOffsetY) + ',' + ZC._i_(iX+iWidth+ZC.MAPTX+fOffsetX) + ',' + ZC._i_(iY+iHeight+ZC.MAPTX+fOffsetY) + '" />';
					self.oParent.oParent.aAreas.push(sHtmlArea);
					
				}
				if (self.oParent.oValueBox) {
					self.paintValueBox();
				}
			};

			if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
				var oStart = oBar, oEnd = {};

				oStart.iX = iX;
				oStart.iY = iY;
				oStart.iWidth = iWidth;
				oStart.iHeight = iHeight;

				oEnd.x = iX;
				oEnd.y = iY;
				oEnd.width = iWidth;
				oEnd.height = iHeight;

				var iAE = self.oParent.iAnimationEffect, oPA = self.oGraph.oPlotArea;
				oStart.fAlpha = 0;
				oEnd.alpha = oStyle.fAlpha;

				if (iAE === 2) {
					oStart.iX = oPA.iX + oPA.iWidth/2;
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
					oEnd.x = iX;
				} else if (iAE === 3) {
					oStart.iX = oPA.iX + oPA.iWidth;
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
					oEnd.x = iX;
				} else if (iAE === 4) {
					oStart.iX = oPA.iX;
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
					oEnd.x = iX;
				} else if (iAE === 5) {
					oStart.iY = oPA.iY + oPA.iHeight;
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
					oEnd.y = iY;
				} else if (iAE === 6) {
					oStart.iY = oPA.iY;
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
					oEnd.y = iY;
				} else if (iAE === 7) {
					oStart.iY = oPA.iY + oPA.iHeight/2;
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
					oEnd.y = iY;
				} else if (iAE === 8) {
					oStart.iY = iY + oPA.iHeight;
					oEnd.y = iY;
				} else if (iAE === 9) {
					oStart.iY = iY - oPA.iHeight;
					oEnd.y = iY;
				} else if (iAE === 10) {
					oStart.iX = iX + oPA.iWidth;
					oEnd.x = iX;
				} else if (iAE === 11) {
					oStart.iX = iX - oPA.iWidth;
					oEnd.x = iX;
				} else if (iAE === 12) {
					oStart.iHeight = 1;
					oEnd.height = self.iHeight;
				} else if (iAE === 13) {
					oStart.iWidth = 1;
					oEnd.width = self.iWidth;
				}

				var p;

				for (p in self.oParent.oAnimationAttributes) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
					oEnd[ZC._camelcase_(p)] = self.oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
				}

				if (ZC._n_(self.oGraph.oLast) === null) {
					self.oGraph.oLast = {};
				}
				if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
					for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
						oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
					}
				}
				self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
				ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

				var oTween = new ZC.ZCTween(
					oStart,
					oEnd,
					self.oParent.fAnimationSpeed,
					self.oParent.fAnimationDelay,
					ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
					function() {
						_fn_end_();
					}
				);
				oTween.oNode = self;
				oTween.oSeqFinishedCallback = function() {
					self.sharedErrors(ZC.ZCHtmlUtils._context_(oBar.oCanvas, self.oLoader.sOutput));
				};

				self.sharedAnimationSetup(oTween);
			} else {
				oBar.paint();
				_fn_end_();
			}

			if (self.oParent.aRules.length === 0 && !self.oParent.oJsRule && typeof(self.oParent._oBar) === 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
				if (!self.oParent.bAnimation) {
					self.oParent._oBar = oBar;
				}
			}

		}

	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		var sType = '';
		switch (self.oParent.sAspect) {
			
			default:
				sType = 'box';
				break;
			case 'pyramid':
				sType = 'shape';
				break;
		}
		self.sharedLayerSetup({
			layer : sLayer,
			type : sType,
			initcb : function() {
				this.sLineColor = self.oParent.aPalette[1];
				this.sBorderColor = self.oParent.aPalette[1];
				this.sBackgroundColor1 = self.oParent.aPalette[3];
				this.sBackgroundColor2 = self.oParent.aPalette[2];
			},
			setupcb : function() {
				switch (self.oParent.sAspect) {
					
					default:
						this.iX = self.getNodeData('x');
						this.iY = self.getNodeData('y');
						this.iWidth = self.getNodeData('w');
						this.iHeight = self.getNodeData('h');
						var oPlotArea = self.oGraph.oPlotArea;
						if (this.iX < oPlotArea.iX) {
							this.iWidth = this.iWidth - (oPlotArea.iX - this.iX);
							this.iX = oPlotArea.iX;
						}
						if (this.iX + this.iWidth > oPlotArea.iX + oPlotArea.iWidth) {
							this.iWidth = oPlotArea.iX + oPlotArea.iWidth - this.iX;
						}
						break;
					case 'pyramid':
					case 'cone':
						this.aPoints = self.getNodeData('points');
						break;
				}
			}
		});
		self.sharedErrors(ZC.ZCHtmlUtils._context_(self.oGraph.sId + '-hover-c', self.oLoader.sOutput), true);
	}
});










ZC.ZCScatterPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			
			if (self.oParent.sType === 'scatter') {
				self.iX = oScaleKey.getCoordByValue(self.fKeyValue);
				self.iY = oScaleVal.getCoordByValue(self.fValue);
			} else {
				self.iY = oScaleKey.getCoordByValue(self.fKeyValue);
				self.iX = oScaleVal.getCoordByValue(self.fValue);				
			}
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	parse : function() {
		this._super();
		
		if (!(this.oData['value'] instanceof Array)) {
			this.fKeyValue = this.iIndex;
		}
	},
	getValueBoxStyle : function() {
		return {
			'color' : (this.oParent.oMarker.sBackgroundColor1==='-1')?this.oStyle.sBackgroundColor1:this.oParent.oMarker.sBackgroundColor1
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : (this.oParent.oMarker.sBackgroundColor2==='-1')?this.oStyle.sBackgroundColor2:this.oParent.oMarker.sBackgroundColor2,
			'border-color' : (this.oParent.oMarker.sBackgroundColor2==='-1')?this.oStyle.sBackgroundColor2:this.oParent.oMarker.sBackgroundColor2,
			'color' : this.oStyle.sColor
		};
	},	
	paint : function() {
		var self = this;
		self._super();

		var oScaleKey = self.oParent._oScaleKey;

		self.setup();

		if (ZC._btw_(self.iX, oScaleKey.iX, oScaleKey.iX + oScaleKey.iWidth) && ZC._btw_(self.iY, oScaleKey.iY, oScaleKey.iY + oScaleKey.iHeight)) {
			self.sharedMarker(false, true);
		}
	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self.sharedLayerMarker(sLayer);
	}
});









ZC.ZCBubblePlotNode = ZC.ZCPlotNode.extend({
	init : function(oParent) {
		this._super(oParent);
		this.fSizeValue = null;
	},
	parse : function() {
		this._super();
		
		if (!(this.oData['value'] instanceof Array)) {
			this.fKeyValue = this.iIndex;
		}
		if (this.oData['value'] instanceof Array && ZC._n_(this.oData['value'][2]) !== null) {
			this.fSizeValue = ZC._f_(this.oData['value'][2]);
		} else {
			this.fSizeValue = 2;
		}
	},
	getValueBoxStyle : function() {
		return {
			'color' : (this.oParent.oMarker.sBackgroundColor1==='-1')?this.oStyle.sBackgroundColor1:this.oParent.oMarker.sBackgroundColor1
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : (this.oParent.oMarker.sBackgroundColor2==='-1')?this.oStyle.sBackgroundColor2:this.oParent.oMarker.sBackgroundColor2,
			'border-color' : (this.oParent.oMarker.sBackgroundColor2==='-1')?this.oStyle.sBackgroundColor2:this.oParent.oMarker.sBackgroundColor2,
			'color' : this.oStyle.sColor
		};
	},	
	parseText : function(sText, oExtraFormat) {
		var self = this;
		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		var sSizeValue = ZC.ZCUtils._format_(self.fSizeValue, oFormat);
		self.aTokens = [
			['%v0', self.fKeyValue],
			['%v1', self.fValue],
			['%v2', sSizeValue],
			['%node-size-value', sSizeValue]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			if (self.oParent.sType === 'bubble') {
				self.iX = oScaleKey.getCoordByValue(self.fKeyValue);
				self.iY = oScaleVal.getCoordByValue(self.fValue);
			} else {
				self.iY = oScaleKey.getCoordByValue(self.fKeyValue);
				self.iX = oScaleVal.getCoordByValue(self.fValue);				
			}
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	setupValueBox : function(oValueBox) {
		var self = this, mValue;
		var sPlacement = 'auto';
		if (ZC._n_(mValue=oValueBox.oData['placement']) !== null) {
			sPlacement = mValue;
		}
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var iMarkerSize = self.oAttributes['marker.size'];
		var iX = self.iX - iWidth/2;
		var iY = self.iY - iHeight/2;
		var iXDiff = 0, iYDiff = 0;
		switch (sPlacement) {
			case 'top':
				iY -= iHeight/2 + iMarkerSize;
				iYDiff = self.iY - self.oGraph.oPlotArea.iY + iMarkerSize;
				break;
			case 'bottom':
				iY += iHeight/2 + iMarkerSize;
				iYDiff = self.oGraph.oPlotArea.iY  + self.oGraph.oPlotArea.iHeight - self.iY + iMarkerSize;
				break;
			case 'left':
				iX -= iWidth/2 + iMarkerSize;
				iXDiff = self.iX - self.oGraph.oPlotArea.iX + iMarkerSize;
				break;
			case 'right':
				iX += iWidth/2 + iMarkerSize;
				iXDiff = self.oGraph.oPlotArea.iX + self.oGraph.oPlotArea.iWidth - self.iX + iMarkerSize;
				break;
			case 'over':
			case 'auto':
				break;
			default:
				break;
		}
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}

		if (iX < self.oGraph.oPlotArea.iX) {
			iX = self.oGraph.oPlotArea.iX + iXDiff;
		}
		if (iX + iWidth > self.oGraph.oPlotArea.iX + self.oGraph.oPlotArea.iWidth) {
			iX = self.oGraph.oPlotArea.iX + self.oGraph.oPlotArea.iWidth - iWidth - iXDiff;
		}
		if (iY < self.oGraph.oPlotArea.iY) {
			iY = self.oGraph.oPlotArea.iY + iYDiff;
		}
		if (iY + iHeight > self.oGraph.oPlotArea.iY + self.oGraph.oPlotArea.iHeight) {
			iY = self.oGraph.oPlotArea.iY + self.oGraph.oPlotArea.iHeight - iHeight - iYDiff;
		}

		return [ZC._i_(iX), ZC._i_(iY)];
	},
	paint : function(bSizeOnly) {
		var self = this;
		if (typeof(bSizeOnly) === 'undefined') {
			bSizeOnly = false;
		}
		self._super();

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		
		self.oAttributes['marker.size'] = self.oParent.getSize(ZC._a_(self.fSizeValue));
		

		if (bSizeOnly) {
			return;
		}

		if (ZC._btw_(self.iX, oScaleKey.iX, oScaleKey.iX + oScaleKey.iWidth) && ZC._btw_(self.iY, oScaleVal.iY, oScaleVal.iY + oScaleVal.iHeight)) {
			self.sharedMarker(false, true);
		}

	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self.sharedLayerMarker(sLayer);
	}
});











ZC.ZCPiePlotNode = ZC.ZCPlotNode.extend({
	oValueBox : null,
	init : function(oParent) {
		this._super(oParent);
	},
	parse : function() {
		this._super();
	},
	parseText : function(sText, oExtraFormat) {
		var self = this;
		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		var fNodePercent = self.fValue*100/self.oParent.oParent.aTotals[self.iIndex], sNodePercent = (''+fNodePercent);
		if (ZC._n_(oFormat['decimals']) !== null) {
			sNodePercent = fNodePercent.toFixed(ZC._max_(0, ZC._i_(oFormat['decimals'])));
		}
		self.aTokens = [
			['%node-percent-value', sNodePercent],
			['%npv', sNodePercent],
			['%pie-total-value', self.oParent.oParent.aTotals[self.iIndex]]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	getHookXY : function(oHook) {
		var self = this, mValue;
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var iOffsetR = 0;
		if (ZC._n_(mValue=oHook['offset-r']) !== null) {
			iOffsetR = ZC._f_(ZC._p_(mValue));
		}
		if (iOffsetR < 1) {
			iOffsetR *= self.iSize;
		}
		var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + 0.6*(self.iSize-self.iPieSlice) + self.iOffsetR + iOffsetR, iAngleMiddle);
		return [aPoint[0], aPoint[1], {reference:self,center:true}];
	},
	getCXY : function() {
		var self = this;
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + 0.5*(self.iSize-self.iPieSlice) + self.iOffsetR, iAngleMiddle);
		return [aPoint[0], aPoint[1]];
	},
	setup : function() {
		var self = this;
		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);
		var iCol = self.iIndex%oScale.iCols;
		var iRow = Math.floor(self.iIndex/oScale.iCols);
		self.iX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX;
		self.iY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY;
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	getValueBoxStyle : function(oValueBox) {
		var self = this, mValue;
		var oStyle = {};
		var sPlacement = 'out';
		if (ZC._n_(mValue=oValueBox.oData['placement']) !== null) {
			sPlacement = mValue;
		}
		oStyle['color'] = (sPlacement === 'out')?self.sBackgroundColor1:self.sColor;
		return oStyle;
	},
	setupValueBox : function(oValueBox) {
		var self = this, mValue;
		var sPlacement = 'out';
		if (ZC._n_(mValue=oValueBox.oData['placement']) !== null) {
			sPlacement = mValue;
		}

		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var iAngleMiddle_ = iAngleMiddle;
		var iX, iY, oLocation, bCollision, aPoint;
		if (sPlacement === 'out') {
			iAngleMiddle = iAngleMiddle_ = self.oParent.oParent.oAngles['n' + self.iIndex][self.oParent.iIndex];

			var _vbpos_ = function(iSize, iAngle) {
				if (iAngle < 0) {
					iAngle = 360 + iAngle;
				}
				iAngle = iAngle%360;
				aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, iSize + self.iOffsetR + oValueBox.iOffsetR + 20, iAngle);
				var iX = aPoint[0] + oValueBox.iOffsetX - iWidth/2;
				var iY = aPoint[1] + oValueBox.iOffsetY - iHeight/2;
				if ((iAngle >= 0 && iAngle <= 90) || (iAngle >= 270 && iAngle <= 360)) {
					iX += iWidth/2 + 10;
				} else {
					iX -= iWidth/2 + 10;
				}
				return [iX, iY];
			};
			var aPos = _vbpos_(self.iSize, iAngleMiddle_);
			iX = aPos[0];
			iY = aPos[1];

			
			self.oValueBox = oValueBox;

			var oCC = {
				x : iX, y : iY, width : iWidth, height : iHeight
			};
			
			var iSpreadType = zingchart.DEV.SPREADTYPE;
			bCollision = true;
			var iAngleOffset = 0, iSizeOffset = 0, iAngleSide = -1, iAttemps = 0, iTotalAttempts = 0;
			while (bCollision && iTotalAttempts < 2500) {
				bCollision = false;
				for (var i=0,iLen=self.oParent.oParent.aLocations.length;i<iLen;i++) {
					oLocation = self.oParent.oParent.aLocations[i];
					if (
						ZC.ZCMath._boxoverlap_(oCC, oLocation)
						|| 
						oCC.x + oValueBox.iWidth > self.oGraph.oPlotArea.iX + self.oGraph.oPlotArea.iWidth
						||
						oCC.x < self.oGraph.oPlotArea.iX
						||
						oCC.y + oValueBox.iHeight > self.oGraph.oPlotArea.iY + self.oGraph.oPlotArea.iHeight
						||
						oCC.y < self.oGraph.oPlotArea.iY
					) {
						bCollision = true;
						if (iSpreadType === 0) {
							iAngleOffset += 0.4;
							iAngleSide *= -1;
						} else if (iSpreadType === 1) {
							iSizeOffset += 2;
						}
						aPos = _vbpos_(self.iSize + iSizeOffset, iAngleMiddle_ + iAngleOffset*iAngleSide);
						oCC.x = aPos[0];
						oCC.y = aPos[1];
						iAttemps++;
						iTotalAttempts++;
						if (iAttemps > 100) {
							iAttemps = 0;
							if (iSpreadType === 0) {
								iAngleOffset = 0;
								iSizeOffset += 2;
							} else if (iSpreadType === 1) {
								iSizeOffset = 0;
								iAngleOffset += 0.4;
								iAngleSide *= -1;
							}
						}
					}
				}
			}
			iX = oCC.x;
			iY = oCC.y;
			iAngleMiddle = iAngleMiddle_ + iAngleOffset;
			
			
			oLocation = {
				text : self.oParent.sText,
				x : oCC.x,
				y : oCC.y,
				width : iWidth,
				height : iHeight,
				plotindex : self.oParent.iIndex,
				nodeindex : self.iIndex
			};
			self.oParent.oParent.aLocations.push(oLocation);
		} else if (sPlacement === 'in') {
			aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + 0.5*(self.iSize-self.iPieSlice) + self.iOffsetR + oValueBox.iOffsetR, iAngleMiddle);
			iX = aPoint[0] - iWidth/2 + self.iOffsetX;
			iY = aPoint[1] - iHeight/2 + self.iOffsetY;
		} else if (sPlacement === 'center') {
			iX = self.iX - iWidth/2 + self.iOffsetX;
			iY = self.iY - iHeight/2 + self.iOffsetY;
		}

		if (bCollision) {
			iX = -9999;
			iY = -9999;
			oValueBox.bVisible = false;
		}

		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}
		if (iX >= -2) {
			iX = ZC._a_(iX);
		}
		if (iY >= -2) {
			iY = ZC._a_(iY);
		}

		return [ZC._i_(iX), ZC._i_(iY), iAngleMiddle];
	},
	paintValueBox : function(bEstimate, iIndex) {
		var self = this, mValue;
		var oValueBox = self._super(bEstimate, iIndex);
		if (bEstimate) {
			return oValueBox;
		}
		if (self.bVisible && oValueBox.bVisible && ZC._n_(oValueBox.sText) !== null && oValueBox.sText !== '') {
			var sPlacement = 'out';
			if (ZC._n_(mValue=oValueBox.oData['placement']) !== null) {
				sPlacement = mValue;
			}
			if (sPlacement === 'out') {
				
				var bConnected = true;
				if (ZC._n_(mValue=oValueBox.oData['connected']) !== null) {
					bConnected = ZC._b_(mValue);
				}
				if (bConnected) {
					var oValueBoxConnector = new ZC.ZCShape(self.oParent);
					
					oValueBoxConnector.oCanvas = oValueBoxConnector.oCanvasSh = self.oParent.getCanvas('bl', 0);
					
					oValueBoxConnector.append(self.oParent.oValueBoxConnector.oData);
					oValueBoxConnector.sId = self.sId + '-connector';
					oValueBoxConnector.sLineColor = self.sBackgroundColor1;
					oValueBoxConnector.sShape = 'line';
					oValueBoxConnector.aPoints = [];
					var aPositionInfo = oValueBox.oAttributes['positioninfo'];
					var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;

					var aPoint1 = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize + self.iOffsetR, iAngleMiddle);
					aPoint1[0] += self.iOffsetX;
					aPoint1[1] += self.iOffsetY;
					oValueBoxConnector.aPoints.push(aPoint1);

					var aPoint2 = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize + self.iOffsetR + 10, iAngleMiddle);
					aPoint2[0] += self.iOffsetX;
					aPoint2[1] += self.iOffsetY;

					if (oValueBox.iX >= self.iX) {
						oValueBoxConnector.aPoints.push(
							[aPoint2[0], aPoint2[1], aPositionInfo[0], aPositionInfo[1] + oValueBox.iHeight/2]
						);
					} else {
						oValueBoxConnector.aPoints.push(
							[aPoint2[0], aPoint2[1], aPositionInfo[0] + oValueBox.iWidth + 2, aPositionInfo[1] + oValueBox.iHeight/2]
						);
					}

					oValueBoxConnector.parse();
					oValueBoxConnector.parseRule = function(sRule) {
						return self.parseRule(sRule);
					};
					if (oValueBoxConnector.applyRules()) {
						oValueBoxConnector.parse();
					}
					if (oValueBoxConnector.bVisible) {
						oValueBoxConnector.paint();
					}
				}
			}
		}
	},
	paint : function() {
		var self = this, aPoint;
		self._super();

		if (self.fValue < 0) {
			return;
		}

		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);

		self.setup();

		self.iSize = ZC._min_(oScale.iVStepSize, oScale.iHStepSize)/2;
		if (ZC._n_(self.oParent.oData['size']) !== null) {
			self.iSize = self.oParent.iSize;
		} else {
			self.iSize = oScale.fSizeFactor*self.iSize;
		}
		if (self.iPieSlice < 1) {
			self.iPieSlice *= self.iSize;
		}
		self.oData['slice'] = self.iPieSlice;
		if (self.iOffsetR < 1) {
			self.iOffsetR *= self.iSize;
		}
		self.oData['offset-r'] = self.iOffsetR;

		if (self.oGraph.oAttributes['pie-sel-' + self.oParent.iIndex + '-' + self.iIndex]) {
			self.iOffsetR += ZC._i_(self.iSize*0.15);
		}

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self);

		self.applyJsRule(oStyle);

		if (self.fValue >= 0 || self.oParent.oParent.aTotals[self.iIndex] === 0) {

			var oPie = new ZC.ZCShape(self.oParent);
			oPie.sId = self.sId;
			oPie.oCanvas = self.oParent.getCanvas('bl', 1);
			oPie.oCanvasSh = self.oParent.getCanvas('bl', 0);
			
			oPie.copy(oStyle);
			var iX = self.iX;
			var iY = self.iY;
			if (self.iOffsetR > 0) {
				aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iOffsetR, (self.iPieAngleStart+self.iPieAngleEnd)/2);
				iX = aPoint[0];
				iY = aPoint[1];
			}
			oPie.iX = iX;
			oPie.iY = iY;
			oPie.iSize = self.iSize;
			oPie.sShape = 'pie';
			oPie.iPieAngleStart = self.iPieAngleStart;
			oPie.iPieAngleEnd = self.iPieAngleEnd;
			oPie.iPieSlice = self.iPieSlice;
			
			oPie.oAttributes['plotidx'] = self.oParent.iIndex;
			oPie.oAttributes['nodeidx'] = self.iIndex;

			oPie.parse();

			self.oPie = oPie;

			var _fn_end_ = function() {
				if (!self.oParent.bFlat) {
					var sCoords = oPie.getAreaCoords();
					var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
					var sHtmlArea = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />';
					self.oParent.oParent.aAreas.push(sHtmlArea);
					
				}
				if (self.oParent.oValueBox) {
					self.paintValueBox();
				}
			};

			if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
				var oStart = oPie, oEnd = {};

				oStart.iX = iX;
				oStart.iY = iY;
				oStart.iPieAngleStart = self.iPieAngleStart;
				oStart.iPieAngleEnd = self.iPieAngleEnd;
				oEnd.angleStart = self.iPieAngleStart;
				oEnd.angleEnd = self.iPieAngleEnd;
				oEnd.x = iX;
				oEnd.y = iY;

				var iAE = self.oParent.iAnimationEffect;
				oStart.fAlpha = 0;
				oEnd.alpha = oStyle.fAlpha;

				if (iAE === 2) {
					oStart.iPieAngleEnd = self.iPieAngleStart;
					oEnd.angleEnd = self.iPieAngleEnd;
				} else if (iAE === 3) {
					oStart.iSize = self.iPieSlice;
					oEnd.size = self.iSize;
				} else if (iAE === 4) {
					aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize*1.2, (self.iPieAngleStart+self.iPieAngleEnd)/2);
					oStart.iX = aPoint[0];
					oStart.iY = aPoint[1];
					oEnd.x = iX;
					oEnd.y = iY;
				} else if (iAE === 5) {
					oStart.iPieAngleStart = oStart.iPieAngleEnd = (self.iPieAngleStart+self.iPieAngleEnd)/2;
					oEnd.angleStart = self.iPieAngleStart;
					oEnd.angleEnd = self.iPieAngleEnd;
				}

				var p;

				for (p in self.oParent.oAnimationAttributes) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
					oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
				}

				if (ZC._n_(self.oGraph.oLast) === null) {
					self.oGraph.oLast = {};
				}
				if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
					for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
						oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
					}
				}
				self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
				ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

				var oTween = new ZC.ZCTween(
					oStart,
					oEnd,
					self.oParent.fAnimationSpeed,
					self.oParent.fAnimationDelay,
					ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
					function() {
						_fn_end_();
					}
				);
				oTween.oNode = self;

				self.sharedAnimationSetup(oTween);
			} else {
				oPie.paint();
				_fn_end_();
			}
		} else {
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}
	},

	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }

		self.sharedLayerSetup({
			layer : sLayer,
			type : 'shape',
			initcb : function() {
				this.copy(self);
				this.iX = self.iX;
				this.iY = self.iY;
				if (self.iOffsetR > 0) {
					var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iOffsetR, (self.iPieAngleStart+self.iPieAngleEnd)/2);
					this.iX = aPoint[0];
					this.iY = aPoint[1];
				}
				this.iSize = self.iSize;
				this.sShape = 'pie';
				this.sBackgroundColor1 = self.oParent.aPalette[3];
				this.sBackgroundColor2 = self.oParent.aPalette[2];
				this.iPieAngleStart = self.iPieAngleStart;
				this.iPieAngleEnd = self.iPieAngleEnd;
				this.iPieSlice = self.iPieSlice;
			},
			parsecb : function() {
				this.oData['size'] = self.iSize;
				this.oData['slice'] = self.iPieSlice;
				this.oData['offset-r'] = self.iOffsetR;
			}
		});
	},
	_api_node_event_ : function(ev, sType) {
		var self = this;
		self._super(ev, sType);
		if (sType === 'click' && ev.which <= 1 && self.oParent.bDetach) {
			zingchart.SKIP.ANIMATION = true;
			zingchart.SKIP.EVENT = true;
			var sId = 'pie-sel-' + self.oParent.iIndex + '-' + self.iIndex;
			self.oGraph.oAttributes[sId] = (typeof(self.oGraph.oAttributes[sId]) === 'undefined')?true:!self.oGraph.oAttributes[sId];
			self.oGraph.repaint();
			zingchart.SKIP.EVENT = false;
			zingchart.SKIP.ANIMATION = false;
		}
	}
});











ZC.ZCNestedPiePlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		var self = this;
		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);
		self.iX = oScale.iX + oScale.iWidth/2 + oScale.iOffsetX;
		self.iY = oScale.iY + oScale.iHeight/2 + oScale.iOffsetY;
		if (!self.bInit) {
			self.copy(self.oParent);
			
			self.oData['slice'] = null;
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	getCXY : function() {
		var self = this;
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + self.oAttributes['bandwidth']/2 + self.iOffsetR, iAngleMiddle);
		return [aPoint[0], aPoint[1]];
	},
	parseText : function(sText, oExtraFormat) {
		var self = this;
		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		var fNodePercent = self.fValue*100/self.oParent.oParent.aTotals[self.iIndex], sNodePercent = (''+fNodePercent);
		if (ZC._n_(oFormat['decimals']) !== null) {
			sNodePercent = fNodePercent.toFixed(ZC._max_(0, ZC._i_(oFormat['decimals'])));
		}
		self.aTokens = [
			['%node-percent-value', sNodePercent],
			['%npv', sNodePercent]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	getValueBoxStyle : function(oValueBox) {
		var oStyle = {};
		var sPlacement = 'in';
		if (ZC._n_(oValueBox.oData['placement']) !== null) {
			sPlacement = oValueBox.oData['placement'];
		}
		if (sPlacement === 'out') {
			oStyle['color'] = this.sBackgroundColor1;
		} else {
			oStyle['color'] = this.sColor;
		}
		return oStyle;
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var sPlacement = 'in';
		if (ZC._n_(oValueBox.oData['placement']) !== null) {
			sPlacement = oValueBox.oData['placement'];
		}
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var iX, iY, aPoint;
		if (sPlacement === 'out') {
			if (self.iIndex === self.oParent.aPlotNodes.length-1) {
				aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.oParent.iSliceStart + self.oParent.aPlotNodes.length*(self.oAttributes['bandwidth'] + self.oAttributes['bandspace']) + 20 + oValueBox.iOffsetR, iAngleMiddle);
				if ((iAngleMiddle >= 0 && iAngleMiddle < 90) || (iAngleMiddle >= 270 && iAngleMiddle < 360)) {
					iX = aPoint[0] + 10 + self.iOffsetX;
				} else {
					iX = aPoint[0] - iWidth - 10 + self.iOffsetX;
				}
				iY = aPoint[1] - iHeight/2 + self.iOffsetY;
			} else {
				iX = -1;
				iY = -1;
			}
		} else {
			aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + self.oAttributes['bandwidth']/2 + oValueBox.iOffsetR, iAngleMiddle);
			iX = aPoint[0] - iWidth/2 + self.iOffsetX;
			iY = aPoint[1] - iHeight/2 + self.iOffsetY;
		}
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}
		return [ZC._i_(iX), ZC._i_(iY), iAngleMiddle];
	},
	paintValueBox : function(bEstimate) {
		var self = this;
		var oValueBox = self._super(bEstimate);
		if (bEstimate) {
			return oValueBox;
		}
		if (oValueBox.bVisible && ZC._n_(oValueBox.sText) !== null && oValueBox.sText !== '') {
			var sPlacement = 'in';
			if (ZC._n_(oValueBox.oData['placement']) !== null) {
				sPlacement = oValueBox.oData['placement'];
			}
			if (sPlacement === 'out' && self.iIndex === self.oParent.aPlotNodes.length-1) {
				var oValueBoxConnector = new ZC.ZCShape(self.oParent);
				oValueBoxConnector.oCanvas = oValueBoxConnector.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):((self.oGraph.oSettings['3d'] || self.oLoader.bFlat)?ZC._id_(self.oGraph.sId + '-plots-vb-c'):ZC._id_(self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-vb-c'));
				
				oValueBoxConnector.append(self.oParent.oValueBoxConnector.oData);
				oValueBoxConnector.sLineColor = self.sBackgroundColor1;
				oValueBoxConnector.sShape = 'line';
				oValueBoxConnector.aPoints = [];
				var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
				var aPoint1 = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + self.oAttributes['bandwidth'] + oValueBox.iOffsetR, iAngleMiddle);
				var aPoint2 = ZC.ZCMath._cpoint_(self.iX, self.iY, self.oParent.iSliceStart + self.oParent.aPlotNodes.length*(self.oAttributes['bandwidth'] + self.oAttributes['bandspace']) + 20 + oValueBox.iOffsetR, iAngleMiddle);
				aPoint1[0] += self.iOffsetX;
				aPoint2[0] += self.iOffsetX;
				aPoint1[1] += self.iOffsetY;
				aPoint2[1] += self.iOffsetY;
				oValueBoxConnector.aPoints.push(aPoint1, aPoint2);
				if ((iAngleMiddle >= 0 && iAngleMiddle < 90) || (iAngleMiddle >= 270 && iAngleMiddle < 360)) {
					oValueBoxConnector.aPoints.push([aPoint2[0] + 10, aPoint2[1]]);
				} else {
					oValueBoxConnector.aPoints.push([aPoint2[0] - 10, aPoint2[1]]);
				}
				oValueBoxConnector.parse();
				oValueBoxConnector.parseRule = function(sRule) {
					return self.parseRule(sRule);
				};
				if (oValueBoxConnector.applyRules()) {
					oValueBoxConnector.parse();
				}
				if (oValueBoxConnector.bVisible) {
					oValueBoxConnector.paint();
				}
			}
		}
	},
	paint : function() {
		var self = this, p;
		self._super();

		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);

		self.setup();

		self.iSize = ZC._min_(oScale.iWidth, oScale.iHeight)/2;
		self.iSize = oScale.fSizeFactor*self.iSize;
		self.iPieSlice = self.oParent.iSliceStart;
		if (self.iPieSlice < 1) {
			self.iPieSlice = self.oParent.iSliceStart*self.iSize;
		}
		var iBandSpace = self.oParent.iBandSpace;
		if (iBandSpace < 1) {
			iBandSpace = self.oParent.iBandSpace*self.iSize;
		}
		var iBandWidth = (self.iSize - self.iPieSlice - (self.oParent.aPlotNodes.length-1)*iBandSpace)/self.oParent.aPlotNodes.length;
		iBandWidth = ZC._max_(iBandWidth, 2);

		self.iPieSlice += self.iIndex*(iBandWidth + iBandSpace);
		self.iSize = self.iPieSlice + iBandWidth;

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self);

		self.applyJsRule(oStyle);

		var oPie = new ZC.ZCShape(self.oParent);
		oPie.sId = self.sId;
		oPie.oCanvas = self.oParent.getCanvas('bl', 1);
		oPie.oCanvasSh = self.oParent.getCanvas('bl', 0);
		
		oPie.copy(oStyle);
		oPie.iX = self.iX;
		oPie.iY = self.iY;
		oPie.sShape = 'pie';
		oPie.iPieAngleStart = self.iPieAngleStart;
		oPie.iPieAngleEnd = self.iPieAngleEnd;
		oPie.iPieSlice = self.iPieSlice;
		oPie.iSize = self.iSize;
		oPie.parse();

		var iPieSlice = oPie.iPieSlice;
		self.oAttributes['bandwidth'] = iBandWidth;
		self.oAttributes['bandspace'] = iBandSpace;

		function _fn_end_() {
			var sCoords = oPie.getAreaCoords();
			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			var sHtmlArea = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />';
			self.oParent.oParent.aAreas.push(sHtmlArea);
			
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}

		if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
			var oStart = oPie, oEnd = {};

			oStart.iPieAngleStart = self.iPieAngleStart;
			oStart.iPieAngleEnd = self.iPieAngleEnd;
			oEnd.angleStart = self.iPieAngleStart;
			oEnd.angleEnd = self.iPieAngleEnd;

			var iAE = self.oParent.iAnimationEffect;
			oStart.fAlpha = 0;
			oEnd.alpha = oStyle.fAlpha;

			if (iAE === 2) {
				oStart.iPieAngleEnd = self.iPieAngleStart;
				oEnd.angleEnd = self.iPieAngleEnd;
			} else if (iAE === 3) {
				oStart.iPieSlice = iPieSlice + self.oAttributes['bandwidth'];
				oEnd.slice = iPieSlice;
			} else if (iAE === 4) {
				var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize, (self.iPieAngleStart+self.iPieAngleEnd)/2);
				oStart.iX = aPoint[0];
				oStart.iY = aPoint[1];
				oEnd.x = self.iX;
				oEnd.y = self.iY;
			} else if (iAE === 5) {
				oStart.iPieAngleStart = oStart.iPieAngleEnd = (self.iPieAngleStart+self.iPieAngleEnd)/2;
				oEnd.angleStart = self.iPieAngleStart;
				oEnd.angleEnd = self.iPieAngleEnd;
			}

			for (p in self.oParent.oAnimationAttributes) {
				oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
			}

			if (!self.oGraph.oLast) {
				self.oGraph.oLast = {};
			}
			if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
				for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
				}
			}
			self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

			var oTween = new ZC.ZCTween(
				oStart,
				oEnd,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					_fn_end_();
				}
			);
			oTween.oNode = self;

			self.sharedAnimationSetup(oTween);
		} else {
			oPie.paint();
			_fn_end_();
		}

	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self.sharedLayerSetup({
			layer : sLayer,
			type : 'shape',
			initcb : function() {
				this.copy(self);
				this.iX = self.iX;
				this.iY = self.iY;
				this.sShape = 'pie';
				this.sBackgroundColor1 = self.oParent.aPalette[3];
				this.sBackgroundColor2 = self.oParent.aPalette[2];
				this.iPieAngleStart = self.iPieAngleStart;
				this.iPieAngleEnd = self.iPieAngleEnd;
				this.iPieSlice = self.iPieSlice;
				this.iSize = self.iSize;
			},
			parsecb : function() {
				
				this.oData['slice'] = null;
			}
		});
	}
});











ZC.ZCRadarPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			var iR = oScaleVal.getRadiusByValue(self.fAbsoluteValue);
			var aCoords = oScaleKey.getCoords(self.iIndex, iR);
			self.iX = aCoords[0];
			self.iY = aCoords[1];
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var oScaleM = self.oGraph.getScaleByName('scale');
		var iCX = oScaleM.iX + oScaleM.iWidth/2;
		var iCY = oScaleM.iY + oScaleM.iHeight/2;

		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight, aCoords;

		var fAngleStep = 360/oScaleKey.aValues.length;
		var iR = oScaleVal.getRadiusByValue(self.fAbsoluteValue);
		switch (self.oParent.sAspect) {
			case 'dots':
			case 'line':
			case 'area':
				aCoords = ZC.ZCMath._cpoint_(iCX, iCY, oScaleVal.iOffsetStart + iR*1.1 + oValueBox.iOffsetR + ZC._max_(iWidth/2, iHeight/2), oScaleKey.iRefAngle+self.iIndex*fAngleStep);
				aCoords[0] -= iWidth/2;
				aCoords[1] -= iHeight/2;
				break;
			case 'rose':
				aCoords = ZC.ZCMath._cpoint_(iCX, iCY, oScaleVal.iOffsetStart + iR*1.1 + oValueBox.iOffsetR + ZC._max_(iWidth/2, iHeight/2), oScaleKey.iRefAngle+self.iIndex*fAngleStep);
				aCoords[0] -= iWidth/2;
				aCoords[1] -= iHeight/2;
				break;
		}
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			aCoords[0] = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			aCoords[1] = oValueBox.iY;
		}
		return [ZC._i_(aCoords[0]), ZC._i_(aCoords[1])];
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.sLineColor,
			'border-color' : this.sLineColor,
			'color' : this.sColor
		};
	},
	paint : function() {
		var self = this, mValue, i;

		self._super();

		var oCtxLine = self.oParent._oCtxLine,
			oCtxArea = self.oParent._oCtxArea,
			oScaleKey = self.oParent._oScaleKey,
			oScaleVal = self.oParent._oScaleVal,
			aPlotNodes = self.oParent.aPlotNodes;

		self.setup();

		self.bPixelCorrection = false;
		self.oCanvasSh = self.oParent.getCanvas('bl', 0);
		

		function _fn_end_() {
			if (self.oParent.iMaxTrackers >= self.oParent.aPlotNodes.length && self.oParent.bSegmentTrackers) {
				var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
				var sHtmlArea = '', sCoords = '';
				if (ZC._indexof_(['line', 'area'], self.oParent.sAspect) !== -1) {
					sCoords = ZC.ZCMath._htmlarea_(ZC.ZCMath._contour_(self.oAttributes['points']), 4);
					if (sCoords !== '') {
						sHtmlArea = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />';
						
					}
				} else if (ZC._indexof_(['rose'], self.oParent.sAspect) !== -1) {
					sCoords = oPie.getAreaCoords();
					sHtmlArea = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" data-z-sort="' + (self.oParent.oParent.aPlots.length-self.oParent.iIndex) + '" />';
					
				}
				self.oParent.oParent.aAreas.push(sHtmlArea);
			}
			if (ZC._indexof_(['line', 'area'], self.oParent.sAspect) !== -1) {
				self.sharedMarker(false, true);
			}
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self);
		var aMP, aPoints = [], aPointsArea = [];

		if (ZC._indexof_(['line', 'area'], self.oParent.sAspect) !== -1) {
			aPoints = [];
			aPointsArea = [];
			
			if (self.oParent.bFast) {
				self.oParent.aPoints.push([self.iX, self.iY]);
				self.oParent.aPointsArea.push([self.iX, self.iY]);
			} 
			if (self.iIndex > oScaleKey.iMinIndex) {
				if (aPlotNodes[self.iIndex-1]) {
					aPlotNodes[self.iIndex-1].setup();
					aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex-1].iX, aPlotNodes[self.iIndex-1].iY, aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY);
					aPoints.push(aMP);
					aPointsArea.push(aMP);
				}
			} else if (aPlotNodes[oScaleKey.iMaxIndex]) {
				aPlotNodes[oScaleKey.iMaxIndex].setup();
				aMP = ZC.ZCMath._mpoint_(aPlotNodes[oScaleKey.iMaxIndex].iX, aPlotNodes[oScaleKey.iMaxIndex].iY, aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY);
				aPoints.push(aMP);
				aPointsArea.push(aMP);
			}			
			
			aPoints.push([self.iX, self.iY]);
			aPointsArea.push([self.iX, self.iY]);

			if (self.iIndex < oScaleKey.iMaxIndex) {
				if (aPlotNodes[self.iIndex+1]) {
					aPlotNodes[self.iIndex+1].setup();
					aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY, aPlotNodes[self.iIndex+1].iX, aPlotNodes[self.iIndex+1].iY);
					aPoints.push(aMP);
					aPointsArea.push(aMP);
				}
			} else if (aPlotNodes[0]) {
				aPlotNodes[0].setup();
				aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY, aPlotNodes[0].iX, aPlotNodes[0].iY);
				aPoints.push(aMP);
				aPointsArea.push(aMP);
			}
			
			ZC.ZCLine.setup(oCtxLine, oStyle);
		}

		var oScaleM, iCX, iCY, fAngleStep, oArea, oPlotArea = self.oGraph.oPlotArea;

		if (self.oParent.sAspect === 'area') {
			oScaleM = self.oGraph.getScaleByName('scale');
			iCX = oScaleM.iX + oScaleM.iWidth/2;
			iCY = oScaleM.iY + oScaleM.iHeight/2;
			fAngleStep = 360/oScaleKey.aValues.length;
			aPointsArea.push([iCX, iCY]);

			if (!self.oParent.bFast) {
				oArea = new ZC.ZCShape(self.oParent);
				oArea.sId = self.sId + '-area';
				oArea.oCanvas = self.oParent.getCanvas('bl', 0);
				
				oArea.copy(oStyle);
				oArea.bAreaCorrection = true;
				oArea.aPoints = aPointsArea;
				oArea.parse();
				oArea.fAlpha = self.oParent.fAlphaArea;
				if (oArea.fAlpha === 1 && oArea.iBorderWidth === 0) {
					oArea.sBackgroundColor1 = ZC.ZCUtils._lighten_(ZC.ZCUtils._color_(oArea.sBackgroundColor1), 20);
					oArea.sBackgroundColor2 = ZC.ZCUtils._lighten_(ZC.ZCUtils._color_(oArea.sBackgroundColor2), 20);
					oArea.iBorderWidth = 2;
					oArea.sBorderColor = oArea.sBackgroundColor1;
				}
				oArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
				ZC.ZCLine.setup(oCtxArea, oArea);
			}
		}

		self.oAttributes['points'] = aPoints;
		self.oAttributes['pointsarea'] = aPointsArea;

		var oStart, oEnd, oPie, iAngleStart, iAngleEnd, iSize, aPointsStartArea, oStartArea, oEndArea, iDx, iDy;

		if (self.oParent.bFast && self.iIndex === oScaleKey.iMaxIndex) {
			if (self.oParent.sAspect === 'area') {
				oArea = new ZC.ZCShape(self.oParent);
				oArea.sId = self.sId + '-area';
				oArea.oCanvas = self.oParent.getCanvas('bl', 0);
				
				oArea.copy(self.oParent);
				oArea.bAreaCorrection = true;
				oArea.aPoints = self.oParent.aPointsArea;
				oArea.parse();
				oArea.fAlpha = self.oParent.fAlphaArea;
				oArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
				oArea.paint();
			}

			if (self.oParent.sAspect === 'line' || self.oParent.sAspect === 'area') {
				
				self.oParent.aPoints.push([self.oParent.aPoints[0][0], self.oParent.aPoints[0][1]]);
				ZC.ZCLine.paint(oCtxLine, oStyle, self.oParent.aPoints);
			}
		}

		if (ZC._indexof_(['dots'], self.oParent.sAspect) !== -1) {

			self.sharedMarker(false, true);

		} else if (self.oParent.sAspect === 'rose') {
			oPie = new ZC.ZCShape(self.oParent);
			oPie.sId = self.sId + '-pie';
			oPie.copy(oStyle);
			oPie.oCanvas = self.oParent.getCanvas('bl', 1);
			oPie.oCanvasSh = self.oParent.getCanvas('bl', 0);
			
			oScaleM = self.oGraph.getScaleByName('scale');
			iCX = oScaleM.iX + oScaleM.iWidth/2;
			iCY = oScaleM.iY + oScaleM.iHeight/2;
			fAngleStep = oScaleKey.iAperture/(oScaleKey.aValues.length-(oScaleKey.iAperture===360?0:1));
			var fAngleDiff = fAngleStep*0.1;
			if (ZC._n_(mValue=self.oParent.fAngleSpace) !== null) {
				if (mValue < 1) {
					fAngleDiff = fAngleStep*mValue;
				} else {
					fAngleDiff = mValue;
				}
			}
			if (!self.oParent.bStacked) {
				fAngleDiff = fAngleStep*0.1*(self.oParent.iIndex+1);
			}
			oPie.iPieSlice = oScaleVal.iOffsetStart;
			
			var oPlotSet = self.oParent.oParent;
			if (self.oParent.bStacked && ZC._n_(oPlotSet.oStackedR['stack'+self.iIndex]) !== null) {
				oPie.iPieSlice += oPlotSet.oStackedR['stack'+self.iIndex];
			}
			var iR = ZC._i_(oScaleVal.getRadiusByValue(self.fAbsoluteValue));
			if (self.oParent.bStacked) {
				oPlotSet.oStackedR['stack'+self.iIndex] = iR;
			}
			iAngleStart = oScaleKey.iRefAngle + ((360-oScaleKey.iAperture)/2)+self.iIndex*fAngleStep-fAngleStep/2+fAngleDiff;
			iAngleEnd = oScaleKey.iRefAngle + ((360-oScaleKey.iAperture)/2)+(self.iIndex+1)*fAngleStep-fAngleStep/2-fAngleDiff;
			iSize = iR + oScaleVal.iOffsetStart;

			self.setNodeData({
				x : iCX,
				y : iCY,
				sz : iSize,
				sl : oPie.iPieSlice,
				as : iAngleStart,
				ae : iAngleEnd
			});

			oPie.iX = iCX;
			oPie.iY = iCY;
			oPie.sShape = 'pie';
			oPie.iPieAngleStart = iAngleStart;
			oPie.iPieAngleEnd = iAngleEnd;
			oPie.iSize = iSize;
			oPie.parse();
			oPie.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oPie.applyRules()) {
				oPie.parse();
			}

		}

		if (self.oParent.bAnimation && ZC._indexof_(['line', 'area', 'rose'], self.oParent.sAspect) !== -1) {
			switch (self.oParent.sAspect) {
				case 'line':
				case 'area':
					oStart = new ZC.ZCShape(self);
					oEnd = {};
					oStart.copy(oStyle);
					oStart.sId = self.sId;
					oStart.oCanvas = self.oParent.getCanvas('bl', 1);
					oStart.oCanvasSh = self.oParent.getCanvas('bl', 0);
					oStart.aPoints = aPoints;
					oStart.fAlpha = 0;
					oEnd.alpha = oStyle.fAlpha;
					oEnd.points = aPoints;

					var aPointsStart = [];
					if (self.oParent.sAspect === 'area') {
						oStartArea = oArea;
						oEndArea = {};
						aPointsStartArea = [];
						oStartArea.aPoints = aPointsArea;
						oStartArea.fAlpha = 0;
						oEndArea.points = aPointsArea;
						oEndArea.alpha = self.oParent.fAlphaArea;
					}
					break;
				case 'rose':
					oStart = oPie;
					oEnd = {};
					oStart.iX = iCX;
					oStart.iY = iCY;
					oStart.iPieAngleStart = iAngleStart;
					oStart.iPieAngleEnd = iAngleEnd;
					oStart.fAlpha = 0;
					oEnd.angleStart = iAngleStart;
					oEnd.angleEnd = iAngleEnd;
					oEnd.x = iCX;
					oEnd.y = iCY;
					oEnd.size = iSize;
					oEnd.alpha = oStyle.fAlpha;
					break;
			}

			var iAE = self.oParent.iAnimationEffect, oPA = self.oGraph.oPlotArea;

			switch (iAE) {
				case 1:
					
					break;
				case 7:
					switch (self.oParent.sAspect) {
						case 'line':
						case 'area':
							for (i=0;i<aPoints.length;i++) {
								aPointsStart[i] = [aPoints[i][0], oPA.iY + oPA.iHeight/2];
							}
							oStart.aPoints = aPointsStart;
							oEnd.points = aPoints;
							if (self.oParent.sAspect === 'area') {
								for (i=0;i<aPointsArea.length;i++) {
									aPointsStartArea[i] = [aPointsArea[i][0], oPA.iY + oPA.iHeight/2];
								}
								oStartArea.aPoints = aPointsStartArea;
								oEndArea.points = aPointsArea;
							}
							break;
					}
					break;
				case 2:
					switch (self.oParent.sAspect) {
						case 'line':
						case 'area':
							for (i=0;i<aPoints.length;i++) {
								aPointsStart[i] = [oPA.iX + oPA.iWidth/2, aPoints[i][1]];
							}
							oStart.aPoints = aPointsStart;
							oEnd.points = aPoints;
							if (self.oParent.sAspect === 'area') {
								for (i=0;i<aPointsArea.length;i++) {
									aPointsStartArea[i] = [oPA.iX + oPA.iWidth/2, aPointsArea[i][1]];
								}
								oStartArea.aPoints = aPointsStartArea;
								oEndArea.points = aPointsArea;
							}
							break;
						case 'rose':
							oStart.iPieAngleEnd = iAngleStart;
							oEnd.angleEnd = iAngleEnd;
							break;
					}
					break;
				case 3:
					switch (self.oParent.sAspect) {
						case 'line':
						case 'area':
							for (i=0;i<aPoints.length;i++) {
								aPointsStart[i] = [oPA.iX + oPA.iWidth/2, oPA.iY + oPA.iHeight/2];
							}
							oStart.aPoints = aPointsStart;
							oEnd.points = aPoints;
							if (self.oParent.sAspect === 'area') {
								for (i=0;i<aPointsArea.length;i++) {
									aPointsStartArea[i] = [oPA.iX + oPA.iWidth/2, oPA.iY + oPA.iHeight/2];
								}
								oStartArea.aPoints = aPointsStartArea;
								oEndArea.points = aPointsArea;
							}
							break;
						case 'rose':
							oStart.iSize = oScaleVal.iOffsetStart;
							oEnd.size = iSize;
							break;
					}
					break;
				case 4:
					switch (self.oParent.sAspect) {
						case 'line':
						case 'area':
							for (i=0;i<aPoints.length;i++) {
								iDx = oPA.iX + oPA.iWidth/2 - aPoints[i][0];
								iDy = oPA.iY + oPA.iHeight/2 - aPoints[i][1];
								aPointsStart[i] = [oPA.iX + oPA.iWidth/2 - iDx*2.5, oPA.iY + oPA.iHeight/2 - iDy*2.5];
							}
							oStart.aPoints = aPointsStart;
							oEnd.points = aPoints;
							if (self.oParent.sAspect === 'area') {
								for (i=0;i<aPointsArea.length;i++) {
									iDx = oPA.iX + oPA.iWidth/2 - aPointsArea[i][0];
									iDy = oPA.iY + oPA.iHeight/2 - aPointsArea[i][1];
									aPointsStartArea[i] = [oPA.iX + oPA.iWidth/2 - iDx*2.5, oPA.iY + oPA.iHeight/2 - iDy*2.5];
								}
								oStartArea.aPoints = aPointsStartArea;
								oEndArea.points = aPointsArea;
							}
							break;
						case 'rose':
							oStart.iSize = iSize*2;
							oEnd.size = iSize;
							break;
					}
					break;
				case 5:
					switch (self.oParent.sAspect) {
						case 'rose':
							oStart.iPieAngleStart = oStart.iPieAngleEnd = (iAngleStart+iAngleEnd)/2;
							oEnd.angleStart = iAngleStart;
							oEnd.angleEnd = iAngleEnd;
							break;
					}
					break;
			}
			var p;
			for (p in self.oParent.oAnimationAttributes) {
				oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
			}

			if (ZC._n_(self.oGraph.oLast) === null) {
				self.oGraph.oLast = {};
				if (self.oParent.sAspect === 'area') {
					self.oGraph.oLastArea = {};
				}
			}
			if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
				for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
				}
				if (self.oParent.sAspect === 'area') {
					for (p in self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex]) {
						oStartArea[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex][p];
					}
				}
			}
			self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);
			if (self.oParent.sAspect === 'area') {
				self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex] = {};
				ZC._cp_(oEndArea, self.oGraph.oLastArea[self.oParent.iIndex+'-'+self.iIndex]);
			}

			var oTween = new ZC.ZCTween(
				oStart,
				oEnd,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					_fn_end_();
				}
			);
			oTween.oNode = self;
			if (ZC._indexof_(['line', 'area'], self.oParent.sAspect) !== -1) {
				oTween.oCtxLine = oCtxLine;
			}

			var oTweenArea = null;
			if (self.oParent.sAspect === 'area') {
				oTweenArea = new ZC.ZCTween(
					oStartArea,
					oEndArea,
					self.oParent.fAnimationSpeed,
					self.oParent.fAnimationDelay,
					ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
					function() {
						
					}
				);
				oTweenArea.oNode = self;
			}

			self.sharedAnimationSetup(oTween, oTweenArea);
		} else {

			switch (self.oParent.sAspect) {
				case 'line':
				case 'area':
					if (!self.oParent.bFast) {
						ZC.ZCLine.paint(oCtxLine, oStyle, aPoints);
						if (self.oParent.sAspect === 'area') {
							oArea.paint();
						}
					}
					break;
				case 'rose':
					oPie.paint();
					break;
			}

			_fn_end_();
		}

	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }

		if (self.oParent.oHoverState && self.oParent.bVisible) {
			if (ZC._indexof_(['line', 'area'], self.oParent.sAspect) !== -1) {

				self.sharedLayerLine(sLayer);

				if (self.oParent.sAspect === 'area') {
					self.sharedLayerSetup({
						layer : sLayer,
						type : 'area',
						initcb : function() {
							this.aPoints = self.oAttributes['pointsarea'];
						},
						setupcb : function() {
							this.iLineWidth = 0;
							this.iBorderWidth = 0;
							this.fAlpha = self.oParent.fAlphaArea;
							var oPlotArea = self.oGraph.oPlotArea;
							this.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
						}
					});
				}

			} else if (self.oParent.sAspect === 'rose') {
				self.sharedLayerSetup({
					layer : sLayer,
					type : 'shape',
					initcb : function() {
						this.copy(self);
						this.sLineColor = self.oParent.aPalette[1];
						this.sBorderColor = self.oParent.aPalette[1];
						this.sBackgroundColor1 = self.oParent.aPalette[3];
						this.sBackgroundColor2 = self.oParent.aPalette[2];
						this.iX = self.getNodeData('x');
						this.iY = self.getNodeData('y');
						this.iPieSlice = self.getNodeData('sl');
						this.iPieAngleStart = self.getNodeData('as');
						this.iPieAngleEnd = self.getNodeData('ae');
						this.sShape = 'pie';
						this.iSize = self.getNodeData('sz');
					}
				});
			}
		}

		if (ZC._indexof_(['dots', 'line', 'area'], self.oParent.sAspect) !== -1) {
			self.sharedLayerMarker(sLayer);
		}
	}
});










ZC.ZCVBulletPlotNode = ZC.ZCVBarPlotNode.extend({
	oGoal : null,
	parseText : function(sText, oExtraFormat) {
		var self = this;		
		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		var sGoalValue = ZC.ZCUtils._format_(self.oParent.aNumericGoals[self.iIndex], oFormat);
		self.aTokens = [
			['%node-goal-value', sGoalValue],
			['%g', sGoalValue]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setupValues : function() {
		var self = this, mValue;
		self.aExtraValues = [];
		
		self.sValue = self.oData['value'];
		if (typeof(self.oData['value']) === 'string') {
			var iAssoc = ZC._indexof_(self.oGraph.aValAssoc, self.oData['value']);
			if (iAssoc !== -1) {
				self.fValue = iAssoc;
			} else {
				self.oGraph.aValAssoc.push(self.oData['value']);
				self.fValue = self.oGraph.aValAssoc.length-1;
			}
		} else {
			self.fValue = ZC._f_(self.oData['value']);
		}
		if (self.oParent.oData['goals'] && ZC._n_(mValue=self.oParent.oData['goals'][self.iIndex]) !== null) {
			self.aExtraValues.push(ZC._f_(mValue));
		}
	},
	paint : function() {
		var self = this;
		self._super();
	},
	paint_ : function() {
		var self = this, mValue;
		if (ZC._n_(self.oParent.aNumericGoals[self.iIndex]) !== null && self.bVisible) {
			var iYGoal = self.oParent._oScaleVal.getCoordByValue(self.oParent.aNumericGoals[self.iIndex]);
			self.oGoal = new ZC.ZCBox(self.oParent);
			self.oGoal.sId = self.sId + '-goal';
			self.oGoal.copy(self.oParent.oGoal);
			self.oGoal.oCanvas = self.oParent.getCanvas('bl', 1);
			self.oGoal.oCanvasSh = self.oParent.getCanvas('bl', 0);
			
			
			var fGoalExtension = 0.2;
			if (ZC._n_(mValue=self.oGoal.oData['extension']) !== null) {
				fGoalExtension = ZC._f_(mValue);
			}
			self.oGoal.iX = self.getNodeData('x') - self.iWidth*fGoalExtension;
			self.oGoal.iWidth = self.iWidth*(1 + 2*fGoalExtension);
			if (ZC._n_(self.oParent.oGoal.oData['height']) === null) {
				self.oGoal.iHeight = ZC._min_(5, self.oGraph.oPlotArea.iHeight/30);
			}
			self.oGoal.iY = iYGoal - self.oGoal.iHeight/2;
			self.oGoal.paint();

			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('rect', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--goal' + '" coords="' + ZC._i_(self.oGoal.iX+ZC.MAPTX) + ',' + ZC._i_(self.oGoal.iY+ZC.MAPTX) + ',' + ZC._i_(self.oGoal.iX+self.oGoal.iWidth+ZC.MAPTX) + ',' + ZC._i_(self.oGoal.iY+self.oGoal.iHeight+ZC.MAPTX) + '" />');
			
		}
	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self._super(sLayer);

		if (self.oGoal) {
			var oGoalHover = new ZC.ZCBox(self.oParent);
			oGoalHover.copy(self.oGoal);
			oGoalHover.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
			oGoalHover.bShadow = false;
			oGoalHover.iX = self.oGoal.iX;
			oGoalHover.iY = self.oGoal.iY;
			oGoalHover.paint();
		}
	}
});










ZC.ZCHBulletPlotNode = ZC.ZCHBarPlotNode.extend({
	oGoal : null,
	parseText : function(sText, oExtraFormat) {
		var self = this;		
		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		var sGoalValue = ZC.ZCUtils._format_(self.oParent.aNumericGoals[self.iIndex], oFormat);
		self.aTokens = [
			['%node-goal-value', sGoalValue],
			['%g', sGoalValue]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setupValues : function() {
		var self = this, mValue;
		self.aExtraValues = [];
		
		self.sValue = self.oData['value'];
		if (typeof(self.oData['value']) === 'string') {
			var iAssoc = ZC._indexof_(self.oGraph.aValAssoc, self.oData['value']);
			if (iAssoc !== -1) {
				self.fValue = iAssoc;
			} else {
				self.oGraph.aValAssoc.push(self.oData['value']);
				self.fValue = self.oGraph.aValAssoc.length-1;
			}
		} else {
			self.fValue = ZC._f_(self.oData['value']);
		}
		if (self.oParent.oData['goals'] && ZC._n_(mValue=self.oParent.oData['goals'][self.iIndex]) !== null) {
			self.aExtraValues.push(ZC._f_(mValue));
		}
	},
	paint : function() {
		var self = this;
		self._super();
	},
	paint_ : function() {
		var self = this, mValue;
		if (ZC._n_(self.oParent.aNumericGoals[self.iIndex]) !== null && self.bVisible) {
			var iXGoal = self.oParent._oScaleVal.getCoordByValue(self.oParent.aNumericGoals[self.iIndex]);
			self.oGoal = new ZC.ZCBox(self.oParent);
			self.oGoal.sId = self.sId + '-goal';
			self.oGoal.copy(self.oParent.oGoal);
			self.oGoal.oCanvas = self.oParent.getCanvas('bl', 1);
			self.oGoal.oCanvasSh = self.oParent.getCanvas('bl', 0);
			
			
			var fGoalExtension = 0.2;
			if (ZC._n_(mValue=self.oGoal.oData['extension']) !== null) {
				fGoalExtension = ZC._f_(mValue);
			}
			self.oGoal.iY = self.getNodeData('y') - self.iHeight*fGoalExtension;
			self.oGoal.iHeight = self.iHeight*(1 + 2*fGoalExtension);
			if (ZC._n_(self.oParent.oGoal.oData['width']) === null) {
				self.oGoal.iWidth = ZC._min_(5, self.oGraph.oPlotArea.iWidth/30);
			}
			self.oGoal.iX = iXGoal - self.oGoal.iWidth/2;
			self.oGoal.paint();

			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('rect', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--goal' + '" coords="' + ZC._i_(self.oGoal.iX+ZC.MAPTX) + ',' + ZC._i_(self.oGoal.iY+ZC.MAPTX) + ',' + ZC._i_(self.oGoal.iX+self.oGoal.iWidth+ZC.MAPTX) + ',' + ZC._i_(self.oGoal.iY+self.oGoal.iHeight+ZC.MAPTX) + '" />');
			
		}
	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self._super(sLayer);

		if (self.oGoal) {
			var oGoalHover = new ZC.ZCBox(self.oParent);
			oGoalHover.copy(self.oGoal);
			oGoalHover.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
			oGoalHover.bShadow = false;
			oGoalHover.iX = self.oGoal.iX;
			oGoalHover.iY = self.oGoal.iY;
			oGoalHover.paint();
		}
	}
});










ZC.ZCPianoPlotNode = ZC.ZCPlotNode.extend({
	setupValues : function() {
		var self = this, iAssoc;
		if (self.oData['value'] instanceof Array && ZC._n_(self.oData['value'][1]) !== null) {
			self.sValue = self.oData['value'][1];
			if (typeof(self.oData['value'][0]) === 'string') {
				iAssoc = ZC._indexof_(self.oGraph.aKeyAssoc, self.oData['value'][0]);
				if (iAssoc !== -1) {
					self.fKeyValue = iAssoc;
				} else {
					self.oGraph.aKeyAssoc.push(self.oData['value'][0]);
					self.fKeyValue = self.oGraph.aKeyAssoc.length-1;
				}
			} else {
				self.fKeyValue = ZC._f_(self.oData['value'][0]);
			}
			if (typeof(self.oData['value'][1]) === 'string') {
				iAssoc = ZC._indexof_(self.oGraph.aValAssoc, self.oData['value'][1]);
				if (iAssoc !== -1) {
					self.fValue = iAssoc;
				} else {
					self.oGraph.aValAssoc.push(self.oData['value'][1]);
					self.fValue = self.oGraph.aValAssoc.length-1;
				}
			} else {
				self.fValue = ZC._f_(self.oData['value'][1]);
			}
			if (self.fKeyValue !== null) {
				self.oParent.addKeyPlotAssoc(self.fKeyValue, self.iIndex);
			}
		}
	},
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			if (oScaleKey.bMirrored) {
				self.iX = oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetStart - (self.iIndex+1)*oScaleKey.iStepSize;
			} else {
				self.iX = oScaleKey.iX + oScaleKey.iOffsetStart + self.iIndex*oScaleKey.iStepSize;
			}
			if (oScaleVal.bMirrored) {
				self.iY = oScaleVal.iY + oScaleVal.iOffsetStart + self.oParent.iIndex*oScaleVal.iStepSize;
			} else {
				self.iY = oScaleVal.iY + oScaleVal.iHeight - oScaleVal.iOffsetStart - (self.oParent.iIndex+1)*oScaleVal.iStepSize;
			}
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}

		self.applyJsRule(self);

	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var sPlacement = 'over';
		if (ZC._n_(oValueBox.oData['placement']) !== null) {
			sPlacement = oValueBox.oData['placement'];
		}
		
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;

		var iX = self.iX + self.iWidth/2 - iWidth/2;
		var iY = self.iY + self.iHeight/2 - iHeight/2;
		switch (sPlacement) {
			case 'top':
				iY -= self.iHeight/2 + iHeight/2 + 2;
				break;
			case 'left':
				iX -= self.iWidth/2 + iWidth/2 + 2;
				break;
			case 'bottom':
				iY += self.iHeight/2 + iHeight/2 + 2;
				break;
			case 'right':
				iX += self.iWidth/2 + iWidth/2 + 2;
				break;
			
			default:
				break;
		}
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}
		return [ZC._i_(iX), ZC._i_(iY)];
	},
	getValueBoxStyle : function() {
		return {
			color : '#000'
		};
	},
	getFormatValue : function() {
		return this.sValue;
	},
	parseText : function(sText, oExtraFormat) {
		var self = this;
		var oScaleVal = self.oParent._oScaleVal;
		
		var iYIndex = self.oParent.iIndex;
		var sYValue;
		if (ZC._n_(oScaleVal.aLabels[iYIndex]) !== null) {
			sYValue = oScaleVal.aLabels[iYIndex];
		} else {
			sYValue = oScaleVal.aValues[iYIndex];
		}
		self.aTokens = [
			['%y', sYValue],
			['%scale-value-label', sYValue]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setupXY : function() {
		var self = this;

		self.setup();

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		var fRatio;
		switch (self.oParent.sReference) {
			case 'plot-max':
				fRatio = (ZC._f_(self.fValue) - self.oParent._iPlotMin)/(self.oParent._iPlotMax - self.oParent._iPlotMin);
				break;
			case 'plot-total':
				fRatio = (ZC._f_(self.fValue) - self.oParent._iPlotMin)/(self.oParent._iPlotTotal - self.oParent._iPlotMin);
				break;
			case 'chart-max':
				fRatio = (ZC._f_(self.fValue) - self.oParent._iChartMin)/(self.oParent._iChartMax - self.oParent._iChartMin);
				break;
			case 'chart-total':
				fRatio = (ZC._f_(self.fValue) - self.oParent._iChartMin)/(self.oParent._iChartTotal - self.oParent._iChartMin);
				break;
		}

		if (!ZC._isnumber_(fRatio)) {
			fRatio = 0.5;
		}

		self.iWidth = oScaleKey.iStepSize;
		self.iHeight = oScaleVal.iStepSize;

		switch (self.oParent.sAspect) {
			case 'alpha':
			case 'brightness':
				self.fAlpha = self.oParent.fMinRatio + fRatio*(self.oParent.fMaxRatio-self.oParent.fMinRatio);
				break;
			case 'horizontal':
				self.iWidth = 1.01 + self.oParent.fMinRatio*oScaleKey.iStepSize + fRatio*oScaleKey.iStepSize*(self.oParent.fMaxRatio-self.oParent.fMinRatio);
				if (oScaleKey.bMirrored) {
					self.iX = self.iX + oScaleKey.iStepSize - self.iWidth;
				}
				break;
			case 'vertical':
				self.iHeight = 1.01 + self.oParent.fMinRatio*oScaleVal.iStepSize + fRatio*oScaleVal.iStepSize*(self.oParent.fMaxRatio-self.oParent.fMinRatio);
				if (!oScaleVal.bMirrored) {
					self.iY = self.iY + oScaleVal.iStepSize - self.iHeight;
				}
				break;
			case 'size':
				self.iWidth = 1.01 + self.oParent.fMinRatio*oScaleKey.iStepSize + fRatio*oScaleKey.iStepSize*(self.oParent.fMaxRatio-self.oParent.fMinRatio);
				self.iHeight = 1.01 + self.oParent.fMinRatio*oScaleVal.iStepSize + fRatio*oScaleVal.iStepSize*(self.oParent.fMaxRatio-self.oParent.fMinRatio);
				self.iX += (oScaleKey.iStepSize-self.iWidth)/2;
				self.iY += (oScaleVal.iStepSize-self.iHeight)/2;
				break;
		}

		self.iX -= self.iBorderWidth/2;
		self.iY -= self.iBorderWidth/2;
		self.iWidth += self.iBorderWidth;
		self.iHeight += self.iBorderWidth;
	},
	paint : function() {
		var self = this;
		self._super();

		

		self.setupXY();

		if (self.bVisible) {
			
			var oBar = zingchart.pool.getInstance('ZCBox', self, self.oParent.sId + '-piano-box');
			oBar.sId = self.sId;

			oBar.copy(self);

			oBar.iX = self.iX;
			oBar.iY = self.iY;
			oBar.iWidth = self.iWidth;
			oBar.iHeight = self.iHeight;
			oBar.oCanvas = self.oParent.getCanvas('bl', 1);
			oBar.oCanvasSh = self.oParent.getCanvas('bl', 0);
			

			
			if (
				(oBar.sBorderColor !== -1 && oBar.iBorderWidth > 0)
				||
				(oBar.sBorderTop+oBar.sBorderRight+oBar.sBorderBottom+oBar.sBorderLeft !== '')
				||
				oBar.sBackgroundColor1 !== -1
				||
				oBar.sBackgroundColor2 !== -1
				||
				oBar.sBackgroundImage !== ''
				||
				oBar.sGradientColors !== ''
				||
				oBar.sGradientStops !== ''
		 	) {
				oBar.paint();
				if (!oBar.bFlat) {
					var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
					self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('rect', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + ZC._i_(self.iX+ZC.MAPTX) + ',' + ZC._i_(self.iY+ZC.MAPTX) + ',' + ZC._i_(self.iX+self.iWidth+ZC.MAPTX) + ',' + ZC._i_(self.iY+self.iHeight+ZC.MAPTX) + '" />');
					
				}
		 	}
		}

		if (self.oParent.oValueBox) {
			self.paintValueBox();
		}
	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self.sharedLayerSetup({
			layer : sLayer,
			type : 'box',
			initcb : function() {
				this.sLineColor = self.oParent.aPalette[1];
				this.sBorderColor = self.oParent.aPalette[1];
				this.sBackgroundColor1 = self.oParent.aPalette[2];
				this.sBackgroundColor2 = self.oParent.aPalette[3];
			},
			setupcb : function() {
				this.iX = self.iX;
				this.iY = self.iY;
				this.iWidth = self.iWidth;
				this.iHeight = self.iHeight;
			}
		});
	}
});










ZC.ZCVFunnelPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			if (oScaleKey.bMirrored) {
				self.iX = oScaleKey.iX + oScaleKey.iWidth - oScaleKey.iOffsetStart - (self.iIndex+1)*oScaleKey.iStepSize;
			} else {
				self.iX = oScaleKey.iX + oScaleKey.iOffsetStart + self.iIndex*oScaleKey.iStepSize;
			}
			if (oScaleVal.bMirrored) {
				self.iY = oScaleVal.iY + oScaleVal.iOffsetStart + self.oParent.iIndex*oScaleVal.iStepSize;
			} else {
				self.iY = oScaleVal.iY + oScaleVal.iHeight - oScaleVal.iOffsetStart - (self.oParent.iIndex+1)*oScaleVal.iStepSize;
			}
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	paint : function() {
		var self = this, iMin, iMax, i, iLen, aPoints, oArrowBox, iWidth, iHeight, oArrow, iX, iY, fSpace, sLabel, oLabel;
		self._super();

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		if (self.oParent.sStartWidth === 'static') {
			iMin = self.oGraph.oPlotSet.aMin[self.iIndex];
			iMax = self.oGraph.oPlotSet.aMax[self.iIndex];
		} else {
			iMin = self.oGraph.oPlotSet.fMin;
			iMax = self.oGraph.oPlotSet.fMax;
		}

		var iSpaceEntry = self.oParent.iSpaceEntry;
		if (iSpaceEntry <= 1) {
			iSpaceEntry *= oScaleKey.iStepSize;
		}
		var iSpaceExit = self.oParent.iSpaceExit;
		if (iSpaceExit <= 1) {
			iSpaceExit *= oScaleKey.iStepSize;
		}
		var iMinExit = self.oParent.iMinExit;
		if (iMinExit <= 1) {
			iMinExit *= oScaleKey.iStepSize;
		}
		var iStepSize = oScaleKey.iStepSize - iSpaceEntry - iSpaceExit - iMinExit;

		var fValueEntry = self.fValue;
		var fRatioEntry = fValueEntry/iMax;
		var iWidthEntry = iMinExit + iStepSize*fRatioEntry;

		var fValueExit = 0;
		if (self.oParent.iIndex+1 < self.oParent.oParent.aPlots.length && self.oParent.oParent.aPlots[self.oParent.iIndex+1].aPlotNodes[self.iIndex]) {
			fValueExit = self.oParent.oParent.aPlots[self.oParent.iIndex+1].aPlotNodes[self.iIndex].fValue;
		}
		var fRatioExit = fValueExit/iMax;
		var iWidthExit = iMinExit + iStepSize*fRatioExit;

		var iXMid = self.iX + (oScaleKey.bMirrored?iSpaceExit:iSpaceEntry) + iStepSize/2 + iMinExit/2;

		aPoints = [];
		if (oScaleVal.bMirrored) {
			aPoints.push(
				[iXMid - iWidthEntry/2, self.iY],
				[iXMid + iWidthEntry/2, self.iY],
				[iXMid + iWidthExit/2, self.iY + oScaleVal.iStepSize],
				[iXMid - iWidthExit/2, self.iY + oScaleVal.iStepSize],
				[iXMid - iWidthEntry/2, self.iY]
			);
		} else {
			aPoints.push(
				[iXMid - iWidthEntry/2, self.iY + oScaleVal.iStepSize],
				[iXMid + iWidthEntry/2, self.iY + oScaleVal.iStepSize],
				[iXMid + iWidthExit/2, self.iY],
				[iXMid - iWidthExit/2, self.iY],
				[iXMid - iWidthEntry/2, self.iY + oScaleVal.iStepSize]
			);
		}

		self.oAttributes['points'] = aPoints;

		if (self.bVisible) {
			var oTrapeze = new ZC.ZCShape(self.oParent);
			oTrapeze.sId = self.sId + '-trapeze';
			oTrapeze.copy(self);
			oTrapeze.aPoints = aPoints;
			oTrapeze.parse();
			oTrapeze.oCanvas = self.oParent.getCanvas('bl', 1);
			oTrapeze.oCanvasSh = self.oParent.getCanvas('bl', 0);
			
			oTrapeze.paint();
			var sCoords = oTrapeze.getAreaCoords();
			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />');
			
		}

		for (i=0,iLen=self.oParent.aEntry.length;i<iLen;i++) {
			var oEntry = self.oParent.aEntry[i];
			if (oEntry && ZC._n_(oEntry.oData['values']) !== null && ZC._n_(oEntry.oData['values'][self.iIndex]) !== null) {
				if (ZC._n_(oEntry.oData['width']) !== null || ZC._n_(oEntry.oData['height']) !== null) {
					oArrowBox = new ZC.ZCBox(self.oParent);
					oArrowBox.append(oEntry.oData);
					oArrowBox.parse();
				}
				iWidth = 0;
				iHeight = 0;
				if (ZC._n_(oEntry.oData['width']) !== null) {
					iWidth = oArrowBox.iWidth;
				}
				if (ZC._n_(oEntry.oData['height']) !== null) {
					iHeight = oArrowBox.iHeight;
				}
				if (iWidth === 0) {
					iWidth = ZC._max_(20, oScaleKey.iStepSize/10);
				}
				if (iHeight === 0) {
					iHeight = ZC._max_(16, oScaleVal.iStepSize/10);
				}

				oArrow = new ZC.ZCShape(self.oParent);
				oArrow.sId = self.sId + '-arrow-entry';
				oArrow.copy(self);
				oArrow.append(oEntry.oData);
				oArrow.parse();

				aPoints = [];
				if (self.oParent.aEntry.length === 1) {
					iY = self.iY + oScaleVal.iStepSize/2;
				} else {
					fSpace = oScaleVal.iStepSize/(self.oParent.aEntry.length + 1);
					iY = self.iY + fSpace + i*fSpace;
				}
				if (oScaleKey.bMirrored) {
					iX = self.iX + oScaleKey.iStepSize + iWidth - iSpaceEntry - iStepSize/2 + (iWidthEntry+iWidthExit)/4 - iMinExit/2 + 2;
					aPoints.push(
						[iX, iY - 2*iHeight/6],
						[iX - 2*iWidth/3, iY - iHeight/6],
						[iX - 2*iWidth/3, iY - 3*iHeight/6],
						[iX - iWidth, iY],
						[iX - 2*iWidth/3, iY + 3*iHeight/6],
						[iX - 2*iWidth/3, iY + iHeight/6],
						[iX, iY + 2*iHeight/6],
						[iX, iY - 2*iHeight/6]
					);
				} else {
					iX = self.iX + iSpaceEntry - iWidth + iStepSize/2 - (iWidthEntry+iWidthExit)/4 + iMinExit/2 - 2;
					aPoints.push(
						[iX, iY - 2*iHeight/6],
						[iX + 2*iWidth/3, iY - iHeight/6],
						[iX + 2*iWidth/3, iY - 3*iHeight/6],
						[iX + iWidth, iY],
						[iX + 2*iWidth/3, iY + 3*iHeight/6],
						[iX + 2*iWidth/3, iY + iHeight/6],
						[iX, iY + 2*iHeight/6],
						[iX, iY - 2*iHeight/6]
					);
				}

				oArrow.aPoints = aPoints;
				oArrow.parse();
				oArrow.oCanvas = self.oParent.getCanvas('bl', 1);
				oArrow.oCanvasSh = self.oParent.getCanvas('bl', 0);
				
				oArrow.paint();

				if (ZC._n_(oEntry.oData['labels']) !== null && ZC._n_(oEntry.oData['labels'][self.iIndex]) !== null && oEntry.oData['labels'][self.iIndex] !== '') {
					sLabel = oEntry.oData['labels'][self.iIndex];
					oLabel = new ZC.ZCTextBox(self.oParent);
					oLabel.sId = self.sId + '-entry-label-' + i;
					oLabel.sDOMClass = self.sId + '-entry-label ' + self.oParent.sId + '-entry-label zc-entry-label';
					oLabel.copy(self);
					
					oLabel.oData['text'] = sLabel;
					oLabel.append(oEntry.oData);
					if (ZC._n_(oEntry.oData['label']) !== null) {
						oLabel.append(oEntry.oData['label']);
					}
					oLabel.oCanvas = self.oParent.getCanvas('fl', 0);
					
					oLabel.parse();
					if (oScaleKey.bMirrored) {
						oLabel.iX = iX + 2;
					} else {
						oLabel.iX = iX - oLabel.iWidth - 2;
					}
					oLabel.iY = iY - oLabel.iHeight/2;
					oLabel.paint();
					oLabel.paintPrintVersion();
				}
			}
		}

		for (i=0,iLen=self.oParent.aExit.length;i<iLen;i++) {
			var oExit = self.oParent.aExit[i];
			if (oExit && ZC._n_(oExit.oData['values']) !== null && ZC._n_(oExit.oData['values'][self.iIndex]) !== null) {
				if (ZC._n_(oExit.oData['width']) !== null || ZC._n_(oExit.oData['height']) !== null) {
					oArrowBox = new ZC.ZCBox(self.oParent);
					oArrowBox.append(oExit.oData);
					oArrowBox.parse();
				}
				iWidth = 0;
				iHeight = 0;
				if (ZC._n_(oExit.oData['width']) !== null) {
					iWidth = oArrowBox.iWidth;
				}
				if (ZC._n_(oExit.oData['height']) !== null) {
					iHeight = oArrowBox.iHeight;
				}
				if (iWidth === 0) {
					iWidth = ZC._max_(20, oScaleKey.iStepSize/10);
				}
				if (iHeight === 0) {
					iHeight = ZC._max_(16, oScaleVal.iStepSize/10);
				}

				oArrow = new ZC.ZCShape(self.oParent);
				oArrow.sId = self.sId + '-arrow-exit';
				oArrow.copy(self);
				oArrow.append(oExit.oData);
				oArrow.parse();

				aPoints = [];
				if (self.oParent.aExit.length === 1) {
					iY = self.iY + oScaleVal.iStepSize/2;
				} else {
					fSpace = oScaleVal.iStepSize/(self.oParent.aExit.length + 1);
					iY = self.iY + fSpace + i*fSpace;
				}
				if (oScaleKey.bMirrored) {
					iX = self.iX + iSpaceExit + iStepSize/2 - (iWidthEntry+iWidthExit)/4 + iMinExit/2 - 2;
					aPoints.push(
						[iX, iY - 2*iHeight/6],
						[iX - 2*iWidth/3, iY - iHeight/6],
						[iX - 2*iWidth/3, iY - 3*iHeight/6],
						[iX - iWidth, iY],
						[iX - 2*iWidth/3, iY + 3*iHeight/6],
						[iX - 2*iWidth/3, iY + iHeight/6],
						[iX, iY + 2*iHeight/6],
						[iX, iY - 2*iHeight/6]
					);
				} else {
					iX = self.iX + oScaleKey.iStepSize - iSpaceExit - iStepSize/2 + (iWidthEntry+iWidthExit)/4 - iMinExit/2 + 2;
					aPoints.push(
						[iX, iY - 2*iHeight/6],
						[iX + 2*iWidth/3, iY - iHeight/6],
						[iX + 2*iWidth/3, iY - 3*iHeight/6],
						[iX + iWidth, iY],
						[iX + 2*iWidth/3, iY + 3*iHeight/6],
						[iX + 2*iWidth/3, iY + iHeight/6],
						[iX, iY + 2*iHeight/6],
						[iX, iY - 2*iHeight/6]
					);
				}

				oArrow.aPoints = aPoints;
				oArrow.parse();
				oArrow.oCanvas = self.oParent.getCanvas('bl', 1);
				oArrow.oCanvasSh = self.oParent.getCanvas('bl', 0);
				
				oArrow.paint();

				if (ZC._n_(oExit.oData['labels']) !== null && ZC._n_(oExit.oData['labels'][self.iIndex]) !== null && oExit.oData['labels'][self.iIndex] !== '') {
					sLabel = oExit.oData['labels'][self.iIndex];
					oLabel = new ZC.ZCTextBox(self.oParent);
					oLabel.sId = self.sId + '-exit-label-' + i;
					oLabel.sDOMClass = self.sId + '-exit-label ' + self.oParent.sId + '-exit-label zc-exit-label';
					oLabel.copy(self);
					
					oLabel.oData['text'] = sLabel;
					oLabel.append(oExit.oData);
					if (ZC._n_(oExit.oData['label']) !== null) {
						oLabel.append(oExit.oData['label']);
					}
					oLabel.parse();
					oLabel.oCanvas = self.oParent.getCanvas('fl', 0);
					
					if (oScaleKey.bMirrored) {
						oLabel.iX = iX - iWidth - oLabel.iWidth - 2;
					} else {
						oLabel.iX = iX + iWidth + 2;
					}
					oLabel.iY = iY - oLabel.iHeight/2;
					oLabel.paint();
					oLabel.paintPrintVersion();
				}

			}
		}

		if (self.oParent.oValueBox) {
			self.paintValueBox();
		}

	},
	showLayer : function() {
		var self = this;
		if (ZC.move) { return; }
		if (self.oParent.oHoverState && self.oParent.bVisible) {
			self._super();
			var oHoverTrapeze = new ZC.ZCShape(self.oParent);
			oHoverTrapeze.sId = self.sId + '-trapeze-hover';
			oHoverTrapeze.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
			oHoverTrapeze.aPoints = self.oAttributes['points'];
			oHoverTrapeze.parse();
			oHoverTrapeze.sLineColor = self.oParent.aPalette[1];
			oHoverTrapeze.sBorderColor = self.oParent.aPalette[1];
			oHoverTrapeze.sBackgroundColor1 = self.oParent.aPalette[2];
			oHoverTrapeze.sBackgroundColor2 = self.oParent.aPalette[3];
			oHoverTrapeze.append(self.oParent.oHoverState.oData);
			oHoverTrapeze.parse();
			oHoverTrapeze.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oHoverTrapeze.applyRules()) {
				oHoverTrapeze.parse();
			}
			if (oHoverTrapeze.bVisible) {
				oHoverTrapeze.paint();
			}
		}
	}
});










ZC.ZCHFunnelPlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			if (oScaleKey.bMirrored) {
				self.iY = oScaleKey.iY + oScaleKey.iOffsetStart + self.iIndex*oScaleKey.iStepSize;
			} else {
				self.iY = oScaleKey.iY + oScaleKey.iHeight - oScaleKey.iOffsetStart - (self.iIndex+1)*oScaleKey.iStepSize;
			}
			if (oScaleVal.bMirrored) {
				self.iX = oScaleVal.iX + oScaleVal.iWidth - oScaleVal.iOffsetStart - (self.oParent.iIndex+1)*oScaleVal.iStepSize;
			} else {
				self.iX = oScaleVal.iX + oScaleVal.iOffsetStart + self.oParent.iIndex*oScaleVal.iStepSize;
			}
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	paint : function() {
		var self = this, iMin, iMax, i, iLen, iWidth, iHeight, oArrowBox, aPoints, oArrow, iX, iY, fSpace, sLabel, oLabel;
		self._super();

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		if (self.oParent.sStartWidth === 'static') {
			iMin = self.oGraph.oPlotSet.aMin[self.iIndex];
			iMax = self.oGraph.oPlotSet.aMax[self.iIndex];
		} else {
			iMin = self.oGraph.oPlotSet.fMin;
			iMax = self.oGraph.oPlotSet.fMax;
		}

		var iSpaceEntry = self.oParent.iSpaceEntry;
		if (iSpaceEntry <= 1) {
			iSpaceEntry *= oScaleKey.iStepSize;
		}
		var iSpaceExit = self.oParent.iSpaceExit;
		if (iSpaceExit <= 1) {
			iSpaceExit *= oScaleKey.iStepSize;
		}
		var iMinExit = self.oParent.iMinExit;
		if (iMinExit <= 1) {
			iMinExit *= oScaleKey.iStepSize;
		}
		var iStepSize = oScaleKey.iStepSize - iSpaceEntry - iSpaceExit - iMinExit;

		var fValueEntry = self.fValue;
		var fRatioEntry = fValueEntry/iMax;
		var iHeightEntry = iMinExit + iStepSize*fRatioEntry;

		var fValueExit = 0;
		if (self.oParent.iIndex+1 < self.oParent.oParent.aPlots.length && self.oParent.oParent.aPlots[self.oParent.iIndex+1].aPlotNodes[self.iIndex]) {
			fValueExit = self.oParent.oParent.aPlots[self.oParent.iIndex+1].aPlotNodes[self.iIndex].fValue;
		}
		var fRatioExit = fValueExit/iMax;
		var iHeightExit = iMinExit + iStepSize*fRatioExit;

		var iYMid = self.iY + (oScaleKey.bMirrored?iSpaceEntry:iSpaceExit) + iStepSize/2 + iMinExit/2;

		aPoints = [];
		if (oScaleVal.bMirrored) {
			aPoints.push(
				[self.iX + oScaleVal.iStepSize, iYMid - iHeightEntry/2],
				[self.iX + oScaleVal.iStepSize, iYMid + iHeightEntry/2],
				[self.iX, iYMid + iHeightExit/2],
				[self.iX, iYMid - iHeightExit/2],
				[self.iX + oScaleVal.iStepSize, iYMid - iHeightEntry/2]
			);
		} else {
			aPoints.push(
				[self.iX, iYMid - iHeightEntry/2],
				[self.iX, iYMid + iHeightEntry/2],
				[self.iX + oScaleVal.iStepSize, iYMid + iHeightExit/2],
				[self.iX + oScaleVal.iStepSize, iYMid - iHeightExit/2],
				[self.iX, iYMid - iHeightEntry/2]
			);
		}

		self.oAttributes['points'] = aPoints;

		if (self.bVisible) {
			var oTrapeze = new ZC.ZCShape(self.oParent);
			oTrapeze.sId = self.sId + '-trapeze';
			oTrapeze.copy(self);
			oTrapeze.aPoints = aPoints;
			oTrapeze.parse();
			oTrapeze.oCanvas = self.oParent.getCanvas('bl', 1);
			oTrapeze.oCanvasSh = self.oParent.getCanvas('bl', 0);
			
			oTrapeze.paint();
			var sCoords = oTrapeze.getAreaCoords();
			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />');
			
		}

		for (i=0,iLen=self.oParent.aEntry.length;i<iLen;i++) {
			var oEntry = self.oParent.aEntry[i];
			if (oEntry && ZC._n_(oEntry.oData['values']) !== null && ZC._n_(oEntry.oData['values'][self.iIndex]) !== null) {
				if (ZC._n_(oEntry.oData['width']) !== null || ZC._n_(oEntry.oData['height']) !== null) {
					oArrowBox = new ZC.ZCBox(self.oParent);
					oArrowBox.append(oEntry.oData);
					oArrowBox.parse();
				}
				iWidth = 0;
				iHeight = 0;
				if (ZC._n_(oEntry.oData['width']) !== null) {
					iWidth = oArrowBox.iWidth;
				}
				if (ZC._n_(oEntry.oData['height']) !== null) {
					iHeight = oArrowBox.iHeight;
				}
				if (iHeight === 0) {
					iHeight = ZC._max_(20, oScaleKey.iStepSize/10);
				}
				if (iWidth === 0) {
					iWidth = ZC._max_(16, oScaleVal.iStepSize/10);
				}

				oArrow = new ZC.ZCShape(self.oParent);
				oArrow.sId = self.sId + '-arrow-entry';
				oArrow.copy(self);
				oArrow.append(oEntry.oData);
				oArrow.parse();

				aPoints = [];
				if (self.oParent.aEntry.length === 1) {
					iX = self.iX + oScaleVal.iStepSize/2;
				} else {
					fSpace = oScaleVal.iStepSize/(self.oParent.aEntry.length + 1);
					iX = self.iX + fSpace + i*fSpace;
				}
				if (oScaleKey.bMirrored) {
					iY = self.iY + iSpaceEntry - iHeight + iStepSize/2 - (iHeightEntry+iHeightExit)/4 + iMinExit/2 - 2;
					aPoints.push(
						[iX - 2*iWidth/6, iY],
						[iX + 2*iWidth/6, iY],
						[iX + iWidth/6, iY + 2*iHeight/3],
						[iX + 3*iWidth/6, iY + 2*iHeight/3],
						[iX, iY + iHeight],
						[iX - 3*iWidth/6, iY + 2*iHeight/3],
						[iX - iWidth/6, iY + 2*iHeight/3]
					);
				} else {
					iY = self.iY + oScaleKey.iStepSize + iHeight - iSpaceEntry - iStepSize/2 + (iHeightEntry+iHeightExit)/4 - iMinExit/2 + 2;
					aPoints.push(
						[iX - 2*iWidth/6, iY],
						[iX + 2*iWidth/6, iY],
						[iX + iWidth/6, iY - 2*iHeight/3],
						[iX + 3*iWidth/6, iY - 2*iHeight/3],
						[iX, iY - iHeight],
						[iX - 3*iWidth/6, iY - 2*iHeight/3],
						[iX - iWidth/6, iY - 2*iHeight/3]
					);
				}

				oArrow.aPoints = aPoints;
				oArrow.parse();
				oArrow.oCanvas = self.oParent.getCanvas('bl', 1);
				oArrow.oCanvasSh = self.oParent.getCanvas('bl', 0);
				
				oArrow.paint();

				if (ZC._n_(oEntry.oData['labels']) !== null && ZC._n_(oEntry.oData['labels'][self.iIndex]) !== null && oEntry.oData['labels'][self.iIndex] !== '') {
					sLabel = oEntry.oData['labels'][self.iIndex];
					oLabel = new ZC.ZCTextBox(self.oParent);
					oLabel.sId = self.sId + '-entry-label-' + i;
					oLabel.sDOMClass = self.sId + '-entry-label ' + self.oParent.sId + '-entry-label zc-entry-label';
					oLabel.copy(self);
					
					oLabel.oData['text'] = sLabel;
					oLabel.append(oEntry.oData);
					if (ZC._n_(oEntry.oData['label']) !== null) {
						oLabel.append(oEntry.oData['label']);
					}
					oLabel.sText = sLabel;
					oLabel.oCanvas = self.oParent.getCanvas('fl', 0);
					
					oLabel.parse();
					oLabel.iX = iX - oLabel.iWidth/2;
					if (oScaleKey.bMirrored) {
						oLabel.iY = iY - oLabel.iHeight - 2;
					} else {
						oLabel.iY = iY + 2;
					}
					oLabel.paint();
					oLabel.paintPrintVersion();
				}
			}
		}

		for (i=0,iLen=self.oParent.aExit.length;i<iLen;i++) {
			var oExit = self.oParent.aExit[i];
			if (oExit && ZC._n_(oExit.oData['values']) !== null && ZC._n_(oExit.oData['values'][self.iIndex]) !== null) {
				if (ZC._n_(oExit.oData['width']) !== null || ZC._n_(oExit.oData['height']) !== null) {
					oArrowBox = new ZC.ZCBox(self.oParent);
					oArrowBox.append(oExit.oData);
					oArrowBox.parse();
				}
				iWidth = 0;
				iHeight = 0;
				if (ZC._n_(oExit.oData['width']) !== null) {
					iWidth = oArrowBox.iWidth;
				}
				if (ZC._n_(oExit.oData['height']) !== null) {
					iHeight = oArrowBox.iHeight;
				}
				if (iHeight === 0) {
					iHeight = ZC._max_(20, oScaleKey.iStepSize/10);
				}
				if (iWidth === 0) {
					iWidth = ZC._max_(16, oScaleVal.iStepSize/10);
				}

				oArrow = new ZC.ZCShape(self.oParent);
				oArrow.sId = self.sId + '-arrow-exit';
				oArrow.copy(self);
				oArrow.append(oExit.oData);
				oArrow.parse();

				aPoints = [];
				if (self.oParent.aEntry.length === 1) {
					iX = self.iX + oScaleVal.iStepSize/2;
				} else {
					fSpace = oScaleVal.iStepSize/(self.oParent.aEntry.length + 1);
					iX = self.iX + fSpace + i*fSpace;
				}
				if (oScaleKey.bMirrored) {
					iY = self.iY + iSpaceEntry + iStepSize/2 + (iHeightEntry+iHeightExit)/4 + iMinExit/2 + 2;
					aPoints.push(
						[iX - 2*iWidth/6, iY],
						[iX + 2*iWidth/6, iY],
						[iX + iWidth/6, iY + 2*iHeight/3],
						[iX + 3*iWidth/6, iY + 2*iHeight/3],
						[iX, iY + iHeight],
						[iX - 3*iWidth/6, iY + 2*iHeight/3],
						[iX - iWidth/6, iY + 2*iHeight/3]
					);
				} else {
					iY = self.iY + oScaleKey.iStepSize - iSpaceEntry - iStepSize/2 - (iHeightEntry+iHeightExit)/4 - iMinExit/2 - 2;
					aPoints.push(
						[iX - 2*iWidth/6, iY],
						[iX + 2*iWidth/6, iY],
						[iX + iWidth/6, iY - 2*iHeight/3],
						[iX + 3*iWidth/6, iY - 2*iHeight/3],
						[iX, iY - iHeight],
						[iX - 3*iWidth/6, iY - 2*iHeight/3],
						[iX - iWidth/6, iY - 2*iHeight/3]
					);
				}

				oArrow.aPoints = aPoints;
				oArrow.parse();
				oArrow.oCanvas = self.oParent.getCanvas('bl', 1);
				oArrow.oCanvasSh = self.oParent.getCanvas('bl', 0);
				
				oArrow.paint();

				if (ZC._n_(oExit.oData['labels']) !== null && ZC._n_(oExit.oData['labels'][self.iIndex]) !== null && oExit.oData['labels'][self.iIndex] !== '') {
					sLabel = oExit.oData['labels'][self.iIndex];
					oLabel = new ZC.ZCTextBox(self.oParent);
					oLabel.sId = self.sId + '-exit-label-' + i;
					oLabel.sDOMClass = self.sId + '-exit-label ' + self.oParent.sId + '-exit-label zc-exit-label';
					oLabel.copy(self);
					
					oLabel.oData['text'] = sLabel;
					oLabel.append(oExit.oData);
					if (ZC._n_(oExit.oData['label']) !== null) {
						oLabel.append(oExit.oData['label']);
					}
					oLabel.sText = sLabel;
					oLabel.oCanvas = self.oParent.getCanvas('fl', 0);
					
					oLabel.parse();
					oLabel.iX = iX - oLabel.iWidth/2;
					if (oScaleKey.bMirrored) {
						oLabel.iY = iY + iHeight + 2;
					} else {
						oLabel.iY = iY - iHeight - oLabel.iHeight - 2;
					}
					oLabel.paint();
					oLabel.paintPrintVersion();
				}

			}
		}

		if (self.oParent.oValueBox) {
			self.paintValueBox();
		}

	},
	showLayer : function() {
		var self = this;
		if (ZC.move) { return; }
		if (self.oParent.oHoverState && self.oParent.bVisible) {
			self._super();
			var oHoverTrapeze = new ZC.ZCShape(self.oParent);
			oHoverTrapeze.sId = self.sId + '-trapeze-hover';
			oHoverTrapeze.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
			oHoverTrapeze.aPoints = self.oAttributes['points'];
			oHoverTrapeze.parse();
			oHoverTrapeze.sLineColor = self.oParent.aPalette[1];
			oHoverTrapeze.sBorderColor = self.oParent.aPalette[1];
			oHoverTrapeze.sBackgroundColor1 = self.oParent.aPalette[2];
			oHoverTrapeze.sBackgroundColor2 = self.oParent.aPalette[3];
			oHoverTrapeze.append(self.oParent.oHoverState.oData);
			oHoverTrapeze.parse();
			oHoverTrapeze.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oHoverTrapeze.applyRules()) {
				oHoverTrapeze.parse();
			}
			if (oHoverTrapeze.bVisible) {
				oHoverTrapeze.paint();
			}
		}
	}
});










ZC.ZCStockPlotNode = ZC.ZCPlotNode.extend({
	oStyleC : null,
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex];
		if (self.aXYRef !== aXYRef_) {
			if (self.fKeyValue !== null) {
				self.iX = oScaleKey.getCoordByValue(self.fKeyValue);
			} else {
				self.iX = oScaleKey.getCoordByIndex(self.iIndex);
			}
			self.iY = oScaleVal.getCoordByValue(self.fValue);
			self.oAttributes['iYOpen'] = oScaleVal.getCoordByValue(self.fValue);
			self.oAttributes['iYHigh'] = oScaleVal.getCoordByValue(self.aExtraValues[0]);
			self.oAttributes['iYLow'] = oScaleVal.getCoordByValue(self.aExtraValues[1]);
			self.oAttributes['iYClose'] = oScaleVal.getCoordByValue(self.aExtraValues[2]);
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit || (self.oParent.bFast && self.oParent.oStyleCache['size'] < 3)) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.oStyleC = new ZC.ZCTextBox(self.oParent);
			self.oStyleC.copy(self);
			if (self.aExtraValues[2] < self.fValue) {
				self.oStyleC.sBackgroundColor1 = self.oStyleC.sBackgroundColor2 = self.sColor;
				self.oStyleC.sBorderColor = self.sLineColor;
			}
			if (self.aExtraValues[2] < self.fValue) {
				if (self.oParent.oData['trend-down']) {
					self.oStyleC.append(self.oParent.oData['trend-down']);
					self.oStyleC.parse();
				}
				if (!self.oParent.oStyleCache['down']) {
					self.oParent.oStyleCache['down'] = new ZC.ZCTextBox(self.oParent);
					self.oParent.oStyleCache['down'].copy(self.oStyleC);
					self.oParent.oStyleCache['size']++;
				}
			} else if (self.aExtraValues[2] > self.fValue) {
				if (self.oParent.oData['trend-up']) {
					self.oStyleC.append(self.oParent.oData['trend-up']);
					self.oStyleC.parse();
				}
				if (!self.oParent.oStyleCache['up']) {
					self.oParent.oStyleCache['up'] = new ZC.ZCTextBox(self.oParent);
					self.oParent.oStyleCache['up'].copy(self.oStyleC);
					self.oParent.oStyleCache['size']++;
				}
			} else {
				if (self.oParent.oData['trend-equal']) {
					self.oStyleC.append(self.oParent.oData['trend-equal']);
					self.oStyleC.parse();
				}
				if (!self.oParent.oStyleCache['equal']) {
					self.oParent.oStyleCache['equal'] = new ZC.ZCTextBox(self.oParent);
					self.oParent.oStyleCache['equal'].copy(self.oStyleC);
					self.oParent.oStyleCache['size']++;
				}
			}
			self.bInit = true;
		}
		if (self.oParent.bFast) {
			if (self.aExtraValues[2] < self.fValue) {
				self.oStyleC = self.oParent.oStyleCache['down'];
			} else if (self.aExtraValues[2] > self.fValue) {
				self.oStyleC = self.oParent.oStyleCache['up'];
			} else {
				self.oStyleC = self.oParent.oStyleCache['equal'];
			}
			
			var iY = ZC._min_(self.oAttributes['iYOpen'], self.oAttributes['iYClose']);
			var iHeight = ZC._max_(self.oAttributes['iYOpen'], self.oAttributes['iYClose']) - ZC._min_(self.oAttributes['iYOpen'], self.oAttributes['iYClose']);
			if (iHeight < 2) {
				iHeight = 2;
			}
			self.oAttributes['iGuideY'] = iY + iHeight/2;
		}
	},
	parseText : function(sText, oExtraFormat) {
		var self = this;

		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		function _format_(fValue) {
			return ZC.ZCUtils._format_(fValue, oFormat);
		}
		self.aTokens = [
			['%node-value-stock-open', _format_(self.fValue)],
			['%v0', _format_(self.fValue)],
			['%node-value-stock-high', _format_(self.aExtraValues[0])],
			['%v1', _format_(self.aExtraValues[0])],
			['%node-value-stock-low', _format_(self.aExtraValues[1])],
			['%v2', _format_(self.aExtraValues[1])],
			['%node-value-stock-close', _format_(self.aExtraValues[2])],
			['%v3', _format_(self.aExtraValues[2])]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setupValues : function() {
		var self = this, mValue, aOHLC;
		self.aExtraValues = [];
		
		if (self.oData['value'] instanceof Array && self.oData['value'].length === 5) {
			self.fKeyValue = ZC._f_(self.oData['value'][0]);
			if (self.fKeyValue !== null) {
				if (ZC._n_(self.oParent.oKeyPlotAssoc[self.fKeyValue]) === null || ZC._indexof_(self.oParent.oKeyPlotAssoc[self.fKeyValue], self.iIndex) === -1) {
					self.oParent.addKeyPlotAssoc(self.fKeyValue, self.iIndex);
				}
			}
			aOHLC = [self.oData['value'][1], self.oData['value'][2], self.oData['value'][3], self.oData['value'][4]];
		} else {
			if (self.oData['value'][1] instanceof Array) {
				if (typeof(self.oData['value'][0]) === 'string') {
					var iAssoc = ZC._indexof_(self.oGraph.aKeyAssoc, self.oData['value'][0]);
					if (iAssoc !== -1) {
						self.fKeyValue = iAssoc;
					} else {
						self.oGraph.aKeyAssoc.push(self.oData['value'][0]);
						self.fKeyValue = self.oGraph.aKeyAssoc.length-1;
					}
				} else {
					self.fKeyValue = ZC._f_(self.oData['value'][0]);
				}
				if (self.fKeyValue !== null) {
					if (ZC._n_(self.oParent.oKeyPlotAssoc[self.fKeyValue]) === null || ZC._indexof_(self.oParent.oKeyPlotAssoc[self.fKeyValue], self.iIndex) === -1) {
						self.oParent.addKeyPlotAssoc(self.fKeyValue, self.iIndex);
					}
				}
				aOHLC = self.oData['value'][1];
			} else {
				aOHLC = self.oData['value'];
			}
		}
		self.sValue = aOHLC.join(' ');
		self.fValue = ZC._f_(aOHLC[0]);
		if (ZC._n_(mValue=aOHLC[1]) !== null) {
			self.aExtraValues.push(ZC._f_(mValue));
		}
		if (ZC._n_(mValue=aOHLC[2]) !== null) {
			self.aExtraValues.push(ZC._f_(mValue));
		}
		if (ZC._n_(mValue=aOHLC[3]) !== null) {
			self.aExtraValues.push(ZC._f_(mValue));
		}
	},
	getValueBoxStyle : function() {
		var self = this;
		var oStyle = {};
		if (self.aExtraValues[2] < self.fValue) {
			oStyle['background-color'] = self.oStyleC.sLineColor;
		} else {
			oStyle['background-color'] = self.oStyleC.sBackgroundColor1;
		}
		oStyle['color'] = self.oStyleC.sColor;
		return oStyle;
	},
	getTooltipStyle : function() {
		var self = this;
		var oStyle = {};
		if (self.aExtraValues[2] < self.fValue) {
			oStyle['background-color'] = self.oStyleC.sLineColor;
		} else {
			oStyle['background-color'] = self.oStyleC.sBackgroundColor1;
		}
		oStyle['border-color'] = oStyle['background-color'];
		oStyle['color'] = self.oStyleC.sColor;
		return oStyle;
	},
	getGuideStyle : function() {
		return this.getTooltipStyle();
	},
	paint : function() {
		var self = this, mValue;

		self._super();

		var oScaleKey = self.oParent._oScaleKey;

		self.setup();

		var iStepSize = oScaleKey.iStepSize * self.oParent.iStep;

		var iBarIndex = self.oParent.iIndex;
		var iBarGroups = 0;
		for (var i=0;i<self.oParent.oParent.aBarGroups['stock'].length;i++) {
			iBarGroups++;
			if (ZC._indexof_(self.oParent.oParent.aBarGroups[self.oParent.sType][i], self.oParent.iIndex) !== -1) {
				iBarIndex = i;
			}
		}

		var iBarsSpaceLeft = self.oParent.iBarsSpaceLeft;
		if (iBarsSpaceLeft <= 1) {
			iBarsSpaceLeft *= iStepSize;
		}
		var iBarsSpaceRight = self.oParent.iBarsSpaceRight;
		if (iBarsSpaceRight <= 1) {
			iBarsSpaceRight *= iStepSize;
		}
		var iBarsWidth = iStepSize - iBarsSpaceLeft - iBarsSpaceRight;
		var iBarSpace = self.oParent.iBarSpace;
		if (iBarSpace <= 1) {
			iBarSpace *= iBarsWidth;
		}
		if (iBarsWidth < 1) {
			iBarsWidth = iStepSize*0.8;
			iBarsSpaceLeft = iStepSize*0.1;
			iBarsSpaceRight = iStepSize*0.1;
		}
		var iBarWidth = iBarsWidth;
		var iBarsOverlap = self.oParent.iBarsOverlap;
		if (iBarsOverlap !== 0) {
			iBarSpace = 0;
		}
		if (iBarGroups > 1) {
			if (iBarsOverlap > 1) {
				iBarWidth = (iBarsWidth-(iBarGroups-1)*iBarSpace+(iBarGroups-1)*iBarsOverlap)/iBarGroups;
			} else {
				iBarWidth = (iBarsWidth-(iBarGroups-1)*iBarSpace)/(iBarGroups-(iBarGroups-1)*iBarsOverlap);
				iBarsOverlap *= iBarWidth;
			}
		}
		iBarWidth = ZC._l_(iBarWidth, 1, iBarsWidth);

		var iX = self.iX - iStepSize/2 + iBarsSpaceLeft + iBarIndex*(iBarWidth + iBarSpace) - iBarIndex*iBarsOverlap;
		iX = ZC._l_(iX, self.iX - iStepSize/2 + iBarsSpaceLeft, self.iX + iStepSize/2 - iBarsSpaceRight);
		var iWidth = iBarWidth;

		var iY = ZC._min_(self.oAttributes['iYOpen'], self.oAttributes['iYClose']);
		var iHeight = ZC._max_(self.oAttributes['iYOpen'], self.oAttributes['iYClose']) - ZC._min_(self.oAttributes['iYOpen'], self.oAttributes['iYClose']);

		if (iHeight < 2) {
			iHeight = 2;
		}

		if (iBarsSpaceLeft + iBarsSpaceRight === 0) {
			iX -= 0.5;
			iWidth += 1;
		}

		self.iWidth = iWidth;
		self.iHeight = iHeight;
		self.iX = iX;

		self.oAttributes['iGuideY'] = iY + iHeight/2;
		self.setNodeData({
			x : iX,
			y : iY,
			w : iWidth,
			h : iHeight
		});

		var oCtx;
		if (self.bVisible) {
			oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oLoader.bFlat?(self.oGraph.sId + '-plots-bl-c'):(self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-bl-1-c')), self.oLoader.sOutput);
			
			var iXMiddle = self.iX + self.iWidth/2;

			if (self.aExtraValues[2] < self.fValue && (mValue=self.oParent.oData['trend-down'])) {
				self.oAttributes['selected-state'] = mValue['selected-state'];
				self.oAttributes['background-state'] = mValue['background-state'];
			} else if (self.aExtraValues[2] > self.fValue && (mValue=self.oParent.oData['trend-up'])) {
				self.oAttributes['selected-state'] = mValue['selected-state'];
				self.oAttributes['background-state'] = mValue['background-state'];
			} else if (self.aExtraValues[2] === self.fValue && (mValue=self.oParent.oData['trend-equal'])) {
				self.oAttributes['selected-state'] = mValue['selected-state'];
				self.oAttributes['background-state'] = mValue['background-state'];
			}

			var aPoints, oStyle = self.oParent.applySelectionStyle(self, self.oStyleC);
			
			switch (self.oParent.sAspect) {
				
				default:
					aPoints = [];
					aPoints.push(
						[iXMiddle, self.oAttributes['iYHigh']],
						[iXMiddle, ZC._min_(self.oAttributes['iYOpen'], self.oAttributes['iYClose'])],
						null,
						[iXMiddle, self.oAttributes['iYLow']],
						[iXMiddle, ZC._max_(self.oAttributes['iYOpen'], self.oAttributes['iYClose'])]
					);
					ZC.ZCLine.paint(oCtx, oStyle, aPoints);

					
					var oBar, oBarCache;
					if (self.aExtraValues[2] < self.fValue) {
						oBarCache = self.oParent.oBarDown;
					} else if (self.aExtraValues[2] > self.fValue) {
						oBarCache = self.oParent.oBarUp;
					} else {
						oBarCache = self.oParent.oBarEqual;
					}
					if (self.oParent.aRules.length === 0 && typeof(oBarCache) !== 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
						oBar = oBarCache;
					} else  {
						oBar = new ZC.ZCBox(self.oParent);
						oBar.copy(oStyle);
					}

					self.applyJsRule(oBar);

					oBar.oCanvas = self.oParent.getCanvas('bl', 1);
					oBar.oCanvasSh = self.oParent.getCanvas('bl', 0);
					
					oBar.sId = self.sId;
					oBar.iX = iX;
					oBar.iY = iY;
					oBar.iWidth = self.iWidth;
					oBar.iHeight = self.iHeight;
					oBar.paint();
					if (self.oParent.aRules.length === 0 && typeof(oBarCache) === 'undefined' && !self.oStyle.oData['override'] && !self.oGraph.bSelection) {
						if (self.aExtraValues[2] < self.fValue) {
							self.oParent.oBarDown = oBar;
						} else if (self.aExtraValues[2] > self.fValue) {
							self.oParent.oBarUp = oBar;
						} else {
							self.oParent.oBarEqual = oBar;
						}
					}
					break;
				case 'whisker':
				case 'ohlc':
					aPoints = [];
					aPoints.push(
						[iXMiddle, self.oAttributes['iYHigh']],
						[iXMiddle, self.oAttributes['iYLow']],
						null,
						[iXMiddle - self.iWidth/4, self.oAttributes['iYOpen']],
						[iXMiddle, self.oAttributes['iYOpen']],
						null,
						[iXMiddle + self.iWidth/4, self.oAttributes['iYClose']],
						[iXMiddle, self.oAttributes['iYClose']]
					);

					self.applyJsRule(oStyle);
					
					ZC.ZCLine.paint(oCtx, oStyle, aPoints);
					break;
			}
			if (self.oParent._bCreateAreaMap) {
				var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
				
				self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('rect', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + ZC._i_(iX+ZC.MAPTX) + ',' + ZC._i_(self.oAttributes['iYHigh']+ZC.MAPTX) + ',' + ZC._i_(iX+iWidth+ZC.MAPTX) + ',' + ZC._i_(self.oAttributes['iYLow']+ZC.MAPTX) + '" />');
				
			}
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}
	},
	showLayer : function() {
		var self = this;
		if (ZC.move) { return; }
		if (self.oParent.oHoverState && self.oParent.bVisible) {
			self._super();
			switch (self.oParent.sAspect) {
				case 'candlestick':
					var oHoverBar = new ZC.ZCBox(self.oParent);
					oHoverBar.sId = self.sId + '-hover';
					oHoverBar.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
					oHoverBar.sColor = self.oParent.aPalette[0];
					oHoverBar.sLineColor = self.oParent.aPalette[1];
					oHoverBar.sBorderColor = self.oParent.aPalette[1];
					oHoverBar.sBackgroundColor1 = self.oParent.aPalette[2];
					oHoverBar.sBackgroundColor2 = self.oParent.aPalette[3];
					oHoverBar.append(self.oParent.oHoverState.oData);
					oHoverBar.bIgnoreLocate = true;
					oHoverBar.parse();
					oHoverBar.parseRule = function(sRule) {
						return self.parseRule(sRule);
					};
					if (oHoverBar.applyRules()) {
						oHoverBar.parse();
					}
					if (self.aExtraValues[2] < self.fValue) {
						oHoverBar.sBackgroundColor1 = oHoverBar.sBackgroundColor2 = oHoverBar.sColor;
						oHoverBar.sBorderColor = oHoverBar.sLineColor;
					}

					if (self.aExtraValues[2] < self.fValue && self.oParent.oData['trend-down']) {
						oHoverBar.append(self.oParent.oData['trend-down']);
						oHoverBar.append(self.oParent.oData['hover-state']);
						if (self.oParent.oData['trend-down']['hover-state']) {
							oHoverBar.append(self.oParent.oData['trend-down']['hover-state']);
						}
						oHoverBar.parse();
					} else if (self.aExtraValues[2] > self.fValue && self.oParent.oData['trend-up']) {
						oHoverBar.append(self.oParent.oData['trend-up']);
						oHoverBar.append(self.oParent.oData['hover-state']);
						if (self.oParent.oData['trend-up']['hover-state']) {
							oHoverBar.append(self.oParent.oData['trend-up']['hover-state']);
						}
						oHoverBar.parse();
					} else if (self.aExtraValues[2] === self.fValue && self.oParent.oData['trend-equal']) {
						oHoverBar.append(self.oParent.oData['trend-equal']);
						oHoverBar.append(self.oParent.oData['hover-state']);
						if (self.oParent.oData['trend-equal']['hover-state']) {
							oHoverBar.append(self.oParent.oData['trend-equal']['hover-state']);
						}
						oHoverBar.parse();
					}

					oHoverBar.iX = self.getNodeData('x');
					oHoverBar.iY = self.getNodeData('y');
					oHoverBar.iWidth = self.getNodeData('w');
					oHoverBar.iHeight = self.getNodeData('h');

					var oPlotArea = self.oGraph.oPlotArea;
					if (oHoverBar.iY < oPlotArea.iY) {
						oHoverBar.iHeight = oHoverBar.iHeight - (oPlotArea.iY - oHoverBar.iY);
						oHoverBar.iY = oPlotArea.iY;
					}
					if (oHoverBar.iY + oHoverBar.iHeight > oPlotArea.iY + oPlotArea.iHeight) {
						oHoverBar.iHeight = oPlotArea.iY + oPlotArea.iHeight - oHoverBar.iY;
					}
					if (oHoverBar.bVisible) {
						oHoverBar.paint();
					}
					break;
			}
		}
	}
});











ZC.ZCGaugePlotNode = ZC.ZCPlotNode.extend({
	setup : function() {
		var self = this;
		
		var oScaleM = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]), oScaleR = self.oGraph.getScaleByName(self.oParent.getScales('v')[0]);
		var iCol = self.iIndex%oScaleM.iCols, iRow = Math.floor(self.iIndex/oScaleM.iCols), fRatio = oScaleR.iAperture/(oScaleR.fMax - oScaleR.fMin);
		
		self.iX = oScaleM.iX + iCol*oScaleM.iHStepSize + oScaleM.iHStepSize/2;
		self.iY = oScaleM.iY + iRow*oScaleM.iVStepSize + oScaleM.iVStepSize/2;
		self.oAttributes['angle'] = oScaleR.iRefAngle - oScaleR.iAperture/2 + fRatio*(self.fValue - oScaleR.fMin);
		if (oScaleR.bMirrored) {
			self.oAttributes['angle'] = oScaleR.iRefAngle + oScaleR.iAperture/2 - fRatio*(self.fValue - oScaleR.fMin);
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
	},
	setupValueBox : function(oValueBox) {
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var self = this;

		
		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);

		var iRadius = ZC._min_(oScale.iHStepSize/2, oScale.iVStepSize/2)*oScale.fSizeFactor,
			iCol = self.iIndex%oScale.iCols,
			iRow = Math.floor(self.iIndex/oScale.iCols),
			iCX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX,
			iCY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY,
			aCoords = ZC.ZCMath._cpoint_(iCX, iCY, iRadius/2 + oValueBox.iOffsetR, self.oAttributes['angle']),
			iX = aCoords[0] - iWidth/2 + self.iOffsetX,
			iY = aCoords[1] - iHeight/2 + self.iOffsetY;
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}
		return [ZC._i_(iX), ZC._i_(iY)];
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.sLineColor,
			'border-color' : this.sLineColor,
			'color' : this.sColor
		};
	},
	paint : function() {
		var self = this, i, aCP;

		self._super();

		self.setup();

		self.bPixelCorrection = false;

		
		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);

		var iRadius = ZC._min_(oScale.iHStepSize/2, oScale.iVStepSize/2)*oScale.fSizeFactor,
			iCol = self.iIndex%oScale.iCols,
			iRow = Math.floor(self.iIndex/oScale.iCols),
			iCX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX,
			iCY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY;

		var iSize = self.iSize;
		if (iSize > 0 && iSize <= 1) {
			iSize *= iRadius;
		}

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self);

		var oArrow = new ZC.ZCShape(self.oParent);
		oArrow.copy(oStyle);
		oArrow.oCanvas = self.oParent.getCanvas('bl', 1);
		oArrow.oCanvasSh = self.oParent.getCanvas('bl', 0);
		
		oArrow.sId = self.sId + '-arrow';

		function _arrow_points_(iAngle) {
			var aPoints = [], aIndicator = self.oParent.aIndicator;
			for (i=aIndicator[2];i<=aIndicator[3];i+=2) {
				aPoints.push(ZC.ZCMath._cpoint_(iCX, iCY, aIndicator[0], iAngle+270-i));
			}
			if (aIndicator[1] === 0) {
				aPoints.push(
					ZC.ZCMath._cpoint_(iCX, iCY, iSize>0?iSize:iRadius*0.9, iAngle)
				);
			} else if (aIndicator[1] > 0) {
				aCP = ZC.ZCMath._cpoint_(iCX, iCY, iSize>0?iSize:iRadius*0.9, iAngle);
				for (i=aIndicator[4];i<=aIndicator[5];i+=2) {
					aPoints.push(ZC.ZCMath._cpoint_(aCP[0], aCP[1], aIndicator[1], iAngle-270-i));
				}
			} else {
				aCP = ZC.ZCMath._cpoint_(iCX, iCY, (iSize>0?iSize:iRadius*0.9) + aIndicator[1], iAngle);
				aPoints.push(
					ZC.ZCMath._cpoint_(aCP[0], aCP[1], ZC._a_(aIndicator[0]/2), iAngle + 90),
					ZC.ZCMath._cpoint_(aCP[0], aCP[1], ZC._a_(aIndicator[1]), iAngle + 90),
					ZC.ZCMath._cpoint_(iCX, iCY, iSize>0?iSize:iRadius*0.9, iAngle),
					ZC.ZCMath._cpoint_(aCP[0], aCP[1], ZC._a_(aIndicator[1]), iAngle + 270),
					ZC.ZCMath._cpoint_(aCP[0], aCP[1], ZC._a_(aIndicator[0]/2), iAngle + 270)
				);
			}
			return aPoints;
		}

		function _fn_end_() {
			var sCoords = oArrow.getAreaCoords();
			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			var sHtmlArea = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + sCoords + '" />';
			self.oParent.oParent.aAreas.push(sHtmlArea);
			
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}

		
		var oScaleR = self.oGraph.getScaleByName(self.oParent.getScales('v')[0]);

		var iZeroAngle = oScaleR.iRefAngle - oScaleR.iAperture/2;

		var aPoints = _arrow_points_(self.oAttributes['angle']);
		self.oAttributes['points'] = aPoints;

		oArrow.sShape = 'poly';
		oArrow.aPoints = aPoints;
		oArrow.parse();
		oArrow.parseRule = function(sRule) {
			return self.parseRule(sRule);
		};
		if (oArrow.applyRules()) {
			oArrow.parse();
		}

		if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
			var oStart = oArrow, oEnd = {}, p;

			var iAE = self.oParent.iAnimationEffect;
			oStart.fAlpha = 0;
			oEnd.alpha = oStyle.fAlpha;

			if (iAE === 2) {
				oStart.iGaugeAngle = iZeroAngle;
				oEnd.iGaugeAngle = self.oAttributes['angle'];
			}

			for (p in self.oParent.oAnimationAttributes) {
				oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
			}

			if (!self.oGraph.oLast) {
				self.oGraph.oLast = {};
			}
			if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
				for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
					var mp = ZC.ZCTween.oAttrMap[ZC._camelcase_(p)];
					if (ZC._n_(mp) === null) {
						mp = p;
					}
					oStart[mp] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
				}
			}
			self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

			var oTween = new ZC.ZCTween(
				oStart,
				oEnd,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					_fn_end_();
				}
			);
			oTween.oNode = self;

			oTween.oStepCallback = function(oObject, oData) {
				if (ZC._n_(oData.iGaugeAngle) !== null) {
					oObject.aPoints = _arrow_points_(oData.iGaugeAngle);
				}
			};

			self.sharedAnimationSetup(oTween);

		} else {
			oArrow.paint();
			_fn_end_();
		}

	},

	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self.sharedLayerSetup({
			layer : sLayer,
			type : 'shape',
			initcb : function() {
				this.copy(self);
				this.sLineColor = self.oParent.aPalette[1];
				this.sBorderColor = self.oParent.aPalette[1];
				this.sBackgroundColor1 = self.oParent.aPalette[3];
				this.sBackgroundColor2 = self.oParent.aPalette[2];
				this.aPoints = self.oAttributes['points'];
				this.oCanvas = this.oCanvasSh = self.oParent.getCanvas('bl', 2);
			}
		});
	}
});










ZC.ZCRangePlotNode = ZC.ZCPlotNode.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.fMinValue = null;
		self.fMaxValue = null;
		self.sSet = 'min';
	},
	parseText : function(sText, oExtraFormat) {
		var self = this;
		self.aTokens = [
			['%node-min-value', self.fMinValue],
			['%node-max-value', self.fMaxValue]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setupValues : function() {
		var self = this, aRange, iAssoc;
		if (self.oData['value'][1] instanceof Array) {
			if (typeof(self.oData['value'][0]) === 'string') {
				iAssoc = ZC._indexof_(self.oGraph.aKeyAssoc, self.oData['value'][0]);
				if (iAssoc !== -1) {
					self.fKeyValue = iAssoc;
				} else {
					self.oGraph.aKeyAssoc.push(self.oData['value'][0]);
					self.fKeyValue = self.oGraph.aKeyAssoc.length-1;
				}
			} else {
				self.fKeyValue = ZC._f_(self.oData['value'][0]);
			}
			if (self.fKeyValue !== null) {
				if (ZC._n_(self.oParent.oKeyPlotAssoc[self.fKeyValue]) === null || ZC._indexof_(self.oParent.oKeyPlotAssoc[self.fKeyValue], self.iIndex) === -1) {
					self.oParent.addKeyPlotAssoc(self.fKeyValue, self.iIndex);
				}
			}
			aRange = self.oData['value'][1];
		} else {
			aRange = self.oData['value'];
		}

		if (typeof(aRange[0]) === 'string') {
			iAssoc = ZC._indexof_(self.oGraph.aValAssoc, aRange[0]);
			if (iAssoc !== -1) {
				self.fMinValue = iAssoc;
			} else {
				self.oGraph.aValAssoc.push(aRange[0]);
				self.fMinValue = self.oGraph.aValAssoc.length-1;
			}
		} else {
			self.fMinValue = ZC._f_(aRange[0]);
		}
		self.aExtraValues.push(self.fMinValue);
		if (typeof(aRange[1]) === 'string') {
			iAssoc = ZC._indexof_(self.oGraph.aValAssoc, aRange[1]);
			if (iAssoc !== -1) {
				self.fMaxValue = iAssoc;
			} else {
				self.oGraph.aValAssoc.push(aRange[1]);
				self.fMaxValue = self.oGraph.aValAssoc.length-1;
			}
		} else {
			self.fMaxValue = ZC._f_(aRange[1]);
		}
		self.sValue = aRange.join(' ');
		self.fValue = self.fMaxValue;
	},
	setup : function() {
		var self = this;
		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;
		var aXYRef_ = [oScaleKey.iMinIndex, oScaleKey.iMaxIndex, oScaleVal.iMinIndex, oScaleVal.iMaxIndex, self.sSet];
		if (ZC._n_(self.aPointsArea) === null) {
			self.aPointsArea = [];
		}
		if (self.aXYRef !== aXYRef_) {
			if (self.fKeyValue !== null) {
				self.iX = oScaleKey.getCoordByValue(self.fKeyValue);
			} else {
				self.iX = oScaleKey.getCoordByIndex(self.iIndex);
			}
			self.iY = oScaleVal.getCoordByValue((self.sSet==='min')?self.fMinValue:self.fMaxValue);
			self.aXYRef = aXYRef_;
		}
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse();
			}
			self.oAttributes['iYMin'] = oScaleVal.getCoordByValue(self.fMinValue);
			self.oAttributes['iYMax'] = oScaleVal.getCoordByValue(self.fMaxValue);
			self.bInit = true;
		}
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.sLineColor,
			'border-color' : this.sLineColor,
			'color' : this.sColor
		};
	},
	paint : function() {
		var self = this, mValue;
		self._super();

		var oScaleKey = self.oParent._oScaleKey;
		var oCtxLine = self.oParent._oCtxLine;

		var aPlotNodes = self.oParent.aPlotNodes;

		self.setup();

		if (ZC._n_(self.oParent.oData[self.sSet + '-line']) !== null) {
			self.append(self.oParent.oData[self.sSet + '-line']);
			self.parse();
		}

		self.bPixelCorrection = false;
		self.oCanvasSh = self.oParent.getCanvas('bl', 1);
		

		var aPoints = [], aPointsArea = [], aMP, aP1, aP2, aP3, aP4, aIP, i, iLen, iXDiff, aSplinePoints, iSplitIndex, sClass, sCoords;

		switch (self.oParent.sAspect) {
			
			default:
				var bPreviousNode = true;
				if (!oScaleKey.bKeyValues && self.iIndex <= oScaleKey.iMinIndex) {
					bPreviousNode = false;
				}
				if (!aPlotNodes[self.iIndex-self.oParent.iStep]) {
					bPreviousNode = false;
				}
				if (bPreviousNode) {
					aPlotNodes[self.iIndex-self.oParent.iStep].sSet = self.sSet;
					aPlotNodes[self.iIndex-self.oParent.iStep].setup();

					aP1 = [self.iX, self.oAttributes['iYMin']];
					aP2 = [aPlotNodes[self.iIndex-self.oParent.iStep].iX, aPlotNodes[self.iIndex-self.oParent.iStep].oAttributes['iYMin']];
					aP3 = [self.iX, self.oAttributes['iYMax']];
					aP4 = [aPlotNodes[self.iIndex-self.oParent.iStep].iX, aPlotNodes[self.iIndex-self.oParent.iStep].oAttributes['iYMax']];
					aIP = ZC.ZCMath._ipoint_(aP1, aP2, aP3, aP4);

					if (ZC._btw_(aIP[0], aPlotNodes[self.iIndex-self.oParent.iStep].iX, self.iX)) {
						aMP = aIP;
					} else {
						aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex-self.oParent.iStep].iX, aPlotNodes[self.iIndex-self.oParent.iStep].iY, aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY);
					}
					aPointsArea.push([ZC._i_(aMP[0]), aMP[1]]);
					aPoints.push([aMP[0], aMP[1]]);
				}
				aPointsArea.push([ZC._i_(self.iX), self.iY]);
				aPoints.push([self.iX, self.iY]);

				var bNextNode = true;
				if (!oScaleKey.bKeyValues && self.iIndex >= oScaleKey.iMaxIndex) {
					bNextNode = false;
				}
				if (!aPlotNodes[self.iIndex+self.oParent.iStep]) {
					bNextNode = false;
				}
				if (bNextNode) {
					aPlotNodes[self.iIndex+self.oParent.iStep].sSet = self.sSet;
					aPlotNodes[self.iIndex+self.oParent.iStep].setup();

					aP1 = [self.iX, self.oAttributes['iYMin']];
					aP2 = [aPlotNodes[self.iIndex+self.oParent.iStep].iX, aPlotNodes[self.iIndex+self.oParent.iStep].oAttributes['iYMin']];
					aP3 = [self.iX, self.oAttributes['iYMax']];
					aP4 = [aPlotNodes[self.iIndex+self.oParent.iStep].iX, aPlotNodes[self.iIndex+self.oParent.iStep].oAttributes['iYMax']];
					aIP = ZC.ZCMath._ipoint_(aP1, aP2, aP3, aP4);

					if (ZC._btw_(aIP[0], aPlotNodes[self.iIndex+self.oParent.iStep].iX, self.iX)) {
						aMP = aIP;
					} else {
						aMP = ZC.ZCMath._mpoint_(aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY, aPlotNodes[self.iIndex+self.oParent.iStep].iX, aPlotNodes[self.iIndex+self.oParent.iStep].iY);
					}
					aPointsArea.push([ZC._i_(aMP[0]), aMP[1]]);
					aPoints.push([aMP[0], aMP[1]]);
				}
				break;
			case 'spline':
				if (typeof(self.oAttributes['intersect.index']) === 'undefined') {
					self.oAttributes['intersect.index'] = -1;
					if (aPlotNodes[self.iIndex+self.oParent.iStep]) {
						var aControlPointsMin = [], aXPoints = [];
						var aControlPointsMax = [];
						for (i=-1;i<3;i++) {
							if (aPlotNodes[self.iIndex+i]) {
								aPlotNodes[self.iIndex+i].setup();
								aControlPointsMin.push(aPlotNodes[self.iIndex+i].oAttributes['iYMin']);
								aControlPointsMax.push(aPlotNodes[self.iIndex+i].oAttributes['iYMax']);
								aXPoints.push(aPlotNodes[self.iIndex+i].iX);
							} else {
								aControlPointsMin.push(self.oAttributes['iYMin']);
								aControlPointsMax.push(self.oAttributes['iYMax']);
								aXPoints.push(self.iX);
							}
						}

						iXDiff = ZC._a_(aXPoints[2]-aXPoints[1]);

						var aSplinePointsMin = ZC.ZCMath._spline_(self.oParent.bMonotone, aControlPointsMin, ZC._i_(iXDiff));
						var aSplinePointsMax = ZC.ZCMath._spline_(self.oParent.bMonotone, aControlPointsMax, ZC._i_(iXDiff));
						
						if (aPlotNodes[self.iIndex+self.oParent.iStep].fMinValue === aPlotNodes[self.iIndex+self.oParent.iStep].fMaxValue) {
							self.oAttributes['intersect.index'] = aSplinePointsMin.length;
						} else {
							var iDiff0 = (aSplinePointsMin[0][1] - aSplinePointsMax[0][1]);
							for (i=1,iLen=aSplinePointsMin.length;i<iLen;i++) {
								if (Math.round(iDiff0*(aSplinePointsMin[i][1] - aSplinePointsMax[i][1]), 2) <= 0) {
									self.oAttributes['intersect.index'] = i+1;
									break;
								}
							}
						}
						self.oAttributes['spline.points.min'] = aSplinePointsMin;
						self.oAttributes['spline.points.max'] = aSplinePointsMax;
						self.oAttributes['spline.xdiff'] = iXDiff;
					}
				}

				iXDiff = self.oAttributes['spline.xdiff'] || oScaleKey.iStepSize;

				if (ZC._n_(self.oParent.oPointsSave) === null) {
					self.oParent.oPointsSave = {};
				}
				if (ZC._n_(self.oParent.oPointsAreaSave) === null) {
					self.oParent.oPointsAreaSave = {};
				}
				var aPointsSave = [];
				var aPointsAreaSave = [];

				if (self.sSet === 'min') {
					if (ZC._n_(mValue=self.oParent.oPointsAreaSave['max']) !== null) {
						for (i=mValue.length-1;i>=0;i--) {
							self.aPointsArea.push(self.oParent.oPointsAreaSave['max'][i]);
						}
					}
					if (ZC._n_(mValue=self.oParent.oPointsAreaSave['min']) !== null) {
						for (i=0,iLen=mValue.length;i<iLen;i++) {
							self.aPointsArea.push(mValue[i]);
						}
					}
				}

				if (ZC._n_(mValue=self.oParent.oPointsSave[self.sSet]) !== null) {
					aPoints = [];
					for (i=0,iLen=mValue.length;i<iLen;i++) {
						aPoints.push(mValue[i]);
					}
				}

				if (aPlotNodes[self.iIndex+self.oParent.iStep]) {
					if (self.sSet === 'min') {
						aSplinePoints = self.oAttributes['spline.points.min'];
					} else if (self.sSet === 'max') {
						aSplinePoints = self.oAttributes['spline.points.max'];
					}
					
					if (self.oAttributes['intersect.index'] === -1) {
						iSplitIndex = ZC._i_(aSplinePoints.length/2);
					} else {
						iSplitIndex = self.oAttributes['intersect.index'];
					}

					for (i=0;i<iSplitIndex;i++) {
						aPoints.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
						aPointsArea.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]]);
					}
					var iBackStepsArea = (self.fAlphaArea === 1)?ZC._min_(2, iSplitIndex):1;
					for (i=iSplitIndex-1,iLen=aSplinePoints.length;i<iLen;i++) {
						aPointsSave.push([self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff, aSplinePoints[i][1]]);
					}
					for (i=iSplitIndex-iBackStepsArea,iLen=aSplinePoints.length;i<iLen;i++) {
						aPointsAreaSave.push([ZC._i_(self.iX + (oScaleKey.bMirrored?-1:1)*aSplinePoints[i][0]*iXDiff), aSplinePoints[i][1]]);
					}
				} else {
					aPoints.push([aPlotNodes[self.iIndex].iX, aPlotNodes[self.iIndex].iY]);
					aPointsSave.push([ZC._i_(aPlotNodes[self.iIndex].iX), aPlotNodes[self.iIndex].iY]);
					aPointsArea.push([ZC._i_(aPlotNodes[self.iIndex].iX), aPlotNodes[self.iIndex].iY]);
					aPointsAreaSave.push([ZC._i_(aPlotNodes[self.iIndex].iX), aPlotNodes[self.iIndex].iY]);
				}
				self.oParent.oPointsSave[self.sSet] = aPointsSave;
				self.oParent.oPointsAreaSave[self.sSet] = aPointsAreaSave;
				break;
		}

		if (self.sSet === 'min') {
			for (i=0,iLen=aPointsArea.length;i<iLen;i++) {
				self.aPointsArea.push(aPointsArea[i]);
			}
		} else {
			for (i=aPointsArea.length-1;i>=0;i--) {
				self.aPointsArea.push(aPointsArea[i]);
			}
		}

		if (self.sSet === 'max') {
			var oArea = new ZC.ZCShape(self.oParent);
			oArea.sId = self.sId + '-area';
			oArea.oCanvas = self.oParent.getCanvas('bl', 0);
			
			oArea.copy(self);
			oArea.iLineWidth = 0;
			oArea.iBorderWidth = 0;
			oArea.iLineSegmentSize = 0;
			oArea.iLineGapSize = 0;
			oArea.parse();
			oArea.aPoints = self.aPointsArea;
			oArea.fAlpha = self.oParent.fAlphaArea;
			var oPlotArea = self.oGraph.oPlotArea;
			oArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
			oArea.paint();

			self.oAttributes['pointsarea'] = [];
			for (i=0,iLen=self.aPointsArea.length;i<iLen;i++) {
				self.oAttributes['pointsarea'].push(self.aPointsArea[i]);
			}
			self.aPointsArea = [];

			if (self.oParent._bCreateAreaMap) {
				sCoords = oArea.getAreaCoords();
				sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
				self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--area' + '" coords="' + sCoords + '" />');
				
			}
		}

		self.oAttributes['points'] = aPoints;

		var oLineStyle = new ZC.ZCStyle(self);
		oLineStyle.copy(self);
		oLineStyle.append(self.oParent.oData[self.sSet + '-line']);
		oLineStyle.parse();

		ZC.ZCLine.setup(oCtxLine, oLineStyle);
		ZC.ZCLine.paint(oCtxLine, oLineStyle, aPoints);

		if (ZC._btw_(self.iX, oScaleKey.iX - 1, oScaleKey.iX + oScaleKey.iWidth + 1) && ZC._btw_(self.iY, oScaleKey.iY - 1, oScaleKey.iY + oScaleKey.iHeight + 1)) {
			var oMarker = new ZC.ZCShape(self.oParent);
			oMarker.sId = self.sId + '-marker';
			oMarker.oCanvas = oMarker.oCanvasSh = self.oParent.getCanvas('fl', 0);
			
			oMarker.iX = self.iX;
			oMarker.iY = self.iY;
			oMarker.sLineColor = self.oParent.aPalette[3];
			oMarker.sBorderColor = self.oParent.aPalette[3];
			oMarker.sBackgroundColor1 = self.oParent.aPalette[2];
			oMarker.sBackgroundColor2 = self.oParent.aPalette[2];
			oMarker.append(self.oParent.oMarker.oData);
			oMarker.parse();
			oMarker.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oMarker.applyRules()) {
				oMarker.parse();
			}
			if (oMarker.bVisible && oMarker.sType !== 'none') {
				if (self.oParent.iMaxNodes > oScaleKey.iMaxIndex - oScaleKey.iMinIndex) {
					oMarker.paint();
				}
				self.oAttributes['marker.type'] = oMarker.sShape;
				sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
				if (oScaleKey.bMirrored) {
					aPoints.reverse();
				}

				if (self.oParent._bCreateAreaMap) {
					sCoords = ZC.ZCMath._htmlarea_(ZC.ZCMath._contour_(self.oAttributes['points']), 4);
					if (sCoords !== '') {
						self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--' + self.sSet + '" coords="' + sCoords + '" />');
						
					} else {
						self.oParent.oParent.aAreas.push(ZC.ZCHtmlUtils._area_start_('circle', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '--' + self.sSet + '" coords="' + ZC._i_(oMarker.iX+ZC.MAPTX) + ',' + ZC._i_(oMarker.iY+ZC.MAPTX) + ',' + ZC._i_(ZC._max_(3, oMarker.iSize)*1.5) + '" />');
						
					}
				}

			}
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}

	},
	showLayer : function() {
		var self = this;
		if (ZC.move) { return; }
		var oScaleKey = self.oParent._oScaleKey;
		if (self.oParent.oHoverMarker && self.oParent.bVisible) {
			var oCtxArea = ZC.ZCHtmlUtils._context_(self.oGraph.sId + '-hover-c', self.oLoader.sOutput);
			var oHoverArea = new ZC.ZCShape(self.oParent);
			oHoverArea.sId = self.sId + '-area-hover';
			oHoverArea.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
			oHoverArea.bAreaCorrection = true;
			oHoverArea.copy(self);
			oHoverArea.append(self.oParent.oHoverState.oData);
			oHoverArea.aPoints = self.oAttributes['pointsarea'];
			oHoverArea.parse();
			oHoverArea.fAlpha = self.oParent.fAlphaArea;
			var oPlotArea = self.oGraph.oPlotArea;
			oHoverArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
			ZC.ZCLine.setup(oCtxArea, oHoverArea);
			oHoverArea.paint();

			var oCtxLine = ZC.ZCHtmlUtils._context_(self.oGraph.sId + '-hover-c', self.oLoader.sOutput);
			var oHoverState = new ZC.ZCStyle(self.oParent);
			oHoverState.sId = self.sId + '-line-hover';
			oHoverState.bPixelCorrection = false;
			oHoverState.sLineColor = self.oParent.aPalette[3];
			oHoverState.append(self.oParent.oHoverState.oData);
			oHoverState.parse();
			oHoverState.parseRule = function(sRule) {
				return self.parseRule(sRule);
			};
			if (oHoverState.applyRules()) {
				oHoverState.parse();
			}
			ZC.ZCLine.setup(oCtxLine, oHoverState);
			ZC.ZCLine.paint(oCtxLine, oHoverState, self.oAttributes['points']);
		}

		if (self.oParent.iMaxNodes > oScaleKey.iMaxIndex - oScaleKey.iMinIndex) {
			if (self.oParent.oHoverMarker && self.oParent.bVisible) {
				self._super();
				var oHoverMarker = new ZC.ZCShape(self.oParent);
				oHoverMarker.sId = self.sId + '-area-hover';
				oHoverMarker.oCanvas = ZC._id_(self.oGraph.sId + '-hover-c');
				oHoverMarker.sShape = self.oAttributes['marker.type'];
				oHoverMarker.iX = self.iX;
				oHoverMarker.iY = self.iY;
				oHoverMarker.sLineColor = self.oParent.aPalette[3];
				oHoverMarker.sBorderColor = self.oParent.aPalette[3];
				oHoverMarker.sBackgroundColor1 = self.oParent.aPalette[2];
				oHoverMarker.sBackgroundColor2 = self.oParent.aPalette[2];
				oHoverMarker.append(self.oParent.oHoverMarker.oData);
				oHoverMarker.parse();
				oHoverMarker.parseRule = function(sRule) {
					return self.parseRule(sRule);
				};
				if (oHoverMarker.applyRules()) {
					oHoverMarker.parse();
				}
				if (oHoverMarker.bVisible && oHoverMarker.sType !== 'none') {
					oHoverMarker.paint();
				}
			}
		}
	}
});










ZC.ZCPie3DPlotNode = ZC.ZCPlotNode.extend({
	oValueBox : null,
	init : function(oParent) {
		this._super(oParent);
	},
	parse : function() {
		this._super();
	},
	parseText : function(sText, oExtraFormat) {
		var self = this;
		var oFormat = self.oParent.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);
		var fNodePercent = self.fValue*100/self.oParent.oParent.aTotals[self.iIndex], sNodePercent = (''+fNodePercent);
		if (ZC._n_(oFormat['decimals']) !== null) {
			sNodePercent = fNodePercent.toFixed(ZC._max_(0, ZC._i_(oFormat['decimals'])));
		}
		self.aTokens = [
			['%node-percent-value', sNodePercent],
			['%npv', sNodePercent],
			['%pie-total-value', self.oParent.oParent.aTotals[self.iIndex]]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	getHookXY : function(oHook) {
		var self = this, mValue;
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var iOffsetR = 0;
		if (ZC._n_(mValue=oHook['offset-r']) !== null) {
			iOffsetR = ZC._f_(ZC._p_(mValue));
		}
		if (iOffsetR < 1) {
			iOffsetR *= self.iSize;
		}

		var oPoint = new ZC.ZCPoint3D(self.oGraph, (self.iPieSlice + 0.5*(self.iSize-self.iPieSlice) + self.iOffsetR + iOffsetR)*ZC._cos_(iAngleMiddle), (self.iPieSlice + 0.5*(self.iSize-self.iPieSlice) + self.iOffsetR + iOffsetR)*ZC._sin_(iAngleMiddle), 0);
		var aPoint = oPoint.aXY;
		return [aPoint[0], aPoint[1], {reference:self,center:true}];
	},
	setup : function() {
		var self = this;
		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);
		var iCol = self.iIndex%oScale.iCols;
		var iRow = Math.floor(self.iIndex/oScale.iCols);
		
		self.iX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX;
		self.iY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY;		
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse();
			}
			self.bInit = true;
		}
	},
	getValueBoxStyle : function(oValueBox) {
		var oStyle = {};
		var sPlacement = 'out';
		if (ZC._n_(oValueBox.oData['placement']) !== null) {
			sPlacement = oValueBox.oData['placement'];
		}
		if (sPlacement === 'out') {
			oStyle['color'] = this.sBackgroundColor1;
		} else {
			oStyle['color'] = this.sColor;
		}
		return oStyle;
	},
	setupValueBox : function(oValueBox) {
		var self = this, mValue;
		var sPlacement = 'out';
		if (ZC._n_(mValue=oValueBox.oData['placement']) !== null) {
			sPlacement = mValue;
		}

		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;
		var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
		var iAngleMiddle_ = iAngleMiddle;
		var iX, iY, oLocation, bCollision, oPoint3D;
		if (sPlacement === 'out') {
			iAngleMiddle = iAngleMiddle_ = self.oParent.oParent.oAngles['n' + self.iIndex][self.oParent.iIndex];
			var _vbpos_ = function(iSize, iAngle) {
				if (iAngle < 0) {
					iAngle = 360 + iAngle;
				}
				iAngle = iAngle%360;
				var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, iSize + self.iOffsetR + oValueBox.iOffsetR + 20, iAngle);
				oPoint3D = new ZC.ZCPoint3D(self.oGraph, aPoint[0] - ZC.ZCDraw3D.iViewX, aPoint[1] - ZC.ZCDraw3D.iViewY, 0);
				aPoint[0] = oPoint3D.aXY[0];
				aPoint[1] = oPoint3D.aXY[1];
				var iX = aPoint[0] + oValueBox.iOffsetX - iWidth/2;
				var iY = aPoint[1] + oValueBox.iOffsetY - iHeight/2;
				if ((iAngle >= 0 && iAngle <= 90) || (iAngle >= 270 && iAngle <= 360)) {
					iX += iWidth/2 + 10;
				} else {
					iX -= iWidth/2 + 10;
				}
				return [iX, iY];
			};
			var aPos = _vbpos_(self.iSize, iAngleMiddle_);
			iX = aPos[0];
			iY = aPos[1];

			
			self.oValueBox = oValueBox;

			var oCC = {
				x : iX, y : iY, width : iWidth, height : iHeight
			};
			
			var iSpreadType = zingchart.DEV.SPREADTYPE;
			bCollision = true;
			var iAngleOffset = 0, iSizeOffset = 0, iAngleSide = -1, iAttemps = 0, iTotalAttempts = 0;
			while (bCollision && iTotalAttempts < 2500) {
				bCollision = false;
				for (var i=0,iLen=self.oParent.oParent.aLocations.length;i<iLen;i++) {
					oLocation = self.oParent.oParent.aLocations[i];
					if (
						ZC.ZCMath._boxoverlap_(oCC, oLocation)
						||
						oCC.x + oValueBox.iWidth > self.oGraph.oPlotArea.iX + self.oGraph.oPlotArea.iWidth
						||
						oCC.x < self.oGraph.oPlotArea.iX
						||
						oCC.y + oValueBox.iHeight > self.oGraph.oPlotArea.iY + self.oGraph.oPlotArea.iHeight
						||
						oCC.y < self.oGraph.oPlotArea.iY
					) {
						bCollision = true;
						if (iSpreadType === 0) {
							iAngleOffset += 0.4;
							iAngleSide *= -1;
						} else if (iSpreadType === 1) {
							iSizeOffset += 1;
						}
						aPos = _vbpos_(self.iSize + iSizeOffset, iAngleMiddle_ + iAngleOffset*iAngleSide);
						oCC.x = aPos[0];
						oCC.y = aPos[1];
						iAttemps++;
						iTotalAttempts++;
						if (iAttemps > 100) {
							iAttemps = 0;
							if (iSpreadType === 0) {
								iAngleOffset = 0;
								iSizeOffset += 4;
							} else if (iSpreadType === 1) {
								iSizeOffset = 0;
								iAngleOffset += 1;
								iAngleSide *= -1;
							}
						}
					}
				}
			}
			iX = oCC.x;
			iY = oCC.y;
			iAngleMiddle = iAngleMiddle_ + iAngleOffset;
			
			
			oLocation = {
				text : self.oParent.sText,
				x : oCC.x,
				y : oCC.y,
				width : iWidth,
				height : iHeight,
				plotindex : self.oParent.iIndex,
				nodeindex : self.iIndex
			};
			self.oParent.oParent.aLocations.push(oLocation);
		} else if (sPlacement === 'in') {
			var aPoint = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iPieSlice + 0.5*(self.iSize-self.iPieSlice) + self.iOffsetR + oValueBox.iOffsetR, iAngleMiddle);
			oPoint3D = new ZC.ZCPoint3D(self.oGraph, aPoint[0] - ZC.ZCDraw3D.iViewX, aPoint[1] - ZC.ZCDraw3D.iViewY, 0);
			aPoint[0] = oPoint3D.aXY[0];
			aPoint[1] = oPoint3D.aXY[1];
			iX = aPoint[0] + oValueBox.iOffsetX - iWidth/2;
			iY = aPoint[1] + oValueBox.iOffsetY - iHeight/2;
		} else if (sPlacement === 'center') {
			oPoint3D = new ZC.ZCPoint3D(self.oGraph, self.iX - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, 0);
			iX = oPoint3D.aXY[0] + oValueBox.iOffsetX - iWidth/2;
			iY = oPoint3D.aXY[1] + oValueBox.iOffsetY - iHeight/2;
		}

		if (bCollision) {
			iX = -9999;
			iY = -9999;
			oValueBox.bVisible = false;
		}

		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}
		if (iX >= -2) {
			iX = ZC._a_(iX);
		}
		if (iY >= -2) {
			iY = ZC._a_(iY);
		}

		return [ZC._i_(iX), ZC._i_(iY), iAngleMiddle];
	},
	paintValueBox : function(bEstimate, iIndex) {
		var self = this, mValue;
		var oValueBox = self._super(bEstimate, iIndex);
		if (bEstimate) {
			return oValueBox;
		}
		if (self.bVisible && oValueBox.bVisible && ZC._n_(oValueBox.sText) !== null && oValueBox.sText !== '') {
			var sPlacement = 'out';
			if (ZC._n_(oValueBox.oData['placement']) !== null) {
				sPlacement = oValueBox.oData['placement'];
			}
			if (sPlacement === 'out') {
				
				var bConnected = true;
				if (ZC._n_(mValue=oValueBox.oData['connected']) !== null) {
					bConnected = ZC._b_(mValue);
				}
				if (bConnected) {
					var oValueBoxConnector = new ZC.ZCShape(self.oParent);
					
					oValueBoxConnector.oCanvas = oValueBoxConnector.oCanvasSh = self.oParent.getCanvas('bl', 0);
					
					oValueBoxConnector.append(self.oParent.oValueBoxConnector.oData);
					oValueBoxConnector.sLineColor = self.sBackgroundColor1;
					oValueBoxConnector.sShape = 'line';
					oValueBoxConnector.aPoints = [];

					var aPositionInfo = oValueBox.oAttributes['positioninfo'];
					var iAngleMiddle = ((self.iPieAngleStart+self.iPieAngleEnd)/2)%360;
					
					

					var iThickness = 0;
					if ((iAngleMiddle >= 0 && iAngleMiddle <= 180)) {
						iThickness = self.oAttributes['thickness']/2;
					}

					var aPoint1 = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize + self.iOffsetR + oValueBox.iOffsetR, iAngleMiddle);
					var oPoint1 = new ZC.ZCPoint3D(self.oGraph, aPoint1[0] - ZC.ZCDraw3D.iViewX, aPoint1[1] - ZC.ZCDraw3D.iViewY, iThickness);
					aPoint1 = oPoint1.aXY;
					aPoint1[0] += self.iOffsetX;
					aPoint1[1] += self.iOffsetY;
					oValueBoxConnector.aPoints.push(aPoint1);

					var aPoint2 = ZC.ZCMath._cpoint_(self.iX, self.iY, self.iSize + self.iOffsetR + oValueBox.iOffsetR + 20, iAngleMiddle);
					var oPoint2 = new ZC.ZCPoint3D(self.oGraph, aPoint2[0] - ZC.ZCDraw3D.iViewX, aPoint2[1] - ZC.ZCDraw3D.iViewY, iThickness);
					aPoint2 = oPoint2.aXY;
					aPoint2[0] += self.iOffsetX;
					aPoint2[1] += self.iOffsetY;

					if (oValueBox.iX >= self.iX) {
						oValueBoxConnector.aPoints.push(
							[aPoint2[0], aPoint2[1], aPositionInfo[0], aPositionInfo[1] + oValueBox.iHeight/2]
						);
					} else {
						oValueBoxConnector.aPoints.push(
							[aPoint2[0], aPoint2[1], aPositionInfo[0] + oValueBox.iWidth + 2, aPositionInfo[1] + oValueBox.iHeight/2]
						);
					}

					oValueBoxConnector.parse();
					oValueBoxConnector.parseRule = function(sRule) {
						return self.parseRule(sRule);
					};
					if (oValueBoxConnector.applyRules()) {
						oValueBoxConnector.parse();
					}
					if (oValueBoxConnector.bVisible) {
						oValueBoxConnector.paint();
					}
				}
			}
		}
	},
	paint : function() {
		var self = this, a, oFaceTop, oFaceOuter, oFaceStart, oFaceEnd, oFaceInner, aPoints, iPieAngleStart, iPieAngleEnd;

		var oEngine3D = self.oGraph.oEngine3D;

		var oScale = self.oGraph.getScaleByName(self.oParent.getScales('k')[0]);

		var iAngleX = self.oGraph.o3DAspect['x-angle'], iAngleY = self.oGraph.o3DAspect['y-angle'];

		self.setup();

		if (self.fValue < 0) {
			return;
		}

		var fModifier = ZC._max_(0.7, ZC._cos_(iAngleX));
		self.iSize = ZC._min_(oScale.iVStepSize/fModifier, oScale.iHStepSize)/2;

		if (ZC._n_(self.oParent.oData['size']) !== null) {
			self.iSize = self.oParent.iSize;
		} else {
			self.iSize = oScale.fSizeFactor*self.iSize;
		}

		if (self.iPieSlice < 1) {
			self.iPieSlice *= self.iSize;
		}
		self.oData['slice'] = self.iPieSlice;
		if (self.iOffsetR < 1) {
			self.iOffsetR *= self.iSize;
		}
		self.oData['offset-r'] = self.iOffsetR;

		var iThickness = self.oParent.iThickness;
		if (iThickness === -1) {
			iThickness = self.iSize/5;
		}

		self.oAttributes['thickness'] = iThickness;

		var iCX = self.iX - ZC.ZCDraw3D.iViewX;
		var iCY = self.iY - ZC.ZCDraw3D.iViewY;

		self.iPieAngleStart = ZC._i_(self.iPieAngleStart);
		self.iPieAngleEnd = ZC._i_(self.iPieAngleEnd);
		var iAngleMiddle = (self.iPieAngleStart+self.iPieAngleEnd)/2;

		if (self.oGraph.oAttributes['pie-sel-' + self.oParent.iIndex + '-' + self.iIndex]) {
			self.iOffsetR += ZC._i_(self.iSize*0.15);
		}

		if (self.iOffsetR > 0) {
			iCX += self.iOffsetR*ZC._cos_(iAngleMiddle);
			iCY += self.iOffsetR*ZC._sin_(iAngleMiddle);
		}

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self);
		var oStyleSide = new ZC.ZCStyle(self);
		oStyleSide.copy(oStyle);
		oStyleSide.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBackgroundColor1));
		oStyleSide.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBackgroundColor2));

		if (self.fValue >= 0 || self.oParent.oParent.aTotals[self.iIndex] === 0) {

			aPoints = [];
			a = self.iPieAngleStart;
			aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), 0]);
			for (a=self.iPieAngleStart;a<=self.iPieAngleEnd;a+=1) {
				aPoints.push([iCX + self.iSize*ZC._cos_(a), iCY + self.iSize*ZC._sin_(a), 0]);
			}
			a = self.iPieAngleEnd;
			aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), 0]);
			for (a=self.iPieAngleEnd;a>=self.iPieAngleStart;a-=1) {
				aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), 0]);
			}
			oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints);
			oFaceTop.sId = self.sId + '-facet1';
			oEngine3D.add(oFaceTop);

			oFaceOuter = null;
			if (
				(self.iPieAngleStart%360 >= 0+iAngleY && self.iPieAngleStart%360 < 180+iAngleY)
				||
				(self.iPieAngleEnd%360 > 0+iAngleY)
			) {
				iPieAngleStart = self.iPieAngleStart;
				iPieAngleEnd = self.iPieAngleEnd;
				iPieAngleStart = ZC._max_(iPieAngleStart, iPieAngleEnd>360?360+5:5);
				iPieAngleEnd = ZC._min_(iPieAngleEnd, iPieAngleEnd>360?360+175:175);
				if (iPieAngleEnd > iPieAngleStart) {
					aPoints = [];
					a = iPieAngleStart;
					aPoints.push([iCX + self.iSize*ZC._cos_(a), iCY + self.iSize*ZC._sin_(a), 0]);
					for (a=iPieAngleStart;a<=iPieAngleEnd;a+=1) {
						aPoints.push([iCX + self.iSize*ZC._cos_(a), iCY + self.iSize*ZC._sin_(a), 0]);
					}
					a = iPieAngleEnd;
					aPoints.push([iCX + self.iSize*ZC._cos_(a), iCY + self.iSize*ZC._sin_(a), iThickness]);
					for (a=iPieAngleEnd;a>=iPieAngleStart;a-=1) {
						aPoints.push([iCX + self.iSize*ZC._cos_(a), iCY + self.iSize*ZC._sin_(a), iThickness]);
					}
					oFaceOuter = ZC.ZCMath3D._create_3d_facet_(oStyleSide, self.oGraph, aPoints);
					if (iAngleMiddle%360 >= 0 && iAngleMiddle%360 <= 180) {
						oFaceOuter.aPriorities = [0.01, 1, 1, 1];
					}
					oFaceOuter.sId = self.sId + '-facet2';
					oEngine3D.add(oFaceOuter);
				}
			}

			oFaceInner = null;
			if (self.iPieSlice > 0+iAngleY && self.iPieAngleEnd > 180+iAngleY) {
				aPoints = [];
				a = self.iPieAngleStart;
				iPieAngleStart = self.iPieAngleStart;
				if (self.iPieAngleStart < 180+iAngleY && self.iPieAngleEnd > 180+iAngleY) {
					a = 180+iAngleY;
					iPieAngleStart = 180+iAngleY;
				}
				aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), 0]);
				for (a=iPieAngleStart;a<=self.iPieAngleEnd;a+=1) {
					aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), 0]);
				}
				a = self.iPieAngleEnd;
				aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), iThickness]);
				for (a=self.iPieAngleEnd;a>=iPieAngleStart;a-=1) {
					aPoints.push([iCX + self.iPieSlice*ZC._cos_(a), iCY + self.iPieSlice*ZC._sin_(a), iThickness]);
				}
				oFaceInner = ZC.ZCMath3D._create_3d_facet_(oStyleSide, self.oGraph, aPoints);
				oFaceInner.sId = self.sId + '-facet3';
				oEngine3D.add(oFaceInner);
			}

			
			var _pts_ = function(sl, sz, a) {
				return [
					[iCX + sl*ZC._cos_(a), iCY + sl*ZC._sin_(a), 0],
					[iCX + sl*ZC._cos_(a), iCY + sl*ZC._sin_(a), iThickness],
					[iCX + sz*ZC._cos_(a), iCY + sz*ZC._sin_(a), iThickness],
					[iCX + sz*ZC._cos_(a), iCY + sz*ZC._sin_(a), 0]
				];
			};

			oFaceStart = ZC.ZCMath3D._create_3d_facet_(oStyleSide, self.oGraph, {points : _pts_(self.iPieSlice, self.iSize, self.iPieAngleStart), mathpoints : _pts_(self.iPieSlice+1, self.iSize+1, self.iPieAngleStart-1)});
			oFaceStart.sId = self.sId + '-facet4';
			oEngine3D.add(oFaceStart);

			oFaceEnd = ZC.ZCMath3D._create_3d_facet_(oStyleSide, self.oGraph, {points : _pts_(self.iPieSlice, self.iSize, self.iPieAngleEnd), mathpoints : _pts_(self.iPieSlice+1, self.iSize+1, self.iPieAngleEnd+1)});
			oFaceEnd.sId = self.sId + '-facet5';
			oEngine3D.add(oFaceEnd);

			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			var sAreaPrefix = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl) + 'class="' + sClass + '" id="' + self.sId;
			var aAreas = self.oParent.oParent.aAreas;

			aAreas.push(sAreaPrefix + '--top' + '" data-z-sort="1" coords="' + oFaceTop.getAreaCoords() + '" />');
			if (oFaceOuter) {
				aAreas.push(sAreaPrefix + '--outer' + '" data-z-sort="1" coords="' + oFaceOuter.getAreaCoords() + '" />');
			}
			if (self.iPieSlice > 0 || self.iOffsetR > 0) {
				if (oFaceInner) {
					aAreas.push(sAreaPrefix + '--inner' + '" data-z-sort="2" coords="' + oFaceInner.getAreaCoords() + '" />');
				}
				aAreas.push(
					sAreaPrefix + '--start' + '" data-z-sort="2" coords="' + oFaceStart.getAreaCoords() + '" />',
					sAreaPrefix + '--end' + '" data-z-sort="2" coords="' + oFaceEnd.getAreaCoords() + '" />'
				);
			}
			
		}

		if (self.oParent.oValueBox) {
			self.paintValueBox();
		}

	},
	_api_node_event_ : function(ev, sType) {
		var self = this;
		self._super(ev, sType);
		if (sType === 'click' && ev.which <= 1 && self.oParent.bDetach) {
			var sId = 'pie-sel-' + self.oParent.iIndex + '-' + self.iIndex;
			self.oGraph.oAttributes[sId] = (typeof(self.oGraph.oAttributes[sId]) === 'undefined')?true:!self.oGraph.oAttributes[sId];
			self.oGraph.repaint();
		}
	}
});










ZC.ZCVBar3DPlotNode = ZC.ZCVBarPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getHookXY : function() {
		var self = this;
		self.paint(true);
		return [self.iX + self.iWidth/2, self.iY, {reference:self, center:true}];
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var aXY = self._super(oValueBox);
		if (aXY.join('/') !== '-1/-1') {
			var oPoint3D = new ZC.ZCPoint3D(self.oGraph, aXY[0] - ZC.ZCDraw3D.iViewX, aXY[1] - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start']);
			return [ZC._i_(oPoint3D.aXY[0]), ZC._i_(oPoint3D.aXY[1])];
		} else {
			return aXY;
		}
	},
	paint : function(bPosOnly) {
		var self = this, mValue;
		self._super();

		if (typeof(bPosOnly) === 'undefined') {
			bPosOnly = false;
		}

		var oEngine3D = self.oGraph.oEngine3D;

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		var fRefValue = oScaleVal.fRefValue;
		var iYRef = oScaleVal.getCoordByValue(fRefValue);
		

		var oInfo = self.oParent.sharedBarDimensions();
		var iStepSize = oInfo.iStepSize,
			iBarIndex = oInfo.iBarIndex,
			iBarsSpaceLeft = oInfo.iBarsSpaceLeft,
			iBarsSpaceRight = oInfo.iBarsSpaceRight,
			iBarSpace = oInfo.iBarSpace,
			iBarWidth = oInfo.iBarWidth,
			iBarsOverlap = oInfo.iBarsOverlap;

		var i, iLen, iStackTotal, iYPrevious, iHeight, iHB, iHT, oStyleFace, oPoint, aPoints, oFaceFront, oFaceTop, oFaceBottom, oFaceLeft, oFaceRight, a;

		if (self.oParent.bStacked) {
			
			iStackTotal = 0;
			var aPlotsIdx = self.oParent.oParent.aPlotGroups[iBarIndex];
			for (i=0;i<aPlotsIdx.length;i++) {
				var oNode = self.oParent.oParent.aPlots[aPlotsIdx[i]].aPlotNodes[self.iIndex];
				if (oNode) {
					iStackTotal += oNode.fValue;
				}
			}
		}

		var fRatioBottom = 1, fRatioTop = 1;
		if (self.oParent.bStacked && iStackTotal > 0) {
			if (self.fAbsoluteValue !== self.fValue) {
				fRatioBottom = (iStackTotal-self.fAbsoluteValue+self.fValue)/iStackTotal;
			}
			fRatioTop = (iStackTotal-self.fAbsoluteValue)/iStackTotal;
		}
		if (oScaleVal.bMirrored) {
			
			var fRatio = fRatioBottom;
			fRatioBottom = fRatioTop;
			fRatioTop = fRatio;
		}

		var iX = self.iX - iStepSize/2 + iBarsSpaceLeft + iBarIndex*(iBarWidth + iBarSpace) - iBarIndex*iBarsOverlap;
		iX = ZC._l_(iX, self.iX - iStepSize/2 + iBarsSpaceLeft, self.iX + iStepSize/2 - iBarsSpaceRight);

		if (self.oParent.iBarWidth > 0) {
			var iBarWidth_ = iBarWidth;
			iBarWidth = self.oParent.iBarWidth;
			if (iBarWidth <= 1) {
				iBarWidth *= iBarWidth_;
			}
			
			iX = iX + (iBarWidth_-iBarWidth)/2;
		}

		var iWidth = iBarWidth;
		var iY = self.iY;

		var iOffsetValue = (ZC._n_(self.oParent.aOffsetValues[self.iIndex]) !== null)?self.oParent.aOffsetValues[self.iIndex]:0;
		if (self.oParent.sStackType === '100%') {
			iY = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
		} else {
			iY = oScaleVal.getCoordByValue(self.fAbsoluteValue+iOffsetValue);
		}
		if (self.oParent.bStacked) {
			if (self.oParent.sStackType === '100%') {
				iYPrevious = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue-self.fValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
			} else {
				iYPrevious = oScaleVal.getCoordByValue(self.fAbsoluteValue-self.fValue+iOffsetValue);
			}
			iHeight = iY - iYPrevious;
			if (self.fValue < 0) {
				iY = iYPrevious;
			}
			if (oScaleVal.bMirrored) {
				if (iHeight > 0) {
					iHeight = ZC._a_(iHeight);
					iY = iYPrevious;
				}				
			} else {
				if (iHeight < 0) {
					iHeight = ZC._a_(iHeight);
					iY = iYPrevious - iHeight;
				}
			}
		} else {
			iYPrevious = oScaleVal.getCoordByValue(oScaleVal.fRefValue+iOffsetValue);
			iHeight = iY - iYPrevious;
			if (iHeight < 0) {
				iHeight = ZC._a_(iHeight);
				iY = iYPrevious - iHeight;
			} else {
				iY = iYPrevious;
			}
		}
		
		if (iBarsSpaceLeft + iBarsSpaceRight === 0) {
			iX -= 0.5;
			iWidth += 1;
		}

		self.iWidth = iWidth;
		self.iHeight = iHeight;
		self.iX = iX;
		self.iY = iY;

		if (oScaleVal.bMirrored) {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iYVal = iY + self.iHeight;
			} else {
				self.iYVal = iY;
			}
		} else {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iYVal = iY;
			} else {
				self.iYVal = iY + self.iHeight;
			}
		}

		if (self.oGraph.oCrosshairX) {
			var sAlignment = 'middle';
			if (self.oGraph.oCrosshairX.oData['marker'] && ZC._n_(mValue=self.oGraph.oCrosshairX.oData['marker']['alignment']) !== null) {
				sAlignment = mValue;
			}
			if (ZC._n_(self.oParent.oData['guide-marker']) !== null && ZC._n_(mValue=self.oParent.oData['guide-marker']['alignment']) !== null) {
				sAlignment = mValue;
			}
			if (sAlignment === 'node') {
				self.oAttributes['iGuideX'] = self.iX + self.iWidth/2;
			}
		}

		if (bPosOnly) {
			return;
		}

		var iCX = iX - ZC.ZCDraw3D.iViewX;
		var iCY = iY - ZC.ZCDraw3D.iViewY;
		var iCZ = 0;
		var iDepth = ZC.ZCDraw3D.iDepth;

		if (self.oGraph.sType === 'mixed3d' || self.oGraph.sType === 'mixed') {
			
			var iPlots = 1;
			for (i=0,iLen=self.oParent.oParent.aPlots.length;i<iLen;i++) {
				if (self.oParent.oParent.aPlots[i].sType !== 'vbar3d') {
					iPlots++;
				}
			}			
			iCZ = (iPlots - 1)*(ZC.ZCDraw3D.iDepth/iPlots);
			iDepth = ZC._i_(0.9*iDepth/iPlots);
		}

		if (ZC._n_(self.oParent.oData['z-start']) !== null) {
			iCZ = ZC._i_(self.oParent.oData['z-start']);
		}
		if (ZC._n_(self.oParent.oData['z-end']) !== null) {
			iDepth = ZC._i_(self.oParent.oData['z-end']) - iCZ;
		}
		self.oParent.oAttributes['z-start'] = iCZ;
		self.oParent.oAttributes['z-mid'] = iCZ + iDepth/2;

		var oStyle;

		if (self.bVisible) {

			oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

			if (self.oParent.oJsRule) {
				self.applyJsRule(oStyle);
			}

			var oStyleSide1 = new ZC.ZCStyle(self);
			oStyleSide1.copy(oStyle);
			oStyleSide1.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide1.sBackgroundColor1));
			oStyleSide1.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide1.sBackgroundColor2));
			oStyleSide1.sBorderColor = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide1.sBorderColor));

			var oStyleSide2 = new ZC.ZCStyle(self);
			oStyleSide2.copy(oStyle);
			oStyleSide2.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide2.sBackgroundColor1), 15);
			oStyleSide2.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide2.sBackgroundColor2), 15);
			oStyleSide2.sBorderColor = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide2.sBorderColor), 15);

			var oStyleFront = new ZC.ZCStyle(self);
			oStyleFront.copy(oStyle);

			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			var sAreaPrefix = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId;

			
			var b3D = self.oGraph.o3DAspect['true3d'];
			var iW2 = self.iWidth/2, iD2 = iDepth/2;
			var fRBW2 = fRatioBottom*iW2, fRTW2 = fRatioTop*iW2, fRTD2 = fRatioTop*iD2, fRBD2 = fRatioBottom*iD2;
			if (oScaleVal.bMirrored && !self.oParent.bStacked) {
				iHB = self.fValue>=0?0:self.iHeight;
				iHT = self.fValue>=0?self.iHeight:0;
			} else {
				iHB = self.fValue>=0?self.iHeight:0;
				iHT = self.fValue>=0?0:self.iHeight;
			}
			var aAreas = self.oParent.oParent.aAreas;

			

			var iRadius = ZC._min_(iD2, iW2);
			var iOffsetAngle = self.oGraph.o3DAspect['y-angle'];
			var iAngle = self.oGraph.o3DAspect['angle'], iAx = ZC._cos_(iAngle)*iD2, iAy = ZC._sin_(iAngle)*iD2;

			if (!b3D) {
				iRadius = ZC._min_(2*iAx, iW2);
			}

			var _priority_ = function(si) {
				var iPriority = 0;
				var pi = self.oParent.iIndex, ni = self.iIndex, p = self.oParent.oParent.aPlots.length, n = self.oParent.aPlotNodes.length;
				var sxy = (self.oParent.bStacked?'s':'') + (oScaleKey.bMirrored?'k':'') + (oScaleVal.bMirrored?'v':'');
				switch (sxy) {
					case '':
						iPriority = 10*pi + ni*10000 + si;
						break;
					case 'v':
						iPriority = 10*pi + ni*10000 + si;
						break;
					case 'sv':
						iPriority = 10*(p-pi) + ni*10000 + si;
						break;
					case 'k':
						iPriority = 10*pi + (n-ni)*10000 + si;
						break;
					case 'skv':
						iPriority = 10*(p-pi) + (n-ni)*10000 + si;
						break;
					case 'kv':
						iPriority = 10*pi + (n-ni)*10000 + si;
						break;
					case 's':
						iPriority = 10*pi + ni*10000 + si;
						break;
					case 'sk':
						iPriority = 10*pi + (n-ni)*10000 + si;
						break;
				}
				return iPriority;
			};

			
			var iAngleMinXT = ZC.MAX, iAngleMaxXT = -ZC.MAX, iMinXT = ZC.MAX, iMaxXT = -ZC.MAX;
			var iAngleMinXB = ZC.MAX, iAngleMaxXB = -ZC.MAX, iMinXB = ZC.MAX, iMaxXB = -ZC.MAX;
			
			if (self.oParent.sAspect === 'cylinder') {
				for (a=0;a<=360;a+=4) {
					oPoint = new ZC.ZCPoint3D(self.oGraph, iCX + ZC._sin_(a)*iRadius + iW2, iCY, iCZ + ZC._cos_(a)*iRadius + iD2);
					if (oPoint.aXY[0] < iMinXT) {
						iMinXT = oPoint.aXY[0];
						iAngleMinXT = a;
					}
					if (oPoint.aXY[0] > iMaxXT) {
						iMaxXT = oPoint.aXY[0];
						iAngleMaxXT = a;
					}

					oPoint = new ZC.ZCPoint3D(self.oGraph, iCX + ZC._sin_(a)*iRadius + iW2, iCY + self.iHeight, iCZ + ZC._cos_(a)*iRadius + iD2);
					if (oPoint.aXY[0] < iMinXB) {
						iMinXB = oPoint.aXY[0];
						iAngleMinXB = a;
					}
					if (oPoint.aXY[0] > iMaxXB) {
						iMaxXB = oPoint.aXY[0];
						iAngleMaxXB = a;
					}
				}
			}

			var oFacets = self.oParent.oData['facets'] || {};

			switch (self.oParent.sAspect) {
				
				default:
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX+0.1, iCX + self.iWidth-0.1, iCY + self.iHeight-0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ + iDepth-0.1, 'x');
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX+0.1, iCX + self.iWidth-0.1, iCY + self.iHeight-0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ + iDepth-0.1, 'x');
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_(1);
					oEngine3D.add(oFaceBottom);

					if (oFacets['top']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['top']);
						oStyleFace.parse();
						oFaceTop = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX+0.1, iCX + self.iWidth-0.1, iCY+0.1, iCY+0.1, iCZ+0.1, iCZ + iDepth-0.1, 'x');
					} else {
						oFaceTop = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX+0.1, iCX + self.iWidth-0.1, iCY+0.1, iCY+0.1, iCZ+0.1, iCZ + iDepth-0.1, 'x');
					}
					oFaceTop.sId = self.sId + '-facet2';
					oFaceTop.iPriority = _priority_(3);
					oEngine3D.add(oFaceTop);

					if (oFacets['left']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['left']);
						oStyleFace.parse();
						oFaceLeft = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX+0.1, iCX+0.1, iCY+0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ + iDepth-0.1, 'z');
					} else {
						oFaceLeft = ZC.ZCMath3D._create_3d_face_(oStyleSide2, self.oGraph, iCX+0.1, iCX+0.1, iCY+0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ + iDepth-0.1, 'z');
					}
					oFaceLeft.sId = self.sId + '-facet3';
					oFaceLeft.iPriority = _priority_(2);
					oEngine3D.add(oFaceLeft);

					if (oFacets['right']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['right']);
						oStyleFace.parse();
						oFaceRight = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX + self.iWidth-0.1, iCX + self.iWidth-0.1, iCY+0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ + iDepth-0.1, 'z');
					} else {
						oFaceRight = ZC.ZCMath3D._create_3d_face_(oStyleSide2, self.oGraph, iCX + self.iWidth-0.1, iCX + self.iWidth-0.1, iCY+0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ + iDepth-0.1, 'z');
					}
					oFaceRight.sId = self.sId + '-facet4';
					oFaceRight.iPriority = _priority_(4);
					oEngine3D.add(oFaceRight);

					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleFront);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX+0.1, iCX + self.iWidth-0.1, iCY+0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ+0.1, 'y');
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_face_(oStyleFront, self.oGraph, iCX+0.1, iCX + self.iWidth-0.1, iCY+0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ+0.1, 'y');
					}
					oFaceFront.sId = self.sId + '-facet5';
					oFaceFront.iPriority = _priority_(5);
					oEngine3D.add(oFaceFront);

					if (self.oParent._bCreateAreaMap) {
						if (fRatioTop === 1) {
							aAreas.push(sAreaPrefix + '--top' + '" coords="' + oFaceTop.getAreaCoords() + '" />');
						}
						aAreas.push(
							sAreaPrefix + '--left' + '" coords="' + oFaceLeft.getAreaCoords() + '" />',
							sAreaPrefix + '--right' + '" coords="' + oFaceRight.getAreaCoords() + '" />',
							sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />'
						);
						
					}
					break;

				case 'pyramid':
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX + iW2 - fRBW2, iCX + iW2 + fRBW2, iCY + iHB, iCY + iHB, iCZ + iD2 - fRBD2, iCZ + iD2 + fRBD2, 'x');
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX + iW2 - fRBW2, iCX + iW2 + fRBW2, iCY + iHB, iCY + iHB, iCZ + iD2 - fRBD2, iCZ + iD2 + fRBD2, 'x');
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_((oScaleVal.bMirrored && !self.oParent.bStacked)?6:1);
					oEngine3D.add(oFaceBottom);

					aPoints = [
						[iCX + iW2 - fRBW2, iCY + iHB, iCZ + iD2 - fRBD2],
						[iCX + iW2 + fRBW2, iCY + iHB, iCZ + iD2 - fRBD2]
					];
					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints.push(
							[iCX + iW2 + fRTW2, iCY + iHT, iCZ + iD2 - fRTD2],
							[iCX + iW2 - fRTW2, iCY + iHT, iCZ + iD2 - fRTD2]
						);
					} else {
						aPoints.push([iCX + iW2, iCY + iHT, iCZ + iD2]);
					}

					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyle);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints);
					}
					oFaceFront.sId = self.sId + '-facet2';
					oFaceFront.iPriority = _priority_(3);
					oEngine3D.add(oFaceFront);

					aPoints = [
						[iCX + iW2 - fRBW2, iCY + iHB, iCZ + iD2 - fRBD2],
						[iCX + iW2 - fRBW2, iCY + iHB, iCZ + iD2 + fRBD2]
					];
					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints.push(
							[iCX + iW2 - fRTW2, iCY + iHT, iCZ + iD2 + fRTD2],
							[iCX + iW2 - fRTW2, iCY + iHT, iCZ + iD2 - fRTD2]
						);
					} else {
						aPoints.push([iCX + iW2, iCY + iHT, iCZ + iD2]);
					}

					if (oFacets['left']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['left']);
						oStyleFace.parse();
						oFaceLeft = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
					} else {
						oFaceLeft = ZC.ZCMath3D._create_3d_facet_(oStyleSide2, self.oGraph, aPoints);
					}
					oFaceLeft.sId = self.sId + '-facet3';
					oFaceLeft.iPriority = _priority_(2);
					oEngine3D.add(oFaceLeft);

					aPoints = [
						[iCX + iW2 + fRBW2, iCY + iHB, iCZ + iD2 - fRBD2],
						[iCX + iW2 + fRBW2, iCY + iHB, iCZ + iD2 + fRBD2]
					];
					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints.push(
							[iCX + iW2 + fRTW2, iCY + iHT, iCZ + iD2 + fRTD2],
							[iCX + iW2 + fRTW2, iCY + iHT, iCZ + iD2 - fRTD2]
						);
					} else {
						aPoints.push([iCX + iW2, iCY + iHT, iCZ + iD2]);
					}

					if (oFacets['right']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['right']);
						oStyleFace.parse();
						oFaceRight = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
					} else {
						oFaceRight = ZC.ZCMath3D._create_3d_facet_(oStyleSide2, self.oGraph, aPoints);
					}
					oFaceRight.sId = self.sId + '-facet4';
					oFaceRight.iPriority = _priority_(4);
					oEngine3D.add(oFaceRight);

					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints = [
							[iCX + iW2 - fRTW2, iCY + iHT, iCZ + iD2 - fRTD2],
							[iCX + iW2 - fRTW2, iCY + iHT, iCZ + iD2 + fRTD2],
							[iCX + iW2 + fRTW2, iCY + iHT, iCZ + iD2 + fRTD2],
							[iCX + iW2 + fRTW2, iCY + iHT, iCZ + iD2 - fRTD2]
						];

						if (oFacets['top']) {
							oStyleFace = new ZC.ZCStyle(self);
							oStyleFace.copy(oStyleSide1);
							oStyleFace.append(oFacets['top']);
							oStyleFace.parse();
							oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
						} else {
							oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints);
						}
						oFaceTop.sId = self.sId + '-facet5';
						oFaceTop.iPriority = _priority_(5);
						oEngine3D.add(oFaceTop);
					}

					if (self.oParent._bCreateAreaMap) {
						aAreas.push(
							sAreaPrefix + '--left' + '" coords="' + oFaceLeft.getAreaCoords() + '" />',
							sAreaPrefix + '--right' + '" coords="' + oFaceRight.getAreaCoords() + '" />',
							sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />'
						);
						
					}
					break;

				case 'cylinder':
					aPoints = [];
					if (b3D) {
						for (a=0;a<=360;a+=5) {
							aPoints.push([iCX + ZC._sin_(a)*iRadius + iW2, iCY + self.iHeight, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
					} else {
						for (a=0;a<=360;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*iRadius + iW2 + iAx, iY + self.iHeight + ZC._sin_(a)*(iRadius/2) - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_(1);
					oEngine3D.add(oFaceBottom);

					aPoints = [];
					if (b3D) {
						for (a=0;a<=360;a+=5) {
							aPoints.push([iCX + ZC._sin_(a)*iRadius + iW2, iCY, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
					} else {
						for (a=0;a<=360;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*iRadius + iW2 + iAx, iY + ZC._sin_(a)*(iRadius/2) - iAy];
							aPoints.push(oPoint);
						}
					}

					if (oFacets['top']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['top']);
						oStyleFace.parse();
						oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
					}
					oFaceTop.sId = self.sId + '-facet2';
					oFaceTop.iPriority = _priority_(3);
					oEngine3D.add(oFaceTop);

					aPoints = [];
					if (b3D) {
						for (a=ZC._min_(iAngleMinXT,iAngleMaxXT);a<=ZC._max_(iAngleMinXT,iAngleMaxXT);a+=1) {
							aPoints.push([iCX + ZC._sin_(a)*iRadius + iW2, iCY, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
						aPoints.push([iCX + ZC._sin_(a)*iRadius + iW2, iCY + self.iHeight, iCZ + ZC._cos_(a)*iRadius + iD2]);
						for (a=ZC._max_(iAngleMinXB,iAngleMaxXB);a>=ZC._min_(iAngleMinXB,iAngleMaxXB);a-=1) {
							aPoints.push([iCX + ZC._sin_(a)*iRadius + iW2, iCY + self.iHeight, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
					} else {
						for (a=0;a<=180;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*iRadius + iW2 + iAx, iY + self.iHeight + ZC._sin_(a)*(iRadius/2) - iAy];
							aPoints.push(oPoint);
						}
						for (a=180;a>=0;a-=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*iRadius + iW2 + iAx, iY + ZC._sin_(a)*(iRadius/2) - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyle);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints, !b3D);
					}
					oFaceFront.sId = self.sId + '-facet3';
					oFaceFront.iPriority = _priority_(2);
					oEngine3D.add(oFaceFront);

					if (self.oParent._bCreateAreaMap) {
						aAreas.push(
							sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />',
							sAreaPrefix + '--top' + '" coords="' + oFaceTop.getAreaCoords() + '" />'
						);
						
					}
					break;
				case 'cone':
					aPoints = [];
					if (b3D) {
						for (a=0;a<=360;a+=5) {
							aPoints.push([iCX + ZC._sin_(a)*iRadius*fRatioBottom + iW2, iCY + iHB, iCZ + ZC._cos_(a)*iRadius*fRatioBottom + iD2]);
						}
					} else {
						for (a=0;a<=360;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*iRadius*fRatioBottom + iW2 + iAx, iY + iHB + ZC._sin_(a)*(iRadius/2)*fRatioBottom - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_(1);
					oEngine3D.add(oFaceBottom);

					aPoints = [];
					if (b3D) {
						for (a=90+iOffsetAngle;a<=270+iOffsetAngle;a+=5) {
							aPoints.push([iCX + ZC._sin_(a)*iRadius*fRatioBottom + iW2, iCY + iHB, iCZ + ZC._cos_(a)*iRadius*fRatioBottom + iD2]);
						}
						if (self.oParent.bStacked && fRatioTop !== 0) {
							for (a=270+iOffsetAngle;a>=90+iOffsetAngle;a-=5) {
								aPoints.push([iCX + ZC._sin_(a)*iRadius*fRatioTop + iW2, iCY + iHT, iCZ + ZC._cos_(a)*iRadius*fRatioTop + iD2]);
							}
						} else {
							aPoints.push([iCX + iW2, iCY + iHT, iCZ + iD2]);
						}
					} else {
						for (a=0;a<=180;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*iRadius*fRatioBottom + iW2 + iAx, iY + iHB + ZC._sin_(a)*(iRadius/2)*fRatioBottom - iAy];
							aPoints.push(oPoint);
						}
						if (self.oParent.bStacked && fRatioTop !== 0) {
							for (a=180;a>=0;a-=5) {
								oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
								oPoint.aXY = [iX + ZC._cos_(a)*iRadius*fRatioTop + iW2 + iAx, iY + iHT + ZC._sin_(a)*(iRadius/2)*fRatioTop - iAy];
								aPoints.push(oPoint);
							}
						} else {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + iW2 + iAx, iY + iHT - iAy];
							aPoints.push(oPoint);
						}
					}

					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyle);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints, !b3D);
					}
					oFaceFront.sId = self.sId + '-facet2';
					oFaceFront.iPriority = _priority_(2);
					oEngine3D.add(oFaceFront);

					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints = [];
						if (b3D) {
							for (a=0;a<=360;a+=5) {
								aPoints.push([iCX + ZC._sin_(a)*iRadius*fRatioTop + iW2, iCY + iHT, iCZ + ZC._cos_(a)*iRadius*fRatioTop + iD2]);
							}
						} else {
							for (a=0;a<=360;a+=5) {
								oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
								oPoint.aXY = [iX + ZC._cos_(a)*iRadius*fRatioTop + iW2 + iAx, iY + iHT + ZC._sin_(a)*(iRadius/2)*fRatioTop - iAy];
								aPoints.push(oPoint);
							}
						}
						if (oFacets['top']) {
							oStyleFace = new ZC.ZCStyle(self);
							oStyleFace.copy(oStyleSide1);
							oStyleFace.append(oFacets['top']);
							oStyleFace.parse();
							oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
						} else {
							oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
						}
						oFaceTop.sId = self.sId + '-facet3';
						oEngine3D.add(oFaceTop);
						oFaceTop.iPriority = _priority_(3);
					}

					if (self.oParent._bCreateAreaMap) {
						aAreas.push(sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />');
						
					}
					break;
			}

			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}

		}

		self.paintPreview(oStyle);

	},
	showLayer : function() {
	}
});











ZC.ZCHBar3DPlotNode = ZC.ZCHBarPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getHookXY : function() {
		var self = this;
		self.paint(true);
		return [self.iX, self.iY + self.iHeight/2, {reference:self, center:true}];
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var aXY = self._super(oValueBox);
		if (aXY.join('/') !== '-1/-1') {
			var oPoint3D = new ZC.ZCPoint3D(self.oGraph, aXY[0] - ZC.ZCDraw3D.iViewX, aXY[1] - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start']);
			return [ZC._i_(oPoint3D.aXY[0]), ZC._i_(oPoint3D.aXY[1])];
		} else {
			return aXY;
		}
	},
	paint : function(bPosOnly) {
		var self = this;
		self._super();

		if (typeof(bPosOnly) === 'undefined') {
			bPosOnly = false;
		}

		var oEngine3D = self.oGraph.oEngine3D;

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		self.setup();

		var fRefValue = oScaleVal.fRefValue;
		var iXRef = oScaleVal.getCoordByValue(fRefValue);
		

		var oInfo = self.oParent.sharedBarDimensions();
		var iStepSize = oInfo.iStepSize,
			iBarIndex = oInfo.iBarIndex,
			iBarsSpaceLeft = oInfo.iBarsSpaceLeft,
			iBarsSpaceRight = oInfo.iBarsSpaceRight,
			iBarSpace = oInfo.iBarSpace,
			iBarWidth = oInfo.iBarWidth,
			iBarsOverlap = oInfo.iBarsOverlap;

		var iStackTotal, iXPrevious, iWidth, iWT, iWB, oStyleFace, oFaceLeft, oFaceBottom, oFaceTop, oFaceFront, oFaceRight, a, oPoint, aPoints;

		if (self.oParent.bStacked) {
			
			iStackTotal = 0;
			var aPlotsIdx = self.oParent.oParent.aPlotGroups[iBarIndex];
			for (var i=0;i<aPlotsIdx.length;i++) {
				var oNode = self.oParent.oParent.aPlots[aPlotsIdx[i]].aPlotNodes[self.iIndex];
				if (oNode) {
					iStackTotal += oNode.fValue;
				}
			}
		}

		var fRatioBottom = 1, fRatioTop = 1;
		if (self.oParent.bStacked) {
			if (self.fAbsoluteValue !== self.fValue) {
				fRatioBottom = (iStackTotal-self.fAbsoluteValue+self.fValue)/iStackTotal;
			}
			fRatioTop = (iStackTotal-self.fAbsoluteValue)/iStackTotal;
		}
		if (oScaleVal.bMirrored) {
			
			var fRatio = fRatioBottom;
			fRatioBottom = fRatioTop;
			fRatioTop = fRatio;
		}

		var iY = self.iY - iStepSize/2 + iBarsSpaceLeft + iBarIndex*(iBarWidth + iBarSpace) - iBarIndex*iBarsOverlap;
		iY = ZC._l_(iY, self.iY - iStepSize/2 + iBarsSpaceLeft, self.iY + iStepSize/2 - iBarsSpaceRight);

		if (self.oParent.iBarWidth > 0) {
			var iBarWidth_ = iBarWidth;
			iBarWidth = self.oParent.iBarWidth;
			if (iBarWidth <= 1) {
				iBarWidth *= iBarWidth_;
			}
			
			iY = iY + (iBarWidth_-iBarWidth)/2;
		}

		var iHeight = iBarWidth;
		var iX = self.iX;

		var iOffsetValue = (ZC._n_(self.oParent.aOffsetValues[self.iIndex]) !== null)?self.oParent.aOffsetValues[self.iIndex]:0;
		if (self.oParent.sStackType === '100%') {
			iX = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
		} else {
			iX = oScaleVal.getCoordByValue(self.fAbsoluteValue+iOffsetValue);
		}
		if (self.oParent.bStacked) {
			if (self.oParent.sStackType === '100%') {
				iXPrevious = oScaleVal.getCoordByValue(100*(self.fAbsoluteValue-self.fValue+iOffsetValue)/self.oParent.oParent.oPlotSetInfo[self.iIndex]['%total-'+self.oParent.iStack]);
			} else {
				iXPrevious = oScaleVal.getCoordByValue(self.fAbsoluteValue-self.fValue+iOffsetValue);
			}
			iWidth = iX - iXPrevious;
			if (self.fValue > 0) {
				iX = iXPrevious;
			} else {
				iWidth = ZC._a_(iWidth);
			}
			if (oScaleVal.bMirrored) {
				if (iWidth > 0) {
					iWidth = ZC._a_(iWidth);
					iX = iXPrevious;
				} else {
					iWidth = ZC._a_(iWidth);
					iX = iX - iWidth;
				}
			} else {
				if (iWidth < 0) {
					iWidth = ZC._a_(iWidth);
					iX = iXPrevious - iWidth;
				}
			}
		} else {
			iXPrevious = oScaleVal.getCoordByValue(oScaleVal.fRefValue+iOffsetValue);
			iWidth = iX - iXPrevious;
			if (iWidth < 0) {
				iWidth = ZC._a_(iWidth);
				iX = iXPrevious - iWidth;
			} else {
				iX = iXPrevious;
			}
		}	

		if (iBarsSpaceLeft + iBarsSpaceRight === 0) {
			iY -= 0.5;
			iHeight += 1;
		}

		self.iWidth = iWidth;
		self.iHeight = iHeight;
		self.iX = iX;
		self.iY = iY;

		if (oScaleVal.bMirrored) {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iXVal = iX;
			} else {
				self.iXVal = iX + self.iWidth;
			}
		} else {
			if (self.fValue >= oScaleVal.fRefValue) {
				self.iXVal = iX + self.iWidth;
			} else {
				self.iXVal = iX;
			}
		}

		if (bPosOnly) {
			return;
		}

		var iCX = iX + iWidth - ZC.ZCDraw3D.iViewX;
		var iCY = iY - ZC.ZCDraw3D.iViewY;
		var iCZ = 0;		
		var iDepth = ZC.ZCDraw3D.iDepth;

		if (ZC._n_(self.oParent.oData['z-start']) !== null) {
			iCZ = ZC._i_(self.oParent.oData['z-start']);
		}
		if (ZC._n_(self.oParent.oData['z-end']) !== null) {
			iDepth = ZC._i_(self.oParent.oData['z-end']) - iCZ;
		}
		self.oParent.oAttributes['z-start'] = iCZ;
		self.oParent.oAttributes['z-mid'] = iCZ + iDepth/2;

		if (self.bVisible) {

			var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

			if (self.oParent.oJsRule) {
				self.applyJsRule(oStyle);
			}
			
			var oStyleSide1 = new ZC.ZCStyle(self);
			oStyleSide1.copy(oStyle);
			oStyleSide1.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide1.sBackgroundColor1));
			oStyleSide1.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide1.sBackgroundColor2));
			oStyleSide1.sBorderColor = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide1.sBorderColor));

			var oStyleSide2 = new ZC.ZCStyle(self);
			oStyleSide2.copy(oStyle);
			oStyleSide2.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide2.sBackgroundColor1), 15);
			oStyleSide2.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide2.sBackgroundColor2), 15);
			oStyleSide2.sBorderColor = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide2.sBorderColor), 15);

			var oStyleFront = new ZC.ZCStyle(self);
			oStyleFront.copy(oStyle);

			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			var sAreaPrefix = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId;

			
			var b3D = self.oGraph.o3DAspect['true3d'];
			var iH2 = self.iHeight/2, iD2 = iDepth/2;
			var fRBH2 = fRatioBottom*iH2, fRTH2 = fRatioTop*iH2, fRTD2 = fRatioTop*iD2, fRBD2 = fRatioBottom*iD2;
			if (oScaleVal.bMirrored && !self.oParent.bStacked) {
				iWB = self.fValue>=0?0:self.iWidth;
				iWT = self.fValue>=0?self.iWidth:0;
			} else {
				iWB = self.fValue>=0?self.iWidth:0;
				iWT = self.fValue>=0?0:self.iWidth;
			}
			var aAreas = self.oParent.oParent.aAreas;

			var iRadius = ZC._min_(iD2, iH2);
			var iOffsetAngle = self.oGraph.o3DAspect['x-angle'];
			var iAngle = self.oGraph.o3DAspect['angle'], iAx = ZC._cos_(iAngle)*iD2, iAy = ZC._sin_(iAngle)*iD2;

			if (!b3D) {
				iRadius = ZC._min_(2*iAy, iH2);
			}

			var _priority_ = function(si) {
				var iPriority = -1;
				var pi = self.oParent.iIndex, ni = self.iIndex, p = self.oParent.oParent.aPlots.length, n = self.oParent.aPlotNodes.length;
				var sxy = (self.oParent.bStacked?'s':'') + (oScaleKey.bMirrored?'k':'') + (oScaleVal.bMirrored?'v':'');
				switch (sxy) {
					case '':
					case 'v':
					case 'sv':
						iPriority = 10*(p-pi) + ni*10000 + si;
						break;
					case 'k':
					case 'skv':
					case 'kv':
						iPriority = 10*(p-pi) + (n-ni)*10000 + si;
						break;
					case 's':
						iPriority = 10*pi + ni*10000 + si;
						break;
					case 'sk':
						iPriority = 10*pi + (n-ni)*10000 + si;
						break;
				}
				return ZC._i_(iPriority);
			};

			var oFacets = self.oParent.oData['facets'] || {};

			switch (self.oParent.sAspect) {
				
				default:
					if (oFacets['left']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['left']);
						oStyleFace.parse();
						oFaceLeft = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX - self.iWidth+0.1, iCX-0.1, iCY+0.1, iCY+0.1, iCZ+0.1, iCZ+iDepth-0.1, 'x');
					} else {
						oFaceLeft = ZC.ZCMath3D._create_3d_face_(oStyleSide2, self.oGraph, iCX - self.iWidth+0.1, iCX-0.1, iCY+0.1, iCY+0.1, iCZ+0.1, iCZ+iDepth-0.1, 'x');
					}
					oFaceLeft.sId = self.sId + '-facet1';
					oFaceLeft.iPriority = _priority_(5);
					oEngine3D.add(oFaceLeft);

					if (oFacets['right']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['right']);
						oStyleFace.parse();
						oFaceRight = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX - self.iWidth+0.1, iCX-0.1, iCY + self.iHeight-0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ+iDepth-0.1, 'x');
					} else {
						oFaceRight = ZC.ZCMath3D._create_3d_face_(oStyleSide2, self.oGraph, iCX - self.iWidth+0.1, iCX-0.1, iCY + self.iHeight-0.1, iCY + self.iHeight-0.1, iCZ+0.1, iCZ+iDepth-0.1, 'x');
					}
					oFaceRight.sId = self.sId + '-facet2';
					oFaceRight.iPriority = _priority_(1);
					oEngine3D.add(oFaceRight);

					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX - self.iWidth+0.1, iCX - self.iWidth+0.1, iCY + self.iHeight-0.1, iCY+0.1, iCZ+0.1, iCZ+iDepth-0.1, 'z');
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX - self.iWidth+0.1, iCX - self.iWidth+0.1, iCY + self.iHeight-0.1, iCY+0.1, iCZ+0.1, iCZ+iDepth-0.1, 'z');
					}
					oFaceBottom.sId = self.sId + '-facet3';
					oFaceBottom.iPriority = _priority_(2);
					oEngine3D.add(oFaceBottom);

					if (oFacets['top']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['top']);
						oStyleFace.parse();
						oFaceTop = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX-0.1, iCX-0.1, iCY + self.iHeight-0.1, iCY+0.1, iCZ+0.1, iCZ+iDepth-0.1, 'z');
					} else {
						oFaceTop = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX-0.1, iCX-0.1, iCY + self.iHeight-0.1, iCY+0.1, iCZ+0.1, iCZ+iDepth-0.1, 'z');
					}
					oFaceTop.sId = self.sId + '-facet4';
					oFaceTop.iPriority = _priority_(3);
					oEngine3D.add(oFaceTop);

					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleFront);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX - self.iWidth+0.1, iCX-0.1, iCY + self.iHeight-0.1, iCY+0.1, iCZ+0.1, iCZ+0.1, 'y');
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_face_(oStyleFront, self.oGraph, iCX - self.iWidth+0.1, iCX-0.1, iCY + self.iHeight-0.1, iCY+0.1, iCZ+0.1, iCZ+0.1, 'y');
					}
					oFaceFront.sId = self.sId + '-facet5';
					oFaceFront.iPriority = _priority_(4);
					oEngine3D.add(oFaceFront);

					if (self.oParent._bCreateAreaMap) {
						if (!self.oParent.bStacked) {
							aAreas.push(sAreaPrefix + '--top' + '" coords="' + oFaceTop.getAreaCoords() + '" />');
						}
						aAreas.push(
							sAreaPrefix + '--left' + '" coords="' + oFaceLeft.getAreaCoords() + '" />',
							sAreaPrefix + '--right' + '" coords="' + oFaceRight.getAreaCoords() + '" />',
							sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />'
						);
						
					}
					break;

				case 'pyramid':
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX - iWB, iCX - iWB, iCY + iH2 - fRBH2, iCY + iH2 + fRBH2, iD2 - fRBD2, iD2 + fRBD2, 'z');
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX - iWB, iCX - iWB, iCY + iH2 - fRBH2, iCY + iH2 + fRBH2, iD2 - fRBD2, iD2 + fRBD2, 'z');
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_((oScaleVal.bMirrored && !self.oParent.bStacked)?6:1);
					oEngine3D.add(oFaceBottom);

					aPoints = [
						[iCX - iWB, iCY + iH2 - fRBH2, iD2 - fRBD2],
						[iCX - iWB, iCY + iH2 + fRBH2, iD2 - fRBD2]
					];
					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints.push(
							[iCX - iWT, iCY + iH2 + fRTH2, iD2 - fRTD2],
							[iCX - iWT, iCY + iH2 - fRTH2, iD2 - fRTD2]
						);
					} else {
						aPoints.push([iCX - iWT, iCY + iH2, iDepth/2]);
					}
					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyle);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints);
					}
					oFaceFront.sId = self.sId + '-facet2';
					oFaceFront.iPriority = _priority_(3);
					oEngine3D.add(oFaceFront);

					aPoints = [
						[iCX - iWB, iCY + iH2 - fRBH2, iD2 - fRBD2],
						[iCX - iWB, iCY + iH2 - fRBH2, iD2 + fRBD2]
					];
					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints.push(
							[iCX - iWT, iCY + iH2 - fRTH2, iD2 + fRTD2],
							[iCX - iWT, iCY + iH2 - fRTH2, iD2 - fRTD2]
						);
					} else {
						aPoints.push([iCX - iWT, iCY + self.iHeight/2, iDepth/2]);
					}
					if (oFacets['left']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['left']);
						oStyleFace.parse();
						oFaceLeft = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
					} else {
						oFaceLeft = ZC.ZCMath3D._create_3d_facet_(oStyleSide2, self.oGraph, aPoints);
					}
					oFaceLeft.sId = self.sId + '-facet3';
					oFaceLeft.iPriority = _priority_(4);
					oEngine3D.add(oFaceLeft);

					aPoints = [
						[iCX - iWB, iCY + iH2 + fRBH2, iD2 - fRBD2],
						[iCX - iWB, iCY + iH2 + fRBH2, iD2 + fRBD2]
					];
					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints.push(
							[iCX - iWT, iCY + iH2 + fRTH2, iD2 + fRTD2],
							[iCX - iWT, iCY + iH2 + fRTH2, iD2 - fRTD2]
						);
					} else {
						aPoints.push([iCX - iWT, iCY + iH2, iDepth/2]);
					}
					if (oFacets['right']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide2);
						oStyleFace.append(oFacets['right']);
						oStyleFace.parse();
						oFaceRight = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints);
					} else {
						oFaceRight = ZC.ZCMath3D._create_3d_facet_(oStyleSide2, self.oGraph, aPoints);
					}
					oFaceRight.sId = self.sId + '-facet4';
					oFaceRight.iPriority = _priority_(2);
					oEngine3D.add(oFaceRight);

					if (self.oParent.bStacked && fRatioTop !== 0) {
						if (oFacets['top']) {
							oStyleFace = new ZC.ZCStyle(self);
							oStyleFace.copy(oStyleSide1);
							oStyleFace.append(oFacets['top']);
							oStyleFace.parse();
							oFaceTop = ZC.ZCMath3D._create_3d_face_(oStyleFace, self.oGraph, iCX - iWT, iCX - iWT, iCY + iH2 - fRTH2, iCY + iH2 + fRTH2, iD2 - fRTD2, iD2 + fRTD2, 'z');
						} else {
							oFaceTop = ZC.ZCMath3D._create_3d_face_(oStyleSide1, self.oGraph, iCX - iWT, iCX - iWT, iCY + iH2 - fRTH2, iCY + iH2 + fRTH2, iD2 - fRTD2, iD2 + fRTD2, 'z');
						}
						oFaceTop.sId = self.sId + '-facet5';
						oFaceTop.iPriority = _priority_(5);
						oEngine3D.add(oFaceTop);
					}

					if (self.oParent._bCreateAreaMap) {
						aAreas.push(
							sAreaPrefix + '--left' + '" coords="' + oFaceLeft.getAreaCoords() + '" />',
							sAreaPrefix + '--right' + '" coords="' + oFaceRight.getAreaCoords() + '" />',
							sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />'
						);
						
					}
					break;

				case 'cylinder':
					aPoints = [];
					if (b3D) {
						for (a=0;a<=360;a+=5) {
							aPoints.push([iCX - self.iWidth, iCY + ZC._sin_(a)*iRadius + iH2, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
					} else {
						for (a=0;a<=360;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*(iRadius/2) + iAx, iY + iH2 + ZC._sin_(a)*iRadius - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_(1);
					oEngine3D.add(oFaceBottom);

					aPoints = [];
					if (b3D) {
						for (a=90-iOffsetAngle;a<=270-iOffsetAngle;a+=5) {
							aPoints.push([iCX - self.iWidth, iCY + ZC._sin_(a)*iRadius + iH2, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
						aPoints.push([iCX, iCY + ZC._sin_(a)*iRadius + iH2, iCZ + ZC._cos_(a)*iRadius + iD2]);
						for (a=270-iOffsetAngle;a>=90-iOffsetAngle;a-=5) {
							aPoints.push([iCX, iCY + ZC._sin_(a)*iRadius + iH2, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
					} else {
						for (a=90;a<=270;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*(iRadius/2) + iAx, iY + iH2 + ZC._sin_(a)*iRadius - iAy];
							aPoints.push(oPoint);
						}
						for (a=270;a>=90;a-=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*(iRadius/2) + self.iWidth + iAx, iY + iH2 + ZC._sin_(a)*iRadius - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyle);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints, !b3D);
					}
					oFaceFront.sId = self.sId + '-facet2';
					oFaceFront.iPriority = _priority_(2);
					oEngine3D.add(oFaceFront);

					aPoints = [];
					if (b3D) {
						for (a=0;a<=360;a+=5) {
							aPoints.push([iCX, iCY + ZC._sin_(a)*iRadius + iH2, iCZ + ZC._cos_(a)*iRadius + iD2]);
						}
					} else {
						for (a=0;a<=360;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + ZC._cos_(a)*(iRadius/2) + self.iWidth + iAx, iY + iH2 + ZC._sin_(a)*iRadius - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['top']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['top']);
						oStyleFace.parse();
						oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
					}
					oFaceTop.sId = self.sId + '-facet3';
					oFaceTop.iPriority = _priority_(3);
					oEngine3D.add(oFaceTop);

					if (self.oParent._bCreateAreaMap) {
						aAreas.push(
							sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />',
							sAreaPrefix + '--top' + '" coords="' + oFaceTop.getAreaCoords() + '" />'
						);
						
					}
					break;

				case 'cone':
					aPoints = [];
					if (b3D) {
						for (a=0;a<=360;a+=5) {
							aPoints.push([iCX - iWB, iCY + ZC._sin_(a)*iRadius*fRatioBottom + iH2, ZC._cos_(a)*iRadius*fRatioBottom + iD2]);
						}
					} else {
						for (a=0;a<=360;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + iWT + ZC._cos_(a)*(iRadius/2)*fRatioBottom + iAx, iY + iH2 + ZC._sin_(a)*iRadius*fRatioBottom - iAy];
							aPoints.push(oPoint);
						}
					}
					if (oFacets['bottom']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyleSide1);
						oStyleFace.append(oFacets['bottom']);
						oStyleFace.parse();
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceBottom = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
					}
					oFaceBottom.sId = self.sId + '-facet1';
					oFaceBottom.iPriority = _priority_(1);
					oEngine3D.add(oFaceBottom);

					aPoints = [];
					if (b3D) {
						for (a=90-iOffsetAngle;a<=270-iOffsetAngle;a+=5) {
							aPoints.push([iCX - iWB, iCY + ZC._sin_(a)*iRadius*fRatioBottom + iH2, ZC._cos_(a)*iRadius*fRatioBottom + iD2]);
						}
						if (self.oParent.bStacked && fRatioTop !== 0) {
							for (a=270-iOffsetAngle;a>=90-iOffsetAngle;a-=5) {
								aPoints.push([iCX - iWT, iCY + ZC._sin_(a)*iRadius*fRatioTop + iH2, ZC._cos_(a)*iRadius*fRatioTop + iD2]);
							}
						} else {
							aPoints.push([iCX - iWT, iCY + iH2, iRadius]);
						}
					} else {
						for (a=90;a<=270;a+=5) {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + iWT + ZC._cos_(a)*(iRadius/2)*fRatioBottom + iAx, iY + iH2 + ZC._sin_(a)*iRadius*fRatioBottom - iAy];
							aPoints.push(oPoint);
						}
						if (self.oParent.bStacked && fRatioTop !== 0) {
							for (a=270;a>=90;a-=5) {
								oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
								oPoint.aXY = [iX + iWB + ZC._cos_(a)*(iRadius/2)*fRatioTop + iAx, iY + iH2 + ZC._sin_(a)*iRadius*fRatioTop - iAy];
								aPoints.push(oPoint);
							}
						} else {
							oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
							oPoint.aXY = [iX + iWB + iAx, iY + iH2 - iAy];
							aPoints.push(oPoint);
						}

					}

					if (oFacets['front']) {
						oStyleFace = new ZC.ZCStyle(self);
						oStyleFace.copy(oStyle);
						oStyleFace.append(oFacets['front']);
						oStyleFace.parse();
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
					} else {
						oFaceFront = ZC.ZCMath3D._create_3d_facet_(oStyle, self.oGraph, aPoints, !b3D);
					}
					oFaceFront.sId = self.sId + '-facet2';
					oFaceFront.iPriority = _priority_(2);
					oEngine3D.add(oFaceFront);

					if (self.oParent.bStacked && fRatioTop !== 0) {
						aPoints = [];
						if (b3D) {
							for (a=0;a<=360;a+=5) {
								aPoints.push([iCX - iWT, iCY + ZC._sin_(a)*iRadius*fRatioTop + iH2, ZC._cos_(a)*iRadius*fRatioTop + iD2]);
							}
						} else {
							for (a=0;a<=360;a+=5) {
								oPoint = new ZC.ZCPoint3D(self.oGraph, 0, 0, 0);
								oPoint.aXY = [iX + iWB + ZC._cos_(a)*(iRadius/2)*fRatioTop + iAx, iY + iH2 + ZC._sin_(a)*iRadius*fRatioTop - iAy];
								aPoints.push(oPoint);
							}
						}
						if (oFacets['top']) {
							oStyleFace = new ZC.ZCStyle(self);
							oStyleFace.copy(oStyleSide1);
							oStyleFace.append(oFacets['top']);
							oStyleFace.parse();
							oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleFace, self.oGraph, aPoints, !b3D);
						} else {
							oFaceTop = ZC.ZCMath3D._create_3d_facet_(oStyleSide1, self.oGraph, aPoints, !b3D);
						}
						oFaceTop.sId = self.sId + '-facet3';
						oFaceTop.iPriority = _priority_(3);
						oEngine3D.add(oFaceTop);
					}

					if (self.oParent._bCreateAreaMap) {
						aAreas.push(sAreaPrefix + '--front' + '" coords="' + oFaceFront.getAreaCoords() + '" data-z-sort="-100" />');
						
					}
					break;
			}
		}

		if (self.oParent.oValueBox) {
			self.paintValueBox();
		}

	},
	showLayer : function() {
	}
});










ZC.ZCLine3DPlotNode = ZC.ZCLinePlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.oStyle.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.oStyle.sLineColor,
			'border-color' : this.oStyle.sLineColor,
			'color' : this.oStyle.sColor
		};
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var aXY = self._super(oValueBox);
		var oPoint3D = new ZC.ZCPoint3D(self.oGraph, aXY[0] - ZC.ZCDraw3D.iViewX, aXY[1] - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start']);
		return oPoint3D.aXY;
	},
	paint : function() {
		var self = this, i;
		self._super();

		var oScaleKey = self.oParent._oScaleKey;
		

		var aPoints = self.oAttributes['points'];

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

		if (self.oParent.oJsRule) {
			self.applyJsRule(oStyle);
		}

		var iPlots = 0, iPlotCnt = -1, iPlotDepth = ZC.ZCDraw3D.iDepth;
		if (!self.oParent.bStacked) {
			for (i=0;i<self.oParent.oParent.aPlots.length;i++) {
				if (self.oGraph.oAttributes['plot'+i+'.visible']) {
					iPlotCnt++;
				}
			}
			for (i=0;i<self.oParent.oParent.aPlots.length;i++) {
				if (self.oGraph.oAttributes['plot'+i+'.visible']) {
					iPlots++;
					if (self.oParent.iIndex > i) {
						iPlotCnt--;
					}
				}
			}
			iPlotDepth /= iPlots;
		} else {
			iPlotCnt = 0;
		}

		oStyle.sBackgroundColor1 = oStyle.sBackgroundColor2 = oStyle.sLineColor;
		oStyle.iBorderWidth = oStyle.iLineWidth;
		if (self.oParent.sAspect === 'spline') {
			oStyle.sBorderColor = oStyle.sLineColor;
		}

		var aAreas = self.oParent.oParent.aAreas;
		var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
		var sAreaPrefix = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId;

		var iZStart = iPlotCnt*iPlotDepth, iZEnd = (iPlotCnt+1)*iPlotDepth;
		if (ZC._n_(self.oParent.oData['z-start']) !== null) {
			iZStart = ZC._i_(self.oParent.oData['z-start']);
		}
		if (ZC._n_(self.oParent.oData['z-end']) !== null) {
			iZEnd = ZC._i_(self.oParent.oData['z-end']);
		}
		self.oParent.oAttributes['z-start'] = iZStart;
		self.oParent.oAttributes['z-mid'] = (iZStart+iZEnd)/2;

		var aP1 = [], aP2 = [];
		for (var p=0;p<aPoints.length-1;p++) {
			var iAngle = -ZC._i_(ZC._deg_(Math.atan((aPoints[p+1][1]-aPoints[p][1])/(aPoints[p+1][0]-aPoints[p][0]))));

			var oStyleSide = new ZC.ZCStyle(self);
			oStyleSide.copy(oStyle);
			if (ZC._a_(iZStart-iZEnd) > 10) {
				oStyleSide.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBackgroundColor1), iAngle);
				oStyleSide.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBackgroundColor2), iAngle);
				oStyleSide.sBorderColor = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBorderColor), iAngle);
			}

			var oFace = new ZC.ZCFace3D(oStyleSide, self.oGraph);
			oFace.sId = self.sId + '-facet' + p;
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZStart));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZStart));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZEnd-1));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZEnd-1));
			self.oGraph.oEngine3D.add(oFace);
			var sCoords = oFace.getAreaCoords();

			if (ZC._a_(iZStart-iZEnd) < 10) {
				var oFaceTooltip = new ZC.ZCFace3D(oStyleSide, self.oGraph);
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZStart-10));
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZStart-10));
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZEnd-1+10));
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZEnd-1+10));
				sCoords = oFaceTooltip.getAreaCoords();
				aP1.push(oFaceTooltip.aPoints[0].aXY);
				aP2.push(oFaceTooltip.aPoints[3].aXY);
			} else {
				aP1.push(oFace.aPoints[0].aXY);
				aP2.push(oFace.aPoints[3].aXY);
			}

			if (self.oParent.sAspect !== 'spline') {
				if (self.oParent._bCreateAreaMap) {
					aAreas.push(sAreaPrefix + '--face' + p + '" coords="' + sCoords + '" />');
					
				}
			}
		}

		if (self.oParent.sAspect === 'spline') {
			
			self.oAttributes['polypoints'] = true;
			self.oAttributes['points'] = aP1.concat(aP2.reverse());
		} else {
			self.oAttributes['points'] = null;
		}

		if (!self.oGraph.bScrolling && ZC._btw_(self.iX, oScaleKey.iX - 1, oScaleKey.iX + oScaleKey.iWidth + 1) && ZC._btw_(self.iY, oScaleKey.iY - 1, oScaleKey.iY + oScaleKey.iHeight + 1)) {
			self.sharedMarker(true);
		}

		self.paintPreview(oStyle, aPoints);

	},
	showLayer : function() {
	}
});










ZC.ZCArea3DPlotNode = ZC.ZCAreaPlotNode.extend({
	setup : function() {
		this.setupXY();
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.oStyle.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.oStyle.sLineColor,
			'border-color': this.oStyle.sLineColor,
			'color' : this.oStyle.sColor
		};
	},
	setupValueBox : function(oValueBox) {
		var self = this;
		var aXY = self._super(oValueBox);
		var oPoint3D = new ZC.ZCPoint3D(self.oGraph, aXY[0] - ZC.ZCDraw3D.iViewX, aXY[1] - ZC.ZCDraw3D.iViewY, self.oParent.oAttributes['z-start']);
		return oPoint3D.aXY;
	},
	paint : function() {
		var self = this, i;
		self._super();

		var oScaleKey = self.oParent._oScaleKey;
		var oScaleVal = self.oParent._oScaleVal;

		var fRefValue = oScaleVal.fRefValue;
		var iYRef = oScaleVal.getCoordByValue(fRefValue);
		iYRef = ZC._l_(iYRef, oScaleVal.iY, oScaleVal.iY + oScaleVal.iHeight);

		var aPoints = self.oAttributes['points'];
		var aPointsArea = self.oAttributes['pointsarea'];

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self.oStyle);

		if (self.oParent.oJsRule) {
			self.applyJsRule(oStyle);
		}

		var iPlots = 0, iPlotCnt = -1, iPlotDepth = ZC.ZCDraw3D.iDepth;
		if (!self.oParent.bStacked) {
			for (i=0;i<self.oParent.oParent.aPlots.length;i++) {
				if (self.oGraph.oAttributes['plot'+i+'.visible']) {
					iPlotCnt++;
				}
			}
			for (i=0;i<self.oParent.oParent.aPlots.length;i++) {
				if (self.oGraph.oAttributes['plot'+i+'.visible']) {
					iPlots++;
					if (self.oParent.iIndex > i) {
						iPlotCnt--;
					}
				}
			}
			iPlotDepth /= iPlots;
		} else {
			iPlotCnt = 0;
		}

		var oStyleLine = new ZC.ZCStyle(self);
		oStyleLine.copy(oStyle);
		oStyleLine.sBackgroundColor1 = oStyleLine.sBackgroundColor2 = oStyle.sLineColor;
		oStyleLine.iBorderWidth = oStyle.iLineWidth;
		if (self.oParent.sAspect === 'spline') {
			oStyleLine.sBorderColor = oStyle.sLineColor;
		}

		var oStyleArea = new ZC.ZCStyle(self);
		oStyleArea.copy(oStyle);
		oStyleArea.bAreaCorrection = true;
		oStyleArea.iBorderWidth = 0;
		oStyleArea.fAlpha = self.oParent.fAlphaArea;
		oStyleArea.sBackgroundColor1 = ZC.ZCUtils._lighten_(ZC.ZCUtils._color_(oStyleArea.sBackgroundColor1), 30);
		oStyleArea.sBackgroundColor2 = ZC.ZCUtils._lighten_(ZC.ZCUtils._color_(oStyleArea.sBackgroundColor2), 30);

		var aAreas = self.oParent.oParent.aAreas;
		var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
		var sAreaPrefix = ZC.ZCHtmlUtils._area_start_('poly', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId;

		var aP1 = [], aP2 = [];

		var iZStart = iPlotCnt*iPlotDepth, iZEnd = (iPlotCnt+1)*iPlotDepth;
		if (ZC._n_(self.oParent.oData['z-start']) !== null) {
			iZStart = ZC._i_(self.oParent.oData['z-start']);
		}
		if (ZC._n_(self.oParent.oData['z-end']) !== null) {
			iZEnd = ZC._i_(self.oParent.oData['z-end']);
		}
		self.oParent.oAttributes['z-start'] = iZStart;
		self.oParent.oAttributes['z-mid'] = (iZStart+iZEnd)/2;

		var p, pLen, oFace = new ZC.ZCFace3D(oStyleArea, self.oGraph);
		for (p=0,pLen=aPointsArea.length;p<pLen;p++) {
			var oPoint = new ZC.ZCPoint3D(self.oGraph, aPointsArea[p][0] - ZC.ZCDraw3D.iViewX, aPointsArea[p][1] - ZC.ZCDraw3D.iViewY, iZStart);
			oFace.add(oPoint);
		}
		self.oGraph.oEngine3D.add(oFace);

		self.oAttributes['pointsarea'] = aPointsArea;

		if (self.iIndex === self.oParent.aPlotNodes.length-1) {
			oFace = new ZC.ZCFace3D(oStyleArea, self.oGraph);
			oFace.add(new ZC.ZCPoint3D(self.oGraph, self.iX - 0.5 - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, iZStart));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, self.iX - 0.5 - ZC.ZCDraw3D.iViewX, iYRef - ZC.ZCDraw3D.iViewY, iZStart));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, self.iX - 0.5 - ZC.ZCDraw3D.iViewX, iYRef - ZC.ZCDraw3D.iViewY, iZEnd-1));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, self.iX - 0.5 - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, iZEnd-1));
			oFace.sId = self.sId + '-facet99';
			self.oGraph.oEngine3D.add(oFace);
		}

		for (p=0;p<aPoints.length-1;p++) {
			var iAngle = -ZC._i_(ZC._deg_(Math.atan((aPoints[p+1][1]-aPoints[p][1])/(aPoints[p+1][0]-aPoints[p][0]))));

			var oStyleSide = new ZC.ZCStyle(self);
			oStyleSide.copy(oStyleLine);
			oStyleSide.sBackgroundColor1 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBackgroundColor1), iAngle);
			oStyleSide.sBackgroundColor2 = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBackgroundColor2), iAngle);
			oStyleSide.sBorderColor = ZC.ZCUtils._darken_(ZC.ZCUtils._color_(oStyleSide.sBorderColor), iAngle);

			oFace = new ZC.ZCFace3D(oStyleSide, self.oGraph);
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZStart));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZStart));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZEnd-1));
			oFace.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZEnd-1));
			oFace.sId = self.sId + '-facet' + p;
			self.oGraph.oEngine3D.add(oFace);
			var sCoords = oFace.getAreaCoords();

			if (ZC._a_(iZStart-iZEnd) < 10) {
				var oFaceTooltip = new ZC.ZCFace3D(oStyleSide, self.oGraph);
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZStart-10));
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZStart-10));
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p+1][0] - ZC.ZCDraw3D.iViewX, aPoints[p+1][1] - ZC.ZCDraw3D.iViewY, iZEnd-1+10));
				oFaceTooltip.add(new ZC.ZCPoint3D(self.oGraph, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, iZEnd-1+10));
				sCoords = oFaceTooltip.getAreaCoords();
				aP1.push(oFaceTooltip.aPoints[0].aXY);
				aP2.push(oFaceTooltip.aPoints[3].aXY);
			} else {
				aP1.push(oFace.aPoints[0].aXY);
				aP2.push(oFace.aPoints[3].aXY);
			}

			if (self.oParent.sAspect !== 'spline') {
				if (self.oParent._bCreateAreaMap) {
					aAreas.push(sAreaPrefix + '--face' + p + '" coords="' + sCoords + '" />');
					
				}
			}

		}

		if (self.oParent.sAspect === 'spline') {
			
			self.oAttributes['polypoints'] = true;
			self.oAttributes['points'] = aP1.concat(aP2.reverse());
		} else {
			self.oAttributes['points'] = null;
		}

		if (!self.oGraph.bScrolling && ZC._btw_(self.iX, oScaleKey.iX - 1, oScaleKey.iX + oScaleKey.iWidth + 1) && ZC._btw_(self.iY, oScaleKey.iY - 1, oScaleKey.iY + oScaleKey.iHeight + 1)) {
			self.sharedMarker(true);
		}

		self.paintPreview(oStyle, aPoints, aPointsArea);

	},
	showLayer : function() {
	}
});











ZC.ZCVennPlotNode = ZC.ZCPlotNode.extend({
	fNextValue : 0,
	fJoinValue : 0,
	parseText : function(sText, oExtraFormat) {
		var self = this;
		var oPairedPlot = null;
		if (self.oParent.iIndex < self.oParent.oParent.aPlots.length-1) {
			oPairedPlot = self.oParent.oParent.aPlots[self.oParent.iIndex+1];
		} else {
			oPairedPlot = self.oParent.oParent.aPlots[0];
		}
		self.aTokens = [
			['%paired-plot-text', oPairedPlot.sText],
			['%paired-node-value', oPairedPlot.aPlotNodes[self.iIndex].fValue],
			['%joined-value', self.fJoinValue],
			['%shared-value', ZC._n_(self.oParent.oParent.aIArea[self.iIndex])===null?0:self.oParent.oParent.aIArea[self.iIndex].area]
		];
		sText = self._super(sText, oExtraFormat);
		return sText;
	},
	setup : function() {
		var self = this;
		var oScale = self.oGraph.getScaleByName('scale');
		var iCol = self.iIndex%oScale.iCols;
		var iRow = Math.floor(self.iIndex/oScale.iCols);
		self.iX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX;
		self.iY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY;
		if (!self.bInit) {
			self.copy(self.oParent);
			self.aRules = self.oParent.aRules;
			if (self.applyRules()) {
				self.parse(false);
			}
			self.bInit = true;
		}
		self.iWidth = oScale.iHStepSize/2;
		self.iHeight = oScale.iVStepSize/2;
	},
	setupValueBox : function(oValueBox) {
		var self = this;

		
		var iWidth = oValueBox.iWidth, iHeight = oValueBox.iHeight;

		var iX = self.iX - iWidth/2;
		var iY = self.iY - iHeight/2;
		if (self.oParent.oParent.aPlots.length === 3) {
			switch (self.oParent.iIndex) {
				case 0:
					iX -= self.iSize/4;
					iY += self.iSize/8;
					break;
				case 1:
					iX += self.iSize/4;
					iY += self.iSize/8;
					break;
				case 2:
					iY -= self.iSize/4;
					break;
			}
		} else {
			switch (self.oParent.iIndex) {
				case 0:
					iX -= self.iSize/4;
					break;
				case 1:
					iX += self.iSize/4;
					break;
			}
		}
		if (ZC._n_(oValueBox.oData['x']) !== null) {
			iX = oValueBox.iX;
		}
		if (ZC._n_(oValueBox.oData['y']) !== null) {
			iY = oValueBox.iY;
		}
		iX += oValueBox.iOffsetX;
		iY += oValueBox.iOffsetY;
		return [ZC._i_(iX), ZC._i_(iY)];
	},
	paintValueBox : function() {
		var self = this, aMP, oJoinValueBox;
		var oValueBox = self._super();

		var sDOMClass = self.oGraph.sId + '-value-box ' + self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-value-box zc-value-box';
		var oCanvas = self.oLoader.usc()?self.oLoader.mc('top'):((self.oGraph.oSettings['3d'] || self.oLoader.bFlat)?ZC._id_(self.oGraph.sId + '-plots-vb-c'):ZC._id_(self.oGraph.sId + '-plot-' + self.oParent.iIndex + '-vb-c'));
		var oDOMParent = self.oLoader.usc()?ZC._id_(self.oGraph.oParent.sId + '-top'):ZC._id_(self.oGraph.oParent.sId + '-text');

		if (ZC._n_(oValueBox.oData['joined']) !== null) {
			var oPairedPlot = null;
			if (self.oParent.iIndex < self.oParent.oParent.aPlots.length-1) {
				oPairedPlot = self.oParent.oParent.aPlots[self.oParent.iIndex+1];
			} else {
				oPairedPlot = self.oParent.oParent.aPlots[0];
			}
			
			aMP = self.oParent.oParent.aInfo[self.oParent.iIndex][self.iIndex].intxy;

			oJoinValueBox = new ZC.ZCTextBox(self);
			oJoinValueBox.copy(oValueBox);
			oJoinValueBox.oData['text'] = (''+self.fJoinValue);
			oJoinValueBox.append(oValueBox.oData['joined']);
			oJoinValueBox.parseText = function(sText) {
				return self.parseText(sText, {});
			};
			oJoinValueBox.parse();
			oJoinValueBox.sDOMClass = sDOMClass;
			oJoinValueBox.sId = self.sId + '-value-box-join';
			oJoinValueBox.oCanvas = oValueBox.oCanvasSh = oCanvas;
			oJoinValueBox.oDOMParent = oDOMParent;
			

			oJoinValueBox.iX = aMP[0] - oJoinValueBox.iWidth/2;
			oJoinValueBox.iY = aMP[1] - oJoinValueBox.iHeight/2;
			if (oJoinValueBox.bVisible) {
				oJoinValueBox.paint();
				oJoinValueBox.paintPrintVersion();
			}
		}

		if (ZC._n_(oValueBox.oData['shared']) !== null && self.oParent.iIndex === 2) {

			
			aMP = self.oParent.oParent.aIArea[self.iIndex].xy;

			oJoinValueBox = new ZC.ZCTextBox(self);
			oJoinValueBox.copy(oValueBox);
			oJoinValueBox.oData['text'] = (''+self.oParent.oParent.aAreas[self.oParent.iIndex]);
			oJoinValueBox.append(oValueBox.oData['shared']);
			oJoinValueBox.parseText = function(sText) {
				return self.parseText(sText, {});
			};
			oJoinValueBox.parse();
			oJoinValueBox.sDOMClass = sDOMClass;
			oJoinValueBox.sId = self.sId + '-value-box-shared';
			oJoinValueBox.oCanvas = oValueBox.oCanvasSh = oCanvas;
			oJoinValueBox.oDOMParent = oDOMParent;
			

			oJoinValueBox.iX = aMP[0] - oJoinValueBox.iWidth/2;
			oJoinValueBox.iY = aMP[1] - oJoinValueBox.iHeight/2;
			if (oJoinValueBox.bVisible) {
				oJoinValueBox.paint();
				oJoinValueBox.paintPrintVersion();
			}
		}
	},
	getValueBoxStyle : function() {
		return {
			'color' : this.sLineColor
		};
	},
	getTooltipStyle : function() {
		return {
			'background-color' : this.sBorderColor,
			'border-color' : this.sBorderColor,
			'color' : this.sColor
		};
	},
	paint : function() {
		var self = this, p;

		self._super();

		var oStyle = self.oStyle = self.oParent.applySelectionStyle(self, self);

		var oCircle = new ZC.ZCShape(self.oParent);
		oCircle.sId = self.sId;
		oCircle.oCanvas = self.oParent.getCanvas('bl', 1);
		oCircle.oCanvasSh = self.oParent.getCanvas('bl', 0);
		
		oCircle.copy(oStyle);
		var iX = self.iX;
		var iY = self.iY;
		oCircle.iX = iX;
		oCircle.iY = iY;
		oCircle.iSize = self.iSize;
		oCircle.sShape = 'circle';
		oCircle.oAttributes['plotidx'] = self.oParent.iIndex;
		oCircle.oAttributes['nodeidx'] = self.iIndex;
		oCircle.parse();

		self.oCircle = oCircle;

		function _fn_end_() {
			var sClass = self.oGraph.sId + '-node-area ' + self.oGraph.sId + '-plotset-plot-' + self.oParent.iIndex + '-node-area zc-node-area';
			var sHtmlArea = ZC.ZCHtmlUtils._area_start_('circle', self.oParent.sUrl, self.oParent.sCursor) + 'class="' + sClass + '" id="' + self.sId + '" coords="' + ZC._i_(self.iX+ZC.MAPTX) + ',' + ZC._i_(self.iY+ZC.MAPTX) + ',' + ZC._i_(ZC._max_((ZC.mobile?6:3), self.iSize)*(ZC.mobile?2:1.2)) + '" />';
			self.oParent.oParent.aAreas.push(sHtmlArea);
			
			if (self.oParent.oValueBox) {
				self.paintValueBox();
			}
		}

		if (self.oParent.bAnimation && !self.oGraph.bDisableAnimation) {
			var oStart = oCircle, oEnd = {};

			oStart.iX = iX;
			oStart.iY = iY;
			oEnd.x = iX;
			oEnd.y = iY;

			var iAE = self.oParent.iAnimationEffect;
			oStart.fAlpha = 0;
			oEnd.alpha = oStyle.fAlpha;

			if (iAE === 3) {
				oStart.iSize = 2;
				oEnd.size = self.iSize;
			} else if (iAE === 4) {
				switch (self.oParent.iIndex) {
					case 0:
						oStart.iX = iX - self.iSize*3;
						oStart.iY = iY;
						break;
					case 1:
						oStart.iX = iX + self.iSize*3;
						oStart.iY = iY;
						break;
					case 2:
						oStart.iX = iX;
						oStart.iY = iY - self.iSize*3;
						break;
				}
				oEnd.x = iX;
				oEnd.y = iY;
			}

			for (p in self.oParent.oAnimationAttributes) {
				oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oParent.oAnimationAttributes[p];
				oEnd[ZC._camelcase_(p)] = oStyle[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]];
			}

			if (!self.oGraph.oLast) {
				self.oGraph.oLast = {};
			}
			if (ZC._n_(self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) !== null) {
				for (p in self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]) {
					oStart[ZC.ZCTween.oAttrMap[ZC._camelcase_(p)]] = self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex][p];
				}
			}
			self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex] = {};
			ZC._cp_(oEnd, self.oGraph.oLast[self.oParent.iIndex+'-'+self.iIndex]);

			var oTween = new ZC.ZCTween(
				oStart,
				oEnd,
				self.oParent.fAnimationSpeed,
				self.oParent.fAnimationDelay,
				ZC.ZCTween.aMethods[self.oParent.iAnimationMethod],
				function() {
					_fn_end_();
				}
			);
			oTween.oNode = self;

			self.sharedAnimationSetup(oTween);
		} else {
			oCircle.paint();
			_fn_end_();
		}
	},
	showLayer : function(sLayer) {
		var self = this;
		if (ZC.move) { return; }
		self.sharedLayerSetup({
			layer : sLayer,
			type : 'shape',
			initcb : function() {
				this.copy(self);
				this.iX = self.iX;
				this.iY = self.iY;
				this.iSize = self.iSize;
				this.sShape = 'circle';
				this.sBackgroundColor1 = self.oParent.aPalette[3];
				this.sBackgroundColor2 = self.oParent.aPalette[2];
			}
		});
	}
});










ZC.ZCPlotNode.prototype.sharedErrors = function(oCtx, bHover) {
	var self = this, oCopy, mError;
	if (typeof(bHover) === 'undefined') {
		bHover = false;
	}
	if (!bHover) {
		var oScaleVal = self.oParent._oScaleVal;
		var oScaleKey = self.oParent._oScaleKey;
		if (self.oParent.aErrors.length !== 0) {
			var fErrorPlus = null, fErrorMinus = null;
			
			var bGlobal = true;
			if (self.oParent.aErrors.length <= 2) {
				if (ZC._n_(self.oParent.aErrors[0]) !== null && self.oParent.aErrors[0] instanceof Array) {
					bGlobal = false;
				}
				if (ZC._n_(self.oParent.aErrors[1]) !== null && self.oParent.aErrors[1] instanceof Array) {
					bGlobal = false;
				}
			} else {
				bGlobal = false;
			}
			if (bGlobal) {
				fErrorPlus = self.oParent.aErrors[0];
				fErrorMinus = self.oParent.aErrors[1];
			} else {
				if (ZC._n_(mError=self.oParent.aErrors[self.iIndex]) !== null) {
					if (mError instanceof Array) {
						fErrorPlus = fErrorMinus = mError[0];
						if (mError.length === 2) {
							fErrorMinus = mError[1];
						}
					}
				}
			}

			self.oAttributes['node-error-plus'] = fErrorPlus;
			self.oAttributes['node-error-minus'] = fErrorMinus;

			if ((fErrorPlus+'').indexOf('%') !== -1) {
				fErrorPlus = ZC._dimension_(fErrorPlus);
				if (fErrorPlus <= 1) {
					fErrorPlus *= self.fValue;
				}
			}
			if ((fErrorMinus+'').indexOf('%') !== -1) {
				fErrorMinus = ZC._dimension_(fErrorMinus);
				if (fErrorMinus <= 1) {
					fErrorMinus *= self.fValue;
				}
			}

			var aPointsError = [];
			var iErrorSize = ZC._dimension_(self.oParent.oError?(self.oParent.oError.oData['size'] || 0.5):0.5);
			if (iErrorSize <= 1) {
				if (self.oParent.sType === 'vbar') {
					iErrorSize = ZC._i_(iErrorSize*self.iWidth);
				} else if (self.oParent.sType === 'hbar') {
					iErrorSize = ZC._i_(iErrorSize*self.iHeight);
				} else {
					iErrorSize = ZC._i_(iErrorSize*oScaleKey.iStepSize);
				}
			}

			var iRefWidth = 0;
			if (self.oParent.sType === 'vbar') {
				iRefWidth = self.iWidth;
			} else if (self.oParent.sType === 'hbar') {
				iRefWidth = self.iHeight;
			}
			if (ZC._n_(fErrorPlus) !== null) {
				var iCoordPlus = oScaleVal.getCoordByValue(self.fAbsoluteValue + fErrorPlus);
				if (self.oParent.sType === 'hbar') {
					aPointsError.push(
						[iCoordPlus, self.iY + iRefWidth/2 - iErrorSize/2],
						[iCoordPlus, self.iY + iRefWidth/2 + iErrorSize/2],
						null,
						[iCoordPlus, self.iY + iRefWidth/2],
						[self.iX, self.iY + iRefWidth/2]
					);
				} else {
					if (self.oData.value < 0){
						iStartCoord = self.iY + self.iHeight;
					} else {
						iStartCoord = self.iY;
					}
					aPointsError.push(
						[self.iX + iRefWidth/2 - iErrorSize/2, iCoordPlus],
						[self.iX + iRefWidth/2 + iErrorSize/2, iCoordPlus],
						null,
						[self.iX + iRefWidth/2, iCoordPlus],
						[self.iX + iRefWidth/2, iStartCoord]
					);
				}
			}
			if (ZC._n_(fErrorMinus) !== null) {
				var iCoordMinus = oScaleVal.getCoordByValue(self.fAbsoluteValue - fErrorMinus);
				if (self.oParent.sType === 'hbar') {
					aPointsError.push(
						null,
						[iCoordMinus, self.iY + iRefWidth/2 - iErrorSize/2],
						[iCoordMinus, self.iY + iRefWidth/2 + iErrorSize/2],
						null,
						[iCoordMinus, self.iY + iRefWidth/2],
						[self.iX, self.iY + iRefWidth/2]
					);
				} else {
					if (self.oData.value < 0){
						iStartCoord = self.iY + self.iHeight;
					} else {
						iStartCoord = self.iY;
					}
					aPointsError.push(
						null,
						[self.iX + iRefWidth/2 - iErrorSize/2, iCoordMinus],
						[self.iX + iRefWidth/2 + iErrorSize/2, iCoordMinus],
						null,
						[self.iX + iRefWidth/2, iCoordMinus],
						[self.iX + iRefWidth/2, iStartCoord]
					);
				}
			}
			oCopy = new ZC.ZCStyle(self);
			oCopy.copy(self.oParent);
			if (self.oParent.oError) {
				oCopy.copy(self.oParent.oError);
			}
			oCopy.parse();
			oCopy.sId = self.sId + '--error';
			oCopy.bPixelCorrection = false;
			ZC.ZCLine.paint(oCtx, oCopy, aPointsError);
			self.oAttributes['pointserror'] = aPointsError;
		}
	} else {
		if (typeof(self.oAttributes['pointserror']) !== 'undefined') {
			oCopy = new ZC.ZCStyle(self);
			oCopy.copy(self.oParent);
			if (self.oParent.oError) {
				oCopy.copy(self.oParent.oError);
			}
			oCopy.parse();
			oCopy.sId = self.sId + '--error-hover';
			ZC.ZCLine.paint(oCtx, oCopy, self.oAttributes['pointserror']);
		}
	}
};












ZC.ZCScale = ZC.ZCBox.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.oLoader = self.oParent.oParent;
		self.sName = '';
		self.aValues = [];
		self.aLabels = [];
		self.aTooltipText = [];
		self.bRanged = false;
		self.oLabel = null;
		self.oItem = null;
		self.oTick = null;
		self.oGuide = null;
		self.iMinorTicks = 0;
		self.oMinorTick = null;
		self.oMinorGuide = null;
		self.fRefValue = 0;
		self.oRefLine = null;
		self.iIndex = 1;
		self.iOffsetStart = 0;
		self.iOffsetStart_ = 0;
		self.iOffsetEnd = 0;
		self.bMirrored = false;
		self.bInversed = false;
		self.iStepSize = 0;
		self.iDecimals = -1;
		self.sThousandsSeparator = ZC.ZCLabels['thousands-separator'] || '';
		self.sDecimalsSeparator = ZC.ZCLabels['decimals-separator'] || '.';
		self.bExponent = false;
		self.bExponentDecimals = 2;
		self.bShort = false;
		self.sShortUnit = '';
		self.sNegation = 'standard';
		self.sFormat = null;
		self.sType = '';
		self.iMaxItems = ZC.MAX;
		self.iMaxTicks = ZC.MAX;
		self.bZooming = false;
		self.bZoomSnap = false;
		self.aZoomTo = null;
		self.aZoomToValues = null;
		self.aMarkers = [];
		self.fStep = 1;
		self.fMin = -1;
		self.fMax = -1;
		self.fStep_ = -1;
		self.fMin_ = -1;
		self.fMax_ = -1;
		self.sProgression = 'lin';
		self.fLogBase = Math.E;
		self.oTransform = null;
		self.fScaleFactor = 1;
		self.bIgnoreLocate = true;
		self.bItemsOverlap = false;
		self.bAutoFit = false;
		self.aShowLabels = null;
		self.oRScale = null;
		self.bUsed = false;
		self.iMaxDecimals = -1;
		self.bForceView = false;
		self.sPlacement = 'default';
		self.bFixedStep = false;
	},
	parse : function() {
		var self = this, mValue;
		self._super();

		if (ZC._n_(mValue=self.oData['step']) !== null) {
			if (ZC._isnumber_(mValue)) {
				self.fStep = ZC._f_(mValue);
			} else {
				var sStep = mValue.replace(/[0-9]/gi,'');
				var iMultiplier = parseInt(mValue.replace(/[^0-9]/gi,''), 10);
				iMultiplier = iMultiplier || 1;
				switch (sStep) {
					case 'second': self.fStep = iMultiplier*1000;break;
					case 'minute': self.fStep = iMultiplier*1000*60;break;
					case 'hour': self.fStep = iMultiplier*1000*60*60;break;
					case 'day': self.fStep = iMultiplier*1000*60*60*24;break;
					case 'week': self.fStep = iMultiplier*1000*60*60*24*7;break;
					case 'month': self.fStep = iMultiplier*1000*60*60*24*(365/12);break;
					case 'year': self.fStep = iMultiplier*1000*60*60*24*365;break;
				}
			}
		}
		
		if (ZC._n_(self.oData['multiplier']) !== null && ZC._n_(self.oData['short']) === null) {
			self.oData['short'] = self.oData['multiplier'];
		}
		self.assign_a([
			['labels', 'aLabels'],
			['tooltip-text', 'aTooltipText'],
			['format', 'sFormat'],
			['offset-start', 'iOffsetStart', 'i'],
			['offset-start', 'iOffsetStart_', 'i'],
			['offset-end', 'iOffsetEnd', 'i'],
			['minor-ticks', 'iMinorTicks', 'i'],
			['index', 'iIndex', 'i'],
			['mirrored', 'bMirrored', 'b'],
			['zooming', 'bZooming', 'b'],
			['zoom-snap', 'bZoomSnap', 'b'],
			['fixed-step', 'bFixedStep', 'b'],
			['zoom-to', 'aZoomTo'],
			['force-view', 'bForceView', 'b'],
			['zoom-to-values', 'aZoomToValues'],
			['items-overlap', 'bItemsOverlap', 'b'],
			['auto-fit', 'bAutoFit', 'b'],
			['max-labels', 'iMaxItems', 'i'],
			['max-items', 'iMaxItems', 'i'],
			['ref-value', 'fRefValue', 'f'],
			['decimals', 'iDecimals', 'ia'],
			['decimals-separator', 'sDecimalsSeparator'],
			['thousands-separator', 'sThousandsSeparator'],
			['short', 'bShort', 'b'],
			['short-unit', 'sShortUnit'],
			['negation', 'sNegation'],
			['exponent', 'bExponent', 'b'],
			['exponent-decimals', 'iExponentDecimals', 'ia'],
			['progression', 'sProgression'],
			['log-base', 'fLogBase', 'fa'],
			['scale-factor', 'fScaleFactor', 'fa'],
			['show-labels', 'aShowLabels'],
			['max-decimals', 'iMaxDecimals', 'i'],
			['placement', 'sPlacement']
		]);
		if (self.fLogBase === 10) {
			zingchart.DEV.TRUELOG = 1;
		}

		
		if (typeof(self.aLabels) === 'string') {
			var aLabelsTokens = self.aLabels.split(':');
			var fStep = 1;
			if (aLabelsTokens.length === 3) {
				fStep = ZC._f_(aLabelsTokens[2]);
			}
			self.aLabels = [];
			for (var v=ZC._f_(aLabelsTokens[0]);v<ZC._f_(aLabelsTokens[1]);v+=fStep) {
				self.aLabels.push(''+v);
			}
			self.aLabels.push(''+aLabelsTokens[1]);
		}

		self.iMaxItems = ZC._max_(self.iMaxItems, 2);

		if (ZC._n_(mValue=self.oData['offset']) !== null) {
			self.iOffsetStart = self.iOffsetEnd = ZC._i_(mValue);
		}
		if (ZC._n_(mValue=self.oData['max-ticks']) !== null) {
			self.iMaxTicks = ZC._i_(mValue);
		} else {
			self.iMaxTicks = self.iMaxItems;
		}
		self.iMaxTicks = ZC._max_(2, self.iMaxTicks);
		if (ZC._n_(mValue=self.oData['transform']) !== null) {
			self.oTransform = new ZC.ZCStyle();
			self.oTransform.append(mValue);
		}

		var oDefaults = self.oParent.oParent.oDefaults;
		var sGraphType = '(' + self.oParent.sType + ')';
		var sName1 = self.sName.replace(/\-[0-9]/, '');
		var sName2 = self.sName.replace(/\-[0-9]/, '-n');

		if (ZC._n_(self.oData['placement']) === null && self.iIndex > 1) {
			self.sPlacement = 'opposite';
		}

		
		function _def_(sObject) {
			var aDefaults = [
				sGraphType + '.SCALE.' + sObject,
				sGraphType + '.' + self.sName + '.' + sObject,
				sGraphType + '.' + sName1 + '.' + sObject,
				sGraphType + '.' + sName1 + '[' + self.sPlacement + '].' + sObject,
				sGraphType + '.' + sName2 + '.' + sObject
			];
			if (self.oParent.oSettings['3d']) {
				aDefaults = aDefaults.concat([
					sGraphType + '.SCALE[3d].' + sObject,
					sGraphType + '.' + self.sName + '[3d].' + sObject,
					sGraphType + '.' + sName1 + '[3d].' + sObject,
					sGraphType + '.' + sName2 + '[3d].' + sObject
				]);
			}
			return aDefaults;
		}

		if (ZC._n_(mValue=self.oData['markers']) !== null) {
			for (var i=0,iLen=mValue.length;i<iLen;i++) {
				var oScaleMarker = new ZC.ZCScaleMarker(self);
				oScaleMarker.iIndex = i;
				oScaleMarker.sId = self.sId + '-marker-' + i;
				
				oDefaults.load(oScaleMarker.oData, _def_('marker'));
				oScaleMarker.append(mValue[i]);
				oScaleMarker.parse();
				self.aMarkers.push(oScaleMarker);
			}
		}

		self.oRefLine = new ZC.ZCStyle(self);
		oDefaults.load(self.oRefLine.oData, _def_('ref-line'));
		self.oRefLine.append(self.oData['ref-line']);
		if (self.sType === 'k') {
			self.oRefLine.bVisible = false;
		}
		self.oRefLine.parse();

		self.oLabel = new ZC.ZCTextBox(self);
		oDefaults.load(self.oLabel.oData, _def_('label'));
		
		
		
		self.oLabel.append(self.oData['label']);
		self.oLabel.sId = self.sId + '-label';
		self.oLabel.parse();

		self.oItem = new ZC.ZCTextBox(self);
		oDefaults.load(self.oItem.oData, _def_('item'));
		self.oItem.append(self.oData['item']);
		self.oItem.sId = self.sId + '-item';
		self.oItem.parse();

		self.oTick = new ZC.ZCStyle(self);
		oDefaults.load(self.oTick.oData, _def_('tick'));
		self.oTick.append(self.oData['tick']);
		self.oTick.parse();

		self.oGuide = new ZC.ZCStyle(self);
		oDefaults.load(self.oGuide.oData, _def_('guide'));
		self.oGuide.append(self.oData['guide']);
		self.oGuide.parse();

		
		if (ZC._n_(self.oGuide.oData['items']) === null && self.oGuide.sBackgroundColor1 !== '-1' && self.oGuide.sBackgroundColor2 !== '-1') {
			self.oGuide.oData['items'] = [
				{
					'alpha' : self.oGuide.fAlpha,
					'background-color' : self.oGuide.sBackgroundColor1
				},
				{
					'alpha' : self.oGuide.fAlpha,
					'background-color' : self.oGuide.sBackgroundColor2
				}
			];
		}

		self.oMinorTick = new ZC.ZCStyle(self);
		oDefaults.load(self.oMinorTick.oData, _def_('minor-tick'));
		self.oMinorTick.append(self.oData['minor-tick']);
		self.oMinorTick.parse();

		self.oMinorGuide = new ZC.ZCStyle(self);
		oDefaults.load(self.oMinorGuide.oData, _def_('minor-guide'));
		self.oMinorGuide.append(self.oData['minor-guide']);
		self.oMinorGuide.parse();

		self.setupBounds();

	},
	setupBounds : function() {
		var self = this;
		self.iX = self.oParent.oPlotArea.iX;
		self.iY = self.oParent.oPlotArea.iY;
		self.iWidth = self.oParent.oPlotArea.iWidth;
		self.iHeight = self.oParent.oPlotArea.iHeight;
	},
	applyItemRules : function(fn) {
		var self = this;
		if (ZC._n_(self.oData['rules']) !== null) {
			if (!self.oRScale) {
				self.oRScale = new ZC.ZCScale(self.oParent);
			}
			self.oRScale.append(self.oData);
			self.oRScale.parse();
			self.oRScale.parseRule = fn;
			if (self.oRScale.applyRules()) {
				self.oRScale.parse();
				self.iDecimals = self.oRScale.iDecimals;
				self.sFormat = self.oRScale.sFormat;
			}
		}
	},
	setupStepSize : function() {
	},
	setupMaxItems : function() {
	},
	setupMaxTicks : function() {
	},
	setupValues : function() {
	},
	clear : function() {
	},
	build : function() {
	},
	setupFormat : function() {
		var self = this, mValue;
		var oFormat = {
			'negation' : self.sNegation,
			'thousands-separator' : self.sThousandsSeparator,
			'decimals-separator' : self.sDecimalsSeparator,
			'decimals' : self.iDecimals,
			'max-decimals' : self.iMaxDecimals,
			'short' : self.bShort,
			'short-unit' : self.sShortUnit,
			'exponent' : self.bExponent,
			'exponent-decimals' : self.iExponentDecimals
		};
		if (self.oTransform) {
			switch (self.oTransform.oData['type']) {
				case 'date':
					oFormat['transform-date'] = true;
					if (ZC._n_(mValue=self.oTransform.oData['text']) !== null) {
						self.oTransform.oData['all'] = mValue;
					}
					var fStep = self.aValues[self.iMaxIndex]-self.aValues[self.iMinIndex];
					var sDateFormat = '';
					var sGranularity = '';
					var aDefaultFormats = {}, aPeriods = ['msecond', 'second', 'minute', 'hour', 'day', 'month', 'year'];
					for (var k in aPeriods) {
						aDefaultFormats[aPeriods[k]] = ZC.ZCLabels['date-formats'][aPeriods[k]];
					}
					if (0 <= fStep && fStep <= 1000) {
						sGranularity = 'msecond';
					} else if (1000 < fStep && fStep <= 1000*60*60) {
						sGranularity = 'second';
					} else if (1000*60*60 < fStep && fStep <= 1000*24*60*60) {
						sGranularity = 'minute';
					} else if (1000*24*60*60 < fStep && fStep <= 1000*31*24*60*60) {
						sGranularity = 'hour';
					} else if (1000*31*24*60*60 < fStep && fStep <= 1000*366*24*60*60) {
						sGranularity = 'day';
					} else if (1000*366*24*60*60 < fStep && fStep <= 1000*20*366*24*60*60) {
						sGranularity = 'month';
					} else {
						sGranularity = 'year';
					}
					if (ZC._n_(self.oTransform.oData[sGranularity]) !== null) {
						sDateFormat = self.oTransform.oData[sGranularity];
					} else {
						if (ZC._n_(self.oTransform.oData['all']) !== null) {
							sDateFormat = self.oTransform.oData['all'];
						} else {
							sDateFormat = aDefaultFormats[sGranularity];
						}
					}
					self.oAttributes['dateformat'] = sDateFormat;
					oFormat['transform-date-format'] = self.oAttributes['dateformat'];
					break;
			}
		}
		return oFormat;
	},
	getPlotColor : function() {
		var self = this;
		var aPlots = self.oParent.oPlotSet.aPlots;
		var sColor = -1;
		for (var i=0,iLen=aPlots.length;i<iLen;i++) {
			var aScales = aPlots[i].getScales(self.sType);
			if (ZC._indexof_(aScales, self.sName) !== -1) {
				switch (aPlots[i].sType) {
					case 'pie':
					case 'pie3d':
					case 'nestedpie':
					case 'vbar':
					case 'vbar3d':
					case 'hbar':
					case 'hbar3d':
					case 'vbullet':
					case 'hbullet':
					case 'area':
					case 'area3d':
					case 'gauge':
					case 'vfunnel':
					case 'hfunnel':
					case 'venn':
						sColor = aPlots[i].sBackgroundColor1;
						break;
					case 'scatter':
					case 'bubble':
						
						sColor = (aPlots[i].oMarker.sBackgroundColor1 !== -1)?aPlots[i].oMarker.sBackgroundColor1:aPlots[i].sBackgroundColor1;
						break;
					default:
						sColor = aPlots[i].sLineColor;
						break;
				}
				break;
			}
		}
		return sColor;
	},
	paint : function() {
		var self = this;
		self.build();
		if (!self.oParent.oSettings['3d']) {
			self._super();
		}
	},
	sharedLabel3DTransform : function(oLabel, iAngle, sDir) {
		var self = this;
		if (self.oParent.oSettings['3d']) {
			var oPoint3D = new ZC.ZCPoint3D(self.oParent, oLabel.iX + oLabel.iWidth/2 - ZC.ZCDraw3D.iViewX, oLabel.iY + oLabel.iHeight/2 - ZC.ZCDraw3D.iViewY, 0 + oLabel.iOffsetZ);
			oLabel.iX = oPoint3D.aXY[0] - oLabel.iWidth/2 + (sDir==='v'?(((self.iIndex===1)?-5:5)):0);
			oLabel.iY = oPoint3D.aXY[1] - oLabel.iHeight/2 + (sDir==='h'?(((self.iIndex===1)?5:-5)):0);
			var iA3D = ZC.ZCMath3D._get_rotation_angle_(self.oParent, oLabel);
			if (ZC._n_(iAngle) === null) {
				iAngle = oLabel.iAngle + (!oLabel.bLockRotation?iA3D:0);
			}
			oLabel.iAngle = iAngle;
		}
		return iAngle;
	},
	sharedPaintLabel : function(oLabel, i, oParams) {
		var self = this;
		var iItems = oParams['items'], aLabelsCoords = oParams['lcoords'], iLabelsStep = oParams['lstep'];
		var iTotalDim = oParams['tdim'], iMaxDim = oParams['mdim'], sDim = oParams['dim'], aHtml = oParams['html'];

		var aLabelCoords = [oLabel.iX, oLabel.iY, oLabel.iWidth, oLabel.iHeight];
		var iAngle = ZC._a_(oLabel.iAngle%180), bRotated = false;
		if (ZC._sin_(iAngle) > 0.9) {
			bRotated = true;
		}
		if (bRotated) {
			aLabelCoords = [oLabel.iX+oLabel.iWidth/2-oLabel.iHeight/2, oLabel.iY+oLabel.iHeight/2-oLabel.iWidth/2, oLabel.iHeight, oLabel.iWidth];
		}

		var bNoOverlap = true;
		if (oLabel.bVisible) {
			if (!self.bItemsOverlap) {
				if (i === self.iMinIndex || i === self.iMaxIndex) {
					bNoOverlap = true;
				} else {
					if (i%iLabelsStep === 0) {
						bNoOverlap = true;
					}

					for (var l=0,lLen=aLabelsCoords.length;l<lLen;l++) {
						if (ZC.ZCMath._boxoverlap_(
							{ x : aLabelCoords[0], y : aLabelCoords[1], width : aLabelCoords[2], height : aLabelCoords[3] },
							{ x : aLabelsCoords[l][0], y : aLabelsCoords[l][1], width : aLabelsCoords[l][2], height : aLabelsCoords[l][3] }
						)) {
							bNoOverlap = false;
							break;
						}
					}
				}
			}
			if (bNoOverlap) {
				aLabelsCoords.push(aLabelCoords);
				oLabel.paint();
				iItems++;
				if (sDim === 'h') {
					iTotalDim += oLabel.iHeight;
					iMaxDim = ZC._max_(iMaxDim, bRotated?oLabel.iWidth:oLabel.iHeight);
				} else if (sDim === 'w') {
					iTotalDim += oLabel.iWidth;
					iMaxDim = ZC._max_(iMaxDim, (bRotated)?oLabel.iHeight:oLabel.iWidth);
				}
				oLabel.paintPrintVersion();
				if (ZC._n_(self.oData['tooltip']) !== null || !oLabel.bFlat) {
					aHtml.push(ZC.ZCUtils._box_area_(self.oParent.sId, oLabel));
					
				}
			}
		}
		return {tdim : iTotalDim, mdim : iMaxDim, overlaps : !bNoOverlap};
	},
	sharedPaintRefLine : function(oCtxGuides, sPlotColor) {
		var self = this;

		if (self.sType === 'v') {
			
			if (self.fRefValue === self.fMin || self.fRefValue === self.fMax) {
				if (ZC._n_(self.oData['ref-line']) === null || (ZC._n_(self.oData['ref-line']) !== null && ZC._n_(self.oData['ref-line']['visible']) === null)) {
					self.oRefLine.bVisible = false;
				}
			}
		}

		self.oRefLine.sId = self.sId + '-ref-line';

		if (self.aValues.length > 0 && self.oRefLine.bVisible && !self.oParent.oSettings['3d']) {
			if (self.oRefLine.iLineWidth > 0) {
				if (self.oRefLine.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
					self.oRefLine.sLineColor = sPlotColor;
				}
				var fRefValue = self.fRefValue;
				if ((self.sType === 'k' && !self.bInversed) || (self.sType === 'v' && self.bInversed)) {
					var iXRef = self.getCoordByValue(fRefValue);
					if (iXRef >= self.iX && iXRef <= self.iX + self.iWidth) {
						ZC.ZCLine.paint(oCtxGuides, self.oRefLine, [
							[iXRef, self.iY],
							[iXRef, self.iY + self.iHeight]
						]);
					}
				} else {
					var iYRef = self.getCoordByValue(fRefValue);
					if (iYRef >= self.iY && iYRef <= self.iY + self.iHeight) {
						ZC.ZCLine.paint(oCtxGuides, self.oRefLine, [
							[self.iX, iYRef],
							[self.iX + self.iWidth, iYRef]
						]);
					}
				}
			}
		}
	},
	paint_ : function() {
	},
	paintMarkers : function() {
		var self = this;
		for (var i=0,iLen=self.aMarkers.length;i<iLen;i++) {
			if (self.aValues.length > 0) {
				self.aMarkers[i].paint();
			}
		}
	}
});











ZC.ZCScaleK = ZC.ZCScale.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.bKeyValues = false;
		self.sType = 'k';
		self.iMinIndex_ = -1;
		self.iMaxIndex_ = -1;
		self.iMinIndex = -1;
		self.iMaxIndex = -1;
		self.iTicksAuto = 1;
		self.iDecimals = null;
		self.iOffsetData = 0;
		self.bKeyAssoc = false;
		self.bNonLinearTs = false;
		self.oNonLinearIndexes = {};
	},
	zoomTo : function(iMinIndex, iMaxIndex) {
		var self = this;
		if (ZC._n_(iMinIndex) !== null) {
			self.iMinIndex = iMinIndex;
		} else {
			self.iMinIndex = self.iMinIndex_;
		}
		if (ZC._n_(iMaxIndex) !== null) {
			self.iMaxIndex = iMaxIndex;
		} else {
			self.iMaxIndex = self.iMaxIndex_;
		}
		var aKA = self.oParent.aKeyAssoc;
		if (aKA.length > 0) {
			self.fMin = ZC._indexof_(aKA, self.aValues[self.iMinIndex]);
			self.fMax = ZC._indexof_(aKA, self.aValues[self.iMaxIndex]);
		}
		if (!self.oLoader.oZoom.oGraph) { self.oLoader.oZoom.oGraph = self.oParent; }
		if (self.oParent.oZoom && ZC._n_(self.oParent.oZoom.oData['shared']) !== null && ZC._b_(self.oParent.oZoom.oData['shared']) && self.oParent.sId === self.oLoader.oZoom.oGraph.sId) {
			
			for (var i=0,iLen=self.oLoader.aGraphs.length;i<iLen;i++) {
				var oGraph = self.oLoader.aGraphs[i];
				if (oGraph.sId !== self.oParent.sId) {
					if (ZC._n_(oGraph.oZoom.oData['shared']) !== null && ZC._b_(oGraph.oZoom.oData['shared'])) {
						var oScale = oGraph.getScaleByName(self.sName);
						if (oScale) {
							oScale.zoomTo(iMinIndex, iMaxIndex);
							oGraph.clear(true);
							oGraph.oAttributes['shared-zoom'] = true;
							oGraph.paint();
							if (oGraph.oPreview) {
								oGraph.oPreview.update(iMinIndex, iMaxIndex, null, null, true);
							}
						}
					}
				}
			}
		}
	},
	zoomToV : function(fMin, fMax) {
		var self = this;
		if (ZC._n_(fMin) !== null) {
			self.fMin = fMin;
		} else {
			self.fMin = self.fMin_;
		}
		if (ZC._n_(fMax) !== null) {
			self.fMax = fMax;
		} else {
			self.fMax = self.fMax_;
		}
		self.setupRange(self.fMin, self.fMax, (ZC._n_(fMin) === null && ZC._n_(fMax) === null));
	},
	getParsedItemLabel : function(iIndex, oPlot, oExtraFormat) {
		var self = this;
		var sLabel = '';

		if (oPlot) {
			sLabel = oPlot.aPlotNodes[iIndex].fKeyValue;
			if ((!self.oTransform || self.oTransform.oData['type'] !== 'date') && typeof(sLabel) !== 'number') {
				if (ZC._n_(self.aLabels[sLabel]) !== null) {
					sLabel = self.aLabels[sLabel];
				} else if (ZC._n_(self.aValues[sLabel]) !== null) {
					sLabel = self.aValues[sLabel];
				}
			}
		} else {
			if (ZC._n_(self.aLabels[iIndex]) !== null) {
				sLabel = self.aLabels[iIndex];
			} else {
				sLabel = self.aValues[iIndex];
			}
		}
		if (typeof(sLabel) === 'number') {
			if (ZC._n_(self.oParent.aKeyAssoc[sLabel]) !== null) {
				sLabel = self.oParent.aKeyAssoc[sLabel];
			}
		}

		var bNegative = ZC._isnumber_(sLabel) && ZC._f_(sLabel) < 0;

		var oFormat = self.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);

		if (bNegative && oFormat['negation'] === 'currency') {
			sLabel = ZC._a_(ZC._f_(sLabel));
		}

		oFormat['utc'] = self.oParent.bUTC;
		oFormat['timezone'] = self.oParent.iTimeZone;
		sLabel = ZC.ZCUtils._format_(sLabel, oFormat, self, true);
		if (self.sFormat) {
			if (self.sFormat.substring(self.sFormat.length-2) === '()' || self.sFormat.substring(0, 11) === 'javascript:') {
				try {
					var sCall = self.sFormat.replace('javascript:', '').replace('()', '');
					if (eval(sCall)) {
						sLabel = eval(sCall).call(self, sLabel);
					}
				} catch (e) {}
			} else {
				if (bNegative && oFormat['negation'] === 'currency') {
					sLabel = '-' + self.sFormat.replace(/%v|%scale-value/g, sLabel);
				} else {
					sLabel = self.sFormat.replace(/%v|%scale-value/g, sLabel);
				}
			}
		}
		return sLabel;
	},
	parseText : function(sText, iIndex, oPlot, oExtraFormat) {
		var self = this;
		var sLabel = self.getParsedItemLabel(iIndex, oPlot, oExtraFormat);

		var aTokens = [];
		aTokens.push(
			['%scale-label', sLabel],
			['%scale-index', iIndex],
			['%scale-position', iIndex]
		);

		if (self.oTransform && self.oTransform.oData['type'] === 'date') {
			aTokens.push(
				['%scale-value', sLabel],
				['%v', sLabel]
			);
		} else {
			aTokens.push(
				['%scale-value', self.aValues[iIndex] || ''],
				['%v', self.aValues[iIndex] || '']
			);
		}
		aTokens.push(
			['%l', sLabel],
			['%t', sLabel],
			['%i', iIndex],
			['%c', iIndex]
		);

		aTokens.sort(ZC._token_sort_);

		for (var i=0,iLen=aTokens.length;i<iLen;i++) {
			var oRE = new RegExp(aTokens[i][0], 'g');
			sText = sText.replace(oRE, aTokens[i][1]);
		}
		return sText;
	},
	setupMaxItems : function() {
		var self = this;
		var iItems = ZC._max_(self.aValues.length, self.aLabels.length);
		var iAvgWidth = 0;
		if (self.oItem.iAngle%180 === 0) {
			
			var iStep = ZC._max_(1, ZC._i_(iItems/20));
			for (var i=0;i<iItems;i+=iStep) {
				var sItem = self.aLabels[i] || self.aValues[i];
				var aLines = (sItem+'').split(/<br>|<br\/>|<br \/>|\n/);
				var iMaxWidth = 0;
				for (var j=0,jLen=aLines.length;j<jLen;j++) {
					iMaxWidth = ZC._max_(iMaxWidth, 10*(aLines[j].replace(/<.+?>/gi, '').replace(/<\/.+?>/gi, '')).length);
				}
				iAvgWidth += iMaxWidth;
			}
			iAvgWidth /= 20;
		} else {
			iAvgWidth = 15;
		}
		if (!self.bInversed) {
			self.iMaxItems = ZC._i_((self.iWidth-self.iOffsetStart-self.iOffsetEnd)/iAvgWidth);
		} else {
			self.iMaxItems = ZC._i_((self.iHeight-self.iOffsetStart-self.iOffsetEnd)/15);
		}
		
		
		if ((self.fMax-self.fMin)/self.fStep+1 < self.iMaxItems) {
			self.iMaxItems = ZC._i_((self.fMax-self.fMin)/self.fStep)+1;
		} else if ((self.fMax-self.fMin)/(self.fStep*2)+1 < self.iMaxItems) {
			self.iMaxItems = ZC._i_((self.fMax-self.fMin)/(2*self.fStep))+1;
		}
		self.iMaxItems = ZC._max_(2, self.iMaxItems);
	},
	setupMaxTicks : function() {
		var self = this;
		if (ZC._n_(self.oData['max-ticks']) === null) {
			self.iMaxTicks = self.iMaxItems;
		}
	},
	setupValues : function(iStep) {
		var self = this, iKeyMinValue, iKeyMaxValue, i, iLen;

		if (iStep === 1) {
			
			if (self.oData['transform'] && self.oData['transform']['type'] === 'date') {
				if (ZC._n_(self.oData['transform']['uniform']) !== null && !ZC._b_(self.oData['transform']['uniform'])) {
					self.bNonLinearTs = true;
				}
			}
		}

		if (iStep === 1 && ZC._n_(self.oData['values']) !== null) {
			self.aValues = [];
			if (typeof(self.oData['values']) === 'object') {
				self.aValues = self.oData['values'];
				if (self.aLabels.length === 0) {
					self.aLabels = self.aValues;
				}
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					if (typeof(self.aValues[i]) === 'string') {
						self.bKeyAssoc = true;
						self.oParent.aKeyAssoc.push(self.aValues[i]);
					}
				}
			} else {
				var aValuesTokens = self.oData['values'].split(':');
				var fStep = self.fStep;
				if (aValuesTokens.length === 3) {
					fStep = ZC._f_(aValuesTokens[2]);
				}
				
				if (ZC._f_(aValuesTokens[0]) > ZC._f_(aValuesTokens[1])) {
					var sTmp = aValuesTokens[0];
					aValuesTokens[0] = aValuesTokens[1];
					aValuesTokens[1] = sTmp;
				}
				if (fStep <= 0) {
					fStep = 1;
				}
				if (aValuesTokens.length > 1) {
					var iDecimals = 0, iMaxDecimals = 0, iValues = 0;
					for (var v=ZC._f_(aValuesTokens[0]);v<=ZC._f_(aValuesTokens[1]);v+=fStep) {
						var aTmp = (''+v).split('.');
						iDecimals += aTmp[1]?aTmp[1].length:0;
						iMaxDecimals = ZC._max_(iMaxDecimals, aTmp[1]?aTmp[1].length:0);
						iValues++;
						if (ZC._n_(self.oData['decimals']) !== null) {
							self.aValues.push(Number(v).toFixed(ZC._i_(self.oData['decimals'])));
						} else {
							self.aValues.push(v);
						}
					}
					if (ZC._n_(self.oData['decimals']) === null) {
						iDecimals = Math.ceil(iDecimals/iValues);
						self.iDecimals = (ZC._a_(iMaxDecimals-iDecimals) <= 1)?iMaxDecimals:iDecimals;
					}
				}
			}
		}

		if (iStep === 2) {
			var iMaxNodes = 0;
			var aNonLinearValues = [];
			if (self.aValues.length === 0) {
				iKeyMinValue = ZC.MAX;
				iKeyMaxValue = -ZC.MAX;
			} else {
				iKeyMinValue = self.aValues[0];
				iKeyMaxValue = self.aValues[self.aValues.length-1];
			}
			var aPlots = self.oParent.oPlotSet.aPlots;
			var bNoKeyValues = false;
			for (i=0,iLen=aPlots.length;i<iLen;i++) {
				var aScales = aPlots[i].getScales();
				if (ZC._indexof_(aScales, self.sName) !== -1) {
					iMaxNodes = ZC._max_(iMaxNodes, aPlots[i].aPlotNodes.length);
					var bCreateScale = (aNonLinearValues.length===0);
					for (var n=0,nLen=aPlots[i].aPlotNodes.length;n<nLen;n++) {
						if (aPlots[i].aPlotNodes[n]) {
							if (aPlots[i].aPlotNodes[n].fKeyValue !== null) {
								var fNodeKeyValue = aPlots[i].aPlotNodes[n].fKeyValue;
								iKeyMinValue = ZC._min_(iKeyMinValue, fNodeKeyValue);
								iKeyMaxValue = ZC._max_(iKeyMaxValue, fNodeKeyValue);
								if (self.bNonLinearTs && bCreateScale) {
									aNonLinearValues.push(fNodeKeyValue);
								}
								self.bKeyValues = true;
								aPlots[i].bKeyValues = true;
							} else {
								bNoKeyValues = true;
							}
						} else {
							if (self.bNonLinearTs && bCreateScale) {
								aNonLinearValues.push('');
							}
						}
					}
				}
			}

			
			if (iMaxNodes > self.aValues.length && self.aValues.length > 0 && !self.bKeyValues) {
				for (i=self.aValues.length;i<iMaxNodes;i++) {
					
					
				}
			}

			if (self.aValues.length === 0) {
				if (!self.bKeyValues) {
					if (ZC._n_(self.oData['max-value']) !== null) {
						var fMinValue = 0;
						var fMaxValue = 0;
						if (ZC._n_(self.oData['min-value']) !== null) {
							fMinValue = ZC._f_(self.oData['min-value']);
						}
						fMaxValue = ZC._f_(self.oData['max-value']);
						i = 0;
						var fValue = fMinValue;

						if (self.oTransform && ZC._n_(self.oTransform.oData['type']) !== null) {
							switch (self.oTransform.oData['type']) {
								case 'date':
									self.fStep = self.parseTransformDateStep(fMinValue, fMaxValue);
									break;
							}
						}

						while (fValue < fMaxValue) {
							fValue = self.oParent.getScaleKDefaultValue(i*self.fStep + fMinValue);
							if (ZC._n_(self.aValues[i]) === null) {
								self.aValues[i] = fValue;
							}
							i++;
						}
					} else {
						for (i=0;i<iMaxNodes;i++) {
							if (ZC._n_(self.aValues[i]) === null) {
								if (ZC._n_(self.oData['min-value']) !== null) {
									self.aValues[i] = self.oParent.getScaleKDefaultValue(i*self.fStep + ZC._i_(self.oData['min-value']));
								} else {
									self.aValues[i] = self.oParent.getScaleKDefaultValue(i*self.fStep);
								}
							}
						}
					}
				} else {
					if (bNoKeyValues && iKeyMinValue > 0) {
						iKeyMinValue = 0;
					}
					if (bNoKeyValues && iKeyMaxValue < iMaxNodes-1) {
						iKeyMaxValue = iMaxNodes-1;
					}
					if (ZC._n_(self.oData['min-value']) !== null) {
						iKeyMinValue = ZC._f_(self.oData['min-value']);
					}
					if (ZC._n_(self.oData['max-value']) !== null) {
						iKeyMaxValue = ZC._f_(self.oData['max-value']);
					}

					if (iKeyMaxValue-iKeyMinValue < self.fStep && iKeyMaxValue-iKeyMinValue > 0) {
						self.fStep = iKeyMaxValue - iKeyMinValue;
					}

					if (!self.bNonLinearTs) {
						self.setupRange(iKeyMinValue, iKeyMaxValue, true);
					}
				}
			}

			if (self.bNonLinearTs && self.bKeyValues) {
				self.aValues = [].concat(aNonLinearValues);
				self.aLabels = [].concat(aNonLinearValues);
			}
		}

		if (self.bNonLinearTs) {
			self.oNonLinearIndexes = {};
			for (i=0,iLen=self.aLabels.length;i<iLen;i++) {
				self.oNonLinearIndexes[self.aLabels[i]] = i;
			}
		}

		self.iMinIndex = 0;
		self.iMaxIndex = self.aValues.length-1;
		self.iMinIndex_ = 0;
		self.iMaxIndex_ = self.aValues.length-1;

		if (self.oParent.aKeyAssoc.length > 0) {
			self.fMin = self.iMinIndex;
			self.fMax = self.iMaxIndex;
		} else {
			self.fMin = ZC._f_(self.aValues[self.iMinIndex]);
			self.fMax = ZC._f_(self.aValues[self.iMaxIndex]);
		}

		if (self.aZoomToValues) {
			var iMinIndex = ZC._indexof_(self.aValues, self.aZoomToValues[0]);
			var iMaxIndex = ZC._indexof_(self.aValues, self.aZoomToValues[1]);
			self.aZoomTo = [iMinIndex===-1?0:iMinIndex, iMaxIndex===-1?self.aValues.length-1:iMaxIndex];
		}

		var oPreserveZoom = self.oLoader.oAttributes['graph' + self.oParent.iIndex + '.zoom'];
		if (
			(ZC._n_(self.oLoader.oAttributes['preservezoom']) === null)
			||
			(self.oLoader.oAttributes['preservezoom'])
		) {
			if (typeof(oPreserveZoom) !== 'undefined' && ZC._n_(oPreserveZoom['xmin']) !== null && ZC._n_(oPreserveZoom['xmax']) !== null) {
				self.aZoomTo = [oPreserveZoom['xmin'], oPreserveZoom['xmax']];
			}
		} else {
			self.oLoader.oAttributes['graph' + self.oParent.iIndex + '.zoom'] = {};
		}

		if (self.aZoomTo) {
			self.oParent.bZoomTo = true;
		}
	},
	setupRange : function(iKeyMinValue, iKeyMaxValue, bAuto) {
		var self = this, aRangeInfo, i, iStepPower, fStep;
		if (self.oTransform && ZC._n_(self.oTransform.oData['type']) !== null) {
			switch (self.oTransform.oData['type']) {
				case 'date':
					var iStep = self.parseTransformDateStep(iKeyMinValue, iKeyMaxValue);
					if ((iKeyMaxValue-iKeyMinValue)%iStep !== 0) {
						iKeyMaxValue += (iStep-(iKeyMaxValue-iKeyMinValue)%iStep);
					}
					aRangeInfo = [iKeyMinValue, iKeyMaxValue, iStep, 1, iStep];
					break;
			}
		} else {
			var bForcedAttrs = (ZC._n_(self.oData['step']) !== null || ZC._n_(self.oData['min-value']) !== null || ZC._n_(self.oData['max-value']) !== null);
			aRangeInfo = ZC.ZCMath._range_lin_(iKeyMinValue, iKeyMaxValue, self.fStep, self.fScaleFactor, bForcedAttrs);
		}

		if (self.fStep_ === -1) {
			self.fStep_ = aRangeInfo[4];
		}

		var fMinValue_ = aRangeInfo[0];
		var fMaxValue_ = aRangeInfo[1];
		fStep = aRangeInfo[2];

		
		if (ZC._n_(self.oData['step']) === null && (fMaxValue_-fMinValue_)/fStep > 10000) {
			fStep = (fMaxValue_-fMinValue_)/10000;
			iStepPower = Math.ceil(ZC._log_(fStep)/Math.LN10);
			fStep = Math.pow(10, iStepPower);
		}

		if (ZC._n_(self.oData['min-value']) === null) {
			fMinValue_ = fMinValue_ - fMinValue_%fStep;
		}
		if (ZC._n_(self.oData['max-value']) === null) {
			fMaxValue_ = fMaxValue_ - fMaxValue_%fStep + (fMaxValue_%fStep===0?0:fStep);
		}

		iStepPower = Math.floor(ZC._log_(fStep)/Math.LN10);
		var iPower = aRangeInfo[3];
		if (iStepPower < iPower && iStepPower < 0) {
			iPower = iStepPower;
		}
		self.aValues = [];
		if (bAuto) {
			self.fMin_ = iKeyMinValue;
			self.fMax_ = iKeyMaxValue;
			self.iTicksAuto = ZC._i_((fMaxValue_ - fMinValue_)/fStep);
			if (fMinValue_ === fMaxValue_) {
				fMinValue_ -= fStep;
				fMaxValue_ += fStep;
			}
			if (iPower > 0) {
				for (i=fMinValue_;i<=fMaxValue_;i+=fStep) {
					self.aValues.push(i);
				}
			} else {
				i = ZC._f_(fMinValue_.toFixed(-iPower));
				while (i <= ZC._f_(fMaxValue_.toFixed(-iPower))) {
					self.aValues.push(i);
					i = ZC._f_((i+fStep).toFixed(-iPower));
				}
			}
		} else {
			fStep = ZC._f_((iKeyMaxValue - iKeyMinValue)/self.iTicksAuto);
			for (i=0;i<=self.iTicksAuto;i++) {
				var fValue = iKeyMinValue + fStep*i;
				if (iPower < 0) {
					fValue = ZC._f_(fValue.toFixed(-iPower));
				}
				self.aValues.push(fValue);
			}
		}
		self.iMinIndex = 0;
		self.iMaxIndex = self.aValues.length-1;
		self.iMinIndex_ = 0;
		self.iMaxIndex_ = self.aValues.length-1;
		self.fMin = ZC._f_(self.aValues[self.iMinIndex]);
		self.fMax = ZC._f_(self.aValues[self.iMaxIndex]);
	},
	parseTransformDateStep : function(iKeyMinValue, iKeyMaxValue, bForce) {
		var self = this;
		if (typeof(bForce) === 'undefined') {
			bForce = false;
		}
		var iDiff = iKeyMaxValue - iKeyMinValue;
		var iPower = Math.floor(ZC._log_(iDiff)/Math.LN10);
		var iStep = 1000;
		if (ZC._n_(self.oData['step']) !== null && !bForce) {
			iStep = self.fStep;
		} else {
			if (iPower <= 3) {
				iStep = 1;
			} else if (iPower === 4) {
				iStep = 1000;
			} else if (iPower === 5) {
				iStep = 1000*10;
			} else if (iPower === 6) {
				iStep = 1000*60;
			} else if (iPower === 7) {
				iStep = 1000*60*10;
			} else if (iPower === 8) {
				iStep = 1000*60*60;
			} else if (iPower === 9) {
				iStep = 1000*60*60*6;
			} else if (iPower === 10) {
				iStep = 1000*60*60*24;
			} else if (iPower === 11) {
				iStep = 1000*60*60*24*10;
			} else {
				iStep = 1000*60*60*24*30;
			}
		}
		
		
		return iStep;
	},
	parse : function() {
		this._super();
	},
	clear : function() {
		this._super();
	},
	build : function() {
		this._super();
	},
	paint : function() {
		this._super();
		
		if (ZC._n_(this.oData['values']) !== null) {
			this.bUsed = true;
		}
	}
});










ZC.ZCScaleV = ZC.ZCScale.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sType = 'v';
		self.iMinIndex = -1;
		self.iMaxIndex = -1;
		self.iTicksAuto = 0;
		self.iDecimals = null;
		self.sStackType = 'normal';
	},
	zoomTo : function(fMin, fMax) {
		var self = this;
		if (ZC._n_(fMin) !== null) {
			self.fMin = fMin;
		} else {
			self.fMin = self.fMin_;
		}
		if (ZC._n_(fMax) !== null) {
			self.fMax = fMax;
		} else {
			self.fMax = self.fMax_;
		}
		self.setupRange(self.fMin, self.fMax, false);

		
		if (!self.oLoader.oZoom.oGraph) { self.oLoader.oZoom.oGraph = self.oParent; }
		if (self.oParent.oZoom && ZC._n_(self.oParent.oZoom.oData['shared']) !== null && ZC._b_(self.oParent.oZoom.oData['shared']) && self.oParent.sId === self.oLoader.oZoom.oGraph.sId) {
			for (var i=0,iLen=self.oLoader.aGraphs.length;i<iLen;i++) {
				var oGraph = self.oLoader.aGraphs[i];
				if (oGraph.sId !== self.oParent.sId) {
					if (ZC._n_(oGraph.oZoom.oData['shared']) !== null && ZC._b_(oGraph.oZoom.oData['shared'])) {
						var oScale = oGraph.getScaleByName(self.sName);
						if (oScale) {
							oScale.zoomTo(fMin, fMax);
							oGraph.clear(true);
							oGraph.oAttributes['shared-zoom'] = true;
							oGraph.paint();
							if (oGraph.oPreview) {
								oGraph.oPreview.update(null, null, fMin, fMax, true);
							}
						}
					}
				}
			}
		}
	},
	getParsedItemLabel : function(iIndex, sLabel, oExtraFormat) {
		var self = this;
		if (typeof(sLabel) === 'undefined') {
			sLabel = '';
			if (ZC._n_(self.aLabels[iIndex]) !== null) {
				sLabel = self.aLabels[iIndex];
			} else {
				sLabel = self.aValues[iIndex];
			}
		}

		if (typeof(sLabel) === 'number') {
			if (ZC._n_(self.oParent.aValAssoc[sLabel]) !== null) {
				sLabel = self.oParent.aValAssoc[sLabel];
			}
		}

		var bNegative = ZC._isnumber_(sLabel) && ZC._f_(sLabel) < 0;

		var oFormat = self.setupFormat();
		ZC._cp_(oExtraFormat, oFormat);

		if (bNegative && oFormat['negation'] === 'currency') {
			sLabel = ZC._a_(ZC._f_(sLabel));
		}

		oFormat['utc'] = self.oParent.bUTC;
		oFormat['timezone'] = self.oParent.iTimeZone;

		sLabel = ZC.ZCUtils._format_(sLabel, oFormat, self, true);

		if (self.sFormat) {
			if (self.sFormat.substring(self.sFormat.length-2) === '()' || self.sFormat.substring(0, 11) === 'javascript:') {
				try {
					var sCall = self.sFormat.replace('javascript:', '').replace('()', '');
					if (eval(sCall)) {
						sLabel = eval(sCall).call(self, sLabel);
					}
				} catch (e) {}
			} else {
				if (bNegative && oFormat['negation'] === 'currency') {
					sLabel = '-' + self.sFormat.replace(/%v|%scale-value/g, sLabel);
				} else {
					sLabel = self.sFormat.replace(/%v|%scale-value/g, sLabel);
				}
			}
		}
		return sLabel;
	},
	setupMaxItems : function() {
		var self = this;
		var iItems = ZC._max_(self.aValues.length, self.aLabels.length);
		var iAvgWidth = 10*ZC._max_(self.aValues.join('').length, self.aLabels.join('').length)/iItems;
		if (self.bInversed) {
			self.iMaxItems = ZC._i_((self.iWidth-self.iOffsetStart-self.iOffsetEnd)/iAvgWidth);
		} else {
			self.iMaxItems = ZC._i_((self.iHeight-self.iOffsetStart-self.iOffsetEnd)/20);
		}
		self.iMaxItems = ZC._max_(2, self.iMaxItems);
	},
	setupMaxTicks : function() {
		var self = this;
		if (ZC._n_(self.oData['max-ticks']) === null) {
			self.iMaxTicks = self.iMaxItems;
		}
	},
	setupValues : function(iStep) {
		var self = this, mValue, i, iLen, aTmp, fMinValue, fMaxValue, fStep;
		if (iStep === 1) {
			
			if (ZC._n_(self.oData['values']) === null && (ZC._n_(mValue=self.oParent.setupScaleValues('v')) !== null)) {
				self.oData['values'] = mValue;
			}
		}
		var aVA = self.oParent.aValAssoc;
		if (iStep === 1 && ZC._n_(self.oData['values']) !== null) {			
			self.aValues = [];

			if (typeof(self.oData['values']) === 'object') {
				
				var aValues = self.oData['values'];
				var fMin = ZC._min_a_(aValues);
				var fMax = ZC._max_a_(aValues);
				var bFixedStep = true;
				for (i=0,iLen=aValues.length-2;i<iLen;i++) {
					if (
						(typeof(aValues[i+2]) === 'number' && typeof(aValues[i+1]) === 'number' && typeof(aValues[i]) === 'number')
						&&
						((ZC._f_(aValues[i+2]) - ZC._f_(aValues[i+1])) !== (ZC._f_(aValues[i+1]) - ZC._f_(aValues[i])))
					) {
						bFixedStep = false;
						break;
					}
				}
				if (!bFixedStep) {
					
					self.oData['values'] = fMin + ':' + fMax;
					if (!self.aShowLabels) {
						self.aShowLabels = [];
						for (i=0,iLen=aValues.length;i<iLen;i++) {
							self.aShowLabels.push(''+aValues[i]);
						}
					}
				}
			}

			if (typeof(self.oData['values']) === 'object') {
				ZC._cpa_(self.oData['values'], self.aValues);
				if (self.aLabels.length === 0) {
					ZC._cpa_(self.aLabels, self.aValues);
				}
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					if (typeof(self.aValues[i]) === 'string') {
						var sLabel = self.aValues[i];
						var iAssoc = ZC._indexof_(aVA, self.aValues[i]);
						if (iAssoc === -1) {
							aVA.push(self.aValues[i]);
							self.aValues[i] = aVA.length-1;
						} else {
							self.aValues[i] = iAssoc;
						}
						if (ZC._n_(self.aLabels[i]) === null) {
							self.aLabels[i] = sLabel;
						}
					}
				}
			} else {
				var aValuesTokens = self.oData['values'].split(':');
				fStep = 1;
				if (aValuesTokens.length === 3) {
					fStep = ZC._f_(aValuesTokens[2]);
				}
				
				if (ZC._f_(aValuesTokens[0]) > ZC._f_(aValuesTokens[1])) {
					var sTmp = aValuesTokens[0];
					aValuesTokens[0] = aValuesTokens[1];
					aValuesTokens[1] = sTmp;
				}
				if (fStep <= 0) {
					fStep = 1;
				}
				if (aValuesTokens.length > 1) {
					var iDecimals = 0, iMaxDecimals = 0, iValues = 0;
					var aStepTmp = (''+fStep).split('.');
					for (var v=ZC._f_(aValuesTokens[0]);v<=ZC._f_(aValuesTokens[1]);v+=fStep) {
						aTmp = (''+v).split('.');
						if (aStepTmp.length > 1 && aTmp.length > 1 && aStepTmp[1].length > 0 && aTmp[1].length/aStepTmp[1].length > 5) {
							
							iDecimals += aStepTmp[1];
							iMaxDecimals = ZC._max_(iMaxDecimals, aStepTmp[1].length);
							iValues++;
							
							self.aValues.push(ZC._f_(ZC._fixed_(Number(v), aStepTmp[1].length)));
						} else {
							iDecimals += aTmp[1]?aTmp[1].length:0;
							iMaxDecimals = ZC._max_(iMaxDecimals, aTmp[1]?aTmp[1].length:0);
							iValues++;
							self.aValues.push(v);
						}
					}
					
					if (v-ZC._f_(aValuesTokens[1]) !== 0) {
						if (ZC._a_(v-ZC._f_(aValuesTokens[1]))/fStep < 0.00000001) {
							self.aValues.push(ZC._f_(aValuesTokens[1]));
						}
					}

					if (ZC._n_(self.oData['decimals']) === null) {
						
						aTmp = (''+fStep).split('.');
						if (aTmp[1]) {
							iDecimals = aTmp[1].length;
						} else {
							iDecimals = Math.ceil(iDecimals/iValues);
						}
						self.iDecimals = (ZC._a_(iMaxDecimals-iDecimals) <= 1)?iMaxDecimals:iDecimals;
					}
				}
			}
			self.iMinIndex = 0;
			self.iMaxIndex = self.aValues.length-1;
			self.fStep = fStep;
			if (aVA.length > 1) {
				self.fMin = ZC._min_a_(self.aValues);
				self.fMax = ZC._max_a_(self.aValues);
			} else {
				self.fMin = self.aValues[0];
				self.fMax = self.aValues[self.aValues.length-1];
			}
		}
		if (iStep === 2) {
			var oStacks = {};
			if (ZC._n_(self.oData['values']) === null) {
				self.aValues = [];
				fMinValue = ZC.MAX;
				fMaxValue = -ZC.MAX;
			}
			var aMinMaxSet = [];
			var aPlots = self.oParent.oPlotSet.aPlots;
			for (i=0,iLen=aPlots.length;i<iLen;i++) {
				if (self.oParent.oAttributes['plot'+i+'.visible'] || self.oParent.getToggleAction() === 'hide') {
					var aScales = aPlots[i].getScales();
					if (ZC._indexof_(aScales, self.sName) !== -1) {
						var bNegativeStacks = (ZC._indexof_(['vbar', 'hbar', 'vbar3d', 'hbar3d'], aPlots[i].sType) !== -1);
						for (var j=0,jLen=aPlots[i].aValues.length;j<jLen;j++) {
							if (aPlots[i].aPlotNodes[j]) {
								var j_ = (aPlots[i].aPlotNodes[j].fKeyValue===null)?j:aPlots[i].aPlotNodes[j].fKeyValue;

								var fOffsetValue = (aPlots[i].aOffsetValues && ZC._n_(aPlots[i].aOffsetValues[j]) !== null)?ZC._f_(aPlots[i].aOffsetValues[j]):0;
								if (aPlots[i].bStacked) {
									if (ZC._n_(oStacks[aPlots[i].iStack]) === null) {
										oStacks[aPlots[i].iStack] = [];
									}
									if (ZC._n_(oStacks[aPlots[i].iStack][j_]) === null) {
										if (aPlots[i].aPlotNodes[j].fValue >= 0 || !bNegativeStacks) {
											oStacks[aPlots[i].iStack][j_] = [aPlots[i].aPlotNodes[j].fValue, 0];
										} else {
											oStacks[aPlots[i].iStack][j_] = [0, aPlots[i].aPlotNodes[j].fValue];
										}
									} else {
										if (aPlots[i].aPlotNodes[j].fValue >= 0 || !bNegativeStacks) {
											oStacks[aPlots[i].iStack][j_][0] += aPlots[i].aPlotNodes[j].fValue;
										} else {
											oStacks[aPlots[i].iStack][j_][1] += aPlots[i].aPlotNodes[j].fValue;
										}
									}
									if (aPlots[i].aPlotNodes[j].fValue >= 0 || !bNegativeStacks) {
										aPlots[i].aPlotNodes[j].fAbsoluteValue = oStacks[aPlots[i].iStack][j_][0];
									} else {
										aPlots[i].aPlotNodes[j].fAbsoluteValue = oStacks[aPlots[i].iStack][j_][1];
									}
									if (ZC._n_(self.oData['values']) === null) {
										aMinMaxSet.push(oStacks[aPlots[i].iStack][j_][0]+fOffsetValue, oStacks[aPlots[i].iStack][j_][1]+fOffsetValue);
									}
								} else {
									if (ZC._n_(self.oData['values']) === null) {
										aMinMaxSet.push(aPlots[i].aPlotNodes[j].fValue+fOffsetValue);
										if (fOffsetValue !== 0) {
											aMinMaxSet.push(fOffsetValue);
										}
										for (var e=0,eLen=aPlots[i].aPlotNodes[j].aExtraValues.length;e<eLen;e++) {
											aMinMaxSet.push(aPlots[i].aPlotNodes[j].aExtraValues[e]+fOffsetValue);
										}
									}
								}
							}
						}
					}
				}
			}

			if (aMinMaxSet.length > 0) {
				fMinValue = ZC._min_a_(aMinMaxSet);
				fMaxValue = ZC._max_a_(aMinMaxSet);
			}

			
			if (self.aValues.length === 0 && (fMinValue === Number.MAX_VALUE || fMaxValue === Number.MIN_VALUE)) {
				self.aValues = [0, 1];
				fMinValue = 0;
				fMaxValue = 1;
			}

			if (ZC._n_(self.oData['values']) === null) {
				if (ZC._n_(self.oData['min-value']) !== null && self.oData['min-value'] !== 'auto') {
					fMinValue = ZC._f_(self.oData['min-value']);
				} else {
					if (fMinValue > 0 && self.oData['min-value'] !== 'auto') {
						if (self.sProgression !== 'log') {
							fMinValue = 0;
						}
					}
				}
				if (ZC._n_(self.oData['max-value']) !== null) {
					fMaxValue = ZC._f_(self.oData['max-value']);
				}
				if (fMinValue === ZC.MAX && fMaxValue === -ZC.MAX) {
					self.iMinIndex = 0;
					self.iMaxIndex = 0;
					self.fMin = 0;
					self.fMax = 0;
				} else {
					self.setupRange(fMinValue, fMaxValue, true);
				}
			}
		}

		if (iStep === 2) {
			if (self.fMin_ === -1 && self.fMax_ === -1) {
				self.fMin_ = self.fMin;
				self.fMax_ = self.fMax;
			}
			if (self.fStep_ === -1) {
				self.fStep_ = self.fStep;
			}
		}

		if (self.iTicksAuto === 0) {
			self.iTicksAuto = ZC._i_((self.fMax - self.fMin)/self.fStep);
		}

		var oPreserveZoom = self.oLoader.oAttributes['graph' + self.oParent.iIndex + '.zoom'];
		if (
			(ZC._n_(self.oLoader.oAttributes['preservezoom']) === null)
			||
			(self.oLoader.oAttributes['preservezoom'])
		) {
			var sPostfix = (self.iIndex===1)?'':('-'+self.iIndex);
			if (typeof(oPreserveZoom) !== 'undefined' && ZC._n_(oPreserveZoom['ymin'+sPostfix]) !== null && ZC._n_(oPreserveZoom['ymax'+sPostfix]) !== null) {
				self.aZoomTo = [oPreserveZoom['ymin'+sPostfix], oPreserveZoom['ymax'+sPostfix]];
			}
		} else {
			self.oLoader.oAttributes['graph' + self.oParent.iIndex + '.zoom'] = {};
		}

		if (self.aZoomTo) {
			self.oParent.bZoomTo = true;
		}
	},
	setupRange : function(fMinValue, fMaxValue, bAuto) {
		var self = this, fStep, iPowerStep;
		var fMinValue__ = fMinValue, fMaxValue__ = fMaxValue;
		if (self.oParent.aValAssoc.length > 1) {
			fMinValue = 0;
		}
		if (bAuto && self.sProgression === 'log') {
			fMinValue = ZC._log_(fMinValue);
			fMaxValue = ZC._log_(fMaxValue);
		}

		var bForcedAttrs = (self.oData['step'] !== null || self.oData['min-value'] !== null || self.oData['max-value'] !== null);
		var aRangeInfo = ZC.ZCMath._range_lin_(fMinValue, fMaxValue, (self.sProgression==='lin')?self.oData['step']:null, self.fScaleFactor, bForcedAttrs);

		var fMinValue_ = aRangeInfo[0];
		var fMaxValue_ = aRangeInfo[1];
		fStep = aRangeInfo[2];
		var iPower = aRangeInfo[3];
		if (ZC._n_(self.oData['step']) !== null) {
			fStep = self.fStep;
		}
		self.aValues = [];
		if (bAuto) {
			if (fMaxValue_ === fMinValue_) {
				fMaxValue_ += fStep;
				fMinValue_ -= fStep;
			} else if (fMaxValue - fMinValue === fStep) {
				fStep = fStep/2;
			}
			fMinValue = fMinValue_;
			fMaxValue = fMaxValue_;
			if (ZC._n_(self.oData['decimals']) === null) {
				iPowerStep = Math.floor(ZC._log_(fStep)/Math.LN10);
				if (iPowerStep < 0) {
					self.iDecimals = ZC._a_(iPowerStep);
				}
			}
			self.iTicksAuto = ZC._i_((fMaxValue - fMinValue)/fStep);
		} else {
			if (self.iTicksAuto === 0) {
				self.iTicksAuto = 10;
			}

			fStep = ZC._f_((fMaxValue - fMinValue)/self.iTicksAuto);
			if (ZC._n_(self.oData['decimals']) === null) {
				iPowerStep = Math.floor(ZC._log_(fStep)/Math.LN10);
				if (!isFinite(iPowerStep)) {
					iPowerStep = 1;
				}
				if (iPowerStep < 0) {
					self.iDecimals = ZC._a_(iPowerStep);
				}
			}
		}

		if (self.bFixedStep) {
			fStep = ZC._f_(self.oData['step']);
			if (fStep <= 0) {
				fStep = (fMaxValue-fMinValue)/10;
			}
			fMinValue = fStep*Math.floor(fMinValue/fStep);
			fMaxValue = fStep*Math.ceil(fMaxValue/fStep);
			self.iTicksAuto = (fMaxValue-fMinValue)/fStep;
		}

		for (var i=0;i<=self.iTicksAuto;i++) {
			var fValue = fMinValue + fStep*i;
			
			fValue = ZC._f_(ZC._fixed_(fValue, ZC._max_(-iPower, self.iDecimals)));
			if (self.sProgression === 'log') {
				
				fValue = ZC._f_(ZC._fixed_(Math.pow(self.fLogBase, fValue), ZC._max_(-iPower, self.iDecimals)));
			}
			self.aValues.push(fValue);
		}
		
		if (self.sProgression === 'log' && zingchart.DEV.TRUELOG) {
			if (ZC._n_(self.oData['decimals']) === null) {
				self.iDecimals = null;
			}
			var iPowerMin = Math.floor(fMinValue/Math.LN10);
			var iPowerMaxLow = Math.floor(fMaxValue/Math.LN10);
			var iPowerMaxHigh = Math.ceil(fMaxValue/Math.LN10);
			var iPowerMax = (fMaxValue__ > Math.pow(10, iPowerMaxLow))?iPowerMaxHigh:iPowerMaxLow;
			if (iPowerMax === iPowerMin) {
				iPowerMax++;
			}
			self.aValues = [];
			for (var p=iPowerMin;p<=iPowerMax;p+=1) {
				self.aValues.push(Math.pow(10, p));
			}
			
			if (self.aValues.length > 2 && fMinValue__ >= self.aValues[1]) {
				self.aValues.splice(0, 1);
			}

			fStep = Math.LN10/10;
			fMinValue = ZC._log_(self.aValues[0]);
			fMaxValue = ZC._log_(self.aValues[self.aValues.length-1]);
		}

		
		self.fStep = fStep;

		self.iMinIndex = 0;
		self.iMaxIndex = self.aValues.length-1;
		self.fMin = fMinValue;
		self.fMax = fMaxValue;
	},
	parse : function() {
		var self = this;
		self.assign_a([
			['stack-type', 'sStackType']
		]);
		
		if ((self.oParent.bStacked && self.oParent.sStackType === '100%') || self.sStackType === '100%') {
			if (ZC._n_(self.oData['values']) === null) {
				self.oData['values'] = '0:100:20';
				self.oData['format'] = '%v%';
			}
		}
		this._super();
	},
	clear : function() {
		this._super();
	},
	build : function() {
		this._super();
	},
	paint : function() {
		this._super();
		
		if (ZC._n_(this.oAttributes['decimals']) === null) {
			this.oAttributes['decimals'] = (ZC._n_(this.iDecimals)!==null?this.iDecimals:0);
		}
		
		if (ZC._n_(this.oData['values']) !== null) {
			this.bUsed = true;
		}
	}
});











ZC.ZCScaleX = ZC.ZCScaleK.extend({
	init : function(oParent) {
		this._super(oParent);
	},
	parse : function() {
		this._super();
	},
	setupStepSize : function() {
		var self = this;
		if (self.iMaxIndex === self.iMinIndex) {
			self.iStepSize = self.iWidth-self.iOffsetStart-self.iOffsetEnd;
		} else {
			self.iStepSize = (self.iWidth-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
		}
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		self.setupStepSize();
	},
	zoomTo : function(iMinIndex, iMaxIndex) {
		var self = this;
		self._super(iMinIndex, iMaxIndex);
		self.setupStepSize();
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	getValueByCoord : function(iX) {
		var self = this, fRatio;
		if (self.bMirrored) {
			fRatio = (self.iX+self.iWidth-self.iOffsetStart-iX)/(self.iWidth-self.iOffsetStart-self.iOffsetEnd);
		} else {
			fRatio = (iX-self.iX-self.iOffsetStart)/(self.iWidth-self.iOffsetStart-self.iOffsetEnd);
		}
		var fValue = self.fMin + ZC._f_((self.fMax-self.fMin)*fRatio);
		return fValue;
	},
	getIndexByCoord : function(iX, oPlot, bPos) {
		var self = this, mValue, iIndex, fRatio;
		if (typeof(bPos) === 'undefined') {
			bPos = false;
		}
		if (self.bMirrored) {
			fRatio = (self.iX+self.iWidth-iX-self.iOffsetStart - (self.bRanged?self.iStepSize/2:0))/(self.iWidth-self.iOffsetStart-self.iOffsetEnd - (self.bRanged?self.iStepSize:0));
		} else {
			fRatio = (iX-self.iX-self.iOffsetStart - (self.bRanged?self.iStepSize/2:0))/(self.iWidth-self.iOffsetStart-self.iOffsetEnd - (self.bRanged?self.iStepSize:0));
		}
		
		var bCorrectKV = false;
		if (oPlot) {
			for (var iKeyValue in oPlot.oKeyPlotAssoc) {
				bCorrectKV = true;
				break;
			}
		}
		if (oPlot && !self.bNonLinearTs && bCorrectKV) {
			var iMinValue = self.aValues[self.iMinIndex];
			if (typeof(iMinValue) === 'string') {
				iMinValue = ZC._indexof_(self.oParent.aKeyAssoc, iMinValue);
			}
			var iMaxValue = self.aValues[self.iMaxIndex];
			if (typeof(iMaxValue) === 'string') {
				iMaxValue = ZC._indexof_(self.oParent.aKeyAssoc, iMaxValue);
			}
			var iValue = iMinValue + ZC._i_((iMaxValue-iMinValue)*fRatio);
			var iMinDiff = ZC.MAX;
			iIndex = null;
			for (var iKeyValue in oPlot.oKeyPlotAssoc) {
				if (ZC._a_(iKeyValue-iValue) < iMinDiff) {
					iMinDiff = ZC._a_(iKeyValue-iValue);
					iIndex = oPlot.oKeyPlotAssoc[iKeyValue];
				}
			}
			if (ZC._n_(iIndex) === null) {
				iIndex = iValue;
			}
			
			var bExact = false;
			if (self.oParent.oCrosshairX && self.oParent.oCrosshairX.oData['exact']) {
				bExact = true;
			}
			if (
				(!bExact && iMinDiff > oPlot.fMaxKeyDiff)
				||
				(bExact && iMinDiff >= self.fStep)
			) {
				return null;
			}
			return iIndex;
		} else {
			var iMinIndex = self.iMinIndex, iMaxIndex = self.iMaxIndex;
			if (self.bKeyValues) {
				if (ZC._n_(mValue=self.aValues[iMinIndex]) !== null) {
					iMinIndex = mValue;
				}
				if (ZC._n_(mValue=self.aValues[iMaxIndex]) !== null) {
					iMaxIndex = mValue;
				}
			}
			if (bPos) {
				if (self.bRanged) {
					iIndex = iMinIndex + (iMaxIndex-iMinIndex+1)*fRatio;
				} else {
					iIndex = iMinIndex + (iMaxIndex-iMinIndex)*fRatio;
				}
			} else {
				if (self.bRanged) {
					iIndex = self.iMinIndex + Math.floor((self.iMaxIndex-self.iMinIndex+1)*fRatio);
				} else {
					iIndex = self.iMinIndex + ZC._i_((self.iMaxIndex-self.iMinIndex)*fRatio);
				}
			}
		}
		iIndex = ZC._max_(0, iIndex);
		iIndex = ZC._min_(self.iMaxIndex_, iIndex);
		return iIndex;
	},
	getCoordByIndex : function(iIndex) {
		var self = this;
		var iMinIndex = self.iMinIndex, iMaxIndex = self.iMaxIndex;
		if (self.bKeyValues && !self.bNonLinearTs) {
			iMinIndex = self.fMin;
			iMaxIndex = self.fMax;
		}
		if (self.bMirrored) {
			return self.iX + self.iWidth - self.iOffsetStart - (iIndex-self.iMinIndex+(self.bRanged?1:0))*self.iStepSize + (self.bRanged?self.iStepSize/2:0);
		} else {
			return self.iX + self.iOffsetStart + (iIndex-self.iMinIndex)*self.iStepSize + (self.bRanged?self.iStepSize/2:0);
		}
	},
	getCoordByValue : function(fValue) {
		var self = this, mValue, fRatio, fRange;
		if (self.bNonLinearTs) {
			var iIndex = self.oNonLinearIndexes[fValue];
			return self.getCoordByIndex(iIndex);
		}
		if ((mValue=ZC._indexof_(self.oParent.aKeyAssoc, fValue)) !== -1) {
			return self.getCoordByIndex(mValue);
		}
		if (!self.bKeyAssoc && (self.bKeyValues || (self.oTransform && self.oTransform.oData['type'] === 'date'))) {
			fRange = self.aValues[self.iMaxIndex] - self.aValues[self.iMinIndex];
			fRatio = (self.iWidth - self.iOffsetStart - self.iOffsetEnd - (self.bRanged?self.iStepSize:0))/fRange;
			if (self.bMirrored) {
				return self.iX + self.iWidth - self.iOffsetStart - (fValue-self.aValues[self.iMinIndex])*fRatio - (self.bRanged?self.iStepSize/2:0);
			} else {
				return self.iX + self.iOffsetStart + (fValue-self.aValues[self.iMinIndex])*fRatio + (self.bRanged?self.iStepSize/2:0);
			}
		} else {
			if (self.fMax === self.fMin) {
				fRatio = 0;
			} else {
				fRange = self.fMax - self.fMin + (self.bRanged?1:0);
				fRatio = (self.iWidth - self.iOffsetStart - self.iOffsetEnd)/fRange;
			}
			if (self.bMirrored) {
				return self.iX + self.iWidth - self.iOffsetStart - (fValue-self.fMin)*fRatio - (self.bRanged?self.iStepSize/2:0);
			} else {
				return self.iX + self.iOffsetStart + (fValue-self.fMin)*fRatio + (self.bRanged?self.iStepSize/2:0);
			}
		}
	},
	paint : function() {
		var self = this, mValue, i, iLen, j, iY, oCanvas, oCanvasGuides, oCtx, oCtxGuides, iScaleSpacer, aPoints, i0, iX_, oCopy, oFace, oBox, iItemIdx;

		self._super();

		
		if (ZC._n_(self.oParent.oParent.oAttributes[self.sName + '-feed-offset-start']) !== null) {
			self.iOffsetStart = self.oParent.oParent.oAttributes[self.sName + '-feed-offset-start'];
		}

		
		if ((self.oParent.sType === 'bubble' || self.oParent.sType === 'scatter')) {
			
			if ((self.iOffsetStart === -1 && self.iOffsetEnd === -1) || self.aValues.length === 1) {
				self.iOffsetStart = self.iOffsetEnd = self.iWidth/(self.aValues.length+1);
				self.setupStepSize();
			}
		}

		var sPlotColor = self.getPlotColor();

		var iXScales = 0, iCntD = 1, iCntO = 1, oIndexes = {};
		for (i=0,iLen=self.oParent.aScales.length;i<iLen;i++) {
			if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-x' && self.oParent.aScales[i].sPlacement === self.sPlacement) {
				iXScales++;
			}
			if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-x') {
				if (self.oParent.aScales[i].sPlacement === 'default') {
					oIndexes[self.oParent.aScales[i].sName] = iCntD;
					iCntD++;
				} else {
					oIndexes[self.oParent.aScales[i].sName] = iCntO;
					iCntO++;
				}
			}
		}
		var iScaleIndex = oIndexes[self.sName], bDefault = (self.sPlacement === 'default');

		var iYRef = null;
		var oPlotRef = null;
		for (i=0,iLen=self.oParent.oPlotSet.aPlots.length;i<iLen;i++) {
			var oPlot = self.oParent.oPlotSet.aPlots[i];
			var aPlotScales = oPlot.getScales();
			if (ZC._indexof_(aPlotScales, self.sName) !== -1) {
				var oScalePair = self.oParent.getScaleByName(oPlot.getScales('v')[0]);
				iYRef = oScalePair.getCoordByValue(oScalePair.fRefValue);
				oPlotRef = oPlot;
				break;
			}
		}

		var iTickSize = 8;
		if (ZC._n_(self.oTick.oData['size']) !== null) {
			iTickSize = ZC._i_(self.oTick.oData['size']);
		}
		var iMinorTickSize = 4;
		if (ZC._n_(self.oMinorTick.oData['size']) !== null) {
			iMinorTickSize = ZC._i_(self.oMinorTick.oData['size']);
		}

		var iDist = ZC._i_(self.oParent.oAttributes[self.sName + '-distance'] || -1);
		if (self.sPlacement === 'default') {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginBottom/iXScales);
			iY = self.iY + self.iHeight + (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iY = self.iY + self.iHeight + iDist;
			}
		} else {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginTop/iXScales);
			iY = self.iY - (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iY = self.iY - iDist;
			}
		}

		var iYLine = iY;
		
		if (self.oParent.oScrollX) {
			self.oParent.oScrollX.bVisible = true;
			if (self.iMinIndex_ === self.iMinIndex && self.iMaxIndex_ === self.iMaxIndex) {
				self.oParent.oScrollX.bVisible = false;
			}
			if (self.oParent.oScrollX.bVisible && self.oParent.oScrollX.oBarStyle.iOffsetY === 0) {
				iY += self.oParent.oScrollX.oBarStyle.iHeight + self.iLineWidth/2;
			}
		}
		self.oAttributes['iY'] = iY;

		if (!self.bVisible || !self.bUsed) {
			return;
		}

		var iTicksStep = ZC._max_(1, Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxTicks-1)));
		var iLabelsStep = ZC._max_(1, Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxItems-1)));

		
		if (ZC._b_(self.oData['normalize'])) {
			iTicksStep = ZC.ZCMath._round_step_(iTicksStep);
			iLabelsStep = ZC.ZCMath._round_step_(iLabelsStep);
		}

		var iScaleLabelOffset = 0;
		var iMinorStepSize = self.iStepSize*iTicksStep/(self.iMinorTicks+1);
		var iScaleMinX = self.bMirrored?(self.iX+self.iOffsetEnd):(self.iX+self.iOffsetStart);
		var iScaleMaxX = self.bMirrored?(self.iX+self.iWidth-self.iOffsetStart):(self.iX+self.iWidth-self.iOffsetEnd);

		if (ZC._n_(iYRef) === null) {
			iYRef = iY;
		}

		oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
		oCtx = ZC.ZCHtmlUtils._context_(oCanvas, self.oLoader.sOutput);
		oCanvasGuides = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
		oCtxGuides = ZC.ZCHtmlUtils._context_(oCanvasGuides, self.oLoader.sOutput);
		

		if (self.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
			self.sLineColor = sPlotColor;
		}
		if (self.oParent.oSettings['3d']) {
			oFace = ZC.ZCMath3D._create_3d_face_(self, self.oParent, self.iX - ZC.ZCDraw3D.iViewX, self.iX - ZC.ZCDraw3D.iViewX + self.iWidth, iY - ZC.ZCDraw3D.iViewY, iY - ZC.ZCDraw3D.iViewY, 0-1, ZC.ZCDraw3D.iDepth+1, 'x');
			oFace.sId = self.sId + '-line';
			if (self.oParent.o3DAspect['true3d']) {
				if (self.oParent.o3DAspect['x-angle'] > 0) {
					oFace.aPriorities = [self.iIndex===1?-100:100, 1, 1];
				} else {
					oFace.aPriorities = [self.iIndex===1?100:-100, 1, 1];
				}
			}
			self.oParent.oEngine3D.add(oFace);
		} else {
			aPoints = [
				[self.iX, iYLine],
				[self.iX + self.iWidth, iYLine]
			];
			var sId_ = self.sId;
			self.sId += '-line';
			ZC.ZCLine.paint(oCtx, self, aPoints);
			self.sId = sId_;
		}

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%c)|(%scale-position)/g, self._iCnt);
			sRule = sRule.replace(/(%i)|(%scale-index)/g, self._iIdx);
			sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[self._iIdx]) !== null)?self.aValues[self._iIdx]:'');
			sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[self._iIdx]) !== null)?self.aLabels[self._iIdx]:'');
			sRule = sRule.replace(/%scale-day-of-week/g, ZC.ZCUtils._date_(self.aValues[self._iIdx], '%w', self.oParent.bUTC, self.oParent.iTimeZone));
			return sRule;
		}

		if (self.aValues.length > 0 && self.oGuide.bVisible) {
			var iGuideOffsetStart = (ZC._n_(self.oGuide.oData['offset-start'])===null)?0:ZC._i_(self.oGuide.oData['offset-start']);
			var iGuideOffsetEnd = (ZC._n_(self.oGuide.oData['offset-end'])===null)?0:ZC._i_(self.oGuide.oData['offset-end']);
			if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0 && !self.oParent.oSettings['3d']) {
				oBox = new ZC.ZCBox(self);
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					i0 = i - self.iMinIndex;
					iItemIdx = i%self.oGuide.oData['items'].length;
					oBox.append(self.oGuide.oData['items'][iItemIdx]);
					oBox.sId = self.sId + '-guide-' + i;
					oBox.oCanvas = oCanvasGuides;
					
					oBox.parse();
					if (self.bMirrored) {
						oBox.iX = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - self.iStepSize;
					} else {
						oBox.iX = self.iX + self.iOffsetStart + i0*self.iStepSize;
					}
					oBox.iY = self.iY + iGuideOffsetStart;
					oBox.iWidth = self.iStepSize;
					oBox.iHeight = self.iHeight - iGuideOffsetStart - iGuideOffsetEnd;
					oBox.paint();
				}
			}

			if (self.oGuide.iLineWidth > 0) {
				self._iCnt = 0;
				for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === (self.iMaxIndex+(self.bRanged?1:0)) || i%iTicksStep === 0) {
						if (self.oGuide.aRules.length > 0 || i === self.iMinIndex) {
							oCopy = new ZC.ZCStyle(self);
							oCopy.oCanvas = oCopy.oCanvasSh = oCanvasGuides;
							oCopy.copy(self.oGuide);
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
						}
						aPoints = [];
						i0 = i - self.iMinIndex;
						if (self.bMirrored) {
							iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize;
						} else {
							iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize;
						}
						var iY_ = self.iY + iGuideOffsetStart;
						var iHeight_ = self.iHeight - iGuideOffsetStart - iGuideOffsetEnd;
						if (oCopy.bVisible) {
							if (self.oParent.oSettings['3d']) {

								var oCopyZ = new ZC.ZCStyle(self);
								oCopyZ.copy(oCopy);
								if (ZC._n_(self.oData['scale-z']) !== null && ZC._n_(mValue=self.oData['scale-z']['guide']) !== null) {
									oCopyZ.append(mValue);
									oCopyZ.parse();
								}

								oCopyZ.sBackgroundColor1 = oCopyZ.sBackgroundColor2 = oCopyZ.sLineColor;
								oFace = ZC.ZCMath3D._create_3d_face_(oCopyZ, self.oParent, iX_ - ZC.ZCDraw3D.iViewX - oCopyZ.iLineWidth/2, iX_ - ZC.ZCDraw3D.iViewX + oCopyZ.iLineWidth/2, iY - ZC.ZCDraw3D.iViewY, iY - ZC.ZCDraw3D.iViewY, 0, ZC.ZCDraw3D.iDepth, 'z');
								self.oParent.oEngine3D.add(oFace);

								oCopy.sBackgroundColor1 = oCopy.sBackgroundColor2 = oCopy.sLineColor;
								oFace = ZC.ZCMath3D._create_3d_face_(oCopy, self.oParent, iX_ - ZC.ZCDraw3D.iViewX - oCopy.iLineWidth/2, iX_ - ZC.ZCDraw3D.iViewX + oCopy.iLineWidth/2, iY_ - ZC.ZCDraw3D.iViewY, iY_ + iHeight_ - ZC.ZCDraw3D.iViewY, ZC.ZCDraw3D.iDepth + 2, ZC.ZCDraw3D.iDepth + 2, 'y');
								oFace.sId = self.sId + '-guide-' + i;
								self.oParent.oEngine3D.add(oFace);

							} else {
								aPoints.push(
									[iX_, iY_],
									[iX_, iY_ + iHeight_]
								);
								oCopy.sId = self.sId + '-guide-' + i;
								ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
							}
						}
						self._iCnt++;
					}
				}
			}
		}

		if (self.aValues.length > 0 && self.oMinorGuide.bVisible && !self.oParent.oSettings['3d']) {
			if (self.oMinorGuide.oData['items'] && self.oMinorGuide.oData['items'].length > 0) {
				oBox = new ZC.ZCBox(self);
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					i0 = i - self.iMinIndex;
					self._iCnt = 0;
					for (j=1;j<=self.iMinorTicks;j++) {
						iItemIdx = self._iCnt%self.oMinorGuide.oData['items'].length;
						oBox.append(self.oMinorGuide.oData['items'][iItemIdx]);
						oBox.sId = self.sId + '-guide-' + i + '-' + j;
						oBox.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oBox.parse();
						if (self.bMirrored) {
							oBox.iX = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - (j+1)*iMinorStepSize;
						} else {
							oBox.iX = self.iX + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
						}
						oBox.iY = self.iY;
						oBox.iWidth = iMinorStepSize;
						oBox.iHeight = self.iHeight;
						oBox.paint();
						self._iCnt++;
					}
				}
			}
		}
		if (self.oMinorGuide.iLineWidth > 0) {
			for (i=self.iMinIndex-iTicksStep;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
				self._iIdx = i;
				if (i%iTicksStep === 0) {
					i0 = i - self.iMinIndex;
					self._iCnt = 0;
					for (j=1;j<=self.iMinorTicks;j++) {
						aPoints = [];
						oCopy = new ZC.ZCStyle(self);
						oCopy.copy(self.oMinorGuide);
						oCopy.parseRule = _parseRule;
						if (oCopy.applyRules()) {
							oCopy.parse();
						}
						if (self.bMirrored) {
							iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
						} else {
							iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
						}
						if (ZC._btw_(iX_, iScaleMinX, iScaleMaxX)) {
							aPoints.push(
								[iX_, self.iY],
								[iX_, self.iY + self.iHeight]
							);
							if (oCopy.bVisible) {
								oCopy.sId = self.sId + '-minor-guide-' + j;
								ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
							}
						}
						self._iCnt++;
					}
				}
			}
		}

		self.sharedPaintRefLine(oCtxGuides, sPlotColor);

		if (self.aValues.length > 0 && self.oTick.bVisible && (!self.oParent.oSettings['3d'] || !self.oParent.o3DAspect['true3d'])) {
			switch (self.oTick.oData['placement']) {
				case 'inner':
					break;
				case 'outer':
					iScaleLabelOffset += iTickSize;
					break;
				
				default:
					iScaleLabelOffset += iTickSize/2;
					break;
			}

			if (!zingchart.DEV.SMARTDATELABELS || (!self.oTransform || self.oTransform.oData['type'] !== 'date')) {
				self._iCnt = 0;
				for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
					if (i === self.iMinIndex || i === (self.iMaxIndex+(self.bRanged?1:0)) || i%iTicksStep === 0) {
						self._iIdx = i;
						var iTickSize_ = iTickSize;
						aPoints = [];
						i0 = i - self.iMinIndex;
						if (self.oTick.aRules.length > 0  || i === self.iMinIndex) {
							oCopy = new ZC.ZCShape(self);
							oCopy.copy(self.oTick);
							if (self.oTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
								oCopy.sLineColor = sPlotColor;
							}
							
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
							if (oCopy.iSize > 1) {
								iTickSize_ = oCopy.iSize;
							}
						}
						if (self.bMirrored) {
							iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize;
						} else {
							iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize;
						}
						switch (oCopy.oData['placement']) {
							case 'ref-auto':
								aPoints.push(
									[iX_, iYRef + iTickSize_/2],
									[iX_, iYRef - iTickSize_/2]
								);
								break;
							case 'ref-top':
								aPoints.push(
									[iX_, iYRef - iTickSize_],
									[iX_, iYRef]
								);
								break;
							case 'ref-bottom':
								aPoints.push(
									[iX_, iYRef + iTickSize_],
									[iX_, iYRef]
								);
								break;
							case 'inner':
								aPoints.push(
									[iX_, iY - ((bDefault)?iTickSize_:-iTickSize_)],
									[iX_, iY]
								);
								break;
							case 'outer':
								aPoints.push(
									[iX_, iY],
									[iX_, iY + ((bDefault)?iTickSize_:-iTickSize_)]
								);
								break;
							
							default:
								aPoints.push(
									[iX_, iY + iTickSize_/2],
									[iX_, iY - iTickSize_/2]
								);
								break;
						}
						if (oCopy.bVisible) {
							oCopy.sId = self.sId + '-tick-' + i;
							ZC.ZCLine.paint(oCtx, oCopy, aPoints);
						}
						self._iCnt++;
					}
				}
			}
		}

		if (self.aValues.length > 0 && self.iMinorTicks > 0 && self.oMinorTick.bVisible && !self.oParent.oSettings['3d']) {
			for (i=self.iMinIndex-iTicksStep;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
				self._iIdx = i;
				if (i%iTicksStep === 0) {
					i0 = i - self.iMinIndex;
					self._iCnt = 0;
					for (j=1;j<=self.iMinorTicks;j++) {
						aPoints = [];
						oCopy = new ZC.ZCStyle(self);
						oCopy.copy(self.oMinorTick);
						if (self.oMinorTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
							oCopy.sLineColor = sPlotColor;
						}
						oCopy.parseRule = _parseRule;
						if (oCopy.applyRules()) {
							oCopy.parse();
						}
						if (self.bMirrored) {
							iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
						} else {
							iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
						}
						if (ZC._btw_(iX_, iScaleMinX, iScaleMaxX)) {
							switch (oCopy.oData['placement']) {
								case 'ref-auto':
									aPoints.push(
										[iX_, iYRef + iMinorTickSize/2],
										[iX_, iYRef - iMinorTickSize/2]
									);
									break;
								case 'ref-top':
									aPoints.push(
										[iX_, iYRef],
										[iX_, iYRef - iMinorTickSize]
									);
									break;
								case 'ref-bottom':
									aPoints.push(
										[iX_, iYRef],
										[iX_, iYRef + iMinorTickSize]
									);
									break;
								case 'inner':
									aPoints.push(
										[iX_, iY - ((bDefault)?iMinorTickSize:-iMinorTickSize)],
										[iX_, iY]
									);
									break;
								case 'outer':
									aPoints.push(
										[iX_, iY],
										[iX_, iY + ((bDefault)?iMinorTickSize:-iMinorTickSize)]
									);
									break;
								
								default:
									aPoints.push(
										[iX_, iY + iMinorTickSize/2],
										[iX_, iY - iMinorTickSize/2]
									);
									break;
							}
							if (oCopy.bVisible) {
								oCopy.sId = self.sId + '-minor-tick-' + i;
								ZC.ZCLine.paint(oCtx, oCopy, aPoints);
							}
						}
						self._iCnt++;
					}
				}
			}
		}

		self.paintMarkers();

		var oLabel = null, iAngle = null;
		var sFormat_ = self.sFormat, iDecimals_ = self.iDecimals;

		var aTicksPoints = [];
		var oTicksCopy = new ZC.ZCShape(self);
		oTicksCopy.copy(self.oTick);

		function paintLabel(i, bAsTimestamp) {
			var sLabel;
			self._iIdx = i;
			i0 = i - self.iMinIndex;

			if (self.oItem.aRules.length > 0 || i === self.iMinIndex || !oLabel) {
				oLabel = new ZC.ZCTextBox(self);
			}
			oLabel.copy(self.oItem);

			oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
			oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;

			self.sFormat = sFormat_;
			self.iDecimals = iDecimals_;
			self.applyItemRules(_parseRule);

			if (bAsTimestamp) {
				sLabel = ZC.ZCUtils._date_(i, sIntervalFormat, self.oParent.bUTC, self.oParent.iTimeZone);
			} else {
				sLabel = self.getParsedItemLabel(i, null, null);
			}

			if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
				return;
			}
			oLabel.sText = sLabel;
			oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
			
			oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
			oLabel.oAttributes['nodeidx'] = i;
			oLabel.parse();
			
			if (self.oItem.bWrapText && self.oItem.iAngle%180 === 0) {
				oLabel.oData['width'] = ZC._i_(self.iStepSize*0.9);
				oLabel.parse();
			}

			if ((self.oItem.oData['font-color'] === 'inherit' || self.oItem.oData['color'] === 'inherit') && sPlotColor !== -1) {
				oLabel.sColor = sPlotColor;
			}
			oLabel.parseRule = _parseRule;
			if (oLabel.applyRules()) {
				oLabel.parse();
			}
			if (oLabel.oData['auto-fit']) {
				oLabel.iWidth = ZC._i_(self.iStepSize);
			}
			if (bAsTimestamp) {
				iX_ = self.getCoordByValue(i);
				oLabel.iX = iX_ - oLabel.iWidth/2 - (self.bRanged?self.iStepSize/2:0);
			} else {
				if (self.bMirrored) {
					oLabel.iX = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - oLabel.iWidth/2 - (self.bRanged?self.iStepSize/2:0);
				} else {
					oLabel.iX = self.iX + self.iOffsetStart + i0*self.iStepSize - oLabel.iWidth/2 + (self.bRanged?self.iStepSize/2:0);
				}
			}

			switch (oLabel.oData['placement']) {
				case 'inner':
					oLabel.iY = (bDefault)?(iY-oLabel.iHeight-iTickSize):(iY+iTickSize);
					break;
				case 'ref-top':
					oLabel.iY = iYRef-oLabel.iHeight-iTickSize;
					break;
				case 'ref-bottom':
					oLabel.iY = iYRef+iTickSize;
					break;
				case 'ref-auto':
					if (oPlotRef && oPlotRef.aPlotNodes[i]) {
						oPlotRef.getNode(i).setup();
						if (oPlotRef.getNode(i).iY < iYRef) {
							oLabel.iY = iYRef+iTickSize;
						} else {
							oLabel.iY = iYRef-oLabel.iHeight-iTickSize;
						}
					} else {
						oLabel.iY = iYRef+iTickSize;
					}
					break;
				
				default:
					oLabel.iY = (bDefault)?(iY+iTickSize):(iY-oLabel.iHeight-iTickSize);
					break;
			}

			iAngle = self.sharedLabel3DTransform(oLabel, iAngle);

			if (self.oItem.oData['auto-align'] && self.oItem.iAngle%180 !== 0) {
				var iMultiplier = ZC._btw_(self.oItem.iAngle, 0, 180)?(bDefault?1:-1):(bDefault?-1:1);
				oLabel.iX += iMultiplier*oLabel.iWidth*ZC._cos_(self.oItem.iAngle)/2;
				oLabel.iY += iMultiplier*(oLabel.iWidth*ZC._sin_(self.oItem.iAngle)/2 - oLabel.iHeight*ZC._sin_(self.oItem.iAngle)/2);
			}

			var oDimInfo = self.sharedPaintLabel(oLabel, i, {
				items : iItems,
				lcoords : aLabelsCoords,
				lstep : iLabelsStep,
				tdim : iTotalItemHeight,
				mdim : iMaxItemHeight,
				dim : 'h',
				html : aHtml
			});
			iTotalItemHeight = oDimInfo['tdim'];
			iMaxItemHeight = oDimInfo['mdim'];

			if (!oDimInfo['overlaps'] && bAsTimestamp && self.oTick.bVisible) {
				switch (oTicksCopy.oData['placement']) {
					case 'ref-auto':
						aTicksPoints.push(
							[iX_, iYRef + iTickSize/2],
							[iX_, iYRef - iTickSize/2],
							null
						);
						break;
					case 'ref-top':
						aTicksPoints.push(
							[iX_, iYRef - iTickSize],
							[iX_, iYRef],
							null
						);
						break;
					case 'ref-bottom':
						aTicksPoints.push(
							[iX_, iYRef + iTickSize],
							[iX_, iYRef],
							null
						);
						break;
					case 'inner':
						aTicksPoints.push(
							[iX_, iY - ((bDefault)?iTickSize:-iTickSize)],
							[iX_, iY],
							null
						);
						break;
					case 'outer':
						aTicksPoints.push(
							[iX_, iY],
							[iX_, iY + ((bDefault)?iTickSize:-iTickSize)],
							null
						);
						break;
					
					default:
						aTicksPoints.push(
							[iX_, iY + iTickSize/2],
							[iX_, iY - iTickSize/2],
							null
						);
						break;
				}
			}

			self._iCnt++;
		}

		var iTotalItemHeight = 0;
		var iMaxItemHeight = 0;
		var iItems = 0;
		var aLabelsCoords = [];
		var aHtml = [];
		if (self.aValues.length > 0 && self.oItem.bVisible) {

			if (!zingchart.DEV.SMARTDATELABELS || (!self.oTransform || self.oTransform.oData['type'] !== 'date')) {
				self._iCnt = 0;
				paintLabel(self.iMinIndex);
				self._iCnt = self.iMaxIndex-self.iMinIndex;
				paintLabel(self.iMaxIndex);
				self._iCnt = 1;
				for (i=self.iMinIndex+1;i<self.iMaxIndex;i++) {
					if (i%iLabelsStep === 0) {
						paintLabel(i);
					}
				}
			} else {
				var aTriggerInfo = self.getOptimalDateInterval(self.aValues[self.iMaxIndex]-self.aValues[self.iMinIndex]);
				var sIntervalTrigger = aTriggerInfo[0];
				var sIntervalFormat = aTriggerInfo[1];
				var iStep = aTriggerInfo[2];
				var sStep = aTriggerInfo[3];
				iItems = aTriggerInfo[4];

				var iMin = iStep*Math.ceil(self.aValues[self.iMinIndex]/iStep);
				var iMax = iStep*Math.floor(self.aValues[self.iMaxIndex]/iStep);
				var sTrigger = '';

				self._iCnt = 0;
				var bValid = true;
				for (i=iMin;i<=iMax;i+=iStep) {
					bValid = true;
					var sTrigger_ = ZC.ZCUtils._date_(i, sIntervalTrigger, self.oParent.bUTC, self.oParent.iTimeZone);
					if (sTrigger_ !== sTrigger) {
						switch (sStep) {
							case 'yr':
								if (iItems > 15) {
									bValid = (ZC._i_(sTrigger_) % 2 === 0);
								}
								break;
							case 'mon':
								if (iItems > 15) {
									bValid = (ZC._i_(sTrigger_) % 3 === 0);
								}
								break;
							case 'day':
								if (iItems > 45) {
									bValid = (ZC._i_(sTrigger_) === 1 || ZC._i_(sTrigger_) === 15);
								} else if (iItems > 30) {
									bValid = (ZC._i_(sTrigger_) === 1 || ZC._i_(sTrigger_) === 10 || ZC._i_(sTrigger_) === 20);
								} else if (iItems > 15) {
									bValid = (ZC._i_(sTrigger_) === 1 || ZC._i_(sTrigger_) === 10 || ZC._i_(sTrigger_) === 15 || ZC._i_(sTrigger_) === 20 || ZC._i_(sTrigger_) === 25);
								}
								break;
							case 'hr':
								if (iItems > 45) {
									bValid = (ZC._i_(sTrigger_) % 12 === 0);
								} else if (iItems > 30) {
									bValid = (ZC._i_(sTrigger_) % 6 === 0);
								} else if (iItems > 15) {
									bValid = (ZC._i_(sTrigger_) % 3 === 0);
								}
								break;
							case 'min':
								if (iItems > 45) {
									bValid = (ZC._i_(sTrigger_) % 30 === 0);
								} else if (iItems > 30) {
									bValid = (ZC._i_(sTrigger_) % 10 === 0);
								} else if (iItems > 15) {
									bValid = (ZC._i_(sTrigger_) % 5 === 0);
								}
								break;
							case 'sec':
								if (iItems > 45) {
									bValid = (ZC._i_(sTrigger_) % 30 === 0);
								} else if (iItems > 30) {
									bValid = (ZC._i_(sTrigger_) % 10 === 0);
								} else if (iItems > 15) {
									bValid = (ZC._i_(sTrigger_) % 5 === 0);
								}
								break;
						}
						if (bValid) {
							paintLabel(i, true);
							sTrigger = sTrigger_;
						}

					}
				}

				if (oTicksCopy.bVisible) {
					oTicksCopy.sId = self.sId + '-ticks';
					ZC.ZCLine.paint(oCtx, oTicksCopy, aTicksPoints);
				}
			}

		}
		if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
			ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
		}

		if (self.oLabel.bVisible) {
			if (self.oLabel.sText && self.oLabel.sText !== '') {
				oLabel = new ZC.ZCTextBox(self);
				oLabel.copy(self.oLabel);
				oLabel.sId = self.sId + '-label';
				oLabel.sDOMClass = self.sId + '-label ' + self.oParent.sId + '-scale-label zc-scale-label';
				oLabel.sText = self.oLabel.sText;
				oLabel.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();
				if ((self.oLabel.oData['font-color'] === 'inherit' || self.oLabel.oData['color'] === 'inherit') && sPlotColor !== -1) {
					oLabel.sColor = sPlotColor;
				}
				oLabel.iX = self.iX + self.iWidth/2 - oLabel.iWidth/2;
				if (bDefault) {
					oLabel.iY = iY + iScaleLabelOffset + iMaxItemHeight;
				} else {
					oLabel.iY = iY - oLabel.iHeight - iScaleLabelOffset - iMaxItemHeight;
				}
				if (oLabel.bVisible) {
					self.sharedLabel3DTransform(oLabel, null, 'h');
					oLabel.paint();
					oLabel.paintPrintVersion();
				}
			}
		}

		if (ZC._n_(self.oData['transform']) !== null && self.oData['transform']['type'] === 'date') {
			self.paintTransformDate();
		}
	},

	getOptimalDateInterval : function(iTsDiff) {
		var sIntervalTrigger, sIntervalFormat, iStep, sStep, iItems;
		if (0 <= iTsDiff && iTsDiff <= 3*1000) {
			sIntervalTrigger = '%q';
			sIntervalFormat = '%q ms';
			iStep = 10;
			sStep = 'ms';
			iItems = ZC._i_(iTsDiff/10);
		} else if (3*1000 < iTsDiff && iTsDiff <= 3*1000*60) {
			sIntervalTrigger = '%s';
			sIntervalFormat = '%h:%i:%s %A';
			iStep = 1000;
			sStep = 'sec';
			iItems = ZC._i_(iTsDiff/1000);
		} else if (3*1000*60 < iTsDiff && iTsDiff <= 3*1000*60*60) {
			sIntervalTrigger = '%i';
			sIntervalFormat = '%h:%i %A';
			iStep = 1000*60;
			sStep = 'min';
			iItems = ZC._i_(iTsDiff/(1000*60));
		} else if (3*1000*60*60 < iTsDiff && iTsDiff <= 3*1000*60*60*24) {
			sIntervalTrigger = '%h:%i';
			sIntervalFormat = '%M %d, %h %A';
			iStep = 1000*60*60;
			sStep = 'hr';
			iItems = ZC._i_(iTsDiff/(1000*60*60));
		} else if (3*1000*60*60*24 < iTsDiff && iTsDiff <= 3*1000*60*60*24*30) {
			sIntervalTrigger = '%d';
			sIntervalFormat = '%M %d';
			iStep = 1000*60*60*24;
			sStep = 'day';
			iItems = ZC._i_(iTsDiff/(1000*60*60*24));
		} else if (3*1000*60*60*24*30 < iTsDiff && iTsDiff <= 3*1000*60*60*24*366) {
			sIntervalTrigger = '%m';
			sIntervalFormat = '%M %Y';
			iStep = 1000*60*60*24;
			sStep = 'mon';
			iItems = ZC._i_(iTsDiff/(1000*60*60*24*30));
		} else {
			sIntervalTrigger = '%Y';
			sIntervalFormat = '%Y';
			iStep = 1000*60*60*24;
			sStep = 'yr';
			iItems = ZC._i_(iTsDiff/(1000*60*60*24*365));
		}
		return [sIntervalTrigger, sIntervalFormat, iStep, sStep, iItems];
	},

	paintTransformDate : function() {
		var self = this, mValue, oCtxGuides;
		oCtxGuides = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-bl-0-c'), self.oLoader.sOutput);
		

		var sIntervalTrigger, sIntervalFormat;
		function _set_trigger_(iTsDiff, bStep) {
			if (typeof(bStep) === 'undefined') {
				bStep = false;
			}
			if (0 <= iTsDiff && iTsDiff <= 2*1000) {
				sIntervalTrigger = '%q';
				sIntervalFormat = '%q ms';
				if (bStep) {
					_set_trigger_(iTsDiff*60);
				}
			} else if (2*1000 < iTsDiff && iTsDiff <= 2*1000*60) {
				sIntervalTrigger = '%s';
				sIntervalFormat = '%h:%i:%s %A';
				if (bStep) {
					_set_trigger_(iTsDiff*60);
				}
			} else if (2*1000*60 < iTsDiff && iTsDiff <= 2*1000*60*60) {
				sIntervalTrigger = '%i';
				sIntervalFormat = '%h:%i %A';
				if (bStep) {
					_set_trigger_(iTsDiff*24);
				}
			} else if (2*1000*60*60 < iTsDiff && iTsDiff <= 2*1000*60*60*24) {
				sIntervalTrigger = '%h';
				sIntervalFormat = '%M %d, %h %A';
				if (bStep) {
					_set_trigger_(iTsDiff*30);
				}
			} else if (2*1000*60*60*24 < iTsDiff && iTsDiff <= 2*1000*60*60*24*30) {
				sIntervalTrigger = '%d';
				sIntervalFormat = '%M %d';
				if (bStep) {
					_set_trigger_(iTsDiff*366);
				}
			} else if (2*1000*60*60*24*30 < iTsDiff && iTsDiff <= 2*1000*60*60*24*366) {
				sIntervalTrigger = '%m';
				sIntervalFormat = '%M %Y';
				if (bStep) {
					_set_trigger_(iTsDiff*10);
				}
			} else {
				sIntervalTrigger = '%Y';
				sIntervalFormat = '%Y';
			}
		}

		_set_trigger_(self.aValues[self.iMaxIndex]-self.aValues[self.iMinIndex]);

		function paintLabel(i) {
			var iX_, oPoint3D;

			if (ZC._n_(self.aValues[i]) === null || self.aValues[i] === '') {
				return;
			}

			if (self.bNonLinearTs && i !== self.iMinIndex && i !== self.iMaxIndex) {
				if (ZC._n_(self.aValues[i-1]) !== null && self.aValues[i-1] !== '' && ZC._n_(self.aValues[i]) !== null && self.aValues[i] !== '') {
					var iStep_ = self.aValues[i]-self.aValues[i-1];
					if (ZC._n_(iStep) !== null) {
						if (iStep !== iStep_) {
							_set_trigger_(iStep, true);
						}
					}
					iStep = iStep_;
				}

			}

			var sTrigger_ = ZC.ZCUtils._date_(self.aValues[i], sIntervalTrigger, self.oParent.bUTC, self.oParent.iTimeZone);
			if (sTrigger_ !== sTrigger) {
				var bNoOverlap = true, mValue;
				var i0 = i - self.iMinIndex;
				if (self.bMirrored) {
					iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize;
				} else {
					iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize + (self.bRanged?self.iStepSize/2:0);
				}
				var oLabel = new ZC.ZCTextBox(self);
				self.oLoader.oDefaults.load(oLabel.oData, 'graph.SCALE.transform[date].item');
				if (ZC._n_(mValue=self.oData['transform']['item']) !== null) {
					oLabel.append(mValue);
				}
				oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
				oLabel.sId = self.sId + '-date-item-' + i;
				var sLabel = ZC.ZCUtils._date_(self.aValues[i], sIntervalFormat, self.oParent.bUTC, self.oParent.iTimeZone);
				oLabel.sText = sLabel;
				oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();

				if (self.bMirrored) {
					oLabel.iX = iX_ - oLabel.iTextWidth/2 - (self.bRanged?self.iStepSize/2:0);
				} else {
					oLabel.iX = iX_;
				}
				oLabel.iY = self.iY;
				if (self.oParent.oSettings['3d']) {
					self.oParent.setup3DView();
					oPoint3D = new ZC.ZCPoint3D(self.oParent, oLabel.iX + oLabel.iWidth/2 - ZC.ZCDraw3D.iViewX, oLabel.iY + oLabel.iHeight/2 - ZC.ZCDraw3D.iViewY, 0);
					oLabel.iX = oPoint3D.aXY[0] - oLabel.iWidth/2;
					oLabel.iY = oPoint3D.aXY[1] - oLabel.iHeight/2;
				}

				var aLabelCoords = [oLabel.iX, oLabel.iY, oLabel.iWidth, oLabel.iHeight];
				if (oLabel.iAngle%180 === 90) {
					aLabelCoords = [oLabel.iX+oLabel.iWidth/2-oLabel.iHeight/2, oLabel.iY+oLabel.iHeight/2-oLabel.iWidth/2, oLabel.iHeight, oLabel.iWidth];
				}

				if (oLabel.bVisible) {
					bNoOverlap = true;
					if (!self.bItemsOverlap) {
						if (i === self.iMinIndex || i === self.iMaxIndex) {
							bNoOverlap = true;
						} else {
							for (var l=0,lLen=aLabelsCoords.length;l<lLen;l++) {
								if (ZC._btw_(aLabelCoords[0], aLabelsCoords[l][0], aLabelsCoords[l][0] + aLabelsCoords[l][2]) || ZC._btw_(aLabelCoords[0] + aLabelCoords[2], aLabelsCoords[l][0], aLabelsCoords[l][0] + aLabelsCoords[l][2])) {
									bNoOverlap = false;
									break;
								}
							}
						}
						if (oLabel.iX+oLabel.iWidth > self.iX+self.iWidth) {
							bNoOverlap = false;
						}
					}
					if (bNoOverlap) {
						aLabelsCoords.push(aLabelCoords);
						oLabel.paint();
						oLabel.paintPrintVersion();

						var oCopy = new ZC.ZCStyle(self);
						if (ZC._n_(mValue=self.oData['transform']['guide']) !== null) {
							oCopy.append(mValue);
						}
						oCopy.iLineWidth = 1;
						oCopy.sLineColor = '#ccc';
						oCopy.parse();
						var aPoints = [];
						aPoints.push(
							[iX_, self.iY],
							[iX_, self.iY + self.iHeight]
						);

						if (self.oParent.oSettings['3d']) {
							self.oParent.setup3DView();
							for (var p=0,pLen=aPoints.length;p<pLen;p++) {
								oPoint3D = new ZC.ZCPoint3D(self.oParent, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, 0);
								aPoints[p][0] = oPoint3D.aXY[0];
								aPoints[p][1] = oPoint3D.aXY[1];
							}
						}

						if (oCopy.bVisible) {
							ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
						}
					}
				}
				cnt++;
			}
			sTrigger = sTrigger_;
		}

		var sTrigger = null, iStep = null;
		var aLabelsCoords = [];
		if (self.aValues.length > 0) {
			
			var bPaint = false;
			if (ZC._n_(mValue=self.oData['transform']['item']) !== null) {
				if (ZC._n_(mValue['visible']) !== null && !ZC._b_(mValue['visible'])) {
					bPaint = false;
				} else {
					bPaint = true;
				}
			}
			if (bPaint) {
				var cnt = 0;
				paintLabel(self.iMinIndex);
				paintLabel(self.iMaxIndex);
				for (var i=self.iMinIndex+1;i<self.iMaxIndex;i++) {
					paintLabel(i);
				}
			}
		}

	}

});











ZC.ZCScaleY = ZC.ZCScaleV.extend({
	init : function(oParent) {
		this._super(oParent);
	},
	parse : function() {
		this._super();
	},
	setupStepSize : function() {
		var self = this;
		if (self.iMaxIndex === self.iMinIndex) {
			self.iStepSize = self.iHeight-self.iOffsetStart-self.iOffsetEnd;
		} else {
			self.iStepSize = (self.iHeight-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
		}
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		self.setupStepSize();
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	zoomTo : function(fMin, fMax) {
		var self = this;
		self._super(fMin, fMax);
		self.iStepSize = (self.iHeight-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
	},
	getValueByCoord : function(iY, bExp) {
		var self = this, fRatio;
		if (self.bMirrored) {
			fRatio = (iY-self.iY-self.iOffsetStart)/(self.iHeight-self.iOffsetStart-self.iOffsetEnd);
		} else {
			fRatio = (self.iY+self.iHeight-self.iOffsetStart-iY)/(self.iHeight-self.iOffsetStart-self.iOffsetEnd);
		}
		var fValue = self.fMin + ZC._f_((self.fMax-self.fMin)*fRatio);
		
		if (self.sProgression === 'log' && bExp) {
			fValue = Math.exp(fValue);
		}		
		return fValue;
	},
	getCoordByValue : function(fValue) {
		var self = this;
		var fRange = self.fMax - self.fMin;
		var fRatio = (fRange===0)?0:((self.iHeight - self.iOffsetStart - self.iOffsetEnd)/fRange);
		if (self.sProgression === 'log') {
			fValue = ZC._log_(fValue);
		}
		if (self.bMirrored) {
			return self.iY + self.iOffsetStart + (fValue-self.fMin)*fRatio;
		} else {
			return self.iY + self.iHeight - self.iOffsetStart - (fValue-self.fMin)*fRatio;
		}
	},
	paint : function() {
		var self = this, mValue, i, iLen, iX, oCanvas, oCtx, oCanvasGuides, oCtxGuides, iY_, aPoints, i0, oCopy, oFace, oBox, iItemIdx, j, iZeroIndex, oLabel, iScaleSpacer;
		self._super();

		
		if ((self.oParent.sType === 'bubble' || self.oParent.sType === 'scatter') && self.aValues.length === 1) {
			self.iOffsetStart = self.iHeight/2;
		}

		var sPlotColor = self.getPlotColor();

		var iYScales = 0, iCntD = 1, iCntO = 1, oIndexes = {};
		for (i=0,iLen=self.oParent.aScales.length;i<iLen;i++) {
			if (self.oParent.aScales[i].bVisible && self.oParent.aScales[i].bUsed) {
				if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-y' && self.oParent.aScales[i].sPlacement === self.sPlacement) {
					iYScales++;
				}
				if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-y') {
					if (self.oParent.aScales[i].sPlacement === 'default') {
						oIndexes[self.oParent.aScales[i].sName] = iCntD;
						iCntD++;
					} else {
						oIndexes[self.oParent.aScales[i].sName] = iCntO;
						iCntO++;
					}
				}
			}
		}
		var iScaleIndex = oIndexes[self.sName], bDefault = (self.sPlacement === 'default');

		var iXRef = null;
		var oPlotRef = null;
		for (i=0,iLen=self.oParent.oPlotSet.aPlots.length;i<iLen;i++) {
			var oPlot = self.oParent.oPlotSet.aPlots[i];
			var aPlotScales = oPlot.getScales();
			if (ZC._indexof_(aPlotScales, self.sName) !== -1) {
				var oScalePair = self.oParent.getScaleByName(oPlot.getScales('k')[0]);
				iXRef = oScalePair.getCoordByValue(oScalePair.fRefValue);
				oPlotRef = oPlot;
				break;
			}
		}

		var iTickSize = 8;
		if (ZC._n_(self.oTick.oData['size']) !== null) {
			iTickSize = ZC._i_(self.oTick.oData['size']);
		}
		var iMinorTickSize = 4;
		if (ZC._n_(self.oMinorTick.oData['size']) !== null) {
			iMinorTickSize = ZC._i_(self.oMinorTick.oData['size']);
		}

		var iDist = ZC._i_(self.oParent.oAttributes[self.sName + '-distance'] || -1);
		if (self.sPlacement === 'default') {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginLeft/iYScales);
			iX = self.iX - (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iX = self.iX - iDist;
			}
		} else {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginRight/iYScales);
			iX = self.iX + self.iWidth + (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iX = self.iX + self.iWidth + iDist;
			}
		}
		
		var iXLine = iX;
		
		if (self.oParent.oScrollY && self.sName == 'scale-y') {
			self.oParent.oScrollY.bVisible = true;
			if (self.fMin_ === self.fMin && self.fMax_ === self.fMax) {
				self.oParent.oScrollY.bVisible = false;
			}
			if (self.oParent.oScrollY.bVisible && self.oParent.oScrollY.oBarStyle.iOffsetX === 0) {
				iX -= self.oParent.oScrollY.oBarStyle.iWidth + self.iLineWidth/2;
			}
		}
		self.oAttributes['iX'] = iX;

		if (!self.bVisible || !self.bUsed) { 
			return; 
		}

		var iLabelsStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxItems-1));
		var iTicksStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxTicks-1));

		
		if (ZC._b_(self.oData['normalize'])) {
			iTicksStep = ZC.ZCMath._round_step_(iTicksStep);
			iLabelsStep = ZC.ZCMath._round_step_(iLabelsStep);
		}

		var iScaleLabelOffset = 0;
		var iMinorStepSize = self.iStepSize*iTicksStep/(self.iMinorTicks+1);

		oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
		oCtx = ZC.ZCHtmlUtils._context_(oCanvas, self.oLoader.sOutput);
		oCanvasGuides = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
		oCtxGuides = ZC.ZCHtmlUtils._context_(oCanvasGuides, self.oLoader.sOutput);
		

		
		if (!self.bUsed && !self.bForceView && ZC._n_(self.oParent.oData[self.sName]) === null) {
			return;
		}

		if (self.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
			self.sLineColor = sPlotColor;
		}
		if (self.oParent.oSettings['3d']) {
			oFace = ZC.ZCMath3D._create_3d_face_(self, self.oParent, iX - ZC.ZCDraw3D.iViewX, iX - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, self.iY - ZC.ZCDraw3D.iViewY + self.iHeight, 0-1, ZC.ZCDraw3D.iDepth+1, 'y');
			oFace.sId = self.sId + '-line';
			if (self.oParent.o3DAspect['true3d']) {
				if (self.oParent.o3DAspect['y-angle'] > 0) {
					oFace.aPriorities = [self.iIndex===1?-100:100, 1, 1];
				} else {
					oFace.aPriorities = [self.iIndex===1?100:-100, 1, 1];
				}
			}
			self.oParent.oEngine3D.add(oFace);
		} else {
			aPoints = [
				[iXLine, self.iY + self.iHeight],
				[iXLine, self.iY]
			];
			var sId_ = self.sId;
			self.sId += '-line';
			ZC.ZCLine.paint(oCtx, self, aPoints);
			self.sId = sId_;
		}

		var iTotalItemWidth = 0;
		var iMaxItemWidth = 0;
		var iItems = 0;
		var aLabelsCoords = [];
		var aHtml = [];

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%c)|(%scale-position)/g, self._iCnt);
			sRule = sRule.replace(/(%i)|(%scale-index)/g, self._iIdx);
			sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[self._iIdx]) !== null)?self.aValues[self._iIdx]:'');
			sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[self._iIdx]) !== null)?self.aLabels[self._iIdx]:'');
			return sRule;
		}

		
		if (self.bUsed || self.bForceView) {

			if (self.aValues.length > 0 && self.oGuide.bVisible) {
				var iGuideOffsetStart = (ZC._n_(self.oGuide.oData['offset-start'])===null)?0:ZC._i_(self.oGuide.oData['offset-start']);
				var iGuideOffsetEnd = (ZC._n_(self.oGuide.oData['offset-end'])===null)?0:ZC._i_(self.oGuide.oData['offset-end']);
				if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0 && !self.oParent.oSettings['3d']) {
					self._iCnt = 0;
					oBox = new ZC.ZCBox(self);
					for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex-1 || i%iTicksStep === 0) {
							i0 = i - self.iMinIndex;
							iItemIdx = self._iCnt%self.oGuide.oData['items'].length;
							oBox.append(self.oGuide.oData['items'][iItemIdx]);
							oBox.sId = self.sId + '-guide-' + i;
							oBox.oCanvas = oCanvasGuides;
							
							oBox.parse();
							oBox.iX = self.iX + iGuideOffsetStart;
							if (self.bMirrored) {
								iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize;
							} else {
								iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - self.iStepSize*iTicksStep;
							}
							oBox.iY = iY_;
							oBox.iWidth = self.iWidth - iGuideOffsetStart - iGuideOffsetEnd;
							oBox.iHeight = self.iStepSize*iTicksStep;
							oBox.paint();
							self._iCnt++;
						}
					}
				}
				if (self.oGuide.iLineWidth > 0) {
					self._iCnt = 0;
					for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
							if (self.oGuide.aRules.length > 0 || i === self.iMinIndex) {
								oCopy = new ZC.ZCStyle(self);
								oCopy.oCanvas = oCopy.oCanvasSh = oCanvasGuides;
								oCopy.copy(self.oGuide);
								oCopy.parseRule = _parseRule;
								if (oCopy.applyRules()) {
									oCopy.parse();
								}
							}
							aPoints = [];
							i0 = i - self.iMinIndex;
							var iX_ = self.iX + iGuideOffsetStart;
							var iWidth_ = self.iWidth - iGuideOffsetStart - iGuideOffsetEnd;
							if (self.bMirrored) {
								iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize;
							} else {
								iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize;
							}
							if (oCopy.bVisible) {
								if (self.oParent.oSettings['3d']) {

									var oCopyZ = new ZC.ZCStyle(self);
									oCopyZ.copy(oCopy);
									if (ZC._n_(self.oData['scale-z']) !== null && ZC._n_(mValue=self.oData['scale-z']['guide']) !== null) {
										oCopyZ.append(mValue);
										oCopyZ.parse();
									}

									oCopyZ.sBackgroundColor1 = oCopyZ.sBackgroundColor2 = oCopyZ.sLineColor;
									oFace = ZC.ZCMath3D._create_3d_face_(oCopyZ, self.oParent, iX - ZC.ZCDraw3D.iViewX, iX - ZC.ZCDraw3D.iViewX, iY_ - ZC.ZCDraw3D.iViewY - oCopyZ.iLineWidth/2, iY_ - ZC.ZCDraw3D.iViewY + oCopyZ.iLineWidth/2, 0, ZC.ZCDraw3D.iDepth, 'y');
									self.oParent.oEngine3D.add(oFace);

									oCopy.sBackgroundColor1 = oCopy.sBackgroundColor2 = oCopy.sLineColor;
									oFace = ZC.ZCMath3D._create_3d_face_(oCopy, self.oParent, iX_ - ZC.ZCDraw3D.iViewX, iX_ - ZC.ZCDraw3D.iViewX + iWidth_, iY_ - ZC.ZCDraw3D.iViewY - oCopy.iLineWidth/2, iY_ - ZC.ZCDraw3D.iViewY + oCopy.iLineWidth/2, ZC.ZCDraw3D.iDepth+2, ZC.ZCDraw3D.iDepth+2, 'x');
									oFace.sId = self.sId + '-guide-' + i;
									self.oParent.oEngine3D.add(oFace);
								} else {
									aPoints.push(
										[iX_, iY_],
										[iX_ + iWidth_, iY_]
									);
									oCopy.sId = self.sId + '-guide-' + i;
									ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
								}
							}
							self._iCnt++;
						}
					}
				}
			}

			if (self.aValues.length > 0 && self.oMinorGuide.bVisible && iMinorStepSize > 2 && !self.oParent.oSettings['3d']) {
				if (self.oMinorGuide.oData['items'] && self.oMinorGuide.oData['items'].length > 0) {
					oBox = new ZC.ZCBox(self);
					for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
							i0 = i - self.iMinIndex;
							self._iCnt = 0;
							for (j=1;j<=self.iMinorTicks;j++) {
								iItemIdx = self._iCnt%self.oMinorGuide.oData['items'].length;
								oBox.append(self.oMinorGuide.oData['items'][iItemIdx]);
								oBox.sId = self.sId + '-guide-' + i + '-' + j;
								oBox.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
								
								oBox.parse();
								oBox.iX = self.iX;
								if (self.bMirrored) {
									iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
								} else {
									iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - (j+1)*iMinorStepSize;
								}
								oBox.iY = iY_;
								oBox.iWidth = self.iWidth;
								oBox.iHeight = iMinorStepSize;
								oBox.paint();
								self._iCnt++;
							}
						}
					}
				}
				if (self.oMinorGuide.iLineWidth > 0) {
					for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
							i0 = i - self.iMinIndex;
							self._iCnt = 0;

							for (j=1;j<=self.iMinorTicks;j++) {
								aPoints = [];
								oCopy = new ZC.ZCStyle(self);
								oCopy.copy(self.oMinorGuide);
								oCopy.parseRule = _parseRule;
								if (oCopy.applyRules()) {
									oCopy.parse();
								}
								if (self.sProgression === 'log' && zingchart.DEV.TRUELOG) {
									iY_ = self.getCoordByValue(j*self.aValues[i+1]/(self.iMinorTicks+1));
								} else {
									if (self.bMirrored) {
										iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
									} else {
										iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
									}
								}
								if (ZC._btw_(iY_, self.iY, self.iY + self.iHeight)) {
									aPoints.push(
										[self.iX, iY_],
										[self.iX + self.iWidth, iY_]
									);
									if (oCopy.bVisible) {
										oCopy.sId = self.sId + '-minor-guide-' + j;
										ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
									}
								}
								self._iCnt++;
							}
						}
					}
				}
			}

			self.sharedPaintRefLine(oCtxGuides, sPlotColor);

			if (self.aValues.length > 0 && self.oTick.bVisible && (!self.oParent.oSettings['3d'] || !self.oParent.o3DAspect['true3d'])) {
				switch (self.oTick.oData['placement']) {
					case 'inner':
						break;
					case 'outer':
						iScaleLabelOffset += iTickSize;
						break;
					
					default:
						iScaleLabelOffset += iTickSize/2;
						break;
				}
				self._iCnt = 0;
				
				iZeroIndex = ZC._indexof_(self.aValues, 0);
				for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0 || (ZC._b_(self.oData['show-zero']) && i === iZeroIndex)) {
						aPoints = [];
						i0 = i - self.iMinIndex;
						if (self.oTick.aRules.length > 0 || i === self.iMinIndex) {
							oCopy = new ZC.ZCStyle(self);
							oCopy.copy(self.oTick);
							if (self.oTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
								oCopy.sLineColor = sPlotColor;
							}
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
						}
						if (self.bMirrored) {
							iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize;
						} else {
							iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize;
						}
						switch (oCopy.oData['placement']) {
							case 'ref-right':
								aPoints.push(
									[iXRef, iY_],
									[iXRef + iTickSize, iY_]
								);
								break;
							case 'ref-left':
								aPoints.push(
									[iXRef, iY_],
									[iXRef - iTickSize, iY_]
								);
								break;
							case 'ref-auto':
								aPoints.push(
									[iXRef - iTickSize/2, iY_],
									[iXRef + iTickSize/2, iY_]
								);
								break;
							case 'inner':
								aPoints.push(
									[iX, iY_],
									[iX + (bDefault?iTickSize:-iTickSize), iY_]
								);
								break;
							case 'outer':
								aPoints.push(
									[iX, iY_],
									[iX - (bDefault?iTickSize:-iTickSize), iY_]
								);
								break;
							
							default:
								aPoints.push(
									[iX + iTickSize/2, iY_],
									[iX - iTickSize/2, iY_]
								);
								break;
						}
						if (oCopy.bVisible) {
							oCopy.sId = self.sId + '-tick-' + i;
							ZC.ZCLine.paint(oCtx, oCopy, aPoints);
						}
						self._iCnt++;
					}
				}
			}

			if (self.aValues.length > 0 && self.oMinorTick.bVisible && self.iMinorTicks > 0 && iMinorStepSize > 5 && !self.oParent.oSettings['3d']) {
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
						i0 = i - self.iMinIndex;
						self._iCnt = 0;
						for (j=1;j<=self.iMinorTicks;j++) {
							aPoints = [];
							oCopy = new ZC.ZCStyle(self);
							oCopy.copy(self.oMinorTick);
							if (self.oMinorTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
								oCopy.sLineColor = sPlotColor;
							}
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
							if (self.sProgression === 'log' && zingchart.DEV.TRUELOG) {
								iY_ = self.getCoordByValue(j*self.aValues[i+1]/(self.iMinorTicks+1));
							} else {
								if (self.bMirrored) {
									iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
								} else {
									iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;								
								}
							}
							if (ZC._btw_(iY_, self.iY, self.iY + self.iHeight)) {
								switch (oCopy.oData['placement']) {
									case 'ref-right':
										aPoints.push(
											[iXRef, iY_],
											[iXRef + iMinorTickSize, iY_]
										);
										break;
									case 'ref-left':
										aPoints.push(
											[iXRef, iY_],
											[iXRef - iMinorTickSize, iY_]
										);
										break;
									case 'ref-auto':
										aPoints.push(
											[iXRef - iMinorTickSize/2, iY_],
											[iXRef + iMinorTickSize/2, iY_]
										);
										break;
									case 'inner':
										aPoints.push(
											[iX, iY_],
											[iX + (bDefault?iMinorTickSize:-iMinorTickSize), iY_]
										);
										break;
									
									default:
										aPoints.push(
											[iX, iY_],
											[iX - (bDefault?iMinorTickSize:-iMinorTickSize), iY_]
										);
										break;
									case 'cross':
										aPoints.push(
											[iX + iMinorTickSize/2, iY_],
											[iX - iMinorTickSize/2, iY_]
										);
										break;
								}
								if (oCopy.bVisible) {
									oCopy.sId = self.sId + '-minor-tick-' + i;
									ZC.ZCLine.paint(oCtx, oCopy, aPoints);
								}
							}
							self._iCnt++;
						}
					}
				}
			}

			self.paintMarkers();

			var iAngle = null;
			var sFormat_ = self.sFormat, iDecimals_ = self.iDecimals;

			var paintLabel = function(i) {
				self._iIdx = i;
				i0 = i - self.iMinIndex;
				
				if (self.oItem.aRules.length > 0 || i === self.iMinIndex) {
					oLabel = new ZC.ZCTextBox(self);
				}
				oLabel.copy(self.oItem);

				oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
				oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;

				self.sFormat = sFormat_;
				self.iDecimals = iDecimals_;
				self.applyItemRules(_parseRule);

				var sLabel = self.getParsedItemLabel(i);

				if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
					return;
				}
				oLabel.sText = sLabel;
				oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();
				if ((self.oItem.oData['font-color'] === 'inherit' || self.oItem.oData['color'] === 'inherit') && sPlotColor !== -1) {
					oLabel.sColor = sPlotColor;
				}
				oLabel.parseRule = _parseRule;
				if (oLabel.applyRules()) {
					oLabel.parse();
				}
				switch (oLabel.oData['placement']) {
					case 'ref-left':
						oLabel.iX = iXRef-oLabel.iWidth-iTickSize;
						break;
					case 'ref-right':
						oLabel.iX = iXRef+iTickSize;
						break;
					case 'ref-auto':
						if (oPlotRef && oPlotRef.aPlotNodes[i]) {
							oPlotRef.getNode(i).setup();
							if (oPlotRef.getNode(i).iX < iXRef) {
								oLabel.iX = iXRef+iTickSize;
							} else {
								oLabel.iX = iXRef-oLabel.iWidth-iTickSize;
							}
						} else {
							oLabel.iX = iXRef+iTickSize;
						}
						break;
					case 'inner':
						oLabel.iX = bDefault?(iX+iTickSize):(iX-oLabel.iWidth-iTickSize);
						break;
					
					default:
						oLabel.iX = bDefault?(iX-oLabel.iWidth-iTickSize):(iX+iTickSize);
						break;
				}
				if (self.bMirrored) {
					oLabel.iY = self.iY + self.iOffsetStart + i0*self.iStepSize - oLabel.iHeight/2 + (self.bRanged?self.iStepSize/2:0);
				} else {
					oLabel.iY = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - oLabel.iHeight/2 - (self.bRanged?self.iStepSize/2:0);
				}

				iAngle = self.sharedLabel3DTransform(oLabel, iAngle);

				if (self.oItem.oData['auto-align'] && self.oItem.iAngle%180 !== 0) {
					var iMultiplier = (bDefault?1:-1);
					if (self.oItem.iAngle === 90 || self.oItem.iAngle === 270) {
						oLabel.iX += iMultiplier*(oLabel.iWidth/2 - oLabel.iHeight/2);
					} else {
						if (ZC._btw_(self.oItem.iAngle, 0, 90) || ZC._btw_(self.oItem.iAngle, 270, 360)) {
							oLabel.iX += iMultiplier*(oLabel.iWidth - oLabel.iWidth*ZC._cos_(self.oItem.iAngle))/2;
							oLabel.iY -= iMultiplier*oLabel.iWidth*ZC._sin_(self.oItem.iAngle)/2;
						} else if (ZC._btw_(self.oItem.iAngle, 90, 270)) {
							oLabel.iX += iMultiplier*(oLabel.iWidth + oLabel.iWidth*ZC._cos_(self.oItem.iAngle))/2;
							oLabel.iY += iMultiplier*oLabel.iWidth*ZC._sin_(self.oItem.iAngle)/2;
						}
					}
				}

				var oDimInfo = self.sharedPaintLabel(oLabel, i, {
					items : iItems, 
					lcoords : aLabelsCoords, 
					lstep : iLabelsStep,
					tdim : iTotalItemWidth, 
					mdim : iMaxItemWidth, 
					dim : 'w',
					html : aHtml
				});
				iTotalItemWidth = oDimInfo['tdim'];
				iMaxItemWidth = oDimInfo['mdim'];
				self._iCnt++;
			};

			if (self.aValues.length > 0 && self.oItem.bVisible) {
				self._iCnt = 0;
				paintLabel(self.iMinIndex);
				self._iCnt = self.iMaxIndex - self.iMinIndex;
				paintLabel(self.iMaxIndex);
				
				iZeroIndex = ZC._indexof_(self.aValues, 0);
				if (iZeroIndex !== -1 && ZC._b_(self.oData['show-zero'])) {
					self._iCnt = iZeroIndex;
					paintLabel(iZeroIndex);
				}
				self._iCnt = 1;
				for (i=self.iMinIndex+1;i<self.iMaxIndex;i++) {
					if (i%iLabelsStep === 0) {
						paintLabel(i);
					}
				}
			}
			if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
				ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
			}
		}

		if (self.oLabel.bVisible) {
			if (self.oLabel.sText && self.oLabel.sText !== '') {
				oLabel = new ZC.ZCTextBox(self);
				oLabel.copy(self.oLabel);
				oLabel.sId = self.sId + '-label';
				oLabel.sDOMClass = self.sId + '-label ' + self.oParent.sId + '-scale-label zc-scale-label';
				oLabel.sText = self.oLabel.sText;
				oLabel.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();
				if ((self.oLabel.oData['font-color'] === 'inherit' || self.oLabel.oData['color'] === 'inherit') && sPlotColor !== -1) {
					oLabel.sColor = sPlotColor;
				}
				oLabel.iY = self.iY + self.iHeight/2 - oLabel.iHeight/2;
				if (bDefault) {
					oLabel.iX = iX - oLabel.iWidth/2 - oLabel.iHeight/2 - iScaleLabelOffset - iMaxItemWidth;
				} else {
					oLabel.iX = iX + iMaxItemWidth + oLabel.iHeight/2 + iScaleLabelOffset - oLabel.iWidth/2;
				}
				if (oLabel.bVisible) {
					self.sharedLabel3DTransform(oLabel, null, 'v');
					oLabel.paint();
					oLabel.paintPrintVersion();
				}
			}
		}
	}
});











ZC.ZCScaleXi = ZC.ZCScaleK.extend({
	init : function(oParent) {
		this._super(oParent);
		this.bInversed = true;
	},
	parse : function() {
		this._super();
	},
	setupStepSize : function() {
		var self = this;
		if (self.iMaxIndex === self.iMinIndex) {
			self.iStepSize = self.iHeight-self.iOffsetStart-self.iOffsetEnd;
		} else {
			self.iStepSize = (self.iHeight-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
		}
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		self.setupStepSize();
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	zoomTo : function(iMinIndex, iMaxIndex) {
		var self = this;
		self._super(iMinIndex, iMaxIndex);
		self.iStepSize = (self.iHeight-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
	},
	getValueByCoord : function(iY) {
		var self = this, fRatio;
		if (self.bMirrored) {
			fRatio = (iY-self.iY-self.iOffsetStart)/(self.iHeight-self.iOffsetStart-self.iOffsetEnd);
		} else {
			fRatio = (self.iY+self.iHeight-self.iOffsetStart-iY)/(self.iHeight-self.iOffsetStart-self.iOffsetEnd);
		}
		var fValue = self.fMin + ZC._f_((self.fMax-self.fMin)*fRatio);
		return fValue;
	},
	getIndexByCoord : function(iY, oPlot, bPos) {
		var self = this, mValue, iIndex, fRatio;
		if (typeof(bPos) === 'undefined') {
			bPos = false;
		}
		if (self.bMirrored) {
			fRatio = (iY-self.iY-self.iOffsetStart - (self.bRanged?self.iStepSize/2:0))/(self.iHeight-self.iOffsetStart-self.iOffsetEnd - (self.bRanged?self.iStepSize:0));
		} else {
			fRatio = (self.iY+self.iHeight-iY-self.iOffsetStart - (self.bRanged?self.iStepSize/2:0))/(self.iHeight-self.iOffsetStart-self.iOffsetEnd - (self.bRanged?self.iStepSize:0));
		}
		
		var bCorrectKV = false;
		if (oPlot) {
			for (var iKeyValue in oPlot.oKeyPlotAssoc) {
				bCorrectKV = true;
				break;
			}
		}
		if (oPlot && !self.bNonLinearTs && bCorrectKV) {
			var iMinValue = self.aValues[self.iMinIndex];
			if (typeof(iMinValue) === 'string') {
				iMinValue = ZC._indexof_(self.oParent.aKeyAssoc, iMinValue);
			}
			var iMaxValue = self.aValues[self.iMaxIndex];
			if (typeof(iMaxValue) === 'string') {
				iMaxValue = ZC._indexof_(self.oParent.aKeyAssoc, iMaxValue);
			}
			var iValue = iMinValue + ZC._i_((iMaxValue-iMinValue)*fRatio);
			var iMinDiff = ZC.MAX;
			iIndex = null;
			for (var iKeyValue in oPlot.oKeyPlotAssoc) {
				if (ZC._a_(iKeyValue-iValue) < iMinDiff) {
					iMinDiff = ZC._a_(iKeyValue-iValue);
					iIndex = oPlot.oKeyPlotAssoc[iKeyValue];
				}
			}
			if (ZC._n_(iIndex) === null) {
				iIndex = iValue;
			}
			
			var bExact = false;
			if (self.oParent.oCrosshairX && self.oParent.oCrosshairX.oData['exact']) {
				bExact = true;
			}
			if (
				(!bExact && iMinDiff > oPlot.fMaxKeyDiff)
				||
				(bExact && iMinDiff >= self.fStep)
			) {
				return null;
			}
			return iIndex;
		} else {
			var iMinIndex = self.iMinIndex, iMaxIndex = self.iMaxIndex;
			if (self.bKeyValues) {
				if (ZC._n_(mValue=self.aValues[iMinIndex]) !== null) {
					iMinIndex = mValue;
				}
				if (ZC._n_(mValue=self.aValues[iMaxIndex]) !== null) {
					iMaxIndex = mValue;
				}
			}
			if (bPos) {
				if (self.bRanged) {
					iIndex = iMinIndex + (iMaxIndex-iMinIndex+1)*fRatio;
				} else {
					iIndex = iMinIndex + (iMaxIndex-iMinIndex)*fRatio;
				}
			} else {
				if (self.bRanged) {
					iIndex = self.iMinIndex + Math.floor((self.iMaxIndex-self.iMinIndex+1)*fRatio);
				} else {
					iIndex = self.iMinIndex + ZC._i_((self.iMaxIndex-self.iMinIndex)*fRatio);
				}
			}
		}
		iIndex = ZC._max_(0, iIndex);
		iIndex = ZC._min_(self.iMaxIndex_, iIndex);
		return iIndex;
	},
	getCoordByIndex : function(iIndex) {
		var self = this;
		var iMinIndex = self.iMinIndex, iMaxIndex = self.iMaxIndex;
		if (self.bKeyValues && !self.bNonLinearTs) {
			iMinIndex = self.fMin;
			iMaxIndex = self.fMax;
		}
		if (self.bMirrored) {
			return self.iY + self.iOffsetStart + (iIndex-iMinIndex)*self.iStepSize + (self.bRanged?self.iStepSize/2:0);
		} else {
			return self.iY + self.iHeight - self.iOffsetStart - (iIndex-iMinIndex)*self.iStepSize - (self.bRanged?self.iStepSize/2:0);
		}
	},
	getCoordByValue : function(fValue) {
		var self = this, mValue, fRange, fRatio;
		if (self.bNonLinearTs) {
			var iIndex = self.oNonLinearIndexes[fValue];
			return self.getCoordByIndex(iIndex);
		}
		if ((mValue=ZC._indexof_(self.oParent.aKeyAssoc, fValue)) !== -1) {
			return self.getCoordByIndex(mValue);
		}
		if (!self.bKeyAssoc && (self.bKeyValues || (self.oTransform && self.oTransform.oData['type'] === 'date'))) {
			fRange = self.aValues[self.iMaxIndex] - self.aValues[self.iMinIndex];
			fRatio = (self.iHeight - self.iOffsetStart - self.iOffsetEnd - (self.bRanged?self.iStepSize:0))/fRange;
			if (self.bMirrored) {
				return self.iY + self.iOffsetStart + (fValue-self.aValues[self.iMinIndex])*fRatio + (self.bRanged?self.iStepSize/2:0);
			} else {
				return self.iY + self.iHeight - self.iOffsetStart - (fValue-self.aValues[self.iMinIndex])*fRatio - (self.bRanged?self.iStepSize/2:0);
			}
		} else {
			if (self.fMax === self.fMin) {
				fRatio = 0;
			} else {
				fRange = self.fMax - self.fMin + (self.bRanged?1:0);
				fRatio = (self.iHeight - self.iOffsetStart - self.iOffsetEnd)/fRange;
			}
			if (self.bMirrored) {
				return self.iY + self.iOffsetStart + (fValue-self.fMin)*fRatio + (self.bRanged?self.iStepSize/2:0);
			} else {
				return self.iY + self.iHeight - self.iOffsetStart - (fValue-self.fMin)*fRatio - (self.bRanged?self.iStepSize/2:0);
			}
		}
	},
	paint : function() {
		var self = this, mValue, i, iLen, iScaleSpacer, iX, oCanvas, oCtx, oCanvasGuides, oCtxGuides, i0, aPoints, iY_, oCopy, oFace, oBox, j, iItemIdx;

		if (!self.bVisible) { return; }
		self._super();

		
		if ((self.oParent.sType === 'hbubble' || self.oParent.sType === 'hscatter')) {
			
			if ((self.iOffsetStart === -1 && self.iOffsetEnd === -1) || self.aValues.length === 1) {
				self.iOffsetStart = self.iOffsetEnd = self.iHeight/(self.aValues.length+1);
				self.setupStepSize();
			}
		}

		var sPlotColor = self.getPlotColor();

		var iXScales = 0, iCntD = 1, iCntO = 1, oIndexes = {};
		for (i=0,iLen=self.oParent.aScales.length;i<iLen;i++) {
			if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-x' && self.oParent.aScales[i].sPlacement === self.sPlacement) {
				iXScales++;
			}
			if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-x') {
				if (self.oParent.aScales[i].sPlacement === 'default') {
					oIndexes[self.oParent.aScales[i].sName] = iCntD;
					iCntD++;
				} else {
					oIndexes[self.oParent.aScales[i].sName] = iCntO;
					iCntO++;
				}
			}
		}
		var iScaleIndex = oIndexes[self.sName], bDefault = (self.sPlacement === 'default');

		var iXRef = null;
		var oPlotRef = null;
		for (i=0,iLen=self.oParent.oPlotSet.aPlots.length;i<iLen;i++) {
			var oPlot = self.oParent.oPlotSet.aPlots[i];
			var aPlotScales = oPlot.getScales();
			if (ZC._indexof_(aPlotScales, self.sName) !== -1) {
				var oScalePair = self.oParent.getScaleByName(oPlot.getScales('v')[0]);
				iXRef = oScalePair.getCoordByValue(oScalePair.fRefValue);
				oPlotRef = oPlot;
				break;
			}
		}

		var iTickSize = 8;
		if (ZC._n_(self.oTick.oData['size']) !== null) {
			iTickSize = ZC._i_(self.oTick.oData['size']);
		}
		var iMinorTickSize = 4;
		if (ZC._n_(self.oMinorTick.oData['size']) !== null) {
			iMinorTickSize = ZC._i_(self.oMinorTick.oData['size']);
		}

		var iDist = ZC._i_(self.oParent.oAttributes[self.sName + '-distance'] || -1);
		if (self.sPlacement === 'default') {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginLeft/iXScales);
			iX = self.iX - (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iX = self.iX - iDist;
			}
		} else {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginRight/iXScales);
			iX = self.iX + self.iWidth + (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iX = self.iX + self.iWidth + iDist;
			}
		}

		var iXLine = iX;
		
		if (self.oParent.oScrollX && self.sName == 'scale-x') {
			self.oParent.oScrollX.bVisible = true;
			if (self.iMinIndex_ === self.iMinIndex && self.iMaxIndex_ === self.iMaxIndex) {
				self.oParent.oScrollX.bVisible = false;
			}
			if (self.oParent.oScrollX.bVisible && self.oParent.oScrollX.oBarStyle.iOffsetX === 0) {
				iX -= self.oParent.oScrollX.oBarStyle.iWidth + self.iLineWidth/2;
			}
		}

		self.oAttributes['iX'] = iX;

		if (!self.bVisible || !self.bUsed) {
			return;
		}

		var iTicksStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxTicks-1));
		var iLabelsStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxItems-1));

		
		if (ZC._b_(self.oData['normalize'])) {
			iTicksStep = ZC.ZCMath._round_step_(iTicksStep);
			iLabelsStep = ZC.ZCMath._round_step_(iLabelsStep);
		}

		var iMinorStepSize = self.iStepSize*iTicksStep/(self.iMinorTicks+1);
		var iScaleLabelOffset = 0;

		if (ZC._n_(iXRef) === null) {
			iXRef = iX;
		}

		oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
		oCtx = ZC.ZCHtmlUtils._context_(oCanvas, self.oLoader.sOutput);
		oCanvasGuides = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
		oCtxGuides = ZC.ZCHtmlUtils._context_(oCanvasGuides, self.oLoader.sOutput);
		

		if (self.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
			self.sLineColor = sPlotColor;
		}
		if (self.oParent.oSettings['3d']) {
			oFace = ZC.ZCMath3D._create_3d_face_(self, self.oParent, iX - ZC.ZCDraw3D.iViewX, iX - ZC.ZCDraw3D.iViewX, self.iY - ZC.ZCDraw3D.iViewY, self.iY - ZC.ZCDraw3D.iViewY + self.iHeight, 0-1, ZC.ZCDraw3D.iDepth+1, 'y');
			self.oParent.oEngine3D.add(oFace);
		} else {
			aPoints = [
				[iXLine, self.iY + self.iHeight],
				[iXLine, self.iY]
			];
			ZC.ZCLine.paint(oCtx, self, aPoints);
		}

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%c)|(%scale-position)/g, self._iCnt);
			sRule = sRule.replace(/(%i)|(%scale-index)/g, self._iIdx);
			sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[self._iIdx]) !== null)?self.aValues[self._iIdx]:'');
			sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[self._iIdx]) !== null)?self.aLabels[self._iIdx]:'');
			return sRule;
		}

		if (self.aValues.length > 0 && self.oGuide.bVisible) {
			var iGuideOffsetStart = (ZC._n_(self.oGuide.oData['offset-start'])===null)?0:ZC._i_(self.oGuide.oData['offset-start']);
			var iGuideOffsetEnd = (ZC._n_(self.oGuide.oData['offset-end'])===null)?0:ZC._i_(self.oGuide.oData['offset-end']);
			if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0 && !self.oParent.oSettings['3d']) {
				oBox = new ZC.ZCBox(self);
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					i0 = i - self.iMinIndex;
					iItemIdx = i%self.oGuide.oData['items'].length;
					oBox.append(self.oGuide.oData['items'][iItemIdx]);
					oBox.sId = self.sId + '-guide-' + i;
					oBox.oCanvas = oCanvasGuides;
					
					oBox.parse();
					oBox.iX = self.iX + iGuideOffsetStart;
					if (self.bMirrored) {
						oBox.iY = self.iY + self.iOffsetStart + i0*self.iStepSize;
					} else {
						oBox.iY = self.iY + self.iHeight - self.iOffsetStart - (i0+1)*self.iStepSize;
					}
					oBox.iWidth = self.iWidth - iGuideOffsetStart - iGuideOffsetEnd;
					oBox.iHeight = self.iStepSize;
					oBox.paint();
				}
			}
			if (self.oGuide.iLineWidth > 0) {
				self._iCnt = 0;
				for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === (self.iMaxIndex+(self.bRanged?1:0)) || i%iTicksStep === 0) {
						if (self.oGuide.aRules.length > 0 || i === self.iMinIndex) {
							oCopy = new ZC.ZCStyle(self);
							oCopy.oCanvas = oCopy.oCanvasSh = oCanvasGuides;
							oCopy.copy(self.oGuide);
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
						}
						i0 = i - self.iMinIndex;
						aPoints = [];
						if (self.bMirrored) {
							iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize;
						} else {
							iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize;
						}
						var iX_ = self.iX + iGuideOffsetStart;
						var iWidth_ = self.iWidth - iGuideOffsetStart - iGuideOffsetEnd;
						if (oCopy.bVisible) {
							if (self.oParent.oSettings['3d']) {

								var oCopyZ = new ZC.ZCStyle(self);
								oCopyZ.copy(oCopy);
								if (ZC._n_(self.oData['scale-z']) !== null && ZC._n_(mValue=self.oData['scale-z']['guide']) !== null) {
									oCopyZ.append(mValue);
									oCopyZ.parse();
								}

								oCopyZ.sBackgroundColor1 = oCopyZ.sBackgroundColor2 = oCopyZ.sLineColor;
								oFace = ZC.ZCMath3D._create_3d_face_(oCopyZ, self.oParent, iX - ZC.ZCDraw3D.iViewX, iX - ZC.ZCDraw3D.iViewX, iY_ - ZC.ZCDraw3D.iViewY - oCopyZ.iLineWidth/2, iY_ - ZC.ZCDraw3D.iViewY + oCopyZ.iLineWidth/2, 0, ZC.ZCDraw3D.iDepth, 'z');
								self.oParent.oEngine3D.add(oFace);

								oCopy.sBackgroundColor1 = oCopy.sBackgroundColor2 = oCopy.sLineColor;
								oFace = ZC.ZCMath3D._create_3d_face_(oCopy, self.oParent, iX_ - ZC.ZCDraw3D.iViewX, iX_ - ZC.ZCDraw3D.iViewX + iWidth_, iY_ - ZC.ZCDraw3D.iViewY - oCopyZ.iLineWidth/2, iY_ - ZC.ZCDraw3D.iViewY + oCopyZ.iLineWidth/2, ZC.ZCDraw3D.iDepth+2, ZC.ZCDraw3D.iDepth+2, 'x');
								self.oParent.oEngine3D.add(oFace);

							} else {
								aPoints.push(
									[iX_, iY_],
									[iX_ + iWidth_, iY_]
								);
								ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
							}
						}
						self._iCnt++;
					}
				}
			}
		}

		if (self.aValues.length > 0 && self.oMinorGuide.bVisible && iTicksStep === 1 && !self.oParent.oSettings['3d']) {
			if (self.oMinorGuide.oData['items'] && self.oMinorGuide.oData['items'].length > 0) {
				oBox = new ZC.ZCBox(self);
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					i0 = i - self.iMinIndex;
					self._iCnt = 0;
					for (j=1;j<=self.iMinorTicks;j++) {
						iItemIdx = self._iCnt%self.oMinorGuide.oData['items'].length;
						oBox.append(self.oMinorGuide.oData['items'][iItemIdx]);
						oBox.sId = self.sId + '-guide-' + i + '-' + j;
						oBox.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oBox.parse();
						oBox.iX = self.iX;
						if (self.bMirrored) {
							oBox.iY = self.iY + self.iOffsetStart + (i0+1)*self.iStepSize - (j+1)*iMinorStepSize;
						} else {
							oBox.iY = self.iY + self.iHeight - self.iOffsetStart - (i0+1)*self.iStepSize + j*iMinorStepSize;
						}
						oBox.iWidth = self.iWidth;
						oBox.iHeight = iMinorStepSize;
						oBox.paint();
						self._iCnt++;
					}
				}
			}
			if (self.oMinorGuide.iLineWidth > 0) {
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === (self.iMaxIndex+(self.bRanged?1:0)) || i%iTicksStep === 0) {
						i0 = i - self.iMinIndex;
						self._iCnt = 0;
						for (j=1;j<=self.iMinorTicks;j++) {
							aPoints = [];
							oCopy = new ZC.ZCStyle(self);
							oCopy.copy(self.oMinorGuide);
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
							if (self.bMirrored) {
								iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
							} else {
								iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
							}
							if (ZC._btw_(iY_, self.iY, self.iY + self.iHeight)) {
								aPoints.push(
									[self.iX, iY_],
									[self.iX + self.iWidth, iY_]
								);
								if (oCopy.bVisible) {
									ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
								}
							}
							self._iCnt++;
						}
					}
				}
			}
		}

		self.sharedPaintRefLine(oCtxGuides, sPlotColor);

		if (self.aValues.length > 0 && self.oTick.bVisible && (!self.oParent.oSettings['3d'] || !self.oParent.o3DAspect['true3d'])) {
			switch (self.oTick.oData['placement']) {
				case 'inner':
					break;
				case 'outer':
					iScaleLabelOffset += iTickSize;
					break;
				
				default:
					iScaleLabelOffset += iTickSize/2;
					break;
			}

			self._iCnt = 0;
			for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
				self._iIdx = i;
				if (i === self.iMinIndex || i === (self.iMaxIndex+(self.bRanged?1:0)) || i%iTicksStep === 0) {
					aPoints = [];
					i0 = i - self.iMinIndex;
					if (self.oTick.aRules.length > 0 || i === self.iMinIndex) {
						oCopy = new ZC.ZCStyle(self);
						oCopy.copy(self.oTick);
						if (self.oTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
							oCopy.sLineColor = sPlotColor;
						}
						oCopy.parseRule = _parseRule;
						if (oCopy.applyRules()) {
							oCopy.parse();
						}
					}
					if (self.bMirrored) {
						iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize;
					} else {
						iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize;
					}
					switch (oCopy.oData['placement']) {
						case 'ref-auto':
							aPoints.push(
								[iXRef - iTickSize/2, iY_],
								[iXRef + iTickSize/2, iY_]
							);
							break;
						case 'ref-left':
							aPoints.push(
								[iXRef - iTickSize, iY_],
								[iXRef, iY_]
							);
							break;
						case 'ref-right':
							aPoints.push(
								[iXRef + iTickSize, iY_],
								[iXRef, iY_]
							);
							break;
						case 'inner':
							aPoints.push(
								[iX, iY_],
								[iX + ((bDefault)?iTickSize:-iTickSize), iY_]
							);
							break;
						case 'outer':
							aPoints.push(
								[iX, iY_],
								[iX - ((bDefault)?iTickSize:-iTickSize), iY_]
							);
							break;
						
						default:
							aPoints.push(
								[iX + iTickSize/2, iY_],
								[iX - iTickSize/2, iY_]
							);
							break;
					}
					if (oCopy.bVisible) {
						ZC.ZCLine.paint(oCtx, oCopy, aPoints);
					}
					self._iCnt++;
				}
			}
		}

		if (self.aValues.length > 0 && self.iMinorTicks > 0 && self.oMinorTick.bVisible && !self.oParent.oSettings['3d']) {
			for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
				if (i === self.iMinIndex || i === (self.iMaxIndex+(self.bRanged?1:0)) || i%iTicksStep === 0) {
					i0 = i - self.iMinIndex;
					for (j=1;j<=self.iMinorTicks;j++) {
						aPoints = [];
						oCopy = new ZC.ZCStyle(self);
						oCopy.copy(self.oMinorTick);
						if (self.oMinorTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
							oCopy.sLineColor = sPlotColor;
						}
						oCopy.parseRule = _parseRule;
						if (oCopy.applyRules()) {
							oCopy.parse();
						}
						if (self.bMirrored) {
							iY_ = self.iY + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
						} else {
							iY_ = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
						}
						if (ZC._btw_(iY_, self.iY, self.iY + self.iHeight)) {
							switch (oCopy.oData['placement']) {
								case 'ref-auto':
									aPoints.push(
										[iXRef - iMinorTickSize/2, iY_],
										[iXRef + iMinorTickSize/2, iY_]
									);
									break;
								case 'ref-left':
									aPoints.push(
										[iXRef - iMinorTickSize, iY_],
										[iXRef, iY_]
									);
									break;
								case 'ref-right':
									aPoints.push(
										[iXRef + iMinorTickSize, iY_],
										[iXRef, iY_]
									);
									break;
								case 'inner':
									aPoints.push(
										[iX, iY_],
										[iX + ((bDefault)?iMinorTickSize:-iMinorTickSize), iY_]
									);
									break;
								case 'outer':
									aPoints.push(
										[iX, iY_],
										[iX - ((bDefault)?iMinorTickSize:-iMinorTickSize), iY_]
									);
									break;
								
								default:
									aPoints.push(
										[iX + iMinorTickSize/2, iY_],
										[iX - iMinorTickSize/2, iY_]
									);
									break;
							}
							if (oCopy.bVisible) {
								ZC.ZCLine.paint(oCtx, oCopy, aPoints);
							}
						}
						self._iCnt++;
					}
				}
			}
		}

		self.paintMarkers();

		var oLabel, iAngle = null;
		var sFormat_ = self.sFormat, iDecimals_ = self.iDecimals;

		function paintLabel(i) {
			self._iIdx = i;
			i0 = i - self.iMinIndex;
			if (self.oItem.aRules.length > 0 || i === self.iMinIndex) {
				oLabel = new ZC.ZCTextBox(self);
			}
			oLabel.copy(self.oItem);

			oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;
			oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';

			self.sFormat = sFormat_;
			self.iDecimals = iDecimals_;
			self.applyItemRules(_parseRule);

			var sLabel = self.getParsedItemLabel(i);
			if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
				return;
			}
			oLabel.sText = sLabel;

			oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
			
			oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
			oLabel.oAttributes['nodeidx'] = i;
			oLabel.parse();

			if ((self.oItem.oData['font-color'] === 'inherit' || self.oItem.oData['color'] === 'inherit') && sPlotColor !== -1) {
				oLabel.sColor = sPlotColor;
			}
			oLabel.parseRule = _parseRule;
			if (oLabel.applyRules()) {
				oLabel.parse();
			}
			if (oLabel.oData['auto-fit']) {
				oLabel.iHeight = ZC._i_(self.iStepSize);
			}
			switch (oLabel.oData['placement']) {
				case 'inner':
					oLabel.iX = (bDefault)?(iX+iTickSize):(iX-oLabel.iWidth-iTickSize);
					break;
				case 'ref-left':
					oLabel.iX = iXRef-oLabel.iWidth-iTickSize;
					break;
				case 'ref-right':
					oLabel.iX = iXRef+iTickSize;
					break;
				case 'ref-auto':
					if (oPlotRef && oPlotRef.aPlotNodes[i]) {
						oPlotRef.aPlotNodes[i].setup();
						if (oPlotRef.aPlotNodes[i].iX < iXRef) {
							oLabel.iX = iXRef+iTickSize;
						} else {
							oLabel.iX = iXRef-oLabel.iWidth-iTickSize;
						}
					} else {
						oLabel.iX = iXRef+iTickSize;
					}
					break;
				
				default:
					oLabel.iX = (bDefault)?(iX-oLabel.iWidth-iTickSize):(iX+iTickSize);
					break;
			}
			if (self.bMirrored) {
				oLabel.iY = self.iY + self.iOffsetStart + i0*self.iStepSize - oLabel.iHeight/2 + (self.bRanged?self.iStepSize/2:0);
			} else {
				oLabel.iY = self.iY + self.iHeight - self.iOffsetStart - i0*self.iStepSize - oLabel.iHeight/2 - (self.bRanged?self.iStepSize/2:0);
			}

			iAngle = self.sharedLabel3DTransform(oLabel, iAngle);

			if (self.oItem.oData['auto-align'] && self.oItem.iAngle%180 !== 0) {
				var iMultiplier = (bDefault?1:-1);
				if (self.oItem.iAngle === 90 || self.oItem.iAngle === 270) {
					oLabel.iX += iMultiplier*(oLabel.iWidth/2 - oLabel.iHeight/2);
				} else {
					if (ZC._btw_(self.oItem.iAngle, 0, 90) || ZC._btw_(self.oItem.iAngle, 270, 360)) {
						oLabel.iX += iMultiplier*(oLabel.iWidth - oLabel.iWidth*ZC._cos_(self.oItem.iAngle))/2;
						oLabel.iY -= iMultiplier*oLabel.iWidth*ZC._sin_(self.oItem.iAngle)/2;
					} else if (ZC._btw_(self.oItem.iAngle, 90, 270)) {
						oLabel.iX += iMultiplier*(oLabel.iWidth + oLabel.iWidth*ZC._cos_(self.oItem.iAngle))/2;
						oLabel.iY += iMultiplier*oLabel.iWidth*ZC._sin_(self.oItem.iAngle)/2;
					}
				}
			}

			var oDimInfo = self.sharedPaintLabel(oLabel, i, {
				items : iItems,
				lcoords : aLabelsCoords,
				lstep : iLabelsStep,
				tdim : iTotalItemWidth,
				mdim : iMaxItemWidth,
				dim : 'w',
				html : aHtml
			});
			iTotalItemWidth = oDimInfo['tdim'];
			iMaxItemWidth = oDimInfo['mdim'];

			self._iCnt++;
		}

		var iTotalItemWidth = 0;
		var iMaxItemWidth = 0;
		var iItems = 0;
		var aLabelsCoords = [];
		var aHtml = [];
		if (self.aValues.length == 1 && self.oItem.bVisible) {
			self._iCnt = 0;
			paintLabel(self.iMinIndex);
		} else if (self.aValues.length > 1 && self.oItem.bVisible) {
			self._iCnt = 0;
			paintLabel(self.iMinIndex);
			self._iCnt = self.iMaxIndex - self.iMinIndex;
			paintLabel(self.iMaxIndex);
			self._iCnt = 1;
			for (i=self.iMinIndex+1;i<self.iMaxIndex;i++) {
				if (i%iLabelsStep === 0) {
					paintLabel(i);
				}
			}
		}
		if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
			ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
		}

		if (self.oLabel.bVisible) {
			if (self.oLabel.sText && self.oLabel.sText !== '') {
				oLabel = new ZC.ZCTextBox(self);
				oLabel.copy(self.oLabel);
				oLabel.sId = self.sId + '-label';
				oLabel.sDOMClass = self.sId + '-label ' + self.oParent.sId + '-scale-label zc-scale-label';
				oLabel.sText = self.oLabel.sText;
				oLabel.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();
				if ((self.oLabel.oData['font-color'] === 'inherit' || self.oLabel.oData['color'] === 'inherit') && sPlotColor !== -1) {
					oLabel.sColor = sPlotColor;
				}
				oLabel.iY = self.iY + self.iHeight/2 - oLabel.iHeight/2;
				if (bDefault) {
					oLabel.iX = iX - oLabel.iWidth/2 - oLabel.iHeight/2 - iScaleLabelOffset - iMaxItemWidth;
				} else {
					oLabel.iX = iX + oLabel.iHeight/2 + iMaxItemWidth + iScaleLabelOffset - oLabel.iWidth/2;
				}
				if (oLabel.bVisible) {
					self.sharedLabel3DTransform(oLabel, null, 'v');
					oLabel.paint();
					oLabel.paintPrintVersion();
				}
			}
		}

	}
});











ZC.ZCScaleYi = ZC.ZCScaleV.extend({
	init : function(oParent) {
		this._super(oParent);
		this.bInversed = true;
	},
	parse : function() {
		this._super();
	},
	setupStepSize : function() {
		var self = this;
		if (self.iMaxIndex === self.iMinIndex) {
			self.iStepSize = self.iWidth-self.iOffsetStart-self.iOffsetEnd;
		} else {
			self.iStepSize = (self.iWidth-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
		}
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		self.setupStepSize();
	},
	zoomTo : function(fMin, fMax) {
		var self = this;
		self._super(fMin, fMax);
		self.iStepSize = (self.iWidth-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex+(self.bRanged?1:0));
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	getValueByCoord : function(iX, bExp) {
		var self = this, fRatio;
		if (self.bMirrored) {
			fRatio = (self.iX+self.iWidth-self.iOffsetStart-iX)/(self.iWidth-self.iOffsetStart-self.iOffsetEnd);
		} else {
			fRatio = (iX-self.iX-self.iOffsetStart)/(self.iWidth-self.iOffsetStart-self.iOffsetEnd);
		}
		var fValue = self.fMin + ZC._f_((self.fMax-self.fMin)*fRatio);
		if (self.sProgression === 'log' && bExp) {
			fValue = Math.exp(fValue);
		}
		return fValue;
	},
	getCoordByValue : function(fValue) {
		var self = this;
		var fRange = self.fMax - self.fMin;
		var fRatio = (fRange===0)?0:((self.iWidth - self.iOffsetStart - self.iOffsetEnd)/fRange);
		if (self.sProgression === 'log') {
			fValue = ZC._log_(fValue);
		}
		if (self.bMirrored) {
			return self.iX + self.iWidth - self.iOffsetStart - (fValue-self.fMin)*fRatio;
		} else {
			return self.iX + self.iOffsetStart + (fValue-self.fMin)*fRatio;
		}
	},
	paint : function() {
		var self = this, mValue, i, iLen, iY, oCanvas, oCtx, oCanvasGuides, oCtxGuides, aPoints, i0, iX_, oCopy, oFace, j, iScaleSpacer, iItemIdx, oBox, iZeroIndex, oLabel;
		if (!self.bVisible || self.aValues.length === 0) { return; }

		self._super();

		
		if ((self.oParent.sType === 'hbubble' || self.oParent.sType === 'hscatter') && self.aValues.length === 1) {
			self.iOffsetStart = self.iWidth/2;
		}

		var sPlotColor = self.getPlotColor();

		var iYScales = 0, iCntD = 1, iCntO = 1, oIndexes = {};
		for (i=0,iLen=self.oParent.aScales.length;i<iLen;i++) {
			if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-y' && self.oParent.aScales[i].sPlacement === self.sPlacement) {
				iYScales++;
			}
			if (self.oParent.aScales[i].sName.substring(0, 7) === 'scale-y') {
				if (self.oParent.aScales[i].sPlacement === 'default') {
					oIndexes[self.oParent.aScales[i].sName] = iCntD;
					iCntD++;
				} else {
					oIndexes[self.oParent.aScales[i].sName] = iCntO;
					iCntO++;
				}
			}
		}
		var iScaleIndex = oIndexes[self.sName], bDefault = (self.sPlacement === 'default');

		var iTickSize = 8;
		if (ZC._n_(self.oTick.oData['size']) !== null) {
			iTickSize = ZC._i_(self.oTick.oData['size']);
		}
		var iMinorTickSize = 4;
		if (ZC._n_(self.oMinorTick.oData['size']) !== null) {
			iMinorTickSize = ZC._i_(self.oMinorTick.oData['size']);
		}

		var iDist = ZC._i_(self.oParent.oAttributes[self.sName + '-distance'] || -1);
		if (self.sPlacement === 'default') {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginBottom/iYScales);
			iY = self.iY + self.iHeight + (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iY = self.iY + self.iHeight + iDist;
			}
		} else {
			iScaleSpacer = ZC._i_(self.oParent.oPlotArea.iMarginTop/iYScales);
			iY = self.iY - (iScaleIndex-1)*iScaleSpacer;
			if (iDist !== -1) {
				iY = self.iY - iDist;
			}
		}

		var iYLine = iY;
		
		if (self.oParent.oScrollY) {
			self.oParent.oScrollY.bVisible = true;
			if (self.fMin_ === self.fMin && self.fMax_ === self.fMax) {
				self.oParent.oScrollY.bVisible = false;
			}
			if (self.oParent.oScrollY.bVisible && self.oParent.oScrollY.oBarStyle.iOffsetY === 0) {
				iY += self.oParent.oScrollY.oBarStyle.iHeight + self.iLineWidth/2;
			}
		}

		self.oAttributes['iY'] = iY;

		if (!self.bVisible || !self.bUsed) { 
			return; 
		}

		var iLabelsStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxItems-1));
		var iTicksStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxTicks-1));
		
		
		if (ZC._b_(self.oData['normalize'])) {
			iTicksStep = ZC.ZCMath._round_step_(iTicksStep);
			iLabelsStep = ZC.ZCMath._round_step_(iLabelsStep);
		}

		var iScaleLabelOffset = 0;
		var iMinorStepSize = self.iStepSize*iTicksStep/(self.iMinorTicks+1);
		oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
		oCtx = ZC.ZCHtmlUtils._context_(oCanvas, self.oLoader.sOutput);
		oCanvasGuides = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
		oCtxGuides = ZC.ZCHtmlUtils._context_(oCanvasGuides, self.oLoader.sOutput);
		

		
		if (!self.bUsed && !self.bForceView && ZC._n_(self.oParent.oData[self.sName]) === null) {
			return;
		}

		if (self.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
			self.sLineColor = sPlotColor;
		}
		if (self.oParent.oSettings['3d']) {
			oFace = ZC.ZCMath3D._create_3d_face_(self, self.oParent, self.iX - ZC.ZCDraw3D.iViewX, self.iX - ZC.ZCDraw3D.iViewX + self.iWidth, iY - ZC.ZCDraw3D.iViewY, iY - ZC.ZCDraw3D.iViewY, -1, ZC.ZCDraw3D.iDepth+1, 'x');
			self.oParent.oEngine3D.add(oFace);
		} else {
			aPoints = [
				[self.iX, iYLine],
				[self.iX + self.iWidth, iYLine]
			];
			ZC.ZCLine.paint(oCtx, self, aPoints);
		}

		var aLabelsCoords = [];
		var iTotalItemHeight = 0;
		var iMaxItemHeight = 0;
		var iItems = 0;
		var aHtml = [];

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%c)|(%scale-position)/g, self._iCnt);
			sRule = sRule.replace(/(%i)|(%scale-index)/g, self._iIdx);
			sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[self._iIdx]) !== null)?self.aValues[self._iIdx]:'');
			sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[self._iIdx]) !== null)?self.aLabels[self._iIdx]:'');
			return sRule;
		}

		
		if (self.bUsed || self.bForceView) {

			if (self.aValues.length > 0 && self.oGuide.bVisible) {
				var iGuideOffsetStart = (ZC._n_(self.oGuide.oData['offset-start'])===null)?0:ZC._i_(self.oGuide.oData['offset-start']);
				var iGuideOffsetEnd = (ZC._n_(self.oGuide.oData['offset-end'])===null)?0:ZC._i_(self.oGuide.oData['offset-end']);
				if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0 && !self.oParent.oSettings['3d']) {
					self._iCnt = 0;
					oBox = new ZC.ZCBox(self);
					for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex-1 || i%iTicksStep === 0) {
							i0 = i - self.iMinIndex;
							iItemIdx = self._iCnt%self.oGuide.oData['items'].length;
							oBox.append(self.oGuide.oData['items'][iItemIdx]);
							oBox.sId = self.sId + '-guide-' + i;
							oBox.oCanvas = oCanvasGuides;
							
							oBox.parse();
							if (self.bMirrored) {
								iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize;
							} else {
								iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize;
							}
							oBox.iX = iX_;
							oBox.iY = self.iY + iGuideOffsetStart;
							oBox.iWidth = self.iStepSize*iTicksStep;
							oBox.iHeight = self.iHeight - iGuideOffsetStart - iGuideOffsetEnd;
							oBox.paint();
							self._iCnt++;
						}
					}
				}
				if (self.oGuide.iLineWidth > 0) {
					self._iCnt = 0;
					for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
							if (self.oGuide.aRules.length > 0 || i === self.iMinIndex) {
								oCopy = new ZC.ZCStyle(self);
								oCopy.oCanvas = oCopy.oCanvasSh = oCanvasGuides;
								oCopy.copy(self.oGuide);
								oCopy.parseRule = _parseRule;
								if (oCopy.applyRules()) {
									oCopy.parse();
								}
							}
							aPoints = [];
							i0 = i - self.iMinIndex;
							var iY_ = self.iY + iGuideOffsetStart;
							var iHeight_ = self.iHeight - iGuideOffsetStart - iGuideOffsetEnd;
							if (self.bMirrored) {
								iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize;
							} else {
								iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize;
							}
							if (oCopy.bVisible) {
								if (self.oParent.oSettings['3d']) {

									var oCopyZ = new ZC.ZCStyle(self);
									oCopyZ.copy(oCopy);
									if (ZC._n_(self.oData['scale-z']) !== null && ZC._n_(mValue=self.oData['scale-z']['guide']) !== null) {
										oCopyZ.append(mValue);
										oCopyZ.parse();
									}

									oCopyZ.sBackgroundColor1 = oCopyZ.sBackgroundColor2 = oCopyZ.sLineColor;
									oFace = ZC.ZCMath3D._create_3d_face_(oCopyZ, self.oParent, iX_ - ZC.ZCDraw3D.iViewX - oCopyZ.iLineWidth/2, iX_ - ZC.ZCDraw3D.iViewX + oCopyZ.iLineWidth/2, iY - ZC.ZCDraw3D.iViewY, iY - ZC.ZCDraw3D.iViewY, 0, ZC.ZCDraw3D.iDepth, 'z');
									self.oParent.oEngine3D.add(oFace);

									oCopy.sBackgroundColor1 = oCopy.sBackgroundColor2 = oCopy.sLineColor;
									oFace = ZC.ZCMath3D._create_3d_face_(oCopy, self.oParent, iX_ - ZC.ZCDraw3D.iViewX - oCopy.iLineWidth/2, iX_ - ZC.ZCDraw3D.iViewX + oCopy.iLineWidth/2, iY_ - ZC.ZCDraw3D.iViewY, iY_ - ZC.ZCDraw3D.iViewY + iHeight_, ZC.ZCDraw3D.iDepth+2, ZC.ZCDraw3D.iDepth+2, 'y');
									self.oParent.oEngine3D.add(oFace);

								} else {
									aPoints.push(
										[iX_, iY_],
										[iX_, iY_ + iHeight_]
									);
									ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
								}
							}
							self._iCnt++;
						}
					}
				}
			}

			if (self.aValues.length > 0 && self.oMinorGuide.bVisible && iMinorStepSize > 2 && !self.oParent.oSettings['3d']) {
				if (self.oMinorGuide.oData['items'] && self.oMinorGuide.oData['items'].length > 0) {
					oBox = new ZC.ZCBox(self);
					for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
							i0 = i - self.iMinIndex;
							self._iCnt = 0;
							for (j=0;j<=self.iMinorTicks;j++) {
								iItemIdx = self._iCnt%self.oMinorGuide.oData['items'].length;
								oBox.append(self.oMinorGuide.oData['items'][iItemIdx]);
								oBox.sId = self.sId + '-guide-' + i + '-' + j;
								oBox.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
								
								oBox.parse();
								if (self.bMirrored) {
									iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - (j+1)*iMinorStepSize;
								} else {
									iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
								}
								oBox.iX = iX_;
								oBox.iY = self.iY;
								oBox.iWidth = iMinorStepSize;
								oBox.iHeight = self.iHeight;
								oBox.paint();
								self._iCnt++;
							}
						}
					}
				}
				if (self.oMinorGuide.iLineWidth > 0) {
					for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
						self._iIdx = i;
						if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
							i0 = i - self.iMinIndex;
							self._iCnt = 0;
							for (j=1;j<=self.iMinorTicks;j++) {
								aPoints = [];
								oCopy = new ZC.ZCStyle(self);
								oCopy.copy(self.oMinorGuide);
								oCopy.parseRule = _parseRule;
								if (oCopy.applyRules()) {
									oCopy.parse();
								}
								if (self.sProgression === 'log' && zingchart.DEV.TRUELOG) {
									iX_ = self.getCoordByValue(j*self.aValues[i+1]/(self.iMinorTicks+1));
								} else {
									if (self.bMirrored) {
										iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
									} else {
										iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
									}
								}
								if (ZC._btw_(iX_, self.iX, self.iX + self.iWidth)) {
									aPoints.push(
										[iX_, self.iY],
										[iX_, self.iY + self.iHeight]
									);
									if (oCopy.bVisible) {
										ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
									}
								}
								self._iCnt++;
							}
						}
					}
				}
			}

			self.sharedPaintRefLine(oCtxGuides, sPlotColor);

			if (self.aValues.length > 0 && self.oTick.bVisible && (!self.oParent.oSettings['3d'] || !self.oParent.o3DAspect['true3d'])) {
				switch (self.oTick.oData['placement']) {
					case 'inner':
						break;
					case 'outer':
						iScaleLabelOffset += iTickSize;
						break;
					
					default:
						iScaleLabelOffset += iTickSize/2;
						break;
				}
				self._iCnt = 0;
				
				iZeroIndex = ZC._indexof_(self.aValues, 0);
				for (i=self.iMinIndex;i<=self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0 || (ZC._b_(self.oData['show-zero']) && i === iZeroIndex)) {
						aPoints = [];
						i0 = i - self.iMinIndex;
						if (self.oTick.aRules.length > 0 || i === self.iMinIndex) {
							oCopy = new ZC.ZCStyle(self);
							oCopy.copy(self.oTick);
							if (self.oTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
								oCopy.sLineColor = sPlotColor;
							}
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
						}
						if (self.bMirrored) {
							iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize;
						} else {
							iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize;
						}
						switch (oCopy.oData['placement']) {
							case 'inner':
								aPoints.push(
									[iX_, iY - ((bDefault)?iTickSize:-iTickSize)],
									[iX_, iY]
								);
								break;
							case 'outer':
								aPoints.push(
									[iX_, iY],
									[iX_, iY + ((bDefault)?iTickSize:-iTickSize)]
								);
								break;
							
							default:
								aPoints.push(
									[iX_, iY + iTickSize/2],
									[iX_, iY - iTickSize/2]
								);
								break;
						}
						if (oCopy.bVisible) {
							ZC.ZCLine.paint(oCtx, oCopy, aPoints);
						}
						self._iCnt++;
					}
				}
			}

			if (self.aValues.length > 0 && self.oMinorTick.bVisible && self.iMinorTicks > 0 && iMinorStepSize > 5 && !self.oParent.oSettings['3d']) {
				for (i=self.iMinIndex;i<self.iMaxIndex+(self.bRanged?1:0);i++) {
					self._iIdx = i;
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
						i0 = i - self.iMinIndex;
						self._iCnt = 0;
						for (j=1;j<=self.iMinorTicks;j++) {
							aPoints = [];
							oCopy = new ZC.ZCStyle(self);
							oCopy.copy(self.oMinorTick);
							if (self.oMinorTick.oData['line-color'] === 'inherit' && sPlotColor !== -1) {
								oCopy.sLineColor = sPlotColor;
							}
							oCopy.parseRule = _parseRule;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
							if (self.sProgression === 'log' && zingchart.DEV.TRUELOG) {
								iX_ = self.getCoordByValue(j*self.aValues[i+1]/(self.iMinorTicks+1));
							} else {
								if (self.bMirrored) {
									iX_ = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - j*iMinorStepSize;
								} else {
									iX_ = self.iX + self.iOffsetStart + i0*self.iStepSize + j*iMinorStepSize;
								}
							}
							if (ZC._btw_(iX_, self.iX, self.iX + self.iWidth)) {
								switch (oCopy.oData['placement']) {
									case 'inner':
										aPoints.push(
											[iX_, iY - ((bDefault)?iMinorTickSize:-iMinorTickSize)],
											[iX_, iY]
										);
										break;
									
									default:
										aPoints.push(
											[iX_, iY],
											[iX_, iY + ((bDefault)?iMinorTickSize:-iMinorTickSize)]
										);
										break;
									case 'cross':
										aPoints.push(
											[iX_, iY + iMinorTickSize/2],
											[iX_, iY - iMinorTickSize/2]
										);
										break;
								}
								if (oCopy.bVisible) {
									ZC.ZCLine.paint(oCtx, oCopy, aPoints);
								}
							}
							self._iCnt++;
						}
					}
				}
			}

			self.paintMarkers();

			var iAngle = null;
			var sFormat_ = self.sFormat, iDecimals_ = self.iDecimals;

			var paintLabel = function(i) {
				self._iIdx = i;
				i0 = i - self.iMinIndex;
				if (self.oItem.aRules.length > 0 || i === self.iMinIndex) {
					oLabel = new ZC.ZCTextBox(self);
				}
				oLabel.copy(self.oItem);
				
				oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
				oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;

				self.sFormat = sFormat_;
				self.iDecimals = iDecimals_;
				self.applyItemRules(_parseRule);

				var sLabel = self.getParsedItemLabel(i);
				if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
					return;
				}
				oLabel.sText = sLabel;
				oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();
				if ((self.oItem.oData['font-color'] === 'inherit' || self.oItem.oData['color'] === 'inherit') && sPlotColor !== -1) {
					oLabel.sColor = sPlotColor;
				}
				oLabel.parseRule = _parseRule;
				oLabel.aRules = self.oItem.aRules;
				if (oLabel.applyRules()) {
					oLabel.parse();
				}
				switch (oLabel.oData['placement']) {
					case 'inner':
						oLabel.iY = (bDefault)?(iY-oLabel.iTextHeight-iTickSize):(iY+iTickSize);
						break;
					
					default:
						oLabel.iY = (bDefault)?(iY+iTickSize):(iY-oLabel.iTextHeight-iTickSize);
						break;
				}
				if (self.bMirrored) {
					oLabel.iX = self.iX + self.iWidth - self.iOffsetStart - i0*self.iStepSize - oLabel.iTextWidth/2 - (self.bRanged?self.iStepSize/2:0);
				} else {
					oLabel.iX = self.iX + self.iOffsetStart + i0*self.iStepSize - oLabel.iTextWidth/2 + (self.bRanged?self.iStepSize/2:0);
				}

				iAngle = self.sharedLabel3DTransform(oLabel, iAngle);

				if (self.oItem.oData['auto-align'] && self.oItem.iAngle%180 !== 0) {
					var iMultiplier = ZC._btw_(self.oItem.iAngle, 0, 180)?(bDefault?1:-1):(bDefault===1?-1:1);
					oLabel.iX += iMultiplier*oLabel.iWidth*ZC._cos_(self.oItem.iAngle)/2;
					oLabel.iY += iMultiplier*(oLabel.iWidth*ZC._sin_(self.oItem.iAngle)/2 - oLabel.iHeight*ZC._sin_(self.oItem.iAngle)/2);
				}

				var oDimInfo = self.sharedPaintLabel(oLabel, i, {
					items : iItems, 
					lcoords : aLabelsCoords, 
					lstep : iLabelsStep,
					tdim : iTotalItemHeight, 
					mdim : iMaxItemHeight, 
					dim : 'h',
					html : aHtml
				});
				iTotalItemHeight = oDimInfo['tdim'];
				iMaxItemHeight = oDimInfo['mdim'];

				self._iCnt++;
			};

			if (self.aValues.length > 0 && self.oItem.bVisible) {
				self._iCnt = 0;
				paintLabel(self.iMinIndex);
				self._iCnt = self.iMaxIndex - self.iMinIndex;
				paintLabel(self.iMaxIndex);
				
				iZeroIndex = ZC._indexof_(self.aValues, 0);
				if (iZeroIndex !== -1 && ZC._b_(self.oData['show-zero'])) {
					self._iCnt = iZeroIndex;
					paintLabel(iZeroIndex);
				}
				self._iCnt = 1;
				for (i=self.iMinIndex+1;i<self.iMaxIndex;i++) {
					if (i%iLabelsStep === 0) {
						paintLabel(i);
					}
				}
			}
			if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
				ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
			}
		}

		if (self.oLabel.bVisible) {
			if (self.oLabel.sText && self.oLabel.sText !== '') {
				oLabel = new ZC.ZCTextBox(self);
				oLabel.copy(self.oLabel);
				oLabel.sId = self.sId + '-label';
				oLabel.sDOMClass = self.sId + '-label ' + self.oParent.sId + '-scale-label zc-scale-label';
				oLabel.sText = self.oLabel.sText;
				oLabel.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oLabel.oDOMParent = self.oLoader.usc()?ZC._id_(self.oLoader.sId + '-main'):ZC._id_(self.oLoader.sId + '-text');
				oLabel.parse();
				if ((self.oLabel.oData['font-color'] === 'inherit' || self.oLabel.oData['color'] === 'inherit') && sPlotColor !== -1) {
					oLabel.sColor = sPlotColor;
				}
				oLabel.iX = self.iX + self.iWidth/2 - oLabel.iWidth/2;
				if (bDefault) {
					oLabel.iY = iY + iScaleLabelOffset + iMaxItemHeight;
				} else {
					oLabel.iY = iY - iMaxItemHeight - oLabel.iHeight - iScaleLabelOffset;
				}
				if (oLabel.bVisible) {
					self.sharedLabel3DTransform(oLabel, null, 'h');
					oLabel.paint();
					oLabel.paintPrintVersion();
				}
			}
		}

	}
});











ZC.ZCScaleM = ZC.ZCScaleK.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.sLayout = '';
		self.iRows = 1;
		self.iCols = 1;
		self.iHStepSize = 0;
		self.iVStepSize = 0;
		self.fSizeFactor = 0.6;
	},
	parse : function() {
		var self = this;
		self._super();
		self.iX += self.iMarginLeft;
		self.iY += self.iMarginTop;
		self.iWidth -= self.iMarginLeft + self.iMarginRight;
		self.iHeight -= self.iMarginTop + self.iMarginBottom;
		self.assign('layout', 'sLayout');
		if (ZC._n_(self.oData['size-factor']) !== null) {
			self.fSizeFactor = ZC._f_(ZC._p_(self.oData['size-factor']));
		}
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		if (self.aValues.length === 0) {
			self.aValues = [''];
		}
		var aLayout = ZC.ZCMath._layout_(self.sLayout, self.aValues.length, false);
		self.iRows = aLayout[0];
		self.iCols = aLayout[1];
		self.iHStepSize = self.iWidth/self.iCols;
		self.iVStepSize = self.iHeight/self.iRows;
	},
	setupBounds : function() {
		var self = this;
		self._super();
		self.iHStepSize = self.iWidth/self.iCols;
		self.iVStepSize = self.iHeight/self.iRows;
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	paint : function() {
		var self = this, oCtx, oCtxGuides, aPoints, i, iLen;
		if (!self.bVisible) { return; }
		self._super();

		oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-ml-0-c'), self.oLoader.sOutput);
		oCtxGuides = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-bl-0-c'), self.oLoader.sOutput);
		

		aPoints = [];
		aPoints.push(
			[self.iX, self.iY],
			[self.iX + self.iWidth, self.iY],
			[self.iX + self.iWidth, self.iY + self.iHeight],
			[self.iX, self.iY + self.iHeight],
			[self.iX, self.iY]
		);
		ZC.ZCLine.paint(oCtx, self, aPoints);

		if (self.oGuide.bVisible) {
			if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0) {
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					var iCol = i%self.iCols;
					var iRow = Math.floor(i/self.iCols);
					var oBox = new ZC.ZCBox(self);
					var iItemIdx = i%self.oGuide.oData['items'].length;
					oBox.oData = self.oGuide.oData['items'][iItemIdx];
					oBox.sId = self.sId + '-guide-' + i;
					oBox.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
					
					oBox.parse();
					oBox.iX = self.iX + iCol*self.iHStepSize;
					oBox.iY = self.iY + iRow*self.iVStepSize;
					oBox.iWidth = self.iHStepSize;
					oBox.iHeight = self.iVStepSize;
					oBox.paint();
				}
			}
			if (self.oGuide.iLineWidth > 0) {
				aPoints = [];
				for (i=0;i<=self.iCols;i++) {
					aPoints.push(
						[self.iX + i*self.iHStepSize, self.iY],
						[self.iX + i*self.iHStepSize, self.iY + self.iHeight],
						null
					);
				}
				for (i=0;i<=self.iRows;i++) {
					aPoints.push(
						[self.iX, self.iY + i*self.iVStepSize],
						[self.iX + self.iWidth, self.iY + i*self.iVStepSize],
						null
					);
				}
				ZC.ZCLine.paint(oCtxGuides, self.oGuide, aPoints);
			}
		}

		var oLabel;

		function paintLabel(i) {
			if (self.oItem.aRules.length > 0 || i === 0) {
				oLabel = new ZC.ZCTextBox(self);
			}
			oLabel.copy(self.oItem);
			var iCol = i%self.iCols;
			var iRow = Math.floor(i/self.iCols);
			oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
			oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;
			var sLabel = self.getParsedItemLabel(i);
			if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
				return;
			}
			oLabel.sText = sLabel;
			oLabel.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
			
			oLabel.parse();
			oLabel.parseRule = function(sRule) {
				sRule = sRule.replace(/%i/g, i);
				sRule = sRule.replace(/%v/g, (ZC._n_(self.aValues[i]) !== null)?self.aValues[i]:'');
				sRule = sRule.replace(/%l/g, (ZC._n_(self.aLabels[i]) !== null)?self.aLabels[i]:'');
				return sRule;
			};
			oLabel.aRules = self.oItem.aRules;
			if (oLabel.applyRules()) {
				oLabel.parse();
			}
			if (oLabel.bVisible) {
				var sPlacement = 'bottom';
				if (ZC._n_(self.oItem.oData['placement']) !== null) {
					sPlacement = self.oItem.oData['placement'];
				}
				var iX_ = self.iX + iCol*self.iHStepSize;
				var iY_ = self.iY + iRow*self.iVStepSize;
				switch (sPlacement) {
					case 'top-left':
						oLabel.iX = iX_;
						oLabel.iY = iY_;
						break;
					case 'top-right':
						
						oLabel.iX = iX_ + self.iHStepSize - oLabel.iWidth;
						oLabel.iY = iY_;
						break;
					case 'bottom-left':
						oLabel.iX = iX_;
						
						oLabel.iY = iY_ + self.iVStepSize - oLabel.iHeight;
						break;
					case 'bottom-right':
						oLabel.iX = iX_ + self.iHStepSize - oLabel.iWidth;
						oLabel.iY = iY_ + self.iVStepSize - oLabel.iHeight;
						break;
					case 'top':
						oLabel.iX = iX_ + self.iHStepSize/2 - oLabel.iWidth/2;
						oLabel.iY = iY_;
						break;
					case 'right':
						oLabel.iX = iX_ + self.iHStepSize - oLabel.iWidth;
						oLabel.iY = iY_ + self.iVStepSize/2 - oLabel.iHeight/2;
						break;
					case 'left':
						oLabel.iX = iX_;
						oLabel.iY = iY_ + self.iVStepSize/2 - oLabel.iHeight/2;
						break;
					
					default:
						oLabel.iX = iX_ + self.iHStepSize/2 - oLabel.iWidth/2;
						oLabel.iY = iY_ + self.iVStepSize - oLabel.iHeight;
						break;
				}
				oLabel.paint();
				oLabel.paintPrintVersion();
				if (!oLabel.bFlat)  {
					aHtml.push(ZC.ZCUtils._box_area_(self.oParent.sId, oLabel));
				}
			}
		}

		if (self.oItem.bVisible) {
			var aHtml = [];
			for (i=0,iLen=self.aValues.length;i<iLen;i++) {
				paintLabel(i);
			}
			if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
				ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
			}
		}

	}
});









ZC.ZCScaleRK = ZC.ZCScaleK.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.iRefAngle = 0;
		self.iAperture = 360;
	},
	parse : function() {
		var self = this, mValue;
		self._super();
		if (ZC._n_(mValue=self.oData['ref-angle']) !== null) {
			self.iRefAngle = ZC._i_(mValue)%360;
		}
		if (ZC._n_(mValue=self.oData['aperture']) !== null) {
			self.iAperture = ZC._i_(mValue)%360;
			if (self.iAperture === 0) {
				self.iAperture = 360;
			}
		}
	}
});









ZC.ZCScaleRV = ZC.ZCScaleV.extend({
	init : function(oParent) {
		this._super(oParent);
	},
	parse : function() {
		this._super();
	},
	setupStepSize : function() {
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		self.setupStepSize();
	},
	clear : function() {
		this._super();
	},
	build : function() {
		this._super();
	},
	paint : function() {
		this._super();
	}
});










ZC.ZCGaugeScaleRV = ZC.ZCScaleRV.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.iRefAngle = -90;
		self.iAperture = 180;
		self.oCenter = null;
		self.oRing = null;
		self.sAspect = 'circle';
	},
	parse : function() {
		var self = this, mValue;
		self._super();
		if (ZC._n_(mValue=self.oData['ref-angle']) !== null) {
			self.iRefAngle = ZC._i_(mValue)%360;
		}
		if (ZC._n_(mValue=self.oData['aperture']) !== null) {
			self.iAperture = ZC._i_(mValue);
		}
		if (ZC._n_(mValue=self.oData['center']) !== null) {
			self.oCenter = new ZC.ZCShape(self);
			self.oCenter.append(mValue);
			self.oCenter.parse();
		}
		if (ZC._n_(mValue=self.oData['ring']) !== null) {
			self.oRing = new ZC.ZCShape(self);
			self.oLoader.oDefaults.load(self.oRing.oData, [
				self.oParent.sType + '.' + self.sName + '.ring'
			]);
			self.oRing.append(mValue);
			self.oRing.parse();
		}
	},
	setupValues : function(iStep) {
		this._super(iStep);
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	getCoords : function(iIndex, iRadius) {
		var self = this;
		var oScaleM = self.oParent.getScaleByName('scale');
		var iCX = oScaleM.iX + oScaleM.iWidth/2;
		var iCY = oScaleM.iY + oScaleM.iHeight/2;
		var fAngleStep = 360/self.aValues.length;
		var oScaleVal = self.oParent.getScaleByName('scale-v');
		return ZC.ZCMath._cpoint_(iCX, iCY, iRadius + oScaleVal.iOffsetStart, self.iRefAngle+iIndex*fAngleStep);
	},
	paint : function() {
		var self = this, oCtxGuides, i, iLen, iSize, oRing, aPoints, iItemIdx, fAngle, aP;
		if (!self.bVisible || self.aValues.length === 0) { return; }

		if (self.bMirrored) {
			self.aValues.reverse();
		}

		oCtxGuides = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-bl-0-c'), self.oLoader.sOutput);
		

		var iTickSize = ZC._i_(self.oTick.oData['size'] || 8);
		var iMinorTickSize = ZC._i_(self.oMinorTick.oData['size'] || 4);
		var iScaleLabelOffset = 0;

		var iTicksStep = ZC._max_(1, Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxTicks-1)));
		var iLabelsStep = ZC._max_(1, Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxItems-1)));

		var oScale = self.oParent.getScaleByName('scale-' + self.iIndex);
		if (!oScale) {
			oScale = self.oParent.getScaleByName('scale');
		}
		var iRadius = ZC._min_(oScale.iHStepSize/2, oScale.iVStepSize/2)*oScale.fSizeFactor;

		var fAngleStep = self.iAperture/(self.aValues.length-1);

		function _parseRule(sRule) {
			sRule = sRule.replace(/%i/g, i);
			sRule = sRule.replace(/%k/g, i);
			sRule = sRule.replace(/%v/g, (ZC._n_(self.aValues[i]) !== null)?self.aValues[i]:'');
			sRule = sRule.replace(/%l/g, (ZC._n_(self.aLabels[i]) !== null)?self.aLabels[i]:'');
			return sRule;
		}

		for (var iIndex=0;iIndex<oScale.aValues.length;iIndex++) {
			var iCol = iIndex%oScale.iCols;
			var iRow = Math.floor(iIndex/oScale.iCols);
			var iCX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX;
			var iCY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY;

			var oPie = new ZC.ZCShape(self);
			oPie.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
			
			oPie.copy(self);
			oPie.sId = self.sId + '-' + iIndex;
			oPie.iX = iCX;
			oPie.iY = iCY;
			oPie.iSize = iRadius-0.5;
			oPie.sShape = (self.iAperture === 360)?'circle':'pie';
			oPie.iPieAngleStart = self.iRefAngle - self.iAperture/2 + 360;
			oPie.iPieAngleEnd = self.iRefAngle + self.iAperture/2 + 360;
			oPie.iPieSlice = 0;
			oPie.parse();
			oPie.paint();

			if (self.oGuide.bVisible) {

				if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0) {
					for (i=0;i<self.aValues.length-1;i++) {
						oPie = new ZC.ZCShape(self);
						iItemIdx = i%self.oGuide.oData['items'].length;
						oPie.append(self.oGuide.oData['items'][iItemIdx]);
						oPie.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oPie.iX = iCX;
						oPie.iY = iCY;
						oPie.sId = self.sId + '-pie-' + i;
						oPie.oData['type'] = 'pie';
						oPie.oData['size'] = iRadius - self.iOffsetEnd;
						oPie.iPieSlice = self.iOffsetStart;
						oPie.iPieAngleStart = (self.iRefAngle - self.iAperture/2 + i*fAngleStep + 360);
						oPie.iPieAngleEnd = (self.iRefAngle - self.iAperture/2 + (i+1)*fAngleStep + 360);
						oPie.parse();
						oPie.paint();
					}
				}

				if (self.oGuide.iLineWidth > 0) {

					for (i=0,iLen=self.aValues.length;i<iLen;i++) {
						var oCopy = new ZC.ZCStyle(self);
						oCopy.copy(self.oGuide);
						
						oCopy.parseRule = _parseRule;
						oCopy.aRules = self.oGuide.aRules;
						if (oCopy.applyRules()) {
							oCopy.parse();
						}
						aPoints = [];
						aPoints.push(ZC.ZCMath._cpoint_(iCX, iCY, iRadius - self.iOffsetEnd, self.iRefAngle - self.iAperture/2+i*fAngleStep));
						aPoints.push(ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart, self.iRefAngle - self.iAperture/2+i*fAngleStep));
						ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
					}
				}

			}

			if (self.oRing) {

				if (self.oRing.oData['items'] && self.oRing.oData['items'].length > 0) {
					for (i=0;i<self.aValues.length-1;i++) {
						oRing = new ZC.ZCShape(self);
						oRing.append(self.oRing.oData);
						iItemIdx = i%self.oRing.oData['items'].length;
						oRing.append(self.oRing.oData['items'][iItemIdx]);
						oRing.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oRing.sId = self.sId + '-ring-' + i;
						oRing.iX = iCX;
						oRing.iY = iCY;
						oRing.oData['type'] = 'pie';
						iSize = ZC._i_(oRing.oData['size']);
						iSize = ZC._max_(0, ZC._min_(iSize, iRadius));
						oRing.iPieSlice = iRadius - iSize;
						oRing.oData['size'] = iRadius;
						oRing.iPieAngleStart = (self.iRefAngle - self.iAperture/2 + i*fAngleStep + 360);
						oRing.iPieAngleEnd = (self.iRefAngle - self.iAperture/2 + (i+1)*fAngleStep + 360) + 0.25;
						oRing.parse();
						
						oRing.parseRule = _parseRule;
						oRing.aRules = self.oRing.aRules;
						if (oRing.applyRules()) {
							oRing.parse();
						}
						
						if (iSize + oRing.iBorderWidth > 0) {
							oRing.paint();
						}
					}
				}

				
				oRing = new ZC.ZCShape(self);
				oRing.append(self.oRing.oData);
				oRing.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
				
				oRing.sId = self.sId + '-ring';
				oRing.iX = iCX;
				oRing.iY = iCY;

				if (self.iAperture !== 360) {
					oRing.oData['type'] = 'pie';
					iSize = ZC._i_(oRing.oData['size']);
					iSize = ZC._max_(1, ZC._min_(iSize, iRadius));
					oRing.iPieSlice = iRadius - iSize;
					oRing.oData['size'] = iRadius;
					oRing.iPieAngleStart = (self.iRefAngle - self.iAperture/2 + 360);
					oRing.iPieAngleEnd = (self.iRefAngle + self.iAperture/2 + 360);
				} else {
					oRing.oData['type'] = 'circle';
					iSize = ZC._i_(oRing.oData['size']);
					iSize = ZC._max_(1, ZC._min_(iSize, iRadius));
					oRing.oData['size'] = iRadius;
				}

				oRing.parse();
				
				if (iSize + oRing.iBorderWidth > 0) {
					oRing.paint();

					if (self.iAperture === 360) {
						oRing.sId = self.sId + '-ring-inner';
						oRing.oData['size'] = iRadius - iSize;
						oRing.parse();
						oRing.paint();
					}

				}

			}

			if (self.oTick.bVisible) {
				switch (self.oTick.oData['placement']) {
					case 'outer':
						iScaleLabelOffset += iTickSize;
						break;
					
					default:
						iScaleLabelOffset += iTickSize/2;
						break;
				}

				aPoints = [];
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
						fAngle = self.iRefAngle - self.iAperture/2 + i*fAngleStep;
						aP = [0, 0];
						switch (self.oTick.oData['placement']) {
							case 'inner':
								aP = [-iTickSize, 0];
								break;
							case 'outer':
								aP = [0, iTickSize];
								break;
							
							default:
								aP = [-iTickSize/2, iTickSize/2];
								break;
						}
						aPoints.push(
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius+aP[0], fAngle),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius+aP[1], fAngle),
							null
						);
					}
				}
				ZC.ZCLine.paint(oCtxGuides, self.oTick, aPoints);
			}

			if (self.oMinorTick.bVisible && self.iMinorTicks > 0) {
				aPoints = [];
				for (i=0,iLen=self.aValues.length;i<iLen-1;i++) {
					fAngle = self.iRefAngle - self.iAperture/2 + i*fAngleStep;
					var fMinorAngleStep = fAngleStep/(self.iMinorTicks+1);
					for (var j=1;j<=self.iMinorTicks;j++) {
						aP = [0, 0];
						switch (self.oMinorTick.oData['placement']) {
							case 'inner':
								aP = [-iMinorTickSize, 0];
								break;
							case 'outer':
								aP = [0, iMinorTickSize];
								break;
							
							default:
								aP = [-iMinorTickSize/2, iMinorTickSize/2];
								break;
						}
						aPoints.push(
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius+aP[0], fAngle + j*fMinorAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius+aP[1], fAngle + j*fMinorAngleStep),
							null
						);
					}
				}
				ZC.ZCLine.paint(oCtxGuides, self.oMinorTick, aPoints);
			}

			if (self.oItem.bVisible) {
				var aHtml = [];
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iLabelsStep === 0) {
						var oLabel = new ZC.ZCTextBox(self);
						oLabel.append(self.oItem.oData);
						oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
						oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + iIndex + '_' + i;
						var sLabel = self.getParsedItemLabel(i);
						oLabel.sText = sLabel;
						oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
						
						oLabel.parse();
						
						oLabel.parseRule = _parseRule;
						oLabel.aRules = self.oItem.aRules;
						if (oLabel.applyRules()) {
							oLabel.parse();
						}
						if (oLabel.bVisible) {
							oLabel.iHeight = oLabel.iTextHeight;
							var iLabelRadius = Math.sqrt(oLabel.iWidth*oLabel.iWidth/4 + oLabel.iHeight*oLabel.iHeight/4)*1.15;
							
							var aPoint = ZC.ZCMath._cpoint_(iCX, iCY, iRadius + self.oItem.iOffsetR + iLabelRadius + iScaleLabelOffset, self.iRefAngle - self.iAperture/2+i*fAngleStep);
							oLabel.iX = aPoint[0] - oLabel.iWidth/2;
							oLabel.iY = aPoint[1] - oLabel.iHeight/2;
							oLabel.paint();
							oLabel.paintPrintVersion();
							if (!oLabel.bFlat)  {
								aHtml.push(ZC.ZCUtils._box_area_(self.oParent.sId, oLabel));
								
							}
						}
					}
				}
				if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
					ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
				}
			}

		}

	},

	paint_ : function() {
		var self = this;
		var oScale = self.oParent.getScaleByName('scale');

		for (var iIndex=0;iIndex<oScale.aValues.length;iIndex++) {
			var iCol = iIndex%oScale.iCols;
			var iRow = Math.floor(iIndex/oScale.iCols);
			var iCX = oScale.iX + iCol*oScale.iHStepSize + oScale.iHStepSize/2 + oScale.iOffsetX;
			var iCY = oScale.iY + iRow*oScale.iVStepSize + oScale.iVStepSize/2 + oScale.iOffsetY;
			if (self.oCenter) {
				var oCenter = new ZC.ZCShape(self);
				oCenter.append(self.oCenter.oData);
				oCenter.oCanvas = oCenter.oCanvasSh = self.oLoader.usc()?self.oLoader.mc('top'):ZC._id_(self.oParent.sId + '-scales-ml-0-c');
				
				oCenter.sId = self.sId + '-' + iIndex + '-center';
				oCenter.iX = iCX;
				oCenter.iY = iCY;
				oCenter.oData['type'] = 'circle';
				oCenter.parse();
				oCenter.paint();
			}
		}
	}
});










ZC.ZCRadarScaleRK = ZC.ZCScaleRK.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		self.iRefAngle = 0;
		self.sAspect = 'star';
	},
	parse : function() {
		var self = this;
		self._super();
		self.assign_a([
			['aspect', 'sAspect'],
			['ref-angle', 'iRefAngle', 'i']
		]);
		
	},
	setupValues : function(iStep) {
		this._super(iStep);
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	getCoords : function(iIndex, iRadius) {
		var self = this;
		var oScaleM = self.oParent.getScaleByName('scale');
		var iCX = oScaleM.iX + oScaleM.iWidth/2;
		var iCY = oScaleM.iY + oScaleM.iHeight/2;
		var fAngleStep = self.iAperture/(self.aValues.length-(self.iAperture===360?0:1));
		var oScaleVal = self.oParent.getScaleByName('scale-v');
		return ZC.ZCMath._cpoint_(iCX, iCY, iRadius + oScaleVal.iOffsetStart, self.iRefAngle+((360-self.iAperture)/2)+iIndex*fAngleStep);
	},
	paint : function() {
		var self = this, oCtx, oCtxGuides, i, iLen, iItemIdx, aPoints, oCopy;
		if (!self.bVisible || self.aValues.length === 0) { return; }
		self._super();

		oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-ml-0-c'), self.oLoader.sOutput);
		oCtxGuides = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-bl-0-c'), self.oLoader.sOutput);
		

		var iTickSize = ZC._i_(self.oTick.oData['size'] || 8);
		var iScaleLabelOffset = 0;

		var oScaleM = self.oParent.getScaleByName('scale');
		var iRadius = ZC._min_(oScaleM.iWidth/2, oScaleM.iHeight/2)*oScaleM.fSizeFactor;

		var oScaleVal = self.oParent.getScaleByName('scale-v');

		var iCX = oScaleM.iX + oScaleM.iWidth/2;
		var iCY = oScaleM.iY + oScaleM.iHeight/2;
		var fAngleStep = self.iAperture/(self.aValues.length-(self.iAperture===360?0:1));

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%i)|(%scale-index)/g, i);
			sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[i]) !== null)?self.aValues[i]:'');
			sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[i]) !== null)?self.aLabels[i]:'');
			return sRule;
		}

		if (self.oGuide.bVisible) {
			if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0) {
				for (i=0,iLen=self.aValues.length-(self.iAperture===360?0:1);i<iLen;i++) {
					if (self.sAspect === 'circle') {
						var oPie = new ZC.ZCShape(self);
						iItemIdx = i%self.oGuide.oData['items'].length;
						oPie.append(self.oGuide.oData['items'][iItemIdx]);
						oPie.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oPie.iX = iCX;
						oPie.iY = iCY;
						oPie.oData['type'] = 'pie';
						oPie.oData['size'] = iRadius;
						oPie.iPieSlice = oScaleVal.iOffsetStart;
						oPie.iPieAngleStart = self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep;
						oPie.iPieAngleEnd = self.iRefAngle+((360-self.iAperture)/2)+(i+1)*fAngleStep;
						oPie.parse();
						oPie.paint();
					} else {
						var oArea = new ZC.ZCShape(self);
						iItemIdx = i%self.oGuide.oData['items'].length;
						oArea.oData = self.oGuide.oData['items'][iItemIdx];
						oArea.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oArea.iLineWidth = 0;
						oArea.iBorderWidth = 0;
						oArea.iLineSegmentSize = 0;
						oArea.iLineGapSize = 0;
						aPoints = [];
						aPoints.push(
							ZC.ZCMath._cpoint_(iCX, iCY, oScaleVal.iOffsetStart, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius, self.iRefAngle+((360-self.iAperture)/2)+(i+1)*fAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, oScaleVal.iOffsetStart, self.iRefAngle+((360-self.iAperture)/2)+(i+1)*fAngleStep)
						);
						oArea.aPoints = aPoints;
						oArea.parse();
						var oPlotArea = self.oParent.oPlotArea;
						oArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
						oArea.paint();
					}
				}
			}
			if (self.oGuide.iLineWidth > 0) {
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					oCopy = new ZC.ZCStyle(self);
					oCopy.copy(self.oGuide);
					oCopy.sId = self.sId + '-guide-' + i;
					oCopy.parseRule = _parseRule;
					oCopy.aRules = self.oGuide.aRules;
					if (oCopy.applyRules()) {
						oCopy.parse();
					}
					aPoints = [];
					aPoints.push(
						ZC.ZCMath._cpoint_(iCX, iCY, iRadius, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep),
						ZC.ZCMath._cpoint_(iCX, iCY, oScaleVal.iOffsetStart, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep)
					);
					ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
				}
			}
		}

		if (self.oTick.bVisible) {
			switch (self.oTick.oData['placement']) {
				case 'inner':
					break;
				case 'outer':
					iScaleLabelOffset += iTickSize;
					break;
				
				default:
					iScaleLabelOffset += iTickSize/2;
					break;
			}

			aPoints = [];
			for (i=0,iLen=self.aValues.length;i<iLen;i++) {
				oCopy = new ZC.ZCStyle(self);
				oCopy.copy(self.oTick);
				switch (oCopy.oData['placement']) {
					case 'inner':
						aPoints = [
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius-iTickSize, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep)
						];
						break;
					case 'outer':
						aPoints = [
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius+iTickSize, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep)
						];
						break;
					
					default:
						aPoints = [
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius-iTickSize/2, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep),
							ZC.ZCMath._cpoint_(iCX, iCY, iRadius+iTickSize/2, self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep)
						];
						break;
				}
				oCopy.sId = self.sId + '-tick-' + i;
				ZC.ZCLine.paint(oCtx, oCopy, aPoints);
			}
		}

		var oLabel;

		function paintLabel(i) {
			if (self.oItem.aRules.length > 0 || i === 0) {
				oLabel = new ZC.ZCTextBox(self);
			}
			oLabel.copy(self.oItem);
			oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
			oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;
			var sLabel = self.getParsedItemLabel(i);
			if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
				return;
			}
			oLabel.sText = sLabel;
			oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
			
			oLabel.parse();
			oLabel.parseRule = function(sRule) {
				sRule = sRule.replace(/(%i)|(%scale-index)/g, i);
				sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[i]) !== null)?self.aValues[i]:'');
				sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[i]) !== null)?self.aLabels[i]:'');
				return sRule;
			};
			oLabel.aRules = self.oItem.aRules;
			if (oLabel.applyRules()) {
				oLabel.parse();
			}
			oLabel.iWidth = oLabel.iTextWidth;
			oLabel.iHeight = oLabel.iTextHeight;
			var iOffsetR = ZC._dimension_(oLabel.iOffsetR);
			if (iOffsetR < 1) {
				iOffsetR *= iRadius;
			}
			var aPoint = ZC.ZCMath._cpoint_(iCX, iCY, iRadius + iOffsetR + iScaleLabelOffset + ZC._a_(10*ZC._sin_(self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep)) + ZC._a_((oLabel.iWidth/2)*ZC._cos_(self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep)), self.iRefAngle+((360-self.iAperture)/2)+i*fAngleStep);
			oLabel.iX = aPoint[0] - oLabel.iWidth/2;
			oLabel.iY = aPoint[1] - oLabel.iHeight/2;
			oLabel.paint();
			oLabel.paintPrintVersion();
			if (!oLabel.bFlat)  {
				aHtml.push(ZC.ZCUtils._box_area_(self.oParent.sId, oLabel));
				
			}
		}

		if (self.oItem.bVisible) {
			var aHtml = [];
			for (i=0,iLen=self.aValues.length;i<iLen;i++) {
				paintLabel(i);
			}
			if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
				ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
			}
		}

	}
});










ZC.ZCRadarScaleRV = ZC.ZCScaleV.extend({
	init : function(oParent) {
		this._super(oParent);
	},
	parse : function() {
		var self = this;
		self._super();
	},
	setupStepSize : function() {
		var self = this;
		var oScaleM = self.oParent.getScaleByName('scale');
		var iRadius = ZC._min_(oScaleM.iWidth/2, oScaleM.iHeight/2)*oScaleM.fSizeFactor;
		self.iStepSize = (iRadius-self.iOffsetStart-self.iOffsetEnd)/(self.iMaxIndex-self.iMinIndex);
	},
	setupValues : function(iStep) {
		var self = this;
		self._super(iStep);
		self.setupStepSize();
	},
	setupMaxItems : function() {
		var self = this;
		var oScaleM = self.oParent.getScaleByName('scale');
		var iRadius = ZC._min_(oScaleM.iWidth/2, oScaleM.iHeight/2)*oScaleM.fSizeFactor;
		self.iMaxItems = ZC._max_(2, ZC._i_((iRadius-self.iOffsetStart-self.iOffsetEnd)/20));
	},
	getRadiusByValue : function(fValue) {
		var self = this;
		var oScaleM = self.oParent.getScaleByName('scale');
		var iRadius = ZC._min_(oScaleM.iWidth/2, oScaleM.iHeight/2)*oScaleM.fSizeFactor;
		var fRange = self.fMax - self.fMin;
		var fRatio = (iRadius - self.iOffsetStart - self.iOffsetEnd)/fRange;
		return (fValue-self.fMin)*fRatio;
	},
	clear : function() {
	},
	build : function() {
		this._super();
	},
	paint : function() {
		var self = this, oCtx, oCtxGuides, i, iLen, j, jLen, aPoints;
		if (!self.bVisible || self.aValues.length === 0) { return; }
		self._super();

		oCtx = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-ml-0-c'), self.oLoader.sOutput);
		oCtxGuides = ZC.ZCHtmlUtils._context_(self.oLoader.usc()?(self.oLoader.sId + '-main-c'):(self.oParent.sId + '-scales-bl-0-c'), self.oLoader.sOutput);
		

		var oScaleKey = self.oParent.getScaleByName('scale-k');

		var iTickSize = ZC._i_(self.oTick.oData['size'] || 8);
		var iScaleLabelOffset = 0;
		var iLabelsStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxItems-1));
		var iTicksStep = Math.ceil((self.iMaxIndex-self.iMinIndex)/(self.iMaxTicks-1));

		var oScaleM = self.oParent.getScaleByName('scale');
		var iRadius = ZC._min_(oScaleM.iWidth/2, oScaleM.iHeight/2)*oScaleM.fSizeFactor;

		var iCX = oScaleM.iX + oScaleM.iWidth/2 + oScaleM.iOffsetX;
		var iCY = oScaleM.iY + oScaleM.iHeight/2 + oScaleM.iOffsetY;
		var fAngleStep = oScaleKey.iAperture/(oScaleKey.aValues.length-(oScaleKey.iAperture===360?0:1));

		function _parseRule(sRule) {
			sRule = sRule.replace(/(%i)|(%scale-index)/g, i);
			sRule = sRule.replace(/(%v)|(%scale-value)/g, (ZC._n_(self.aValues[i]) !== null)?self.aValues[i]:'');
			sRule = sRule.replace(/(%l)|(%scale-label)/g, (ZC._n_(self.aLabels[i]) !== null)?self.aLabels[i]:'');
			return sRule;
		}

		if (self.oGuide.bVisible) {
			if (self.oGuide.oData['items'] && self.oGuide.oData['items'].length > 0) {
				for (i=0,iLen=self.aValues.length;i<iLen-1;i++) {
					var iItemIdx = i%self.oGuide.oData['items'].length;
					if (oScaleKey.sAspect === 'circle') {
						var oPie = new ZC.ZCShape(self);
						oPie.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						oPie.append(self.oGuide.oData['items'][iItemIdx]);
						oPie.oData['type'] = 'pie';
						oPie.oData['size'] = self.iOffsetStart+(i+1)*self.iStepSize;
						oPie.iX = iCX;
						oPie.iY = iCY;
						oPie.iPieSlice = self.iOffsetStart+i*self.iStepSize;
						if (oScaleKey.iAperture === 360) {
							oPie.iPieAngleStart = 0;
							oPie.iPieAngleEnd = 360;
						} else {
							oPie.iPieAngleStart = oScaleKey.iRefAngle + ((360-oScaleKey.iAperture)/2);
							oPie.iPieAngleEnd = oScaleKey.iRefAngle + ((360-oScaleKey.iAperture)/2) + oScaleKey.iAperture;
						}
						oPie.parse();
						oPie.paint();
					} else {
						var oArea = new ZC.ZCShape(self);
						oArea.append(self.oGuide.oData['items'][iItemIdx]);
						oArea.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
						
						aPoints = [];
						for (j=0,jLen=oScaleKey.aValues.length;j<jLen;j++) {
							aPoints.push(ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+i*self.iStepSize, oScaleKey.iRefAngle+((360-oScaleKey.iAperture)/2)+j*fAngleStep));
						}
						if (oScaleKey.iAperture === 360) {
							aPoints.push(
								ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+i*self.iStepSize, oScaleKey.iRefAngle),
								ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+(i+1)*self.iStepSize, oScaleKey.iRefAngle)
							);
						}
						for (j=oScaleKey.aValues.length-1;j>=0;j--) {
							aPoints.push(ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+(i+1)*self.iStepSize, oScaleKey.iRefAngle+((360-oScaleKey.iAperture)/2)+j*fAngleStep));
						}
						oArea.aPoints = aPoints;
						oArea.parse();
						oArea.iLineWidth = 0;
						oArea.iBorderWidth = 0;
						oArea.iLineSegmentSize = 0;
						oArea.iLineGapSize = 0;
						var oPlotArea = self.oParent.oPlotArea;
						oArea.aBounds = [oPlotArea.iX, oPlotArea.iY, oPlotArea.iX+oPlotArea.iWidth, oPlotArea.iY+oPlotArea.iHeight];
						oArea.paint();
					}
				}
			}

			if (self.oGuide.iLineWidth > 0) {
				for (i=0,iLen=self.aValues.length;i<iLen;i++) {
					if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
						if (oScaleKey.sAspect === 'circle') {
							var oCircle = new ZC.ZCShape(self);
							oCircle.oCanvas = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-bl-0-c');
							
							oCircle.append(self.oGuide.oData);
							
							
							var iAperture = oScaleKey.iAperture;
							if (iAperture === 360) {
								iAperture = 359;
							}
							oCircle.append({
								type : 'arc',
								size : self.iOffsetStart+i*self.iStepSize,
								angleStart : oScaleKey.iRefAngle + ((360-iAperture)/2) - 0.25,
								angleEnd : oScaleKey.iRefAngle + ((360-iAperture)/2) + iAperture + 0.25
							});
							oCircle.sId = self.sId + '-guide-' + i;

							oCircle.iX = iCX;
							oCircle.iY = iCY;
							oCircle.parse();
							oCircle.parseRule = _parseRule;
							oCircle.aRules = self.oGuide.aRules;
							if (oCircle.applyRules()) {
								oCircle.parse();
							}
							
							
							oCircle.paint();
						} else {
							var oCopy = new ZC.ZCStyle(self);
							oCopy.copy(self.oGuide);
							oCopy.sId = self.sId + '-guide-' + i;
							oCopy.parseRule = _parseRule;
							oCopy.aRules = self.oGuide.aRules;
							if (oCopy.applyRules()) {
								oCopy.parse();
							}
							aPoints = [];
							for (j=0,jLen=oScaleKey.aValues.length-(oScaleKey.iAperture===360?0:1);j<jLen;j++) {
								aPoints.push(
									ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+i*self.iStepSize, oScaleKey.iRefAngle+((360-oScaleKey.iAperture)/2)+j*fAngleStep),
									ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+i*self.iStepSize, oScaleKey.iRefAngle+((360-oScaleKey.iAperture)/2)+(j+1)*fAngleStep)
								);
							}
							ZC.ZCLine.paint(oCtxGuides, oCopy, aPoints);
						}
					}
				}
			}
		}

		if (self.oRefLine.bVisible) {
			if (self.oRefLine.iLineWidth > 0) {
				aPoints = [];
				aPoints.push(
					ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart, oScaleKey.iRefAngle),
					ZC.ZCMath._cpoint_(iCX, iCY, iRadius-self.iOffsetEnd, oScaleKey.iRefAngle)
				);
				ZC.ZCLine.paint(oCtx, self.oRefLine, aPoints);
			}
		}

		if (self.oTick.bVisible) {
			switch (self.oTick.oData['placement']) {
				case 'inner':
					break;
				case 'outer':
					iScaleLabelOffset += iTickSize;
					break;
				
				default:
					iScaleLabelOffset += iTickSize/2;
					break;
			}

			aPoints = [];
			for (i=0,iLen=self.aValues.length;i<iLen;i++) {
				if (i === self.iMinIndex || i === self.iMaxIndex || i%iTicksStep === 0) {
					var aPoint = ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+i*self.iStepSize, oScaleKey.iRefAngle);
					switch (self.oTick.oData['placement']) {
						case 'inner':
							aPoints.push([aPoint[0], aPoint[1]]);
							if (oScaleKey.iRefAngle%180 === 0) {
								aPoints.push([aPoint[0], aPoint[1] - iTickSize]);
							} else {
								aPoints.push([aPoint[0] - iTickSize, aPoint[1]]);
							}
							aPoints.push(null);
							break;
						case 'outer':
							aPoints.push([aPoint[0], aPoint[1]]);
							if (oScaleKey.iRefAngle%180 === 0) {
								aPoints.push([aPoint[0], aPoint[1] + iTickSize]);
							} else {
								aPoints.push([aPoint[0] + iTickSize, aPoint[1]]);
							}
							aPoints.push(null);
							break;
						
						default:
							if (oScaleKey.iRefAngle%180 === 0) {
								aPoints.push(
									[aPoint[0], aPoint[1] - iTickSize/2],
									[aPoint[0], aPoint[1] + iTickSize/2]
								);
							} else {
								aPoints.push(
									[aPoint[0] - iTickSize/2, aPoint[1]],
									[aPoint[0] + iTickSize/2, aPoint[1]]
								);
							}
							aPoints.push(null);
							break;
					}
				}
			}
			ZC.ZCLine.paint(oCtx, self.oTick, aPoints);
		}

		var oLabel;

		function paintLabel(i) {
			oLabel = new ZC.ZCTextBox(self);
			oLabel.oData = self.oItem.oData;
			oLabel.sId = self.oParent.sId + '-' + self.sName.replace(/\-/g, '_') + '-item_' + i;
			oLabel.sDOMClass = self.sId + '-item ' + self.oParent.sId + '-scale-item zc-scale-item';
			var sLabel = self.getParsedItemLabel(i);
			oLabel.sText = sLabel;
			if (ZC._n_(self.aShowLabels) !== null && ZC._indexof_(self.aShowLabels, sLabel) === -1) {
				return;
			}
			oLabel.oCanvas = oLabel.oCanvasSh = self.oLoader.usc()?self.oLoader.mc():ZC._id_(self.oParent.sId + '-scales-ml-0-c');
			
			oLabel.parse();
			var aPoint = ZC.ZCMath._cpoint_(iCX, iCY, self.iOffsetStart+i*self.iStepSize, oScaleKey.iRefAngle);
			oLabel.iHeight = oLabel.iTextHeight;
			oLabel.iWidth = oLabel.iTextWidth;
			if (oScaleKey.iRefAngle%180 === 0) {
				oLabel.iX = aPoint[0] - oLabel.iWidth/2;
				oLabel.iY = aPoint[1];
			} else {
				oLabel.iX = aPoint[0];
				oLabel.iY = aPoint[1] - oLabel.iHeight/2;
			}
			switch (self.oTick.oData['placement']) {
				case 'inner':
					break;
				case 'outer':
					if (oScaleKey.iRefAngle%180 === 0) {
						oLabel.iY += iTickSize;
					} else {
						oLabel.iX += iTickSize;
					}
					break;
				
				default:
					if (oScaleKey.iRefAngle%180 === 0) {
						oLabel.iY += iTickSize/2;
					} else {
						oLabel.iX += iTickSize/2;
					}
					break;
			}
			oLabel.paint();
			oLabel.paintPrintVersion();
			if (!oLabel.bFlat)  {
				aHtml.push(ZC.ZCUtils._box_area_(self.oParent.sId, oLabel));
				
			}
		}

		var aHtml = [];
		if (self.aValues.length > 0 && self.oItem.bVisible) {
			self._iCnt = 0;
			paintLabel(self.iMinIndex);
			self._iCnt = self.iMaxIndex - self.iMinIndex;
			paintLabel(self.iMaxIndex);
			self._iCnt = 1;
			for (i=self.iMinIndex+1;i<self.iMaxIndex;i++) {
				if (i%iLabelsStep === 0) {
					paintLabel(i);
				}
			}
		}
		if (aHtml.length > 0 && ZC._id_(self.oParent.oParent.sId + '-map')) {
			ZC._id_(self.oParent.oParent.sId + '-map').innerHTML += aHtml.join('');
		}
	}
});











ZC.ZCScaleMarker = ZC.ZCShape.extend({
	init : function(oParent) {
		var self = this;
		self._super(oParent);
		
		self.fAlpha = 0.25;
		self.iIndex = 0;
		self.sType = null;
		self.oLabel = null;
		self.aRange = null;
		self.bValueRange = false;
		self.sPlacement = 'bottom';
		self.iOffsetStart = 0;
		self.iOffsetEnd = 0;
		self.sLabelPlacement = 'normal'; 
		self.sLabelAlignment = 'normal'; 
		self.aLabelOffsets = [0, 0];
		self.sPairScale = '';
	},
	parse : function() {
		var self = this, mValue;
		self._super();
		self.assign_a([
			['type', 'sType'],
			['value-range', 'bValueRange', 'b'],
			['offset-start', 'iOffsetStart', 'i'],
			['offset-end', 'iOffsetEnd', 'i'],
			['placement', 'sPlacement'],
			['pair-scale', 'sPairScale'],
			['label-placement', 'sLabelPlacement'],
			['label-alignment', 'sLabelAlignment'],
			['range', 'aRange']
		]);
		if (ZC._n_(mValue=self.oData['label']) !== null || ZC._n_(self.oData['text']) !== null) {
			self.oLabel = new ZC.ZCTextBox(self);
			self.oParent.oParent.oParent.oDefaults.load(self.oLabel.oData, [
				'(' + self.oParent.sType + ').SCALE.marker.label'
			]);
			if (ZC._n_(self.oData['text']) !== null) {
				self.oLabel.append({text : self.oData['text']});
			}
			self.oLabel.append(mValue);
			self.oLabel.parse();
			self.aLabelOffsets = [self.oLabel.iOffsetX, self.oLabel.iOffsetY];
		}
		
	},
	paint : function() {
		var self = this, oCtxMarkers, p, pLen, oPoint3D, aPoints, i, iLen;

		if (!self.bVisible) { return; }
		var oScale = self.oParent;
		var iBorderOffset = self.oParent.oParent.oPlotArea.iBorderWidth;
		var sCanvasId = oScale.oParent.sId + '-scales-' + ((self.sPlacement==='top')?'f':'b') + 'l-0-c';
		self.oCanvas = self.oCanvasSh = ZC._id_(oScale.oLoader.usc()?(oScale.oLoader.sId + '-main-c'):sCanvasId);
		oCtxMarkers = ZC.ZCHtmlUtils._context_(self.oCanvas, oScale.oLoader.sOutput);
		
		var iCoord1, iCoord2, iCoord3, iCoord4;
		aPoints = [];
		var iRangeOffsetStart = 0;
		var iRangeOffsetEnd = 0;
		var iAvgX = 0, iAvgY = 0;
		var oArea;

		if (self.iOffsetX > -1 && self.iOffsetX < 1) {
			self.iOffsetX = Math.ceil(self.iOffsetX*oScale.iStepSize);
		}
		if (self.iOffsetY > -1 && self.iOffsetY < 1) {
			self.iOffsetY = Math.ceil(self.iOffsetY*oScale.iStepSize);
		}

		if (self.oLabel) {
			self.oLabel.oCanvas = oScale.oLoader.usc()?oScale.oLoader.mc():ZC._id_(oScale.oParent.sId + '-scales-ml-0-c');
			
			
			self.oLabel.sId = self.oParent.oParent.sId + '-' + self.oParent.sName.replace(/\-/g, '_') + '-marker_' + self.iIndex;
			self.oLabel.sDOMClass = self.oParent.sId + '-marker-label ' + self.oParent.oParent.sId + '-scale-marker-label zc-scale-marker-label';
		}

		var _get_coord_ = function(oScale, iCoord) {
			return self.bValueRange?oScale.getCoordByValue(iCoord):oScale.getCoordByIndex(iCoord); 
		};

		if (self.sType === 'poly') {
			var oScaleX, oScaleY, iX, iY, oGraph = self.oParent.oParent;
			if (oScale.sType === 'k') {
				oScaleX = oScale;
				if (self.sPairScale === '') {
					oScaleY = oGraph.getScales('v')[0];
				} else {
					oScaleY = oGraph.getScaleByName(self.sPairScale) || oGraph.getScales('v')[0];
				}
			} else if (oScale.sType === 'v') {
				oScaleY = oScale;
				if (self.sPairScale === '') {
					oScaleX = oGraph.getScales('k')[0];
				} else {
					oScaleX = oGraph.getScaleByName(self.sPairScale) || oGraph.getScales('k')[0];
				}
			}
			for (i=0,iLen=self.aRange.length;i<iLen;i++) {
				iX = _get_coord_(oScaleX, self.aRange[i][0]);
				iY = oScaleY.getCoordByValue(self.aRange[i][1]);
				aPoints.push([iX, iY]);
				iAvgX += iX;
				iAvgY += iY;
			}
			iAvgX /= aPoints.length;
			iAvgY /= aPoints.length;

			if (aPoints.length >= 3) {

				if (aPoints[0].join('/') !== aPoints[aPoints.length-1].join('/')) {
					aPoints.push([aPoints[0][0], aPoints[0][1]]);
				}

				if (oScale.oParent.oSettings['3d']) {
					oScale.oParent.setup3DView();
					for (p=0,pLen=aPoints.length;p<pLen;p++) {
						oPoint3D = new ZC.ZCPoint3D(oScale.oParent, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, ZC.ZCDraw3D.iDepth);
						aPoints[p][0] = oPoint3D.aXY[0];
						aPoints[p][1] = oPoint3D.aXY[1];
					}
				}

				oArea = new ZC.ZCShape(self.oParent);
				oArea.sId = oScale.sId + '-marker-' + self.iIndex;
				oArea.oCanvas = oArea.oCanvasSh = oScale.oLoader.usc()?oScale.oLoader.mc():ZC._id_(sCanvasId);
				
				oArea.copy(self);
				oArea.iLineWidth = 0;
				oArea.iBorderWidth = 0;
				oArea.iLineSegmentSize = 0;
				oArea.iLineGapSize = 0;
				oArea.aPoints = aPoints;
				oArea.parse();
				oArea.paint();
			}

		} else if (self.sType === 'line') {
			if (oScale.sName.indexOf('scale-x') !== -1) {
				if (self.aRange.length === 1) {
					iCoord1 = iCoord2 = _get_coord_(oScale, self.aRange[0]) + iRangeOffsetStart;
				} else if (self.aRange.length === 2) {
					iCoord1 = _get_coord_(oScale, self.aRange[0]) + iRangeOffsetStart;
					iCoord2 = _get_coord_(oScale, self.aRange[1]) + iRangeOffsetStart;
				}
			} else if (oScale.sName.indexOf('scale-y') !== -1) {
				if (self.aRange.length === 1) {
					iCoord1 = iCoord2 = oScale.getCoordByValue(self.aRange[0]);
				} else if (self.aRange.length === 2) {
					iCoord1 = oScale.getCoordByValue(self.aRange[0]);
					iCoord2 = oScale.getCoordByValue(self.aRange[1]);
				}
			}
			if ((oScale.sName.indexOf('scale-x') !== -1 && oScale.bInversed) || (oScale.sName.indexOf('scale-y') !== -1 && !oScale.bInversed)) {
				aPoints.push(
					[oScale.iX + self.iOffsetStart, iCoord1],
					[oScale.iX + oScale.iWidth - self.iOffsetEnd, iCoord2]
				);
				if (self.oLabel) {
					if (self.sLabelPlacement === 'opposite') {
						self.oLabel.iX = oScale.iX + oScale.iWidth - self.oLabel.iWidth - self.iOffsetEnd;
					} else {
						self.oLabel.iX = oScale.iX + self.iOffsetStart;
					}
					if (self.sLabelPlacement === 'opposite') {
						self.oLabel.iY = iCoord2 - (oScale.bMirrored?0:self.oLabel.iHeight);
					} else {
						self.oLabel.iY = iCoord1 - (oScale.bMirrored?0:self.oLabel.iHeight);
					}
				}
			} else {
				aPoints.push(
					[iCoord1, oScale.iY + oScale.iHeight - self.iOffsetStart],
					[iCoord2, oScale.iY + self.iOffsetEnd]
				);
				if (self.oLabel) {
					if (self.sLabelPlacement === 'opposite') {
						self.oLabel.iX = iCoord2 - (oScale.bMirrored?self.oLabel.iWidth:0);
					} else {
						self.oLabel.iX = iCoord1 - (oScale.bMirrored?self.oLabel.iWidth:0);
					}
					if (self.sLabelPlacement === 'opposite') {
						self.oLabel.iY = oScale.iY + self.oLabel.iWidth - self.oLabel.iHeight + self.iOffsetEnd;
					} else {
						self.oLabel.iY = oScale.iY + oScale.iHeight - self.oLabel.iHeight - self.iOffsetStart;
					}
				}
			}

			if (oScale.oParent.oSettings['3d']) {
				oScale.oParent.setup3DView();
				for (p=0,pLen=aPoints.length;p<pLen;p++) {
					oPoint3D = new ZC.ZCPoint3D(oScale.oParent, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, ZC.ZCDraw3D.iDepth);
					aPoints[p][0] = oPoint3D.aXY[0];
					aPoints[p][1] = oPoint3D.aXY[1];
				}
			}

			if (aPoints.length === 2) {
				ZC.ZCLine.setup(oCtxMarkers, self);
				ZC.ZCLine.paint(oCtxMarkers, self, aPoints);
			}
		} else if (self.sType === 'area') {
			if (oScale.sName.indexOf('scale-x') !== -1) {
				if (self.aRange.length === 2) {
					iCoord1 = iCoord3 = _get_coord_(oScale, self.aRange[0]) + iRangeOffsetStart;
					iCoord2 = iCoord4 = _get_coord_(oScale, self.aRange[1]) + iRangeOffsetEnd;
				} else if (self.aRange.length === 4) {
					iCoord1 = _get_coord_(oScale, self.aRange[0]) + iRangeOffsetStart;
					iCoord2 = _get_coord_(oScale, self.aRange[1]) + iRangeOffsetEnd;
					iCoord3 = _get_coord_(oScale, self.aRange[2]) + iRangeOffsetStart;
					iCoord4 = _get_coord_(oScale, self.aRange[3]) + iRangeOffsetEnd;
				}
			} else if (oScale.sName.indexOf('scale-y') !== -1) {
				if (self.aRange.length === 2) {
					iCoord1 = iCoord3 = oScale.getCoordByValue(self.aRange[0]);
					iCoord2 = iCoord4 = oScale.getCoordByValue(self.aRange[1]);
				} else if (self.aRange.length === 4) {
					iCoord1 = oScale.getCoordByValue(self.aRange[0]);
					iCoord2 = oScale.getCoordByValue(self.aRange[1]);
					iCoord3 = oScale.getCoordByValue(self.aRange[2]);
					iCoord4 = oScale.getCoordByValue(self.aRange[3]);
				}
			}
			iCoord2 = (iCoord1===iCoord2)?iCoord2+1:iCoord2;
			iCoord4 = (iCoord3===iCoord4)?iCoord4+1:iCoord4;
			if ((oScale.sName.indexOf('scale-x') !== -1 && oScale.bInversed) || (oScale.sName.indexOf('scale-y') !== -1 && !oScale.bInversed)) {
				aPoints.push(
					[oScale.iX + iBorderOffset, iCoord1],
					[oScale.iX + oScale.iWidth - iBorderOffset, iCoord3],
					[oScale.iX + oScale.iWidth - iBorderOffset, iCoord4],
					[oScale.iX + iBorderOffset, iCoord2],
					[oScale.iX + iBorderOffset, iCoord1]
				);
				if (self.oLabel) {
					self.oLabel.iX = oScale.iX;
					self.oLabel.iY = iCoord1 - (oScale.bMirrored?0:self.oLabel.iHeight);
				}
			} else {
				aPoints.push(
					[iCoord1, oScale.iY + oScale.iHeight - iBorderOffset],
					[iCoord3, oScale.iY + iBorderOffset],
					[iCoord4, oScale.iY + iBorderOffset],
					[iCoord2, oScale.iY + oScale.iHeight - iBorderOffset],
					[iCoord1, oScale.iY + oScale.iHeight - iBorderOffset]
				);
				if (self.oLabel) {
					self.oLabel.iX = iCoord1 - (oScale.bMirrored?self.oLabel.iWidth:0);
					self.oLabel.iY = oScale.iY + oScale.iHeight - self.oLabel.iHeight;
				}
			}
			if (aPoints.length >= 4) {

				if (oScale.oParent.oSettings['3d']) {
					oScale.oParent.setup3DView();
					for (p=0,pLen=aPoints.length;p<pLen;p++) {
						oPoint3D = new ZC.ZCPoint3D(oScale.oParent, aPoints[p][0] - ZC.ZCDraw3D.iViewX, aPoints[p][1] - ZC.ZCDraw3D.iViewY, ZC.ZCDraw3D.iDepth);
						aPoints[p][0] = oPoint3D.aXY[0];
						aPoints[p][1] = oPoint3D.aXY[1];
					}
				}

				oArea = new ZC.ZCShape(self.oParent);
				oArea.sId = oScale.sId + '-marker-' + self.iIndex;
				oArea.oCanvas = oArea.oCanvasSh = oScale.oLoader.usc()?oScale.oLoader.mc():ZC._id_(sCanvasId);
				
				oArea.copy(self);
				oArea.iLineWidth = 0;
				oArea.iBorderWidth = 0;
				oArea.iLineSegmentSize = 0;
				oArea.iLineGapSize = 0;
				oArea.aPoints = aPoints;
				oArea.parse();
				oArea.paint();
			}
		}

		var bPlotArea = true, oPlotArea = oScale.oParent.oPlotArea;
		if (aPoints.length === 2) {
			if ((oScale.sName.indexOf('scale-x') !== -1 && oScale.bInversed) || (oScale.sName.indexOf('scale-y') !== -1 && !oScale.bInversed)) {
				if (
					!ZC._btw_(aPoints[0][1], oPlotArea.iY-2, oPlotArea.iY+oPlotArea.iHeight+2)
					||
					!ZC._btw_(aPoints[1][1], oPlotArea.iY-2, oPlotArea.iY+oPlotArea.iHeight+2)
				) {
					bPlotArea = false;
				}
			} else {
				if (
					!ZC._btw_(aPoints[0][0], oPlotArea.iX-2, oPlotArea.iX+oPlotArea.iWidth+2)
					||
					!ZC._btw_(aPoints[1][0], oPlotArea.iX-2, oPlotArea.iX+oPlotArea.iWidth+2)
				) {
					bPlotArea = false;
				}				
			}
		}

		var sLabelAlignment = self.sLabelAlignment;
		if (self.oLabel && bPlotArea) {

			if (self.sType === 'poly') {
				self.oLabel.iX = ZC._i_(iAvgX - self.oLabel.iWidth/2);
				self.oLabel.iY = ZC._i_(iAvgY - self.oLabel.iHeight/2);
			} else {

				if (self.sLabelAlignment === 'auto') {
					if ((oScale.sName.indexOf('scale-x') !== -1 && !oScale.bInversed) || (oScale.sName.indexOf('scale-y') !== -1 && oScale.bInversed)) {
						sLabelAlignment = (iCoord1 < oScale.iX + oScale.iWidth/2)?'normal':'opposite';
					} else {
						sLabelAlignment = (iCoord1 > oScale.iY + oScale.iHeight/2)?'normal':'opposite';
					}
				}

				self.oLabel.iOffsetX = self.oLabel.iOffsetY = 0;

				if ((oScale.sName.indexOf('scale-x') !== -1 && !oScale.bInversed) || (oScale.sName.indexOf('scale-y') !== -1 && oScale.bInversed)) {
					if (ZC._n_(self.oLabel.oData['angle']) === null) {
						self.oLabel.iAngle = 270;
					}
				}

				if ((oScale.sName.indexOf('scale-x') !== -1 && !oScale.bInversed) ||	(oScale.sName.indexOf('scale-y') !== -1 && oScale.bInversed)) {
					if (self.oLabel.iAngle%180 === 90) {
						self.oLabel.iOffsetX -= (oScale.bMirrored?-1:1)*(self.oLabel.iWidth/2 - self.oLabel.iHeight/2);
						self.oLabel.iOffsetY -= (self.oLabel.iWidth/2 - self.oLabel.iHeight/2);
						if (self.sLabelPlacement === 'opposite') {
							self.oLabel.iOffsetY = -self.oLabel.iWidth/2 + self.oLabel.iHeight/2;
						}
						if (sLabelAlignment === 'opposite') {
							self.oLabel.iOffsetX -= self.oLabel.iHeight;
						}
					}
					if (self.oLabel.iAngle%180 === 0) {
						if (self.sLabelPlacement === 'opposite') {
							self.oLabel.iOffsetY = -self.oLabel.iWidth + self.oLabel.iHeight;
						}
						if (sLabelAlignment === 'opposite') {
							self.oLabel.iOffsetX -= self.oLabel.iWidth;
						}
					}
				} else {
					if (self.oLabel.iAngle%180 === 90) {
						self.oLabel.iOffsetX -= (self.oLabel.iWidth/2 - self.oLabel.iHeight/2);
						self.oLabel.iOffsetY -= (oScale.bMirrored?-1:1)*(self.oLabel.iWidth/2 - self.oLabel.iHeight/2);
						if (self.sLabelPlacement === 'opposite') {
							self.oLabel.iOffsetX = self.oLabel.iWidth/2 - self.oLabel.iHeight/2;
						}
						if (sLabelAlignment === 'opposite') {
							self.oLabel.iOffsetY += self.oLabel.iWidth;
						}
					}
					if (self.oLabel.iAngle%180 === 0) {
						if (sLabelAlignment === 'opposite') {
							self.oLabel.iOffsetY += self.oLabel.iHeight;
						}
					}
				}

				self.oLabel.iOffsetX += self.aLabelOffsets[0] + self.iOffsetX;
				self.oLabel.iOffsetY += self.aLabelOffsets[1] + self.iOffsetY;
			}

			if (oScale.oParent.oSettings['3d']) {
				oPoint3D = new ZC.ZCPoint3D(oScale.oParent, self.oLabel.iX - ZC.ZCDraw3D.iViewX, self.oLabel.iY - ZC.ZCDraw3D.iViewY, ZC.ZCDraw3D.iDepth);
				self.oLabel.iX = oPoint3D.aXY[0];
				self.oLabel.iY = oPoint3D.aXY[1];
			}

			self.oLabel.paint();
			self.oLabel.paintPrintVersion();

			if (!self.oLabel.bFlat && zingchart.OBJECTMODE === 'normal')  {
				oScale.oAttributes['marker_text_'+self.iIndex] = self.oLabel.sText;
				var oGraph = self.oParent.oParent;
				if (ZC._id_(oGraph.oParent.sId + '-map')) {
					var sHtml = ZC.ZCUtils._box_area_(oGraph.sId, self.oLabel);
					ZC._id_(oGraph.oParent.sId + '-map').innerHTML = ZC._id_(oGraph.oParent.sId + '-map').innerHTML + sHtml;
				}
				
			}

		}
	}
});












ZC.ZCTweenSequence = ZC.Class.extend({
	init : function(sName) {
		var self = this;
		self.oTweenManager = null;
		self.iPosition = 0;
		self.aTweens = [];
		self.sName = sName;
		self.bCompleted = true;
	},
	add : function(oTween) {
		var self = this;
		self.aTweens.push(oTween);
		oTween.oSequence = self;
		oTween.oTweenManager = self.oTweenManager;
		oTween.oObject.bTweening = true;
		oTween.iSequencePosition = self.aTweens.length-1;
		self.bCompleted = false;
	}
});

ZC.ZCTween = ZC.Class.extend({
	init : function(oObject, oParams, iDuration, iDelay, oTx, oEndCallback) {
		var self = this;
		self.oTweenManager = null;
		self.oObject = oObject;
		self.oNode = null;
		self.fStage = 0;
		self.oCtxLine = null;
		self.oParams = oParams || {};
		self.iDuration = iDuration || 500;
		self.iDelay = iDelay || -1;
		self.oStepCallback = null;
		self.oEndCallback = null;
		self.oSeqFinishedCallback = null;
		if (ZC._n_(oEndCallback) !== null) {
			self.oEndCallback = oEndCallback;
		}
		self.oTx = ZC.ZCTween.linear;
		if (ZC._n_(oTx) !== null && oTx !== '') {
			self.oTx = oTx;
		}
		self.oSteps = {};
		self.oStart = {};
		self.aPointsSteps = [];
		self.iSteps = ZC._i_(self.iDuration/ZC.ZCTweenManager.iAnimationStepDuration);
		if (self.iSteps > 100) {
			self.iSteps = 100;
		}
		if (ZC.vml || ZC.mobile) {
			self.iSteps = ZC._i_(self.iSteps/4);
		}
		if (self.iSteps < 5) {
			self.iSteps = 5;
		}
		for (var p in self.oParams) {
			if (ZC._n_(ZC.ZCTween.oAttrMap[p]) !== null) {
				self.oStart[p] = self.oObject[ZC.ZCTween.oAttrMap[p]];
			} else {
				self.oStart[p] = self.oObject[p];
			}
		}
		self.iStep = 0;
		self.oSequence = null;
		self.iSequencePosition = -1;
	},
	status : function() {
		var self = this;
		if (self.iStep+1 > self.iSteps) {
			return 0;
		}
		return 1;
	},
	step : function() {
		var self = this, mValue, iLineWidth, aPath, aPathSh, i, iLen;
		var iReturn = 1;
		var sOutput = self.oTweenManager.oGraph.oLoader.sOutput;
		self.iStep++;
		if (self.iStep > self.iSteps) {
			if (self.iStep === self.iSteps+1) {
				if (self.iSequencePosition !== -1) {
					self.oSequence.iPosition++;
					if (self.oSequence.iPosition === self.oSequence.aTweens.length) {
						self.oSequence.bCompleted = true;
					}
				}
			}
			iReturn = 0;
		}
		if (iReturn) {
			var oData = {};
			if (self.iStep === self.iSteps) {
				oData = self.oParams;
				self.fStage = 1;
			} else {
				self.fStage = self.oTx(self.iStep, 0, 1, self.iSteps);
				for (var p in self.oParams) {
					switch (p) {
						case 'points':
							var aPoints = [];
							for (i=0,iLen=self.oParams[p].length;i<iLen;i++) {
								if (ZC._n_(self.oStart[p][i]) !== null) {
									aPoints[i] = [];
									for (var j=0,jLen=self.oParams[p][i].length;j<jLen;j++) {
										aPoints[i][j] = self.oTx(self.iStep, self.oStart[p][i][j], (self.oParams[p][i][j]-self.oStart[p][i][j]), self.iSteps);
									}
								}
							}
							oData[p] = aPoints;
							break;
						case 'lineColor':
						case 'borderColor':
						case 'backgroundColor1':
						case 'backgroundColor2':
							var sc = self.oStart[p].replace('#', '');
							var ec = ZC.ZCUtils._color_(self.oParams[p]).replace('#', '');
							var sR = ZC._hex2int_(sc.slice(0, 2));
							var sG = ZC._hex2int_(sc.slice(2, 4));
							var sB = ZC._hex2int_(sc.slice(4, 6));
							var eR = ZC._hex2int_(ec.slice(0, 2));
							var eG = ZC._hex2int_(ec.slice(2, 4));
							var eB = ZC._hex2int_(ec.slice(4, 6));
							var nR = ZC._int2hex_(ZC._i_(self.oTx(self.iStep, sR, (eR-sR), self.iSteps)));
							if (nR.length === 1) { nR = '0'+nR; }
							var nG = ZC._int2hex_(ZC._i_(self.oTx(self.iStep, sG, (eG-sG), self.iSteps)));
							if (nG.length === 1) { nG = '0'+nG; }
							var nB = ZC._int2hex_(ZC._i_(self.oTx(self.iStep, sB, (eB-sB), self.iSteps)));
							if (nB.length === 1) { nB = '0'+nB; }
							oData[p] = '#' + nR + nG + nB;
							break;
						default :
							oData[p] = self.oTx(self.iStep, self.oStart[p], (self.oParams[p]-self.oStart[p]), self.iSteps);
							break;
					}
				}
			}

			self.oObject.append(oData);
			self.oObject.parse();

			if (self.oNode) {
				
				if (ZC._n_(mValue=self.oObject.oAttributes['bound-1']) !== null) {
					self.oObject.aBounds[1] = mValue;
				}
				if (ZC._n_(mValue=self.oObject.oAttributes['bound-3']) !== null) {
					self.oObject.aBounds[3] = mValue;
				}

				if (sOutput === 'vml' && self.iStep === 1) {
					if (typeof(self.oNode.oParent.fAlphaArea) !== 'undefined') {
						self.oObject.oAttributes['opacity2'] = self.oNode.oParent.fAlphaArea;
					} else {
						self.oObject.oAttributes['opacity2'] = self.oNode.oParent.fAlpha;
					}
				}
			}
			if (self.oStepCallback) {
				try {
					self.oStepCallback(self.oObject, oData);
				} catch(e) {}
			}
			if (self.oNode) {
				var oStageInfo = {
					id : self.oNode.oLoader.sId,
					graphid : self.oNode.oGraph.sId,
					plotindex : self.oNode.oParent.iIndex,
					nodeindex : self.oNode.iIndex,
					stage : self.fStage,
					value : self.oNode.fValue*self.fStage
				};
				ZC.ZCUtils._trigger_event_('animation_step', self.oNode.oLoader, oStageInfo);
			}
		}
		if (self.oNode) {
			if (self.iStep === 1 || sOutput === 'canvas') {
				if (ZC._indexof_(['svg','vml'], sOutput) !== -1) {
					if (ZC.ZCQuery('#' + self.oObject.sId + '-path').length === 0) {
						self.paint();
					}
				} else {
					self.paint();
				}
			} else {
				if (self.iStep <= self.iSteps) {
					switch (sOutput) {
						case 'svg':
							self.oObject.sharedSVGSetupGradient(true);
							break;
						case 'vml':
							self.oObject.sharedVMLSetupGradient(null, true);
							break;
					}
					if (self.oObject.sharedSetupPoints) {
						self.oObject.sharedSetupPoints();
					}
					if (sOutput === 'vml' && /\-plotset\-plot-\d+\-node\-\d+\-area/.test(self.oObject.sId)) {
						self.oObject.iLineWidth = 0;
					}
					iLineWidth = null;
					if (typeof(self.oObject.sShape) !== 'undefined' && self.oObject.sShape === 'box') {
						iLineWidth = self.oObject.iLineWidth;
						self.oObject.iLineWidth = self.oObject.iBorderWidth;
					}
					var bRectShortcut = false;
					if (sOutput === 'svg' && ZC._id_(self.oObject.sId + '-path') && ZC._id_(self.oObject.sId + '-path').tagName === 'rect') {
						bRectShortcut = true;
					}

					if (bRectShortcut) {
						aPath = [];
						aPathSh = [];
					} else {
						aPath = ZC.ZCHtmlUtils._vector_path_(self.oObject.aPoints, sOutput, self.oObject, false, true);
						if (self.oObject.bShadow) {
							var aPointsSh = ZC.ZCHtmlUtils._sh_(self.oObject.aPoints, self.oObject);
							aPathSh = ZC.ZCHtmlUtils._vector_path_(aPointsSh, sOutput, self.oObject, false, true);
						}
					}
					if (ZC._n_(iLineWidth) !== null) {
						self.oObject.iLineWidth = iLineWidth;
					}
					var fOA = self.oObject.fAlpha, fOSA = self.oObject.fShadowAlpha, iOSD = self.oObject.iShadowDistance, iOS = self.oObject.iSize;
					switch (sOutput) {
						case 'svg':
							ZC.ZCQuery('#' + self.oObject.sId + '-path')
								.attr('d', aPath.join(' '))
								.attr('stroke-opacity', fOA)
								.attr('fill-opacity', fOA);
							if (self.oObject.bShadow) {
								ZC.ZCQuery('#' + self.oObject.sId + '-sh-path')
									.attr('d', aPathSh.join(' '))
									.attr('stroke-opacity', fOA*fOSA)
									.attr('fill-opacity', fOA*fOSA);
							}
							if (bRectShortcut) {
								ZC.ZCQuery('#' + self.oObject.sId + '-path')
									.attr('x', self.oObject.iX)
									.attr('y', self.oObject.iY)
									.attr('width', ZC._max_(0, self.oObject.iWidth))
									.attr('height', ZC._max_(0, self.oObject.iHeight));
								if (self.oObject.bShadow) {
									ZC.ZCQuery('#' + self.oObject.sId + '-sh-path')
										.attr('x', self.oObject.iX + iOSD*ZC._cos_(self.oObject.iShadowAngle))
										.attr('y', self.oObject.iY + iOSD*ZC._sin_(self.oObject.iShadowAngle))
										.attr('width', ZC._max_(0, self.oObject.iWidth))
										.attr('height', ZC._max_(0, self.oObject.iHeight));
								}
							}
							ZC.ZCQuery('#' + self.oObject.sId + '-circle')
								.attr('stroke-opacity', fOA)
								.attr('cx', self.oObject.iX)
								.attr('cy', self.oObject.iY)
								.attr('r', iOS)
								.attr('fill-opacity', fOA);
							if (self.oObject.bShadow) {
								ZC.ZCQuery('#' + self.oObject.sId + '-sh-circle')
									.attr('stroke-opacity', fOA*fOSA)
									.attr('cx', self.oObject.iX + iOSD)
									.attr('r', iOS)
									.attr('cy', self.oObject.iY + iOSD)
									.attr('fill-opacity', fOA*fOSA);
							}

							break;
						case 'vml':
							ZC.ZCQuery('#' + self.oObject.sId + '-path').children().each(function() {
								this.v = aPath.join(' ');
								this.opacity = fOA;
							});
							if (self.oObject.bShadow) {
								ZC.ZCQuery('#' + self.oObject.sId + '-sh-path').children().each(function() {
									this.v = aPathSh.join(' ');
									this.opacity = fOA*fOSA;
								});
							}
							ZC.ZCQuery('#' + self.oObject.sId + '-circle').children().each(function() {
								this.opacity = fOA;
							});
							ZC.ZCQuery('#' + self.oObject.sId + '-circle').each(function() {
								this.style.left = (self.oObject.iX - iOS) + 'px';
								this.style.top = (self.oObject.iY - iOS) + 'px';
								this.style.width = 2*iOS + 'px';
								this.style.height = 2*iOS + 'px';
							});
							if (self.oObject.bShadow) {
								ZC.ZCQuery('#' + self.oObject.sId + '-sh-circle').children().each(function() {
									this.opacity = fOA*fOSA;
								});
								ZC.ZCQuery('#' + self.oObject.sId + '-sh-circle').each(function() {
									this.style.left = (self.oObject.iX - iOS + iOSD) + 'px';
									this.style.top = (self.oObject.iY - iOS + iOSD) + 'px';
									this.style.width = 2*iOS + 'px';
									this.style.height = 2*iOS + 'px';
								});
							}
							break;
					}
				}
			}
		} else {
			self.oTweenManager.oGraph.bObjectsTweening = true;
			self.oTweenManager.oGraph.clearObjects();
			self.oTweenManager.oGraph.paintObjects();
		}
		if (self.iStep === self.iSteps+1) {
			if (ZC._n_(self.oEndCallback) !== null) {
				
					self.oEndCallback();
				
			}
		}
		return iReturn;
	},
	paint : function() {
		var self = this;
		if (ZC._n_(self.oCtxLine) !== null) {
			ZC.ZCLine.paint(self.oCtxLine, self.oObject, self.oObject.aPoints);
		} else {
			self.oObject.paint();
		}
		if (self.oSeqFinishedCallback) {
			try {
				if (self.fStage === 1) {
					self.oSeqFinishedCallback();
				}
			} catch(e) {}
		}
	}
});

ZC.ZCTween.oAttrMap = {
	angleStart : 'iPieAngleStart',
	angleEnd : 'iPieAngleEnd',
	slice : 'iPieSlice',
	size : 'iSize',
	x : 'iX',
	y : 'iY',
	width : 'iWidth',
	height : 'iHeight',
	alpha : 'fAlpha',
	angle : 'iAngle',
	fillAngle : 'iFillAngle',
	points : 'aPoints',
	lineWidth : 'iLineWidth',
	lineColor : 'sLineColor',
	borderWidth : 'iBorderWidth',
	borderColor : 'sBorderColor',
	backgroundColor1 : 'sBackgroundColor1',
	backgroundColor2 : 'sBackgroundColor2'
};
ZC.ZCTween.linear = function(t, b, c, d) {
	return c*t/d + b;
};
ZC.ZCTween.backEaseOut = function(t, b, c, d) {
	var ts=(t/=d)*t;
	var tc=ts*t;
	return b+c*(4*tc + -9*ts + 6*t);
};
ZC.ZCTween.elasticEaseOut = function(t, b, c, d) {
	var ts=(t/=d)*t;
	var tc=ts*t;
	return b+c*(37.045*tc*ts + -116.2825*ts*ts + 134.08*tc + -68.59*ts + 14.7475*t);
};
ZC.ZCTween.bounceEaseOut = function(t, b, c, d) {
	if ((t/=d) < (1/2.75)) {
		return c*(7.5625*t*t) + b;
	} else if (t < (2/2.75)) {
		return c*(7.5625*(t-=(1.5/2.75))*t + 0.75) + b;
	} else if (t < (2.5/2.75)) {
		return c*(7.5625*(t-=(2.25/2.75))*t + 0.9375) + b;
	} else {
		return c*(7.5625*(t-=(2.625/2.75))*t + 0.984375) + b;
	}
};
ZC.ZCTween.regularEaseOut = function(t, b, c, d) {
	var ts=(t/=d)*t;
	var tc=ts*t;
	return b+c*(tc + -3*ts + 3*t);
};
ZC.ZCTween.strongEaseOut = function(t, b, c, d) {
	var ts=(t/=d)*t;
	var tc=ts*t;
	return b+c*(tc*ts + -5*ts*ts + 10*tc + -10*ts + 5*t);
};
ZC.ZCTween.aMethods = [
	ZC.ZCTween.linear,
	ZC.ZCTween.backEaseOut,
	ZC.ZCTween.elasticEaseOut,
	ZC.ZCTween.bounceEaseOut,
	ZC.ZCTween.strongEaseOut,
	ZC.ZCTween.regularEaseOut
];
ZC.ANIMATION = {
	SLOW : 4000,
	FAST : 1000,
	LINEAR : 0,
	BACK_EASE_OUT : 1,
	ELASTIC_EASE_OUT : 2,
	BOUNCE_EASE_OUT : 3,
	STRONG_EASE_OUT : 4,
	REGULAR_EASE_OUT : 5,
	NO_SEQUENCE : 0,
	BY_PLOT : 1,
	BY_NODE : 2,
	BY_PLOT_AND_NODE : 3,
	FADE_IN : 1,
	
	EXPAND_VERTICAL : 2, 
	EXPAND_TOP : 3,
	EXPAND_BOTTOM : 4,
	EXPAND_LEFT : 5,
	EXPAND_RIGHT : 6,
	EXPAND_HORIZONTAL : 7, 
	SLIDE_LEFT : 8, 
	SLIDE_RIGHT : 9,
	SLIDE_TOP : 10, 
	SLIDE_BOTTOM : 11,
	UNFOLD_HORIZONTAL : 12,
	UNFOLD_VERTICAL : 13,
	
	EXPAND : 2, 
	GROW : 3, 
	FLY_IN : 4, 
	UNFOLD : 5 
};
ZC.ZCTweenManager = ZC.Class.extend({
	init : function(oGraph) {
		var self = this;
		self.oGraph = oGraph;
		self.bOn = false;
		self.iTick = null;
		self.aTweens = [];
		self.oSequences = {};
		self.onStop = null;
	},
	addSequence : function(oSequence) {
		var self = this;
		if (ZC._n_(self.oSequences[oSequence.sName]) === null) {
			self.oSequences[oSequence.sName] = oSequence;
			oSequence.oTweenManager = self;
			if (!self.bOn) {
				self.start();
			}
		}
	},
	add : function(oTween) {
		var self = this;
		oTween.oTweenManager = self;
		if (oTween.iDelay > 0) {
			window.setTimeout(function() {
				oTween.oObject.bTweening = true;
				self.aTweens.push(oTween);
				if (!self.bOn) {
					self.start();
				}
			}, oTween.iDelay+1);
		} else {
			oTween.oObject.bTweening = true;
			self.aTweens.push(oTween);
			if (!self.bOn) {
				self.start();
			}
		}
	},
	start : function() {
		var self = this;
		self.bOn = true;
		ZC.ZCUtils._trigger_event_('animation_start', self.oGraph.oParent, {id : self.oGraph.oParent.sId, graphid : self.oGraph.sId});

		var bFirst = true;
		(function loop() {
			if (!bFirst) {
				self.step();
			}
			bFirst = false;
			if (self.bOn) {
				self.iTick = window.requestAnimFrame(loop);
			}
		})();
	},
	step : function() {
		var self = this, mValue;
		var iActive = 0, iTweenStatus;

		for (var i=0,iLen=self.aTweens.length;i<iLen;i++) {
			iTweenStatus = self.aTweens[i].status();
			iActive += iTweenStatus;
		}

		if (self.oGraph.oLoader.sOutput === 'canvas') {
			if (self.oGraph.oLoader.bFlat) {
				if (ZC._n_(mValue=ZC._id_(self.oGraph.sId + '-plots-bl-c')) !== null) {
					mValue.getContext('2d').clearRect(self.oGraph.iX, self.oGraph.iY, self.oGraph.iWidth, self.oGraph.iHeight);
				}
			} else {
				for (i=0,iLen=self.oGraph.oPlotSet.aPlots.length;i<iLen;i++) {
					for (var l=0;l<self.oGraph.oPlotSet.aPlots[i].iBackLayers;l++) {
						if (ZC._n_(mValue=ZC._id_(self.oGraph.sId + '-plot-' + i + '-bl-' + l + '-c')) !== null) {
							mValue.getContext('2d').clearRect(self.oGraph.iX, self.oGraph.iY, self.oGraph.iWidth, self.oGraph.iHeight);
						}
					}
				}
			}
		}

		for (i=0,iLen=self.aTweens.length;i<iLen;i++) {
			iTweenStatus = self.aTweens[i].step();
			if (iTweenStatus === 0) {
				self.aTweens[i].oObject.bTweening = false;
			}
		}

		for (var q in self.oSequences) {
			if (!self.oSequences[q].bCompleted) {
				iActive += 1;
			}
			for (i=0,iLen=self.oSequences[q].aTweens.length;i<iLen;i++) {
				if (self.oSequences[q].aTweens[i].iSequencePosition === self.oSequences[q].iPosition) {
					iTweenStatus = self.oSequences[q].aTweens[i].step();
					if (iTweenStatus === 0) {
						self.oSequences[q].aTweens[i].oObject.bTweening = false;
					}
				} else {
					if (self.oGraph.oLoader.sOutput === 'canvas') {
						self.oSequences[q].aTweens[i].paint();
					}
				}
			}
		}

		if (iActive === 0) {
			self.oSequences = {};
			self.aTweens = [];
			self.stop();
		}
	},
	stop : function(bKill) {
		if (ZC._n_(bKill) === null) { bKill = false; }
		var self = this, mValue;
		if (bKill) {
			self.bDead = true;
		}
		window.clearAnimFrame(self.iTick);

		self.oGraph.clearObjects();
		self.oGraph.bObjectsTweening = false;
		if (!self.bDead) {
			self.oGraph.paintObjects();
		}

		window.setTimeout(function() {
			if ((mValue=ZC._id_(self.oGraph.oParent.sId + '-map')) && self.oGraph.oPlotSet.aAreas) {
				
				
				if (ZC._indexof_(['bubble', 'mixed', 'vbullet', 'hbullet', 'radar'], self.oGraph.sType) !== -1 || zingchart.SORTTRACKERS === 1) {
					self.oGraph.oPlotSet.aAreas.sort(function(a, b) {
						return (ZC.ZCUtils._area_score_(a) > ZC.ZCUtils._area_score_(b))?1:-1;
					});
				}
				mValue.innerHTML += self.oGraph.oPlotSet.aAreas.join('');
			}
		}, 33);
		self.oGraph.updateSelection();
		self.bOn = false;
		self.aTweens = [];
		self.oSequences = {};
		if (!bKill) {
			ZC.ZCUtils._trigger_event_('animation_end', self.oGraph.oParent, {id : self.oGraph.oParent.sId, graphid : self.oGraph.sId});
		}
		if (ZC._n_(self.onStop) !== null) {
			try {
				self.onStop();
			} catch(e) {}
		}
	}
});
ZC.ZCTweenManager.iAnimationStepDuration = 33;

(function(){

var aPrefix = ['ms', 'moz', 'webkit', 'o'];
for (var i=0,iLen=aPrefix.length;i<iLen && !window.requestAnimFrame;++i) {
	window.requestAnimFrame = window['requestAnimationFrame'] || window[aPrefix[i] + 'RequestAnimationFrame'];
	window.cancelAnimFrame = window['cancelAnimationFrame'] || window[aPrefix[i] + 'CancelAnimationFrame'] || window[aPrefix[i] + 'CancelRequestAnimationFrame'];
}
if (!window.requestAnimFrame) {
	window.requestAnimFrame = (function() {
		return function(oCallback) {
			return window.setTimeout(oCallback, ZC.ZCTweenManager.iAnimationStepDuration);
		};
	})();
}
if (!window.clearAnimFrame) {
	window.clearAnimFrame = function(iTimer) {
		window.clearTimeout(iTimer);
	};
}

})();
